var vye=Object.defineProperty;var dW=r=>{throw TypeError(r)};var yye=(r,s,o)=>s in r?vye(r,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[s]=o;var ge=(r,s,o)=>yye(r,typeof s!="symbol"?s+"":s,o),fA=(r,s,o)=>s.has(r)||dW("Cannot "+o);var de=(r,s,o)=>(fA(r,s,"read from private field"),o?o.call(r):s.get(r)),Xt=(r,s,o)=>s.has(r)?dW("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(r):s.set(r,o),bt=(r,s,o,d)=>(fA(r,s,"write to private field"),d?d.call(r,o):s.set(r,o),o),xn=(r,s,o)=>(fA(r,s,"access private method"),o);var J0=(r,s,o,d)=>({set _(p){bt(r,s,p,o)},get _(){return de(r,s,d)}});function Sye(r,s){for(var o=0;o<s.length;o++){const d=s[o];if(typeof d!="string"&&!Array.isArray(d)){for(const p in d)if(p!=="default"&&!(p in r)){const f=Object.getOwnPropertyDescriptor(d,p);f&&Object.defineProperty(r,p,f.get?f:{enumerable:!0,get:()=>d[p]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const f of p)if(f.type==="childList")for(const E of f.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&d(E)}).observe(document,{childList:!0,subtree:!0});function o(p){const f={};return p.integrity&&(f.integrity=p.integrity),p.referrerPolicy&&(f.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?f.credentials="include":p.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function d(p){if(p.ep)return;p.ep=!0;const f=o(p);fetch(p.href,f)}})();var $0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zP(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Vq={exports:{}},Yb={},Fq={exports:{}},Kn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lv=Symbol.for("react.element"),Tye=Symbol.for("react.portal"),bye=Symbol.for("react.fragment"),wye=Symbol.for("react.strict_mode"),Cye=Symbol.for("react.profiler"),Rye=Symbol.for("react.provider"),xye=Symbol.for("react.context"),Nye=Symbol.for("react.forward_ref"),Iye=Symbol.for("react.suspense"),Aye=Symbol.for("react.memo"),Oye=Symbol.for("react.lazy"),uW=Symbol.iterator;function Pye(r){return r===null||typeof r!="object"?null:(r=uW&&r[uW]||r["@@iterator"],typeof r=="function"?r:null)}var Bq={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Gq=Object.assign,Wq={};function bg(r,s,o){this.props=r,this.context=s,this.refs=Wq,this.updater=o||Bq}bg.prototype.isReactComponent={};bg.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};bg.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Hq(){}Hq.prototype=bg.prototype;function qP(r,s,o){this.props=r,this.context=s,this.refs=Wq,this.updater=o||Bq}var YP=qP.prototype=new Hq;YP.constructor=qP;Gq(YP,bg.prototype);YP.isPureReactComponent=!0;var hW=Array.isArray,Kq=Object.prototype.hasOwnProperty,XP={current:null},zq={key:!0,ref:!0,__self:!0,__source:!0};function qq(r,s,o){var d,p={},f=null,E=null;if(s!=null)for(d in s.ref!==void 0&&(E=s.ref),s.key!==void 0&&(f=""+s.key),s)Kq.call(s,d)&&!zq.hasOwnProperty(d)&&(p[d]=s[d]);var y=arguments.length-2;if(y===1)p.children=o;else if(1<y){for(var b=Array(y),C=0;C<y;C++)b[C]=arguments[C+2];p.children=b}if(r&&r.defaultProps)for(d in y=r.defaultProps,y)p[d]===void 0&&(p[d]=y[d]);return{$$typeof:Lv,type:r,key:f,ref:E,props:p,_owner:XP.current}}function Dye(r,s){return{$$typeof:Lv,type:r.type,key:s,ref:r.ref,props:r.props,_owner:r._owner}}function QP(r){return typeof r=="object"&&r!==null&&r.$$typeof===Lv}function kye(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(o){return s[o]})}var pW=/\/+/g;function gA(r,s){return typeof r=="object"&&r!==null&&r.key!=null?kye(""+r.key):s.toString(36)}function RT(r,s,o,d,p){var f=typeof r;(f==="undefined"||f==="boolean")&&(r=null);var E=!1;if(r===null)E=!0;else switch(f){case"string":case"number":E=!0;break;case"object":switch(r.$$typeof){case Lv:case Tye:E=!0}}if(E)return E=r,p=p(E),r=d===""?"."+gA(E,0):d,hW(p)?(o="",r!=null&&(o=r.replace(pW,"$&/")+"/"),RT(p,s,o,"",function(C){return C})):p!=null&&(QP(p)&&(p=Dye(p,o+(!p.key||E&&E.key===p.key?"":(""+p.key).replace(pW,"$&/")+"/")+r)),s.push(p)),1;if(E=0,d=d===""?".":d+":",hW(r))for(var y=0;y<r.length;y++){f=r[y];var b=d+gA(f,y);E+=RT(f,s,o,b,p)}else if(b=Pye(r),typeof b=="function")for(r=b.call(r),y=0;!(f=r.next()).done;)f=f.value,b=d+gA(f,y++),E+=RT(f,s,o,b,p);else if(f==="object")throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return E}function Z0(r,s,o){if(r==null)return r;var d=[],p=0;return RT(r,d,"","",function(f){return s.call(o,f,p++)}),d}function Lye(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(o){(r._status===0||r._status===-1)&&(r._status=1,r._result=o)},function(o){(r._status===0||r._status===-1)&&(r._status=2,r._result=o)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var la={current:null},xT={transition:null},jye={ReactCurrentDispatcher:la,ReactCurrentBatchConfig:xT,ReactCurrentOwner:XP};function Yq(){throw Error("act(...) is not supported in production builds of React.")}Kn.Children={map:Z0,forEach:function(r,s,o){Z0(r,function(){s.apply(this,arguments)},o)},count:function(r){var s=0;return Z0(r,function(){s++}),s},toArray:function(r){return Z0(r,function(s){return s})||[]},only:function(r){if(!QP(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Kn.Component=bg;Kn.Fragment=bye;Kn.Profiler=Cye;Kn.PureComponent=qP;Kn.StrictMode=wye;Kn.Suspense=Iye;Kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jye;Kn.act=Yq;Kn.cloneElement=function(r,s,o){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var d=Gq({},r.props),p=r.key,f=r.ref,E=r._owner;if(s!=null){if(s.ref!==void 0&&(f=s.ref,E=XP.current),s.key!==void 0&&(p=""+s.key),r.type&&r.type.defaultProps)var y=r.type.defaultProps;for(b in s)Kq.call(s,b)&&!zq.hasOwnProperty(b)&&(d[b]=s[b]===void 0&&y!==void 0?y[b]:s[b])}var b=arguments.length-2;if(b===1)d.children=o;else if(1<b){y=Array(b);for(var C=0;C<b;C++)y[C]=arguments[C+2];d.children=y}return{$$typeof:Lv,type:r.type,key:p,ref:f,props:d,_owner:E}};Kn.createContext=function(r){return r={$$typeof:xye,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Rye,_context:r},r.Consumer=r};Kn.createElement=qq;Kn.createFactory=function(r){var s=qq.bind(null,r);return s.type=r,s};Kn.createRef=function(){return{current:null}};Kn.forwardRef=function(r){return{$$typeof:Nye,render:r}};Kn.isValidElement=QP;Kn.lazy=function(r){return{$$typeof:Oye,_payload:{_status:-1,_result:r},_init:Lye}};Kn.memo=function(r,s){return{$$typeof:Aye,type:r,compare:s===void 0?null:s}};Kn.startTransition=function(r){var s=xT.transition;xT.transition={};try{r()}finally{xT.transition=s}};Kn.unstable_act=Yq;Kn.useCallback=function(r,s){return la.current.useCallback(r,s)};Kn.useContext=function(r){return la.current.useContext(r)};Kn.useDebugValue=function(){};Kn.useDeferredValue=function(r){return la.current.useDeferredValue(r)};Kn.useEffect=function(r,s){return la.current.useEffect(r,s)};Kn.useId=function(){return la.current.useId()};Kn.useImperativeHandle=function(r,s,o){return la.current.useImperativeHandle(r,s,o)};Kn.useInsertionEffect=function(r,s){return la.current.useInsertionEffect(r,s)};Kn.useLayoutEffect=function(r,s){return la.current.useLayoutEffect(r,s)};Kn.useMemo=function(r,s){return la.current.useMemo(r,s)};Kn.useReducer=function(r,s,o){return la.current.useReducer(r,s,o)};Kn.useRef=function(r){return la.current.useRef(r)};Kn.useState=function(r){return la.current.useState(r)};Kn.useSyncExternalStore=function(r,s,o){return la.current.useSyncExternalStore(r,s,o)};Kn.useTransition=function(){return la.current.useTransition()};Kn.version="18.3.1";Fq.exports=Kn;var I=Fq.exports;const En=zP(I),Xq=Sye({__proto__:null,default:En},[I]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mye=I,Uye=Symbol.for("react.element"),Vye=Symbol.for("react.fragment"),Fye=Object.prototype.hasOwnProperty,Bye=Mye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Gye={key:!0,ref:!0,__self:!0,__source:!0};function Qq(r,s,o){var d,p={},f=null,E=null;o!==void 0&&(f=""+o),s.key!==void 0&&(f=""+s.key),s.ref!==void 0&&(E=s.ref);for(d in s)Fye.call(s,d)&&!Gye.hasOwnProperty(d)&&(p[d]=s[d]);if(r&&r.defaultProps)for(d in s=r.defaultProps,s)p[d]===void 0&&(p[d]=s[d]);return{$$typeof:Uye,type:r,key:f,ref:E,props:p,_owner:Bye.current}}Yb.Fragment=Vye;Yb.jsx=Qq;Yb.jsxs=Qq;Vq.exports=Yb;var c=Vq.exports,Jq={exports:{}},no={},$q={exports:{}},Zq={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(Re,et){var xe=Re.length;Re.push(et);e:for(;0<xe;){var Pt=xe-1>>>1,rn=Re[Pt];if(0<p(rn,et))Re[Pt]=et,Re[xe]=rn,xe=Pt;else break e}}function o(Re){return Re.length===0?null:Re[0]}function d(Re){if(Re.length===0)return null;var et=Re[0],xe=Re.pop();if(xe!==et){Re[0]=xe;e:for(var Pt=0,rn=Re.length,Gr=rn>>>1;Pt<Gr;){var er=2*(Pt+1)-1,_i=Re[er],ns=er+1,Lt=Re[ns];if(0>p(_i,xe))ns<rn&&0>p(Lt,_i)?(Re[Pt]=Lt,Re[ns]=xe,Pt=ns):(Re[Pt]=_i,Re[er]=xe,Pt=er);else if(ns<rn&&0>p(Lt,xe))Re[Pt]=Lt,Re[ns]=xe,Pt=ns;else break e}}return et}function p(Re,et){var xe=Re.sortIndex-et.sortIndex;return xe!==0?xe:Re.id-et.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;r.unstable_now=function(){return f.now()}}else{var E=Date,y=E.now();r.unstable_now=function(){return E.now()-y}}var b=[],C=[],A=1,D=null,k=3,W=!1,G=!1,L=!1,B=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function K(Re){for(var et=o(C);et!==null;){if(et.callback===null)d(C);else if(et.startTime<=Re)d(C),et.sortIndex=et.expirationTime,s(b,et);else break;et=o(C)}}function Z(Re){if(L=!1,K(Re),!G)if(o(b)!==null)G=!0,De(ee);else{var et=o(C);et!==null&&Oe(Z,et.startTime-Re)}}function ee(Re,et){G=!1,L&&(L=!1,H(le),le=-1),W=!0;var xe=k;try{for(K(et),D=o(b);D!==null&&(!(D.expirationTime>et)||Re&&!je());){var Pt=D.callback;if(typeof Pt=="function"){D.callback=null,k=D.priorityLevel;var rn=Pt(D.expirationTime<=et);et=r.unstable_now(),typeof rn=="function"?D.callback=rn:D===o(b)&&d(b),K(et)}else d(b);D=o(b)}if(D!==null)var Gr=!0;else{var er=o(C);er!==null&&Oe(Z,er.startTime-et),Gr=!1}return Gr}finally{D=null,k=xe,W=!1}}var $=!1,se=null,le=-1,X=5,oe=-1;function je(){return!(r.unstable_now()-oe<X)}function Ce(){if(se!==null){var Re=r.unstable_now();oe=Re;var et=!0;try{et=se(!0,Re)}finally{et?We():($=!1,se=null)}}else $=!1}var We;if(typeof V=="function")We=function(){V(Ce)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,rt=he.port2;he.port1.onmessage=Ce,We=function(){rt.postMessage(null)}}else We=function(){B(Ce,0)};function De(Re){se=Re,$||($=!0,We())}function Oe(Re,et){le=B(function(){Re(r.unstable_now())},et)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Re){Re.callback=null},r.unstable_continueExecution=function(){G||W||(G=!0,De(ee))},r.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<Re?Math.floor(1e3/Re):5},r.unstable_getCurrentPriorityLevel=function(){return k},r.unstable_getFirstCallbackNode=function(){return o(b)},r.unstable_next=function(Re){switch(k){case 1:case 2:case 3:var et=3;break;default:et=k}var xe=k;k=et;try{return Re()}finally{k=xe}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Re,et){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var xe=k;k=Re;try{return et()}finally{k=xe}},r.unstable_scheduleCallback=function(Re,et,xe){var Pt=r.unstable_now();switch(typeof xe=="object"&&xe!==null?(xe=xe.delay,xe=typeof xe=="number"&&0<xe?Pt+xe:Pt):xe=Pt,Re){case 1:var rn=-1;break;case 2:rn=250;break;case 5:rn=1073741823;break;case 4:rn=1e4;break;default:rn=5e3}return rn=xe+rn,Re={id:A++,callback:et,priorityLevel:Re,startTime:xe,expirationTime:rn,sortIndex:-1},xe>Pt?(Re.sortIndex=xe,s(C,Re),o(b)===null&&Re===o(C)&&(L?(H(le),le=-1):L=!0,Oe(Z,xe-Pt))):(Re.sortIndex=rn,s(b,Re),G||W||(G=!0,De(ee))),Re},r.unstable_shouldYield=je,r.unstable_wrapCallback=function(Re){var et=k;return function(){var xe=k;k=et;try{return Re.apply(this,arguments)}finally{k=xe}}}})(Zq);$q.exports=Zq;var Wye=$q.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hye=I,to=Wye;function nt(r){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+r,o=1;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var eY=new Set,YE={};function Ip(r,s){ag(r,s),ag(r+"Capture",s)}function ag(r,s){for(YE[r]=s,r=0;r<s.length;r++)eY.add(s[r])}var ld=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hO=Object.prototype.hasOwnProperty,Kye=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,mW={},fW={};function zye(r){return hO.call(fW,r)?!0:hO.call(mW,r)?!1:Kye.test(r)?fW[r]=!0:(mW[r]=!0,!1)}function qye(r,s,o,d){if(o!==null&&o.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return d?!1:o!==null?!o.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Yye(r,s,o,d){if(s===null||typeof s>"u"||qye(r,s,o,d))return!0;if(d)return!1;if(o!==null)switch(o.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function da(r,s,o,d,p,f,E){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=d,this.attributeNamespace=p,this.mustUseProperty=o,this.propertyName=r,this.type=s,this.sanitizeURL=f,this.removeEmptyString=E}var Pi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Pi[r]=new da(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var s=r[0];Pi[s]=new da(s,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Pi[r]=new da(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Pi[r]=new da(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Pi[r]=new da(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Pi[r]=new da(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Pi[r]=new da(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Pi[r]=new da(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Pi[r]=new da(r,5,!1,r.toLowerCase(),null,!1,!1)});var JP=/[\-:]([a-z])/g;function $P(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var s=r.replace(JP,$P);Pi[s]=new da(s,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var s=r.replace(JP,$P);Pi[s]=new da(s,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var s=r.replace(JP,$P);Pi[s]=new da(s,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Pi[r]=new da(r,1,!1,r.toLowerCase(),null,!1,!1)});Pi.xlinkHref=new da("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Pi[r]=new da(r,1,!1,r.toLowerCase(),null,!0,!0)});function ZP(r,s,o,d){var p=Pi.hasOwnProperty(s)?Pi[s]:null;(p!==null?p.type!==0:d||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(Yye(s,o,p,d)&&(o=null),d||p===null?zye(s)&&(o===null?r.removeAttribute(s):r.setAttribute(s,""+o)):p.mustUseProperty?r[p.propertyName]=o===null?p.type===3?!1:"":o:(s=p.attributeName,d=p.attributeNamespace,o===null?r.removeAttribute(s):(p=p.type,o=p===3||p===4&&o===!0?"":""+o,d?r.setAttributeNS(d,s,o):r.setAttribute(s,o))))}var Ed=Hye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,eT=Symbol.for("react.element"),_f=Symbol.for("react.portal"),Ef=Symbol.for("react.fragment"),eD=Symbol.for("react.strict_mode"),pO=Symbol.for("react.profiler"),tY=Symbol.for("react.provider"),nY=Symbol.for("react.context"),tD=Symbol.for("react.forward_ref"),mO=Symbol.for("react.suspense"),fO=Symbol.for("react.suspense_list"),nD=Symbol.for("react.memo"),su=Symbol.for("react.lazy"),rY=Symbol.for("react.offscreen"),gW=Symbol.iterator;function hE(r){return r===null||typeof r!="object"?null:(r=gW&&r[gW]||r["@@iterator"],typeof r=="function"?r:null)}var Cs=Object.assign,_A;function xE(r){if(_A===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);_A=s&&s[1]||""}return`
`+_A+r}var EA=!1;function vA(r,s){if(!r||EA)return"";EA=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(C){var d=C}Reflect.construct(r,[],s)}else{try{s.call()}catch(C){d=C}r.call(s.prototype)}else{try{throw Error()}catch(C){d=C}r()}}catch(C){if(C&&d&&typeof C.stack=="string"){for(var p=C.stack.split(`
`),f=d.stack.split(`
`),E=p.length-1,y=f.length-1;1<=E&&0<=y&&p[E]!==f[y];)y--;for(;1<=E&&0<=y;E--,y--)if(p[E]!==f[y]){if(E!==1||y!==1)do if(E--,y--,0>y||p[E]!==f[y]){var b=`
`+p[E].replace(" at new "," at ");return r.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",r.displayName)),b}while(1<=E&&0<=y);break}}}finally{EA=!1,Error.prepareStackTrace=o}return(r=r?r.displayName||r.name:"")?xE(r):""}function Xye(r){switch(r.tag){case 5:return xE(r.type);case 16:return xE("Lazy");case 13:return xE("Suspense");case 19:return xE("SuspenseList");case 0:case 2:case 15:return r=vA(r.type,!1),r;case 11:return r=vA(r.type.render,!1),r;case 1:return r=vA(r.type,!0),r;default:return""}}function gO(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Ef:return"Fragment";case _f:return"Portal";case pO:return"Profiler";case eD:return"StrictMode";case mO:return"Suspense";case fO:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case nY:return(r.displayName||"Context")+".Consumer";case tY:return(r._context.displayName||"Context")+".Provider";case tD:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case nD:return s=r.displayName||null,s!==null?s:gO(r.type)||"Memo";case su:s=r._payload,r=r._init;try{return gO(r(s))}catch{}}return null}function Qye(r){var s=r.type;switch(r.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=s.render,r=r.displayName||r.name||"",s.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gO(s);case 8:return s===eD?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Ou(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function sY(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Jye(r){var s=sY(r)?"checked":"value",o=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),d=""+r[s];if(!r.hasOwnProperty(s)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var p=o.get,f=o.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return p.call(this)},set:function(E){d=""+E,f.call(this,E)}}),Object.defineProperty(r,s,{enumerable:o.enumerable}),{getValue:function(){return d},setValue:function(E){d=""+E},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function tT(r){r._valueTracker||(r._valueTracker=Jye(r))}function iY(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var o=s.getValue(),d="";return r&&(d=sY(r)?r.checked?"true":"false":r.value),r=d,r!==o?(s.setValue(r),!0):!1}function QT(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function _O(r,s){var o=s.checked;return Cs({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??r._wrapperState.initialChecked})}function _W(r,s){var o=s.defaultValue==null?"":s.defaultValue,d=s.checked!=null?s.checked:s.defaultChecked;o=Ou(s.value!=null?s.value:o),r._wrapperState={initialChecked:d,initialValue:o,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function aY(r,s){s=s.checked,s!=null&&ZP(r,"checked",s,!1)}function EO(r,s){aY(r,s);var o=Ou(s.value),d=s.type;if(o!=null)d==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+o):r.value!==""+o&&(r.value=""+o);else if(d==="submit"||d==="reset"){r.removeAttribute("value");return}s.hasOwnProperty("value")?vO(r,s.type,o):s.hasOwnProperty("defaultValue")&&vO(r,s.type,Ou(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(r.defaultChecked=!!s.defaultChecked)}function EW(r,s,o){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var d=s.type;if(!(d!=="submit"&&d!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+r._wrapperState.initialValue,o||s===r.value||(r.value=s),r.defaultValue=s}o=r.name,o!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,o!==""&&(r.name=o)}function vO(r,s,o){(s!=="number"||QT(r.ownerDocument)!==r)&&(o==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+o&&(r.defaultValue=""+o))}var NE=Array.isArray;function Of(r,s,o,d){if(r=r.options,s){s={};for(var p=0;p<o.length;p++)s["$"+o[p]]=!0;for(o=0;o<r.length;o++)p=s.hasOwnProperty("$"+r[o].value),r[o].selected!==p&&(r[o].selected=p),p&&d&&(r[o].defaultSelected=!0)}else{for(o=""+Ou(o),s=null,p=0;p<r.length;p++){if(r[p].value===o){r[p].selected=!0,d&&(r[p].defaultSelected=!0);return}s!==null||r[p].disabled||(s=r[p])}s!==null&&(s.selected=!0)}}function yO(r,s){if(s.dangerouslySetInnerHTML!=null)throw Error(nt(91));return Cs({},s,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function vW(r,s){var o=s.value;if(o==null){if(o=s.children,s=s.defaultValue,o!=null){if(s!=null)throw Error(nt(92));if(NE(o)){if(1<o.length)throw Error(nt(93));o=o[0]}s=o}s==null&&(s=""),o=s}r._wrapperState={initialValue:Ou(o)}}function oY(r,s){var o=Ou(s.value),d=Ou(s.defaultValue);o!=null&&(o=""+o,o!==r.value&&(r.value=o),s.defaultValue==null&&r.defaultValue!==o&&(r.defaultValue=o)),d!=null&&(r.defaultValue=""+d)}function yW(r){var s=r.textContent;s===r._wrapperState.initialValue&&s!==""&&s!==null&&(r.value=s)}function cY(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function SO(r,s){return r==null||r==="http://www.w3.org/1999/xhtml"?cY(s):r==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var nT,lY=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,o,d,p){MSApp.execUnsafeLocalFunction(function(){return r(s,o,d,p)})}:r}(function(r,s){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=s;else{for(nT=nT||document.createElement("div"),nT.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=nT.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;s.firstChild;)r.appendChild(s.firstChild)}});function XE(r,s){if(s){var o=r.firstChild;if(o&&o===r.lastChild&&o.nodeType===3){o.nodeValue=s;return}}r.textContent=s}var LE={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$ye=["Webkit","ms","Moz","O"];Object.keys(LE).forEach(function(r){$ye.forEach(function(s){s=s+r.charAt(0).toUpperCase()+r.substring(1),LE[s]=LE[r]})});function dY(r,s,o){return s==null||typeof s=="boolean"||s===""?"":o||typeof s!="number"||s===0||LE.hasOwnProperty(r)&&LE[r]?(""+s).trim():s+"px"}function uY(r,s){r=r.style;for(var o in s)if(s.hasOwnProperty(o)){var d=o.indexOf("--")===0,p=dY(o,s[o],d);o==="float"&&(o="cssFloat"),d?r.setProperty(o,p):r[o]=p}}var Zye=Cs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function TO(r,s){if(s){if(Zye[r]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(nt(137,r));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(nt(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(nt(61))}if(s.style!=null&&typeof s.style!="object")throw Error(nt(62))}}function bO(r,s){if(r.indexOf("-")===-1)return typeof s.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wO=null;function rD(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var CO=null,Pf=null,Df=null;function SW(r){if(r=Uv(r)){if(typeof CO!="function")throw Error(nt(280));var s=r.stateNode;s&&(s=Zb(s),CO(r.stateNode,r.type,s))}}function hY(r){Pf?Df?Df.push(r):Df=[r]:Pf=r}function pY(){if(Pf){var r=Pf,s=Df;if(Df=Pf=null,SW(r),s)for(r=0;r<s.length;r++)SW(s[r])}}function mY(r,s){return r(s)}function fY(){}var yA=!1;function gY(r,s,o){if(yA)return r(s,o);yA=!0;try{return mY(r,s,o)}finally{yA=!1,(Pf!==null||Df!==null)&&(fY(),pY())}}function QE(r,s){var o=r.stateNode;if(o===null)return null;var d=Zb(o);if(d===null)return null;o=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(r=r.type,d=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!d;break e;default:r=!1}if(r)return null;if(o&&typeof o!="function")throw Error(nt(231,s,typeof o));return o}var RO=!1;if(ld)try{var pE={};Object.defineProperty(pE,"passive",{get:function(){RO=!0}}),window.addEventListener("test",pE,pE),window.removeEventListener("test",pE,pE)}catch{RO=!1}function eSe(r,s,o,d,p,f,E,y,b){var C=Array.prototype.slice.call(arguments,3);try{s.apply(o,C)}catch(A){this.onError(A)}}var jE=!1,JT=null,$T=!1,xO=null,tSe={onError:function(r){jE=!0,JT=r}};function nSe(r,s,o,d,p,f,E,y,b){jE=!1,JT=null,eSe.apply(tSe,arguments)}function rSe(r,s,o,d,p,f,E,y,b){if(nSe.apply(this,arguments),jE){if(jE){var C=JT;jE=!1,JT=null}else throw Error(nt(198));$T||($T=!0,xO=C)}}function Ap(r){var s=r,o=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(o=s.return),r=s.return;while(r)}return s.tag===3?o:null}function _Y(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function TW(r){if(Ap(r)!==r)throw Error(nt(188))}function sSe(r){var s=r.alternate;if(!s){if(s=Ap(r),s===null)throw Error(nt(188));return s!==r?null:r}for(var o=r,d=s;;){var p=o.return;if(p===null)break;var f=p.alternate;if(f===null){if(d=p.return,d!==null){o=d;continue}break}if(p.child===f.child){for(f=p.child;f;){if(f===o)return TW(p),r;if(f===d)return TW(p),s;f=f.sibling}throw Error(nt(188))}if(o.return!==d.return)o=p,d=f;else{for(var E=!1,y=p.child;y;){if(y===o){E=!0,o=p,d=f;break}if(y===d){E=!0,d=p,o=f;break}y=y.sibling}if(!E){for(y=f.child;y;){if(y===o){E=!0,o=f,d=p;break}if(y===d){E=!0,d=f,o=p;break}y=y.sibling}if(!E)throw Error(nt(189))}}if(o.alternate!==d)throw Error(nt(190))}if(o.tag!==3)throw Error(nt(188));return o.stateNode.current===o?r:s}function EY(r){return r=sSe(r),r!==null?vY(r):null}function vY(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var s=vY(r);if(s!==null)return s;r=r.sibling}return null}var yY=to.unstable_scheduleCallback,bW=to.unstable_cancelCallback,iSe=to.unstable_shouldYield,aSe=to.unstable_requestPaint,Us=to.unstable_now,oSe=to.unstable_getCurrentPriorityLevel,sD=to.unstable_ImmediatePriority,SY=to.unstable_UserBlockingPriority,ZT=to.unstable_NormalPriority,cSe=to.unstable_LowPriority,TY=to.unstable_IdlePriority,Xb=null,_l=null;function lSe(r){if(_l&&typeof _l.onCommitFiberRoot=="function")try{_l.onCommitFiberRoot(Xb,r,void 0,(r.current.flags&128)===128)}catch{}}var wc=Math.clz32?Math.clz32:hSe,dSe=Math.log,uSe=Math.LN2;function hSe(r){return r>>>=0,r===0?32:31-(dSe(r)/uSe|0)|0}var rT=64,sT=4194304;function IE(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function eb(r,s){var o=r.pendingLanes;if(o===0)return 0;var d=0,p=r.suspendedLanes,f=r.pingedLanes,E=o&268435455;if(E!==0){var y=E&~p;y!==0?d=IE(y):(f&=E,f!==0&&(d=IE(f)))}else E=o&~p,E!==0?d=IE(E):f!==0&&(d=IE(f));if(d===0)return 0;if(s!==0&&s!==d&&!(s&p)&&(p=d&-d,f=s&-s,p>=f||p===16&&(f&4194240)!==0))return s;if(d&4&&(d|=o&16),s=r.entangledLanes,s!==0)for(r=r.entanglements,s&=d;0<s;)o=31-wc(s),p=1<<o,d|=r[o],s&=~p;return d}function pSe(r,s){switch(r){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mSe(r,s){for(var o=r.suspendedLanes,d=r.pingedLanes,p=r.expirationTimes,f=r.pendingLanes;0<f;){var E=31-wc(f),y=1<<E,b=p[E];b===-1?(!(y&o)||y&d)&&(p[E]=pSe(y,s)):b<=s&&(r.expiredLanes|=y),f&=~y}}function NO(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function bY(){var r=rT;return rT<<=1,!(rT&4194240)&&(rT=64),r}function SA(r){for(var s=[],o=0;31>o;o++)s.push(r);return s}function jv(r,s,o){r.pendingLanes|=s,s!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,s=31-wc(s),r[s]=o}function fSe(r,s){var o=r.pendingLanes&~s;r.pendingLanes=s,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=s,r.mutableReadLanes&=s,r.entangledLanes&=s,s=r.entanglements;var d=r.eventTimes;for(r=r.expirationTimes;0<o;){var p=31-wc(o),f=1<<p;s[p]=0,d[p]=-1,r[p]=-1,o&=~f}}function iD(r,s){var o=r.entangledLanes|=s;for(r=r.entanglements;o;){var d=31-wc(o),p=1<<d;p&s|r[d]&s&&(r[d]|=s),o&=~p}}var Ir=0;function wY(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var CY,aD,RY,xY,NY,IO=!1,iT=[],Tu=null,bu=null,wu=null,JE=new Map,$E=new Map,au=[],gSe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wW(r,s){switch(r){case"focusin":case"focusout":Tu=null;break;case"dragenter":case"dragleave":bu=null;break;case"mouseover":case"mouseout":wu=null;break;case"pointerover":case"pointerout":JE.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":$E.delete(s.pointerId)}}function mE(r,s,o,d,p,f){return r===null||r.nativeEvent!==f?(r={blockedOn:s,domEventName:o,eventSystemFlags:d,nativeEvent:f,targetContainers:[p]},s!==null&&(s=Uv(s),s!==null&&aD(s)),r):(r.eventSystemFlags|=d,s=r.targetContainers,p!==null&&s.indexOf(p)===-1&&s.push(p),r)}function _Se(r,s,o,d,p){switch(s){case"focusin":return Tu=mE(Tu,r,s,o,d,p),!0;case"dragenter":return bu=mE(bu,r,s,o,d,p),!0;case"mouseover":return wu=mE(wu,r,s,o,d,p),!0;case"pointerover":var f=p.pointerId;return JE.set(f,mE(JE.get(f)||null,r,s,o,d,p)),!0;case"gotpointercapture":return f=p.pointerId,$E.set(f,mE($E.get(f)||null,r,s,o,d,p)),!0}return!1}function IY(r){var s=qh(r.target);if(s!==null){var o=Ap(s);if(o!==null){if(s=o.tag,s===13){if(s=_Y(o),s!==null){r.blockedOn=s,NY(r.priority,function(){RY(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){r.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}r.blockedOn=null}function NT(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var o=AO(r.domEventName,r.eventSystemFlags,s[0],r.nativeEvent);if(o===null){o=r.nativeEvent;var d=new o.constructor(o.type,o);wO=d,o.target.dispatchEvent(d),wO=null}else return s=Uv(o),s!==null&&aD(s),r.blockedOn=o,!1;s.shift()}return!0}function CW(r,s,o){NT(r)&&o.delete(s)}function ESe(){IO=!1,Tu!==null&&NT(Tu)&&(Tu=null),bu!==null&&NT(bu)&&(bu=null),wu!==null&&NT(wu)&&(wu=null),JE.forEach(CW),$E.forEach(CW)}function fE(r,s){r.blockedOn===s&&(r.blockedOn=null,IO||(IO=!0,to.unstable_scheduleCallback(to.unstable_NormalPriority,ESe)))}function ZE(r){function s(p){return fE(p,r)}if(0<iT.length){fE(iT[0],r);for(var o=1;o<iT.length;o++){var d=iT[o];d.blockedOn===r&&(d.blockedOn=null)}}for(Tu!==null&&fE(Tu,r),bu!==null&&fE(bu,r),wu!==null&&fE(wu,r),JE.forEach(s),$E.forEach(s),o=0;o<au.length;o++)d=au[o],d.blockedOn===r&&(d.blockedOn=null);for(;0<au.length&&(o=au[0],o.blockedOn===null);)IY(o),o.blockedOn===null&&au.shift()}var kf=Ed.ReactCurrentBatchConfig,tb=!0;function vSe(r,s,o,d){var p=Ir,f=kf.transition;kf.transition=null;try{Ir=1,oD(r,s,o,d)}finally{Ir=p,kf.transition=f}}function ySe(r,s,o,d){var p=Ir,f=kf.transition;kf.transition=null;try{Ir=4,oD(r,s,o,d)}finally{Ir=p,kf.transition=f}}function oD(r,s,o,d){if(tb){var p=AO(r,s,o,d);if(p===null)OA(r,s,d,nb,o),wW(r,d);else if(_Se(p,r,s,o,d))d.stopPropagation();else if(wW(r,d),s&4&&-1<gSe.indexOf(r)){for(;p!==null;){var f=Uv(p);if(f!==null&&CY(f),f=AO(r,s,o,d),f===null&&OA(r,s,d,nb,o),f===p)break;p=f}p!==null&&d.stopPropagation()}else OA(r,s,d,null,o)}}var nb=null;function AO(r,s,o,d){if(nb=null,r=rD(d),r=qh(r),r!==null)if(s=Ap(r),s===null)r=null;else if(o=s.tag,o===13){if(r=_Y(s),r!==null)return r;r=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null);return nb=r,null}function AY(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oSe()){case sD:return 1;case SY:return 4;case ZT:case cSe:return 16;case TY:return 536870912;default:return 16}default:return 16}}var Eu=null,cD=null,IT=null;function OY(){if(IT)return IT;var r,s=cD,o=s.length,d,p="value"in Eu?Eu.value:Eu.textContent,f=p.length;for(r=0;r<o&&s[r]===p[r];r++);var E=o-r;for(d=1;d<=E&&s[o-d]===p[f-d];d++);return IT=p.slice(r,1<d?1-d:void 0)}function AT(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function aT(){return!0}function RW(){return!1}function ro(r){function s(o,d,p,f,E){this._reactName=o,this._targetInst=p,this.type=d,this.nativeEvent=f,this.target=E,this.currentTarget=null;for(var y in r)r.hasOwnProperty(y)&&(o=r[y],this[y]=o?o(f):f[y]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?aT:RW,this.isPropagationStopped=RW,this}return Cs(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=aT)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=aT)},persist:function(){},isPersistent:aT}),s}var wg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lD=ro(wg),Mv=Cs({},wg,{view:0,detail:0}),SSe=ro(Mv),TA,bA,gE,Qb=Cs({},Mv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dD,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==gE&&(gE&&r.type==="mousemove"?(TA=r.screenX-gE.screenX,bA=r.screenY-gE.screenY):bA=TA=0,gE=r),TA)},movementY:function(r){return"movementY"in r?r.movementY:bA}}),xW=ro(Qb),TSe=Cs({},Qb,{dataTransfer:0}),bSe=ro(TSe),wSe=Cs({},Mv,{relatedTarget:0}),wA=ro(wSe),CSe=Cs({},wg,{animationName:0,elapsedTime:0,pseudoElement:0}),RSe=ro(CSe),xSe=Cs({},wg,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),NSe=ro(xSe),ISe=Cs({},wg,{data:0}),NW=ro(ISe),ASe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},OSe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},PSe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DSe(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=PSe[r])?!!s[r]:!1}function dD(){return DSe}var kSe=Cs({},Mv,{key:function(r){if(r.key){var s=ASe[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=AT(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?OSe[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dD,charCode:function(r){return r.type==="keypress"?AT(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?AT(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),LSe=ro(kSe),jSe=Cs({},Qb,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),IW=ro(jSe),MSe=Cs({},Mv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dD}),USe=ro(MSe),VSe=Cs({},wg,{propertyName:0,elapsedTime:0,pseudoElement:0}),FSe=ro(VSe),BSe=Cs({},Qb,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),GSe=ro(BSe),WSe=[9,13,27,32],uD=ld&&"CompositionEvent"in window,ME=null;ld&&"documentMode"in document&&(ME=document.documentMode);var HSe=ld&&"TextEvent"in window&&!ME,PY=ld&&(!uD||ME&&8<ME&&11>=ME),AW=" ",OW=!1;function DY(r,s){switch(r){case"keyup":return WSe.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kY(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var vf=!1;function KSe(r,s){switch(r){case"compositionend":return kY(s);case"keypress":return s.which!==32?null:(OW=!0,AW);case"textInput":return r=s.data,r===AW&&OW?null:r;default:return null}}function zSe(r,s){if(vf)return r==="compositionend"||!uD&&DY(r,s)?(r=OY(),IT=cD=Eu=null,vf=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return PY&&s.locale!=="ko"?null:s.data;default:return null}}var qSe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function PW(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!qSe[r.type]:s==="textarea"}function LY(r,s,o,d){hY(d),s=rb(s,"onChange"),0<s.length&&(o=new lD("onChange","change",null,o,d),r.push({event:o,listeners:s}))}var UE=null,ev=null;function YSe(r){zY(r,0)}function Jb(r){var s=Tf(r);if(iY(s))return r}function XSe(r,s){if(r==="change")return s}var jY=!1;if(ld){var CA;if(ld){var RA="oninput"in document;if(!RA){var DW=document.createElement("div");DW.setAttribute("oninput","return;"),RA=typeof DW.oninput=="function"}CA=RA}else CA=!1;jY=CA&&(!document.documentMode||9<document.documentMode)}function kW(){UE&&(UE.detachEvent("onpropertychange",MY),ev=UE=null)}function MY(r){if(r.propertyName==="value"&&Jb(ev)){var s=[];LY(s,ev,r,rD(r)),gY(YSe,s)}}function QSe(r,s,o){r==="focusin"?(kW(),UE=s,ev=o,UE.attachEvent("onpropertychange",MY)):r==="focusout"&&kW()}function JSe(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Jb(ev)}function $Se(r,s){if(r==="click")return Jb(s)}function ZSe(r,s){if(r==="input"||r==="change")return Jb(s)}function e0e(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var xc=typeof Object.is=="function"?Object.is:e0e;function tv(r,s){if(xc(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var o=Object.keys(r),d=Object.keys(s);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var p=o[d];if(!hO.call(s,p)||!xc(r[p],s[p]))return!1}return!0}function LW(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function jW(r,s){var o=LW(r);r=0;for(var d;o;){if(o.nodeType===3){if(d=r+o.textContent.length,r<=s&&d>=s)return{node:o,offset:s-r};r=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=LW(o)}}function UY(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?UY(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function VY(){for(var r=window,s=QT();s instanceof r.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)r=s.contentWindow;else break;s=QT(r.document)}return s}function hD(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}function t0e(r){var s=VY(),o=r.focusedElem,d=r.selectionRange;if(s!==o&&o&&o.ownerDocument&&UY(o.ownerDocument.documentElement,o)){if(d!==null&&hD(o)){if(s=d.start,r=d.end,r===void 0&&(r=s),"selectionStart"in o)o.selectionStart=s,o.selectionEnd=Math.min(r,o.value.length);else if(r=(s=o.ownerDocument||document)&&s.defaultView||window,r.getSelection){r=r.getSelection();var p=o.textContent.length,f=Math.min(d.start,p);d=d.end===void 0?f:Math.min(d.end,p),!r.extend&&f>d&&(p=d,d=f,f=p),p=jW(o,f);var E=jW(o,d);p&&E&&(r.rangeCount!==1||r.anchorNode!==p.node||r.anchorOffset!==p.offset||r.focusNode!==E.node||r.focusOffset!==E.offset)&&(s=s.createRange(),s.setStart(p.node,p.offset),r.removeAllRanges(),f>d?(r.addRange(s),r.extend(E.node,E.offset)):(s.setEnd(E.node,E.offset),r.addRange(s)))}}for(s=[],r=o;r=r.parentNode;)r.nodeType===1&&s.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<s.length;o++)r=s[o],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var n0e=ld&&"documentMode"in document&&11>=document.documentMode,yf=null,OO=null,VE=null,PO=!1;function MW(r,s,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;PO||yf==null||yf!==QT(d)||(d=yf,"selectionStart"in d&&hD(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),VE&&tv(VE,d)||(VE=d,d=rb(OO,"onSelect"),0<d.length&&(s=new lD("onSelect","select",null,s,o),r.push({event:s,listeners:d}),s.target=yf)))}function oT(r,s){var o={};return o[r.toLowerCase()]=s.toLowerCase(),o["Webkit"+r]="webkit"+s,o["Moz"+r]="moz"+s,o}var Sf={animationend:oT("Animation","AnimationEnd"),animationiteration:oT("Animation","AnimationIteration"),animationstart:oT("Animation","AnimationStart"),transitionend:oT("Transition","TransitionEnd")},xA={},FY={};ld&&(FY=document.createElement("div").style,"AnimationEvent"in window||(delete Sf.animationend.animation,delete Sf.animationiteration.animation,delete Sf.animationstart.animation),"TransitionEvent"in window||delete Sf.transitionend.transition);function $b(r){if(xA[r])return xA[r];if(!Sf[r])return r;var s=Sf[r],o;for(o in s)if(s.hasOwnProperty(o)&&o in FY)return xA[r]=s[o];return r}var BY=$b("animationend"),GY=$b("animationiteration"),WY=$b("animationstart"),HY=$b("transitionend"),KY=new Map,UW="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Bu(r,s){KY.set(r,s),Ip(s,[r])}for(var NA=0;NA<UW.length;NA++){var IA=UW[NA],r0e=IA.toLowerCase(),s0e=IA[0].toUpperCase()+IA.slice(1);Bu(r0e,"on"+s0e)}Bu(BY,"onAnimationEnd");Bu(GY,"onAnimationIteration");Bu(WY,"onAnimationStart");Bu("dblclick","onDoubleClick");Bu("focusin","onFocus");Bu("focusout","onBlur");Bu(HY,"onTransitionEnd");ag("onMouseEnter",["mouseout","mouseover"]);ag("onMouseLeave",["mouseout","mouseover"]);ag("onPointerEnter",["pointerout","pointerover"]);ag("onPointerLeave",["pointerout","pointerover"]);Ip("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ip("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ip("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ip("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ip("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ip("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var AE="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),i0e=new Set("cancel close invalid load scroll toggle".split(" ").concat(AE));function VW(r,s,o){var d=r.type||"unknown-event";r.currentTarget=o,rSe(d,s,void 0,r),r.currentTarget=null}function zY(r,s){s=(s&4)!==0;for(var o=0;o<r.length;o++){var d=r[o],p=d.event;d=d.listeners;e:{var f=void 0;if(s)for(var E=d.length-1;0<=E;E--){var y=d[E],b=y.instance,C=y.currentTarget;if(y=y.listener,b!==f&&p.isPropagationStopped())break e;VW(p,y,C),f=b}else for(E=0;E<d.length;E++){if(y=d[E],b=y.instance,C=y.currentTarget,y=y.listener,b!==f&&p.isPropagationStopped())break e;VW(p,y,C),f=b}}}if($T)throw r=xO,$T=!1,xO=null,r}function Zr(r,s){var o=s[MO];o===void 0&&(o=s[MO]=new Set);var d=r+"__bubble";o.has(d)||(qY(s,r,2,!1),o.add(d))}function AA(r,s,o){var d=0;s&&(d|=4),qY(o,r,d,s)}var cT="_reactListening"+Math.random().toString(36).slice(2);function nv(r){if(!r[cT]){r[cT]=!0,eY.forEach(function(o){o!=="selectionchange"&&(i0e.has(o)||AA(o,!1,r),AA(o,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[cT]||(s[cT]=!0,AA("selectionchange",!1,s))}}function qY(r,s,o,d){switch(AY(s)){case 1:var p=vSe;break;case 4:p=ySe;break;default:p=oD}o=p.bind(null,s,o,r),p=void 0,!RO||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(p=!0),d?p!==void 0?r.addEventListener(s,o,{capture:!0,passive:p}):r.addEventListener(s,o,!0):p!==void 0?r.addEventListener(s,o,{passive:p}):r.addEventListener(s,o,!1)}function OA(r,s,o,d,p){var f=d;if(!(s&1)&&!(s&2)&&d!==null)e:for(;;){if(d===null)return;var E=d.tag;if(E===3||E===4){var y=d.stateNode.containerInfo;if(y===p||y.nodeType===8&&y.parentNode===p)break;if(E===4)for(E=d.return;E!==null;){var b=E.tag;if((b===3||b===4)&&(b=E.stateNode.containerInfo,b===p||b.nodeType===8&&b.parentNode===p))return;E=E.return}for(;y!==null;){if(E=qh(y),E===null)return;if(b=E.tag,b===5||b===6){d=f=E;continue e}y=y.parentNode}}d=d.return}gY(function(){var C=f,A=rD(o),D=[];e:{var k=KY.get(r);if(k!==void 0){var W=lD,G=r;switch(r){case"keypress":if(AT(o)===0)break e;case"keydown":case"keyup":W=LSe;break;case"focusin":G="focus",W=wA;break;case"focusout":G="blur",W=wA;break;case"beforeblur":case"afterblur":W=wA;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":W=xW;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":W=bSe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":W=USe;break;case BY:case GY:case WY:W=RSe;break;case HY:W=FSe;break;case"scroll":W=SSe;break;case"wheel":W=GSe;break;case"copy":case"cut":case"paste":W=NSe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":W=IW}var L=(s&4)!==0,B=!L&&r==="scroll",H=L?k!==null?k+"Capture":null:k;L=[];for(var V=C,K;V!==null;){K=V;var Z=K.stateNode;if(K.tag===5&&Z!==null&&(K=Z,H!==null&&(Z=QE(V,H),Z!=null&&L.push(rv(V,Z,K)))),B)break;V=V.return}0<L.length&&(k=new W(k,G,null,o,A),D.push({event:k,listeners:L}))}}if(!(s&7)){e:{if(k=r==="mouseover"||r==="pointerover",W=r==="mouseout"||r==="pointerout",k&&o!==wO&&(G=o.relatedTarget||o.fromElement)&&(qh(G)||G[dd]))break e;if((W||k)&&(k=A.window===A?A:(k=A.ownerDocument)?k.defaultView||k.parentWindow:window,W?(G=o.relatedTarget||o.toElement,W=C,G=G?qh(G):null,G!==null&&(B=Ap(G),G!==B||G.tag!==5&&G.tag!==6)&&(G=null)):(W=null,G=C),W!==G)){if(L=xW,Z="onMouseLeave",H="onMouseEnter",V="mouse",(r==="pointerout"||r==="pointerover")&&(L=IW,Z="onPointerLeave",H="onPointerEnter",V="pointer"),B=W==null?k:Tf(W),K=G==null?k:Tf(G),k=new L(Z,V+"leave",W,o,A),k.target=B,k.relatedTarget=K,Z=null,qh(A)===C&&(L=new L(H,V+"enter",G,o,A),L.target=K,L.relatedTarget=B,Z=L),B=Z,W&&G)t:{for(L=W,H=G,V=0,K=L;K;K=cf(K))V++;for(K=0,Z=H;Z;Z=cf(Z))K++;for(;0<V-K;)L=cf(L),V--;for(;0<K-V;)H=cf(H),K--;for(;V--;){if(L===H||H!==null&&L===H.alternate)break t;L=cf(L),H=cf(H)}L=null}else L=null;W!==null&&FW(D,k,W,L,!1),G!==null&&B!==null&&FW(D,B,G,L,!0)}}e:{if(k=C?Tf(C):window,W=k.nodeName&&k.nodeName.toLowerCase(),W==="select"||W==="input"&&k.type==="file")var ee=XSe;else if(PW(k))if(jY)ee=ZSe;else{ee=JSe;var $=QSe}else(W=k.nodeName)&&W.toLowerCase()==="input"&&(k.type==="checkbox"||k.type==="radio")&&(ee=$Se);if(ee&&(ee=ee(r,C))){LY(D,ee,o,A);break e}$&&$(r,k,C),r==="focusout"&&($=k._wrapperState)&&$.controlled&&k.type==="number"&&vO(k,"number",k.value)}switch($=C?Tf(C):window,r){case"focusin":(PW($)||$.contentEditable==="true")&&(yf=$,OO=C,VE=null);break;case"focusout":VE=OO=yf=null;break;case"mousedown":PO=!0;break;case"contextmenu":case"mouseup":case"dragend":PO=!1,MW(D,o,A);break;case"selectionchange":if(n0e)break;case"keydown":case"keyup":MW(D,o,A)}var se;if(uD)e:{switch(r){case"compositionstart":var le="onCompositionStart";break e;case"compositionend":le="onCompositionEnd";break e;case"compositionupdate":le="onCompositionUpdate";break e}le=void 0}else vf?DY(r,o)&&(le="onCompositionEnd"):r==="keydown"&&o.keyCode===229&&(le="onCompositionStart");le&&(PY&&o.locale!=="ko"&&(vf||le!=="onCompositionStart"?le==="onCompositionEnd"&&vf&&(se=OY()):(Eu=A,cD="value"in Eu?Eu.value:Eu.textContent,vf=!0)),$=rb(C,le),0<$.length&&(le=new NW(le,r,null,o,A),D.push({event:le,listeners:$}),se?le.data=se:(se=kY(o),se!==null&&(le.data=se)))),(se=HSe?KSe(r,o):zSe(r,o))&&(C=rb(C,"onBeforeInput"),0<C.length&&(A=new NW("onBeforeInput","beforeinput",null,o,A),D.push({event:A,listeners:C}),A.data=se))}zY(D,s)})}function rv(r,s,o){return{instance:r,listener:s,currentTarget:o}}function rb(r,s){for(var o=s+"Capture",d=[];r!==null;){var p=r,f=p.stateNode;p.tag===5&&f!==null&&(p=f,f=QE(r,o),f!=null&&d.unshift(rv(r,f,p)),f=QE(r,s),f!=null&&d.push(rv(r,f,p))),r=r.return}return d}function cf(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function FW(r,s,o,d,p){for(var f=s._reactName,E=[];o!==null&&o!==d;){var y=o,b=y.alternate,C=y.stateNode;if(b!==null&&b===d)break;y.tag===5&&C!==null&&(y=C,p?(b=QE(o,f),b!=null&&E.unshift(rv(o,b,y))):p||(b=QE(o,f),b!=null&&E.push(rv(o,b,y)))),o=o.return}E.length!==0&&r.push({event:s,listeners:E})}var a0e=/\r\n?/g,o0e=/\u0000|\uFFFD/g;function BW(r){return(typeof r=="string"?r:""+r).replace(a0e,`
`).replace(o0e,"")}function lT(r,s,o){if(s=BW(s),BW(r)!==s&&o)throw Error(nt(425))}function sb(){}var DO=null,kO=null;function LO(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var jO=typeof setTimeout=="function"?setTimeout:void 0,c0e=typeof clearTimeout=="function"?clearTimeout:void 0,GW=typeof Promise=="function"?Promise:void 0,l0e=typeof queueMicrotask=="function"?queueMicrotask:typeof GW<"u"?function(r){return GW.resolve(null).then(r).catch(d0e)}:jO;function d0e(r){setTimeout(function(){throw r})}function PA(r,s){var o=s,d=0;do{var p=o.nextSibling;if(r.removeChild(o),p&&p.nodeType===8)if(o=p.data,o==="/$"){if(d===0){r.removeChild(p),ZE(s);return}d--}else o!=="$"&&o!=="$?"&&o!=="$!"||d++;o=p}while(o);ZE(s)}function Cu(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return r}function WW(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var o=r.data;if(o==="$"||o==="$!"||o==="$?"){if(s===0)return r;s--}else o==="/$"&&s++}r=r.previousSibling}return null}var Cg=Math.random().toString(36).slice(2),pl="__reactFiber$"+Cg,sv="__reactProps$"+Cg,dd="__reactContainer$"+Cg,MO="__reactEvents$"+Cg,u0e="__reactListeners$"+Cg,h0e="__reactHandles$"+Cg;function qh(r){var s=r[pl];if(s)return s;for(var o=r.parentNode;o;){if(s=o[dd]||o[pl]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(r=WW(r);r!==null;){if(o=r[pl])return o;r=WW(r)}return s}r=o,o=r.parentNode}return null}function Uv(r){return r=r[pl]||r[dd],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Tf(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(nt(33))}function Zb(r){return r[sv]||null}var UO=[],bf=-1;function Gu(r){return{current:r}}function es(r){0>bf||(r.current=UO[bf],UO[bf]=null,bf--)}function Kr(r,s){bf++,UO[bf]=r.current,r.current=s}var Pu={},Hi=Gu(Pu),Aa=Gu(!1),cp=Pu;function og(r,s){var o=r.type.contextTypes;if(!o)return Pu;var d=r.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===s)return d.__reactInternalMemoizedMaskedChildContext;var p={},f;for(f in o)p[f]=s[f];return d&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=p),p}function Oa(r){return r=r.childContextTypes,r!=null}function ib(){es(Aa),es(Hi)}function HW(r,s,o){if(Hi.current!==Pu)throw Error(nt(168));Kr(Hi,s),Kr(Aa,o)}function YY(r,s,o){var d=r.stateNode;if(s=s.childContextTypes,typeof d.getChildContext!="function")return o;d=d.getChildContext();for(var p in d)if(!(p in s))throw Error(nt(108,Qye(r)||"Unknown",p));return Cs({},o,d)}function ab(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Pu,cp=Hi.current,Kr(Hi,r),Kr(Aa,Aa.current),!0}function KW(r,s,o){var d=r.stateNode;if(!d)throw Error(nt(169));o?(r=YY(r,s,cp),d.__reactInternalMemoizedMergedChildContext=r,es(Aa),es(Hi),Kr(Hi,r)):es(Aa),Kr(Aa,o)}var $l=null,ew=!1,DA=!1;function XY(r){$l===null?$l=[r]:$l.push(r)}function p0e(r){ew=!0,XY(r)}function Wu(){if(!DA&&$l!==null){DA=!0;var r=0,s=Ir;try{var o=$l;for(Ir=1;r<o.length;r++){var d=o[r];do d=d(!0);while(d!==null)}$l=null,ew=!1}catch(p){throw $l!==null&&($l=$l.slice(r+1)),yY(sD,Wu),p}finally{Ir=s,DA=!1}}return null}var wf=[],Cf=0,ob=null,cb=0,Po=[],Do=0,lp=null,nd=1,rd="";function Gh(r,s){wf[Cf++]=cb,wf[Cf++]=ob,ob=r,cb=s}function QY(r,s,o){Po[Do++]=nd,Po[Do++]=rd,Po[Do++]=lp,lp=r;var d=nd;r=rd;var p=32-wc(d)-1;d&=~(1<<p),o+=1;var f=32-wc(s)+p;if(30<f){var E=p-p%5;f=(d&(1<<E)-1).toString(32),d>>=E,p-=E,nd=1<<32-wc(s)+p|o<<p|d,rd=f+r}else nd=1<<f|o<<p|d,rd=r}function pD(r){r.return!==null&&(Gh(r,1),QY(r,1,0))}function mD(r){for(;r===ob;)ob=wf[--Cf],wf[Cf]=null,cb=wf[--Cf],wf[Cf]=null;for(;r===lp;)lp=Po[--Do],Po[Do]=null,rd=Po[--Do],Po[Do]=null,nd=Po[--Do],Po[Do]=null}var $a=null,Ja=null,ds=!1,Ec=null;function JY(r,s){var o=ko(5,null,null,0);o.elementType="DELETED",o.stateNode=s,o.return=r,s=r.deletions,s===null?(r.deletions=[o],r.flags|=16):s.push(o)}function zW(r,s){switch(r.tag){case 5:var o=r.type;return s=s.nodeType!==1||o.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(r.stateNode=s,$a=r,Ja=Cu(s.firstChild),!0):!1;case 6:return s=r.pendingProps===""||s.nodeType!==3?null:s,s!==null?(r.stateNode=s,$a=r,Ja=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(o=lp!==null?{id:nd,overflow:rd}:null,r.memoizedState={dehydrated:s,treeContext:o,retryLane:1073741824},o=ko(18,null,null,0),o.stateNode=s,o.return=r,r.child=o,$a=r,Ja=null,!0):!1;default:return!1}}function VO(r){return(r.mode&1)!==0&&(r.flags&128)===0}function FO(r){if(ds){var s=Ja;if(s){var o=s;if(!zW(r,s)){if(VO(r))throw Error(nt(418));s=Cu(o.nextSibling);var d=$a;s&&zW(r,s)?JY(d,o):(r.flags=r.flags&-4097|2,ds=!1,$a=r)}}else{if(VO(r))throw Error(nt(418));r.flags=r.flags&-4097|2,ds=!1,$a=r}}}function qW(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;$a=r}function dT(r){if(r!==$a)return!1;if(!ds)return qW(r),ds=!0,!1;var s;if((s=r.tag!==3)&&!(s=r.tag!==5)&&(s=r.type,s=s!=="head"&&s!=="body"&&!LO(r.type,r.memoizedProps)),s&&(s=Ja)){if(VO(r))throw $Y(),Error(nt(418));for(;s;)JY(r,s),s=Cu(s.nextSibling)}if(qW(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(nt(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8){var o=r.data;if(o==="/$"){if(s===0){Ja=Cu(r.nextSibling);break e}s--}else o!=="$"&&o!=="$!"&&o!=="$?"||s++}r=r.nextSibling}Ja=null}}else Ja=$a?Cu(r.stateNode.nextSibling):null;return!0}function $Y(){for(var r=Ja;r;)r=Cu(r.nextSibling)}function cg(){Ja=$a=null,ds=!1}function fD(r){Ec===null?Ec=[r]:Ec.push(r)}var m0e=Ed.ReactCurrentBatchConfig;function _E(r,s,o){if(r=o.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(nt(309));var d=o.stateNode}if(!d)throw Error(nt(147,r));var p=d,f=""+r;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===f?s.ref:(s=function(E){var y=p.refs;E===null?delete y[f]:y[f]=E},s._stringRef=f,s)}if(typeof r!="string")throw Error(nt(284));if(!o._owner)throw Error(nt(290,r))}return r}function uT(r,s){throw r=Object.prototype.toString.call(s),Error(nt(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r))}function YW(r){var s=r._init;return s(r._payload)}function ZY(r){function s(H,V){if(r){var K=H.deletions;K===null?(H.deletions=[V],H.flags|=16):K.push(V)}}function o(H,V){if(!r)return null;for(;V!==null;)s(H,V),V=V.sibling;return null}function d(H,V){for(H=new Map;V!==null;)V.key!==null?H.set(V.key,V):H.set(V.index,V),V=V.sibling;return H}function p(H,V){return H=Iu(H,V),H.index=0,H.sibling=null,H}function f(H,V,K){return H.index=K,r?(K=H.alternate,K!==null?(K=K.index,K<V?(H.flags|=2,V):K):(H.flags|=2,V)):(H.flags|=1048576,V)}function E(H){return r&&H.alternate===null&&(H.flags|=2),H}function y(H,V,K,Z){return V===null||V.tag!==6?(V=FA(K,H.mode,Z),V.return=H,V):(V=p(V,K),V.return=H,V)}function b(H,V,K,Z){var ee=K.type;return ee===Ef?A(H,V,K.props.children,Z,K.key):V!==null&&(V.elementType===ee||typeof ee=="object"&&ee!==null&&ee.$$typeof===su&&YW(ee)===V.type)?(Z=p(V,K.props),Z.ref=_E(H,V,K),Z.return=H,Z):(Z=MT(K.type,K.key,K.props,null,H.mode,Z),Z.ref=_E(H,V,K),Z.return=H,Z)}function C(H,V,K,Z){return V===null||V.tag!==4||V.stateNode.containerInfo!==K.containerInfo||V.stateNode.implementation!==K.implementation?(V=BA(K,H.mode,Z),V.return=H,V):(V=p(V,K.children||[]),V.return=H,V)}function A(H,V,K,Z,ee){return V===null||V.tag!==7?(V=ap(K,H.mode,Z,ee),V.return=H,V):(V=p(V,K),V.return=H,V)}function D(H,V,K){if(typeof V=="string"&&V!==""||typeof V=="number")return V=FA(""+V,H.mode,K),V.return=H,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case eT:return K=MT(V.type,V.key,V.props,null,H.mode,K),K.ref=_E(H,null,V),K.return=H,K;case _f:return V=BA(V,H.mode,K),V.return=H,V;case su:var Z=V._init;return D(H,Z(V._payload),K)}if(NE(V)||hE(V))return V=ap(V,H.mode,K,null),V.return=H,V;uT(H,V)}return null}function k(H,V,K,Z){var ee=V!==null?V.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return ee!==null?null:y(H,V,""+K,Z);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case eT:return K.key===ee?b(H,V,K,Z):null;case _f:return K.key===ee?C(H,V,K,Z):null;case su:return ee=K._init,k(H,V,ee(K._payload),Z)}if(NE(K)||hE(K))return ee!==null?null:A(H,V,K,Z,null);uT(H,K)}return null}function W(H,V,K,Z,ee){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return H=H.get(K)||null,y(V,H,""+Z,ee);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case eT:return H=H.get(Z.key===null?K:Z.key)||null,b(V,H,Z,ee);case _f:return H=H.get(Z.key===null?K:Z.key)||null,C(V,H,Z,ee);case su:var $=Z._init;return W(H,V,K,$(Z._payload),ee)}if(NE(Z)||hE(Z))return H=H.get(K)||null,A(V,H,Z,ee,null);uT(V,Z)}return null}function G(H,V,K,Z){for(var ee=null,$=null,se=V,le=V=0,X=null;se!==null&&le<K.length;le++){se.index>le?(X=se,se=null):X=se.sibling;var oe=k(H,se,K[le],Z);if(oe===null){se===null&&(se=X);break}r&&se&&oe.alternate===null&&s(H,se),V=f(oe,V,le),$===null?ee=oe:$.sibling=oe,$=oe,se=X}if(le===K.length)return o(H,se),ds&&Gh(H,le),ee;if(se===null){for(;le<K.length;le++)se=D(H,K[le],Z),se!==null&&(V=f(se,V,le),$===null?ee=se:$.sibling=se,$=se);return ds&&Gh(H,le),ee}for(se=d(H,se);le<K.length;le++)X=W(se,H,le,K[le],Z),X!==null&&(r&&X.alternate!==null&&se.delete(X.key===null?le:X.key),V=f(X,V,le),$===null?ee=X:$.sibling=X,$=X);return r&&se.forEach(function(je){return s(H,je)}),ds&&Gh(H,le),ee}function L(H,V,K,Z){var ee=hE(K);if(typeof ee!="function")throw Error(nt(150));if(K=ee.call(K),K==null)throw Error(nt(151));for(var $=ee=null,se=V,le=V=0,X=null,oe=K.next();se!==null&&!oe.done;le++,oe=K.next()){se.index>le?(X=se,se=null):X=se.sibling;var je=k(H,se,oe.value,Z);if(je===null){se===null&&(se=X);break}r&&se&&je.alternate===null&&s(H,se),V=f(je,V,le),$===null?ee=je:$.sibling=je,$=je,se=X}if(oe.done)return o(H,se),ds&&Gh(H,le),ee;if(se===null){for(;!oe.done;le++,oe=K.next())oe=D(H,oe.value,Z),oe!==null&&(V=f(oe,V,le),$===null?ee=oe:$.sibling=oe,$=oe);return ds&&Gh(H,le),ee}for(se=d(H,se);!oe.done;le++,oe=K.next())oe=W(se,H,le,oe.value,Z),oe!==null&&(r&&oe.alternate!==null&&se.delete(oe.key===null?le:oe.key),V=f(oe,V,le),$===null?ee=oe:$.sibling=oe,$=oe);return r&&se.forEach(function(Ce){return s(H,Ce)}),ds&&Gh(H,le),ee}function B(H,V,K,Z){if(typeof K=="object"&&K!==null&&K.type===Ef&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case eT:e:{for(var ee=K.key,$=V;$!==null;){if($.key===ee){if(ee=K.type,ee===Ef){if($.tag===7){o(H,$.sibling),V=p($,K.props.children),V.return=H,H=V;break e}}else if($.elementType===ee||typeof ee=="object"&&ee!==null&&ee.$$typeof===su&&YW(ee)===$.type){o(H,$.sibling),V=p($,K.props),V.ref=_E(H,$,K),V.return=H,H=V;break e}o(H,$);break}else s(H,$);$=$.sibling}K.type===Ef?(V=ap(K.props.children,H.mode,Z,K.key),V.return=H,H=V):(Z=MT(K.type,K.key,K.props,null,H.mode,Z),Z.ref=_E(H,V,K),Z.return=H,H=Z)}return E(H);case _f:e:{for($=K.key;V!==null;){if(V.key===$)if(V.tag===4&&V.stateNode.containerInfo===K.containerInfo&&V.stateNode.implementation===K.implementation){o(H,V.sibling),V=p(V,K.children||[]),V.return=H,H=V;break e}else{o(H,V);break}else s(H,V);V=V.sibling}V=BA(K,H.mode,Z),V.return=H,H=V}return E(H);case su:return $=K._init,B(H,V,$(K._payload),Z)}if(NE(K))return G(H,V,K,Z);if(hE(K))return L(H,V,K,Z);uT(H,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,V!==null&&V.tag===6?(o(H,V.sibling),V=p(V,K),V.return=H,H=V):(o(H,V),V=FA(K,H.mode,Z),V.return=H,H=V),E(H)):o(H,V)}return B}var lg=ZY(!0),e7=ZY(!1),lb=Gu(null),db=null,Rf=null,gD=null;function _D(){gD=Rf=db=null}function ED(r){var s=lb.current;es(lb),r._currentValue=s}function BO(r,s,o){for(;r!==null;){var d=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),r===o)break;r=r.return}}function Lf(r,s){db=r,gD=Rf=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&s&&(Ia=!0),r.firstContext=null)}function jo(r){var s=r._currentValue;if(gD!==r)if(r={context:r,memoizedValue:s,next:null},Rf===null){if(db===null)throw Error(nt(308));Rf=r,db.dependencies={lanes:0,firstContext:r}}else Rf=Rf.next=r;return s}var Yh=null;function vD(r){Yh===null?Yh=[r]:Yh.push(r)}function t7(r,s,o,d){var p=s.interleaved;return p===null?(o.next=o,vD(s)):(o.next=p.next,p.next=o),s.interleaved=o,ud(r,d)}function ud(r,s){r.lanes|=s;var o=r.alternate;for(o!==null&&(o.lanes|=s),o=r,r=r.return;r!==null;)r.childLanes|=s,o=r.alternate,o!==null&&(o.childLanes|=s),o=r,r=r.return;return o.tag===3?o.stateNode:null}var iu=!1;function yD(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function n7(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function sd(r,s){return{eventTime:r,lane:s,tag:0,payload:null,callback:null,next:null}}function Ru(r,s,o){var d=r.updateQueue;if(d===null)return null;if(d=d.shared,pr&2){var p=d.pending;return p===null?s.next=s:(s.next=p.next,p.next=s),d.pending=s,ud(r,o)}return p=d.interleaved,p===null?(s.next=s,vD(d)):(s.next=p.next,p.next=s),d.interleaved=s,ud(r,o)}function OT(r,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194240)!==0)){var d=s.lanes;d&=r.pendingLanes,o|=d,s.lanes=o,iD(r,o)}}function XW(r,s){var o=r.updateQueue,d=r.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var p=null,f=null;if(o=o.firstBaseUpdate,o!==null){do{var E={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};f===null?p=f=E:f=f.next=E,o=o.next}while(o!==null);f===null?p=f=s:f=f.next=s}else p=f=s;o={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:f,shared:d.shared,effects:d.effects},r.updateQueue=o;return}r=o.lastBaseUpdate,r===null?o.firstBaseUpdate=s:r.next=s,o.lastBaseUpdate=s}function ub(r,s,o,d){var p=r.updateQueue;iu=!1;var f=p.firstBaseUpdate,E=p.lastBaseUpdate,y=p.shared.pending;if(y!==null){p.shared.pending=null;var b=y,C=b.next;b.next=null,E===null?f=C:E.next=C,E=b;var A=r.alternate;A!==null&&(A=A.updateQueue,y=A.lastBaseUpdate,y!==E&&(y===null?A.firstBaseUpdate=C:y.next=C,A.lastBaseUpdate=b))}if(f!==null){var D=p.baseState;E=0,A=C=b=null,y=f;do{var k=y.lane,W=y.eventTime;if((d&k)===k){A!==null&&(A=A.next={eventTime:W,lane:0,tag:y.tag,payload:y.payload,callback:y.callback,next:null});e:{var G=r,L=y;switch(k=s,W=o,L.tag){case 1:if(G=L.payload,typeof G=="function"){D=G.call(W,D,k);break e}D=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=L.payload,k=typeof G=="function"?G.call(W,D,k):G,k==null)break e;D=Cs({},D,k);break e;case 2:iu=!0}}y.callback!==null&&y.lane!==0&&(r.flags|=64,k=p.effects,k===null?p.effects=[y]:k.push(y))}else W={eventTime:W,lane:k,tag:y.tag,payload:y.payload,callback:y.callback,next:null},A===null?(C=A=W,b=D):A=A.next=W,E|=k;if(y=y.next,y===null){if(y=p.shared.pending,y===null)break;k=y,y=k.next,k.next=null,p.lastBaseUpdate=k,p.shared.pending=null}}while(!0);if(A===null&&(b=D),p.baseState=b,p.firstBaseUpdate=C,p.lastBaseUpdate=A,s=p.shared.interleaved,s!==null){p=s;do E|=p.lane,p=p.next;while(p!==s)}else f===null&&(p.shared.lanes=0);up|=E,r.lanes=E,r.memoizedState=D}}function QW(r,s,o){if(r=s.effects,s.effects=null,r!==null)for(s=0;s<r.length;s++){var d=r[s],p=d.callback;if(p!==null){if(d.callback=null,d=o,typeof p!="function")throw Error(nt(191,p));p.call(d)}}}var Vv={},El=Gu(Vv),iv=Gu(Vv),av=Gu(Vv);function Xh(r){if(r===Vv)throw Error(nt(174));return r}function SD(r,s){switch(Kr(av,s),Kr(iv,r),Kr(El,Vv),r=s.nodeType,r){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:SO(null,"");break;default:r=r===8?s.parentNode:s,s=r.namespaceURI||null,r=r.tagName,s=SO(s,r)}es(El),Kr(El,s)}function dg(){es(El),es(iv),es(av)}function r7(r){Xh(av.current);var s=Xh(El.current),o=SO(s,r.type);s!==o&&(Kr(iv,r),Kr(El,o))}function TD(r){iv.current===r&&(es(El),es(iv))}var bs=Gu(0);function hb(r){for(var s=r;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var kA=[];function bD(){for(var r=0;r<kA.length;r++)kA[r]._workInProgressVersionPrimary=null;kA.length=0}var PT=Ed.ReactCurrentDispatcher,LA=Ed.ReactCurrentBatchConfig,dp=0,ws=null,ei=null,mi=null,pb=!1,FE=!1,ov=0,f0e=0;function Vi(){throw Error(nt(321))}function wD(r,s){if(s===null)return!1;for(var o=0;o<s.length&&o<r.length;o++)if(!xc(r[o],s[o]))return!1;return!0}function CD(r,s,o,d,p,f){if(dp=f,ws=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,PT.current=r===null||r.memoizedState===null?v0e:y0e,r=o(d,p),FE){f=0;do{if(FE=!1,ov=0,25<=f)throw Error(nt(301));f+=1,mi=ei=null,s.updateQueue=null,PT.current=S0e,r=o(d,p)}while(FE)}if(PT.current=mb,s=ei!==null&&ei.next!==null,dp=0,mi=ei=ws=null,pb=!1,s)throw Error(nt(300));return r}function RD(){var r=ov!==0;return ov=0,r}function cl(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mi===null?ws.memoizedState=mi=r:mi=mi.next=r,mi}function Mo(){if(ei===null){var r=ws.alternate;r=r!==null?r.memoizedState:null}else r=ei.next;var s=mi===null?ws.memoizedState:mi.next;if(s!==null)mi=s,ei=r;else{if(r===null)throw Error(nt(310));ei=r,r={memoizedState:ei.memoizedState,baseState:ei.baseState,baseQueue:ei.baseQueue,queue:ei.queue,next:null},mi===null?ws.memoizedState=mi=r:mi=mi.next=r}return mi}function cv(r,s){return typeof s=="function"?s(r):s}function jA(r){var s=Mo(),o=s.queue;if(o===null)throw Error(nt(311));o.lastRenderedReducer=r;var d=ei,p=d.baseQueue,f=o.pending;if(f!==null){if(p!==null){var E=p.next;p.next=f.next,f.next=E}d.baseQueue=p=f,o.pending=null}if(p!==null){f=p.next,d=d.baseState;var y=E=null,b=null,C=f;do{var A=C.lane;if((dp&A)===A)b!==null&&(b=b.next={lane:0,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),d=C.hasEagerState?C.eagerState:r(d,C.action);else{var D={lane:A,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null};b===null?(y=b=D,E=d):b=b.next=D,ws.lanes|=A,up|=A}C=C.next}while(C!==null&&C!==f);b===null?E=d:b.next=y,xc(d,s.memoizedState)||(Ia=!0),s.memoizedState=d,s.baseState=E,s.baseQueue=b,o.lastRenderedState=d}if(r=o.interleaved,r!==null){p=r;do f=p.lane,ws.lanes|=f,up|=f,p=p.next;while(p!==r)}else p===null&&(o.lanes=0);return[s.memoizedState,o.dispatch]}function MA(r){var s=Mo(),o=s.queue;if(o===null)throw Error(nt(311));o.lastRenderedReducer=r;var d=o.dispatch,p=o.pending,f=s.memoizedState;if(p!==null){o.pending=null;var E=p=p.next;do f=r(f,E.action),E=E.next;while(E!==p);xc(f,s.memoizedState)||(Ia=!0),s.memoizedState=f,s.baseQueue===null&&(s.baseState=f),o.lastRenderedState=f}return[f,d]}function s7(){}function i7(r,s){var o=ws,d=Mo(),p=s(),f=!xc(d.memoizedState,p);if(f&&(d.memoizedState=p,Ia=!0),d=d.queue,xD(c7.bind(null,o,d,r),[r]),d.getSnapshot!==s||f||mi!==null&&mi.memoizedState.tag&1){if(o.flags|=2048,lv(9,o7.bind(null,o,d,p,s),void 0,null),fi===null)throw Error(nt(349));dp&30||a7(o,s,p)}return p}function a7(r,s,o){r.flags|=16384,r={getSnapshot:s,value:o},s=ws.updateQueue,s===null?(s={lastEffect:null,stores:null},ws.updateQueue=s,s.stores=[r]):(o=s.stores,o===null?s.stores=[r]:o.push(r))}function o7(r,s,o,d){s.value=o,s.getSnapshot=d,l7(s)&&d7(r)}function c7(r,s,o){return o(function(){l7(s)&&d7(r)})}function l7(r){var s=r.getSnapshot;r=r.value;try{var o=s();return!xc(r,o)}catch{return!0}}function d7(r){var s=ud(r,1);s!==null&&Cc(s,r,1,-1)}function JW(r){var s=cl();return typeof r=="function"&&(r=r()),s.memoizedState=s.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cv,lastRenderedState:r},s.queue=r,r=r.dispatch=E0e.bind(null,ws,r),[s.memoizedState,r]}function lv(r,s,o,d){return r={tag:r,create:s,destroy:o,deps:d,next:null},s=ws.updateQueue,s===null?(s={lastEffect:null,stores:null},ws.updateQueue=s,s.lastEffect=r.next=r):(o=s.lastEffect,o===null?s.lastEffect=r.next=r:(d=o.next,o.next=r,r.next=d,s.lastEffect=r)),r}function u7(){return Mo().memoizedState}function DT(r,s,o,d){var p=cl();ws.flags|=r,p.memoizedState=lv(1|s,o,void 0,d===void 0?null:d)}function tw(r,s,o,d){var p=Mo();d=d===void 0?null:d;var f=void 0;if(ei!==null){var E=ei.memoizedState;if(f=E.destroy,d!==null&&wD(d,E.deps)){p.memoizedState=lv(s,o,f,d);return}}ws.flags|=r,p.memoizedState=lv(1|s,o,f,d)}function $W(r,s){return DT(8390656,8,r,s)}function xD(r,s){return tw(2048,8,r,s)}function h7(r,s){return tw(4,2,r,s)}function p7(r,s){return tw(4,4,r,s)}function m7(r,s){if(typeof s=="function")return r=r(),s(r),function(){s(null)};if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function f7(r,s,o){return o=o!=null?o.concat([r]):null,tw(4,4,m7.bind(null,s,r),o)}function ND(){}function g7(r,s){var o=Mo();s=s===void 0?null:s;var d=o.memoizedState;return d!==null&&s!==null&&wD(s,d[1])?d[0]:(o.memoizedState=[r,s],r)}function _7(r,s){var o=Mo();s=s===void 0?null:s;var d=o.memoizedState;return d!==null&&s!==null&&wD(s,d[1])?d[0]:(r=r(),o.memoizedState=[r,s],r)}function E7(r,s,o){return dp&21?(xc(o,s)||(o=bY(),ws.lanes|=o,up|=o,r.baseState=!0),s):(r.baseState&&(r.baseState=!1,Ia=!0),r.memoizedState=o)}function g0e(r,s){var o=Ir;Ir=o!==0&&4>o?o:4,r(!0);var d=LA.transition;LA.transition={};try{r(!1),s()}finally{Ir=o,LA.transition=d}}function v7(){return Mo().memoizedState}function _0e(r,s,o){var d=Nu(r);if(o={lane:d,action:o,hasEagerState:!1,eagerState:null,next:null},y7(r))S7(s,o);else if(o=t7(r,s,o,d),o!==null){var p=aa();Cc(o,r,d,p),T7(o,s,d)}}function E0e(r,s,o){var d=Nu(r),p={lane:d,action:o,hasEagerState:!1,eagerState:null,next:null};if(y7(r))S7(s,p);else{var f=r.alternate;if(r.lanes===0&&(f===null||f.lanes===0)&&(f=s.lastRenderedReducer,f!==null))try{var E=s.lastRenderedState,y=f(E,o);if(p.hasEagerState=!0,p.eagerState=y,xc(y,E)){var b=s.interleaved;b===null?(p.next=p,vD(s)):(p.next=b.next,b.next=p),s.interleaved=p;return}}catch{}finally{}o=t7(r,s,p,d),o!==null&&(p=aa(),Cc(o,r,d,p),T7(o,s,d))}}function y7(r){var s=r.alternate;return r===ws||s!==null&&s===ws}function S7(r,s){FE=pb=!0;var o=r.pending;o===null?s.next=s:(s.next=o.next,o.next=s),r.pending=s}function T7(r,s,o){if(o&4194240){var d=s.lanes;d&=r.pendingLanes,o|=d,s.lanes=o,iD(r,o)}}var mb={readContext:jo,useCallback:Vi,useContext:Vi,useEffect:Vi,useImperativeHandle:Vi,useInsertionEffect:Vi,useLayoutEffect:Vi,useMemo:Vi,useReducer:Vi,useRef:Vi,useState:Vi,useDebugValue:Vi,useDeferredValue:Vi,useTransition:Vi,useMutableSource:Vi,useSyncExternalStore:Vi,useId:Vi,unstable_isNewReconciler:!1},v0e={readContext:jo,useCallback:function(r,s){return cl().memoizedState=[r,s===void 0?null:s],r},useContext:jo,useEffect:$W,useImperativeHandle:function(r,s,o){return o=o!=null?o.concat([r]):null,DT(4194308,4,m7.bind(null,s,r),o)},useLayoutEffect:function(r,s){return DT(4194308,4,r,s)},useInsertionEffect:function(r,s){return DT(4,2,r,s)},useMemo:function(r,s){var o=cl();return s=s===void 0?null:s,r=r(),o.memoizedState=[r,s],r},useReducer:function(r,s,o){var d=cl();return s=o!==void 0?o(s):s,d.memoizedState=d.baseState=s,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:s},d.queue=r,r=r.dispatch=_0e.bind(null,ws,r),[d.memoizedState,r]},useRef:function(r){var s=cl();return r={current:r},s.memoizedState=r},useState:JW,useDebugValue:ND,useDeferredValue:function(r){return cl().memoizedState=r},useTransition:function(){var r=JW(!1),s=r[0];return r=g0e.bind(null,r[1]),cl().memoizedState=r,[s,r]},useMutableSource:function(){},useSyncExternalStore:function(r,s,o){var d=ws,p=cl();if(ds){if(o===void 0)throw Error(nt(407));o=o()}else{if(o=s(),fi===null)throw Error(nt(349));dp&30||a7(d,s,o)}p.memoizedState=o;var f={value:o,getSnapshot:s};return p.queue=f,$W(c7.bind(null,d,f,r),[r]),d.flags|=2048,lv(9,o7.bind(null,d,f,o,s),void 0,null),o},useId:function(){var r=cl(),s=fi.identifierPrefix;if(ds){var o=rd,d=nd;o=(d&~(1<<32-wc(d)-1)).toString(32)+o,s=":"+s+"R"+o,o=ov++,0<o&&(s+="H"+o.toString(32)),s+=":"}else o=f0e++,s=":"+s+"r"+o.toString(32)+":";return r.memoizedState=s},unstable_isNewReconciler:!1},y0e={readContext:jo,useCallback:g7,useContext:jo,useEffect:xD,useImperativeHandle:f7,useInsertionEffect:h7,useLayoutEffect:p7,useMemo:_7,useReducer:jA,useRef:u7,useState:function(){return jA(cv)},useDebugValue:ND,useDeferredValue:function(r){var s=Mo();return E7(s,ei.memoizedState,r)},useTransition:function(){var r=jA(cv)[0],s=Mo().memoizedState;return[r,s]},useMutableSource:s7,useSyncExternalStore:i7,useId:v7,unstable_isNewReconciler:!1},S0e={readContext:jo,useCallback:g7,useContext:jo,useEffect:xD,useImperativeHandle:f7,useInsertionEffect:h7,useLayoutEffect:p7,useMemo:_7,useReducer:MA,useRef:u7,useState:function(){return MA(cv)},useDebugValue:ND,useDeferredValue:function(r){var s=Mo();return ei===null?s.memoizedState=r:E7(s,ei.memoizedState,r)},useTransition:function(){var r=MA(cv)[0],s=Mo().memoizedState;return[r,s]},useMutableSource:s7,useSyncExternalStore:i7,useId:v7,unstable_isNewReconciler:!1};function mc(r,s){if(r&&r.defaultProps){s=Cs({},s),r=r.defaultProps;for(var o in r)s[o]===void 0&&(s[o]=r[o]);return s}return s}function GO(r,s,o,d){s=r.memoizedState,o=o(d,s),o=o==null?s:Cs({},s,o),r.memoizedState=o,r.lanes===0&&(r.updateQueue.baseState=o)}var nw={isMounted:function(r){return(r=r._reactInternals)?Ap(r)===r:!1},enqueueSetState:function(r,s,o){r=r._reactInternals;var d=aa(),p=Nu(r),f=sd(d,p);f.payload=s,o!=null&&(f.callback=o),s=Ru(r,f,p),s!==null&&(Cc(s,r,p,d),OT(s,r,p))},enqueueReplaceState:function(r,s,o){r=r._reactInternals;var d=aa(),p=Nu(r),f=sd(d,p);f.tag=1,f.payload=s,o!=null&&(f.callback=o),s=Ru(r,f,p),s!==null&&(Cc(s,r,p,d),OT(s,r,p))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var o=aa(),d=Nu(r),p=sd(o,d);p.tag=2,s!=null&&(p.callback=s),s=Ru(r,p,d),s!==null&&(Cc(s,r,d,o),OT(s,r,d))}};function ZW(r,s,o,d,p,f,E){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(d,f,E):s.prototype&&s.prototype.isPureReactComponent?!tv(o,d)||!tv(p,f):!0}function b7(r,s,o){var d=!1,p=Pu,f=s.contextType;return typeof f=="object"&&f!==null?f=jo(f):(p=Oa(s)?cp:Hi.current,d=s.contextTypes,f=(d=d!=null)?og(r,p):Pu),s=new s(o,f),r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=nw,r.stateNode=s,s._reactInternals=r,d&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=p,r.__reactInternalMemoizedMaskedChildContext=f),s}function e8(r,s,o,d){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,d),s.state!==r&&nw.enqueueReplaceState(s,s.state,null)}function WO(r,s,o,d){var p=r.stateNode;p.props=o,p.state=r.memoizedState,p.refs={},yD(r);var f=s.contextType;typeof f=="object"&&f!==null?p.context=jo(f):(f=Oa(s)?cp:Hi.current,p.context=og(r,f)),p.state=r.memoizedState,f=s.getDerivedStateFromProps,typeof f=="function"&&(GO(r,s,f,o),p.state=r.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(s=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),s!==p.state&&nw.enqueueReplaceState(p,p.state,null),ub(r,o,p,d),p.state=r.memoizedState),typeof p.componentDidMount=="function"&&(r.flags|=4194308)}function ug(r,s){try{var o="",d=s;do o+=Xye(d),d=d.return;while(d);var p=o}catch(f){p=`
Error generating stack: `+f.message+`
`+f.stack}return{value:r,source:s,stack:p,digest:null}}function UA(r,s,o){return{value:r,source:null,stack:o??null,digest:s??null}}function HO(r,s){try{console.error(s.value)}catch(o){setTimeout(function(){throw o})}}var T0e=typeof WeakMap=="function"?WeakMap:Map;function w7(r,s,o){o=sd(-1,o),o.tag=3,o.payload={element:null};var d=s.value;return o.callback=function(){gb||(gb=!0,eP=d),HO(r,s)},o}function C7(r,s,o){o=sd(-1,o),o.tag=3;var d=r.type.getDerivedStateFromError;if(typeof d=="function"){var p=s.value;o.payload=function(){return d(p)},o.callback=function(){HO(r,s)}}var f=r.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(o.callback=function(){HO(r,s),typeof d!="function"&&(xu===null?xu=new Set([this]):xu.add(this));var E=s.stack;this.componentDidCatch(s.value,{componentStack:E!==null?E:""})}),o}function t8(r,s,o){var d=r.pingCache;if(d===null){d=r.pingCache=new T0e;var p=new Set;d.set(s,p)}else p=d.get(s),p===void 0&&(p=new Set,d.set(s,p));p.has(o)||(p.add(o),r=j0e.bind(null,r,s,o),s.then(r,r))}function n8(r){do{var s;if((s=r.tag===13)&&(s=r.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return r;r=r.return}while(r!==null);return null}function r8(r,s,o,d,p){return r.mode&1?(r.flags|=65536,r.lanes=p,r):(r===s?r.flags|=65536:(r.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(s=sd(-1,1),s.tag=2,Ru(o,s,1))),o.lanes|=1),r)}var b0e=Ed.ReactCurrentOwner,Ia=!1;function ra(r,s,o,d){s.child=r===null?e7(s,null,o,d):lg(s,r.child,o,d)}function s8(r,s,o,d,p){o=o.render;var f=s.ref;return Lf(s,p),d=CD(r,s,o,d,f,p),o=RD(),r!==null&&!Ia?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~p,hd(r,s,p)):(ds&&o&&pD(s),s.flags|=1,ra(r,s,d,p),s.child)}function i8(r,s,o,d,p){if(r===null){var f=o.type;return typeof f=="function"&&!jD(f)&&f.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(s.tag=15,s.type=f,R7(r,s,f,d,p)):(r=MT(o.type,null,d,s,s.mode,p),r.ref=s.ref,r.return=s,s.child=r)}if(f=r.child,!(r.lanes&p)){var E=f.memoizedProps;if(o=o.compare,o=o!==null?o:tv,o(E,d)&&r.ref===s.ref)return hd(r,s,p)}return s.flags|=1,r=Iu(f,d),r.ref=s.ref,r.return=s,s.child=r}function R7(r,s,o,d,p){if(r!==null){var f=r.memoizedProps;if(tv(f,d)&&r.ref===s.ref)if(Ia=!1,s.pendingProps=d=f,(r.lanes&p)!==0)r.flags&131072&&(Ia=!0);else return s.lanes=r.lanes,hd(r,s,p)}return KO(r,s,o,d,p)}function x7(r,s,o){var d=s.pendingProps,p=d.children,f=r!==null?r.memoizedState:null;if(d.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kr(Nf,qa),qa|=o;else{if(!(o&1073741824))return r=f!==null?f.baseLanes|o:o,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:r,cachePool:null,transitions:null},s.updateQueue=null,Kr(Nf,qa),qa|=r,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=f!==null?f.baseLanes:o,Kr(Nf,qa),qa|=d}else f!==null?(d=f.baseLanes|o,s.memoizedState=null):d=o,Kr(Nf,qa),qa|=d;return ra(r,s,p,o),s.child}function N7(r,s){var o=s.ref;(r===null&&o!==null||r!==null&&r.ref!==o)&&(s.flags|=512,s.flags|=2097152)}function KO(r,s,o,d,p){var f=Oa(o)?cp:Hi.current;return f=og(s,f),Lf(s,p),o=CD(r,s,o,d,f,p),d=RD(),r!==null&&!Ia?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~p,hd(r,s,p)):(ds&&d&&pD(s),s.flags|=1,ra(r,s,o,p),s.child)}function a8(r,s,o,d,p){if(Oa(o)){var f=!0;ab(s)}else f=!1;if(Lf(s,p),s.stateNode===null)kT(r,s),b7(s,o,d),WO(s,o,d,p),d=!0;else if(r===null){var E=s.stateNode,y=s.memoizedProps;E.props=y;var b=E.context,C=o.contextType;typeof C=="object"&&C!==null?C=jo(C):(C=Oa(o)?cp:Hi.current,C=og(s,C));var A=o.getDerivedStateFromProps,D=typeof A=="function"||typeof E.getSnapshotBeforeUpdate=="function";D||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(y!==d||b!==C)&&e8(s,E,d,C),iu=!1;var k=s.memoizedState;E.state=k,ub(s,d,E,p),b=s.memoizedState,y!==d||k!==b||Aa.current||iu?(typeof A=="function"&&(GO(s,o,A,d),b=s.memoizedState),(y=iu||ZW(s,o,y,d,k,b,C))?(D||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(s.flags|=4194308)):(typeof E.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=b),E.props=d,E.state=b,E.context=C,d=y):(typeof E.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{E=s.stateNode,n7(r,s),y=s.memoizedProps,C=s.type===s.elementType?y:mc(s.type,y),E.props=C,D=s.pendingProps,k=E.context,b=o.contextType,typeof b=="object"&&b!==null?b=jo(b):(b=Oa(o)?cp:Hi.current,b=og(s,b));var W=o.getDerivedStateFromProps;(A=typeof W=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(y!==D||k!==b)&&e8(s,E,d,b),iu=!1,k=s.memoizedState,E.state=k,ub(s,d,E,p);var G=s.memoizedState;y!==D||k!==G||Aa.current||iu?(typeof W=="function"&&(GO(s,o,W,d),G=s.memoizedState),(C=iu||ZW(s,o,C,d,k,G,b)||!1)?(A||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(d,G,b),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(d,G,b)),typeof E.componentDidUpdate=="function"&&(s.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof E.componentDidUpdate!="function"||y===r.memoizedProps&&k===r.memoizedState||(s.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||y===r.memoizedProps&&k===r.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=G),E.props=d,E.state=G,E.context=b,d=C):(typeof E.componentDidUpdate!="function"||y===r.memoizedProps&&k===r.memoizedState||(s.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||y===r.memoizedProps&&k===r.memoizedState||(s.flags|=1024),d=!1)}return zO(r,s,o,d,f,p)}function zO(r,s,o,d,p,f){N7(r,s);var E=(s.flags&128)!==0;if(!d&&!E)return p&&KW(s,o,!1),hd(r,s,f);d=s.stateNode,b0e.current=s;var y=E&&typeof o.getDerivedStateFromError!="function"?null:d.render();return s.flags|=1,r!==null&&E?(s.child=lg(s,r.child,null,f),s.child=lg(s,null,y,f)):ra(r,s,y,f),s.memoizedState=d.state,p&&KW(s,o,!0),s.child}function I7(r){var s=r.stateNode;s.pendingContext?HW(r,s.pendingContext,s.pendingContext!==s.context):s.context&&HW(r,s.context,!1),SD(r,s.containerInfo)}function o8(r,s,o,d,p){return cg(),fD(p),s.flags|=256,ra(r,s,o,d),s.child}var qO={dehydrated:null,treeContext:null,retryLane:0};function YO(r){return{baseLanes:r,cachePool:null,transitions:null}}function A7(r,s,o){var d=s.pendingProps,p=bs.current,f=!1,E=(s.flags&128)!==0,y;if((y=E)||(y=r!==null&&r.memoizedState===null?!1:(p&2)!==0),y?(f=!0,s.flags&=-129):(r===null||r.memoizedState!==null)&&(p|=1),Kr(bs,p&1),r===null)return FO(s),r=s.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(s.mode&1?r.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(E=d.children,r=d.fallback,f?(d=s.mode,f=s.child,E={mode:"hidden",children:E},!(d&1)&&f!==null?(f.childLanes=0,f.pendingProps=E):f=iw(E,d,0,null),r=ap(r,d,o,null),f.return=s,r.return=s,f.sibling=r,s.child=f,s.child.memoizedState=YO(o),s.memoizedState=qO,r):ID(s,E));if(p=r.memoizedState,p!==null&&(y=p.dehydrated,y!==null))return w0e(r,s,E,d,y,p,o);if(f){f=d.fallback,E=s.mode,p=r.child,y=p.sibling;var b={mode:"hidden",children:d.children};return!(E&1)&&s.child!==p?(d=s.child,d.childLanes=0,d.pendingProps=b,s.deletions=null):(d=Iu(p,b),d.subtreeFlags=p.subtreeFlags&14680064),y!==null?f=Iu(y,f):(f=ap(f,E,o,null),f.flags|=2),f.return=s,d.return=s,d.sibling=f,s.child=d,d=f,f=s.child,E=r.child.memoizedState,E=E===null?YO(o):{baseLanes:E.baseLanes|o,cachePool:null,transitions:E.transitions},f.memoizedState=E,f.childLanes=r.childLanes&~o,s.memoizedState=qO,d}return f=r.child,r=f.sibling,d=Iu(f,{mode:"visible",children:d.children}),!(s.mode&1)&&(d.lanes=o),d.return=s,d.sibling=null,r!==null&&(o=s.deletions,o===null?(s.deletions=[r],s.flags|=16):o.push(r)),s.child=d,s.memoizedState=null,d}function ID(r,s){return s=iw({mode:"visible",children:s},r.mode,0,null),s.return=r,r.child=s}function hT(r,s,o,d){return d!==null&&fD(d),lg(s,r.child,null,o),r=ID(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function w0e(r,s,o,d,p,f,E){if(o)return s.flags&256?(s.flags&=-257,d=UA(Error(nt(422))),hT(r,s,E,d)):s.memoizedState!==null?(s.child=r.child,s.flags|=128,null):(f=d.fallback,p=s.mode,d=iw({mode:"visible",children:d.children},p,0,null),f=ap(f,p,E,null),f.flags|=2,d.return=s,f.return=s,d.sibling=f,s.child=d,s.mode&1&&lg(s,r.child,null,E),s.child.memoizedState=YO(E),s.memoizedState=qO,f);if(!(s.mode&1))return hT(r,s,E,null);if(p.data==="$!"){if(d=p.nextSibling&&p.nextSibling.dataset,d)var y=d.dgst;return d=y,f=Error(nt(419)),d=UA(f,d,void 0),hT(r,s,E,d)}if(y=(E&r.childLanes)!==0,Ia||y){if(d=fi,d!==null){switch(E&-E){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=p&(d.suspendedLanes|E)?0:p,p!==0&&p!==f.retryLane&&(f.retryLane=p,ud(r,p),Cc(d,r,p,-1))}return LD(),d=UA(Error(nt(421))),hT(r,s,E,d)}return p.data==="$?"?(s.flags|=128,s.child=r.child,s=M0e.bind(null,r),p._reactRetry=s,null):(r=f.treeContext,Ja=Cu(p.nextSibling),$a=s,ds=!0,Ec=null,r!==null&&(Po[Do++]=nd,Po[Do++]=rd,Po[Do++]=lp,nd=r.id,rd=r.overflow,lp=s),s=ID(s,d.children),s.flags|=4096,s)}function c8(r,s,o){r.lanes|=s;var d=r.alternate;d!==null&&(d.lanes|=s),BO(r.return,s,o)}function VA(r,s,o,d,p){var f=r.memoizedState;f===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:p}:(f.isBackwards=s,f.rendering=null,f.renderingStartTime=0,f.last=d,f.tail=o,f.tailMode=p)}function O7(r,s,o){var d=s.pendingProps,p=d.revealOrder,f=d.tail;if(ra(r,s,d.children,o),d=bs.current,d&2)d=d&1|2,s.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&c8(r,o,s);else if(r.tag===19)c8(r,o,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}d&=1}if(Kr(bs,d),!(s.mode&1))s.memoizedState=null;else switch(p){case"forwards":for(o=s.child,p=null;o!==null;)r=o.alternate,r!==null&&hb(r)===null&&(p=o),o=o.sibling;o=p,o===null?(p=s.child,s.child=null):(p=o.sibling,o.sibling=null),VA(s,!1,p,o,f);break;case"backwards":for(o=null,p=s.child,s.child=null;p!==null;){if(r=p.alternate,r!==null&&hb(r)===null){s.child=p;break}r=p.sibling,p.sibling=o,o=p,p=r}VA(s,!0,o,null,f);break;case"together":VA(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function kT(r,s){!(s.mode&1)&&r!==null&&(r.alternate=null,s.alternate=null,s.flags|=2)}function hd(r,s,o){if(r!==null&&(s.dependencies=r.dependencies),up|=s.lanes,!(o&s.childLanes))return null;if(r!==null&&s.child!==r.child)throw Error(nt(153));if(s.child!==null){for(r=s.child,o=Iu(r,r.pendingProps),s.child=o,o.return=s;r.sibling!==null;)r=r.sibling,o=o.sibling=Iu(r,r.pendingProps),o.return=s;o.sibling=null}return s.child}function C0e(r,s,o){switch(s.tag){case 3:I7(s),cg();break;case 5:r7(s);break;case 1:Oa(s.type)&&ab(s);break;case 4:SD(s,s.stateNode.containerInfo);break;case 10:var d=s.type._context,p=s.memoizedProps.value;Kr(lb,d._currentValue),d._currentValue=p;break;case 13:if(d=s.memoizedState,d!==null)return d.dehydrated!==null?(Kr(bs,bs.current&1),s.flags|=128,null):o&s.child.childLanes?A7(r,s,o):(Kr(bs,bs.current&1),r=hd(r,s,o),r!==null?r.sibling:null);Kr(bs,bs.current&1);break;case 19:if(d=(o&s.childLanes)!==0,r.flags&128){if(d)return O7(r,s,o);s.flags|=128}if(p=s.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Kr(bs,bs.current),d)break;return null;case 22:case 23:return s.lanes=0,x7(r,s,o)}return hd(r,s,o)}var P7,XO,D7,k7;P7=function(r,s){for(var o=s.child;o!==null;){if(o.tag===5||o.tag===6)r.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};XO=function(){};D7=function(r,s,o,d){var p=r.memoizedProps;if(p!==d){r=s.stateNode,Xh(El.current);var f=null;switch(o){case"input":p=_O(r,p),d=_O(r,d),f=[];break;case"select":p=Cs({},p,{value:void 0}),d=Cs({},d,{value:void 0}),f=[];break;case"textarea":p=yO(r,p),d=yO(r,d),f=[];break;default:typeof p.onClick!="function"&&typeof d.onClick=="function"&&(r.onclick=sb)}TO(o,d);var E;o=null;for(C in p)if(!d.hasOwnProperty(C)&&p.hasOwnProperty(C)&&p[C]!=null)if(C==="style"){var y=p[C];for(E in y)y.hasOwnProperty(E)&&(o||(o={}),o[E]="")}else C!=="dangerouslySetInnerHTML"&&C!=="children"&&C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(YE.hasOwnProperty(C)?f||(f=[]):(f=f||[]).push(C,null));for(C in d){var b=d[C];if(y=p!=null?p[C]:void 0,d.hasOwnProperty(C)&&b!==y&&(b!=null||y!=null))if(C==="style")if(y){for(E in y)!y.hasOwnProperty(E)||b&&b.hasOwnProperty(E)||(o||(o={}),o[E]="");for(E in b)b.hasOwnProperty(E)&&y[E]!==b[E]&&(o||(o={}),o[E]=b[E])}else o||(f||(f=[]),f.push(C,o)),o=b;else C==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,y=y?y.__html:void 0,b!=null&&y!==b&&(f=f||[]).push(C,b)):C==="children"?typeof b!="string"&&typeof b!="number"||(f=f||[]).push(C,""+b):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&(YE.hasOwnProperty(C)?(b!=null&&C==="onScroll"&&Zr("scroll",r),f||y===b||(f=[])):(f=f||[]).push(C,b))}o&&(f=f||[]).push("style",o);var C=f;(s.updateQueue=C)&&(s.flags|=4)}};k7=function(r,s,o,d){o!==d&&(s.flags|=4)};function EE(r,s){if(!ds)switch(r.tailMode){case"hidden":s=r.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?r.tail=null:o.sibling=null;break;case"collapsed":o=r.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:d.sibling=null}}function Fi(r){var s=r.alternate!==null&&r.alternate.child===r.child,o=0,d=0;if(s)for(var p=r.child;p!==null;)o|=p.lanes|p.childLanes,d|=p.subtreeFlags&14680064,d|=p.flags&14680064,p.return=r,p=p.sibling;else for(p=r.child;p!==null;)o|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=r,p=p.sibling;return r.subtreeFlags|=d,r.childLanes=o,s}function R0e(r,s,o){var d=s.pendingProps;switch(mD(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fi(s),null;case 1:return Oa(s.type)&&ib(),Fi(s),null;case 3:return d=s.stateNode,dg(),es(Aa),es(Hi),bD(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(dT(s)?s.flags|=4:r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Ec!==null&&(rP(Ec),Ec=null))),XO(r,s),Fi(s),null;case 5:TD(s);var p=Xh(av.current);if(o=s.type,r!==null&&s.stateNode!=null)D7(r,s,o,d,p),r.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!d){if(s.stateNode===null)throw Error(nt(166));return Fi(s),null}if(r=Xh(El.current),dT(s)){d=s.stateNode,o=s.type;var f=s.memoizedProps;switch(d[pl]=s,d[sv]=f,r=(s.mode&1)!==0,o){case"dialog":Zr("cancel",d),Zr("close",d);break;case"iframe":case"object":case"embed":Zr("load",d);break;case"video":case"audio":for(p=0;p<AE.length;p++)Zr(AE[p],d);break;case"source":Zr("error",d);break;case"img":case"image":case"link":Zr("error",d),Zr("load",d);break;case"details":Zr("toggle",d);break;case"input":_W(d,f),Zr("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!f.multiple},Zr("invalid",d);break;case"textarea":vW(d,f),Zr("invalid",d)}TO(o,f),p=null;for(var E in f)if(f.hasOwnProperty(E)){var y=f[E];E==="children"?typeof y=="string"?d.textContent!==y&&(f.suppressHydrationWarning!==!0&&lT(d.textContent,y,r),p=["children",y]):typeof y=="number"&&d.textContent!==""+y&&(f.suppressHydrationWarning!==!0&&lT(d.textContent,y,r),p=["children",""+y]):YE.hasOwnProperty(E)&&y!=null&&E==="onScroll"&&Zr("scroll",d)}switch(o){case"input":tT(d),EW(d,f,!0);break;case"textarea":tT(d),yW(d);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(d.onclick=sb)}d=p,s.updateQueue=d,d!==null&&(s.flags|=4)}else{E=p.nodeType===9?p:p.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=cY(o)),r==="http://www.w3.org/1999/xhtml"?o==="script"?(r=E.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof d.is=="string"?r=E.createElement(o,{is:d.is}):(r=E.createElement(o),o==="select"&&(E=r,d.multiple?E.multiple=!0:d.size&&(E.size=d.size))):r=E.createElementNS(r,o),r[pl]=s,r[sv]=d,P7(r,s,!1,!1),s.stateNode=r;e:{switch(E=bO(o,d),o){case"dialog":Zr("cancel",r),Zr("close",r),p=d;break;case"iframe":case"object":case"embed":Zr("load",r),p=d;break;case"video":case"audio":for(p=0;p<AE.length;p++)Zr(AE[p],r);p=d;break;case"source":Zr("error",r),p=d;break;case"img":case"image":case"link":Zr("error",r),Zr("load",r),p=d;break;case"details":Zr("toggle",r),p=d;break;case"input":_W(r,d),p=_O(r,d),Zr("invalid",r);break;case"option":p=d;break;case"select":r._wrapperState={wasMultiple:!!d.multiple},p=Cs({},d,{value:void 0}),Zr("invalid",r);break;case"textarea":vW(r,d),p=yO(r,d),Zr("invalid",r);break;default:p=d}TO(o,p),y=p;for(f in y)if(y.hasOwnProperty(f)){var b=y[f];f==="style"?uY(r,b):f==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&lY(r,b)):f==="children"?typeof b=="string"?(o!=="textarea"||b!=="")&&XE(r,b):typeof b=="number"&&XE(r,""+b):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(YE.hasOwnProperty(f)?b!=null&&f==="onScroll"&&Zr("scroll",r):b!=null&&ZP(r,f,b,E))}switch(o){case"input":tT(r),EW(r,d,!1);break;case"textarea":tT(r),yW(r);break;case"option":d.value!=null&&r.setAttribute("value",""+Ou(d.value));break;case"select":r.multiple=!!d.multiple,f=d.value,f!=null?Of(r,!!d.multiple,f,!1):d.defaultValue!=null&&Of(r,!!d.multiple,d.defaultValue,!0);break;default:typeof p.onClick=="function"&&(r.onclick=sb)}switch(o){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Fi(s),null;case 6:if(r&&s.stateNode!=null)k7(r,s,r.memoizedProps,d);else{if(typeof d!="string"&&s.stateNode===null)throw Error(nt(166));if(o=Xh(av.current),Xh(El.current),dT(s)){if(d=s.stateNode,o=s.memoizedProps,d[pl]=s,(f=d.nodeValue!==o)&&(r=$a,r!==null))switch(r.tag){case 3:lT(d.nodeValue,o,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&lT(d.nodeValue,o,(r.mode&1)!==0)}f&&(s.flags|=4)}else d=(o.nodeType===9?o:o.ownerDocument).createTextNode(d),d[pl]=s,s.stateNode=d}return Fi(s),null;case 13:if(es(bs),d=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(ds&&Ja!==null&&s.mode&1&&!(s.flags&128))$Y(),cg(),s.flags|=98560,f=!1;else if(f=dT(s),d!==null&&d.dehydrated!==null){if(r===null){if(!f)throw Error(nt(318));if(f=s.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(nt(317));f[pl]=s}else cg(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Fi(s),f=!1}else Ec!==null&&(rP(Ec),Ec=null),f=!0;if(!f)return s.flags&65536?s:null}return s.flags&128?(s.lanes=o,s):(d=d!==null,d!==(r!==null&&r.memoizedState!==null)&&d&&(s.child.flags|=8192,s.mode&1&&(r===null||bs.current&1?ri===0&&(ri=3):LD())),s.updateQueue!==null&&(s.flags|=4),Fi(s),null);case 4:return dg(),XO(r,s),r===null&&nv(s.stateNode.containerInfo),Fi(s),null;case 10:return ED(s.type._context),Fi(s),null;case 17:return Oa(s.type)&&ib(),Fi(s),null;case 19:if(es(bs),f=s.memoizedState,f===null)return Fi(s),null;if(d=(s.flags&128)!==0,E=f.rendering,E===null)if(d)EE(f,!1);else{if(ri!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(E=hb(r),E!==null){for(s.flags|=128,EE(f,!1),d=E.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),s.subtreeFlags=0,d=o,o=s.child;o!==null;)f=o,r=d,f.flags&=14680066,E=f.alternate,E===null?(f.childLanes=0,f.lanes=r,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=E.childLanes,f.lanes=E.lanes,f.child=E.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=E.memoizedProps,f.memoizedState=E.memoizedState,f.updateQueue=E.updateQueue,f.type=E.type,r=E.dependencies,f.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),o=o.sibling;return Kr(bs,bs.current&1|2),s.child}r=r.sibling}f.tail!==null&&Us()>hg&&(s.flags|=128,d=!0,EE(f,!1),s.lanes=4194304)}else{if(!d)if(r=hb(E),r!==null){if(s.flags|=128,d=!0,o=r.updateQueue,o!==null&&(s.updateQueue=o,s.flags|=4),EE(f,!0),f.tail===null&&f.tailMode==="hidden"&&!E.alternate&&!ds)return Fi(s),null}else 2*Us()-f.renderingStartTime>hg&&o!==1073741824&&(s.flags|=128,d=!0,EE(f,!1),s.lanes=4194304);f.isBackwards?(E.sibling=s.child,s.child=E):(o=f.last,o!==null?o.sibling=E:s.child=E,f.last=E)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=Us(),s.sibling=null,o=bs.current,Kr(bs,d?o&1|2:o&1),s):(Fi(s),null);case 22:case 23:return kD(),d=s.memoizedState!==null,r!==null&&r.memoizedState!==null!==d&&(s.flags|=8192),d&&s.mode&1?qa&1073741824&&(Fi(s),s.subtreeFlags&6&&(s.flags|=8192)):Fi(s),null;case 24:return null;case 25:return null}throw Error(nt(156,s.tag))}function x0e(r,s){switch(mD(s),s.tag){case 1:return Oa(s.type)&&ib(),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return dg(),es(Aa),es(Hi),bD(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 5:return TD(s),null;case 13:if(es(bs),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(nt(340));cg()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return es(bs),null;case 4:return dg(),null;case 10:return ED(s.type._context),null;case 22:case 23:return kD(),null;case 24:return null;default:return null}}var pT=!1,Gi=!1,N0e=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function xf(r,s){var o=r.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(d){Os(r,s,d)}else o.current=null}function QO(r,s,o){try{o()}catch(d){Os(r,s,d)}}var l8=!1;function I0e(r,s){if(DO=tb,r=VY(),hD(r)){if("selectionStart"in r)var o={start:r.selectionStart,end:r.selectionEnd};else e:{o=(o=r.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var p=d.anchorOffset,f=d.focusNode;d=d.focusOffset;try{o.nodeType,f.nodeType}catch{o=null;break e}var E=0,y=-1,b=-1,C=0,A=0,D=r,k=null;t:for(;;){for(var W;D!==o||p!==0&&D.nodeType!==3||(y=E+p),D!==f||d!==0&&D.nodeType!==3||(b=E+d),D.nodeType===3&&(E+=D.nodeValue.length),(W=D.firstChild)!==null;)k=D,D=W;for(;;){if(D===r)break t;if(k===o&&++C===p&&(y=E),k===f&&++A===d&&(b=E),(W=D.nextSibling)!==null)break;D=k,k=D.parentNode}D=W}o=y===-1||b===-1?null:{start:y,end:b}}else o=null}o=o||{start:0,end:0}}else o=null;for(kO={focusedElem:r,selectionRange:o},tb=!1,Nt=s;Nt!==null;)if(s=Nt,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Nt=r;else for(;Nt!==null;){s=Nt;try{var G=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var L=G.memoizedProps,B=G.memoizedState,H=s.stateNode,V=H.getSnapshotBeforeUpdate(s.elementType===s.type?L:mc(s.type,L),B);H.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var K=s.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(nt(163))}}catch(Z){Os(s,s.return,Z)}if(r=s.sibling,r!==null){r.return=s.return,Nt=r;break}Nt=s.return}return G=l8,l8=!1,G}function BE(r,s,o){var d=s.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var p=d=d.next;do{if((p.tag&r)===r){var f=p.destroy;p.destroy=void 0,f!==void 0&&QO(s,o,f)}p=p.next}while(p!==d)}}function rw(r,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var o=s=s.next;do{if((o.tag&r)===r){var d=o.create;o.destroy=d()}o=o.next}while(o!==s)}}function JO(r){var s=r.ref;if(s!==null){var o=r.stateNode;switch(r.tag){case 5:r=o;break;default:r=o}typeof s=="function"?s(r):s.current=r}}function L7(r){var s=r.alternate;s!==null&&(r.alternate=null,L7(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&(delete s[pl],delete s[sv],delete s[MO],delete s[u0e],delete s[h0e])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function j7(r){return r.tag===5||r.tag===3||r.tag===4}function d8(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||j7(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function $O(r,s,o){var d=r.tag;if(d===5||d===6)r=r.stateNode,s?o.nodeType===8?o.parentNode.insertBefore(r,s):o.insertBefore(r,s):(o.nodeType===8?(s=o.parentNode,s.insertBefore(r,o)):(s=o,s.appendChild(r)),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=sb));else if(d!==4&&(r=r.child,r!==null))for($O(r,s,o),r=r.sibling;r!==null;)$O(r,s,o),r=r.sibling}function ZO(r,s,o){var d=r.tag;if(d===5||d===6)r=r.stateNode,s?o.insertBefore(r,s):o.appendChild(r);else if(d!==4&&(r=r.child,r!==null))for(ZO(r,s,o),r=r.sibling;r!==null;)ZO(r,s,o),r=r.sibling}var Ii=null,gc=!1;function $d(r,s,o){for(o=o.child;o!==null;)M7(r,s,o),o=o.sibling}function M7(r,s,o){if(_l&&typeof _l.onCommitFiberUnmount=="function")try{_l.onCommitFiberUnmount(Xb,o)}catch{}switch(o.tag){case 5:Gi||xf(o,s);case 6:var d=Ii,p=gc;Ii=null,$d(r,s,o),Ii=d,gc=p,Ii!==null&&(gc?(r=Ii,o=o.stateNode,r.nodeType===8?r.parentNode.removeChild(o):r.removeChild(o)):Ii.removeChild(o.stateNode));break;case 18:Ii!==null&&(gc?(r=Ii,o=o.stateNode,r.nodeType===8?PA(r.parentNode,o):r.nodeType===1&&PA(r,o),ZE(r)):PA(Ii,o.stateNode));break;case 4:d=Ii,p=gc,Ii=o.stateNode.containerInfo,gc=!0,$d(r,s,o),Ii=d,gc=p;break;case 0:case 11:case 14:case 15:if(!Gi&&(d=o.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){p=d=d.next;do{var f=p,E=f.destroy;f=f.tag,E!==void 0&&(f&2||f&4)&&QO(o,s,E),p=p.next}while(p!==d)}$d(r,s,o);break;case 1:if(!Gi&&(xf(o,s),d=o.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=o.memoizedProps,d.state=o.memoizedState,d.componentWillUnmount()}catch(y){Os(o,s,y)}$d(r,s,o);break;case 21:$d(r,s,o);break;case 22:o.mode&1?(Gi=(d=Gi)||o.memoizedState!==null,$d(r,s,o),Gi=d):$d(r,s,o);break;default:$d(r,s,o)}}function u8(r){var s=r.updateQueue;if(s!==null){r.updateQueue=null;var o=r.stateNode;o===null&&(o=r.stateNode=new N0e),s.forEach(function(d){var p=U0e.bind(null,r,d);o.has(d)||(o.add(d),d.then(p,p))})}}function hc(r,s){var o=s.deletions;if(o!==null)for(var d=0;d<o.length;d++){var p=o[d];try{var f=r,E=s,y=E;e:for(;y!==null;){switch(y.tag){case 5:Ii=y.stateNode,gc=!1;break e;case 3:Ii=y.stateNode.containerInfo,gc=!0;break e;case 4:Ii=y.stateNode.containerInfo,gc=!0;break e}y=y.return}if(Ii===null)throw Error(nt(160));M7(f,E,p),Ii=null,gc=!1;var b=p.alternate;b!==null&&(b.return=null),p.return=null}catch(C){Os(p,s,C)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)U7(s,r),s=s.sibling}function U7(r,s){var o=r.alternate,d=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(hc(s,r),ol(r),d&4){try{BE(3,r,r.return),rw(3,r)}catch(L){Os(r,r.return,L)}try{BE(5,r,r.return)}catch(L){Os(r,r.return,L)}}break;case 1:hc(s,r),ol(r),d&512&&o!==null&&xf(o,o.return);break;case 5:if(hc(s,r),ol(r),d&512&&o!==null&&xf(o,o.return),r.flags&32){var p=r.stateNode;try{XE(p,"")}catch(L){Os(r,r.return,L)}}if(d&4&&(p=r.stateNode,p!=null)){var f=r.memoizedProps,E=o!==null?o.memoizedProps:f,y=r.type,b=r.updateQueue;if(r.updateQueue=null,b!==null)try{y==="input"&&f.type==="radio"&&f.name!=null&&aY(p,f),bO(y,E);var C=bO(y,f);for(E=0;E<b.length;E+=2){var A=b[E],D=b[E+1];A==="style"?uY(p,D):A==="dangerouslySetInnerHTML"?lY(p,D):A==="children"?XE(p,D):ZP(p,A,D,C)}switch(y){case"input":EO(p,f);break;case"textarea":oY(p,f);break;case"select":var k=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!f.multiple;var W=f.value;W!=null?Of(p,!!f.multiple,W,!1):k!==!!f.multiple&&(f.defaultValue!=null?Of(p,!!f.multiple,f.defaultValue,!0):Of(p,!!f.multiple,f.multiple?[]:"",!1))}p[sv]=f}catch(L){Os(r,r.return,L)}}break;case 6:if(hc(s,r),ol(r),d&4){if(r.stateNode===null)throw Error(nt(162));p=r.stateNode,f=r.memoizedProps;try{p.nodeValue=f}catch(L){Os(r,r.return,L)}}break;case 3:if(hc(s,r),ol(r),d&4&&o!==null&&o.memoizedState.isDehydrated)try{ZE(s.containerInfo)}catch(L){Os(r,r.return,L)}break;case 4:hc(s,r),ol(r);break;case 13:hc(s,r),ol(r),p=r.child,p.flags&8192&&(f=p.memoizedState!==null,p.stateNode.isHidden=f,!f||p.alternate!==null&&p.alternate.memoizedState!==null||(PD=Us())),d&4&&u8(r);break;case 22:if(A=o!==null&&o.memoizedState!==null,r.mode&1?(Gi=(C=Gi)||A,hc(s,r),Gi=C):hc(s,r),ol(r),d&8192){if(C=r.memoizedState!==null,(r.stateNode.isHidden=C)&&!A&&r.mode&1)for(Nt=r,A=r.child;A!==null;){for(D=Nt=A;Nt!==null;){switch(k=Nt,W=k.child,k.tag){case 0:case 11:case 14:case 15:BE(4,k,k.return);break;case 1:xf(k,k.return);var G=k.stateNode;if(typeof G.componentWillUnmount=="function"){d=k,o=k.return;try{s=d,G.props=s.memoizedProps,G.state=s.memoizedState,G.componentWillUnmount()}catch(L){Os(d,o,L)}}break;case 5:xf(k,k.return);break;case 22:if(k.memoizedState!==null){p8(D);continue}}W!==null?(W.return=k,Nt=W):p8(D)}A=A.sibling}e:for(A=null,D=r;;){if(D.tag===5){if(A===null){A=D;try{p=D.stateNode,C?(f=p.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(y=D.stateNode,b=D.memoizedProps.style,E=b!=null&&b.hasOwnProperty("display")?b.display:null,y.style.display=dY("display",E))}catch(L){Os(r,r.return,L)}}}else if(D.tag===6){if(A===null)try{D.stateNode.nodeValue=C?"":D.memoizedProps}catch(L){Os(r,r.return,L)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===r)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===r)break e;for(;D.sibling===null;){if(D.return===null||D.return===r)break e;A===D&&(A=null),D=D.return}A===D&&(A=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:hc(s,r),ol(r),d&4&&u8(r);break;case 21:break;default:hc(s,r),ol(r)}}function ol(r){var s=r.flags;if(s&2){try{e:{for(var o=r.return;o!==null;){if(j7(o)){var d=o;break e}o=o.return}throw Error(nt(160))}switch(d.tag){case 5:var p=d.stateNode;d.flags&32&&(XE(p,""),d.flags&=-33);var f=d8(r);ZO(r,f,p);break;case 3:case 4:var E=d.stateNode.containerInfo,y=d8(r);$O(r,y,E);break;default:throw Error(nt(161))}}catch(b){Os(r,r.return,b)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function A0e(r,s,o){Nt=r,V7(r)}function V7(r,s,o){for(var d=(r.mode&1)!==0;Nt!==null;){var p=Nt,f=p.child;if(p.tag===22&&d){var E=p.memoizedState!==null||pT;if(!E){var y=p.alternate,b=y!==null&&y.memoizedState!==null||Gi;y=pT;var C=Gi;if(pT=E,(Gi=b)&&!C)for(Nt=p;Nt!==null;)E=Nt,b=E.child,E.tag===22&&E.memoizedState!==null?m8(p):b!==null?(b.return=E,Nt=b):m8(p);for(;f!==null;)Nt=f,V7(f),f=f.sibling;Nt=p,pT=y,Gi=C}h8(r)}else p.subtreeFlags&8772&&f!==null?(f.return=p,Nt=f):h8(r)}}function h8(r){for(;Nt!==null;){var s=Nt;if(s.flags&8772){var o=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Gi||rw(5,s);break;case 1:var d=s.stateNode;if(s.flags&4&&!Gi)if(o===null)d.componentDidMount();else{var p=s.elementType===s.type?o.memoizedProps:mc(s.type,o.memoizedProps);d.componentDidUpdate(p,o.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var f=s.updateQueue;f!==null&&QW(s,f,d);break;case 3:var E=s.updateQueue;if(E!==null){if(o=null,s.child!==null)switch(s.child.tag){case 5:o=s.child.stateNode;break;case 1:o=s.child.stateNode}QW(s,E,o)}break;case 5:var y=s.stateNode;if(o===null&&s.flags&4){o=y;var b=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&o.focus();break;case"img":b.src&&(o.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var C=s.alternate;if(C!==null){var A=C.memoizedState;if(A!==null){var D=A.dehydrated;D!==null&&ZE(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(nt(163))}Gi||s.flags&512&&JO(s)}catch(k){Os(s,s.return,k)}}if(s===r){Nt=null;break}if(o=s.sibling,o!==null){o.return=s.return,Nt=o;break}Nt=s.return}}function p8(r){for(;Nt!==null;){var s=Nt;if(s===r){Nt=null;break}var o=s.sibling;if(o!==null){o.return=s.return,Nt=o;break}Nt=s.return}}function m8(r){for(;Nt!==null;){var s=Nt;try{switch(s.tag){case 0:case 11:case 15:var o=s.return;try{rw(4,s)}catch(b){Os(s,o,b)}break;case 1:var d=s.stateNode;if(typeof d.componentDidMount=="function"){var p=s.return;try{d.componentDidMount()}catch(b){Os(s,p,b)}}var f=s.return;try{JO(s)}catch(b){Os(s,f,b)}break;case 5:var E=s.return;try{JO(s)}catch(b){Os(s,E,b)}}}catch(b){Os(s,s.return,b)}if(s===r){Nt=null;break}var y=s.sibling;if(y!==null){y.return=s.return,Nt=y;break}Nt=s.return}}var O0e=Math.ceil,fb=Ed.ReactCurrentDispatcher,AD=Ed.ReactCurrentOwner,Lo=Ed.ReactCurrentBatchConfig,pr=0,fi=null,Ks=null,Oi=0,qa=0,Nf=Gu(0),ri=0,dv=null,up=0,sw=0,OD=0,GE=null,xa=null,PD=0,hg=1/0,Jl=null,gb=!1,eP=null,xu=null,mT=!1,vu=null,_b=0,WE=0,tP=null,LT=-1,jT=0;function aa(){return pr&6?Us():LT!==-1?LT:LT=Us()}function Nu(r){return r.mode&1?pr&2&&Oi!==0?Oi&-Oi:m0e.transition!==null?(jT===0&&(jT=bY()),jT):(r=Ir,r!==0||(r=window.event,r=r===void 0?16:AY(r.type)),r):1}function Cc(r,s,o,d){if(50<WE)throw WE=0,tP=null,Error(nt(185));jv(r,o,d),(!(pr&2)||r!==fi)&&(r===fi&&(!(pr&2)&&(sw|=o),ri===4&&ou(r,Oi)),Pa(r,d),o===1&&pr===0&&!(s.mode&1)&&(hg=Us()+500,ew&&Wu()))}function Pa(r,s){var o=r.callbackNode;mSe(r,s);var d=eb(r,r===fi?Oi:0);if(d===0)o!==null&&bW(o),r.callbackNode=null,r.callbackPriority=0;else if(s=d&-d,r.callbackPriority!==s){if(o!=null&&bW(o),s===1)r.tag===0?p0e(f8.bind(null,r)):XY(f8.bind(null,r)),l0e(function(){!(pr&6)&&Wu()}),o=null;else{switch(wY(d)){case 1:o=sD;break;case 4:o=SY;break;case 16:o=ZT;break;case 536870912:o=TY;break;default:o=ZT}o=q7(o,F7.bind(null,r))}r.callbackPriority=s,r.callbackNode=o}}function F7(r,s){if(LT=-1,jT=0,pr&6)throw Error(nt(327));var o=r.callbackNode;if(jf()&&r.callbackNode!==o)return null;var d=eb(r,r===fi?Oi:0);if(d===0)return null;if(d&30||d&r.expiredLanes||s)s=Eb(r,d);else{s=d;var p=pr;pr|=2;var f=G7();(fi!==r||Oi!==s)&&(Jl=null,hg=Us()+500,ip(r,s));do try{k0e();break}catch(y){B7(r,y)}while(!0);_D(),fb.current=f,pr=p,Ks!==null?s=0:(fi=null,Oi=0,s=ri)}if(s!==0){if(s===2&&(p=NO(r),p!==0&&(d=p,s=nP(r,p))),s===1)throw o=dv,ip(r,0),ou(r,d),Pa(r,Us()),o;if(s===6)ou(r,d);else{if(p=r.current.alternate,!(d&30)&&!P0e(p)&&(s=Eb(r,d),s===2&&(f=NO(r),f!==0&&(d=f,s=nP(r,f))),s===1))throw o=dv,ip(r,0),ou(r,d),Pa(r,Us()),o;switch(r.finishedWork=p,r.finishedLanes=d,s){case 0:case 1:throw Error(nt(345));case 2:Wh(r,xa,Jl);break;case 3:if(ou(r,d),(d&130023424)===d&&(s=PD+500-Us(),10<s)){if(eb(r,0)!==0)break;if(p=r.suspendedLanes,(p&d)!==d){aa(),r.pingedLanes|=r.suspendedLanes&p;break}r.timeoutHandle=jO(Wh.bind(null,r,xa,Jl),s);break}Wh(r,xa,Jl);break;case 4:if(ou(r,d),(d&4194240)===d)break;for(s=r.eventTimes,p=-1;0<d;){var E=31-wc(d);f=1<<E,E=s[E],E>p&&(p=E),d&=~f}if(d=p,d=Us()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*O0e(d/1960))-d,10<d){r.timeoutHandle=jO(Wh.bind(null,r,xa,Jl),d);break}Wh(r,xa,Jl);break;case 5:Wh(r,xa,Jl);break;default:throw Error(nt(329))}}}return Pa(r,Us()),r.callbackNode===o?F7.bind(null,r):null}function nP(r,s){var o=GE;return r.current.memoizedState.isDehydrated&&(ip(r,s).flags|=256),r=Eb(r,s),r!==2&&(s=xa,xa=o,s!==null&&rP(s)),r}function rP(r){xa===null?xa=r:xa.push.apply(xa,r)}function P0e(r){for(var s=r;;){if(s.flags&16384){var o=s.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var d=0;d<o.length;d++){var p=o[d],f=p.getSnapshot;p=p.value;try{if(!xc(f(),p))return!1}catch{return!1}}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function ou(r,s){for(s&=~OD,s&=~sw,r.suspendedLanes|=s,r.pingedLanes&=~s,r=r.expirationTimes;0<s;){var o=31-wc(s),d=1<<o;r[o]=-1,s&=~d}}function f8(r){if(pr&6)throw Error(nt(327));jf();var s=eb(r,0);if(!(s&1))return Pa(r,Us()),null;var o=Eb(r,s);if(r.tag!==0&&o===2){var d=NO(r);d!==0&&(s=d,o=nP(r,d))}if(o===1)throw o=dv,ip(r,0),ou(r,s),Pa(r,Us()),o;if(o===6)throw Error(nt(345));return r.finishedWork=r.current.alternate,r.finishedLanes=s,Wh(r,xa,Jl),Pa(r,Us()),null}function DD(r,s){var o=pr;pr|=1;try{return r(s)}finally{pr=o,pr===0&&(hg=Us()+500,ew&&Wu())}}function hp(r){vu!==null&&vu.tag===0&&!(pr&6)&&jf();var s=pr;pr|=1;var o=Lo.transition,d=Ir;try{if(Lo.transition=null,Ir=1,r)return r()}finally{Ir=d,Lo.transition=o,pr=s,!(pr&6)&&Wu()}}function kD(){qa=Nf.current,es(Nf)}function ip(r,s){r.finishedWork=null,r.finishedLanes=0;var o=r.timeoutHandle;if(o!==-1&&(r.timeoutHandle=-1,c0e(o)),Ks!==null)for(o=Ks.return;o!==null;){var d=o;switch(mD(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&ib();break;case 3:dg(),es(Aa),es(Hi),bD();break;case 5:TD(d);break;case 4:dg();break;case 13:es(bs);break;case 19:es(bs);break;case 10:ED(d.type._context);break;case 22:case 23:kD()}o=o.return}if(fi=r,Ks=r=Iu(r.current,null),Oi=qa=s,ri=0,dv=null,OD=sw=up=0,xa=GE=null,Yh!==null){for(s=0;s<Yh.length;s++)if(o=Yh[s],d=o.interleaved,d!==null){o.interleaved=null;var p=d.next,f=o.pending;if(f!==null){var E=f.next;f.next=p,d.next=E}o.pending=d}Yh=null}return r}function B7(r,s){do{var o=Ks;try{if(_D(),PT.current=mb,pb){for(var d=ws.memoizedState;d!==null;){var p=d.queue;p!==null&&(p.pending=null),d=d.next}pb=!1}if(dp=0,mi=ei=ws=null,FE=!1,ov=0,AD.current=null,o===null||o.return===null){ri=1,dv=s,Ks=null;break}e:{var f=r,E=o.return,y=o,b=s;if(s=Oi,y.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var C=b,A=y,D=A.tag;if(!(A.mode&1)&&(D===0||D===11||D===15)){var k=A.alternate;k?(A.updateQueue=k.updateQueue,A.memoizedState=k.memoizedState,A.lanes=k.lanes):(A.updateQueue=null,A.memoizedState=null)}var W=n8(E);if(W!==null){W.flags&=-257,r8(W,E,y,f,s),W.mode&1&&t8(f,C,s),s=W,b=C;var G=s.updateQueue;if(G===null){var L=new Set;L.add(b),s.updateQueue=L}else G.add(b);break e}else{if(!(s&1)){t8(f,C,s),LD();break e}b=Error(nt(426))}}else if(ds&&y.mode&1){var B=n8(E);if(B!==null){!(B.flags&65536)&&(B.flags|=256),r8(B,E,y,f,s),fD(ug(b,y));break e}}f=b=ug(b,y),ri!==4&&(ri=2),GE===null?GE=[f]:GE.push(f),f=E;do{switch(f.tag){case 3:f.flags|=65536,s&=-s,f.lanes|=s;var H=w7(f,b,s);XW(f,H);break e;case 1:y=b;var V=f.type,K=f.stateNode;if(!(f.flags&128)&&(typeof V.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(xu===null||!xu.has(K)))){f.flags|=65536,s&=-s,f.lanes|=s;var Z=C7(f,y,s);XW(f,Z);break e}}f=f.return}while(f!==null)}H7(o)}catch(ee){s=ee,Ks===o&&o!==null&&(Ks=o=o.return);continue}break}while(!0)}function G7(){var r=fb.current;return fb.current=mb,r===null?mb:r}function LD(){(ri===0||ri===3||ri===2)&&(ri=4),fi===null||!(up&268435455)&&!(sw&268435455)||ou(fi,Oi)}function Eb(r,s){var o=pr;pr|=2;var d=G7();(fi!==r||Oi!==s)&&(Jl=null,ip(r,s));do try{D0e();break}catch(p){B7(r,p)}while(!0);if(_D(),pr=o,fb.current=d,Ks!==null)throw Error(nt(261));return fi=null,Oi=0,ri}function D0e(){for(;Ks!==null;)W7(Ks)}function k0e(){for(;Ks!==null&&!iSe();)W7(Ks)}function W7(r){var s=z7(r.alternate,r,qa);r.memoizedProps=r.pendingProps,s===null?H7(r):Ks=s,AD.current=null}function H7(r){var s=r;do{var o=s.alternate;if(r=s.return,s.flags&32768){if(o=x0e(o,s),o!==null){o.flags&=32767,Ks=o;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{ri=6,Ks=null;return}}else if(o=R0e(o,s,qa),o!==null){Ks=o;return}if(s=s.sibling,s!==null){Ks=s;return}Ks=s=r}while(s!==null);ri===0&&(ri=5)}function Wh(r,s,o){var d=Ir,p=Lo.transition;try{Lo.transition=null,Ir=1,L0e(r,s,o,d)}finally{Lo.transition=p,Ir=d}return null}function L0e(r,s,o,d){do jf();while(vu!==null);if(pr&6)throw Error(nt(327));o=r.finishedWork;var p=r.finishedLanes;if(o===null)return null;if(r.finishedWork=null,r.finishedLanes=0,o===r.current)throw Error(nt(177));r.callbackNode=null,r.callbackPriority=0;var f=o.lanes|o.childLanes;if(fSe(r,f),r===fi&&(Ks=fi=null,Oi=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||mT||(mT=!0,q7(ZT,function(){return jf(),null})),f=(o.flags&15990)!==0,o.subtreeFlags&15990||f){f=Lo.transition,Lo.transition=null;var E=Ir;Ir=1;var y=pr;pr|=4,AD.current=null,I0e(r,o),U7(o,r),t0e(kO),tb=!!DO,kO=DO=null,r.current=o,A0e(o),aSe(),pr=y,Ir=E,Lo.transition=f}else r.current=o;if(mT&&(mT=!1,vu=r,_b=p),f=r.pendingLanes,f===0&&(xu=null),lSe(o.stateNode),Pa(r,Us()),s!==null)for(d=r.onRecoverableError,o=0;o<s.length;o++)p=s[o],d(p.value,{componentStack:p.stack,digest:p.digest});if(gb)throw gb=!1,r=eP,eP=null,r;return _b&1&&r.tag!==0&&jf(),f=r.pendingLanes,f&1?r===tP?WE++:(WE=0,tP=r):WE=0,Wu(),null}function jf(){if(vu!==null){var r=wY(_b),s=Lo.transition,o=Ir;try{if(Lo.transition=null,Ir=16>r?16:r,vu===null)var d=!1;else{if(r=vu,vu=null,_b=0,pr&6)throw Error(nt(331));var p=pr;for(pr|=4,Nt=r.current;Nt!==null;){var f=Nt,E=f.child;if(Nt.flags&16){var y=f.deletions;if(y!==null){for(var b=0;b<y.length;b++){var C=y[b];for(Nt=C;Nt!==null;){var A=Nt;switch(A.tag){case 0:case 11:case 15:BE(8,A,f)}var D=A.child;if(D!==null)D.return=A,Nt=D;else for(;Nt!==null;){A=Nt;var k=A.sibling,W=A.return;if(L7(A),A===C){Nt=null;break}if(k!==null){k.return=W,Nt=k;break}Nt=W}}}var G=f.alternate;if(G!==null){var L=G.child;if(L!==null){G.child=null;do{var B=L.sibling;L.sibling=null,L=B}while(L!==null)}}Nt=f}}if(f.subtreeFlags&2064&&E!==null)E.return=f,Nt=E;else e:for(;Nt!==null;){if(f=Nt,f.flags&2048)switch(f.tag){case 0:case 11:case 15:BE(9,f,f.return)}var H=f.sibling;if(H!==null){H.return=f.return,Nt=H;break e}Nt=f.return}}var V=r.current;for(Nt=V;Nt!==null;){E=Nt;var K=E.child;if(E.subtreeFlags&2064&&K!==null)K.return=E,Nt=K;else e:for(E=V;Nt!==null;){if(y=Nt,y.flags&2048)try{switch(y.tag){case 0:case 11:case 15:rw(9,y)}}catch(ee){Os(y,y.return,ee)}if(y===E){Nt=null;break e}var Z=y.sibling;if(Z!==null){Z.return=y.return,Nt=Z;break e}Nt=y.return}}if(pr=p,Wu(),_l&&typeof _l.onPostCommitFiberRoot=="function")try{_l.onPostCommitFiberRoot(Xb,r)}catch{}d=!0}return d}finally{Ir=o,Lo.transition=s}}return!1}function g8(r,s,o){s=ug(o,s),s=w7(r,s,1),r=Ru(r,s,1),s=aa(),r!==null&&(jv(r,1,s),Pa(r,s))}function Os(r,s,o){if(r.tag===3)g8(r,r,o);else for(;s!==null;){if(s.tag===3){g8(s,r,o);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(xu===null||!xu.has(d))){r=ug(o,r),r=C7(s,r,1),s=Ru(s,r,1),r=aa(),s!==null&&(jv(s,1,r),Pa(s,r));break}}s=s.return}}function j0e(r,s,o){var d=r.pingCache;d!==null&&d.delete(s),s=aa(),r.pingedLanes|=r.suspendedLanes&o,fi===r&&(Oi&o)===o&&(ri===4||ri===3&&(Oi&130023424)===Oi&&500>Us()-PD?ip(r,0):OD|=o),Pa(r,s)}function K7(r,s){s===0&&(r.mode&1?(s=sT,sT<<=1,!(sT&130023424)&&(sT=4194304)):s=1);var o=aa();r=ud(r,s),r!==null&&(jv(r,s,o),Pa(r,o))}function M0e(r){var s=r.memoizedState,o=0;s!==null&&(o=s.retryLane),K7(r,o)}function U0e(r,s){var o=0;switch(r.tag){case 13:var d=r.stateNode,p=r.memoizedState;p!==null&&(o=p.retryLane);break;case 19:d=r.stateNode;break;default:throw Error(nt(314))}d!==null&&d.delete(s),K7(r,o)}var z7;z7=function(r,s,o){if(r!==null)if(r.memoizedProps!==s.pendingProps||Aa.current)Ia=!0;else{if(!(r.lanes&o)&&!(s.flags&128))return Ia=!1,C0e(r,s,o);Ia=!!(r.flags&131072)}else Ia=!1,ds&&s.flags&1048576&&QY(s,cb,s.index);switch(s.lanes=0,s.tag){case 2:var d=s.type;kT(r,s),r=s.pendingProps;var p=og(s,Hi.current);Lf(s,o),p=CD(null,s,d,r,p,o);var f=RD();return s.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Oa(d)?(f=!0,ab(s)):f=!1,s.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,yD(s),p.updater=nw,s.stateNode=p,p._reactInternals=s,WO(s,d,r,o),s=zO(null,s,d,!0,f,o)):(s.tag=0,ds&&f&&pD(s),ra(null,s,p,o),s=s.child),s;case 16:d=s.elementType;e:{switch(kT(r,s),r=s.pendingProps,p=d._init,d=p(d._payload),s.type=d,p=s.tag=F0e(d),r=mc(d,r),p){case 0:s=KO(null,s,d,r,o);break e;case 1:s=a8(null,s,d,r,o);break e;case 11:s=s8(null,s,d,r,o);break e;case 14:s=i8(null,s,d,mc(d.type,r),o);break e}throw Error(nt(306,d,""))}return s;case 0:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:mc(d,p),KO(r,s,d,p,o);case 1:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:mc(d,p),a8(r,s,d,p,o);case 3:e:{if(I7(s),r===null)throw Error(nt(387));d=s.pendingProps,f=s.memoizedState,p=f.element,n7(r,s),ub(s,d,null,o);var E=s.memoizedState;if(d=E.element,f.isDehydrated)if(f={element:d,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},s.updateQueue.baseState=f,s.memoizedState=f,s.flags&256){p=ug(Error(nt(423)),s),s=o8(r,s,d,o,p);break e}else if(d!==p){p=ug(Error(nt(424)),s),s=o8(r,s,d,o,p);break e}else for(Ja=Cu(s.stateNode.containerInfo.firstChild),$a=s,ds=!0,Ec=null,o=e7(s,null,d,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(cg(),d===p){s=hd(r,s,o);break e}ra(r,s,d,o)}s=s.child}return s;case 5:return r7(s),r===null&&FO(s),d=s.type,p=s.pendingProps,f=r!==null?r.memoizedProps:null,E=p.children,LO(d,p)?E=null:f!==null&&LO(d,f)&&(s.flags|=32),N7(r,s),ra(r,s,E,o),s.child;case 6:return r===null&&FO(s),null;case 13:return A7(r,s,o);case 4:return SD(s,s.stateNode.containerInfo),d=s.pendingProps,r===null?s.child=lg(s,null,d,o):ra(r,s,d,o),s.child;case 11:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:mc(d,p),s8(r,s,d,p,o);case 7:return ra(r,s,s.pendingProps,o),s.child;case 8:return ra(r,s,s.pendingProps.children,o),s.child;case 12:return ra(r,s,s.pendingProps.children,o),s.child;case 10:e:{if(d=s.type._context,p=s.pendingProps,f=s.memoizedProps,E=p.value,Kr(lb,d._currentValue),d._currentValue=E,f!==null)if(xc(f.value,E)){if(f.children===p.children&&!Aa.current){s=hd(r,s,o);break e}}else for(f=s.child,f!==null&&(f.return=s);f!==null;){var y=f.dependencies;if(y!==null){E=f.child;for(var b=y.firstContext;b!==null;){if(b.context===d){if(f.tag===1){b=sd(-1,o&-o),b.tag=2;var C=f.updateQueue;if(C!==null){C=C.shared;var A=C.pending;A===null?b.next=b:(b.next=A.next,A.next=b),C.pending=b}}f.lanes|=o,b=f.alternate,b!==null&&(b.lanes|=o),BO(f.return,o,s),y.lanes|=o;break}b=b.next}}else if(f.tag===10)E=f.type===s.type?null:f.child;else if(f.tag===18){if(E=f.return,E===null)throw Error(nt(341));E.lanes|=o,y=E.alternate,y!==null&&(y.lanes|=o),BO(E,o,s),E=f.sibling}else E=f.child;if(E!==null)E.return=f;else for(E=f;E!==null;){if(E===s){E=null;break}if(f=E.sibling,f!==null){f.return=E.return,E=f;break}E=E.return}f=E}ra(r,s,p.children,o),s=s.child}return s;case 9:return p=s.type,d=s.pendingProps.children,Lf(s,o),p=jo(p),d=d(p),s.flags|=1,ra(r,s,d,o),s.child;case 14:return d=s.type,p=mc(d,s.pendingProps),p=mc(d.type,p),i8(r,s,d,p,o);case 15:return R7(r,s,s.type,s.pendingProps,o);case 17:return d=s.type,p=s.pendingProps,p=s.elementType===d?p:mc(d,p),kT(r,s),s.tag=1,Oa(d)?(r=!0,ab(s)):r=!1,Lf(s,o),b7(s,d,p),WO(s,d,p,o),zO(null,s,d,!0,r,o);case 19:return O7(r,s,o);case 22:return x7(r,s,o)}throw Error(nt(156,s.tag))};function q7(r,s){return yY(r,s)}function V0e(r,s,o,d){this.tag=r,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ko(r,s,o,d){return new V0e(r,s,o,d)}function jD(r){return r=r.prototype,!(!r||!r.isReactComponent)}function F0e(r){if(typeof r=="function")return jD(r)?1:0;if(r!=null){if(r=r.$$typeof,r===tD)return 11;if(r===nD)return 14}return 2}function Iu(r,s){var o=r.alternate;return o===null?(o=ko(r.tag,s,r.key,r.mode),o.elementType=r.elementType,o.type=r.type,o.stateNode=r.stateNode,o.alternate=r,r.alternate=o):(o.pendingProps=s,o.type=r.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=r.flags&14680064,o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,s=r.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=r.sibling,o.index=r.index,o.ref=r.ref,o}function MT(r,s,o,d,p,f){var E=2;if(d=r,typeof r=="function")jD(r)&&(E=1);else if(typeof r=="string")E=5;else e:switch(r){case Ef:return ap(o.children,p,f,s);case eD:E=8,p|=8;break;case pO:return r=ko(12,o,s,p|2),r.elementType=pO,r.lanes=f,r;case mO:return r=ko(13,o,s,p),r.elementType=mO,r.lanes=f,r;case fO:return r=ko(19,o,s,p),r.elementType=fO,r.lanes=f,r;case rY:return iw(o,p,f,s);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case tY:E=10;break e;case nY:E=9;break e;case tD:E=11;break e;case nD:E=14;break e;case su:E=16,d=null;break e}throw Error(nt(130,r==null?r:typeof r,""))}return s=ko(E,o,s,p),s.elementType=r,s.type=d,s.lanes=f,s}function ap(r,s,o,d){return r=ko(7,r,d,s),r.lanes=o,r}function iw(r,s,o,d){return r=ko(22,r,d,s),r.elementType=rY,r.lanes=o,r.stateNode={isHidden:!1},r}function FA(r,s,o){return r=ko(6,r,null,s),r.lanes=o,r}function BA(r,s,o){return s=ko(4,r.children!==null?r.children:[],r.key,s),s.lanes=o,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}function B0e(r,s,o,d,p){this.tag=s,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=SA(0),this.expirationTimes=SA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=SA(0),this.identifierPrefix=d,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function MD(r,s,o,d,p,f,E,y,b){return r=new B0e(r,s,o,y,b),s===1?(s=1,f===!0&&(s|=8)):s=0,f=ko(3,null,null,s),r.current=f,f.stateNode=r,f.memoizedState={element:d,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},yD(f),r}function G0e(r,s,o){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_f,key:d==null?null:""+d,children:r,containerInfo:s,implementation:o}}function Y7(r){if(!r)return Pu;r=r._reactInternals;e:{if(Ap(r)!==r||r.tag!==1)throw Error(nt(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Oa(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(nt(171))}if(r.tag===1){var o=r.type;if(Oa(o))return YY(r,o,s)}return s}function X7(r,s,o,d,p,f,E,y,b){return r=MD(o,d,!0,r,p,f,E,y,b),r.context=Y7(null),o=r.current,d=aa(),p=Nu(o),f=sd(d,p),f.callback=s??null,Ru(o,f,p),r.current.lanes=p,jv(r,p,d),Pa(r,d),r}function aw(r,s,o,d){var p=s.current,f=aa(),E=Nu(p);return o=Y7(o),s.context===null?s.context=o:s.pendingContext=o,s=sd(f,E),s.payload={element:r},d=d===void 0?null:d,d!==null&&(s.callback=d),r=Ru(p,s,E),r!==null&&(Cc(r,p,E,f),OT(r,p,E)),E}function vb(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function _8(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var o=r.retryLane;r.retryLane=o!==0&&o<s?o:s}}function UD(r,s){_8(r,s),(r=r.alternate)&&_8(r,s)}function W0e(){return null}var Q7=typeof reportError=="function"?reportError:function(r){console.error(r)};function VD(r){this._internalRoot=r}ow.prototype.render=VD.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(nt(409));aw(r,s,null,null)};ow.prototype.unmount=VD.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;hp(function(){aw(null,r,null,null)}),s[dd]=null}};function ow(r){this._internalRoot=r}ow.prototype.unstable_scheduleHydration=function(r){if(r){var s=xY();r={blockedOn:null,target:r,priority:s};for(var o=0;o<au.length&&s!==0&&s<au[o].priority;o++);au.splice(o,0,r),o===0&&IY(r)}};function FD(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function cw(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function E8(){}function H0e(r,s,o,d,p){if(p){if(typeof d=="function"){var f=d;d=function(){var C=vb(E);f.call(C)}}var E=X7(s,d,r,0,null,!1,!1,"",E8);return r._reactRootContainer=E,r[dd]=E.current,nv(r.nodeType===8?r.parentNode:r),hp(),E}for(;p=r.lastChild;)r.removeChild(p);if(typeof d=="function"){var y=d;d=function(){var C=vb(b);y.call(C)}}var b=MD(r,0,!1,null,null,!1,!1,"",E8);return r._reactRootContainer=b,r[dd]=b.current,nv(r.nodeType===8?r.parentNode:r),hp(function(){aw(s,b,o,d)}),b}function lw(r,s,o,d,p){var f=o._reactRootContainer;if(f){var E=f;if(typeof p=="function"){var y=p;p=function(){var b=vb(E);y.call(b)}}aw(s,E,r,p)}else E=H0e(o,s,r,p,d);return vb(E)}CY=function(r){switch(r.tag){case 3:var s=r.stateNode;if(s.current.memoizedState.isDehydrated){var o=IE(s.pendingLanes);o!==0&&(iD(s,o|1),Pa(s,Us()),!(pr&6)&&(hg=Us()+500,Wu()))}break;case 13:hp(function(){var d=ud(r,1);if(d!==null){var p=aa();Cc(d,r,1,p)}}),UD(r,1)}};aD=function(r){if(r.tag===13){var s=ud(r,134217728);if(s!==null){var o=aa();Cc(s,r,134217728,o)}UD(r,134217728)}};RY=function(r){if(r.tag===13){var s=Nu(r),o=ud(r,s);if(o!==null){var d=aa();Cc(o,r,s,d)}UD(r,s)}};xY=function(){return Ir};NY=function(r,s){var o=Ir;try{return Ir=r,s()}finally{Ir=o}};CO=function(r,s,o){switch(s){case"input":if(EO(r,o),s=o.name,o.type==="radio"&&s!=null){for(o=r;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<o.length;s++){var d=o[s];if(d!==r&&d.form===r.form){var p=Zb(d);if(!p)throw Error(nt(90));iY(d),EO(d,p)}}}break;case"textarea":oY(r,o);break;case"select":s=o.value,s!=null&&Of(r,!!o.multiple,s,!1)}};mY=DD;fY=hp;var K0e={usingClientEntryPoint:!1,Events:[Uv,Tf,Zb,hY,pY,DD]},vE={findFiberByHostInstance:qh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},z0e={bundleType:vE.bundleType,version:vE.version,rendererPackageName:vE.rendererPackageName,rendererConfig:vE.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ed.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=EY(r),r===null?null:r.stateNode},findFiberByHostInstance:vE.findFiberByHostInstance||W0e,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fT.isDisabled&&fT.supportsFiber)try{Xb=fT.inject(z0e),_l=fT}catch{}}no.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K0e;no.createPortal=function(r,s){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!FD(s))throw Error(nt(200));return G0e(r,s,null,o)};no.createRoot=function(r,s){if(!FD(r))throw Error(nt(299));var o=!1,d="",p=Q7;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onRecoverableError!==void 0&&(p=s.onRecoverableError)),s=MD(r,1,!1,null,null,o,!1,d,p),r[dd]=s.current,nv(r.nodeType===8?r.parentNode:r),new VD(s)};no.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(nt(188)):(r=Object.keys(r).join(","),Error(nt(268,r)));return r=EY(s),r=r===null?null:r.stateNode,r};no.flushSync=function(r){return hp(r)};no.hydrate=function(r,s,o){if(!cw(s))throw Error(nt(200));return lw(null,r,s,!0,o)};no.hydrateRoot=function(r,s,o){if(!FD(r))throw Error(nt(405));var d=o!=null&&o.hydratedSources||null,p=!1,f="",E=Q7;if(o!=null&&(o.unstable_strictMode===!0&&(p=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onRecoverableError!==void 0&&(E=o.onRecoverableError)),s=X7(s,null,r,1,o??null,p,!1,f,E),r[dd]=s.current,nv(r),d)for(r=0;r<d.length;r++)o=d[r],p=o._getVersion,p=p(o._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[o,p]:s.mutableSourceEagerHydrationData.push(o,p);return new ow(s)};no.render=function(r,s,o){if(!cw(s))throw Error(nt(200));return lw(null,r,s,!1,o)};no.unmountComponentAtNode=function(r){if(!cw(r))throw Error(nt(40));return r._reactRootContainer?(hp(function(){lw(null,null,r,!1,function(){r._reactRootContainer=null,r[dd]=null})}),!0):!1};no.unstable_batchedUpdates=DD;no.unstable_renderSubtreeIntoContainer=function(r,s,o,d){if(!cw(o))throw Error(nt(200));if(r==null||r._reactInternals===void 0)throw Error(nt(38));return lw(r,s,o,!1,d)};no.version="18.3.1-next-f1338f8080-20240426";function J7(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(J7)}catch(r){console.error(r)}}J7(),Jq.exports=no;var Op=Jq.exports;const q0e=zP(Op);var $7,v8=Op;$7=v8.createRoot,v8.hydrateRoot;function Y0e(r,s){if(r instanceof RegExp)return{keys:!1,pattern:r};var o,d,p,f,E=[],y="",b=r.split("/");for(b[0]||b.shift();p=b.shift();)o=p[0],o==="*"?(E.push(o),y+=p[1]==="?"?"(?:/(.*))?":"/(.*)"):o===":"?(d=p.indexOf("?",1),f=p.indexOf(".",1),E.push(p.substring(1,~d?d:~f?f:p.length)),y+=~d&&!~f?"(?:/([^/]+?))?":"/([^/]+?)",~f&&(y+=(~d?"?":"")+"\\"+p.substring(f))):y+="/"+p;return{keys:E,pattern:new RegExp("^"+y+(s?"(?=$|/)":"/?$"),"i")}}var Z7={exports:{}},eX={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pg=I;function X0e(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Q0e=typeof Object.is=="function"?Object.is:X0e,J0e=pg.useState,$0e=pg.useEffect,Z0e=pg.useLayoutEffect,eTe=pg.useDebugValue;function tTe(r,s){var o=s(),d=J0e({inst:{value:o,getSnapshot:s}}),p=d[0].inst,f=d[1];return Z0e(function(){p.value=o,p.getSnapshot=s,GA(p)&&f({inst:p})},[r,o,s]),$0e(function(){return GA(p)&&f({inst:p}),r(function(){GA(p)&&f({inst:p})})},[r]),eTe(o),o}function GA(r){var s=r.getSnapshot;r=r.value;try{var o=s();return!Q0e(r,o)}catch{return!0}}function nTe(r,s){return s()}var rTe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?nTe:tTe;eX.useSyncExternalStore=pg.useSyncExternalStore!==void 0?pg.useSyncExternalStore:rTe;Z7.exports=eX;var sTe=Z7.exports;const iTe=Xq.useInsertionEffect,aTe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",tX=aTe?I.useLayoutEffect:I.useEffect,oTe=iTe||tX,BD=r=>{const s=I.useRef([r,(...o)=>s[0](...o)]).current;return oTe(()=>{s[0]=r}),s[1]},cTe="popstate",GD="pushState",WD="replaceState",lTe="hashchange",y8=[cTe,GD,WD,lTe],dTe=r=>{for(const s of y8)addEventListener(s,r);return()=>{for(const s of y8)removeEventListener(s,r)}},nX=(r,s)=>sTe.useSyncExternalStore(dTe,r,s),uTe=()=>location.search,hTe=({ssrSearch:r=""}={})=>nX(uTe,()=>r),S8=()=>location.pathname,pTe=({ssrPath:r}={})=>nX(S8,r?()=>r:S8),mTe=(r,{replace:s=!1,state:o=null}={})=>history[s?WD:GD](o,"",r),fTe=(r={})=>[pTe(r),mTe],T8=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[T8]>"u"){for(const r of[GD,WD]){const s=history[r];history[r]=function(){const o=s.apply(this,arguments),d=new Event(r);return d.arguments=arguments,dispatchEvent(d),o}}Object.defineProperty(window,T8,{value:!0})}const gTe=(r,s)=>s.toLowerCase().indexOf(r.toLowerCase())?"~"+s:s.slice(r.length)||"/",rX=(r="")=>r==="/"?"":r,_Te=(r,s)=>r[0]==="~"?r.slice(1):rX(s)+r,ETe=(r="",s)=>gTe(sP(rX(r)),sP(s)),vTe=r=>r[0]==="?"?r.slice(1):r,sP=r=>{try{return decodeURI(r)}catch{return r}},yTe=r=>sP(vTe(r)),sX={hook:fTe,searchHook:hTe,parser:Y0e,base:"",ssrPath:void 0,ssrSearch:void 0,hrefs:r=>r},iX=I.createContext(sX),Pp=()=>I.useContext(iX),aX={},oX=I.createContext(aX),dw=()=>I.useContext(oX),uw=r=>{const[s,o]=r.hook(r);return[ETe(r.base,s),BD((d,p)=>o(_Te(d,r.base),p))]},so=()=>uw(Pp()),STe=()=>{const r=Pp();return yTe(r.searchHook(r))},HD=(r,s,o,d)=>{const{pattern:p,keys:f}=s instanceof RegExp?{keys:!1,pattern:s}:r(s||"*",d),E=p.exec(o)||[],[y,...b]=E;return y!==void 0?[!0,(()=>{const C=f!==!1?Object.fromEntries(f.map((D,k)=>[D,b[k]])):E.groups;let A={...b};return C&&Object.assign(A,C),A})(),...d?[y]:[]]:[!1,null]},TTe=r=>HD(Pp().parser,r,so()[0]),bTe=({children:r,...s})=>{var A,D;const o=Pp(),d=s.hook?sX:o;let p=d;const[f,E]=((A=s.ssrPath)==null?void 0:A.split("?"))??[];E&&(s.ssrSearch=E,s.ssrPath=f),s.hrefs=s.hrefs??((D=s.hook)==null?void 0:D.hrefs);let y=I.useRef({}),b=y.current,C=b;for(let k in d){const W=k==="base"?d[k]+(s[k]||""):s[k]||d[k];b===C&&W!==C[k]&&(y.current=C={...C}),C[k]=W,W!==d[k]&&(p=C)}return I.createElement(iX.Provider,{value:p,children:r})},b8=({children:r,component:s},o)=>s?I.createElement(s,{params:o}):typeof r=="function"?r(o):r,wTe=r=>{let s=I.useRef(aX),o=s.current;for(const d in r)r[d]!==o[d]&&(o=r);return Object.keys(r).length===0&&(o=r),s.current=o},cr=({path:r,nest:s,match:o,...d})=>{const p=Pp(),[f]=uw(p),[E,y,b]=o??HD(p.parser,r,f,s),C=wTe({...dw(),...y});if(!E)return null;const A=b?I.createElement(bTe,{base:b},b8(d,C)):b8(d,C);return I.createElement(oX.Provider,{value:C,children:A})},UT=I.forwardRef((r,s)=>{const o=Pp(),[d,p]=uw(o),{to:f="",href:E=f,onClick:y,asChild:b,children:C,className:A,replace:D,state:k,...W}=r,G=BD(B=>{B.ctrlKey||B.metaKey||B.altKey||B.shiftKey||B.button!==0||(y==null||y(B),B.defaultPrevented||(B.preventDefault(),p(E,r)))}),L=o.hrefs(E[0]==="~"?E.slice(1):o.base+E,o);return b&&I.isValidElement(C)?I.cloneElement(C,{onClick:G,href:L}):I.createElement("a",{...W,onClick:G,href:L,className:A!=null&&A.call?A(d===E):A,children:C,ref:s})}),cX=r=>Array.isArray(r)?r.flatMap(s=>cX(s&&s.type===I.Fragment?s.props.children:s)):[r],w8=({children:r,location:s})=>{const o=Pp(),[d]=uw(o);for(const p of cX(r)){let f=0;if(I.isValidElement(p)&&(f=HD(o.parser,p.props.path,s||d,p.props.nest))[0])return I.cloneElement(p,{match:f})}return null},WA=r=>{const{to:s,href:o=s}=r,[,d]=so(),p=BD(()=>d(s||o,r));return tX(()=>{p()},[]),null};var Rg=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},pp=typeof window>"u"||"Deno"in globalThis;function Ao(){}function CTe(r,s){return typeof r=="function"?r(s):r}function iP(r){return typeof r=="number"&&r>=0&&r!==1/0}function lX(r,s){return Math.max(r+(s||0)-Date.now(),0)}function Mf(r,s){return typeof r=="function"?r(s):r}function vc(r,s){return typeof r=="function"?r(s):r}function C8(r,s){const{type:o="all",exact:d,fetchStatus:p,predicate:f,queryKey:E,stale:y}=r;if(E){if(d){if(s.queryHash!==KD(E,s.options))return!1}else if(!uv(s.queryKey,E))return!1}if(o!=="all"){const b=s.isActive();if(o==="active"&&!b||o==="inactive"&&b)return!1}return!(typeof y=="boolean"&&s.isStale()!==y||p&&p!==s.state.fetchStatus||f&&!f(s))}function R8(r,s){const{exact:o,status:d,predicate:p,mutationKey:f}=r;if(f){if(!s.options.mutationKey)return!1;if(o){if(mp(s.options.mutationKey)!==mp(f))return!1}else if(!uv(s.options.mutationKey,f))return!1}return!(d&&s.state.status!==d||p&&!p(s))}function KD(r,s){return((s==null?void 0:s.queryKeyHashFn)||mp)(r)}function mp(r){return JSON.stringify(r,(s,o)=>aP(o)?Object.keys(o).sort().reduce((d,p)=>(d[p]=o[p],d),{}):o)}function uv(r,s){return r===s?!0:typeof r!=typeof s?!1:r&&s&&typeof r=="object"&&typeof s=="object"?!Object.keys(s).some(o=>!uv(r[o],s[o])):!1}function dX(r,s){if(r===s)return r;const o=x8(r)&&x8(s);if(o||aP(r)&&aP(s)){const d=o?r:Object.keys(r),p=d.length,f=o?s:Object.keys(s),E=f.length,y=o?[]:{};let b=0;for(let C=0;C<E;C++){const A=o?C:f[C];(!o&&d.includes(A)||o)&&r[A]===void 0&&s[A]===void 0?(y[A]=void 0,b++):(y[A]=dX(r[A],s[A]),y[A]===r[A]&&r[A]!==void 0&&b++)}return p===E&&b===p?r:y}return s}function yb(r,s){if(!s||Object.keys(r).length!==Object.keys(s).length)return!1;for(const o in r)if(r[o]!==s[o])return!1;return!0}function x8(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function aP(r){if(!N8(r))return!1;const s=r.constructor;if(s===void 0)return!0;const o=s.prototype;return!(!N8(o)||!o.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function N8(r){return Object.prototype.toString.call(r)==="[object Object]"}function RTe(r){return new Promise(s=>{setTimeout(s,r)})}function oP(r,s,o){return typeof o.structuralSharing=="function"?o.structuralSharing(r,s):o.structuralSharing!==!1?dX(r,s):s}function xTe(r,s,o=0){const d=[...r,s];return o&&d.length>o?d.slice(1):d}function NTe(r,s,o=0){const d=[s,...r];return o&&d.length>o?d.slice(0,-1):d}var zD=Symbol();function uX(r,s){return!r.queryFn&&(s!=null&&s.initialPromise)?()=>s.initialPromise:!r.queryFn||r.queryFn===zD?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var $h,lu,qf,qH,ITe=(qH=class extends Rg{constructor(){super();Xt(this,$h);Xt(this,lu);Xt(this,qf);bt(this,qf,s=>{if(!pp&&window.addEventListener){const o=()=>s();return window.addEventListener("visibilitychange",o,!1),()=>{window.removeEventListener("visibilitychange",o)}}})}onSubscribe(){de(this,lu)||this.setEventListener(de(this,qf))}onUnsubscribe(){var s;this.hasListeners()||((s=de(this,lu))==null||s.call(this),bt(this,lu,void 0))}setEventListener(s){var o;bt(this,qf,s),(o=de(this,lu))==null||o.call(this),bt(this,lu,s(d=>{typeof d=="boolean"?this.setFocused(d):this.onFocus()}))}setFocused(s){de(this,$h)!==s&&(bt(this,$h,s),this.onFocus())}onFocus(){const s=this.isFocused();this.listeners.forEach(o=>{o(s)})}isFocused(){var s;return typeof de(this,$h)=="boolean"?de(this,$h):((s=globalThis.document)==null?void 0:s.visibilityState)!=="hidden"}},$h=new WeakMap,lu=new WeakMap,qf=new WeakMap,qH),qD=new ITe,Yf,du,Xf,YH,ATe=(YH=class extends Rg{constructor(){super();Xt(this,Yf,!0);Xt(this,du);Xt(this,Xf);bt(this,Xf,s=>{if(!pp&&window.addEventListener){const o=()=>s(!0),d=()=>s(!1);return window.addEventListener("online",o,!1),window.addEventListener("offline",d,!1),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",d)}}})}onSubscribe(){de(this,du)||this.setEventListener(de(this,Xf))}onUnsubscribe(){var s;this.hasListeners()||((s=de(this,du))==null||s.call(this),bt(this,du,void 0))}setEventListener(s){var o;bt(this,Xf,s),(o=de(this,du))==null||o.call(this),bt(this,du,s(this.setOnline.bind(this)))}setOnline(s){de(this,Yf)!==s&&(bt(this,Yf,s),this.listeners.forEach(d=>{d(s)}))}isOnline(){return de(this,Yf)}},Yf=new WeakMap,du=new WeakMap,Xf=new WeakMap,YH),Sb=new ATe;function cP(){let r,s;const o=new Promise((p,f)=>{r=p,s=f});o.status="pending",o.catch(()=>{});function d(p){Object.assign(o,p),delete o.resolve,delete o.reject}return o.resolve=p=>{d({status:"fulfilled",value:p}),r(p)},o.reject=p=>{d({status:"rejected",reason:p}),s(p)},o}function OTe(r){return Math.min(1e3*2**r,3e4)}function hX(r){return(r??"online")==="online"?Sb.isOnline():!0}var pX=class extends Error{constructor(r){super("CancelledError"),this.revert=r==null?void 0:r.revert,this.silent=r==null?void 0:r.silent}};function HA(r){return r instanceof pX}function mX(r){let s=!1,o=0,d=!1,p;const f=cP(),E=L=>{var B;d||(k(new pX(L)),(B=r.abort)==null||B.call(r))},y=()=>{s=!0},b=()=>{s=!1},C=()=>qD.isFocused()&&(r.networkMode==="always"||Sb.isOnline())&&r.canRun(),A=()=>hX(r.networkMode)&&r.canRun(),D=L=>{var B;d||(d=!0,(B=r.onSuccess)==null||B.call(r,L),p==null||p(),f.resolve(L))},k=L=>{var B;d||(d=!0,(B=r.onError)==null||B.call(r,L),p==null||p(),f.reject(L))},W=()=>new Promise(L=>{var B;p=H=>{(d||C())&&L(H)},(B=r.onPause)==null||B.call(r)}).then(()=>{var L;p=void 0,d||(L=r.onContinue)==null||L.call(r)}),G=()=>{if(d)return;let L;const B=o===0?r.initialPromise:void 0;try{L=B??r.fn()}catch(H){L=Promise.reject(H)}Promise.resolve(L).then(D).catch(H=>{var $;if(d)return;const V=r.retry??(pp?0:3),K=r.retryDelay??OTe,Z=typeof K=="function"?K(o,H):K,ee=V===!0||typeof V=="number"&&o<V||typeof V=="function"&&V(o,H);if(s||!ee){k(H);return}o++,($=r.onFail)==null||$.call(r,o,H),RTe(Z).then(()=>C()?void 0:W()).then(()=>{s?k(H):G()})})};return{promise:f,cancel:E,continue:()=>(p==null||p(),f),cancelRetry:y,continueRetry:b,canStart:A,start:()=>(A()?G():W().then(G),f)}}function PTe(){let r=[],s=0,o=y=>{y()},d=y=>{y()},p=y=>setTimeout(y,0);const f=y=>{s?r.push(y):p(()=>{o(y)})},E=()=>{const y=r;r=[],y.length&&p(()=>{d(()=>{y.forEach(b=>{o(b)})})})};return{batch:y=>{let b;s++;try{b=y()}finally{s--,s||E()}return b},batchCalls:y=>(...b)=>{f(()=>{y(...b)})},schedule:f,setNotifyFunction:y=>{o=y},setBatchNotifyFunction:y=>{d=y},setScheduler:y=>{p=y}}}var ti=PTe(),Zh,XH,fX=(XH=class{constructor(){Xt(this,Zh)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),iP(this.gcTime)&&bt(this,Zh,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(pp?1/0:5*60*1e3))}clearGcTimeout(){de(this,Zh)&&(clearTimeout(de(this,Zh)),bt(this,Zh,void 0))}},Zh=new WeakMap,XH),Qf,Jf,Io,Bi,Ov,ep,fc,Xl,QH,DTe=(QH=class extends fX{constructor(s){super();Xt(this,fc);Xt(this,Qf);Xt(this,Jf);Xt(this,Io);Xt(this,Bi);Xt(this,Ov);Xt(this,ep);bt(this,ep,!1),bt(this,Ov,s.defaultOptions),this.setOptions(s.options),this.observers=[],bt(this,Io,s.cache),this.queryKey=s.queryKey,this.queryHash=s.queryHash,bt(this,Qf,kTe(this.options)),this.state=s.state??de(this,Qf),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var s;return(s=de(this,Bi))==null?void 0:s.promise}setOptions(s){this.options={...de(this,Ov),...s},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&de(this,Io).remove(this)}setData(s,o){const d=oP(this.state.data,s,this.options);return xn(this,fc,Xl).call(this,{data:d,type:"success",dataUpdatedAt:o==null?void 0:o.updatedAt,manual:o==null?void 0:o.manual}),d}setState(s,o){xn(this,fc,Xl).call(this,{type:"setState",state:s,setStateOptions:o})}cancel(s){var d,p;const o=(d=de(this,Bi))==null?void 0:d.promise;return(p=de(this,Bi))==null||p.cancel(s),o?o.then(Ao).catch(Ao):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(de(this,Qf))}isActive(){return this.observers.some(s=>vc(s.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===zD||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(s=>s.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(s=0){return this.state.isInvalidated||this.state.data===void 0||!lX(this.state.dataUpdatedAt,s)}onFocus(){var o;const s=this.observers.find(d=>d.shouldFetchOnWindowFocus());s==null||s.refetch({cancelRefetch:!1}),(o=de(this,Bi))==null||o.continue()}onOnline(){var o;const s=this.observers.find(d=>d.shouldFetchOnReconnect());s==null||s.refetch({cancelRefetch:!1}),(o=de(this,Bi))==null||o.continue()}addObserver(s){this.observers.includes(s)||(this.observers.push(s),this.clearGcTimeout(),de(this,Io).notify({type:"observerAdded",query:this,observer:s}))}removeObserver(s){this.observers.includes(s)&&(this.observers=this.observers.filter(o=>o!==s),this.observers.length||(de(this,Bi)&&(de(this,ep)?de(this,Bi).cancel({revert:!0}):de(this,Bi).cancelRetry()),this.scheduleGc()),de(this,Io).notify({type:"observerRemoved",query:this,observer:s}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||xn(this,fc,Xl).call(this,{type:"invalidate"})}fetch(s,o){var b,C,A;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(o!=null&&o.cancelRefetch))this.cancel({silent:!0});else if(de(this,Bi))return de(this,Bi).continueRetry(),de(this,Bi).promise}if(s&&this.setOptions(s),!this.options.queryFn){const D=this.observers.find(k=>k.options.queryFn);D&&this.setOptions(D.options)}const d=new AbortController,p=D=>{Object.defineProperty(D,"signal",{enumerable:!0,get:()=>(bt(this,ep,!0),d.signal)})},f=()=>{const D=uX(this.options,o),k={queryKey:this.queryKey,meta:this.meta};return p(k),bt(this,ep,!1),this.options.persister?this.options.persister(D,k,this):D(k)},E={fetchOptions:o,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:f};p(E),(b=this.options.behavior)==null||b.onFetch(E,this),bt(this,Jf,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((C=E.fetchOptions)==null?void 0:C.meta))&&xn(this,fc,Xl).call(this,{type:"fetch",meta:(A=E.fetchOptions)==null?void 0:A.meta});const y=D=>{var k,W,G,L;HA(D)&&D.silent||xn(this,fc,Xl).call(this,{type:"error",error:D}),HA(D)||((W=(k=de(this,Io).config).onError)==null||W.call(k,D,this),(L=(G=de(this,Io).config).onSettled)==null||L.call(G,this.state.data,D,this)),this.scheduleGc()};return bt(this,Bi,mX({initialPromise:o==null?void 0:o.initialPromise,fn:E.fetchFn,abort:d.abort.bind(d),onSuccess:D=>{var k,W,G,L;if(D===void 0){y(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(D)}catch(B){y(B);return}(W=(k=de(this,Io).config).onSuccess)==null||W.call(k,D,this),(L=(G=de(this,Io).config).onSettled)==null||L.call(G,D,this.state.error,this),this.scheduleGc()},onError:y,onFail:(D,k)=>{xn(this,fc,Xl).call(this,{type:"failed",failureCount:D,error:k})},onPause:()=>{xn(this,fc,Xl).call(this,{type:"pause"})},onContinue:()=>{xn(this,fc,Xl).call(this,{type:"continue"})},retry:E.options.retry,retryDelay:E.options.retryDelay,networkMode:E.options.networkMode,canRun:()=>!0})),de(this,Bi).start()}},Qf=new WeakMap,Jf=new WeakMap,Io=new WeakMap,Bi=new WeakMap,Ov=new WeakMap,ep=new WeakMap,fc=new WeakSet,Xl=function(s){const o=d=>{switch(s.type){case"failed":return{...d,fetchFailureCount:s.failureCount,fetchFailureReason:s.error};case"pause":return{...d,fetchStatus:"paused"};case"continue":return{...d,fetchStatus:"fetching"};case"fetch":return{...d,...gX(d.data,this.options),fetchMeta:s.meta??null};case"success":return{...d,data:s.data,dataUpdateCount:d.dataUpdateCount+1,dataUpdatedAt:s.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!s.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const p=s.error;return HA(p)&&p.revert&&de(this,Jf)?{...de(this,Jf),fetchStatus:"idle"}:{...d,error:p,errorUpdateCount:d.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:d.fetchFailureCount+1,fetchFailureReason:p,fetchStatus:"idle",status:"error"};case"invalidate":return{...d,isInvalidated:!0};case"setState":return{...d,...s.state}}};this.state=o(this.state),ti.batch(()=>{this.observers.forEach(d=>{d.onQueryUpdate()}),de(this,Io).notify({query:this,type:"updated",action:s})})},QH);function gX(r,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:hX(s.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function kTe(r){const s=typeof r.initialData=="function"?r.initialData():r.initialData,o=s!==void 0,d=o?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:o?d??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:o?"success":"pending",fetchStatus:"idle"}}var ll,JH,LTe=(JH=class extends Rg{constructor(s={}){super();Xt(this,ll);this.config=s,bt(this,ll,new Map)}build(s,o,d){const p=o.queryKey,f=o.queryHash??KD(p,o);let E=this.get(f);return E||(E=new DTe({cache:this,queryKey:p,queryHash:f,options:s.defaultQueryOptions(o),state:d,defaultOptions:s.getQueryDefaults(p)}),this.add(E)),E}add(s){de(this,ll).has(s.queryHash)||(de(this,ll).set(s.queryHash,s),this.notify({type:"added",query:s}))}remove(s){const o=de(this,ll).get(s.queryHash);o&&(s.destroy(),o===s&&de(this,ll).delete(s.queryHash),this.notify({type:"removed",query:s}))}clear(){ti.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}get(s){return de(this,ll).get(s)}getAll(){return[...de(this,ll).values()]}find(s){const o={exact:!0,...s};return this.getAll().find(d=>C8(o,d))}findAll(s={}){const o=this.getAll();return Object.keys(s).length>0?o.filter(d=>C8(s,d)):o}notify(s){ti.batch(()=>{this.listeners.forEach(o=>{o(s)})})}onFocus(){ti.batch(()=>{this.getAll().forEach(s=>{s.onFocus()})})}onOnline(){ti.batch(()=>{this.getAll().forEach(s=>{s.onOnline()})})}},ll=new WeakMap,JH),dl,ea,tp,ul,nu,$H,jTe=($H=class extends fX{constructor(s){super();Xt(this,ul);Xt(this,dl);Xt(this,ea);Xt(this,tp);this.mutationId=s.mutationId,bt(this,ea,s.mutationCache),bt(this,dl,[]),this.state=s.state||_X(),this.setOptions(s.options),this.scheduleGc()}setOptions(s){this.options=s,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(s){de(this,dl).includes(s)||(de(this,dl).push(s),this.clearGcTimeout(),de(this,ea).notify({type:"observerAdded",mutation:this,observer:s}))}removeObserver(s){bt(this,dl,de(this,dl).filter(o=>o!==s)),this.scheduleGc(),de(this,ea).notify({type:"observerRemoved",mutation:this,observer:s})}optionalRemove(){de(this,dl).length||(this.state.status==="pending"?this.scheduleGc():de(this,ea).remove(this))}continue(){var s;return((s=de(this,tp))==null?void 0:s.continue())??this.execute(this.state.variables)}async execute(s){var p,f,E,y,b,C,A,D,k,W,G,L,B,H,V,K,Z,ee,$,se;bt(this,tp,mX({fn:()=>this.options.mutationFn?this.options.mutationFn(s):Promise.reject(new Error("No mutationFn found")),onFail:(le,X)=>{xn(this,ul,nu).call(this,{type:"failed",failureCount:le,error:X})},onPause:()=>{xn(this,ul,nu).call(this,{type:"pause"})},onContinue:()=>{xn(this,ul,nu).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>de(this,ea).canRun(this)}));const o=this.state.status==="pending",d=!de(this,tp).canStart();try{if(!o){xn(this,ul,nu).call(this,{type:"pending",variables:s,isPaused:d}),await((f=(p=de(this,ea).config).onMutate)==null?void 0:f.call(p,s,this));const X=await((y=(E=this.options).onMutate)==null?void 0:y.call(E,s));X!==this.state.context&&xn(this,ul,nu).call(this,{type:"pending",context:X,variables:s,isPaused:d})}const le=await de(this,tp).start();return await((C=(b=de(this,ea).config).onSuccess)==null?void 0:C.call(b,le,s,this.state.context,this)),await((D=(A=this.options).onSuccess)==null?void 0:D.call(A,le,s,this.state.context)),await((W=(k=de(this,ea).config).onSettled)==null?void 0:W.call(k,le,null,this.state.variables,this.state.context,this)),await((L=(G=this.options).onSettled)==null?void 0:L.call(G,le,null,s,this.state.context)),xn(this,ul,nu).call(this,{type:"success",data:le}),le}catch(le){try{throw await((H=(B=de(this,ea).config).onError)==null?void 0:H.call(B,le,s,this.state.context,this)),await((K=(V=this.options).onError)==null?void 0:K.call(V,le,s,this.state.context)),await((ee=(Z=de(this,ea).config).onSettled)==null?void 0:ee.call(Z,void 0,le,this.state.variables,this.state.context,this)),await((se=($=this.options).onSettled)==null?void 0:se.call($,void 0,le,s,this.state.context)),le}finally{xn(this,ul,nu).call(this,{type:"error",error:le})}}finally{de(this,ea).runNext(this)}}},dl=new WeakMap,ea=new WeakMap,tp=new WeakMap,ul=new WeakSet,nu=function(s){const o=d=>{switch(s.type){case"failed":return{...d,failureCount:s.failureCount,failureReason:s.error};case"pause":return{...d,isPaused:!0};case"continue":return{...d,isPaused:!1};case"pending":return{...d,context:s.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:s.isPaused,status:"pending",variables:s.variables,submittedAt:Date.now()};case"success":return{...d,data:s.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...d,data:void 0,error:s.error,failureCount:d.failureCount+1,failureReason:s.error,isPaused:!1,status:"error"}}};this.state=o(this.state),ti.batch(()=>{de(this,dl).forEach(d=>{d.onMutationUpdate(s)}),de(this,ea).notify({mutation:this,type:"updated",action:s})})},$H);function _X(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var za,Pv,ZH,MTe=(ZH=class extends Rg{constructor(s={}){super();Xt(this,za);Xt(this,Pv);this.config=s,bt(this,za,new Map),bt(this,Pv,Date.now())}build(s,o,d){const p=new jTe({mutationCache:this,mutationId:++J0(this,Pv)._,options:s.defaultMutationOptions(o),state:d});return this.add(p),p}add(s){const o=gT(s),d=de(this,za).get(o)??[];d.push(s),de(this,za).set(o,d),this.notify({type:"added",mutation:s})}remove(s){var d;const o=gT(s);if(de(this,za).has(o)){const p=(d=de(this,za).get(o))==null?void 0:d.filter(f=>f!==s);p&&(p.length===0?de(this,za).delete(o):de(this,za).set(o,p))}this.notify({type:"removed",mutation:s})}canRun(s){var d;const o=(d=de(this,za).get(gT(s)))==null?void 0:d.find(p=>p.state.status==="pending");return!o||o===s}runNext(s){var d;const o=(d=de(this,za).get(gT(s)))==null?void 0:d.find(p=>p!==s&&p.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}clear(){ti.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}getAll(){return[...de(this,za).values()].flat()}find(s){const o={exact:!0,...s};return this.getAll().find(d=>R8(o,d))}findAll(s={}){return this.getAll().filter(o=>R8(s,o))}notify(s){ti.batch(()=>{this.listeners.forEach(o=>{o(s)})})}resumePausedMutations(){const s=this.getAll().filter(o=>o.state.isPaused);return ti.batch(()=>Promise.all(s.map(o=>o.continue().catch(Ao))))}},za=new WeakMap,Pv=new WeakMap,ZH);function gT(r){var s;return((s=r.options.scope)==null?void 0:s.id)??String(r.mutationId)}function I8(r){return{onFetch:(s,o)=>{var A,D,k,W,G;const d=s.options,p=(k=(D=(A=s.fetchOptions)==null?void 0:A.meta)==null?void 0:D.fetchMore)==null?void 0:k.direction,f=((W=s.state.data)==null?void 0:W.pages)||[],E=((G=s.state.data)==null?void 0:G.pageParams)||[];let y={pages:[],pageParams:[]},b=0;const C=async()=>{let L=!1;const B=K=>{Object.defineProperty(K,"signal",{enumerable:!0,get:()=>(s.signal.aborted?L=!0:s.signal.addEventListener("abort",()=>{L=!0}),s.signal)})},H=uX(s.options,s.fetchOptions),V=async(K,Z,ee)=>{if(L)return Promise.reject();if(Z==null&&K.pages.length)return Promise.resolve(K);const $={queryKey:s.queryKey,pageParam:Z,direction:ee?"backward":"forward",meta:s.options.meta};B($);const se=await H($),{maxPages:le}=s.options,X=ee?NTe:xTe;return{pages:X(K.pages,se,le),pageParams:X(K.pageParams,Z,le)}};if(p&&f.length){const K=p==="backward",Z=K?UTe:A8,ee={pages:f,pageParams:E},$=Z(d,ee);y=await V(ee,$,K)}else{const K=r??f.length;do{const Z=b===0?E[0]??d.initialPageParam:A8(d,y);if(b>0&&Z==null)break;y=await V(y,Z),b++}while(b<K)}return y};s.options.persister?s.fetchFn=()=>{var L,B;return(B=(L=s.options).persister)==null?void 0:B.call(L,C,{queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},o)}:s.fetchFn=C}}}function A8(r,{pages:s,pageParams:o}){const d=s.length-1;return s.length>0?r.getNextPageParam(s[d],s,o[d],o):void 0}function UTe(r,{pages:s,pageParams:o}){var d;return s.length>0?(d=r.getPreviousPageParam)==null?void 0:d.call(r,s[0],s,o[0],o):void 0}var As,uu,hu,$f,Zf,pu,eg,tg,eK,VTe=(eK=class{constructor(r={}){Xt(this,As);Xt(this,uu);Xt(this,hu);Xt(this,$f);Xt(this,Zf);Xt(this,pu);Xt(this,eg);Xt(this,tg);bt(this,As,r.queryCache||new LTe),bt(this,uu,r.mutationCache||new MTe),bt(this,hu,r.defaultOptions||{}),bt(this,$f,new Map),bt(this,Zf,new Map),bt(this,pu,0)}mount(){J0(this,pu)._++,de(this,pu)===1&&(bt(this,eg,qD.subscribe(async r=>{r&&(await this.resumePausedMutations(),de(this,As).onFocus())})),bt(this,tg,Sb.subscribe(async r=>{r&&(await this.resumePausedMutations(),de(this,As).onOnline())})))}unmount(){var r,s;J0(this,pu)._--,de(this,pu)===0&&((r=de(this,eg))==null||r.call(this),bt(this,eg,void 0),(s=de(this,tg))==null||s.call(this),bt(this,tg,void 0))}isFetching(r){return de(this,As).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return de(this,uu).findAll({...r,status:"pending"}).length}getQueryData(r){var o;const s=this.defaultQueryOptions({queryKey:r});return(o=de(this,As).get(s.queryHash))==null?void 0:o.state.data}ensureQueryData(r){const s=this.getQueryData(r.queryKey);if(s===void 0)return this.fetchQuery(r);{const o=this.defaultQueryOptions(r),d=de(this,As).build(this,o);return r.revalidateIfStale&&d.isStaleByTime(Mf(o.staleTime,d))&&this.prefetchQuery(o),Promise.resolve(s)}}getQueriesData(r){return de(this,As).findAll(r).map(({queryKey:s,state:o})=>{const d=o.data;return[s,d]})}setQueryData(r,s,o){const d=this.defaultQueryOptions({queryKey:r}),p=de(this,As).get(d.queryHash),f=p==null?void 0:p.state.data,E=CTe(s,f);if(E!==void 0)return de(this,As).build(this,d).setData(E,{...o,manual:!0})}setQueriesData(r,s,o){return ti.batch(()=>de(this,As).findAll(r).map(({queryKey:d})=>[d,this.setQueryData(d,s,o)]))}getQueryState(r){var o;const s=this.defaultQueryOptions({queryKey:r});return(o=de(this,As).get(s.queryHash))==null?void 0:o.state}removeQueries(r){const s=de(this,As);ti.batch(()=>{s.findAll(r).forEach(o=>{s.remove(o)})})}resetQueries(r,s){const o=de(this,As),d={type:"active",...r};return ti.batch(()=>(o.findAll(r).forEach(p=>{p.reset()}),this.refetchQueries(d,s)))}cancelQueries(r={},s={}){const o={revert:!0,...s},d=ti.batch(()=>de(this,As).findAll(r).map(p=>p.cancel(o)));return Promise.all(d).then(Ao).catch(Ao)}invalidateQueries(r={},s={}){return ti.batch(()=>{if(de(this,As).findAll(r).forEach(d=>{d.invalidate()}),r.refetchType==="none")return Promise.resolve();const o={...r,type:r.refetchType??r.type??"active"};return this.refetchQueries(o,s)})}refetchQueries(r={},s){const o={...s,cancelRefetch:(s==null?void 0:s.cancelRefetch)??!0},d=ti.batch(()=>de(this,As).findAll(r).filter(p=>!p.isDisabled()).map(p=>{let f=p.fetch(void 0,o);return o.throwOnError||(f=f.catch(Ao)),p.state.fetchStatus==="paused"?Promise.resolve():f}));return Promise.all(d).then(Ao)}fetchQuery(r){const s=this.defaultQueryOptions(r);s.retry===void 0&&(s.retry=!1);const o=de(this,As).build(this,s);return o.isStaleByTime(Mf(s.staleTime,o))?o.fetch(s):Promise.resolve(o.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(Ao).catch(Ao)}fetchInfiniteQuery(r){return r.behavior=I8(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(Ao).catch(Ao)}ensureInfiniteQueryData(r){return r.behavior=I8(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return Sb.isOnline()?de(this,uu).resumePausedMutations():Promise.resolve()}getQueryCache(){return de(this,As)}getMutationCache(){return de(this,uu)}getDefaultOptions(){return de(this,hu)}setDefaultOptions(r){bt(this,hu,r)}setQueryDefaults(r,s){de(this,$f).set(mp(r),{queryKey:r,defaultOptions:s})}getQueryDefaults(r){const s=[...de(this,$f).values()];let o={};return s.forEach(d=>{uv(r,d.queryKey)&&(o={...o,...d.defaultOptions})}),o}setMutationDefaults(r,s){de(this,Zf).set(mp(r),{mutationKey:r,defaultOptions:s})}getMutationDefaults(r){const s=[...de(this,Zf).values()];let o={};return s.forEach(d=>{uv(r,d.mutationKey)&&(o={...o,...d.defaultOptions})}),o}defaultQueryOptions(r){if(r._defaulted)return r;const s={...de(this,hu).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return s.queryHash||(s.queryHash=KD(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.enabled!==!0&&s.queryFn===zD&&(s.enabled=!1),s}defaultMutationOptions(r){return r!=null&&r._defaulted?r:{...de(this,hu).mutations,...(r==null?void 0:r.mutationKey)&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){de(this,As).clear(),de(this,uu).clear()}},As=new WeakMap,uu=new WeakMap,hu=new WeakMap,$f=new WeakMap,Zf=new WeakMap,pu=new WeakMap,eg=new WeakMap,tg=new WeakMap,eK),Ca,Jn,Dv,ta,np,ng,mu,hl,kv,rg,sg,rp,sp,fu,ig,br,OE,lP,dP,uP,hP,pP,mP,fP,EX,tK,FTe=(tK=class extends Rg{constructor(s,o){super();Xt(this,br);Xt(this,Ca);Xt(this,Jn);Xt(this,Dv);Xt(this,ta);Xt(this,np);Xt(this,ng);Xt(this,mu);Xt(this,hl);Xt(this,kv);Xt(this,rg);Xt(this,sg);Xt(this,rp);Xt(this,sp);Xt(this,fu);Xt(this,ig,new Set);this.options=o,bt(this,Ca,s),bt(this,hl,null),bt(this,mu,cP()),this.options.experimental_prefetchInRender||de(this,mu).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(o)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(de(this,Jn).addObserver(this),O8(de(this,Jn),this.options)?xn(this,br,OE).call(this):this.updateResult(),xn(this,br,hP).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return gP(de(this,Jn),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return gP(de(this,Jn),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,xn(this,br,pP).call(this),xn(this,br,mP).call(this),de(this,Jn).removeObserver(this)}setOptions(s,o){const d=this.options,p=de(this,Jn);if(this.options=de(this,Ca).defaultQueryOptions(s),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof vc(this.options.enabled,de(this,Jn))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");xn(this,br,fP).call(this),de(this,Jn).setOptions(this.options),d._defaulted&&!yb(this.options,d)&&de(this,Ca).getQueryCache().notify({type:"observerOptionsUpdated",query:de(this,Jn),observer:this});const f=this.hasListeners();f&&P8(de(this,Jn),p,this.options,d)&&xn(this,br,OE).call(this),this.updateResult(o),f&&(de(this,Jn)!==p||vc(this.options.enabled,de(this,Jn))!==vc(d.enabled,de(this,Jn))||Mf(this.options.staleTime,de(this,Jn))!==Mf(d.staleTime,de(this,Jn)))&&xn(this,br,lP).call(this);const E=xn(this,br,dP).call(this);f&&(de(this,Jn)!==p||vc(this.options.enabled,de(this,Jn))!==vc(d.enabled,de(this,Jn))||E!==de(this,fu))&&xn(this,br,uP).call(this,E)}getOptimisticResult(s){const o=de(this,Ca).getQueryCache().build(de(this,Ca),s),d=this.createResult(o,s);return GTe(this,d)&&(bt(this,ta,d),bt(this,ng,this.options),bt(this,np,de(this,Jn).state)),d}getCurrentResult(){return de(this,ta)}trackResult(s,o){const d={};return Object.keys(s).forEach(p=>{Object.defineProperty(d,p,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(p),o==null||o(p),s[p])})}),d}trackProp(s){de(this,ig).add(s)}getCurrentQuery(){return de(this,Jn)}refetch({...s}={}){return this.fetch({...s})}fetchOptimistic(s){const o=de(this,Ca).defaultQueryOptions(s),d=de(this,Ca).getQueryCache().build(de(this,Ca),o);return d.fetch().then(()=>this.createResult(d,o))}fetch(s){return xn(this,br,OE).call(this,{...s,cancelRefetch:s.cancelRefetch??!0}).then(()=>(this.updateResult(),de(this,ta)))}createResult(s,o){var le;const d=de(this,Jn),p=this.options,f=de(this,ta),E=de(this,np),y=de(this,ng),C=s!==d?s.state:de(this,Dv),{state:A}=s;let D={...A},k=!1,W;if(o._optimisticResults){const X=this.hasListeners(),oe=!X&&O8(s,o),je=X&&P8(s,d,o,p);(oe||je)&&(D={...D,...gX(A.data,s.options)}),o._optimisticResults==="isRestoring"&&(D.fetchStatus="idle")}let{error:G,errorUpdatedAt:L,status:B}=D;if(o.select&&D.data!==void 0)if(f&&D.data===(E==null?void 0:E.data)&&o.select===de(this,kv))W=de(this,rg);else try{bt(this,kv,o.select),W=o.select(D.data),W=oP(f==null?void 0:f.data,W,o),bt(this,rg,W),bt(this,hl,null)}catch(X){bt(this,hl,X)}else W=D.data;if(o.placeholderData!==void 0&&W===void 0&&B==="pending"){let X;if(f!=null&&f.isPlaceholderData&&o.placeholderData===(y==null?void 0:y.placeholderData))X=f.data;else if(X=typeof o.placeholderData=="function"?o.placeholderData((le=de(this,sg))==null?void 0:le.state.data,de(this,sg)):o.placeholderData,o.select&&X!==void 0)try{X=o.select(X),bt(this,hl,null)}catch(oe){bt(this,hl,oe)}X!==void 0&&(B="success",W=oP(f==null?void 0:f.data,X,o),k=!0)}de(this,hl)&&(G=de(this,hl),W=de(this,rg),L=Date.now(),B="error");const H=D.fetchStatus==="fetching",V=B==="pending",K=B==="error",Z=V&&H,ee=W!==void 0,se={status:B,fetchStatus:D.fetchStatus,isPending:V,isSuccess:B==="success",isError:K,isInitialLoading:Z,isLoading:Z,data:W,dataUpdatedAt:D.dataUpdatedAt,error:G,errorUpdatedAt:L,failureCount:D.fetchFailureCount,failureReason:D.fetchFailureReason,errorUpdateCount:D.errorUpdateCount,isFetched:D.dataUpdateCount>0||D.errorUpdateCount>0,isFetchedAfterMount:D.dataUpdateCount>C.dataUpdateCount||D.errorUpdateCount>C.errorUpdateCount,isFetching:H,isRefetching:H&&!V,isLoadingError:K&&!ee,isPaused:D.fetchStatus==="paused",isPlaceholderData:k,isRefetchError:K&&ee,isStale:YD(s,o),refetch:this.refetch,promise:de(this,mu)};if(this.options.experimental_prefetchInRender){const X=Ce=>{se.status==="error"?Ce.reject(se.error):se.data!==void 0&&Ce.resolve(se.data)},oe=()=>{const Ce=bt(this,mu,se.promise=cP());X(Ce)},je=de(this,mu);switch(je.status){case"pending":s.queryHash===d.queryHash&&X(je);break;case"fulfilled":(se.status==="error"||se.data!==je.value)&&oe();break;case"rejected":(se.status!=="error"||se.error!==je.reason)&&oe();break}}return se}updateResult(s){const o=de(this,ta),d=this.createResult(de(this,Jn),this.options);if(bt(this,np,de(this,Jn).state),bt(this,ng,this.options),de(this,np).data!==void 0&&bt(this,sg,de(this,Jn)),yb(d,o))return;bt(this,ta,d);const p={},f=()=>{if(!o)return!0;const{notifyOnChangeProps:E}=this.options,y=typeof E=="function"?E():E;if(y==="all"||!y&&!de(this,ig).size)return!0;const b=new Set(y??de(this,ig));return this.options.throwOnError&&b.add("error"),Object.keys(de(this,ta)).some(C=>{const A=C;return de(this,ta)[A]!==o[A]&&b.has(A)})};(s==null?void 0:s.listeners)!==!1&&f()&&(p.listeners=!0),xn(this,br,EX).call(this,{...p,...s})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&xn(this,br,hP).call(this)}},Ca=new WeakMap,Jn=new WeakMap,Dv=new WeakMap,ta=new WeakMap,np=new WeakMap,ng=new WeakMap,mu=new WeakMap,hl=new WeakMap,kv=new WeakMap,rg=new WeakMap,sg=new WeakMap,rp=new WeakMap,sp=new WeakMap,fu=new WeakMap,ig=new WeakMap,br=new WeakSet,OE=function(s){xn(this,br,fP).call(this);let o=de(this,Jn).fetch(this.options,s);return s!=null&&s.throwOnError||(o=o.catch(Ao)),o},lP=function(){xn(this,br,pP).call(this);const s=Mf(this.options.staleTime,de(this,Jn));if(pp||de(this,ta).isStale||!iP(s))return;const d=lX(de(this,ta).dataUpdatedAt,s)+1;bt(this,rp,setTimeout(()=>{de(this,ta).isStale||this.updateResult()},d))},dP=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(de(this,Jn)):this.options.refetchInterval)??!1},uP=function(s){xn(this,br,mP).call(this),bt(this,fu,s),!(pp||vc(this.options.enabled,de(this,Jn))===!1||!iP(de(this,fu))||de(this,fu)===0)&&bt(this,sp,setInterval(()=>{(this.options.refetchIntervalInBackground||qD.isFocused())&&xn(this,br,OE).call(this)},de(this,fu)))},hP=function(){xn(this,br,lP).call(this),xn(this,br,uP).call(this,xn(this,br,dP).call(this))},pP=function(){de(this,rp)&&(clearTimeout(de(this,rp)),bt(this,rp,void 0))},mP=function(){de(this,sp)&&(clearInterval(de(this,sp)),bt(this,sp,void 0))},fP=function(){const s=de(this,Ca).getQueryCache().build(de(this,Ca),this.options);if(s===de(this,Jn))return;const o=de(this,Jn);bt(this,Jn,s),bt(this,Dv,s.state),this.hasListeners()&&(o==null||o.removeObserver(this),s.addObserver(this))},EX=function(s){ti.batch(()=>{s.listeners&&this.listeners.forEach(o=>{o(de(this,ta))}),de(this,Ca).getQueryCache().notify({query:de(this,Jn),type:"observerResultsUpdated"})})},tK);function BTe(r,s){return vc(s.enabled,r)!==!1&&r.state.data===void 0&&!(r.state.status==="error"&&s.retryOnMount===!1)}function O8(r,s){return BTe(r,s)||r.state.data!==void 0&&gP(r,s,s.refetchOnMount)}function gP(r,s,o){if(vc(s.enabled,r)!==!1){const d=typeof o=="function"?o(r):o;return d==="always"||d!==!1&&YD(r,s)}return!1}function P8(r,s,o,d){return(r!==s||vc(d.enabled,r)===!1)&&(!o.suspense||r.state.status!=="error")&&YD(r,o)}function YD(r,s){return vc(s.enabled,r)!==!1&&r.isStaleByTime(Mf(s.staleTime,r))}function GTe(r,s){return!yb(r.getCurrentResult(),s)}var gu,_u,Ra,ed,cd,VT,_P,nK,WTe=(nK=class extends Rg{constructor(o,d){super();Xt(this,cd);Xt(this,gu);Xt(this,_u);Xt(this,Ra);Xt(this,ed);bt(this,gu,o),this.setOptions(d),this.bindMethods(),xn(this,cd,VT).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(o){var p;const d=this.options;this.options=de(this,gu).defaultMutationOptions(o),yb(this.options,d)||de(this,gu).getMutationCache().notify({type:"observerOptionsUpdated",mutation:de(this,Ra),observer:this}),d!=null&&d.mutationKey&&this.options.mutationKey&&mp(d.mutationKey)!==mp(this.options.mutationKey)?this.reset():((p=de(this,Ra))==null?void 0:p.state.status)==="pending"&&de(this,Ra).setOptions(this.options)}onUnsubscribe(){var o;this.hasListeners()||(o=de(this,Ra))==null||o.removeObserver(this)}onMutationUpdate(o){xn(this,cd,VT).call(this),xn(this,cd,_P).call(this,o)}getCurrentResult(){return de(this,_u)}reset(){var o;(o=de(this,Ra))==null||o.removeObserver(this),bt(this,Ra,void 0),xn(this,cd,VT).call(this),xn(this,cd,_P).call(this)}mutate(o,d){var p;return bt(this,ed,d),(p=de(this,Ra))==null||p.removeObserver(this),bt(this,Ra,de(this,gu).getMutationCache().build(de(this,gu),this.options)),de(this,Ra).addObserver(this),de(this,Ra).execute(o)}},gu=new WeakMap,_u=new WeakMap,Ra=new WeakMap,ed=new WeakMap,cd=new WeakSet,VT=function(){var d;const o=((d=de(this,Ra))==null?void 0:d.state)??_X();bt(this,_u,{...o,isPending:o.status==="pending",isSuccess:o.status==="success",isError:o.status==="error",isIdle:o.status==="idle",mutate:this.mutate,reset:this.reset})},_P=function(o){ti.batch(()=>{var d,p,f,E,y,b,C,A;if(de(this,ed)&&this.hasListeners()){const D=de(this,_u).variables,k=de(this,_u).context;(o==null?void 0:o.type)==="success"?((p=(d=de(this,ed)).onSuccess)==null||p.call(d,o.data,D,k),(E=(f=de(this,ed)).onSettled)==null||E.call(f,o.data,null,D,k)):(o==null?void 0:o.type)==="error"&&((b=(y=de(this,ed)).onError)==null||b.call(y,o.error,D,k),(A=(C=de(this,ed)).onSettled)==null||A.call(C,void 0,o.error,D,k))}this.listeners.forEach(D=>{D(de(this,_u))})})},nK),vX=I.createContext(void 0),Dp=r=>{const s=I.useContext(vX);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},HTe=({client:r,children:s})=>(I.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),c.jsx(vX.Provider,{value:r,children:s})),yX=I.createContext(!1),KTe=()=>I.useContext(yX);yX.Provider;function zTe(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}var qTe=I.createContext(zTe()),YTe=()=>I.useContext(qTe);function SX(r,s){return typeof r=="function"?r(...s):!!r}function EP(){}var XTe=(r,s)=>{(r.suspense||r.throwOnError||r.experimental_prefetchInRender)&&(s.isReset()||(r.retryOnMount=!1))},QTe=r=>{I.useEffect(()=>{r.clearReset()},[r])},JTe=({result:r,errorResetBoundary:s,throwOnError:o,query:d})=>r.isError&&!s.isReset()&&!r.isFetching&&d&&SX(o,[r.error,d]),$Te=r=>{r.suspense&&(r.staleTime===void 0&&(r.staleTime=1e3),typeof r.gcTime=="number"&&(r.gcTime=Math.max(r.gcTime,1e3)))},ZTe=(r,s)=>r.isLoading&&r.isFetching&&!s,ebe=(r,s)=>(r==null?void 0:r.suspense)&&s.isPending,D8=(r,s,o)=>s.fetchOptimistic(r).catch(()=>{o.clearReset()});function tbe(r,s,o){var A,D,k,W,G;const d=Dp(),p=KTe(),f=YTe(),E=d.defaultQueryOptions(r);(D=(A=d.getDefaultOptions().queries)==null?void 0:A._experimental_beforeQuery)==null||D.call(A,E),E._optimisticResults=p?"isRestoring":"optimistic",$Te(E),XTe(E,f),QTe(f);const y=!d.getQueryCache().get(E.queryHash),[b]=I.useState(()=>new s(d,E)),C=b.getOptimisticResult(E);if(I.useSyncExternalStore(I.useCallback(L=>{const B=p?EP:b.subscribe(ti.batchCalls(L));return b.updateResult(),B},[b,p]),()=>b.getCurrentResult(),()=>b.getCurrentResult()),I.useEffect(()=>{b.setOptions(E,{listeners:!1})},[E,b]),ebe(E,C))throw D8(E,b,f);if(JTe({result:C,errorResetBoundary:f,throwOnError:E.throwOnError,query:d.getQueryCache().get(E.queryHash)}))throw C.error;if((W=(k=d.getDefaultOptions().queries)==null?void 0:k._experimental_afterQuery)==null||W.call(k,E,C),E.experimental_prefetchInRender&&!pp&&ZTe(C,p)){const L=y?D8(E,b,f):(G=d.getQueryCache().get(E.queryHash))==null?void 0:G.promise;L==null||L.catch(EP).finally(()=>{b.updateResult()})}return E.notifyOnChangeProps?C:b.trackResult(C)}function In(r,s){return tbe(r,FTe)}function Lr(r,s){const o=Dp(),[d]=I.useState(()=>new WTe(o,r));I.useEffect(()=>{d.setOptions(r)},[d,r]);const p=I.useSyncExternalStore(I.useCallback(E=>d.subscribe(ti.batchCalls(E)),[d]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),f=I.useCallback((E,y)=>{d.mutate(E,y).catch(EP)},[d]);if(p.error&&SX(d.options.throwOnError,[p.error]))throw p.error;return{...p,mutate:f,mutateAsync:p.mutate}}async function TX(r){if(!r.ok){const s=await r.text()||r.statusText;throw new Error(`${r.status}: ${s}`)}}async function Ot(r,s,o){const d=await fetch(s,{method:r,headers:o?{"Content-Type":"application/json"}:{},body:o?JSON.stringify(o):void 0,credentials:"include"});return await TX(d),d}const nbe=({on401:r})=>async({queryKey:s})=>{const o=await fetch(s.join("/"),{credentials:"include"});return r==="returnNull"&&o.status===401?null:(await TX(o),await o.json())},Nc=new VTe({defaultOptions:{queries:{queryFn:nbe({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}}),rbe=1,sbe=1e6;let KA=0;function ibe(){return KA=(KA+1)%Number.MAX_SAFE_INTEGER,KA.toString()}const zA=new Map,k8=r=>{if(zA.has(r))return;const s=setTimeout(()=>{zA.delete(r),HE({type:"REMOVE_TOAST",toastId:r})},sbe);zA.set(r,s)},abe=(r,s)=>{switch(s.type){case"ADD_TOAST":return{...r,toasts:[s.toast,...r.toasts].slice(0,rbe)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(o=>o.id===s.toast.id?{...o,...s.toast}:o)};case"DISMISS_TOAST":{const{toastId:o}=s;return o?k8(o):r.toasts.forEach(d=>{k8(d.id)}),{...r,toasts:r.toasts.map(d=>d.id===o||o===void 0?{...d,open:!1}:d)}}case"REMOVE_TOAST":return s.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(o=>o.id!==s.toastId)}}},FT=[];let BT={toasts:[]};function HE(r){BT=abe(BT,r),FT.forEach(s=>{s(BT)})}function obe({...r}){const s=ibe(),o=p=>HE({type:"UPDATE_TOAST",toast:{...p,id:s}}),d=()=>HE({type:"DISMISS_TOAST",toastId:s});return HE({type:"ADD_TOAST",toast:{...r,id:s,open:!0,onOpenChange:p=>{p||d()}}}),{id:s,dismiss:d,update:o}}function jr(){const[r,s]=I.useState(BT);return I.useEffect(()=>(FT.push(s),()=>{const o=FT.indexOf(s);o>-1&&FT.splice(o,1)}),[r]),{...r,toast:obe,dismiss:o=>HE({type:"DISMISS_TOAST",toastId:o})}}function Vt(r,s,{checkForDefaultPrevented:o=!0}={}){return function(p){if(r==null||r(p),o===!1||!p.defaultPrevented)return s==null?void 0:s(p)}}function L8(r,s){if(typeof r=="function")return r(s);r!=null&&(r.current=s)}function bX(...r){return s=>{let o=!1;const d=r.map(p=>{const f=L8(p,s);return!o&&typeof f=="function"&&(o=!0),f});if(o)return()=>{for(let p=0;p<d.length;p++){const f=d[p];typeof f=="function"?f():L8(r[p],null)}}}}function Zn(...r){return I.useCallback(bX(...r),r)}function cbe(r,s){const o=I.createContext(s),d=f=>{const{children:E,...y}=f,b=I.useMemo(()=>y,Object.values(y));return c.jsx(o.Provider,{value:b,children:E})};d.displayName=r+"Provider";function p(f){const E=I.useContext(o);if(E)return E;if(s!==void 0)return s;throw new Error(`\`${f}\` must be used within \`${r}\``)}return[d,p]}function Vo(r,s=[]){let o=[];function d(f,E){const y=I.createContext(E),b=o.length;o=[...o,E];const C=D=>{var H;const{scope:k,children:W,...G}=D,L=((H=k==null?void 0:k[r])==null?void 0:H[b])||y,B=I.useMemo(()=>G,Object.values(G));return c.jsx(L.Provider,{value:B,children:W})};C.displayName=f+"Provider";function A(D,k){var L;const W=((L=k==null?void 0:k[r])==null?void 0:L[b])||y,G=I.useContext(W);if(G)return G;if(E!==void 0)return E;throw new Error(`\`${D}\` must be used within \`${f}\``)}return[C,A]}const p=()=>{const f=o.map(E=>I.createContext(E));return function(y){const b=(y==null?void 0:y[r])||f;return I.useMemo(()=>({[`__scope${r}`]:{...y,[r]:b}}),[y,b])}};return p.scopeName=r,[d,lbe(p,...s)]}function lbe(...r){const s=r[0];if(r.length===1)return s;const o=()=>{const d=r.map(p=>({useScope:p(),scopeName:p.scopeName}));return function(f){const E=d.reduce((y,{useScope:b,scopeName:C})=>{const D=b(f)[`__scope${C}`];return{...y,...D}},{});return I.useMemo(()=>({[`__scope${s.scopeName}`]:E}),[E])}};return o.scopeName=s.scopeName,o}function mg(r){const s=dbe(r),o=I.forwardRef((d,p)=>{const{children:f,...E}=d,y=I.Children.toArray(f),b=y.find(ube);if(b){const C=b.props.children,A=y.map(D=>D===b?I.Children.count(C)>1?I.Children.only(null):I.isValidElement(C)?C.props.children:null:D);return c.jsx(s,{...E,ref:p,children:I.isValidElement(C)?I.cloneElement(C,void 0,A):null})}return c.jsx(s,{...E,ref:p,children:f})});return o.displayName=`${r}.Slot`,o}var hw=mg("Slot");function dbe(r){const s=I.forwardRef((o,d)=>{const{children:p,...f}=o;if(I.isValidElement(p)){const E=pbe(p),y=hbe(f,p.props);return p.type!==I.Fragment&&(y.ref=d?bX(d,E):E),I.cloneElement(p,y)}return I.Children.count(p)>1?I.Children.only(null):null});return s.displayName=`${r}.SlotClone`,s}var wX=Symbol("radix.slottable");function CX(r){const s=({children:o})=>c.jsx(c.Fragment,{children:o});return s.displayName=`${r}.Slottable`,s.__radixId=wX,s}function ube(r){return I.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===wX}function hbe(r,s){const o={...s};for(const d in s){const p=r[d],f=s[d];/^on[A-Z]/.test(d)?p&&f?o[d]=(...y)=>{f(...y),p(...y)}:p&&(o[d]=p):d==="style"?o[d]={...p,...f}:d==="className"&&(o[d]=[p,f].filter(Boolean).join(" "))}return{...r,...o}}function pbe(r){var d,p;let s=(d=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:d.get,o=s&&"isReactWarning"in s&&s.isReactWarning;return o?r.ref:(s=(p=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:p.get,o=s&&"isReactWarning"in s&&s.isReactWarning,o?r.props.ref:r.props.ref||r.ref)}function XD(r){const s=r+"CollectionProvider",[o,d]=Vo(s),[p,f]=o(s,{collectionRef:{current:null},itemMap:new Map}),E=L=>{const{scope:B,children:H}=L,V=En.useRef(null),K=En.useRef(new Map).current;return c.jsx(p,{scope:B,itemMap:K,collectionRef:V,children:H})};E.displayName=s;const y=r+"CollectionSlot",b=mg(y),C=En.forwardRef((L,B)=>{const{scope:H,children:V}=L,K=f(y,H),Z=Zn(B,K.collectionRef);return c.jsx(b,{ref:Z,children:V})});C.displayName=y;const A=r+"CollectionItemSlot",D="data-radix-collection-item",k=mg(A),W=En.forwardRef((L,B)=>{const{scope:H,children:V,...K}=L,Z=En.useRef(null),ee=Zn(B,Z),$=f(A,H);return En.useEffect(()=>($.itemMap.set(Z,{ref:Z,...K}),()=>void $.itemMap.delete(Z))),c.jsx(k,{[D]:"",ref:ee,children:V})});W.displayName=A;function G(L){const B=f(r+"CollectionConsumer",L);return En.useCallback(()=>{const V=B.collectionRef.current;if(!V)return[];const K=Array.from(V.querySelectorAll(`[${D}]`));return Array.from(B.itemMap.values()).sort(($,se)=>K.indexOf($.ref.current)-K.indexOf(se.ref.current))},[B.collectionRef,B.itemMap])}return[{Provider:E,Slot:C,ItemSlot:W},G,d]}var mbe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$t=mbe.reduce((r,s)=>{const o=mg(`Primitive.${s}`),d=I.forwardRef((p,f)=>{const{asChild:E,...y}=p,b=E?o:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),c.jsx(b,{...y,ref:f})});return d.displayName=`Primitive.${s}`,{...r,[s]:d}},{});function RX(r,s){r&&Op.flushSync(()=>r.dispatchEvent(s))}function Ps(r){const s=I.useRef(r);return I.useEffect(()=>{s.current=r}),I.useMemo(()=>(...o)=>{var d;return(d=s.current)==null?void 0:d.call(s,...o)},[])}function fbe(r,s=globalThis==null?void 0:globalThis.document){const o=Ps(r);I.useEffect(()=>{const d=p=>{p.key==="Escape"&&o(p)};return s.addEventListener("keydown",d,{capture:!0}),()=>s.removeEventListener("keydown",d,{capture:!0})},[o,s])}var gbe="DismissableLayer",vP="dismissableLayer.update",_be="dismissableLayer.pointerDownOutside",Ebe="dismissableLayer.focusOutside",j8,xX=I.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Fv=I.forwardRef((r,s)=>{const{disableOutsidePointerEvents:o=!1,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:E,onDismiss:y,...b}=r,C=I.useContext(xX),[A,D]=I.useState(null),k=(A==null?void 0:A.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,W]=I.useState({}),G=Zn(s,se=>D(se)),L=Array.from(C.layers),[B]=[...C.layersWithOutsidePointerEventsDisabled].slice(-1),H=L.indexOf(B),V=A?L.indexOf(A):-1,K=C.layersWithOutsidePointerEventsDisabled.size>0,Z=V>=H,ee=ybe(se=>{const le=se.target,X=[...C.branches].some(oe=>oe.contains(le));!Z||X||(p==null||p(se),E==null||E(se),se.defaultPrevented||y==null||y())},k),$=Sbe(se=>{const le=se.target;[...C.branches].some(oe=>oe.contains(le))||(f==null||f(se),E==null||E(se),se.defaultPrevented||y==null||y())},k);return fbe(se=>{V===C.layers.size-1&&(d==null||d(se),!se.defaultPrevented&&y&&(se.preventDefault(),y()))},k),I.useEffect(()=>{if(A)return o&&(C.layersWithOutsidePointerEventsDisabled.size===0&&(j8=k.body.style.pointerEvents,k.body.style.pointerEvents="none"),C.layersWithOutsidePointerEventsDisabled.add(A)),C.layers.add(A),M8(),()=>{o&&C.layersWithOutsidePointerEventsDisabled.size===1&&(k.body.style.pointerEvents=j8)}},[A,k,o,C]),I.useEffect(()=>()=>{A&&(C.layers.delete(A),C.layersWithOutsidePointerEventsDisabled.delete(A),M8())},[A,C]),I.useEffect(()=>{const se=()=>W({});return document.addEventListener(vP,se),()=>document.removeEventListener(vP,se)},[]),c.jsx($t.div,{...b,ref:G,style:{pointerEvents:K?Z?"auto":"none":void 0,...r.style},onFocusCapture:Vt(r.onFocusCapture,$.onFocusCapture),onBlurCapture:Vt(r.onBlurCapture,$.onBlurCapture),onPointerDownCapture:Vt(r.onPointerDownCapture,ee.onPointerDownCapture)})});Fv.displayName=gbe;var vbe="DismissableLayerBranch",NX=I.forwardRef((r,s)=>{const o=I.useContext(xX),d=I.useRef(null),p=Zn(s,d);return I.useEffect(()=>{const f=d.current;if(f)return o.branches.add(f),()=>{o.branches.delete(f)}},[o.branches]),c.jsx($t.div,{...r,ref:p})});NX.displayName=vbe;function ybe(r,s=globalThis==null?void 0:globalThis.document){const o=Ps(r),d=I.useRef(!1),p=I.useRef(()=>{});return I.useEffect(()=>{const f=y=>{if(y.target&&!d.current){let b=function(){IX(_be,o,C,{discrete:!0})};const C={originalEvent:y};y.pointerType==="touch"?(s.removeEventListener("click",p.current),p.current=b,s.addEventListener("click",p.current,{once:!0})):b()}else s.removeEventListener("click",p.current);d.current=!1},E=window.setTimeout(()=>{s.addEventListener("pointerdown",f)},0);return()=>{window.clearTimeout(E),s.removeEventListener("pointerdown",f),s.removeEventListener("click",p.current)}},[s,o]),{onPointerDownCapture:()=>d.current=!0}}function Sbe(r,s=globalThis==null?void 0:globalThis.document){const o=Ps(r),d=I.useRef(!1);return I.useEffect(()=>{const p=f=>{f.target&&!d.current&&IX(Ebe,o,{originalEvent:f},{discrete:!1})};return s.addEventListener("focusin",p),()=>s.removeEventListener("focusin",p)},[s,o]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}function M8(){const r=new CustomEvent(vP);document.dispatchEvent(r)}function IX(r,s,o,{discrete:d}){const p=o.originalEvent.target,f=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:o});s&&p.addEventListener(r,s,{once:!0}),d?RX(p,f):p.dispatchEvent(f)}var Tbe=Fv,bbe=NX,qs=globalThis!=null&&globalThis.document?I.useLayoutEffect:()=>{},wbe="Portal",pw=I.forwardRef((r,s)=>{var y;const{container:o,...d}=r,[p,f]=I.useState(!1);qs(()=>f(!0),[]);const E=o||p&&((y=globalThis==null?void 0:globalThis.document)==null?void 0:y.body);return E?q0e.createPortal(c.jsx($t.div,{...d,ref:s}),E):null});pw.displayName=wbe;function Cbe(r,s){return I.useReducer((o,d)=>s[o][d]??o,r)}var Dc=r=>{const{present:s,children:o}=r,d=Rbe(s),p=typeof o=="function"?o({present:d.isPresent}):I.Children.only(o),f=Zn(d.ref,xbe(p));return typeof o=="function"||d.isPresent?I.cloneElement(p,{ref:f}):null};Dc.displayName="Presence";function Rbe(r){const[s,o]=I.useState(),d=I.useRef({}),p=I.useRef(r),f=I.useRef("none"),E=r?"mounted":"unmounted",[y,b]=Cbe(E,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return I.useEffect(()=>{const C=_T(d.current);f.current=y==="mounted"?C:"none"},[y]),qs(()=>{const C=d.current,A=p.current;if(A!==r){const k=f.current,W=_T(C);r?b("MOUNT"):W==="none"||(C==null?void 0:C.display)==="none"?b("UNMOUNT"):b(A&&k!==W?"ANIMATION_OUT":"UNMOUNT"),p.current=r}},[r,b]),qs(()=>{if(s){let C;const A=s.ownerDocument.defaultView??window,D=W=>{const L=_T(d.current).includes(W.animationName);if(W.target===s&&L&&(b("ANIMATION_END"),!p.current)){const B=s.style.animationFillMode;s.style.animationFillMode="forwards",C=A.setTimeout(()=>{s.style.animationFillMode==="forwards"&&(s.style.animationFillMode=B)})}},k=W=>{W.target===s&&(f.current=_T(d.current))};return s.addEventListener("animationstart",k),s.addEventListener("animationcancel",D),s.addEventListener("animationend",D),()=>{A.clearTimeout(C),s.removeEventListener("animationstart",k),s.removeEventListener("animationcancel",D),s.removeEventListener("animationend",D)}}else b("ANIMATION_END")},[s,b]),{isPresent:["mounted","unmountSuspended"].includes(y),ref:I.useCallback(C=>{C&&(d.current=getComputedStyle(C)),o(C)},[])}}function _T(r){return(r==null?void 0:r.animationName)||"none"}function xbe(r){var d,p;let s=(d=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:d.get,o=s&&"isReactWarning"in s&&s.isReactWarning;return o?r.ref:(s=(p=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:p.get,o=s&&"isReactWarning"in s&&s.isReactWarning,o?r.props.ref:r.props.ref||r.ref)}function Du({prop:r,defaultProp:s,onChange:o=()=>{}}){const[d,p]=Nbe({defaultProp:s,onChange:o}),f=r!==void 0,E=f?r:d,y=Ps(o),b=I.useCallback(C=>{if(f){const D=typeof C=="function"?C(r):C;D!==r&&y(D)}else p(C)},[f,r,p,y]);return[E,b]}function Nbe({defaultProp:r,onChange:s}){const o=I.useState(r),[d]=o,p=I.useRef(d),f=Ps(s);return I.useEffect(()=>{p.current!==d&&(f(d),p.current=d)},[d,p,f]),o}var Ibe="VisuallyHidden",Bv=I.forwardRef((r,s)=>c.jsx($t.span,{...r,ref:s,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...r.style}}));Bv.displayName=Ibe;var Abe=Bv,QD="ToastProvider",[JD,Obe,Pbe]=XD("Toast"),[AX,O1e]=Vo("Toast",[Pbe]),[Dbe,mw]=AX(QD),OX=r=>{const{__scopeToast:s,label:o="Notification",duration:d=5e3,swipeDirection:p="right",swipeThreshold:f=50,children:E}=r,[y,b]=I.useState(null),[C,A]=I.useState(0),D=I.useRef(!1),k=I.useRef(!1);return o.trim()||console.error(`Invalid prop \`label\` supplied to \`${QD}\`. Expected non-empty \`string\`.`),c.jsx(JD.Provider,{scope:s,children:c.jsx(Dbe,{scope:s,label:o,duration:d,swipeDirection:p,swipeThreshold:f,toastCount:C,viewport:y,onViewportChange:b,onToastAdd:I.useCallback(()=>A(W=>W+1),[]),onToastRemove:I.useCallback(()=>A(W=>W-1),[]),isFocusedToastEscapeKeyDownRef:D,isClosePausedRef:k,children:E})})};OX.displayName=QD;var PX="ToastViewport",kbe=["F8"],yP="toast.viewportPause",SP="toast.viewportResume",DX=I.forwardRef((r,s)=>{const{__scopeToast:o,hotkey:d=kbe,label:p="Notifications ({hotkey})",...f}=r,E=mw(PX,o),y=Obe(o),b=I.useRef(null),C=I.useRef(null),A=I.useRef(null),D=I.useRef(null),k=Zn(s,D,E.onViewportChange),W=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),G=E.toastCount>0;I.useEffect(()=>{const B=H=>{var K;d.length!==0&&d.every(Z=>H[Z]||H.code===Z)&&((K=D.current)==null||K.focus())};return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[d]),I.useEffect(()=>{const B=b.current,H=D.current;if(G&&B&&H){const V=()=>{if(!E.isClosePausedRef.current){const $=new CustomEvent(yP);H.dispatchEvent($),E.isClosePausedRef.current=!0}},K=()=>{if(E.isClosePausedRef.current){const $=new CustomEvent(SP);H.dispatchEvent($),E.isClosePausedRef.current=!1}},Z=$=>{!B.contains($.relatedTarget)&&K()},ee=()=>{B.contains(document.activeElement)||K()};return B.addEventListener("focusin",V),B.addEventListener("focusout",Z),B.addEventListener("pointermove",V),B.addEventListener("pointerleave",ee),window.addEventListener("blur",V),window.addEventListener("focus",K),()=>{B.removeEventListener("focusin",V),B.removeEventListener("focusout",Z),B.removeEventListener("pointermove",V),B.removeEventListener("pointerleave",ee),window.removeEventListener("blur",V),window.removeEventListener("focus",K)}}},[G,E.isClosePausedRef]);const L=I.useCallback(({tabbingDirection:B})=>{const V=y().map(K=>{const Z=K.ref.current,ee=[Z,...qbe(Z)];return B==="forwards"?ee:ee.reverse()});return(B==="forwards"?V.reverse():V).flat()},[y]);return I.useEffect(()=>{const B=D.current;if(B){const H=V=>{var ee,$,se;const K=V.altKey||V.ctrlKey||V.metaKey;if(V.key==="Tab"&&!K){const le=document.activeElement,X=V.shiftKey;if(V.target===B&&X){(ee=C.current)==null||ee.focus();return}const Ce=L({tabbingDirection:X?"backwards":"forwards"}),We=Ce.findIndex(he=>he===le);qA(Ce.slice(We+1))?V.preventDefault():X?($=C.current)==null||$.focus():(se=A.current)==null||se.focus()}};return B.addEventListener("keydown",H),()=>B.removeEventListener("keydown",H)}},[y,L]),c.jsxs(bbe,{ref:b,role:"region","aria-label":p.replace("{hotkey}",W),tabIndex:-1,style:{pointerEvents:G?void 0:"none"},children:[G&&c.jsx(TP,{ref:C,onFocusFromOutsideViewport:()=>{const B=L({tabbingDirection:"forwards"});qA(B)}}),c.jsx(JD.Slot,{scope:o,children:c.jsx($t.ol,{tabIndex:-1,...f,ref:k})}),G&&c.jsx(TP,{ref:A,onFocusFromOutsideViewport:()=>{const B=L({tabbingDirection:"backwards"});qA(B)}})]})});DX.displayName=PX;var kX="ToastFocusProxy",TP=I.forwardRef((r,s)=>{const{__scopeToast:o,onFocusFromOutsideViewport:d,...p}=r,f=mw(kX,o);return c.jsx(Bv,{"aria-hidden":!0,tabIndex:0,...p,ref:s,style:{position:"fixed"},onFocus:E=>{var C;const y=E.relatedTarget;!((C=f.viewport)!=null&&C.contains(y))&&d()}})});TP.displayName=kX;var fw="Toast",Lbe="toast.swipeStart",jbe="toast.swipeMove",Mbe="toast.swipeCancel",Ube="toast.swipeEnd",LX=I.forwardRef((r,s)=>{const{forceMount:o,open:d,defaultOpen:p,onOpenChange:f,...E}=r,[y=!0,b]=Du({prop:d,defaultProp:p,onChange:f});return c.jsx(Dc,{present:o||y,children:c.jsx(Bbe,{open:y,...E,ref:s,onClose:()=>b(!1),onPause:Ps(r.onPause),onResume:Ps(r.onResume),onSwipeStart:Vt(r.onSwipeStart,C=>{C.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Vt(r.onSwipeMove,C=>{const{x:A,y:D}=C.detail.delta;C.currentTarget.setAttribute("data-swipe","move"),C.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${A}px`),C.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${D}px`)}),onSwipeCancel:Vt(r.onSwipeCancel,C=>{C.currentTarget.setAttribute("data-swipe","cancel"),C.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),C.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),C.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),C.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Vt(r.onSwipeEnd,C=>{const{x:A,y:D}=C.detail.delta;C.currentTarget.setAttribute("data-swipe","end"),C.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),C.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),C.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${A}px`),C.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${D}px`),b(!1)})})})});LX.displayName=fw;var[Vbe,Fbe]=AX(fw,{onClose(){}}),Bbe=I.forwardRef((r,s)=>{const{__scopeToast:o,type:d="foreground",duration:p,open:f,onClose:E,onEscapeKeyDown:y,onPause:b,onResume:C,onSwipeStart:A,onSwipeMove:D,onSwipeCancel:k,onSwipeEnd:W,...G}=r,L=mw(fw,o),[B,H]=I.useState(null),V=Zn(s,he=>H(he)),K=I.useRef(null),Z=I.useRef(null),ee=p||L.duration,$=I.useRef(0),se=I.useRef(ee),le=I.useRef(0),{onToastAdd:X,onToastRemove:oe}=L,je=Ps(()=>{var rt;(B==null?void 0:B.contains(document.activeElement))&&((rt=L.viewport)==null||rt.focus()),E()}),Ce=I.useCallback(he=>{!he||he===1/0||(window.clearTimeout(le.current),$.current=new Date().getTime(),le.current=window.setTimeout(je,he))},[je]);I.useEffect(()=>{const he=L.viewport;if(he){const rt=()=>{Ce(se.current),C==null||C()},De=()=>{const Oe=new Date().getTime()-$.current;se.current=se.current-Oe,window.clearTimeout(le.current),b==null||b()};return he.addEventListener(yP,De),he.addEventListener(SP,rt),()=>{he.removeEventListener(yP,De),he.removeEventListener(SP,rt)}}},[L.viewport,ee,b,C,Ce]),I.useEffect(()=>{f&&!L.isClosePausedRef.current&&Ce(ee)},[f,ee,L.isClosePausedRef,Ce]),I.useEffect(()=>(X(),()=>oe()),[X,oe]);const We=I.useMemo(()=>B?GX(B):null,[B]);return L.viewport?c.jsxs(c.Fragment,{children:[We&&c.jsx(Gbe,{__scopeToast:o,role:"status","aria-live":d==="foreground"?"assertive":"polite","aria-atomic":!0,children:We}),c.jsx(Vbe,{scope:o,onClose:je,children:Op.createPortal(c.jsx(JD.ItemSlot,{scope:o,children:c.jsx(Tbe,{asChild:!0,onEscapeKeyDown:Vt(y,()=>{L.isFocusedToastEscapeKeyDownRef.current||je(),L.isFocusedToastEscapeKeyDownRef.current=!1}),children:c.jsx($t.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":f?"open":"closed","data-swipe-direction":L.swipeDirection,...G,ref:V,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:Vt(r.onKeyDown,he=>{he.key==="Escape"&&(y==null||y(he.nativeEvent),he.nativeEvent.defaultPrevented||(L.isFocusedToastEscapeKeyDownRef.current=!0,je()))}),onPointerDown:Vt(r.onPointerDown,he=>{he.button===0&&(K.current={x:he.clientX,y:he.clientY})}),onPointerMove:Vt(r.onPointerMove,he=>{if(!K.current)return;const rt=he.clientX-K.current.x,De=he.clientY-K.current.y,Oe=!!Z.current,Re=["left","right"].includes(L.swipeDirection),et=["left","up"].includes(L.swipeDirection)?Math.min:Math.max,xe=Re?et(0,rt):0,Pt=Re?0:et(0,De),rn=he.pointerType==="touch"?10:2,Gr={x:xe,y:Pt},er={originalEvent:he,delta:Gr};Oe?(Z.current=Gr,ET(jbe,D,er,{discrete:!1})):U8(Gr,L.swipeDirection,rn)?(Z.current=Gr,ET(Lbe,A,er,{discrete:!1}),he.target.setPointerCapture(he.pointerId)):(Math.abs(rt)>rn||Math.abs(De)>rn)&&(K.current=null)}),onPointerUp:Vt(r.onPointerUp,he=>{const rt=Z.current,De=he.target;if(De.hasPointerCapture(he.pointerId)&&De.releasePointerCapture(he.pointerId),Z.current=null,K.current=null,rt){const Oe=he.currentTarget,Re={originalEvent:he,delta:rt};U8(rt,L.swipeDirection,L.swipeThreshold)?ET(Ube,W,Re,{discrete:!0}):ET(Mbe,k,Re,{discrete:!0}),Oe.addEventListener("click",et=>et.preventDefault(),{once:!0})}})})})}),L.viewport)})]}):null}),Gbe=r=>{const{__scopeToast:s,children:o,...d}=r,p=mw(fw,s),[f,E]=I.useState(!1),[y,b]=I.useState(!1);return Kbe(()=>E(!0)),I.useEffect(()=>{const C=window.setTimeout(()=>b(!0),1e3);return()=>window.clearTimeout(C)},[]),y?null:c.jsx(pw,{asChild:!0,children:c.jsx(Bv,{...d,children:f&&c.jsxs(c.Fragment,{children:[p.label," ",o]})})})},Wbe="ToastTitle",jX=I.forwardRef((r,s)=>{const{__scopeToast:o,...d}=r;return c.jsx($t.div,{...d,ref:s})});jX.displayName=Wbe;var Hbe="ToastDescription",MX=I.forwardRef((r,s)=>{const{__scopeToast:o,...d}=r;return c.jsx($t.div,{...d,ref:s})});MX.displayName=Hbe;var UX="ToastAction",VX=I.forwardRef((r,s)=>{const{altText:o,...d}=r;return o.trim()?c.jsx(BX,{altText:o,asChild:!0,children:c.jsx($D,{...d,ref:s})}):(console.error(`Invalid prop \`altText\` supplied to \`${UX}\`. Expected non-empty \`string\`.`),null)});VX.displayName=UX;var FX="ToastClose",$D=I.forwardRef((r,s)=>{const{__scopeToast:o,...d}=r,p=Fbe(FX,o);return c.jsx(BX,{asChild:!0,children:c.jsx($t.button,{type:"button",...d,ref:s,onClick:Vt(r.onClick,p.onClose)})})});$D.displayName=FX;var BX=I.forwardRef((r,s)=>{const{__scopeToast:o,altText:d,...p}=r;return c.jsx($t.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":d||void 0,...p,ref:s})});function GX(r){const s=[];return Array.from(r.childNodes).forEach(d=>{if(d.nodeType===d.TEXT_NODE&&d.textContent&&s.push(d.textContent),zbe(d)){const p=d.ariaHidden||d.hidden||d.style.display==="none",f=d.dataset.radixToastAnnounceExclude==="";if(!p)if(f){const E=d.dataset.radixToastAnnounceAlt;E&&s.push(E)}else s.push(...GX(d))}}),s}function ET(r,s,o,{discrete:d}){const p=o.originalEvent.currentTarget,f=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:o});s&&p.addEventListener(r,s,{once:!0}),d?RX(p,f):p.dispatchEvent(f)}var U8=(r,s,o=0)=>{const d=Math.abs(r.x),p=Math.abs(r.y),f=d>p;return s==="left"||s==="right"?f&&d>o:!f&&p>o};function Kbe(r=()=>{}){const s=Ps(r);qs(()=>{let o=0,d=0;return o=window.requestAnimationFrame(()=>d=window.requestAnimationFrame(s)),()=>{window.cancelAnimationFrame(o),window.cancelAnimationFrame(d)}},[s])}function zbe(r){return r.nodeType===r.ELEMENT_NODE}function qbe(r){const s=[],o=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const p=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||p?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)s.push(o.currentNode);return s}function qA(r){const s=document.activeElement;return r.some(o=>o===s?!0:(o.focus(),document.activeElement!==s))}var Ybe=OX,WX=DX,HX=LX,KX=jX,zX=MX,qX=VX,YX=$D;function XX(r){var s,o,d="";if(typeof r=="string"||typeof r=="number")d+=r;else if(typeof r=="object")if(Array.isArray(r)){var p=r.length;for(s=0;s<p;s++)r[s]&&(o=XX(r[s]))&&(d&&(d+=" "),d+=o)}else for(o in r)r[o]&&(d&&(d+=" "),d+=o);return d}function QX(){for(var r,s,o=0,d="",p=arguments.length;o<p;o++)(r=arguments[o])&&(s=XX(r))&&(d&&(d+=" "),d+=s);return d}const V8=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,F8=QX,kp=(r,s)=>o=>{var d;if((s==null?void 0:s.variants)==null)return F8(r,o==null?void 0:o.class,o==null?void 0:o.className);const{variants:p,defaultVariants:f}=s,E=Object.keys(p).map(C=>{const A=o==null?void 0:o[C],D=f==null?void 0:f[C];if(A===null)return null;const k=V8(A)||V8(D);return p[C][k]}),y=o&&Object.entries(o).reduce((C,A)=>{let[D,k]=A;return k===void 0||(C[D]=k),C},{}),b=s==null||(d=s.compoundVariants)===null||d===void 0?void 0:d.reduce((C,A)=>{let{class:D,className:k,...W}=A;return Object.entries(W).every(G=>{let[L,B]=G;return Array.isArray(B)?B.includes({...f,...y}[L]):{...f,...y}[L]===B})?[...C,D,k]:C},[]);return F8(r,E,b,o==null?void 0:o.class,o==null?void 0:o.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xbe=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),JX=(...r)=>r.filter((s,o,d)=>!!s&&d.indexOf(s)===o).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qbe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jbe=I.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:d,className:p="",children:f,iconNode:E,...y},b)=>I.createElement("svg",{ref:b,...Qbe,width:s,height:s,stroke:r,strokeWidth:d?Number(o)*24/Number(s):o,className:JX("lucide",p),...y},[...E.map(([C,A])=>I.createElement(C,A)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=(r,s)=>{const o=I.forwardRef(({className:d,...p},f)=>I.createElement(Jbe,{ref:f,iconNode:s,className:JX(`lucide-${Xbe(r)}`,d),...p}));return o.displayName=`${r}`,o};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tl=lt("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $be=lt("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xg=lt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zbe=lt("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ewe=lt("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=lt("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yu=lt("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=lt("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const twe=lt("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=lt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hv=lt("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nwe=lt("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bP=lt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $X=lt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rwe=lt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=lt("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=lt("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ng=lt("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gw=lt("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=lt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const swe=lt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uf=lt("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iwe=lt("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZD=lt("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const awe=lt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const owe=lt("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=lt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cwe=lt("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fp=lt("Fingerprint",[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lwe=lt("Frown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1=lt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B8=lt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dwe=lt("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uwe=lt("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hwe=lt("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G8=lt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZX=lt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pwe=lt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mwe=lt("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fwe=lt("Meh",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"8",x2:"16",y1:"15",y2:"15",key:"1xb1d9"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W8=lt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gwe=lt("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=lt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _we=lt("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ewe=lt("PackagePlus",[["path",{d:"M16 16h6",key:"100bgy"}],["path",{d:"M19 13v6",key:"85cyf1"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eQ=lt("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vwe=lt("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ywe=lt("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Swe=lt("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Twe=lt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pv=lt("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=lt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tQ=lt("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nQ=lt("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uo=lt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t1=lt("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bwe=lt("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rQ=lt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1=lt("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wwe=lt("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KE=lt("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sQ=lt("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H8=lt("Stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K8=lt("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cwe=lt("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rwe=lt("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r1=lt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xwe=lt("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gv=lt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const id=lt("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mv=lt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wP=lt("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iQ=lt("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tb=lt("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gp=lt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lp=lt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nwe=lt("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Au=lt("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iwe=lt("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=lt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aQ=lt("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),s1="-",Awe=r=>{const s=Pwe(r),{conflictingClassGroups:o,conflictingClassGroupModifiers:d}=r;return{getClassGroupId:E=>{const y=E.split(s1);return y[0]===""&&y.length!==1&&y.shift(),oQ(y,s)||Owe(E)},getConflictingClassGroupIds:(E,y)=>{const b=o[E]||[];return y&&d[E]?[...b,...d[E]]:b}}},oQ=(r,s)=>{var E;if(r.length===0)return s.classGroupId;const o=r[0],d=s.nextPart.get(o),p=d?oQ(r.slice(1),d):void 0;if(p)return p;if(s.validators.length===0)return;const f=r.join(s1);return(E=s.validators.find(({validator:y})=>y(f)))==null?void 0:E.classGroupId},z8=/^\[(.+)\]$/,Owe=r=>{if(z8.test(r)){const s=z8.exec(r)[1],o=s==null?void 0:s.substring(0,s.indexOf(":"));if(o)return"arbitrary.."+o}},Pwe=r=>{const{theme:s,prefix:o}=r,d={nextPart:new Map,validators:[]};return kwe(Object.entries(r.classGroups),o).forEach(([f,E])=>{CP(E,d,f,s)}),d},CP=(r,s,o,d)=>{r.forEach(p=>{if(typeof p=="string"){const f=p===""?s:q8(s,p);f.classGroupId=o;return}if(typeof p=="function"){if(Dwe(p)){CP(p(d),s,o,d);return}s.validators.push({validator:p,classGroupId:o});return}Object.entries(p).forEach(([f,E])=>{CP(E,q8(s,f),o,d)})})},q8=(r,s)=>{let o=r;return s.split(s1).forEach(d=>{o.nextPart.has(d)||o.nextPart.set(d,{nextPart:new Map,validators:[]}),o=o.nextPart.get(d)}),o},Dwe=r=>r.isThemeGetter,kwe=(r,s)=>s?r.map(([o,d])=>{const p=d.map(f=>typeof f=="string"?s+f:typeof f=="object"?Object.fromEntries(Object.entries(f).map(([E,y])=>[s+E,y])):f);return[o,p]}):r,Lwe=r=>{if(r<1)return{get:()=>{},set:()=>{}};let s=0,o=new Map,d=new Map;const p=(f,E)=>{o.set(f,E),s++,s>r&&(s=0,d=o,o=new Map)};return{get(f){let E=o.get(f);if(E!==void 0)return E;if((E=d.get(f))!==void 0)return p(f,E),E},set(f,E){o.has(f)?o.set(f,E):p(f,E)}}},cQ="!",jwe=r=>{const{separator:s,experimentalParseClassName:o}=r,d=s.length===1,p=s[0],f=s.length,E=y=>{const b=[];let C=0,A=0,D;for(let B=0;B<y.length;B++){let H=y[B];if(C===0){if(H===p&&(d||y.slice(B,B+f)===s)){b.push(y.slice(A,B)),A=B+f;continue}if(H==="/"){D=B;continue}}H==="["?C++:H==="]"&&C--}const k=b.length===0?y:y.substring(A),W=k.startsWith(cQ),G=W?k.substring(1):k,L=D&&D>A?D-A:void 0;return{modifiers:b,hasImportantModifier:W,baseClassName:G,maybePostfixModifierPosition:L}};return o?y=>o({className:y,parseClassName:E}):E},Mwe=r=>{if(r.length<=1)return r;const s=[];let o=[];return r.forEach(d=>{d[0]==="["?(s.push(...o.sort(),d),o=[]):o.push(d)}),s.push(...o.sort()),s},Uwe=r=>({cache:Lwe(r.cacheSize),parseClassName:jwe(r),...Awe(r)}),Vwe=/\s+/,Fwe=(r,s)=>{const{parseClassName:o,getClassGroupId:d,getConflictingClassGroupIds:p}=s,f=[],E=r.trim().split(Vwe);let y="";for(let b=E.length-1;b>=0;b-=1){const C=E[b],{modifiers:A,hasImportantModifier:D,baseClassName:k,maybePostfixModifierPosition:W}=o(C);let G=!!W,L=d(G?k.substring(0,W):k);if(!L){if(!G){y=C+(y.length>0?" "+y:y);continue}if(L=d(k),!L){y=C+(y.length>0?" "+y:y);continue}G=!1}const B=Mwe(A).join(":"),H=D?B+cQ:B,V=H+L;if(f.includes(V))continue;f.push(V);const K=p(L,G);for(let Z=0;Z<K.length;++Z){const ee=K[Z];f.push(H+ee)}y=C+(y.length>0?" "+y:y)}return y};function Bwe(){let r=0,s,o,d="";for(;r<arguments.length;)(s=arguments[r++])&&(o=lQ(s))&&(d&&(d+=" "),d+=o);return d}const lQ=r=>{if(typeof r=="string")return r;let s,o="";for(let d=0;d<r.length;d++)r[d]&&(s=lQ(r[d]))&&(o&&(o+=" "),o+=s);return o};function Gwe(r,...s){let o,d,p,f=E;function E(b){const C=s.reduce((A,D)=>D(A),r());return o=Uwe(C),d=o.cache.get,p=o.cache.set,f=y,y(b)}function y(b){const C=d(b);if(C)return C;const A=Fwe(b,o);return p(b,A),A}return function(){return f(Bwe.apply(null,arguments))}}const $r=r=>{const s=o=>o[r]||[];return s.isThemeGetter=!0,s},dQ=/^\[(?:([a-z-]+):)?(.+)\]$/i,Wwe=/^\d+\/\d+$/,Hwe=new Set(["px","full","screen"]),Kwe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,zwe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,qwe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ywe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Xwe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ql=r=>Ff(r)||Hwe.has(r)||Wwe.test(r),Zd=r=>Ig(r,"length",rCe),Ff=r=>!!r&&!Number.isNaN(Number(r)),YA=r=>Ig(r,"number",Ff),yE=r=>!!r&&Number.isInteger(Number(r)),Qwe=r=>r.endsWith("%")&&Ff(r.slice(0,-1)),wn=r=>dQ.test(r),eu=r=>Kwe.test(r),Jwe=new Set(["length","size","percentage"]),$we=r=>Ig(r,Jwe,uQ),Zwe=r=>Ig(r,"position",uQ),eCe=new Set(["image","url"]),tCe=r=>Ig(r,eCe,iCe),nCe=r=>Ig(r,"",sCe),SE=()=>!0,Ig=(r,s,o)=>{const d=dQ.exec(r);return d?d[1]?typeof s=="string"?d[1]===s:s.has(d[1]):o(d[2]):!1},rCe=r=>zwe.test(r)&&!qwe.test(r),uQ=()=>!1,sCe=r=>Ywe.test(r),iCe=r=>Xwe.test(r),aCe=()=>{const r=$r("colors"),s=$r("spacing"),o=$r("blur"),d=$r("brightness"),p=$r("borderColor"),f=$r("borderRadius"),E=$r("borderSpacing"),y=$r("borderWidth"),b=$r("contrast"),C=$r("grayscale"),A=$r("hueRotate"),D=$r("invert"),k=$r("gap"),W=$r("gradientColorStops"),G=$r("gradientColorStopPositions"),L=$r("inset"),B=$r("margin"),H=$r("opacity"),V=$r("padding"),K=$r("saturate"),Z=$r("scale"),ee=$r("sepia"),$=$r("skew"),se=$r("space"),le=$r("translate"),X=()=>["auto","contain","none"],oe=()=>["auto","hidden","clip","visible","scroll"],je=()=>["auto",wn,s],Ce=()=>[wn,s],We=()=>["",ql,Zd],he=()=>["auto",Ff,wn],rt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],De=()=>["solid","dashed","dotted","double","none"],Oe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Re=()=>["start","end","center","between","around","evenly","stretch"],et=()=>["","0",wn],xe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Pt=()=>[Ff,wn];return{cacheSize:500,separator:":",theme:{colors:[SE],spacing:[ql,Zd],blur:["none","",eu,wn],brightness:Pt(),borderColor:[r],borderRadius:["none","","full",eu,wn],borderSpacing:Ce(),borderWidth:We(),contrast:Pt(),grayscale:et(),hueRotate:Pt(),invert:et(),gap:Ce(),gradientColorStops:[r],gradientColorStopPositions:[Qwe,Zd],inset:je(),margin:je(),opacity:Pt(),padding:Ce(),saturate:Pt(),scale:Pt(),sepia:et(),skew:Pt(),space:Ce(),translate:Ce()},classGroups:{aspect:[{aspect:["auto","square","video",wn]}],container:["container"],columns:[{columns:[eu]}],"break-after":[{"break-after":xe()}],"break-before":[{"break-before":xe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...rt(),wn]}],overflow:[{overflow:oe()}],"overflow-x":[{"overflow-x":oe()}],"overflow-y":[{"overflow-y":oe()}],overscroll:[{overscroll:X()}],"overscroll-x":[{"overscroll-x":X()}],"overscroll-y":[{"overscroll-y":X()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[L]}],"inset-x":[{"inset-x":[L]}],"inset-y":[{"inset-y":[L]}],start:[{start:[L]}],end:[{end:[L]}],top:[{top:[L]}],right:[{right:[L]}],bottom:[{bottom:[L]}],left:[{left:[L]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",yE,wn]}],basis:[{basis:je()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",wn]}],grow:[{grow:et()}],shrink:[{shrink:et()}],order:[{order:["first","last","none",yE,wn]}],"grid-cols":[{"grid-cols":[SE]}],"col-start-end":[{col:["auto",{span:["full",yE,wn]},wn]}],"col-start":[{"col-start":he()}],"col-end":[{"col-end":he()}],"grid-rows":[{"grid-rows":[SE]}],"row-start-end":[{row:["auto",{span:[yE,wn]},wn]}],"row-start":[{"row-start":he()}],"row-end":[{"row-end":he()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",wn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",wn]}],gap:[{gap:[k]}],"gap-x":[{"gap-x":[k]}],"gap-y":[{"gap-y":[k]}],"justify-content":[{justify:["normal",...Re()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Re(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Re(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[V]}],px:[{px:[V]}],py:[{py:[V]}],ps:[{ps:[V]}],pe:[{pe:[V]}],pt:[{pt:[V]}],pr:[{pr:[V]}],pb:[{pb:[V]}],pl:[{pl:[V]}],m:[{m:[B]}],mx:[{mx:[B]}],my:[{my:[B]}],ms:[{ms:[B]}],me:[{me:[B]}],mt:[{mt:[B]}],mr:[{mr:[B]}],mb:[{mb:[B]}],ml:[{ml:[B]}],"space-x":[{"space-x":[se]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[se]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",wn,s]}],"min-w":[{"min-w":[wn,s,"min","max","fit"]}],"max-w":[{"max-w":[wn,s,"none","full","min","max","fit","prose",{screen:[eu]},eu]}],h:[{h:[wn,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[wn,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[wn,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[wn,s,"auto","min","max","fit"]}],"font-size":[{text:["base",eu,Zd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",YA]}],"font-family":[{font:[SE]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",wn]}],"line-clamp":[{"line-clamp":["none",Ff,YA]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ql,wn]}],"list-image":[{"list-image":["none",wn]}],"list-style-type":[{list:["none","disc","decimal",wn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[H]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[H]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...De(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ql,Zd]}],"underline-offset":[{"underline-offset":["auto",ql,wn]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ce()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",wn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",wn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[H]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...rt(),Zwe]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",$we]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},tCe]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[G]}],"gradient-via-pos":[{via:[G]}],"gradient-to-pos":[{to:[G]}],"gradient-from":[{from:[W]}],"gradient-via":[{via:[W]}],"gradient-to":[{to:[W]}],rounded:[{rounded:[f]}],"rounded-s":[{"rounded-s":[f]}],"rounded-e":[{"rounded-e":[f]}],"rounded-t":[{"rounded-t":[f]}],"rounded-r":[{"rounded-r":[f]}],"rounded-b":[{"rounded-b":[f]}],"rounded-l":[{"rounded-l":[f]}],"rounded-ss":[{"rounded-ss":[f]}],"rounded-se":[{"rounded-se":[f]}],"rounded-ee":[{"rounded-ee":[f]}],"rounded-es":[{"rounded-es":[f]}],"rounded-tl":[{"rounded-tl":[f]}],"rounded-tr":[{"rounded-tr":[f]}],"rounded-br":[{"rounded-br":[f]}],"rounded-bl":[{"rounded-bl":[f]}],"border-w":[{border:[y]}],"border-w-x":[{"border-x":[y]}],"border-w-y":[{"border-y":[y]}],"border-w-s":[{"border-s":[y]}],"border-w-e":[{"border-e":[y]}],"border-w-t":[{"border-t":[y]}],"border-w-r":[{"border-r":[y]}],"border-w-b":[{"border-b":[y]}],"border-w-l":[{"border-l":[y]}],"border-opacity":[{"border-opacity":[H]}],"border-style":[{border:[...De(),"hidden"]}],"divide-x":[{"divide-x":[y]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[y]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[H]}],"divide-style":[{divide:De()}],"border-color":[{border:[p]}],"border-color-x":[{"border-x":[p]}],"border-color-y":[{"border-y":[p]}],"border-color-s":[{"border-s":[p]}],"border-color-e":[{"border-e":[p]}],"border-color-t":[{"border-t":[p]}],"border-color-r":[{"border-r":[p]}],"border-color-b":[{"border-b":[p]}],"border-color-l":[{"border-l":[p]}],"divide-color":[{divide:[p]}],"outline-style":[{outline:["",...De()]}],"outline-offset":[{"outline-offset":[ql,wn]}],"outline-w":[{outline:[ql,Zd]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:We()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[H]}],"ring-offset-w":[{"ring-offset":[ql,Zd]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",eu,nCe]}],"shadow-color":[{shadow:[SE]}],opacity:[{opacity:[H]}],"mix-blend":[{"mix-blend":[...Oe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Oe()}],filter:[{filter:["","none"]}],blur:[{blur:[o]}],brightness:[{brightness:[d]}],contrast:[{contrast:[b]}],"drop-shadow":[{"drop-shadow":["","none",eu,wn]}],grayscale:[{grayscale:[C]}],"hue-rotate":[{"hue-rotate":[A]}],invert:[{invert:[D]}],saturate:[{saturate:[K]}],sepia:[{sepia:[ee]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[o]}],"backdrop-brightness":[{"backdrop-brightness":[d]}],"backdrop-contrast":[{"backdrop-contrast":[b]}],"backdrop-grayscale":[{"backdrop-grayscale":[C]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[A]}],"backdrop-invert":[{"backdrop-invert":[D]}],"backdrop-opacity":[{"backdrop-opacity":[H]}],"backdrop-saturate":[{"backdrop-saturate":[K]}],"backdrop-sepia":[{"backdrop-sepia":[ee]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[E]}],"border-spacing-x":[{"border-spacing-x":[E]}],"border-spacing-y":[{"border-spacing-y":[E]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",wn]}],duration:[{duration:Pt()}],ease:[{ease:["linear","in","out","in-out",wn]}],delay:[{delay:Pt()}],animate:[{animate:["none","spin","ping","pulse","bounce",wn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Z]}],"scale-x":[{"scale-x":[Z]}],"scale-y":[{"scale-y":[Z]}],rotate:[{rotate:[yE,wn]}],"translate-x":[{"translate-x":[le]}],"translate-y":[{"translate-y":[le]}],"skew-x":[{"skew-x":[$]}],"skew-y":[{"skew-y":[$]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",wn]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",wn]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ce()}],"scroll-mx":[{"scroll-mx":Ce()}],"scroll-my":[{"scroll-my":Ce()}],"scroll-ms":[{"scroll-ms":Ce()}],"scroll-me":[{"scroll-me":Ce()}],"scroll-mt":[{"scroll-mt":Ce()}],"scroll-mr":[{"scroll-mr":Ce()}],"scroll-mb":[{"scroll-mb":Ce()}],"scroll-ml":[{"scroll-ml":Ce()}],"scroll-p":[{"scroll-p":Ce()}],"scroll-px":[{"scroll-px":Ce()}],"scroll-py":[{"scroll-py":Ce()}],"scroll-ps":[{"scroll-ps":Ce()}],"scroll-pe":[{"scroll-pe":Ce()}],"scroll-pt":[{"scroll-pt":Ce()}],"scroll-pr":[{"scroll-pr":Ce()}],"scroll-pb":[{"scroll-pb":Ce()}],"scroll-pl":[{"scroll-pl":Ce()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",wn]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[ql,Zd,YA]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},oCe=Gwe(aCe);function ct(...r){return oCe(QX(r))}const cCe=Ybe,hQ=I.forwardRef(({className:r,...s},o)=>c.jsx(WX,{ref:o,className:ct("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...s}));hQ.displayName=WX.displayName;const lCe=kp("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),pQ=I.forwardRef(({className:r,variant:s,...o},d)=>c.jsx(HX,{ref:d,className:ct(lCe({variant:s}),r),...o}));pQ.displayName=HX.displayName;const dCe=I.forwardRef(({className:r,...s},o)=>c.jsx(qX,{ref:o,className:ct("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...s}));dCe.displayName=qX.displayName;const mQ=I.forwardRef(({className:r,...s},o)=>c.jsx(YX,{ref:o,className:ct("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...s,children:c.jsx(fg,{className:"h-4 w-4"})}));mQ.displayName=YX.displayName;const fQ=I.forwardRef(({className:r,...s},o)=>c.jsx(KX,{ref:o,className:ct("text-sm font-semibold",r),...s}));fQ.displayName=KX.displayName;const gQ=I.forwardRef(({className:r,...s},o)=>c.jsx(zX,{ref:o,className:ct("text-sm opacity-90",r),...s}));gQ.displayName=zX.displayName;function uCe(){const{toasts:r}=jr();return c.jsxs(cCe,{children:[r.map(function({id:s,title:o,description:d,action:p,...f}){return c.jsxs(pQ,{...f,children:[c.jsxs("div",{className:"grid gap-1",children:[o&&c.jsx(fQ,{children:o}),d&&c.jsx(gQ,{children:d})]}),p,c.jsx(mQ,{})]},s)}),c.jsx(hQ,{})]})}var hCe=Xq[" useId ".trim().toString()]||(()=>{}),pCe=0;function ad(r){const[s,o]=I.useState(hCe());return qs(()=>{o(d=>d??String(pCe++))},[r]),s?`radix-${s}`:""}const mCe=["top","right","bottom","left"],ku=Math.min,Xa=Math.max,bb=Math.round,vT=Math.floor,vl=r=>({x:r,y:r}),fCe={left:"right",right:"left",bottom:"top",top:"bottom"},gCe={start:"end",end:"start"};function RP(r,s,o){return Xa(r,ku(s,o))}function fd(r,s){return typeof r=="function"?r(s):r}function gd(r){return r.split("-")[0]}function Ag(r){return r.split("-")[1]}function i1(r){return r==="x"?"y":"x"}function a1(r){return r==="y"?"height":"width"}function Lu(r){return["top","bottom"].includes(gd(r))?"y":"x"}function o1(r){return i1(Lu(r))}function _Ce(r,s,o){o===void 0&&(o=!1);const d=Ag(r),p=o1(r),f=a1(p);let E=p==="x"?d===(o?"end":"start")?"right":"left":d==="start"?"bottom":"top";return s.reference[f]>s.floating[f]&&(E=wb(E)),[E,wb(E)]}function ECe(r){const s=wb(r);return[xP(r),s,xP(s)]}function xP(r){return r.replace(/start|end/g,s=>gCe[s])}function vCe(r,s,o){const d=["left","right"],p=["right","left"],f=["top","bottom"],E=["bottom","top"];switch(r){case"top":case"bottom":return o?s?p:d:s?d:p;case"left":case"right":return s?f:E;default:return[]}}function yCe(r,s,o,d){const p=Ag(r);let f=vCe(gd(r),o==="start",d);return p&&(f=f.map(E=>E+"-"+p),s&&(f=f.concat(f.map(xP)))),f}function wb(r){return r.replace(/left|right|bottom|top/g,s=>fCe[s])}function SCe(r){return{top:0,right:0,bottom:0,left:0,...r}}function _Q(r){return typeof r!="number"?SCe(r):{top:r,right:r,bottom:r,left:r}}function Cb(r){const{x:s,y:o,width:d,height:p}=r;return{width:d,height:p,top:o,left:s,right:s+d,bottom:o+p,x:s,y:o}}function Y8(r,s,o){let{reference:d,floating:p}=r;const f=Lu(s),E=o1(s),y=a1(E),b=gd(s),C=f==="y",A=d.x+d.width/2-p.width/2,D=d.y+d.height/2-p.height/2,k=d[y]/2-p[y]/2;let W;switch(b){case"top":W={x:A,y:d.y-p.height};break;case"bottom":W={x:A,y:d.y+d.height};break;case"right":W={x:d.x+d.width,y:D};break;case"left":W={x:d.x-p.width,y:D};break;default:W={x:d.x,y:d.y}}switch(Ag(s)){case"start":W[E]-=k*(o&&C?-1:1);break;case"end":W[E]+=k*(o&&C?-1:1);break}return W}const TCe=async(r,s,o)=>{const{placement:d="bottom",strategy:p="absolute",middleware:f=[],platform:E}=o,y=f.filter(Boolean),b=await(E.isRTL==null?void 0:E.isRTL(s));let C=await E.getElementRects({reference:r,floating:s,strategy:p}),{x:A,y:D}=Y8(C,d,b),k=d,W={},G=0;for(let L=0;L<y.length;L++){const{name:B,fn:H}=y[L],{x:V,y:K,data:Z,reset:ee}=await H({x:A,y:D,initialPlacement:d,placement:k,strategy:p,middlewareData:W,rects:C,platform:E,elements:{reference:r,floating:s}});A=V??A,D=K??D,W={...W,[B]:{...W[B],...Z}},ee&&G<=50&&(G++,typeof ee=="object"&&(ee.placement&&(k=ee.placement),ee.rects&&(C=ee.rects===!0?await E.getElementRects({reference:r,floating:s,strategy:p}):ee.rects),{x:A,y:D}=Y8(C,k,b)),L=-1)}return{x:A,y:D,placement:k,strategy:p,middlewareData:W}};async function fv(r,s){var o;s===void 0&&(s={});const{x:d,y:p,platform:f,rects:E,elements:y,strategy:b}=r,{boundary:C="clippingAncestors",rootBoundary:A="viewport",elementContext:D="floating",altBoundary:k=!1,padding:W=0}=fd(s,r),G=_Q(W),B=y[k?D==="floating"?"reference":"floating":D],H=Cb(await f.getClippingRect({element:(o=await(f.isElement==null?void 0:f.isElement(B)))==null||o?B:B.contextElement||await(f.getDocumentElement==null?void 0:f.getDocumentElement(y.floating)),boundary:C,rootBoundary:A,strategy:b})),V=D==="floating"?{x:d,y:p,width:E.floating.width,height:E.floating.height}:E.reference,K=await(f.getOffsetParent==null?void 0:f.getOffsetParent(y.floating)),Z=await(f.isElement==null?void 0:f.isElement(K))?await(f.getScale==null?void 0:f.getScale(K))||{x:1,y:1}:{x:1,y:1},ee=Cb(f.convertOffsetParentRelativeRectToViewportRelativeRect?await f.convertOffsetParentRelativeRectToViewportRelativeRect({elements:y,rect:V,offsetParent:K,strategy:b}):V);return{top:(H.top-ee.top+G.top)/Z.y,bottom:(ee.bottom-H.bottom+G.bottom)/Z.y,left:(H.left-ee.left+G.left)/Z.x,right:(ee.right-H.right+G.right)/Z.x}}const bCe=r=>({name:"arrow",options:r,async fn(s){const{x:o,y:d,placement:p,rects:f,platform:E,elements:y,middlewareData:b}=s,{element:C,padding:A=0}=fd(r,s)||{};if(C==null)return{};const D=_Q(A),k={x:o,y:d},W=o1(p),G=a1(W),L=await E.getDimensions(C),B=W==="y",H=B?"top":"left",V=B?"bottom":"right",K=B?"clientHeight":"clientWidth",Z=f.reference[G]+f.reference[W]-k[W]-f.floating[G],ee=k[W]-f.reference[W],$=await(E.getOffsetParent==null?void 0:E.getOffsetParent(C));let se=$?$[K]:0;(!se||!await(E.isElement==null?void 0:E.isElement($)))&&(se=y.floating[K]||f.floating[G]);const le=Z/2-ee/2,X=se/2-L[G]/2-1,oe=ku(D[H],X),je=ku(D[V],X),Ce=oe,We=se-L[G]-je,he=se/2-L[G]/2+le,rt=RP(Ce,he,We),De=!b.arrow&&Ag(p)!=null&&he!==rt&&f.reference[G]/2-(he<Ce?oe:je)-L[G]/2<0,Oe=De?he<Ce?he-Ce:he-We:0;return{[W]:k[W]+Oe,data:{[W]:rt,centerOffset:he-rt-Oe,...De&&{alignmentOffset:Oe}},reset:De}}}),wCe=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(s){var o,d;const{placement:p,middlewareData:f,rects:E,initialPlacement:y,platform:b,elements:C}=s,{mainAxis:A=!0,crossAxis:D=!0,fallbackPlacements:k,fallbackStrategy:W="bestFit",fallbackAxisSideDirection:G="none",flipAlignment:L=!0,...B}=fd(r,s);if((o=f.arrow)!=null&&o.alignmentOffset)return{};const H=gd(p),V=Lu(y),K=gd(y)===y,Z=await(b.isRTL==null?void 0:b.isRTL(C.floating)),ee=k||(K||!L?[wb(y)]:ECe(y)),$=G!=="none";!k&&$&&ee.push(...yCe(y,L,G,Z));const se=[y,...ee],le=await fv(s,B),X=[];let oe=((d=f.flip)==null?void 0:d.overflows)||[];if(A&&X.push(le[H]),D){const he=_Ce(p,E,Z);X.push(le[he[0]],le[he[1]])}if(oe=[...oe,{placement:p,overflows:X}],!X.every(he=>he<=0)){var je,Ce;const he=(((je=f.flip)==null?void 0:je.index)||0)+1,rt=se[he];if(rt)return{data:{index:he,overflows:oe},reset:{placement:rt}};let De=(Ce=oe.filter(Oe=>Oe.overflows[0]<=0).sort((Oe,Re)=>Oe.overflows[1]-Re.overflows[1])[0])==null?void 0:Ce.placement;if(!De)switch(W){case"bestFit":{var We;const Oe=(We=oe.filter(Re=>{if($){const et=Lu(Re.placement);return et===V||et==="y"}return!0}).map(Re=>[Re.placement,Re.overflows.filter(et=>et>0).reduce((et,xe)=>et+xe,0)]).sort((Re,et)=>Re[1]-et[1])[0])==null?void 0:We[0];Oe&&(De=Oe);break}case"initialPlacement":De=y;break}if(p!==De)return{reset:{placement:De}}}return{}}}};function X8(r,s){return{top:r.top-s.height,right:r.right-s.width,bottom:r.bottom-s.height,left:r.left-s.width}}function Q8(r){return mCe.some(s=>r[s]>=0)}const CCe=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(s){const{rects:o}=s,{strategy:d="referenceHidden",...p}=fd(r,s);switch(d){case"referenceHidden":{const f=await fv(s,{...p,elementContext:"reference"}),E=X8(f,o.reference);return{data:{referenceHiddenOffsets:E,referenceHidden:Q8(E)}}}case"escaped":{const f=await fv(s,{...p,altBoundary:!0}),E=X8(f,o.floating);return{data:{escapedOffsets:E,escaped:Q8(E)}}}default:return{}}}}};async function RCe(r,s){const{placement:o,platform:d,elements:p}=r,f=await(d.isRTL==null?void 0:d.isRTL(p.floating)),E=gd(o),y=Ag(o),b=Lu(o)==="y",C=["left","top"].includes(E)?-1:1,A=f&&b?-1:1,D=fd(s,r);let{mainAxis:k,crossAxis:W,alignmentAxis:G}=typeof D=="number"?{mainAxis:D,crossAxis:0,alignmentAxis:null}:{mainAxis:D.mainAxis||0,crossAxis:D.crossAxis||0,alignmentAxis:D.alignmentAxis};return y&&typeof G=="number"&&(W=y==="end"?G*-1:G),b?{x:W*A,y:k*C}:{x:k*C,y:W*A}}const xCe=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(s){var o,d;const{x:p,y:f,placement:E,middlewareData:y}=s,b=await RCe(s,r);return E===((o=y.offset)==null?void 0:o.placement)&&(d=y.arrow)!=null&&d.alignmentOffset?{}:{x:p+b.x,y:f+b.y,data:{...b,placement:E}}}}},NCe=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(s){const{x:o,y:d,placement:p}=s,{mainAxis:f=!0,crossAxis:E=!1,limiter:y={fn:B=>{let{x:H,y:V}=B;return{x:H,y:V}}},...b}=fd(r,s),C={x:o,y:d},A=await fv(s,b),D=Lu(gd(p)),k=i1(D);let W=C[k],G=C[D];if(f){const B=k==="y"?"top":"left",H=k==="y"?"bottom":"right",V=W+A[B],K=W-A[H];W=RP(V,W,K)}if(E){const B=D==="y"?"top":"left",H=D==="y"?"bottom":"right",V=G+A[B],K=G-A[H];G=RP(V,G,K)}const L=y.fn({...s,[k]:W,[D]:G});return{...L,data:{x:L.x-o,y:L.y-d,enabled:{[k]:f,[D]:E}}}}}},ICe=function(r){return r===void 0&&(r={}),{options:r,fn(s){const{x:o,y:d,placement:p,rects:f,middlewareData:E}=s,{offset:y=0,mainAxis:b=!0,crossAxis:C=!0}=fd(r,s),A={x:o,y:d},D=Lu(p),k=i1(D);let W=A[k],G=A[D];const L=fd(y,s),B=typeof L=="number"?{mainAxis:L,crossAxis:0}:{mainAxis:0,crossAxis:0,...L};if(b){const K=k==="y"?"height":"width",Z=f.reference[k]-f.floating[K]+B.mainAxis,ee=f.reference[k]+f.reference[K]-B.mainAxis;W<Z?W=Z:W>ee&&(W=ee)}if(C){var H,V;const K=k==="y"?"width":"height",Z=["top","left"].includes(gd(p)),ee=f.reference[D]-f.floating[K]+(Z&&((H=E.offset)==null?void 0:H[D])||0)+(Z?0:B.crossAxis),$=f.reference[D]+f.reference[K]+(Z?0:((V=E.offset)==null?void 0:V[D])||0)-(Z?B.crossAxis:0);G<ee?G=ee:G>$&&(G=$)}return{[k]:W,[D]:G}}}},ACe=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(s){var o,d;const{placement:p,rects:f,platform:E,elements:y}=s,{apply:b=()=>{},...C}=fd(r,s),A=await fv(s,C),D=gd(p),k=Ag(p),W=Lu(p)==="y",{width:G,height:L}=f.floating;let B,H;D==="top"||D==="bottom"?(B=D,H=k===(await(E.isRTL==null?void 0:E.isRTL(y.floating))?"start":"end")?"left":"right"):(H=D,B=k==="end"?"top":"bottom");const V=L-A.top-A.bottom,K=G-A.left-A.right,Z=ku(L-A[B],V),ee=ku(G-A[H],K),$=!s.middlewareData.shift;let se=Z,le=ee;if((o=s.middlewareData.shift)!=null&&o.enabled.x&&(le=K),(d=s.middlewareData.shift)!=null&&d.enabled.y&&(se=V),$&&!k){const oe=Xa(A.left,0),je=Xa(A.right,0),Ce=Xa(A.top,0),We=Xa(A.bottom,0);W?le=G-2*(oe!==0||je!==0?oe+je:Xa(A.left,A.right)):se=L-2*(Ce!==0||We!==0?Ce+We:Xa(A.top,A.bottom))}await b({...s,availableWidth:le,availableHeight:se});const X=await E.getDimensions(y.floating);return G!==X.width||L!==X.height?{reset:{rects:!0}}:{}}}};function _w(){return typeof window<"u"}function Og(r){return EQ(r)?(r.nodeName||"").toLowerCase():"#document"}function Za(r){var s;return(r==null||(s=r.ownerDocument)==null?void 0:s.defaultView)||window}function Nl(r){var s;return(s=(EQ(r)?r.ownerDocument:r.document)||window.document)==null?void 0:s.documentElement}function EQ(r){return _w()?r instanceof Node||r instanceof Za(r).Node:!1}function Ic(r){return _w()?r instanceof Element||r instanceof Za(r).Element:!1}function Cl(r){return _w()?r instanceof HTMLElement||r instanceof Za(r).HTMLElement:!1}function J8(r){return!_w()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Za(r).ShadowRoot}function Wv(r){const{overflow:s,overflowX:o,overflowY:d,display:p}=Ac(r);return/auto|scroll|overlay|hidden|clip/.test(s+d+o)&&!["inline","contents"].includes(p)}function OCe(r){return["table","td","th"].includes(Og(r))}function Ew(r){return[":popover-open",":modal"].some(s=>{try{return r.matches(s)}catch{return!1}})}function c1(r){const s=l1(),o=Ic(r)?Ac(r):r;return["transform","translate","scale","rotate","perspective"].some(d=>o[d]?o[d]!=="none":!1)||(o.containerType?o.containerType!=="normal":!1)||!s&&(o.backdropFilter?o.backdropFilter!=="none":!1)||!s&&(o.filter?o.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(d=>(o.willChange||"").includes(d))||["paint","layout","strict","content"].some(d=>(o.contain||"").includes(d))}function PCe(r){let s=ju(r);for(;Cl(s)&&!gg(s);){if(c1(s))return s;if(Ew(s))return null;s=ju(s)}return null}function l1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function gg(r){return["html","body","#document"].includes(Og(r))}function Ac(r){return Za(r).getComputedStyle(r)}function vw(r){return Ic(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function ju(r){if(Og(r)==="html")return r;const s=r.assignedSlot||r.parentNode||J8(r)&&r.host||Nl(r);return J8(s)?s.host:s}function vQ(r){const s=ju(r);return gg(s)?r.ownerDocument?r.ownerDocument.body:r.body:Cl(s)&&Wv(s)?s:vQ(s)}function gv(r,s,o){var d;s===void 0&&(s=[]),o===void 0&&(o=!0);const p=vQ(r),f=p===((d=r.ownerDocument)==null?void 0:d.body),E=Za(p);if(f){const y=NP(E);return s.concat(E,E.visualViewport||[],Wv(p)?p:[],y&&o?gv(y):[])}return s.concat(p,gv(p,[],o))}function NP(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function yQ(r){const s=Ac(r);let o=parseFloat(s.width)||0,d=parseFloat(s.height)||0;const p=Cl(r),f=p?r.offsetWidth:o,E=p?r.offsetHeight:d,y=bb(o)!==f||bb(d)!==E;return y&&(o=f,d=E),{width:o,height:d,$:y}}function d1(r){return Ic(r)?r:r.contextElement}function Bf(r){const s=d1(r);if(!Cl(s))return vl(1);const o=s.getBoundingClientRect(),{width:d,height:p,$:f}=yQ(s);let E=(f?bb(o.width):o.width)/d,y=(f?bb(o.height):o.height)/p;return(!E||!Number.isFinite(E))&&(E=1),(!y||!Number.isFinite(y))&&(y=1),{x:E,y}}const DCe=vl(0);function SQ(r){const s=Za(r);return!l1()||!s.visualViewport?DCe:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function kCe(r,s,o){return s===void 0&&(s=!1),!o||s&&o!==Za(r)?!1:s}function _p(r,s,o,d){s===void 0&&(s=!1),o===void 0&&(o=!1);const p=r.getBoundingClientRect(),f=d1(r);let E=vl(1);s&&(d?Ic(d)&&(E=Bf(d)):E=Bf(r));const y=kCe(f,o,d)?SQ(f):vl(0);let b=(p.left+y.x)/E.x,C=(p.top+y.y)/E.y,A=p.width/E.x,D=p.height/E.y;if(f){const k=Za(f),W=d&&Ic(d)?Za(d):d;let G=k,L=NP(G);for(;L&&d&&W!==G;){const B=Bf(L),H=L.getBoundingClientRect(),V=Ac(L),K=H.left+(L.clientLeft+parseFloat(V.paddingLeft))*B.x,Z=H.top+(L.clientTop+parseFloat(V.paddingTop))*B.y;b*=B.x,C*=B.y,A*=B.x,D*=B.y,b+=K,C+=Z,G=Za(L),L=NP(G)}}return Cb({width:A,height:D,x:b,y:C})}function u1(r,s){const o=vw(r).scrollLeft;return s?s.left+o:_p(Nl(r)).left+o}function TQ(r,s,o){o===void 0&&(o=!1);const d=r.getBoundingClientRect(),p=d.left+s.scrollLeft-(o?0:u1(r,d)),f=d.top+s.scrollTop;return{x:p,y:f}}function LCe(r){let{elements:s,rect:o,offsetParent:d,strategy:p}=r;const f=p==="fixed",E=Nl(d),y=s?Ew(s.floating):!1;if(d===E||y&&f)return o;let b={scrollLeft:0,scrollTop:0},C=vl(1);const A=vl(0),D=Cl(d);if((D||!D&&!f)&&((Og(d)!=="body"||Wv(E))&&(b=vw(d)),Cl(d))){const W=_p(d);C=Bf(d),A.x=W.x+d.clientLeft,A.y=W.y+d.clientTop}const k=E&&!D&&!f?TQ(E,b,!0):vl(0);return{width:o.width*C.x,height:o.height*C.y,x:o.x*C.x-b.scrollLeft*C.x+A.x+k.x,y:o.y*C.y-b.scrollTop*C.y+A.y+k.y}}function jCe(r){return Array.from(r.getClientRects())}function MCe(r){const s=Nl(r),o=vw(r),d=r.ownerDocument.body,p=Xa(s.scrollWidth,s.clientWidth,d.scrollWidth,d.clientWidth),f=Xa(s.scrollHeight,s.clientHeight,d.scrollHeight,d.clientHeight);let E=-o.scrollLeft+u1(r);const y=-o.scrollTop;return Ac(d).direction==="rtl"&&(E+=Xa(s.clientWidth,d.clientWidth)-p),{width:p,height:f,x:E,y}}function UCe(r,s){const o=Za(r),d=Nl(r),p=o.visualViewport;let f=d.clientWidth,E=d.clientHeight,y=0,b=0;if(p){f=p.width,E=p.height;const C=l1();(!C||C&&s==="fixed")&&(y=p.offsetLeft,b=p.offsetTop)}return{width:f,height:E,x:y,y:b}}function VCe(r,s){const o=_p(r,!0,s==="fixed"),d=o.top+r.clientTop,p=o.left+r.clientLeft,f=Cl(r)?Bf(r):vl(1),E=r.clientWidth*f.x,y=r.clientHeight*f.y,b=p*f.x,C=d*f.y;return{width:E,height:y,x:b,y:C}}function $8(r,s,o){let d;if(s==="viewport")d=UCe(r,o);else if(s==="document")d=MCe(Nl(r));else if(Ic(s))d=VCe(s,o);else{const p=SQ(r);d={x:s.x-p.x,y:s.y-p.y,width:s.width,height:s.height}}return Cb(d)}function bQ(r,s){const o=ju(r);return o===s||!Ic(o)||gg(o)?!1:Ac(o).position==="fixed"||bQ(o,s)}function FCe(r,s){const o=s.get(r);if(o)return o;let d=gv(r,[],!1).filter(y=>Ic(y)&&Og(y)!=="body"),p=null;const f=Ac(r).position==="fixed";let E=f?ju(r):r;for(;Ic(E)&&!gg(E);){const y=Ac(E),b=c1(E);!b&&y.position==="fixed"&&(p=null),(f?!b&&!p:!b&&y.position==="static"&&!!p&&["absolute","fixed"].includes(p.position)||Wv(E)&&!b&&bQ(r,E))?d=d.filter(A=>A!==E):p=y,E=ju(E)}return s.set(r,d),d}function BCe(r){let{element:s,boundary:o,rootBoundary:d,strategy:p}=r;const E=[...o==="clippingAncestors"?Ew(s)?[]:FCe(s,this._c):[].concat(o),d],y=E[0],b=E.reduce((C,A)=>{const D=$8(s,A,p);return C.top=Xa(D.top,C.top),C.right=ku(D.right,C.right),C.bottom=ku(D.bottom,C.bottom),C.left=Xa(D.left,C.left),C},$8(s,y,p));return{width:b.right-b.left,height:b.bottom-b.top,x:b.left,y:b.top}}function GCe(r){const{width:s,height:o}=yQ(r);return{width:s,height:o}}function WCe(r,s,o){const d=Cl(s),p=Nl(s),f=o==="fixed",E=_p(r,!0,f,s);let y={scrollLeft:0,scrollTop:0};const b=vl(0);if(d||!d&&!f)if((Og(s)!=="body"||Wv(p))&&(y=vw(s)),d){const k=_p(s,!0,f,s);b.x=k.x+s.clientLeft,b.y=k.y+s.clientTop}else p&&(b.x=u1(p));const C=p&&!d&&!f?TQ(p,y):vl(0),A=E.left+y.scrollLeft-b.x-C.x,D=E.top+y.scrollTop-b.y-C.y;return{x:A,y:D,width:E.width,height:E.height}}function XA(r){return Ac(r).position==="static"}function Z8(r,s){if(!Cl(r)||Ac(r).position==="fixed")return null;if(s)return s(r);let o=r.offsetParent;return Nl(r)===o&&(o=o.ownerDocument.body),o}function wQ(r,s){const o=Za(r);if(Ew(r))return o;if(!Cl(r)){let p=ju(r);for(;p&&!gg(p);){if(Ic(p)&&!XA(p))return p;p=ju(p)}return o}let d=Z8(r,s);for(;d&&OCe(d)&&XA(d);)d=Z8(d,s);return d&&gg(d)&&XA(d)&&!c1(d)?o:d||PCe(r)||o}const HCe=async function(r){const s=this.getOffsetParent||wQ,o=this.getDimensions,d=await o(r.floating);return{reference:WCe(r.reference,await s(r.floating),r.strategy),floating:{x:0,y:0,width:d.width,height:d.height}}};function KCe(r){return Ac(r).direction==="rtl"}const zCe={convertOffsetParentRelativeRectToViewportRelativeRect:LCe,getDocumentElement:Nl,getClippingRect:BCe,getOffsetParent:wQ,getElementRects:HCe,getClientRects:jCe,getDimensions:GCe,getScale:Bf,isElement:Ic,isRTL:KCe};function CQ(r,s){return r.x===s.x&&r.y===s.y&&r.width===s.width&&r.height===s.height}function qCe(r,s){let o=null,d;const p=Nl(r);function f(){var y;clearTimeout(d),(y=o)==null||y.disconnect(),o=null}function E(y,b){y===void 0&&(y=!1),b===void 0&&(b=1),f();const C=r.getBoundingClientRect(),{left:A,top:D,width:k,height:W}=C;if(y||s(),!k||!W)return;const G=vT(D),L=vT(p.clientWidth-(A+k)),B=vT(p.clientHeight-(D+W)),H=vT(A),K={rootMargin:-G+"px "+-L+"px "+-B+"px "+-H+"px",threshold:Xa(0,ku(1,b))||1};let Z=!0;function ee($){const se=$[0].intersectionRatio;if(se!==b){if(!Z)return E();se?E(!1,se):d=setTimeout(()=>{E(!1,1e-7)},1e3)}se===1&&!CQ(C,r.getBoundingClientRect())&&E(),Z=!1}try{o=new IntersectionObserver(ee,{...K,root:p.ownerDocument})}catch{o=new IntersectionObserver(ee,K)}o.observe(r)}return E(!0),f}function YCe(r,s,o,d){d===void 0&&(d={});const{ancestorScroll:p=!0,ancestorResize:f=!0,elementResize:E=typeof ResizeObserver=="function",layoutShift:y=typeof IntersectionObserver=="function",animationFrame:b=!1}=d,C=d1(r),A=p||f?[...C?gv(C):[],...gv(s)]:[];A.forEach(H=>{p&&H.addEventListener("scroll",o,{passive:!0}),f&&H.addEventListener("resize",o)});const D=C&&y?qCe(C,o):null;let k=-1,W=null;E&&(W=new ResizeObserver(H=>{let[V]=H;V&&V.target===C&&W&&(W.unobserve(s),cancelAnimationFrame(k),k=requestAnimationFrame(()=>{var K;(K=W)==null||K.observe(s)})),o()}),C&&!b&&W.observe(C),W.observe(s));let G,L=b?_p(r):null;b&&B();function B(){const H=_p(r);L&&!CQ(L,H)&&o(),L=H,G=requestAnimationFrame(B)}return o(),()=>{var H;A.forEach(V=>{p&&V.removeEventListener("scroll",o),f&&V.removeEventListener("resize",o)}),D==null||D(),(H=W)==null||H.disconnect(),W=null,b&&cancelAnimationFrame(G)}}const XCe=xCe,QCe=NCe,JCe=wCe,$Ce=ACe,ZCe=CCe,eH=bCe,eRe=ICe,tRe=(r,s,o)=>{const d=new Map,p={platform:zCe,...o},f={...p.platform,_c:d};return TCe(r,s,{...p,platform:f})};var WT=typeof document<"u"?I.useLayoutEffect:I.useEffect;function Rb(r,s){if(r===s)return!0;if(typeof r!=typeof s)return!1;if(typeof r=="function"&&r.toString()===s.toString())return!0;let o,d,p;if(r&&s&&typeof r=="object"){if(Array.isArray(r)){if(o=r.length,o!==s.length)return!1;for(d=o;d--!==0;)if(!Rb(r[d],s[d]))return!1;return!0}if(p=Object.keys(r),o=p.length,o!==Object.keys(s).length)return!1;for(d=o;d--!==0;)if(!{}.hasOwnProperty.call(s,p[d]))return!1;for(d=o;d--!==0;){const f=p[d];if(!(f==="_owner"&&r.$$typeof)&&!Rb(r[f],s[f]))return!1}return!0}return r!==r&&s!==s}function RQ(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function tH(r,s){const o=RQ(r);return Math.round(s*o)/o}function QA(r){const s=I.useRef(r);return WT(()=>{s.current=r}),s}function nRe(r){r===void 0&&(r={});const{placement:s="bottom",strategy:o="absolute",middleware:d=[],platform:p,elements:{reference:f,floating:E}={},transform:y=!0,whileElementsMounted:b,open:C}=r,[A,D]=I.useState({x:0,y:0,strategy:o,placement:s,middlewareData:{},isPositioned:!1}),[k,W]=I.useState(d);Rb(k,d)||W(d);const[G,L]=I.useState(null),[B,H]=I.useState(null),V=I.useCallback(Re=>{Re!==$.current&&($.current=Re,L(Re))},[]),K=I.useCallback(Re=>{Re!==se.current&&(se.current=Re,H(Re))},[]),Z=f||G,ee=E||B,$=I.useRef(null),se=I.useRef(null),le=I.useRef(A),X=b!=null,oe=QA(b),je=QA(p),Ce=QA(C),We=I.useCallback(()=>{if(!$.current||!se.current)return;const Re={placement:s,strategy:o,middleware:k};je.current&&(Re.platform=je.current),tRe($.current,se.current,Re).then(et=>{const xe={...et,isPositioned:Ce.current!==!1};he.current&&!Rb(le.current,xe)&&(le.current=xe,Op.flushSync(()=>{D(xe)}))})},[k,s,o,je,Ce]);WT(()=>{C===!1&&le.current.isPositioned&&(le.current.isPositioned=!1,D(Re=>({...Re,isPositioned:!1})))},[C]);const he=I.useRef(!1);WT(()=>(he.current=!0,()=>{he.current=!1}),[]),WT(()=>{if(Z&&($.current=Z),ee&&(se.current=ee),Z&&ee){if(oe.current)return oe.current(Z,ee,We);We()}},[Z,ee,We,oe,X]);const rt=I.useMemo(()=>({reference:$,floating:se,setReference:V,setFloating:K}),[V,K]),De=I.useMemo(()=>({reference:Z,floating:ee}),[Z,ee]),Oe=I.useMemo(()=>{const Re={position:o,left:0,top:0};if(!De.floating)return Re;const et=tH(De.floating,A.x),xe=tH(De.floating,A.y);return y?{...Re,transform:"translate("+et+"px, "+xe+"px)",...RQ(De.floating)>=1.5&&{willChange:"transform"}}:{position:o,left:et,top:xe}},[o,y,De.floating,A.x,A.y]);return I.useMemo(()=>({...A,update:We,refs:rt,elements:De,floatingStyles:Oe}),[A,We,rt,De,Oe])}const rRe=r=>{function s(o){return{}.hasOwnProperty.call(o,"current")}return{name:"arrow",options:r,fn(o){const{element:d,padding:p}=typeof r=="function"?r(o):r;return d&&s(d)?d.current!=null?eH({element:d.current,padding:p}).fn(o):{}:d?eH({element:d,padding:p}).fn(o):{}}}},sRe=(r,s)=>({...XCe(r),options:[r,s]}),iRe=(r,s)=>({...QCe(r),options:[r,s]}),aRe=(r,s)=>({...eRe(r),options:[r,s]}),oRe=(r,s)=>({...JCe(r),options:[r,s]}),cRe=(r,s)=>({...$Ce(r),options:[r,s]}),lRe=(r,s)=>({...ZCe(r),options:[r,s]}),dRe=(r,s)=>({...rRe(r),options:[r,s]});var uRe="Arrow",xQ=I.forwardRef((r,s)=>{const{children:o,width:d=10,height:p=5,...f}=r;return c.jsx($t.svg,{...f,ref:s,width:d,height:p,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?o:c.jsx("polygon",{points:"0,0 30,0 15,10"})})});xQ.displayName=uRe;var hRe=xQ;function NQ(r){const[s,o]=I.useState(void 0);return qs(()=>{if(r){o({width:r.offsetWidth,height:r.offsetHeight});const d=new ResizeObserver(p=>{if(!Array.isArray(p)||!p.length)return;const f=p[0];let E,y;if("borderBoxSize"in f){const b=f.borderBoxSize,C=Array.isArray(b)?b[0]:b;E=C.inlineSize,y=C.blockSize}else E=r.offsetWidth,y=r.offsetHeight;o({width:E,height:y})});return d.observe(r,{box:"border-box"}),()=>d.unobserve(r)}else o(void 0)},[r]),s}var h1="Popper",[IQ,yw]=Vo(h1),[pRe,AQ]=IQ(h1),OQ=r=>{const{__scopePopper:s,children:o}=r,[d,p]=I.useState(null);return c.jsx(pRe,{scope:s,anchor:d,onAnchorChange:p,children:o})};OQ.displayName=h1;var PQ="PopperAnchor",DQ=I.forwardRef((r,s)=>{const{__scopePopper:o,virtualRef:d,...p}=r,f=AQ(PQ,o),E=I.useRef(null),y=Zn(s,E);return I.useEffect(()=>{f.onAnchorChange((d==null?void 0:d.current)||E.current)}),d?null:c.jsx($t.div,{...p,ref:y})});DQ.displayName=PQ;var p1="PopperContent",[mRe,fRe]=IQ(p1),kQ=I.forwardRef((r,s)=>{var Lt,tr,Ar,Un,zn,Xn;const{__scopePopper:o,side:d="bottom",sideOffset:p=0,align:f="center",alignOffset:E=0,arrowPadding:y=0,avoidCollisions:b=!0,collisionBoundary:C=[],collisionPadding:A=0,sticky:D="partial",hideWhenDetached:k=!1,updatePositionStrategy:W="optimized",onPlaced:G,...L}=r,B=AQ(p1,o),[H,V]=I.useState(null),K=Zn(s,Wr=>V(Wr)),[Z,ee]=I.useState(null),$=NQ(Z),se=($==null?void 0:$.width)??0,le=($==null?void 0:$.height)??0,X=d+(f!=="center"?"-"+f:""),oe=typeof A=="number"?A:{top:0,right:0,bottom:0,left:0,...A},je=Array.isArray(C)?C:[C],Ce=je.length>0,We={padding:oe,boundary:je.filter(_Re),altBoundary:Ce},{refs:he,floatingStyles:rt,placement:De,isPositioned:Oe,middlewareData:Re}=nRe({strategy:"fixed",placement:X,whileElementsMounted:(...Wr)=>YCe(...Wr,{animationFrame:W==="always"}),elements:{reference:B.anchor},middleware:[sRe({mainAxis:p+le,alignmentAxis:E}),b&&iRe({mainAxis:!0,crossAxis:!1,limiter:D==="partial"?aRe():void 0,...We}),b&&oRe({...We}),cRe({...We,apply:({elements:Wr,rects:Ei,availableWidth:Bo,availableHeight:Ys})=>{const{width:io,height:rs}=Ei.reference,fs=Wr.floating.style;fs.setProperty("--radix-popper-available-width",`${Bo}px`),fs.setProperty("--radix-popper-available-height",`${Ys}px`),fs.setProperty("--radix-popper-anchor-width",`${io}px`),fs.setProperty("--radix-popper-anchor-height",`${rs}px`)}}),Z&&dRe({element:Z,padding:y}),ERe({arrowWidth:se,arrowHeight:le}),k&&lRe({strategy:"referenceHidden",...We})]}),[et,xe]=MQ(De),Pt=Ps(G);qs(()=>{Oe&&(Pt==null||Pt())},[Oe,Pt]);const rn=(Lt=Re.arrow)==null?void 0:Lt.x,Gr=(tr=Re.arrow)==null?void 0:tr.y,er=((Ar=Re.arrow)==null?void 0:Ar.centerOffset)!==0,[_i,ns]=I.useState();return qs(()=>{H&&ns(window.getComputedStyle(H).zIndex)},[H]),c.jsx("div",{ref:he.setFloating,"data-radix-popper-content-wrapper":"",style:{...rt,transform:Oe?rt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:_i,"--radix-popper-transform-origin":[(Un=Re.transformOrigin)==null?void 0:Un.x,(zn=Re.transformOrigin)==null?void 0:zn.y].join(" "),...((Xn=Re.hide)==null?void 0:Xn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:c.jsx(mRe,{scope:o,placedSide:et,onArrowChange:ee,arrowX:rn,arrowY:Gr,shouldHideArrow:er,children:c.jsx($t.div,{"data-side":et,"data-align":xe,...L,ref:K,style:{...L.style,animation:Oe?void 0:"none"}})})})});kQ.displayName=p1;var LQ="PopperArrow",gRe={top:"bottom",right:"left",bottom:"top",left:"right"},jQ=I.forwardRef(function(s,o){const{__scopePopper:d,...p}=s,f=fRe(LQ,d),E=gRe[f.placedSide];return c.jsx("span",{ref:f.onArrowChange,style:{position:"absolute",left:f.arrowX,top:f.arrowY,[E]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[f.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[f.placedSide],visibility:f.shouldHideArrow?"hidden":void 0},children:c.jsx(hRe,{...p,ref:o,style:{...p.style,display:"block"}})})});jQ.displayName=LQ;function _Re(r){return r!==null}var ERe=r=>({name:"transformOrigin",options:r,fn(s){var B,H,V;const{placement:o,rects:d,middlewareData:p}=s,E=((B=p.arrow)==null?void 0:B.centerOffset)!==0,y=E?0:r.arrowWidth,b=E?0:r.arrowHeight,[C,A]=MQ(o),D={start:"0%",center:"50%",end:"100%"}[A],k=(((H=p.arrow)==null?void 0:H.x)??0)+y/2,W=(((V=p.arrow)==null?void 0:V.y)??0)+b/2;let G="",L="";return C==="bottom"?(G=E?D:`${k}px`,L=`${-b}px`):C==="top"?(G=E?D:`${k}px`,L=`${d.floating.height+b}px`):C==="right"?(G=`${-b}px`,L=E?D:`${W}px`):C==="left"&&(G=`${d.floating.width+b}px`,L=E?D:`${W}px`),{data:{x:G,y:L}}}});function MQ(r){const[s,o="center"]=r.split("-");return[s,o]}var UQ=OQ,VQ=DQ,FQ=kQ,BQ=jQ,[Sw,P1e]=Vo("Tooltip",[yw]),Tw=yw(),GQ="TooltipProvider",vRe=700,IP="tooltip.open",[yRe,m1]=Sw(GQ),WQ=r=>{const{__scopeTooltip:s,delayDuration:o=vRe,skipDelayDuration:d=300,disableHoverableContent:p=!1,children:f}=r,E=I.useRef(!0),y=I.useRef(!1),b=I.useRef(0);return I.useEffect(()=>{const C=b.current;return()=>window.clearTimeout(C)},[]),c.jsx(yRe,{scope:s,isOpenDelayedRef:E,delayDuration:o,onOpen:I.useCallback(()=>{window.clearTimeout(b.current),E.current=!1},[]),onClose:I.useCallback(()=>{window.clearTimeout(b.current),b.current=window.setTimeout(()=>E.current=!0,d)},[d]),isPointerInTransitRef:y,onPointerInTransitChange:I.useCallback(C=>{y.current=C},[]),disableHoverableContent:p,children:f})};WQ.displayName=GQ;var bw="Tooltip",[SRe,ww]=Sw(bw),HQ=r=>{const{__scopeTooltip:s,children:o,open:d,defaultOpen:p=!1,onOpenChange:f,disableHoverableContent:E,delayDuration:y}=r,b=m1(bw,r.__scopeTooltip),C=Tw(s),[A,D]=I.useState(null),k=ad(),W=I.useRef(0),G=E??b.disableHoverableContent,L=y??b.delayDuration,B=I.useRef(!1),[H=!1,V]=Du({prop:d,defaultProp:p,onChange:se=>{se?(b.onOpen(),document.dispatchEvent(new CustomEvent(IP))):b.onClose(),f==null||f(se)}}),K=I.useMemo(()=>H?B.current?"delayed-open":"instant-open":"closed",[H]),Z=I.useCallback(()=>{window.clearTimeout(W.current),W.current=0,B.current=!1,V(!0)},[V]),ee=I.useCallback(()=>{window.clearTimeout(W.current),W.current=0,V(!1)},[V]),$=I.useCallback(()=>{window.clearTimeout(W.current),W.current=window.setTimeout(()=>{B.current=!0,V(!0),W.current=0},L)},[L,V]);return I.useEffect(()=>()=>{W.current&&(window.clearTimeout(W.current),W.current=0)},[]),c.jsx(UQ,{...C,children:c.jsx(SRe,{scope:s,contentId:k,open:H,stateAttribute:K,trigger:A,onTriggerChange:D,onTriggerEnter:I.useCallback(()=>{b.isOpenDelayedRef.current?$():Z()},[b.isOpenDelayedRef,$,Z]),onTriggerLeave:I.useCallback(()=>{G?ee():(window.clearTimeout(W.current),W.current=0)},[ee,G]),onOpen:Z,onClose:ee,disableHoverableContent:G,children:o})})};HQ.displayName=bw;var AP="TooltipTrigger",KQ=I.forwardRef((r,s)=>{const{__scopeTooltip:o,...d}=r,p=ww(AP,o),f=m1(AP,o),E=Tw(o),y=I.useRef(null),b=Zn(s,y,p.onTriggerChange),C=I.useRef(!1),A=I.useRef(!1),D=I.useCallback(()=>C.current=!1,[]);return I.useEffect(()=>()=>document.removeEventListener("pointerup",D),[D]),c.jsx(VQ,{asChild:!0,...E,children:c.jsx($t.button,{"aria-describedby":p.open?p.contentId:void 0,"data-state":p.stateAttribute,...d,ref:b,onPointerMove:Vt(r.onPointerMove,k=>{k.pointerType!=="touch"&&!A.current&&!f.isPointerInTransitRef.current&&(p.onTriggerEnter(),A.current=!0)}),onPointerLeave:Vt(r.onPointerLeave,()=>{p.onTriggerLeave(),A.current=!1}),onPointerDown:Vt(r.onPointerDown,()=>{p.open&&p.onClose(),C.current=!0,document.addEventListener("pointerup",D,{once:!0})}),onFocus:Vt(r.onFocus,()=>{C.current||p.onOpen()}),onBlur:Vt(r.onBlur,p.onClose),onClick:Vt(r.onClick,p.onClose)})})});KQ.displayName=AP;var TRe="TooltipPortal",[D1e,bRe]=Sw(TRe,{forceMount:void 0}),_g="TooltipContent",zQ=I.forwardRef((r,s)=>{const o=bRe(_g,r.__scopeTooltip),{forceMount:d=o.forceMount,side:p="top",...f}=r,E=ww(_g,r.__scopeTooltip);return c.jsx(Dc,{present:d||E.open,children:E.disableHoverableContent?c.jsx(qQ,{side:p,...f,ref:s}):c.jsx(wRe,{side:p,...f,ref:s})})}),wRe=I.forwardRef((r,s)=>{const o=ww(_g,r.__scopeTooltip),d=m1(_g,r.__scopeTooltip),p=I.useRef(null),f=Zn(s,p),[E,y]=I.useState(null),{trigger:b,onClose:C}=o,A=p.current,{onPointerInTransitChange:D}=d,k=I.useCallback(()=>{y(null),D(!1)},[D]),W=I.useCallback((G,L)=>{const B=G.currentTarget,H={x:G.clientX,y:G.clientY},V=IRe(H,B.getBoundingClientRect()),K=ARe(H,V),Z=ORe(L.getBoundingClientRect()),ee=DRe([...K,...Z]);y(ee),D(!0)},[D]);return I.useEffect(()=>()=>k(),[k]),I.useEffect(()=>{if(b&&A){const G=B=>W(B,A),L=B=>W(B,b);return b.addEventListener("pointerleave",G),A.addEventListener("pointerleave",L),()=>{b.removeEventListener("pointerleave",G),A.removeEventListener("pointerleave",L)}}},[b,A,W,k]),I.useEffect(()=>{if(E){const G=L=>{const B=L.target,H={x:L.clientX,y:L.clientY},V=(b==null?void 0:b.contains(B))||(A==null?void 0:A.contains(B)),K=!PRe(H,E);V?k():K&&(k(),C())};return document.addEventListener("pointermove",G),()=>document.removeEventListener("pointermove",G)}},[b,A,E,C,k]),c.jsx(qQ,{...r,ref:f})}),[CRe,RRe]=Sw(bw,{isInside:!1}),xRe=CX("TooltipContent"),qQ=I.forwardRef((r,s)=>{const{__scopeTooltip:o,children:d,"aria-label":p,onEscapeKeyDown:f,onPointerDownOutside:E,...y}=r,b=ww(_g,o),C=Tw(o),{onClose:A}=b;return I.useEffect(()=>(document.addEventListener(IP,A),()=>document.removeEventListener(IP,A)),[A]),I.useEffect(()=>{if(b.trigger){const D=k=>{const W=k.target;W!=null&&W.contains(b.trigger)&&A()};return window.addEventListener("scroll",D,{capture:!0}),()=>window.removeEventListener("scroll",D,{capture:!0})}},[b.trigger,A]),c.jsx(Fv,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:f,onPointerDownOutside:E,onFocusOutside:D=>D.preventDefault(),onDismiss:A,children:c.jsxs(FQ,{"data-state":b.stateAttribute,...C,...y,ref:s,style:{...y.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[c.jsx(xRe,{children:d}),c.jsx(CRe,{scope:o,isInside:!0,children:c.jsx(Abe,{id:b.contentId,role:"tooltip",children:p||d})})]})})});zQ.displayName=_g;var YQ="TooltipArrow",NRe=I.forwardRef((r,s)=>{const{__scopeTooltip:o,...d}=r,p=Tw(o);return RRe(YQ,o).isInside?null:c.jsx(BQ,{...p,...d,ref:s})});NRe.displayName=YQ;function IRe(r,s){const o=Math.abs(s.top-r.y),d=Math.abs(s.bottom-r.y),p=Math.abs(s.right-r.x),f=Math.abs(s.left-r.x);switch(Math.min(o,d,p,f)){case f:return"left";case p:return"right";case o:return"top";case d:return"bottom";default:throw new Error("unreachable")}}function ARe(r,s,o=5){const d=[];switch(s){case"top":d.push({x:r.x-o,y:r.y+o},{x:r.x+o,y:r.y+o});break;case"bottom":d.push({x:r.x-o,y:r.y-o},{x:r.x+o,y:r.y-o});break;case"left":d.push({x:r.x+o,y:r.y-o},{x:r.x+o,y:r.y+o});break;case"right":d.push({x:r.x-o,y:r.y-o},{x:r.x-o,y:r.y+o});break}return d}function ORe(r){const{top:s,right:o,bottom:d,left:p}=r;return[{x:p,y:s},{x:o,y:s},{x:o,y:d},{x:p,y:d}]}function PRe(r,s){const{x:o,y:d}=r;let p=!1;for(let f=0,E=s.length-1;f<s.length;E=f++){const y=s[f].x,b=s[f].y,C=s[E].x,A=s[E].y;b>d!=A>d&&o<(C-y)*(d-b)/(A-b)+y&&(p=!p)}return p}function DRe(r){const s=r.slice();return s.sort((o,d)=>o.x<d.x?-1:o.x>d.x?1:o.y<d.y?-1:o.y>d.y?1:0),kRe(s)}function kRe(r){if(r.length<=1)return r.slice();const s=[];for(let d=0;d<r.length;d++){const p=r[d];for(;s.length>=2;){const f=s[s.length-1],E=s[s.length-2];if((f.x-E.x)*(p.y-E.y)>=(f.y-E.y)*(p.x-E.x))s.pop();else break}s.push(p)}s.pop();const o=[];for(let d=r.length-1;d>=0;d--){const p=r[d];for(;o.length>=2;){const f=o[o.length-1],E=o[o.length-2];if((f.x-E.x)*(p.y-E.y)>=(f.y-E.y)*(p.x-E.x))o.pop();else break}o.push(p)}return o.pop(),s.length===1&&o.length===1&&s[0].x===o[0].x&&s[0].y===o[0].y?s:s.concat(o)}var LRe=WQ,jRe=HQ,MRe=KQ,XQ=zQ;const QQ=LRe,URe=jRe,VRe=MRe,JQ=I.forwardRef(({className:r,sideOffset:s=4,...o},d)=>c.jsx(XQ,{ref:d,sideOffset:s,className:ct("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",r),...o}));JQ.displayName=XQ.displayName;const JA=768;function FRe(){const[r,s]=I.useState(void 0);return I.useEffect(()=>{const o=window.matchMedia(`(max-width: ${JA-1}px)`),d=()=>{s(window.innerWidth<JA)};return o.addEventListener("change",d),s(window.innerWidth<JA),()=>o.removeEventListener("change",d)},[]),!!r}const f1=kp("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none ",secondary:"border bg-secondary text-secondary-foreground border border-secondary-border ",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),we=I.forwardRef(({className:r,variant:s,size:o,asChild:d=!1,...p},f)=>{const E=d?hw:"button";return c.jsx(E,{className:ct(f1({variant:s,size:o,className:r})),ref:f,...p})});we.displayName="Button";const at=I.forwardRef(({className:r,type:s,...o},d)=>c.jsx("input",{type:s,className:ct("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:d,...o}));at.displayName="Input";var BRe="Separator",nH="horizontal",GRe=["horizontal","vertical"],$Q=I.forwardRef((r,s)=>{const{decorative:o,orientation:d=nH,...p}=r,f=WRe(d)?d:nH,y=o?{role:"none"}:{"aria-orientation":f==="vertical"?f:void 0,role:"separator"};return c.jsx($t.div,{"data-orientation":f,...y,...p,ref:s})});$Q.displayName=BRe;function WRe(r){return GRe.includes(r)}var ZQ=$Q;const td=I.forwardRef(({className:r,orientation:s="horizontal",decorative:o=!0,...d},p)=>c.jsx(ZQ,{ref:p,decorative:o,orientation:s,className:ct("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...d}));td.displayName=ZQ.displayName;var $A="focusScope.autoFocusOnMount",ZA="focusScope.autoFocusOnUnmount",rH={bubbles:!1,cancelable:!0},HRe="FocusScope",g1=I.forwardRef((r,s)=>{const{loop:o=!1,trapped:d=!1,onMountAutoFocus:p,onUnmountAutoFocus:f,...E}=r,[y,b]=I.useState(null),C=Ps(p),A=Ps(f),D=I.useRef(null),k=Zn(s,L=>b(L)),W=I.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;I.useEffect(()=>{if(d){let L=function(K){if(W.paused||!y)return;const Z=K.target;y.contains(Z)?D.current=Z:ru(D.current,{select:!0})},B=function(K){if(W.paused||!y)return;const Z=K.relatedTarget;Z!==null&&(y.contains(Z)||ru(D.current,{select:!0}))},H=function(K){if(document.activeElement===document.body)for(const ee of K)ee.removedNodes.length>0&&ru(y)};document.addEventListener("focusin",L),document.addEventListener("focusout",B);const V=new MutationObserver(H);return y&&V.observe(y,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",L),document.removeEventListener("focusout",B),V.disconnect()}}},[d,y,W.paused]),I.useEffect(()=>{if(y){iH.add(W);const L=document.activeElement;if(!y.contains(L)){const H=new CustomEvent($A,rH);y.addEventListener($A,C),y.dispatchEvent(H),H.defaultPrevented||(KRe(QRe(eJ(y)),{select:!0}),document.activeElement===L&&ru(y))}return()=>{y.removeEventListener($A,C),setTimeout(()=>{const H=new CustomEvent(ZA,rH);y.addEventListener(ZA,A),y.dispatchEvent(H),H.defaultPrevented||ru(L??document.body,{select:!0}),y.removeEventListener(ZA,A),iH.remove(W)},0)}}},[y,C,A,W]);const G=I.useCallback(L=>{if(!o&&!d||W.paused)return;const B=L.key==="Tab"&&!L.altKey&&!L.ctrlKey&&!L.metaKey,H=document.activeElement;if(B&&H){const V=L.currentTarget,[K,Z]=zRe(V);K&&Z?!L.shiftKey&&H===Z?(L.preventDefault(),o&&ru(K,{select:!0})):L.shiftKey&&H===K&&(L.preventDefault(),o&&ru(Z,{select:!0})):H===V&&L.preventDefault()}},[o,d,W.paused]);return c.jsx($t.div,{tabIndex:-1,...E,ref:k,onKeyDown:G})});g1.displayName=HRe;function KRe(r,{select:s=!1}={}){const o=document.activeElement;for(const d of r)if(ru(d,{select:s}),document.activeElement!==o)return}function zRe(r){const s=eJ(r),o=sH(s,r),d=sH(s.reverse(),r);return[o,d]}function eJ(r){const s=[],o=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const p=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||p?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)s.push(o.currentNode);return s}function sH(r,s){for(const o of r)if(!qRe(o,{upTo:s}))return o}function qRe(r,{upTo:s}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(s!==void 0&&r===s)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function YRe(r){return r instanceof HTMLInputElement&&"select"in r}function ru(r,{select:s=!1}={}){if(r&&r.focus){const o=document.activeElement;r.focus({preventScroll:!0}),r!==o&&YRe(r)&&s&&r.select()}}var iH=XRe();function XRe(){let r=[];return{add(s){const o=r[0];s!==o&&(o==null||o.pause()),r=aH(r,s),r.unshift(s)},remove(s){var o;r=aH(r,s),(o=r[0])==null||o.resume()}}}function aH(r,s){const o=[...r],d=o.indexOf(s);return d!==-1&&o.splice(d,1),o}function QRe(r){return r.filter(s=>s.tagName!=="A")}var eO=0;function tJ(){I.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??oH()),document.body.insertAdjacentElement("beforeend",r[1]??oH()),eO++,()=>{eO===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),eO--}},[])}function oH(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var fl=function(){return fl=Object.assign||function(s){for(var o,d=1,p=arguments.length;d<p;d++){o=arguments[d];for(var f in o)Object.prototype.hasOwnProperty.call(o,f)&&(s[f]=o[f])}return s},fl.apply(this,arguments)};function nJ(r,s){var o={};for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&s.indexOf(d)<0&&(o[d]=r[d]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,d=Object.getOwnPropertySymbols(r);p<d.length;p++)s.indexOf(d[p])<0&&Object.prototype.propertyIsEnumerable.call(r,d[p])&&(o[d[p]]=r[d[p]]);return o}function JRe(r,s,o){if(o||arguments.length===2)for(var d=0,p=s.length,f;d<p;d++)(f||!(d in s))&&(f||(f=Array.prototype.slice.call(s,0,d)),f[d]=s[d]);return r.concat(f||Array.prototype.slice.call(s))}var HT="right-scroll-bar-position",KT="width-before-scroll-bar",$Re="with-scroll-bars-hidden",ZRe="--removed-body-scroll-bar-size";function tO(r,s){return typeof r=="function"?r(s):r&&(r.current=s),r}function exe(r,s){var o=I.useState(function(){return{value:r,callback:s,facade:{get current(){return o.value},set current(d){var p=o.value;p!==d&&(o.value=d,o.callback(d,p))}}}})[0];return o.callback=s,o.facade}var txe=typeof window<"u"?I.useLayoutEffect:I.useEffect,cH=new WeakMap;function nxe(r,s){var o=exe(null,function(d){return r.forEach(function(p){return tO(p,d)})});return txe(function(){var d=cH.get(o);if(d){var p=new Set(d),f=new Set(r),E=o.current;p.forEach(function(y){f.has(y)||tO(y,null)}),f.forEach(function(y){p.has(y)||tO(y,E)})}cH.set(o,r)},[r]),o}function rxe(r){return r}function sxe(r,s){s===void 0&&(s=rxe);var o=[],d=!1,p={read:function(){if(d)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return o.length?o[o.length-1]:r},useMedium:function(f){var E=s(f,d);return o.push(E),function(){o=o.filter(function(y){return y!==E})}},assignSyncMedium:function(f){for(d=!0;o.length;){var E=o;o=[],E.forEach(f)}o={push:function(y){return f(y)},filter:function(){return o}}},assignMedium:function(f){d=!0;var E=[];if(o.length){var y=o;o=[],y.forEach(f),E=o}var b=function(){var A=E;E=[],A.forEach(f)},C=function(){return Promise.resolve().then(b)};C(),o={push:function(A){E.push(A),C()},filter:function(A){return E=E.filter(A),o}}}};return p}function ixe(r){r===void 0&&(r={});var s=sxe(null);return s.options=fl({async:!0,ssr:!1},r),s}var rJ=function(r){var s=r.sideCar,o=nJ(r,["sideCar"]);if(!s)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var d=s.read();if(!d)throw new Error("Sidecar medium not found");return I.createElement(d,fl({},o))};rJ.isSideCarExport=!0;function axe(r,s){return r.useMedium(s),rJ}var sJ=ixe(),nO=function(){},Cw=I.forwardRef(function(r,s){var o=I.useRef(null),d=I.useState({onScrollCapture:nO,onWheelCapture:nO,onTouchMoveCapture:nO}),p=d[0],f=d[1],E=r.forwardProps,y=r.children,b=r.className,C=r.removeScrollBar,A=r.enabled,D=r.shards,k=r.sideCar,W=r.noIsolation,G=r.inert,L=r.allowPinchZoom,B=r.as,H=B===void 0?"div":B,V=r.gapMode,K=nJ(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),Z=k,ee=nxe([o,s]),$=fl(fl({},K),p);return I.createElement(I.Fragment,null,A&&I.createElement(Z,{sideCar:sJ,removeScrollBar:C,shards:D,noIsolation:W,inert:G,setCallbacks:f,allowPinchZoom:!!L,lockRef:o,gapMode:V}),E?I.cloneElement(I.Children.only(y),fl(fl({},$),{ref:ee})):I.createElement(H,fl({},$,{className:b,ref:ee}),y))});Cw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Cw.classNames={fullWidth:KT,zeroRight:HT};var oxe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function cxe(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var s=oxe();return s&&r.setAttribute("nonce",s),r}function lxe(r,s){r.styleSheet?r.styleSheet.cssText=s:r.appendChild(document.createTextNode(s))}function dxe(r){var s=document.head||document.getElementsByTagName("head")[0];s.appendChild(r)}var uxe=function(){var r=0,s=null;return{add:function(o){r==0&&(s=cxe())&&(lxe(s,o),dxe(s)),r++},remove:function(){r--,!r&&s&&(s.parentNode&&s.parentNode.removeChild(s),s=null)}}},hxe=function(){var r=uxe();return function(s,o){I.useEffect(function(){return r.add(s),function(){r.remove()}},[s&&o])}},iJ=function(){var r=hxe(),s=function(o){var d=o.styles,p=o.dynamic;return r(d,p),null};return s},pxe={left:0,top:0,right:0,gap:0},rO=function(r){return parseInt(r||"",10)||0},mxe=function(r){var s=window.getComputedStyle(document.body),o=s[r==="padding"?"paddingLeft":"marginLeft"],d=s[r==="padding"?"paddingTop":"marginTop"],p=s[r==="padding"?"paddingRight":"marginRight"];return[rO(o),rO(d),rO(p)]},fxe=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return pxe;var s=mxe(r),o=document.documentElement.clientWidth,d=window.innerWidth;return{left:s[0],top:s[1],right:s[2],gap:Math.max(0,d-o+s[2]-s[0])}},gxe=iJ(),Gf="data-scroll-locked",_xe=function(r,s,o,d){var p=r.left,f=r.top,E=r.right,y=r.gap;return o===void 0&&(o="margin"),`
  .`.concat($Re,` {
   overflow: hidden `).concat(d,`;
   padding-right: `).concat(y,"px ").concat(d,`;
  }
  body[`).concat(Gf,`] {
    overflow: hidden `).concat(d,`;
    overscroll-behavior: contain;
    `).concat([s&&"position: relative ".concat(d,";"),o==="margin"&&`
    padding-left: `.concat(p,`px;
    padding-top: `).concat(f,`px;
    padding-right: `).concat(E,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(d,`;
    `),o==="padding"&&"padding-right: ".concat(y,"px ").concat(d,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(HT,` {
    right: `).concat(y,"px ").concat(d,`;
  }
  
  .`).concat(KT,` {
    margin-right: `).concat(y,"px ").concat(d,`;
  }
  
  .`).concat(HT," .").concat(HT,` {
    right: 0 `).concat(d,`;
  }
  
  .`).concat(KT," .").concat(KT,` {
    margin-right: 0 `).concat(d,`;
  }
  
  body[`).concat(Gf,`] {
    `).concat(ZRe,": ").concat(y,`px;
  }
`)},lH=function(){var r=parseInt(document.body.getAttribute(Gf)||"0",10);return isFinite(r)?r:0},Exe=function(){I.useEffect(function(){return document.body.setAttribute(Gf,(lH()+1).toString()),function(){var r=lH()-1;r<=0?document.body.removeAttribute(Gf):document.body.setAttribute(Gf,r.toString())}},[])},vxe=function(r){var s=r.noRelative,o=r.noImportant,d=r.gapMode,p=d===void 0?"margin":d;Exe();var f=I.useMemo(function(){return fxe(p)},[p]);return I.createElement(gxe,{styles:_xe(f,!s,p,o?"":"!important")})},OP=!1;if(typeof window<"u")try{var yT=Object.defineProperty({},"passive",{get:function(){return OP=!0,!0}});window.addEventListener("test",yT,yT),window.removeEventListener("test",yT,yT)}catch{OP=!1}var lf=OP?{passive:!1}:!1,yxe=function(r){return r.tagName==="TEXTAREA"},aJ=function(r,s){if(!(r instanceof Element))return!1;var o=window.getComputedStyle(r);return o[s]!=="hidden"&&!(o.overflowY===o.overflowX&&!yxe(r)&&o[s]==="visible")},Sxe=function(r){return aJ(r,"overflowY")},Txe=function(r){return aJ(r,"overflowX")},dH=function(r,s){var o=s.ownerDocument,d=s;do{typeof ShadowRoot<"u"&&d instanceof ShadowRoot&&(d=d.host);var p=oJ(r,d);if(p){var f=cJ(r,d),E=f[1],y=f[2];if(E>y)return!0}d=d.parentNode}while(d&&d!==o.body);return!1},bxe=function(r){var s=r.scrollTop,o=r.scrollHeight,d=r.clientHeight;return[s,o,d]},wxe=function(r){var s=r.scrollLeft,o=r.scrollWidth,d=r.clientWidth;return[s,o,d]},oJ=function(r,s){return r==="v"?Sxe(s):Txe(s)},cJ=function(r,s){return r==="v"?bxe(s):wxe(s)},Cxe=function(r,s){return r==="h"&&s==="rtl"?-1:1},Rxe=function(r,s,o,d,p){var f=Cxe(r,window.getComputedStyle(s).direction),E=f*d,y=o.target,b=s.contains(y),C=!1,A=E>0,D=0,k=0;do{var W=cJ(r,y),G=W[0],L=W[1],B=W[2],H=L-B-f*G;(G||H)&&oJ(r,y)&&(D+=H,k+=G),y instanceof ShadowRoot?y=y.host:y=y.parentNode}while(!b&&y!==document.body||b&&(s.contains(y)||s===y));return(A&&(Math.abs(D)<1||!p)||!A&&(Math.abs(k)<1||!p))&&(C=!0),C},ST=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},uH=function(r){return[r.deltaX,r.deltaY]},hH=function(r){return r&&"current"in r?r.current:r},xxe=function(r,s){return r[0]===s[0]&&r[1]===s[1]},Nxe=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},Ixe=0,df=[];function Axe(r){var s=I.useRef([]),o=I.useRef([0,0]),d=I.useRef(),p=I.useState(Ixe++)[0],f=I.useState(iJ)[0],E=I.useRef(r);I.useEffect(function(){E.current=r},[r]),I.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(p));var L=JRe([r.lockRef.current],(r.shards||[]).map(hH),!0).filter(Boolean);return L.forEach(function(B){return B.classList.add("allow-interactivity-".concat(p))}),function(){document.body.classList.remove("block-interactivity-".concat(p)),L.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(p))})}}},[r.inert,r.lockRef.current,r.shards]);var y=I.useCallback(function(L,B){if("touches"in L&&L.touches.length===2||L.type==="wheel"&&L.ctrlKey)return!E.current.allowPinchZoom;var H=ST(L),V=o.current,K="deltaX"in L?L.deltaX:V[0]-H[0],Z="deltaY"in L?L.deltaY:V[1]-H[1],ee,$=L.target,se=Math.abs(K)>Math.abs(Z)?"h":"v";if("touches"in L&&se==="h"&&$.type==="range")return!1;var le=dH(se,$);if(!le)return!0;if(le?ee=se:(ee=se==="v"?"h":"v",le=dH(se,$)),!le)return!1;if(!d.current&&"changedTouches"in L&&(K||Z)&&(d.current=ee),!ee)return!0;var X=d.current||ee;return Rxe(X,B,L,X==="h"?K:Z,!0)},[]),b=I.useCallback(function(L){var B=L;if(!(!df.length||df[df.length-1]!==f)){var H="deltaY"in B?uH(B):ST(B),V=s.current.filter(function(ee){return ee.name===B.type&&(ee.target===B.target||B.target===ee.shadowParent)&&xxe(ee.delta,H)})[0];if(V&&V.should){B.cancelable&&B.preventDefault();return}if(!V){var K=(E.current.shards||[]).map(hH).filter(Boolean).filter(function(ee){return ee.contains(B.target)}),Z=K.length>0?y(B,K[0]):!E.current.noIsolation;Z&&B.cancelable&&B.preventDefault()}}},[]),C=I.useCallback(function(L,B,H,V){var K={name:L,delta:B,target:H,should:V,shadowParent:Oxe(H)};s.current.push(K),setTimeout(function(){s.current=s.current.filter(function(Z){return Z!==K})},1)},[]),A=I.useCallback(function(L){o.current=ST(L),d.current=void 0},[]),D=I.useCallback(function(L){C(L.type,uH(L),L.target,y(L,r.lockRef.current))},[]),k=I.useCallback(function(L){C(L.type,ST(L),L.target,y(L,r.lockRef.current))},[]);I.useEffect(function(){return df.push(f),r.setCallbacks({onScrollCapture:D,onWheelCapture:D,onTouchMoveCapture:k}),document.addEventListener("wheel",b,lf),document.addEventListener("touchmove",b,lf),document.addEventListener("touchstart",A,lf),function(){df=df.filter(function(L){return L!==f}),document.removeEventListener("wheel",b,lf),document.removeEventListener("touchmove",b,lf),document.removeEventListener("touchstart",A,lf)}},[]);var W=r.removeScrollBar,G=r.inert;return I.createElement(I.Fragment,null,G?I.createElement(f,{styles:Nxe(p)}):null,W?I.createElement(vxe,{gapMode:r.gapMode}):null)}function Oxe(r){for(var s=null;r!==null;)r instanceof ShadowRoot&&(s=r.host,r=r.host),r=r.parentNode;return s}const Pxe=axe(sJ,Axe);var _1=I.forwardRef(function(r,s){return I.createElement(Cw,fl({},r,{ref:s,sideCar:Pxe}))});_1.classNames=Cw.classNames;var Dxe=function(r){if(typeof document>"u")return null;var s=Array.isArray(r)?r[0]:r;return s.ownerDocument.body},uf=new WeakMap,TT=new WeakMap,bT={},sO=0,lJ=function(r){return r&&(r.host||lJ(r.parentNode))},kxe=function(r,s){return s.map(function(o){if(r.contains(o))return o;var d=lJ(o);return d&&r.contains(d)?d:(console.error("aria-hidden",o,"in not contained inside",r,". Doing nothing"),null)}).filter(function(o){return!!o})},Lxe=function(r,s,o,d){var p=kxe(s,Array.isArray(r)?r:[r]);bT[o]||(bT[o]=new WeakMap);var f=bT[o],E=[],y=new Set,b=new Set(p),C=function(D){!D||y.has(D)||(y.add(D),C(D.parentNode))};p.forEach(C);var A=function(D){!D||b.has(D)||Array.prototype.forEach.call(D.children,function(k){if(y.has(k))A(k);else try{var W=k.getAttribute(d),G=W!==null&&W!=="false",L=(uf.get(k)||0)+1,B=(f.get(k)||0)+1;uf.set(k,L),f.set(k,B),E.push(k),L===1&&G&&TT.set(k,!0),B===1&&k.setAttribute(o,"true"),G||k.setAttribute(d,"true")}catch(H){console.error("aria-hidden: cannot operate on ",k,H)}})};return A(s),y.clear(),sO++,function(){E.forEach(function(D){var k=uf.get(D)-1,W=f.get(D)-1;uf.set(D,k),f.set(D,W),k||(TT.has(D)||D.removeAttribute(d),TT.delete(D)),W||D.removeAttribute(o)}),sO--,sO||(uf=new WeakMap,uf=new WeakMap,TT=new WeakMap,bT={})}},dJ=function(r,s,o){o===void 0&&(o="data-aria-hidden");var d=Array.from(Array.isArray(r)?r:[r]),p=Dxe(r);return p?(d.push.apply(d,Array.from(p.querySelectorAll("[aria-live]"))),Lxe(d,p,o,"aria-hidden")):function(){return null}},E1="Dialog",[uJ,hJ]=Vo(E1),[jxe,kc]=uJ(E1),pJ=r=>{const{__scopeDialog:s,children:o,open:d,defaultOpen:p,onOpenChange:f,modal:E=!0}=r,y=I.useRef(null),b=I.useRef(null),[C=!1,A]=Du({prop:d,defaultProp:p,onChange:f});return c.jsx(jxe,{scope:s,triggerRef:y,contentRef:b,contentId:ad(),titleId:ad(),descriptionId:ad(),open:C,onOpenChange:A,onOpenToggle:I.useCallback(()=>A(D=>!D),[A]),modal:E,children:o})};pJ.displayName=E1;var mJ="DialogTrigger",fJ=I.forwardRef((r,s)=>{const{__scopeDialog:o,...d}=r,p=kc(mJ,o),f=Zn(s,p.triggerRef);return c.jsx($t.button,{type:"button","aria-haspopup":"dialog","aria-expanded":p.open,"aria-controls":p.contentId,"data-state":S1(p.open),...d,ref:f,onClick:Vt(r.onClick,p.onOpenToggle)})});fJ.displayName=mJ;var v1="DialogPortal",[Mxe,gJ]=uJ(v1,{forceMount:void 0}),_J=r=>{const{__scopeDialog:s,forceMount:o,children:d,container:p}=r,f=kc(v1,s);return c.jsx(Mxe,{scope:s,forceMount:o,children:I.Children.map(d,E=>c.jsx(Dc,{present:o||f.open,children:c.jsx(pw,{asChild:!0,container:p,children:E})}))})};_J.displayName=v1;var xb="DialogOverlay",EJ=I.forwardRef((r,s)=>{const o=gJ(xb,r.__scopeDialog),{forceMount:d=o.forceMount,...p}=r,f=kc(xb,r.__scopeDialog);return f.modal?c.jsx(Dc,{present:d||f.open,children:c.jsx(Vxe,{...p,ref:s})}):null});EJ.displayName=xb;var Uxe=mg("DialogOverlay.RemoveScroll"),Vxe=I.forwardRef((r,s)=>{const{__scopeDialog:o,...d}=r,p=kc(xb,o);return c.jsx(_1,{as:Uxe,allowPinchZoom:!0,shards:[p.contentRef],children:c.jsx($t.div,{"data-state":S1(p.open),...d,ref:s,style:{pointerEvents:"auto",...d.style}})})}),Ep="DialogContent",vJ=I.forwardRef((r,s)=>{const o=gJ(Ep,r.__scopeDialog),{forceMount:d=o.forceMount,...p}=r,f=kc(Ep,r.__scopeDialog);return c.jsx(Dc,{present:d||f.open,children:f.modal?c.jsx(Fxe,{...p,ref:s}):c.jsx(Bxe,{...p,ref:s})})});vJ.displayName=Ep;var Fxe=I.forwardRef((r,s)=>{const o=kc(Ep,r.__scopeDialog),d=I.useRef(null),p=Zn(s,o.contentRef,d);return I.useEffect(()=>{const f=d.current;if(f)return dJ(f)},[]),c.jsx(yJ,{...r,ref:p,trapFocus:o.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Vt(r.onCloseAutoFocus,f=>{var E;f.preventDefault(),(E=o.triggerRef.current)==null||E.focus()}),onPointerDownOutside:Vt(r.onPointerDownOutside,f=>{const E=f.detail.originalEvent,y=E.button===0&&E.ctrlKey===!0;(E.button===2||y)&&f.preventDefault()}),onFocusOutside:Vt(r.onFocusOutside,f=>f.preventDefault())})}),Bxe=I.forwardRef((r,s)=>{const o=kc(Ep,r.__scopeDialog),d=I.useRef(!1),p=I.useRef(!1);return c.jsx(yJ,{...r,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:f=>{var E,y;(E=r.onCloseAutoFocus)==null||E.call(r,f),f.defaultPrevented||(d.current||(y=o.triggerRef.current)==null||y.focus(),f.preventDefault()),d.current=!1,p.current=!1},onInteractOutside:f=>{var b,C;(b=r.onInteractOutside)==null||b.call(r,f),f.defaultPrevented||(d.current=!0,f.detail.originalEvent.type==="pointerdown"&&(p.current=!0));const E=f.target;((C=o.triggerRef.current)==null?void 0:C.contains(E))&&f.preventDefault(),f.detail.originalEvent.type==="focusin"&&p.current&&f.preventDefault()}})}),yJ=I.forwardRef((r,s)=>{const{__scopeDialog:o,trapFocus:d,onOpenAutoFocus:p,onCloseAutoFocus:f,...E}=r,y=kc(Ep,o),b=I.useRef(null),C=Zn(s,b);return tJ(),c.jsxs(c.Fragment,{children:[c.jsx(g1,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:p,onUnmountAutoFocus:f,children:c.jsx(Fv,{role:"dialog",id:y.contentId,"aria-describedby":y.descriptionId,"aria-labelledby":y.titleId,"data-state":S1(y.open),...E,ref:C,onDismiss:()=>y.onOpenChange(!1)})}),c.jsxs(c.Fragment,{children:[c.jsx(Wxe,{titleId:y.titleId}),c.jsx(Kxe,{contentRef:b,descriptionId:y.descriptionId})]})]})}),y1="DialogTitle",SJ=I.forwardRef((r,s)=>{const{__scopeDialog:o,...d}=r,p=kc(y1,o);return c.jsx($t.h2,{id:p.titleId,...d,ref:s})});SJ.displayName=y1;var TJ="DialogDescription",bJ=I.forwardRef((r,s)=>{const{__scopeDialog:o,...d}=r,p=kc(TJ,o);return c.jsx($t.p,{id:p.descriptionId,...d,ref:s})});bJ.displayName=TJ;var wJ="DialogClose",CJ=I.forwardRef((r,s)=>{const{__scopeDialog:o,...d}=r,p=kc(wJ,o);return c.jsx($t.button,{type:"button",...d,ref:s,onClick:Vt(r.onClick,()=>p.onOpenChange(!1))})});CJ.displayName=wJ;function S1(r){return r?"open":"closed"}var RJ="DialogTitleWarning",[Gxe,xJ]=cbe(RJ,{contentName:Ep,titleName:y1,docsSlug:"dialog"}),Wxe=({titleId:r})=>{const s=xJ(RJ),o=`\`${s.contentName}\` requires a \`${s.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${s.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${s.docsSlug}`;return I.useEffect(()=>{r&&(document.getElementById(r)||console.error(o))},[o,r]),null},Hxe="DialogDescriptionWarning",Kxe=({contentRef:r,descriptionId:s})=>{const d=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${xJ(Hxe).contentName}}.`;return I.useEffect(()=>{var f;const p=(f=r.current)==null?void 0:f.getAttribute("aria-describedby");s&&p&&(document.getElementById(s)||console.warn(d))},[d,r,s]),null},T1=pJ,NJ=fJ,b1=_J,Hv=EJ,Kv=vJ,zv=SJ,qv=bJ,Rw=CJ;const zxe=T1,qxe=b1,IJ=I.forwardRef(({className:r,...s},o)=>c.jsx(Hv,{className:ct("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:o}));IJ.displayName=Hv.displayName;const Yxe=kp("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),AJ=I.forwardRef(({side:r="right",className:s,children:o,...d},p)=>c.jsxs(qxe,{children:[c.jsx(IJ,{}),c.jsxs(Kv,{ref:p,className:ct(Yxe({side:r}),s),...d,children:[o,c.jsxs(Rw,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[c.jsx(fg,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));AJ.displayName=Kv.displayName;const OJ=({className:r,...s})=>c.jsx("div",{className:ct("flex flex-col space-y-2 text-center sm:text-left",r),...s});OJ.displayName="SheetHeader";const PJ=I.forwardRef(({className:r,...s},o)=>c.jsx(zv,{ref:o,className:ct("text-lg font-semibold text-foreground",r),...s}));PJ.displayName=zv.displayName;const DJ=I.forwardRef(({className:r,...s},o)=>c.jsx(qv,{ref:o,className:ct("text-sm text-muted-foreground",r),...s}));DJ.displayName=qv.displayName;function yl({className:r,...s}){return c.jsx("div",{className:ct("animate-pulse rounded-md bg-muted",r),...s})}const Xxe="sidebar_state",Qxe=60*60*24*7,Jxe="16rem",$xe="18rem",Zxe="3rem",eNe="b",kJ=I.createContext(null);function w1(){const r=I.useContext(kJ);if(!r)throw new Error("useSidebar must be used within a SidebarProvider.");return r}function tNe({defaultOpen:r=!0,open:s,onOpenChange:o,className:d,style:p,children:f,...E}){const y=FRe(),[b,C]=I.useState(!1),[A,D]=I.useState(r),k=s??A,W=I.useCallback(H=>{const V=typeof H=="function"?H(k):H;o?o(V):D(V),document.cookie=`${Xxe}=${V}; path=/; max-age=${Qxe}`},[o,k]),G=I.useCallback(()=>y?C(H=>!H):W(H=>!H),[y,W,C]);I.useEffect(()=>{const H=V=>{V.key===eNe&&(V.metaKey||V.ctrlKey)&&(V.preventDefault(),G())};return window.addEventListener("keydown",H),()=>window.removeEventListener("keydown",H)},[G]);const L=k?"expanded":"collapsed",B=I.useMemo(()=>({state:L,open:k,setOpen:W,isMobile:y,openMobile:b,setOpenMobile:C,toggleSidebar:G}),[L,k,W,y,b,C,G]);return c.jsx(kJ.Provider,{value:B,children:c.jsx(QQ,{delayDuration:0,children:c.jsx("div",{"data-slot":"sidebar-wrapper",style:{"--sidebar-width":Jxe,"--sidebar-width-icon":Zxe,...p},className:ct("group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",d),...E,children:f})})})}function nNe({side:r="left",variant:s="sidebar",collapsible:o="offcanvas",className:d,children:p,...f}){const{isMobile:E,state:y,openMobile:b,setOpenMobile:C}=w1();return o==="none"?c.jsx("div",{"data-slot":"sidebar",className:ct("bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col",d),...f,children:p}):E?c.jsx(zxe,{open:b,onOpenChange:C,...f,children:c.jsxs(AJ,{"data-sidebar":"sidebar","data-slot":"sidebar","data-mobile":"true",className:"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden",style:{"--sidebar-width":$xe},side:r,children:[c.jsxs(OJ,{className:"sr-only",children:[c.jsx(PJ,{children:"Sidebar"}),c.jsx(DJ,{children:"Displays the mobile sidebar."})]}),c.jsx("div",{className:"flex h-full w-full flex-col",children:p})]})}):c.jsxs("div",{className:"group peer text-sidebar-foreground hidden md:block","data-state":y,"data-collapsible":y==="collapsed"?o:"","data-variant":s,"data-side":r,"data-slot":"sidebar",children:[c.jsx("div",{"data-slot":"sidebar-gap",className:ct("relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",s==="floating"||s==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]":"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]")}),c.jsx("div",{"data-slot":"sidebar-container",className:ct("fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex",r==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",s==="floating"||s==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]":"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l",d),...f,children:c.jsx("div",{"data-sidebar":"sidebar","data-slot":"sidebar-inner",className:"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm",children:p})})]})}function rNe({className:r,onClick:s,...o}){const{toggleSidebar:d}=w1();return c.jsxs(we,{"data-sidebar":"trigger","data-slot":"sidebar-trigger",variant:"ghost",size:"icon",className:ct("h-7 w-7",r),onClick:p=>{s==null||s(p),d()},...o,children:[c.jsx(vwe,{}),c.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})}function sNe({className:r,...s}){return c.jsx("div",{"data-slot":"sidebar-header","data-sidebar":"header",className:ct("flex flex-col gap-2 p-2",r),...s})}function iNe({className:r,...s}){return c.jsx("div",{"data-slot":"sidebar-footer","data-sidebar":"footer",className:ct("flex flex-col gap-2 p-2",r),...s})}function aNe({className:r,...s}){return c.jsx("div",{"data-slot":"sidebar-content","data-sidebar":"content",className:ct("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",r),...s})}function oNe({className:r,...s}){return c.jsx("div",{"data-slot":"sidebar-group","data-sidebar":"group",className:ct("relative flex w-full min-w-0 flex-col p-2",r),...s})}function cNe({className:r,asChild:s=!1,...o}){const d=s?hw:"div";return c.jsx(d,{"data-slot":"sidebar-group-label","data-sidebar":"group-label",className:ct("text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",r),...o})}function lNe({className:r,...s}){return c.jsx("div",{"data-slot":"sidebar-group-content","data-sidebar":"group-content",className:ct("w-full text-sm",r),...s})}function dNe({className:r,...s}){return c.jsx("ul",{"data-slot":"sidebar-menu","data-sidebar":"menu",className:ct("flex w-full min-w-0 flex-col gap-1",r),...s})}function uNe({className:r,...s}){return c.jsx("li",{"data-slot":"sidebar-menu-item","data-sidebar":"menu-item",className:ct("group/menu-item relative",r),...s})}const hNe=kp("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:p-0!"}},defaultVariants:{variant:"default",size:"default"}});function pNe({asChild:r=!1,isActive:s=!1,variant:o="default",size:d="default",tooltip:p,className:f,...E}){const y=r?hw:"button",{isMobile:b,state:C}=w1(),A=c.jsx(y,{"data-slot":"sidebar-menu-button","data-sidebar":"menu-button","data-size":d,"data-active":s,className:ct(hNe({variant:o,size:d}),f),...E});return p?(typeof p=="string"&&(p={children:p}),c.jsxs(URe,{children:[c.jsx(VRe,{asChild:!0,children:A}),c.jsx(JQ,{side:"right",align:"center",hidden:C!=="collapsed"||b,...p})]})):A}const vp="/assets/DDA%20LOGO%202_1764200378521-CzXHL-2R.jpeg";var C1="Avatar",[mNe,k1e]=Vo(C1),[fNe,LJ]=mNe(C1),jJ=I.forwardRef((r,s)=>{const{__scopeAvatar:o,...d}=r,[p,f]=I.useState("idle");return c.jsx(fNe,{scope:o,imageLoadingStatus:p,onImageLoadingStatusChange:f,children:c.jsx($t.span,{...d,ref:s})})});jJ.displayName=C1;var MJ="AvatarImage",UJ=I.forwardRef((r,s)=>{const{__scopeAvatar:o,src:d,onLoadingStatusChange:p=()=>{},...f}=r,E=LJ(MJ,o),y=gNe(d,f),b=Ps(C=>{p(C),E.onImageLoadingStatusChange(C)});return qs(()=>{y!=="idle"&&b(y)},[y,b]),y==="loaded"?c.jsx($t.img,{...f,ref:s,src:d}):null});UJ.displayName=MJ;var VJ="AvatarFallback",FJ=I.forwardRef((r,s)=>{const{__scopeAvatar:o,delayMs:d,...p}=r,f=LJ(VJ,o),[E,y]=I.useState(d===void 0);return I.useEffect(()=>{if(d!==void 0){const b=window.setTimeout(()=>y(!0),d);return()=>window.clearTimeout(b)}},[d]),E&&f.imageLoadingStatus!=="loaded"?c.jsx($t.span,{...p,ref:s}):null});FJ.displayName=VJ;function pH(r,s){return r?s?(r.src!==s&&(r.src=s),r.complete&&r.naturalWidth>0?"loaded":"loading"):"error":"idle"}function gNe(r,{referrerPolicy:s,crossOrigin:o}){const d=ENe(),p=I.useRef(null),f=d?(p.current||(p.current=new window.Image),p.current):null,[E,y]=I.useState(()=>pH(f,r));return qs(()=>{y(pH(f,r))},[f,r]),qs(()=>{const b=D=>()=>{y(D)};if(!f)return;const C=b("loaded"),A=b("error");return f.addEventListener("load",C),f.addEventListener("error",A),s&&(f.referrerPolicy=s),typeof o=="string"&&(f.crossOrigin=o),()=>{f.removeEventListener("load",C),f.removeEventListener("error",A)}},[f,o,s]),E}function _Ne(){return()=>{}}function ENe(){return I.useSyncExternalStore(_Ne,()=>!0,()=>!1)}var BJ=jJ,GJ=UJ,WJ=FJ;const xw=I.forwardRef(({className:r,...s},o)=>c.jsx(BJ,{ref:o,className:ct(`
      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10
      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,r),...s}));xw.displayName=BJ.displayName;const vNe=I.forwardRef(({className:r,...s},o)=>c.jsx(GJ,{ref:o,className:ct("aspect-square h-full w-full",r),...s}));vNe.displayName=GJ.displayName;const Nw=I.forwardRef(({className:r,...s},o)=>c.jsx(WJ,{ref:o,className:ct("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...s}));Nw.displayName=WJ.displayName;const yNe=kp("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate ",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:" border [border-color:var(--badge-outline)] shadow-xs"}},defaultVariants:{variant:"default"}});function xt({className:r,variant:s,...o}){return c.jsx("div",{className:ct(yNe({variant:s}),r),...o})}const HJ=I.createContext(void 0);function SNe({children:r}){const[s,o]=I.useState(()=>{try{const f=localStorage.getItem("user");return!f||f==="undefined"||f==="null"?null:JSON.parse(f)}catch{return null}}),d=f=>{o(f),localStorage.setItem("user",JSON.stringify(f))},p=()=>{o(null),localStorage.removeItem("user")};return c.jsx(HJ.Provider,{value:{user:s,isAuthenticated:!!s,login:d,logout:p},children:r})}function ts(){const r=I.useContext(HJ);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r}function TNe(){var y;const[r]=so(),{user:s,logout:o}=ts(),p=[{title:"System Admin",url:"/system-admin",icon:ml,roles:["system_admin"]},{title:"Hospital Admin",url:"/hospital-admin",icon:ml,roles:["hospital_admin"]},{title:"Dashboard",url:"/dashboard",icon:uwe,roles:["admin","doctor","nurse","patient"]},{title:"Health Chatbot",url:"/health-chatbot",icon:GT,roles:["system_admin","hospital_admin","admin","doctor","nurse","patient","pharmacist","lab_tech","receptionist"]},{title:"Personal Diary",url:"/personal-diary",icon:ewe,roles:["system_admin","hospital_admin","admin","doctor","nurse","patient","pharmacist","lab_tech","receptionist"]},{title:"Tickets",url:"/tickets",icon:Rwe,roles:["system_admin","hospital_admin","admin","doctor","nurse"]},{title:"Subscriptions",url:"/system-subscriptions",icon:Uf,roles:["system_admin"]},{title:"Patient Assignments",url:"/patient-assignments",icon:wP,roles:["hospital_admin"]},{title:"Departments & Teams",url:"/departments-teams",icon:ml,roles:["system_admin","hospital_admin"]},{title:"AI Clinical Assistant",url:"/patients",icon:yu,roles:["doctor"]},{title:"Patients",url:"/patients",icon:Lp,roles:["admin","doctor","nurse"]},{title:"Add Patient",url:"/patients/new",icon:Tb,roles:["admin","doctor","nurse"]},{title:"My Appointments",url:"/appointments",icon:pd,roles:["patient","admin"]},{title:"Appointments",url:"/doctor/appointments",icon:pd,roles:["doctor","admin"]},{title:"User Management",url:"/users",icon:iQ,roles:["admin"]},{title:"Subscription & Billing",url:"/subscription",icon:Uf,roles:["hospital_admin"]},{title:"Pharmacy Inventory",url:"/pharmacy-inventory",icon:eQ,roles:["pharmacist","hospital_admin"]},{title:"Billing & Payments",url:"/billing",icon:Uf,roles:["accountant","accounts_manager","hospital_admin"]},{title:"Department Dashboard",url:"/department/dashboard",icon:ml,roles:["doctor","nurse"]},{title:"Department Management",url:"/admin/departments",icon:ml,roles:["admin"]}].filter(b=>b.roles.includes((s==null?void 0:s.role)||"")),f=b=>{switch(b){case"system_admin":return"bg-purple-600 text-white";case"hospital_admin":return"bg-blue-600 text-white";case"admin":return"bg-destructive text-destructive-foreground";case"doctor":return"bg-primary text-primary-foreground";case"nurse":return"bg-success text-success-foreground";default:return"bg-secondary text-secondary-foreground"}},E=b=>b.split(" ").map(C=>C[0]).join("").toUpperCase().slice(0,2);return c.jsxs(nNe,{children:[c.jsx(sNe,{className:"p-6",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("img",{src:vp,alt:"DDA Logo",className:"h-10 w-10 object-contain","data-testid":"img-sidebar-logo"}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-lg font-semibold",children:"DDA"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Doctors Assistant"})]})]})}),c.jsx(td,{}),c.jsx(aNe,{children:c.jsxs(oNe,{children:[c.jsx(cNe,{children:"Navigation"}),c.jsx(lNe,{children:c.jsx(dNe,{children:p.map(b=>c.jsx(uNe,{children:c.jsx(pNe,{asChild:!0,isActive:r===b.url,"data-testid":`link-${b.title.toLowerCase().replace(/\s+/g,"-")}`,children:c.jsxs(UT,{href:b.url,children:[c.jsx(b.icon,{className:"h-4 w-4"}),c.jsx("span",{children:b.title})]})})},b.title))})})]})}),c.jsx(iNe,{className:"p-4",children:c.jsxs("div",{className:"flex flex-col gap-3",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(xw,{className:"h-10 w-10",children:c.jsx(Nw,{className:"bg-primary text-primary-foreground",children:s!=null&&s.fullName?E(s.fullName):"U"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-sm font-medium truncate","data-testid":"text-user-name",children:s==null?void 0:s.fullName}),c.jsx(xt,{className:`${f((s==null?void 0:s.role)||"")} text-xs`,"data-testid":"badge-user-role",children:(y=s==null?void 0:s.role)==null?void 0:y.toUpperCase()})]})]}),c.jsxs(we,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:o,"data-testid":"button-logout",children:[c.jsx(ZX,{className:"h-4 w-4 mr-2"}),"Logout"]})]})})]})}function mH(){const r=new Date().getFullYear();return c.jsx("footer",{className:"w-full border-t bg-background px-4 py-3",children:c.jsx("div",{className:"flex items-center justify-center text-center text-sm text-muted-foreground",children:c.jsxs("p",{"data-testid":"text-copyright",children:[" ",r," Digital Doctors Assistant. All Rights Reserved."]})})})}function R1(r){return{system_admin:"/system-admin",hospital_admin:"/hospital-admin",doctor:"/dashboard",nurse:"/dashboard",patient:"/dashboard",pharmacist:"/dashboard",lab_tech:"/dashboard",receptionist:"/dashboard"}[r]||"/dashboard"}function Hr({children:r,requiredRoles:s}){const{isAuthenticated:o,user:d}=ts(),[,p]=so();return I.useEffect(()=>{if(console.log("ProtectedRoute check:",{isAuthenticated:o,userRole:d==null?void 0:d.role,requiredRoles:s}),!o){console.log("Not authenticated, redirecting to /"),p("/");return}if(s&&d&&!s.includes(d.role)){const f=R1(d.role);console.log(`Role ${d.role} not in required roles ${s.join(", ")}, redirecting to ${f}`),p(f)}else console.log("Access granted!")},[o,d,s,p]),!o||s&&d&&!s.includes(d.role)?null:c.jsx(c.Fragment,{children:r})}const _e=I.forwardRef(({className:r,...s},o)=>c.jsx("div",{ref:o,className:ct("shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm",r),...s}));_e.displayName="Card";const Ke=I.forwardRef(({className:r,...s},o)=>c.jsx("div",{ref:o,className:ct("flex flex-col space-y-1.5 p-6",r),...s}));Ke.displayName="CardHeader";const ze=I.forwardRef(({className:r,...s},o)=>c.jsx("div",{ref:o,className:ct("text-2xl font-semibold leading-none tracking-tight",r),...s}));ze.displayName="CardTitle";const Cn=I.forwardRef(({className:r,...s},o)=>c.jsx("div",{ref:o,className:ct("text-sm text-muted-foreground",r),...s}));Cn.displayName="CardDescription";const Te=I.forwardRef(({className:r,...s},o)=>c.jsx("div",{ref:o,className:ct("p-6 pt-0",r),...s}));Te.displayName="CardContent";const bNe=I.forwardRef(({className:r,...s},o)=>c.jsx("div",{ref:o,className:ct("flex items-center p-6 pt-0",r),...s}));bNe.displayName="CardFooter";var wNe=I.createContext(void 0);function Iw(r){const s=I.useContext(wNe);return r||s||"ltr"}function PP(r,[s,o]){return Math.min(o,Math.max(s,r))}function CNe(r,s){return I.useReducer((o,d)=>s[o][d]??o,r)}var x1="ScrollArea",[KJ,L1e]=Vo(x1),[RNe,Fo]=KJ(x1),zJ=I.forwardRef((r,s)=>{const{__scopeScrollArea:o,type:d="hover",dir:p,scrollHideDelay:f=600,...E}=r,[y,b]=I.useState(null),[C,A]=I.useState(null),[D,k]=I.useState(null),[W,G]=I.useState(null),[L,B]=I.useState(null),[H,V]=I.useState(0),[K,Z]=I.useState(0),[ee,$]=I.useState(!1),[se,le]=I.useState(!1),X=Zn(s,je=>b(je)),oe=Iw(p);return c.jsx(RNe,{scope:o,type:d,dir:oe,scrollHideDelay:f,scrollArea:y,viewport:C,onViewportChange:A,content:D,onContentChange:k,scrollbarX:W,onScrollbarXChange:G,scrollbarXEnabled:ee,onScrollbarXEnabledChange:$,scrollbarY:L,onScrollbarYChange:B,scrollbarYEnabled:se,onScrollbarYEnabledChange:le,onCornerWidthChange:V,onCornerHeightChange:Z,children:c.jsx($t.div,{dir:oe,...E,ref:X,style:{position:"relative","--radix-scroll-area-corner-width":H+"px","--radix-scroll-area-corner-height":K+"px",...r.style}})})});zJ.displayName=x1;var qJ="ScrollAreaViewport",YJ=I.forwardRef((r,s)=>{const{__scopeScrollArea:o,children:d,nonce:p,...f}=r,E=Fo(qJ,o),y=I.useRef(null),b=Zn(s,y,E.onViewportChange);return c.jsxs(c.Fragment,{children:[c.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:p}),c.jsx($t.div,{"data-radix-scroll-area-viewport":"",...f,ref:b,style:{overflowX:E.scrollbarXEnabled?"scroll":"hidden",overflowY:E.scrollbarYEnabled?"scroll":"hidden",...r.style},children:c.jsx("div",{ref:E.onContentChange,style:{minWidth:"100%",display:"table"},children:d})})]})});YJ.displayName=qJ;var Il="ScrollAreaScrollbar",N1=I.forwardRef((r,s)=>{const{forceMount:o,...d}=r,p=Fo(Il,r.__scopeScrollArea),{onScrollbarXEnabledChange:f,onScrollbarYEnabledChange:E}=p,y=r.orientation==="horizontal";return I.useEffect(()=>(y?f(!0):E(!0),()=>{y?f(!1):E(!1)}),[y,f,E]),p.type==="hover"?c.jsx(xNe,{...d,ref:s,forceMount:o}):p.type==="scroll"?c.jsx(NNe,{...d,ref:s,forceMount:o}):p.type==="auto"?c.jsx(XJ,{...d,ref:s,forceMount:o}):p.type==="always"?c.jsx(I1,{...d,ref:s}):null});N1.displayName=Il;var xNe=I.forwardRef((r,s)=>{const{forceMount:o,...d}=r,p=Fo(Il,r.__scopeScrollArea),[f,E]=I.useState(!1);return I.useEffect(()=>{const y=p.scrollArea;let b=0;if(y){const C=()=>{window.clearTimeout(b),E(!0)},A=()=>{b=window.setTimeout(()=>E(!1),p.scrollHideDelay)};return y.addEventListener("pointerenter",C),y.addEventListener("pointerleave",A),()=>{window.clearTimeout(b),y.removeEventListener("pointerenter",C),y.removeEventListener("pointerleave",A)}}},[p.scrollArea,p.scrollHideDelay]),c.jsx(Dc,{present:o||f,children:c.jsx(XJ,{"data-state":f?"visible":"hidden",...d,ref:s})})}),NNe=I.forwardRef((r,s)=>{const{forceMount:o,...d}=r,p=Fo(Il,r.__scopeScrollArea),f=r.orientation==="horizontal",E=Ow(()=>b("SCROLL_END"),100),[y,b]=CNe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return I.useEffect(()=>{if(y==="idle"){const C=window.setTimeout(()=>b("HIDE"),p.scrollHideDelay);return()=>window.clearTimeout(C)}},[y,p.scrollHideDelay,b]),I.useEffect(()=>{const C=p.viewport,A=f?"scrollLeft":"scrollTop";if(C){let D=C[A];const k=()=>{const W=C[A];D!==W&&(b("SCROLL"),E()),D=W};return C.addEventListener("scroll",k),()=>C.removeEventListener("scroll",k)}},[p.viewport,f,b,E]),c.jsx(Dc,{present:o||y!=="hidden",children:c.jsx(I1,{"data-state":y==="hidden"?"hidden":"visible",...d,ref:s,onPointerEnter:Vt(r.onPointerEnter,()=>b("POINTER_ENTER")),onPointerLeave:Vt(r.onPointerLeave,()=>b("POINTER_LEAVE"))})})}),XJ=I.forwardRef((r,s)=>{const o=Fo(Il,r.__scopeScrollArea),{forceMount:d,...p}=r,[f,E]=I.useState(!1),y=r.orientation==="horizontal",b=Ow(()=>{if(o.viewport){const C=o.viewport.offsetWidth<o.viewport.scrollWidth,A=o.viewport.offsetHeight<o.viewport.scrollHeight;E(y?C:A)}},10);return Eg(o.viewport,b),Eg(o.content,b),c.jsx(Dc,{present:d||f,children:c.jsx(I1,{"data-state":f?"visible":"hidden",...p,ref:s})})}),I1=I.forwardRef((r,s)=>{const{orientation:o="vertical",...d}=r,p=Fo(Il,r.__scopeScrollArea),f=I.useRef(null),E=I.useRef(0),[y,b]=I.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),C=e$(y.viewport,y.content),A={...d,sizes:y,onSizesChange:b,hasThumb:C>0&&C<1,onThumbChange:k=>f.current=k,onThumbPointerUp:()=>E.current=0,onThumbPointerDown:k=>E.current=k};function D(k,W){return kNe(k,E.current,y,W)}return o==="horizontal"?c.jsx(INe,{...A,ref:s,onThumbPositionChange:()=>{if(p.viewport&&f.current){const k=p.viewport.scrollLeft,W=fH(k,y,p.dir);f.current.style.transform=`translate3d(${W}px, 0, 0)`}},onWheelScroll:k=>{p.viewport&&(p.viewport.scrollLeft=k)},onDragScroll:k=>{p.viewport&&(p.viewport.scrollLeft=D(k,p.dir))}}):o==="vertical"?c.jsx(ANe,{...A,ref:s,onThumbPositionChange:()=>{if(p.viewport&&f.current){const k=p.viewport.scrollTop,W=fH(k,y);f.current.style.transform=`translate3d(0, ${W}px, 0)`}},onWheelScroll:k=>{p.viewport&&(p.viewport.scrollTop=k)},onDragScroll:k=>{p.viewport&&(p.viewport.scrollTop=D(k))}}):null}),INe=I.forwardRef((r,s)=>{const{sizes:o,onSizesChange:d,...p}=r,f=Fo(Il,r.__scopeScrollArea),[E,y]=I.useState(),b=I.useRef(null),C=Zn(s,b,f.onScrollbarXChange);return I.useEffect(()=>{b.current&&y(getComputedStyle(b.current))},[b]),c.jsx(JJ,{"data-orientation":"horizontal",...p,ref:C,sizes:o,style:{bottom:0,left:f.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:f.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Aw(o)+"px",...r.style},onThumbPointerDown:A=>r.onThumbPointerDown(A.x),onDragScroll:A=>r.onDragScroll(A.x),onWheelScroll:(A,D)=>{if(f.viewport){const k=f.viewport.scrollLeft+A.deltaX;r.onWheelScroll(k),n$(k,D)&&A.preventDefault()}},onResize:()=>{b.current&&f.viewport&&E&&d({content:f.viewport.scrollWidth,viewport:f.viewport.offsetWidth,scrollbar:{size:b.current.clientWidth,paddingStart:Ib(E.paddingLeft),paddingEnd:Ib(E.paddingRight)}})}})}),ANe=I.forwardRef((r,s)=>{const{sizes:o,onSizesChange:d,...p}=r,f=Fo(Il,r.__scopeScrollArea),[E,y]=I.useState(),b=I.useRef(null),C=Zn(s,b,f.onScrollbarYChange);return I.useEffect(()=>{b.current&&y(getComputedStyle(b.current))},[b]),c.jsx(JJ,{"data-orientation":"vertical",...p,ref:C,sizes:o,style:{top:0,right:f.dir==="ltr"?0:void 0,left:f.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Aw(o)+"px",...r.style},onThumbPointerDown:A=>r.onThumbPointerDown(A.y),onDragScroll:A=>r.onDragScroll(A.y),onWheelScroll:(A,D)=>{if(f.viewport){const k=f.viewport.scrollTop+A.deltaY;r.onWheelScroll(k),n$(k,D)&&A.preventDefault()}},onResize:()=>{b.current&&f.viewport&&E&&d({content:f.viewport.scrollHeight,viewport:f.viewport.offsetHeight,scrollbar:{size:b.current.clientHeight,paddingStart:Ib(E.paddingTop),paddingEnd:Ib(E.paddingBottom)}})}})}),[ONe,QJ]=KJ(Il),JJ=I.forwardRef((r,s)=>{const{__scopeScrollArea:o,sizes:d,hasThumb:p,onThumbChange:f,onThumbPointerUp:E,onThumbPointerDown:y,onThumbPositionChange:b,onDragScroll:C,onWheelScroll:A,onResize:D,...k}=r,W=Fo(Il,o),[G,L]=I.useState(null),B=Zn(s,X=>L(X)),H=I.useRef(null),V=I.useRef(""),K=W.viewport,Z=d.content-d.viewport,ee=Ps(A),$=Ps(b),se=Ow(D,10);function le(X){if(H.current){const oe=X.clientX-H.current.left,je=X.clientY-H.current.top;C({x:oe,y:je})}}return I.useEffect(()=>{const X=oe=>{const je=oe.target;(G==null?void 0:G.contains(je))&&ee(oe,Z)};return document.addEventListener("wheel",X,{passive:!1}),()=>document.removeEventListener("wheel",X,{passive:!1})},[K,G,Z,ee]),I.useEffect($,[d,$]),Eg(G,se),Eg(W.content,se),c.jsx(ONe,{scope:o,scrollbar:G,hasThumb:p,onThumbChange:Ps(f),onThumbPointerUp:Ps(E),onThumbPositionChange:$,onThumbPointerDown:Ps(y),children:c.jsx($t.div,{...k,ref:B,style:{position:"absolute",...k.style},onPointerDown:Vt(r.onPointerDown,X=>{X.button===0&&(X.target.setPointerCapture(X.pointerId),H.current=G.getBoundingClientRect(),V.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",W.viewport&&(W.viewport.style.scrollBehavior="auto"),le(X))}),onPointerMove:Vt(r.onPointerMove,le),onPointerUp:Vt(r.onPointerUp,X=>{const oe=X.target;oe.hasPointerCapture(X.pointerId)&&oe.releasePointerCapture(X.pointerId),document.body.style.webkitUserSelect=V.current,W.viewport&&(W.viewport.style.scrollBehavior=""),H.current=null})})})}),Nb="ScrollAreaThumb",$J=I.forwardRef((r,s)=>{const{forceMount:o,...d}=r,p=QJ(Nb,r.__scopeScrollArea);return c.jsx(Dc,{present:o||p.hasThumb,children:c.jsx(PNe,{ref:s,...d})})}),PNe=I.forwardRef((r,s)=>{const{__scopeScrollArea:o,style:d,...p}=r,f=Fo(Nb,o),E=QJ(Nb,o),{onThumbPositionChange:y}=E,b=Zn(s,D=>E.onThumbChange(D)),C=I.useRef(void 0),A=Ow(()=>{C.current&&(C.current(),C.current=void 0)},100);return I.useEffect(()=>{const D=f.viewport;if(D){const k=()=>{if(A(),!C.current){const W=LNe(D,y);C.current=W,y()}};return y(),D.addEventListener("scroll",k),()=>D.removeEventListener("scroll",k)}},[f.viewport,A,y]),c.jsx($t.div,{"data-state":E.hasThumb?"visible":"hidden",...p,ref:b,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...d},onPointerDownCapture:Vt(r.onPointerDownCapture,D=>{const W=D.target.getBoundingClientRect(),G=D.clientX-W.left,L=D.clientY-W.top;E.onThumbPointerDown({x:G,y:L})}),onPointerUp:Vt(r.onPointerUp,E.onThumbPointerUp)})});$J.displayName=Nb;var A1="ScrollAreaCorner",ZJ=I.forwardRef((r,s)=>{const o=Fo(A1,r.__scopeScrollArea),d=!!(o.scrollbarX&&o.scrollbarY);return o.type!=="scroll"&&d?c.jsx(DNe,{...r,ref:s}):null});ZJ.displayName=A1;var DNe=I.forwardRef((r,s)=>{const{__scopeScrollArea:o,...d}=r,p=Fo(A1,o),[f,E]=I.useState(0),[y,b]=I.useState(0),C=!!(f&&y);return Eg(p.scrollbarX,()=>{var D;const A=((D=p.scrollbarX)==null?void 0:D.offsetHeight)||0;p.onCornerHeightChange(A),b(A)}),Eg(p.scrollbarY,()=>{var D;const A=((D=p.scrollbarY)==null?void 0:D.offsetWidth)||0;p.onCornerWidthChange(A),E(A)}),C?c.jsx($t.div,{...d,ref:s,style:{width:f,height:y,position:"absolute",right:p.dir==="ltr"?0:void 0,left:p.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function Ib(r){return r?parseInt(r,10):0}function e$(r,s){const o=r/s;return isNaN(o)?0:o}function Aw(r){const s=e$(r.viewport,r.content),o=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,d=(r.scrollbar.size-o)*s;return Math.max(d,18)}function kNe(r,s,o,d="ltr"){const p=Aw(o),f=p/2,E=s||f,y=p-E,b=o.scrollbar.paddingStart+E,C=o.scrollbar.size-o.scrollbar.paddingEnd-y,A=o.content-o.viewport,D=d==="ltr"?[0,A]:[A*-1,0];return t$([b,C],D)(r)}function fH(r,s,o="ltr"){const d=Aw(s),p=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,f=s.scrollbar.size-p,E=s.content-s.viewport,y=f-d,b=o==="ltr"?[0,E]:[E*-1,0],C=PP(r,b);return t$([0,E],[0,y])(C)}function t$(r,s){return o=>{if(r[0]===r[1]||s[0]===s[1])return s[0];const d=(s[1]-s[0])/(r[1]-r[0]);return s[0]+d*(o-r[0])}}function n$(r,s){return r>0&&r<s}var LNe=(r,s=()=>{})=>{let o={left:r.scrollLeft,top:r.scrollTop},d=0;return function p(){const f={left:r.scrollLeft,top:r.scrollTop},E=o.left!==f.left,y=o.top!==f.top;(E||y)&&s(),o=f,d=window.requestAnimationFrame(p)}(),()=>window.cancelAnimationFrame(d)};function Ow(r,s){const o=Ps(r),d=I.useRef(0);return I.useEffect(()=>()=>window.clearTimeout(d.current),[]),I.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(o,s)},[o,s])}function Eg(r,s){const o=Ps(s);qs(()=>{let d=0;if(r){const p=new ResizeObserver(()=>{cancelAnimationFrame(d),d=window.requestAnimationFrame(o)});return p.observe(r),()=>{window.cancelAnimationFrame(d),p.unobserve(r)}}},[r,o])}var r$=zJ,jNe=YJ,MNe=ZJ;const Su=I.forwardRef(({className:r,children:s,...o},d)=>c.jsxs(r$,{ref:d,className:ct("relative overflow-hidden",r),...o,children:[c.jsx(jNe,{className:"h-full w-full rounded-[inherit]",children:s}),c.jsx(s$,{}),c.jsx(MNe,{})]}));Su.displayName=r$.displayName;const s$=I.forwardRef(({className:r,orientation:s="vertical",...o},d)=>c.jsx(N1,{ref:d,orientation:s,className:ct("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...o,children:c.jsx($J,{className:"relative flex-1 rounded-full bg-border"})}));s$.displayName=N1.displayName;function i$(){const[r,s]=I.useState(!1),[o,d]=I.useState([{id:"1",role:"assistant",content:`Hello! I'm Dr. Tega, your Digital Doctors Assistant. I'm here to help you with:
 Patient health information
 Medication guidelines
 Symptom analysis
 Clinical recommendations
 Health risk assessment

You can also share pictures, videos, or voice recordings to support patient care. How can I assist you today?`,timestamp:new Date}]),[p,f]=I.useState(""),[E,y]=I.useState(!1),[b,C]=I.useState(),A=I.useRef(null),D=I.useRef(null),k=I.useRef(null);I.useRef(null);const W=I.useRef(null),[G,L]=I.useState(!1),B=I.useRef([]);I.useEffect(()=>{A.current&&setTimeout(()=>{var $;($=A.current)==null||$.scrollIntoView({behavior:"smooth"})},0)},[o]);const H=async $=>{try{return(await(await Ot("POST","/api/chatbot/ask",{question:$})).json()).response||"I'm having trouble processing that. Please try again."}catch(se){return console.error("Error getting AI response:",se),"I'm having trouble connecting to my AI systems. Please check your connection and try again."}},V=async($,se)=>{var oe;const le=(oe=$.target.files)==null?void 0:oe[0];if(!le)return;const X=new FileReader;X.onload=je=>{var We;const Ce=(We=je.target)==null?void 0:We.result;C({type:se,data:Ce,name:le.name})},X.readAsDataURL(le)},K=async()=>{try{const $=await navigator.mediaDevices.getUserMedia({audio:!0}),se=new MediaRecorder($);W.current=se,B.current=[],se.ondataavailable=le=>{B.current.push(le.data)},se.onstop=()=>{const le=new Blob(B.current,{type:"audio/webm"}),X=new FileReader;X.onload=oe=>{var je;C({type:"audio",data:(je=oe.target)==null?void 0:je.result,name:`voice_message_${Date.now()}.webm`})},X.readAsDataURL(le),$.getTracks().forEach(oe=>oe.stop())},se.start(),L(!0)}catch($){console.error("Error accessing microphone:",$)}},Z=()=>{W.current&&(W.current.stop(),L(!1))},ee=async()=>{if(!p.trim()&&!b)return;const $={id:Date.now().toString(),role:"user",content:p||(b?`Shared ${b.type} file: ${b.name}`:""),timestamp:new Date,attachment:b};d(se=>[...se,$]),f(""),C(void 0),y(!0);try{let se;b?se=`I've received your ${b.type} file "${b.name}". Thank you for sharing this with me. I'm Dr. Tega, analyzing this media to support your patient care. For medical imaging, I can help identify key findings. For voice recordings, I can transcribe and analyze clinical notes. Please let me know what specific assistance you need with this file.`:se=await H(p);const le={id:(Date.now()+1).toString(),role:"assistant",content:se,timestamp:new Date};d(X=>[...X,le])}catch(se){console.error("Error sending message:",se)}finally{y(!1)}};return c.jsxs(c.Fragment,{children:[!r&&c.jsx(we,{onClick:()=>s(!0),className:"fixed bottom-6 right-6 rounded-full h-14 w-14 shadow-lg hover:shadow-xl bg-blue-600 hover:bg-blue-700 z-40","data-testid":"button-open-chatbot",children:c.jsx(W8,{className:"h-6 w-6"})}),r&&c.jsxs(_e,{className:"fixed bottom-6 right-6 w-96 max-h-[85vh] flex flex-col shadow-2xl z-50 bg-white",children:[c.jsxs(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-3 border-b bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-t-lg",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(W8,{className:"h-5 w-5"}),c.jsx(ze,{className:"text-lg",children:"Dr. Tega - Healthcare Assistant"})]}),c.jsx(we,{size:"icon",variant:"ghost",onClick:()=>s(!1),className:"h-8 w-8 text-white hover:bg-purple-500","data-testid":"button-close-chatbot",children:c.jsx(fg,{className:"h-4 w-4"})})]}),c.jsx(Su,{className:"flex-1 p-4 bg-gray-50 overflow-hidden",children:c.jsxs("div",{className:"space-y-4 w-full",ref:A,children:[o.map($=>c.jsx("div",{className:`flex ${$.role==="user"?"justify-end":"justify-start"}`,"data-testid":`chat-message-${$.role}-${$.id}`,children:c.jsxs("div",{className:`max-w-[85%] px-4 py-2 rounded-lg text-sm leading-relaxed break-words ${$.role==="user"?"bg-purple-600 text-white rounded-br-none":"bg-white text-gray-800 border border-gray-200 rounded-bl-none"}`,children:[$.attachment&&c.jsxs("div",{className:"mb-2 p-2 bg-gray-100 rounded",children:[$.attachment.type==="image"&&c.jsx("img",{src:$.attachment.data,alt:"Shared",className:"max-w-xs h-auto rounded"}),$.attachment.type==="video"&&c.jsx("video",{src:$.attachment.data,controls:!0,className:"max-w-xs h-auto rounded"}),$.attachment.type==="audio"&&c.jsx("audio",{src:$.attachment.data,controls:!0,className:"w-full"}),c.jsx("p",{className:"text-xs mt-1 text-gray-600",children:$.attachment.name})]}),c.jsx("p",{className:"whitespace-pre-wrap",children:$.content}),c.jsx("p",{className:`text-xs mt-1 ${$.role==="user"?"text-purple-100":"text-gray-500"}`,children:$.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},$.id)),E&&c.jsx("div",{className:"flex justify-start",children:c.jsx("div",{className:"bg-white text-gray-800 border border-gray-200 px-4 py-2 rounded-lg rounded-bl-none",children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx("div",{className:"h-2 w-2 bg-gray-400 rounded-full animate-bounce"}),c.jsx("div",{className:"h-2 w-2 bg-gray-400 rounded-full animate-bounce delay-100"}),c.jsx("div",{className:"h-2 w-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})})})]})}),c.jsxs(Te,{className:"p-4 border-t bg-white rounded-b-lg space-y-3",children:[b&&c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-100 rounded",children:[b.type==="image"&&c.jsx(B8,{className:"h-4 w-4 text-blue-600"}),b.type==="video"&&c.jsx(Au,{className:"h-4 w-4 text-red-600"}),b.type==="audio"&&c.jsx(Vf,{className:"h-4 w-4 text-green-600"}),c.jsx("span",{className:"text-xs text-gray-700 flex-1 truncate",children:b.name}),c.jsx(we,{size:"sm",variant:"ghost",onClick:()=>C(void 0),className:"h-6 w-6 p-0",children:c.jsx(fg,{className:"h-3 w-3"})})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(at,{placeholder:"Ask Dr. Tega a question...",value:p,onChange:$=>f($.target.value),onKeyDown:$=>$.key==="Enter"&&ee(),disabled:E,className:"flex-1","data-testid":"input-chatbot-message"}),c.jsx(we,{onClick:ee,disabled:E||!p.trim()&&!b,size:"icon",className:"bg-purple-600 hover:bg-purple-700","data-testid":"button-send-message",children:c.jsx(t1,{className:"h-4 w-4"})})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(we,{size:"sm",variant:"outline",onClick:()=>{var $;return($=D.current)==null?void 0:$.click()},className:"flex-1 gap-2","data-testid":"button-upload-image",children:[c.jsx(B8,{className:"h-4 w-4"}),"Picture"]}),c.jsxs(we,{size:"sm",variant:"outline",onClick:()=>{var $;return($=k.current)==null?void 0:$.click()},className:"flex-1 gap-2","data-testid":"button-upload-video",children:[c.jsx(Au,{className:"h-4 w-4"}),"Video"]}),c.jsxs(we,{size:"sm",variant:"outline",onClick:G?Z:K,className:`flex-1 gap-2 ${G?"bg-red-100 hover:bg-red-200":""}`,"data-testid":"button-record-voice",children:[c.jsx(Vf,{className:`h-4 w-4 ${G?"text-red-600 animate-pulse":""}`}),G?"Stop":"Voice"]})]}),c.jsx("input",{ref:D,type:"file",accept:"image/*",onChange:$=>V($,"image"),className:"hidden","data-testid":"input-hidden-image"}),c.jsx("input",{ref:k,type:"file",accept:"video/*",onChange:$=>V($,"video"),className:"hidden","data-testid":"input-hidden-video"})]})]})]})}var Yv=r=>r.type==="checkbox",Qh=r=>r instanceof Date,sa=r=>r==null;const a$=r=>typeof r=="object";var Fs=r=>!sa(r)&&!Array.isArray(r)&&a$(r)&&!Qh(r),o$=r=>Fs(r)&&r.target?Yv(r.target)?r.target.checked:r.target.value:r,UNe=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,c$=(r,s)=>r.has(UNe(s)),VNe=r=>{const s=r.constructor&&r.constructor.prototype;return Fs(s)&&s.hasOwnProperty("isPrototypeOf")},O1=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ni(r){let s;const o=Array.isArray(r),d=typeof FileList<"u"?r instanceof FileList:!1;if(r instanceof Date)s=new Date(r);else if(r instanceof Set)s=new Set(r);else if(!(O1&&(r instanceof Blob||d))&&(o||Fs(r)))if(s=o?[]:{},!o&&!VNe(r))s=r;else for(const p in r)r.hasOwnProperty(p)&&(s[p]=Ni(r[p]));else return r;return s}var Pw=r=>Array.isArray(r)?r.filter(Boolean):[],Ms=r=>r===void 0,ft=(r,s,o)=>{if(!s||!Fs(r))return o;const d=Pw(s.split(/[,[\].]+?/)).reduce((p,f)=>sa(p)?p:p[f],r);return Ms(d)||d===r?Ms(r[s])?o:r[s]:d},Ya=r=>typeof r=="boolean",P1=r=>/^\w*$/.test(r),l$=r=>Pw(r.replace(/["|']|\]/g,"").split(/\.|\[/)),Tr=(r,s,o)=>{let d=-1;const p=P1(s)?[s]:l$(s),f=p.length,E=f-1;for(;++d<f;){const y=p[d];let b=o;if(d!==E){const C=r[y];b=Fs(C)||Array.isArray(C)?C:isNaN(+p[d+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;r[y]=b,r=r[y]}};const Ab={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},yc={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Yl={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},d$=En.createContext(null),Dw=()=>En.useContext(d$),FNe=r=>{const{children:s,...o}=r;return En.createElement(d$.Provider,{value:o},s)};var u$=(r,s,o,d=!0)=>{const p={defaultValues:s._defaultValues};for(const f in r)Object.defineProperty(p,f,{get:()=>{const E=f;return s._proxyFormState[E]!==yc.all&&(s._proxyFormState[E]=!d||yc.all),o&&(o[E]=!0),r[E]}});return p};function BNe(r){const s=Dw(),{control:o=s.control,disabled:d,name:p,exact:f}=r||{},[E,y]=En.useState(o._formState),b=En.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),C=En.useRef(p);return C.current=p,En.useEffect(()=>o._subscribe({name:C.current,formState:b.current,exact:f,callback:A=>{!d&&y({...o._formState,...A})}}),[o,d,f]),En.useEffect(()=>{b.current.isValid&&o._setValid(!0)},[o]),En.useMemo(()=>u$(E,o,b.current,!1),[E,o])}var gl=r=>typeof r=="string",h$=(r,s,o,d,p)=>gl(r)?(d&&s.watch.add(r),ft(o,r,p)):Array.isArray(r)?r.map(f=>(d&&s.watch.add(f),ft(o,f))):(d&&(s.watchAll=!0),o);function GNe(r){const s=Dw(),{control:o=s.control,name:d,defaultValue:p,disabled:f,exact:E}=r||{},y=En.useRef(d),b=En.useRef(p);y.current=d,En.useEffect(()=>o._subscribe({name:y.current,formState:{values:!0},exact:E,callback:D=>!f&&A(h$(y.current,o._names,D.values||o._formValues,!1,b.current))}),[o,f,E]);const[C,A]=En.useState(o._getWatch(d,p));return En.useEffect(()=>o._removeUnmounted()),C}function WNe(r){const s=Dw(),{name:o,disabled:d,control:p=s.control,shouldUnregister:f}=r,E=c$(p._names.array,o),y=GNe({control:p,name:o,defaultValue:ft(p._formValues,o,ft(p._defaultValues,o,r.defaultValue)),exact:!0}),b=BNe({control:p,name:o,exact:!0}),C=En.useRef(r),A=En.useRef(p.register(o,{...r.rules,value:y,...Ya(r.disabled)?{disabled:r.disabled}:{}})),D=En.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!ft(b.errors,o)},isDirty:{enumerable:!0,get:()=>!!ft(b.dirtyFields,o)},isTouched:{enumerable:!0,get:()=>!!ft(b.touchedFields,o)},isValidating:{enumerable:!0,get:()=>!!ft(b.validatingFields,o)},error:{enumerable:!0,get:()=>ft(b.errors,o)}}),[b,o]),k=En.useCallback(B=>A.current.onChange({target:{value:o$(B),name:o},type:Ab.CHANGE}),[o]),W=En.useCallback(()=>A.current.onBlur({target:{value:ft(p._formValues,o),name:o},type:Ab.BLUR}),[o,p._formValues]),G=En.useCallback(B=>{const H=ft(p._fields,o);H&&B&&(H._f.ref={focus:()=>B.focus(),select:()=>B.select(),setCustomValidity:V=>B.setCustomValidity(V),reportValidity:()=>B.reportValidity()})},[p._fields,o]),L=En.useMemo(()=>({name:o,value:y,...Ya(d)||b.disabled?{disabled:b.disabled||d}:{},onChange:k,onBlur:W,ref:G}),[o,d,b.disabled,k,W,G,y]);return En.useEffect(()=>{const B=p._options.shouldUnregister||f;p.register(o,{...C.current.rules,...Ya(C.current.disabled)?{disabled:C.current.disabled}:{}});const H=(V,K)=>{const Z=ft(p._fields,V);Z&&Z._f&&(Z._f.mount=K)};if(H(o,!0),B){const V=Ni(ft(p._options.defaultValues,o));Tr(p._defaultValues,o,V),Ms(ft(p._formValues,o))&&Tr(p._formValues,o,V)}return!E&&p.register(o),()=>{(E?B&&!p._state.action:B)?p.unregister(o):H(o,!1)}},[o,p,E,f]),En.useEffect(()=>{p._setDisabledField({disabled:d,name:o})},[d,o,p]),En.useMemo(()=>({field:L,formState:b,fieldState:D}),[L,b,D])}const HNe=r=>r.render(WNe(r));var p$=(r,s,o,d,p)=>s?{...o[r],types:{...o[r]&&o[r].types?o[r].types:{},[d]:p||!0}}:{},zE=r=>Array.isArray(r)?r:[r],gH=()=>{let r=[];return{get observers(){return r},next:p=>{for(const f of r)f.next&&f.next(p)},subscribe:p=>(r.push(p),{unsubscribe:()=>{r=r.filter(f=>f!==p)}}),unsubscribe:()=>{r=[]}}},DP=r=>sa(r)||!a$(r);function cu(r,s){if(DP(r)||DP(s))return r===s;if(Qh(r)&&Qh(s))return r.getTime()===s.getTime();const o=Object.keys(r),d=Object.keys(s);if(o.length!==d.length)return!1;for(const p of o){const f=r[p];if(!d.includes(p))return!1;if(p!=="ref"){const E=s[p];if(Qh(f)&&Qh(E)||Fs(f)&&Fs(E)||Array.isArray(f)&&Array.isArray(E)?!cu(f,E):f!==E)return!1}}return!0}var na=r=>Fs(r)&&!Object.keys(r).length,D1=r=>r.type==="file",Sc=r=>typeof r=="function",Ob=r=>{if(!O1)return!1;const s=r?r.ownerDocument:0;return r instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},m$=r=>r.type==="select-multiple",k1=r=>r.type==="radio",KNe=r=>k1(r)||Yv(r),iO=r=>Ob(r)&&r.isConnected;function zNe(r,s){const o=s.slice(0,-1).length;let d=0;for(;d<o;)r=Ms(r)?d++:r[s[d++]];return r}function qNe(r){for(const s in r)if(r.hasOwnProperty(s)&&!Ms(r[s]))return!1;return!0}function Zs(r,s){const o=Array.isArray(s)?s:P1(s)?[s]:l$(s),d=o.length===1?r:zNe(r,o),p=o.length-1,f=o[p];return d&&delete d[f],p!==0&&(Fs(d)&&na(d)||Array.isArray(d)&&qNe(d))&&Zs(r,o.slice(0,-1)),r}var f$=r=>{for(const s in r)if(Sc(r[s]))return!0;return!1};function Pb(r,s={}){const o=Array.isArray(r);if(Fs(r)||o)for(const d in r)Array.isArray(r[d])||Fs(r[d])&&!f$(r[d])?(s[d]=Array.isArray(r[d])?[]:{},Pb(r[d],s[d])):sa(r[d])||(s[d]=!0);return s}function g$(r,s,o){const d=Array.isArray(r);if(Fs(r)||d)for(const p in r)Array.isArray(r[p])||Fs(r[p])&&!f$(r[p])?Ms(s)||DP(o[p])?o[p]=Array.isArray(r[p])?Pb(r[p],[]):{...Pb(r[p])}:g$(r[p],sa(s)?{}:s[p],o[p]):o[p]=!cu(r[p],s[p]);return o}var TE=(r,s)=>g$(r,s,Pb(s));const _H={value:!1,isValid:!1},EH={value:!0,isValid:!0};var _$=r=>{if(Array.isArray(r)){if(r.length>1){const s=r.filter(o=>o&&o.checked&&!o.disabled).map(o=>o.value);return{value:s,isValid:!!s.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!Ms(r[0].attributes.value)?Ms(r[0].value)||r[0].value===""?EH:{value:r[0].value,isValid:!0}:EH:_H}return _H},E$=(r,{valueAsNumber:s,valueAsDate:o,setValueAs:d})=>Ms(r)?r:s?r===""?NaN:r&&+r:o&&gl(r)?new Date(r):d?d(r):r;const vH={isValid:!1,value:null};var v$=r=>Array.isArray(r)?r.reduce((s,o)=>o&&o.checked&&!o.disabled?{isValid:!0,value:o.value}:s,vH):vH;function yH(r){const s=r.ref;return D1(s)?s.files:k1(s)?v$(r.refs).value:m$(s)?[...s.selectedOptions].map(({value:o})=>o):Yv(s)?_$(r.refs).value:E$(Ms(s.value)?r.ref.value:s.value,r)}var YNe=(r,s,o,d)=>{const p={};for(const f of r){const E=ft(s,f);E&&Tr(p,f,E._f)}return{criteriaMode:o,names:[...r],fields:p,shouldUseNativeValidation:d}},Db=r=>r instanceof RegExp,bE=r=>Ms(r)?r:Db(r)?r.source:Fs(r)?Db(r.value)?r.value.source:r.value:r,SH=r=>({isOnSubmit:!r||r===yc.onSubmit,isOnBlur:r===yc.onBlur,isOnChange:r===yc.onChange,isOnAll:r===yc.all,isOnTouch:r===yc.onTouched});const TH="AsyncFunction";var XNe=r=>!!r&&!!r.validate&&!!(Sc(r.validate)&&r.validate.constructor.name===TH||Fs(r.validate)&&Object.values(r.validate).find(s=>s.constructor.name===TH)),QNe=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate),bH=(r,s,o)=>!o&&(s.watchAll||s.watch.has(r)||[...s.watch].some(d=>r.startsWith(d)&&/^\.\w+/.test(r.slice(d.length))));const qE=(r,s,o,d)=>{for(const p of o||Object.keys(r)){const f=ft(r,p);if(f){const{_f:E,...y}=f;if(E){if(E.refs&&E.refs[0]&&s(E.refs[0],p)&&!d)return!0;if(E.ref&&s(E.ref,E.name)&&!d)return!0;if(qE(y,s))break}else if(Fs(y)&&qE(y,s))break}}};function wH(r,s,o){const d=ft(r,o);if(d||P1(o))return{error:d,name:o};const p=o.split(".");for(;p.length;){const f=p.join("."),E=ft(s,f),y=ft(r,f);if(E&&!Array.isArray(E)&&o!==f)return{name:o};if(y&&y.type)return{name:f,error:y};p.pop()}return{name:o}}var JNe=(r,s,o,d)=>{o(r);const{name:p,...f}=r;return na(f)||Object.keys(f).length>=Object.keys(s).length||Object.keys(f).find(E=>s[E]===(!d||yc.all))},$Ne=(r,s,o)=>!r||!s||r===s||zE(r).some(d=>d&&(o?d===s:d.startsWith(s)||s.startsWith(d))),ZNe=(r,s,o,d,p)=>p.isOnAll?!1:!o&&p.isOnTouch?!(s||r):(o?d.isOnBlur:p.isOnBlur)?!r:(o?d.isOnChange:p.isOnChange)?r:!0,eIe=(r,s)=>!Pw(ft(r,s)).length&&Zs(r,s),tIe=(r,s,o)=>{const d=zE(ft(r,o));return Tr(d,"root",s[o]),Tr(r,o,d),r},zT=r=>gl(r);function CH(r,s,o="validate"){if(zT(r)||Array.isArray(r)&&r.every(zT)||Ya(r)&&!r)return{type:o,message:zT(r)?r:"",ref:s}}var hf=r=>Fs(r)&&!Db(r)?r:{value:r,message:""},RH=async(r,s,o,d,p,f)=>{const{ref:E,refs:y,required:b,maxLength:C,minLength:A,min:D,max:k,pattern:W,validate:G,name:L,valueAsNumber:B,mount:H}=r._f,V=ft(o,L);if(!H||s.has(L))return{};const K=y?y[0]:E,Z=Ce=>{p&&K.reportValidity&&(K.setCustomValidity(Ya(Ce)?"":Ce||""),K.reportValidity())},ee={},$=k1(E),se=Yv(E),le=$||se,X=(B||D1(E))&&Ms(E.value)&&Ms(V)||Ob(E)&&E.value===""||V===""||Array.isArray(V)&&!V.length,oe=p$.bind(null,L,d,ee),je=(Ce,We,he,rt=Yl.maxLength,De=Yl.minLength)=>{const Oe=Ce?We:he;ee[L]={type:Ce?rt:De,message:Oe,ref:E,...oe(Ce?rt:De,Oe)}};if(f?!Array.isArray(V)||!V.length:b&&(!le&&(X||sa(V))||Ya(V)&&!V||se&&!_$(y).isValid||$&&!v$(y).isValid)){const{value:Ce,message:We}=zT(b)?{value:!!b,message:b}:hf(b);if(Ce&&(ee[L]={type:Yl.required,message:We,ref:K,...oe(Yl.required,We)},!d))return Z(We),ee}if(!X&&(!sa(D)||!sa(k))){let Ce,We;const he=hf(k),rt=hf(D);if(!sa(V)&&!isNaN(V)){const De=E.valueAsNumber||V&&+V;sa(he.value)||(Ce=De>he.value),sa(rt.value)||(We=De<rt.value)}else{const De=E.valueAsDate||new Date(V),Oe=xe=>new Date(new Date().toDateString()+" "+xe),Re=E.type=="time",et=E.type=="week";gl(he.value)&&V&&(Ce=Re?Oe(V)>Oe(he.value):et?V>he.value:De>new Date(he.value)),gl(rt.value)&&V&&(We=Re?Oe(V)<Oe(rt.value):et?V<rt.value:De<new Date(rt.value))}if((Ce||We)&&(je(!!Ce,he.message,rt.message,Yl.max,Yl.min),!d))return Z(ee[L].message),ee}if((C||A)&&!X&&(gl(V)||f&&Array.isArray(V))){const Ce=hf(C),We=hf(A),he=!sa(Ce.value)&&V.length>+Ce.value,rt=!sa(We.value)&&V.length<+We.value;if((he||rt)&&(je(he,Ce.message,We.message),!d))return Z(ee[L].message),ee}if(W&&!X&&gl(V)){const{value:Ce,message:We}=hf(W);if(Db(Ce)&&!V.match(Ce)&&(ee[L]={type:Yl.pattern,message:We,ref:E,...oe(Yl.pattern,We)},!d))return Z(We),ee}if(G){if(Sc(G)){const Ce=await G(V,o),We=CH(Ce,K);if(We&&(ee[L]={...We,...oe(Yl.validate,We.message)},!d))return Z(We.message),ee}else if(Fs(G)){let Ce={};for(const We in G){if(!na(Ce)&&!d)break;const he=CH(await G[We](V,o),K,We);he&&(Ce={...he,...oe(We,he.message)},Z(he.message),d&&(ee[L]=Ce))}if(!na(Ce)&&(ee[L]={ref:K,...Ce},!d))return ee}}return Z(!0),ee};const nIe={mode:yc.onSubmit,reValidateMode:yc.onChange,shouldFocusError:!0};function rIe(r={}){let s={...nIe,...r},o={submitCount:0,isDirty:!1,isLoading:Sc(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1};const d={};let p=Fs(s.defaultValues)||Fs(s.values)?Ni(s.values||s.defaultValues)||{}:{},f=s.shouldUnregister?{}:Ni(p),E={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},b,C=0;const A={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let D={...A};const k={array:gH(),state:gH()},W=SH(s.mode),G=SH(s.reValidateMode),L=s.criteriaMode===yc.all,B=ce=>Ie=>{clearTimeout(C),C=setTimeout(ce,Ie)},H=async ce=>{if(!s.disabled&&(A.isValid||D.isValid||ce)){const Ie=s.resolver?na((await X()).errors):await je(d,!0);Ie!==o.isValid&&k.state.next({isValid:Ie})}},V=(ce,Ie)=>{!s.disabled&&(A.isValidating||A.validatingFields||D.isValidating||D.validatingFields)&&((ce||Array.from(y.mount)).forEach(Le=>{Le&&(Ie?Tr(o.validatingFields,Le,Ie):Zs(o.validatingFields,Le))}),k.state.next({validatingFields:o.validatingFields,isValidating:!na(o.validatingFields)}))},K=(ce,Ie=[],Le,St,dt=!0,Je=!0)=>{if(St&&Le&&!s.disabled){if(E.action=!0,Je&&Array.isArray(ft(d,ce))){const It=Le(ft(d,ce),St.argA,St.argB);dt&&Tr(d,ce,It)}if(Je&&Array.isArray(ft(o.errors,ce))){const It=Le(ft(o.errors,ce),St.argA,St.argB);dt&&Tr(o.errors,ce,It),eIe(o.errors,ce)}if((A.touchedFields||D.touchedFields)&&Je&&Array.isArray(ft(o.touchedFields,ce))){const It=Le(ft(o.touchedFields,ce),St.argA,St.argB);dt&&Tr(o.touchedFields,ce,It)}(A.dirtyFields||D.dirtyFields)&&(o.dirtyFields=TE(p,f)),k.state.next({name:ce,isDirty:We(ce,Ie),dirtyFields:o.dirtyFields,errors:o.errors,isValid:o.isValid})}else Tr(f,ce,Ie)},Z=(ce,Ie)=>{Tr(o.errors,ce,Ie),k.state.next({errors:o.errors})},ee=ce=>{o.errors=ce,k.state.next({errors:o.errors,isValid:!1})},$=(ce,Ie,Le,St)=>{const dt=ft(d,ce);if(dt){const Je=ft(f,ce,Ms(Le)?ft(p,ce):Le);Ms(Je)||St&&St.defaultChecked||Ie?Tr(f,ce,Ie?Je:yH(dt._f)):De(ce,Je),E.mount&&H()}},se=(ce,Ie,Le,St,dt)=>{let Je=!1,It=!1;const qn={name:ce};if(!s.disabled){if(!Le||St){(A.isDirty||D.isDirty)&&(It=o.isDirty,o.isDirty=qn.isDirty=We(),Je=It!==qn.isDirty);const gs=cu(ft(p,ce),Ie);It=!!ft(o.dirtyFields,ce),gs?Zs(o.dirtyFields,ce):Tr(o.dirtyFields,ce,!0),qn.dirtyFields=o.dirtyFields,Je=Je||(A.dirtyFields||D.dirtyFields)&&It!==!gs}if(Le){const gs=ft(o.touchedFields,ce);gs||(Tr(o.touchedFields,ce,Le),qn.touchedFields=o.touchedFields,Je=Je||(A.touchedFields||D.touchedFields)&&gs!==Le)}Je&&dt&&k.state.next(qn)}return Je?qn:{}},le=(ce,Ie,Le,St)=>{const dt=ft(o.errors,ce),Je=(A.isValid||D.isValid)&&Ya(Ie)&&o.isValid!==Ie;if(s.delayError&&Le?(b=B(()=>Z(ce,Le)),b(s.delayError)):(clearTimeout(C),b=null,Le?Tr(o.errors,ce,Le):Zs(o.errors,ce)),(Le?!cu(dt,Le):dt)||!na(St)||Je){const It={...St,...Je&&Ya(Ie)?{isValid:Ie}:{},errors:o.errors,name:ce};o={...o,...It},k.state.next(It)}},X=async ce=>{V(ce,!0);const Ie=await s.resolver(f,s.context,YNe(ce||y.mount,d,s.criteriaMode,s.shouldUseNativeValidation));return V(ce),Ie},oe=async ce=>{const{errors:Ie}=await X(ce);if(ce)for(const Le of ce){const St=ft(Ie,Le);St?Tr(o.errors,Le,St):Zs(o.errors,Le)}else o.errors=Ie;return Ie},je=async(ce,Ie,Le={valid:!0})=>{for(const St in ce){const dt=ce[St];if(dt){const{_f:Je,...It}=dt;if(Je){const qn=y.array.has(Je.name),gs=dt._f&&XNe(dt._f);gs&&A.validatingFields&&V([St],!0);const Xs=await RH(dt,y.disabled,f,L,s.shouldUseNativeValidation&&!Ie,qn);if(gs&&A.validatingFields&&V([St]),Xs[Je.name]&&(Le.valid=!1,Ie))break;!Ie&&(ft(Xs,Je.name)?qn?tIe(o.errors,Xs,Je.name):Tr(o.errors,Je.name,Xs[Je.name]):Zs(o.errors,Je.name))}!na(It)&&await je(It,Ie,Le)}}return Le.valid},Ce=()=>{for(const ce of y.unMount){const Ie=ft(d,ce);Ie&&(Ie._f.refs?Ie._f.refs.every(Le=>!iO(Le)):!iO(Ie._f.ref))&&Ar(ce)}y.unMount=new Set},We=(ce,Ie)=>!s.disabled&&(ce&&Ie&&Tr(f,ce,Ie),!cu(rn(),p)),he=(ce,Ie,Le)=>h$(ce,y,{...E.mount?f:Ms(Ie)?p:gl(ce)?{[ce]:Ie}:Ie},Le,Ie),rt=ce=>Pw(ft(E.mount?f:p,ce,s.shouldUnregister?ft(p,ce,[]):[])),De=(ce,Ie,Le={})=>{const St=ft(d,ce);let dt=Ie;if(St){const Je=St._f;Je&&(!Je.disabled&&Tr(f,ce,E$(Ie,Je)),dt=Ob(Je.ref)&&sa(Ie)?"":Ie,m$(Je.ref)?[...Je.ref.options].forEach(It=>It.selected=dt.includes(It.value)):Je.refs?Yv(Je.ref)?Je.refs.length>1?Je.refs.forEach(It=>(!It.defaultChecked||!It.disabled)&&(It.checked=Array.isArray(dt)?!!dt.find(qn=>qn===It.value):dt===It.value)):Je.refs[0]&&(Je.refs[0].checked=!!dt):Je.refs.forEach(It=>It.checked=It.value===dt):D1(Je.ref)?Je.ref.value="":(Je.ref.value=dt,Je.ref.type||k.state.next({name:ce,values:Ni(f)})))}(Le.shouldDirty||Le.shouldTouch)&&se(ce,dt,Le.shouldTouch,Le.shouldDirty,!0),Le.shouldValidate&&Pt(ce)},Oe=(ce,Ie,Le)=>{for(const St in Ie){const dt=Ie[St],Je=`${ce}.${St}`,It=ft(d,Je);(y.array.has(ce)||Fs(dt)||It&&!It._f)&&!Qh(dt)?Oe(Je,dt,Le):De(Je,dt,Le)}},Re=(ce,Ie,Le={})=>{const St=ft(d,ce),dt=y.array.has(ce),Je=Ni(Ie);Tr(f,ce,Je),dt?(k.array.next({name:ce,values:Ni(f)}),(A.isDirty||A.dirtyFields||D.isDirty||D.dirtyFields)&&Le.shouldDirty&&k.state.next({name:ce,dirtyFields:TE(p,f),isDirty:We(ce,Je)})):St&&!St._f&&!sa(Je)?Oe(ce,Je,Le):De(ce,Je,Le),bH(ce,y)&&k.state.next({...o}),k.state.next({name:E.mount?ce:void 0,values:Ni(f)})},et=async ce=>{E.mount=!0;const Ie=ce.target;let Le=Ie.name,St=!0;const dt=ft(d,Le),Je=It=>{St=Number.isNaN(It)||Qh(It)&&isNaN(It.getTime())||cu(It,ft(f,Le,It))};if(dt){let It,qn;const gs=Ie.type?yH(dt._f):o$(ce),Xs=ce.type===Ab.BLUR||ce.type===Ab.FOCUS_OUT,$v=!QNe(dt._f)&&!s.resolver&&!ft(o.errors,Le)&&!dt._f.deps||ZNe(Xs,ft(o.touchedFields,Le),o.isSubmitted,G,W),Up=bH(Le,y,Xs);Tr(f,Le,gs),Xs?(dt._f.onBlur&&dt._f.onBlur(ce),b&&b(0)):dt._f.onChange&&dt._f.onChange(ce);const Go=se(Le,gs,Xs),Zv=!na(Go)||Up;if(!Xs&&k.state.next({name:Le,type:ce.type,values:Ni(f)}),$v)return(A.isValid||D.isValid)&&(s.mode==="onBlur"?Xs&&H():Xs||H()),Zv&&k.state.next({name:Le,...Up?{}:Go});if(!Xs&&Up&&k.state.next({...o}),s.resolver){const{errors:ey}=await X([Le]);if(Je(gs),St){const Ww=wH(o.errors,d,Le),Ol=wH(ey,d,Ww.name||Le);It=Ol.error,Le=Ol.name,qn=na(ey)}}else V([Le],!0),It=(await RH(dt,y.disabled,f,L,s.shouldUseNativeValidation))[Le],V([Le]),Je(gs),St&&(It?qn=!1:(A.isValid||D.isValid)&&(qn=await je(d,!0)));St&&(dt._f.deps&&Pt(dt._f.deps),le(Le,qn,It,Go))}},xe=(ce,Ie)=>{if(ft(o.errors,Ie)&&ce.focus)return ce.focus(),1},Pt=async(ce,Ie={})=>{let Le,St;const dt=zE(ce);if(s.resolver){const Je=await oe(Ms(ce)?ce:dt);Le=na(Je),St=ce?!dt.some(It=>ft(Je,It)):Le}else ce?(St=(await Promise.all(dt.map(async Je=>{const It=ft(d,Je);return await je(It&&It._f?{[Je]:It}:It)}))).every(Boolean),!(!St&&!o.isValid)&&H()):St=Le=await je(d);return k.state.next({...!gl(ce)||(A.isValid||D.isValid)&&Le!==o.isValid?{}:{name:ce},...s.resolver||!ce?{isValid:Le}:{},errors:o.errors}),Ie.shouldFocus&&!St&&qE(d,xe,ce?dt:y.mount),St},rn=ce=>{const Ie={...E.mount?f:p};return Ms(ce)?Ie:gl(ce)?ft(Ie,ce):ce.map(Le=>ft(Ie,Le))},Gr=(ce,Ie)=>({invalid:!!ft((Ie||o).errors,ce),isDirty:!!ft((Ie||o).dirtyFields,ce),error:ft((Ie||o).errors,ce),isValidating:!!ft(o.validatingFields,ce),isTouched:!!ft((Ie||o).touchedFields,ce)}),er=ce=>{ce&&zE(ce).forEach(Ie=>Zs(o.errors,Ie)),k.state.next({errors:ce?o.errors:{}})},_i=(ce,Ie,Le)=>{const St=(ft(d,ce,{_f:{}})._f||{}).ref,dt=ft(o.errors,ce)||{},{ref:Je,message:It,type:qn,...gs}=dt;Tr(o.errors,ce,{...gs,...Ie,ref:St}),k.state.next({name:ce,errors:o.errors,isValid:!1}),Le&&Le.shouldFocus&&St&&St.focus&&St.focus()},ns=(ce,Ie)=>Sc(ce)?k.state.subscribe({next:Le=>ce(he(void 0,Ie),Le)}):he(ce,Ie,!0),Lt=ce=>k.state.subscribe({next:Ie=>{$Ne(ce.name,Ie.name,ce.exact)&&JNe(Ie,ce.formState||A,fs,ce.reRenderRoot)&&ce.callback({values:{...f},...o,...Ie})}}).unsubscribe,tr=ce=>(E.mount=!0,D={...D,...ce.formState},Lt({...ce,formState:D})),Ar=(ce,Ie={})=>{for(const Le of ce?zE(ce):y.mount)y.mount.delete(Le),y.array.delete(Le),Ie.keepValue||(Zs(d,Le),Zs(f,Le)),!Ie.keepError&&Zs(o.errors,Le),!Ie.keepDirty&&Zs(o.dirtyFields,Le),!Ie.keepTouched&&Zs(o.touchedFields,Le),!Ie.keepIsValidating&&Zs(o.validatingFields,Le),!s.shouldUnregister&&!Ie.keepDefaultValue&&Zs(p,Le);k.state.next({values:Ni(f)}),k.state.next({...o,...Ie.keepDirty?{isDirty:We()}:{}}),!Ie.keepIsValid&&H()},Un=({disabled:ce,name:Ie})=>{(Ya(ce)&&E.mount||ce||y.disabled.has(Ie))&&(ce?y.disabled.add(Ie):y.disabled.delete(Ie))},zn=(ce,Ie={})=>{let Le=ft(d,ce);const St=Ya(Ie.disabled)||Ya(s.disabled);return Tr(d,ce,{...Le||{},_f:{...Le&&Le._f?Le._f:{ref:{name:ce}},name:ce,mount:!0,...Ie}}),y.mount.add(ce),Le?Un({disabled:Ya(Ie.disabled)?Ie.disabled:s.disabled,name:ce}):$(ce,!0,Ie.value),{...St?{disabled:Ie.disabled||s.disabled}:{},...s.progressive?{required:!!Ie.required,min:bE(Ie.min),max:bE(Ie.max),minLength:bE(Ie.minLength),maxLength:bE(Ie.maxLength),pattern:bE(Ie.pattern)}:{},name:ce,onChange:et,onBlur:et,ref:dt=>{if(dt){zn(ce,Ie),Le=ft(d,ce);const Je=Ms(dt.value)&&dt.querySelectorAll&&dt.querySelectorAll("input,select,textarea")[0]||dt,It=KNe(Je),qn=Le._f.refs||[];if(It?qn.find(gs=>gs===Je):Je===Le._f.ref)return;Tr(d,ce,{_f:{...Le._f,...It?{refs:[...qn.filter(iO),Je,...Array.isArray(ft(p,ce))?[{}]:[]],ref:{type:Je.type,name:ce}}:{ref:Je}}}),$(ce,!1,void 0,Je)}else Le=ft(d,ce,{}),Le._f&&(Le._f.mount=!1),(s.shouldUnregister||Ie.shouldUnregister)&&!(c$(y.array,ce)&&E.action)&&y.unMount.add(ce)}}},Xn=()=>s.shouldFocusError&&qE(d,xe,y.mount),Wr=ce=>{Ya(ce)&&(k.state.next({disabled:ce}),qE(d,(Ie,Le)=>{const St=ft(d,Le);St&&(Ie.disabled=St._f.disabled||ce,Array.isArray(St._f.refs)&&St._f.refs.forEach(dt=>{dt.disabled=St._f.disabled||ce}))},0,!1))},Ei=(ce,Ie)=>async Le=>{let St;Le&&(Le.preventDefault&&Le.preventDefault(),Le.persist&&Le.persist());let dt=Ni(f);if(k.state.next({isSubmitting:!0}),s.resolver){const{errors:Je,values:It}=await X();o.errors=Je,dt=It}else await je(d);if(y.disabled.size)for(const Je of y.disabled)Tr(dt,Je,void 0);if(Zs(o.errors,"root"),na(o.errors)){k.state.next({errors:{}});try{await ce(dt,Le)}catch(Je){St=Je}}else Ie&&await Ie({...o.errors},Le),Xn(),setTimeout(Xn);if(k.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:na(o.errors)&&!St,submitCount:o.submitCount+1,errors:o.errors}),St)throw St},Bo=(ce,Ie={})=>{ft(d,ce)&&(Ms(Ie.defaultValue)?Re(ce,Ni(ft(p,ce))):(Re(ce,Ie.defaultValue),Tr(p,ce,Ni(Ie.defaultValue))),Ie.keepTouched||Zs(o.touchedFields,ce),Ie.keepDirty||(Zs(o.dirtyFields,ce),o.isDirty=Ie.defaultValue?We(ce,Ni(ft(p,ce))):We()),Ie.keepError||(Zs(o.errors,ce),A.isValid&&H()),k.state.next({...o}))},Ys=(ce,Ie={})=>{const Le=ce?Ni(ce):p,St=Ni(Le),dt=na(ce),Je=dt?p:St;if(Ie.keepDefaultValues||(p=Le),!Ie.keepValues){if(Ie.keepDirtyValues){const It=new Set([...y.mount,...Object.keys(TE(p,f))]);for(const qn of Array.from(It))ft(o.dirtyFields,qn)?Tr(Je,qn,ft(f,qn)):Re(qn,ft(Je,qn))}else{if(O1&&Ms(ce))for(const It of y.mount){const qn=ft(d,It);if(qn&&qn._f){const gs=Array.isArray(qn._f.refs)?qn._f.refs[0]:qn._f.ref;if(Ob(gs)){const Xs=gs.closest("form");if(Xs){Xs.reset();break}}}}for(const It of y.mount)Re(It,ft(Je,It))}f=Ni(Je),k.array.next({values:{...Je}}),k.state.next({values:{...Je}})}y={mount:Ie.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},E.mount=!A.isValid||!!Ie.keepIsValid||!!Ie.keepDirtyValues,E.watch=!!s.shouldUnregister,k.state.next({submitCount:Ie.keepSubmitCount?o.submitCount:0,isDirty:dt?!1:Ie.keepDirty?o.isDirty:!!(Ie.keepDefaultValues&&!cu(ce,p)),isSubmitted:Ie.keepIsSubmitted?o.isSubmitted:!1,dirtyFields:dt?{}:Ie.keepDirtyValues?Ie.keepDefaultValues&&f?TE(p,f):o.dirtyFields:Ie.keepDefaultValues&&ce?TE(p,ce):Ie.keepDirty?o.dirtyFields:{},touchedFields:Ie.keepTouched?o.touchedFields:{},errors:Ie.keepErrors?o.errors:{},isSubmitSuccessful:Ie.keepIsSubmitSuccessful?o.isSubmitSuccessful:!1,isSubmitting:!1})},io=(ce,Ie)=>Ys(Sc(ce)?ce(f):ce,Ie),rs=(ce,Ie={})=>{const Le=ft(d,ce),St=Le&&Le._f;if(St){const dt=St.refs?St.refs[0]:St.ref;dt.focus&&(dt.focus(),Ie.shouldSelect&&Sc(dt.select)&&dt.select())}},fs=ce=>{o={...o,...ce}},mr={control:{register:zn,unregister:Ar,getFieldState:Gr,handleSubmit:Ei,setError:_i,_subscribe:Lt,_runSchema:X,_getWatch:he,_getDirty:We,_setValid:H,_setFieldArray:K,_setDisabledField:Un,_setErrors:ee,_getFieldArray:rt,_reset:Ys,_resetDefaultValues:()=>Sc(s.defaultValues)&&s.defaultValues().then(ce=>{io(ce,s.resetOptions),k.state.next({isLoading:!1})}),_removeUnmounted:Ce,_disableForm:Wr,_subjects:k,_proxyFormState:A,get _fields(){return d},get _formValues(){return f},get _state(){return E},set _state(ce){E=ce},get _defaultValues(){return p},get _names(){return y},set _names(ce){y=ce},get _formState(){return o},get _options(){return s},set _options(ce){s={...s,...ce}}},subscribe:tr,trigger:Pt,register:zn,handleSubmit:Ei,watch:ns,setValue:Re,getValues:rn,reset:io,resetField:Bo,clearErrors:er,unregister:Ar,setError:_i,setFocus:rs,getFieldState:Gr};return{...mr,formControl:mr}}function Pg(r={}){const s=En.useRef(void 0),o=En.useRef(void 0),[d,p]=En.useState({isDirty:!1,isValidating:!1,isLoading:Sc(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,defaultValues:Sc(r.defaultValues)?void 0:r.defaultValues});s.current||(s.current={...r.formControl?r.formControl:rIe(r),formState:d},r.formControl&&r.defaultValues&&!Sc(r.defaultValues)&&r.formControl.reset(r.defaultValues,r.resetOptions));const f=s.current.control;return f._options=r,En.useLayoutEffect(()=>f._subscribe({formState:f._proxyFormState,callback:()=>p({...f._formState}),reRenderRoot:!0}),[f]),En.useEffect(()=>f._disableForm(r.disabled),[f,r.disabled]),En.useEffect(()=>{if(f._proxyFormState.isDirty){const E=f._getDirty();E!==d.isDirty&&f._subjects.state.next({isDirty:E})}},[f,d.isDirty]),En.useEffect(()=>{r.values&&!cu(r.values,o.current)?(f._reset(r.values,f._options.resetOptions),o.current=r.values,p(E=>({...E}))):f._resetDefaultValues()},[r.values,f]),En.useEffect(()=>{r.errors&&!na(r.errors)&&f._setErrors(r.errors)},[r.errors,f]),En.useEffect(()=>{f._state.mount||(f._setValid(),f._state.mount=!0),f._state.watch&&(f._state.watch=!1,f._subjects.state.next({...f._formState})),f._removeUnmounted()}),En.useEffect(()=>{r.shouldUnregister&&f._subjects.state.next({values:f._getWatch()})},[r.shouldUnregister,f]),s.current.formState=u$(d,f),s.current}const xH=(r,s,o)=>{if(r&&"reportValidity"in r){const d=ft(o,s);r.setCustomValidity(d&&d.message||""),r.reportValidity()}},y$=(r,s)=>{for(const o in s.fields){const d=s.fields[o];d&&d.ref&&"reportValidity"in d.ref?xH(d.ref,o,r):d.refs&&d.refs.forEach(p=>xH(p,o,r))}},sIe=(r,s)=>{s.shouldUseNativeValidation&&y$(r,s);const o={};for(const d in r){const p=ft(s.fields,d),f=Object.assign(r[d]||{},{ref:p&&p.ref});if(iIe(s.names||Object.keys(r),d)){const E=Object.assign({},ft(o,d));Tr(E,"root",f),Tr(o,d,E)}else Tr(o,d,f)}return o},iIe=(r,s)=>r.some(o=>o.startsWith(s+"."));var aIe=function(r,s){for(var o={};r.length;){var d=r[0],p=d.code,f=d.message,E=d.path.join(".");if(!o[E])if("unionErrors"in d){var y=d.unionErrors[0].errors[0];o[E]={message:y.message,type:y.code}}else o[E]={message:f,type:p};if("unionErrors"in d&&d.unionErrors.forEach(function(A){return A.errors.forEach(function(D){return r.push(D)})}),s){var b=o[E].types,C=b&&b[d.code];o[E]=p$(E,s,o,p,C?[].concat(C,d.message):d.message)}r.shift()}return o},Dg=function(r,s,o){return o===void 0&&(o={}),function(d,p,f){try{return Promise.resolve(function(E,y){try{var b=Promise.resolve(r[o.mode==="sync"?"parse":"parseAsync"](d,s)).then(function(C){return f.shouldUseNativeValidation&&y$({},f),{errors:{},values:o.raw?d:C}})}catch(C){return y(C)}return b&&b.then?b.then(void 0,y):b}(0,function(E){if(function(y){return Array.isArray(y==null?void 0:y.errors)}(E))return{values:{},errors:sIe(aIe(E.errors,!f.shouldUseNativeValidation&&f.criteriaMode==="all"),f)};throw E}))}catch(E){return Promise.reject(E)}}},oIe="Label",S$=I.forwardRef((r,s)=>c.jsx($t.label,{...r,ref:s,onMouseDown:o=>{var p;o.target.closest("button, input, select, textarea")||((p=r.onMouseDown)==null||p.call(r,o),!o.defaultPrevented&&o.detail>1&&o.preventDefault())}}));S$.displayName=oIe;var T$=S$;const cIe=kp("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),tt=I.forwardRef(({className:r,...s},o)=>c.jsx(T$,{ref:o,className:ct(cIe(),r),...s}));tt.displayName=T$.displayName;const kg=FNe,b$=I.createContext({}),_r=({...r})=>c.jsx(b$.Provider,{value:{name:r.name},children:c.jsx(HNe,{...r})}),kw=()=>{const r=I.useContext(b$),s=I.useContext(w$),{getFieldState:o,formState:d}=Dw(),p=o(r.name,d);if(!r)throw new Error("useFormField should be used within <FormField>");const{id:f}=s;return{id:f,name:r.name,formItemId:`${f}-form-item`,formDescriptionId:`${f}-form-item-description`,formMessageId:`${f}-form-item-message`,...p}},w$=I.createContext({}),lr=I.forwardRef(({className:r,...s},o)=>{const d=I.useId();return c.jsx(w$.Provider,{value:{id:d},children:c.jsx("div",{ref:o,className:ct("space-y-2",r),...s})})});lr.displayName="FormItem";const dr=I.forwardRef(({className:r,...s},o)=>{const{error:d,formItemId:p}=kw();return c.jsx(tt,{ref:o,className:ct(d&&"text-destructive",r),htmlFor:p,...s})});dr.displayName="FormLabel";const ur=I.forwardRef(({...r},s)=>{const{error:o,formItemId:d,formDescriptionId:p,formMessageId:f}=kw();return c.jsx(hw,{ref:s,id:d,"aria-describedby":o?`${p} ${f}`:`${p}`,"aria-invalid":!!o,...r})});ur.displayName="FormControl";const lIe=I.forwardRef(({className:r,...s},o)=>{const{formDescriptionId:d}=kw();return c.jsx("p",{ref:o,id:d,className:ct("text-sm text-muted-foreground",r),...s})});lIe.displayName="FormDescription";const hr=I.forwardRef(({className:r,children:s,...o},d)=>{const{error:p,formMessageId:f}=kw(),E=p?String((p==null?void 0:p.message)??""):s;return E?c.jsx("p",{ref:d,id:f,className:ct("text-sm font-medium text-destructive",r),...o,children:E}):null});hr.displayName="FormMessage";const us=T1,Wi=NJ,dIe=b1,C$=I.forwardRef(({className:r,...s},o)=>c.jsx(Hv,{ref:o,className:ct("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s}));C$.displayName=Hv.displayName;const hs=I.forwardRef(({className:r,children:s,...o},d)=>c.jsxs(dIe,{children:[c.jsx(C$,{}),c.jsxs(Kv,{ref:d,className:ct("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...o,children:[s,c.jsxs(Rw,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[c.jsx(fg,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));hs.displayName=Kv.displayName;const ps=({className:r,...s})=>c.jsx("div",{className:ct("flex flex-col space-y-1.5 text-center sm:text-left",r),...s});ps.displayName="DialogHeader";const If=({className:r,...s})=>c.jsx("div",{className:ct("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s});If.displayName="DialogFooter";const ms=I.forwardRef(({className:r,...s},o)=>c.jsx(zv,{ref:o,className:ct("text-lg font-semibold leading-none tracking-tight",r),...s}));ms.displayName=zv.displayName;const Tc=I.forwardRef(({className:r,...s},o)=>c.jsx(qv,{ref:o,className:ct("text-sm text-muted-foreground",r),...s}));Tc.displayName=qv.displayName;const Qe=Symbol.for("drizzle:entityKind");function Ai(r,s){if(!r||typeof r!="object")return!1;if(r instanceof s)return!0;if(!Object.prototype.hasOwnProperty.call(s,Qe))throw new Error(`Class "${s.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let o=Object.getPrototypeOf(r).constructor;if(o)for(;o;){if(Qe in o&&o[Qe]===s[Qe])return!0;o=Object.getPrototypeOf(o)}return!1}var rK;rK=Qe;class vg{constructor(s,o){ge(this,"name");ge(this,"keyAsName");ge(this,"primary");ge(this,"notNull");ge(this,"default");ge(this,"defaultFn");ge(this,"onUpdateFn");ge(this,"hasDefault");ge(this,"isUnique");ge(this,"uniqueName");ge(this,"uniqueType");ge(this,"dataType");ge(this,"columnType");ge(this,"enumValues");ge(this,"generated");ge(this,"generatedIdentity");ge(this,"config");this.table=s,this.config=o,this.name=o.name,this.keyAsName=o.keyAsName,this.notNull=o.notNull,this.default=o.default,this.defaultFn=o.defaultFn,this.onUpdateFn=o.onUpdateFn,this.hasDefault=o.hasDefault,this.primary=o.primaryKey,this.isUnique=o.isUnique,this.uniqueName=o.uniqueName,this.uniqueType=o.uniqueType,this.dataType=o.dataType,this.columnType=o.columnType,this.generated=o.generated,this.generatedIdentity=o.generatedIdentity}mapFromDriverValue(s){return s}mapToDriverValue(s){return s}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}ge(vg,rK,"Column");var sK;sK=Qe;class R${constructor(s,o,d){ge(this,"config");ge(this,"$default",this.$defaultFn);ge(this,"$onUpdate",this.$onUpdateFn);this.config={name:s,keyAsName:s==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:o,columnType:d,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(s){return this.config.default=s,this.config.hasDefault=!0,this}$defaultFn(s){return this.config.defaultFn=s,this.config.hasDefault=!0,this}$onUpdateFn(s){return this.config.onUpdateFn=s,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(s){this.config.name===""&&(this.config.name=s)}}ge(R$,sK,"ColumnBuilder");const Wf=Symbol.for("drizzle:Name");var iK;iK=Qe;class x${constructor(s,o){ge(this,"reference");ge(this,"_onUpdate","no action");ge(this,"_onDelete","no action");this.reference=()=>{const{name:d,columns:p,foreignColumns:f}=s();return{name:d,columns:p,foreignTable:f[0].table,foreignColumns:f}},o&&(this._onUpdate=o.onUpdate,this._onDelete=o.onDelete)}onUpdate(s){return this._onUpdate=s===void 0?"no action":s,this}onDelete(s){return this._onDelete=s===void 0?"no action":s,this}build(s){return new N$(s,this)}}ge(x$,iK,"PgForeignKeyBuilder");var aK;aK=Qe;class N${constructor(s,o){ge(this,"reference");ge(this,"onUpdate");ge(this,"onDelete");this.table=s,this.reference=o.reference,this.onUpdate=o._onUpdate,this.onDelete=o._onDelete}getName(){const{name:s,columns:o,foreignColumns:d}=this.reference(),p=o.map(y=>y.name),f=d.map(y=>y.name),E=[this.table[Wf],...p,d[0].table[Wf],...f];return s??`${E.join("_")}_fk`}}ge(N$,aK,"PgForeignKey");function uIe(r,...s){return r(...s)}function hIe(r,s){return`${r[Wf]}_${s.join("_")}_unique`}function NH(r,s,o){for(let d=s;d<r.length;d++){const p=r[d];if(p==="\\"){d++;continue}if(p==='"')return[r.slice(s,d).replace(/\\/g,""),d+1];if(!o&&(p===","||p==="}"))return[r.slice(s,d).replace(/\\/g,""),d]}return[r.slice(s).replace(/\\/g,""),r.length]}function I$(r,s=0){const o=[];let d=s,p=!1;for(;d<r.length;){const f=r[d];if(f===","){(p||d===s)&&o.push(""),p=!0,d++;continue}if(p=!1,f==="\\"){d+=2;continue}if(f==='"'){const[b,C]=NH(r,d+1,!0);o.push(b),d=C;continue}if(f==="}")return[o,d+1];if(f==="{"){const[b,C]=I$(r,d+1);o.push(b),d=C;continue}const[E,y]=NH(r,d,!1);o.push(E),d=y}return[o,d]}function pIe(r){const[s]=I$(r,1);return s}function A$(r){return`{${r.map(s=>Array.isArray(s)?A$(s):typeof s=="string"?`"${s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${s}`).join(",")}}`}var oK,cK;class sr extends(cK=R$,oK=Qe,cK){constructor(){super(...arguments);ge(this,"foreignKeyConfigs",[])}array(o){return new P$(this.config.name,this,o)}references(o,d={}){return this.foreignKeyConfigs.push({ref:o,actions:d}),this}unique(o,d){return this.config.isUnique=!0,this.config.uniqueName=o,this.config.uniqueType=d==null?void 0:d.nulls,this}generatedAlwaysAs(o){return this.config.generated={as:o,type:"always",mode:"stored"},this}buildForeignKeys(o,d){return this.foreignKeyConfigs.map(({ref:p,actions:f})=>uIe((E,y)=>{const b=new x$(()=>{const C=E();return{columns:[o],foreignColumns:[C]}});return y.onUpdate&&b.onUpdate(y.onUpdate),y.onDelete&&b.onDelete(y.onDelete),b.build(d)},p,f))}buildExtraConfigColumn(o){return new O$(o,this.config)}}ge(sr,oK,"PgColumnBuilder");var lK,dK;class yn extends(dK=vg,lK=Qe,dK){constructor(s,o){o.uniqueName||(o.uniqueName=hIe(s,[o.name])),super(s,o),this.table=s}}ge(yn,lK,"PgColumn");var uK,hK;class O$ extends(hK=yn,uK=Qe,hK){constructor(){super(...arguments);ge(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});ge(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(o){return this.indexConfig.opClass=o,this}}ge(O$,uK,"ExtraConfigColumn");var pK,mK;class P$ extends(mK=sr,pK=Qe,mK){constructor(s,o,d){super(s,"array","PgArray"),this.config.baseBuilder=o,this.config.size=d}build(s){const o=this.config.baseBuilder.build(s);return new kP(s,this.config,o)}}ge(P$,pK,"PgArrayBuilder");var fK,gK;const qb=class qb extends(gK=yn,fK=Qe,gK){constructor(o,d,p,f){super(o,d);ge(this,"size");this.baseColumn=p,this.range=f,this.size=d.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(o){return typeof o=="string"&&(o=pIe(o)),o.map(d=>this.baseColumn.mapFromDriverValue(d))}mapToDriverValue(o,d=!1){const p=o.map(f=>f===null?null:Ai(this.baseColumn,qb)?this.baseColumn.mapToDriverValue(f,!0):this.baseColumn.mapToDriverValue(f));return d?p:A$(p)}};ge(qb,fK,"PgArray");let kP=qb;const IH=Symbol.for("drizzle:isPgEnum");function mIe(r){return!!r&&typeof r=="function"&&IH in r&&r[IH]===!0}var _K;_K=Qe;class L1{constructor(s,o,d,p=!1){this._={brand:"Subquery",sql:s,selectedFields:o,alias:d,isWith:p}}}ge(L1,_K,"Subquery");const fIe={startActiveSpan(r,s){return s()}},Hf=Symbol.for("drizzle:ViewBaseConfig"),aO=Symbol.for("drizzle:Schema"),AH=Symbol.for("drizzle:Columns"),OH=Symbol.for("drizzle:ExtraConfigColumns"),oO=Symbol.for("drizzle:OriginalName"),cO=Symbol.for("drizzle:BaseName"),kb=Symbol.for("drizzle:IsAlias"),PH=Symbol.for("drizzle:ExtraConfigBuilder"),D$=Symbol.for("drizzle:IsDrizzleTable");var EK,vK,yK,SK,TK,bK,wK,CK,RK,xK,CT;let Qa=(xK=Qe,RK=Wf,CK=oO,wK=aO,bK=AH,TK=OH,SK=cO,yK=kb,vK=D$,EK=PH,CT=class{constructor(s,o,d){ge(this,RK);ge(this,CK);ge(this,wK);ge(this,bK);ge(this,TK);ge(this,SK);ge(this,yK,!1);ge(this,vK,!0);ge(this,EK);this[Wf]=this[oO]=s,this[aO]=o,this[cO]=d}},ge(CT,xK,"Table"),ge(CT,"Symbol",{Name:Wf,Schema:aO,OriginalName:oO,Columns:AH,ExtraConfigColumns:OH,BaseName:cO,IsAlias:kb,ExtraConfigBuilder:PH}),CT);function k$(r){return typeof r=="object"&&r!==null&&D$ in r}function gIe(r){return r!=null&&typeof r.getSQL=="function"}function _Ie(r){var o;const s={sql:"",params:[]};for(const d of r)s.sql+=d.sql,s.params.push(...d.params),(o=d.typings)!=null&&o.length&&(s.typings||(s.typings=[]),s.typings.push(...d.typings));return s}var NK;NK=Qe;class Oo{constructor(s){ge(this,"value");this.value=Array.isArray(s)?s:[s]}getSQL(){return new si([this])}}ge(Oo,NK,"StringChunk");var IK;IK=Qe;const zh=class zh{constructor(s){ge(this,"decoder",L$);ge(this,"shouldInlineParams",!1);this.queryChunks=s}append(s){return this.queryChunks.push(...s.queryChunks),this}toQuery(s){return fIe.startActiveSpan("drizzle.buildSQL",o=>{const d=this.buildQueryFromSourceParams(this.queryChunks,s);return o==null||o.setAttributes({"drizzle.query.text":d.sql,"drizzle.query.params":JSON.stringify(d.params)}),d})}buildQueryFromSourceParams(s,o){const d=Object.assign({},o,{inlineParams:o.inlineParams||this.shouldInlineParams,paramStartIndex:o.paramStartIndex||{value:0}}),{casing:p,escapeName:f,escapeParam:E,prepareTyping:y,inlineParams:b,paramStartIndex:C}=d;return _Ie(s.map(A=>{var D;if(Ai(A,Oo))return{sql:A.value.join(""),params:[]};if(Ai(A,Lb))return{sql:f(A.value),params:[]};if(A===void 0)return{sql:"",params:[]};if(Array.isArray(A)){const k=[new Oo("(")];for(const[W,G]of A.entries())k.push(G),W<A.length-1&&k.push(new Oo(", "));return k.push(new Oo(")")),this.buildQueryFromSourceParams(k,d)}if(Ai(A,zh))return this.buildQueryFromSourceParams(A.queryChunks,{...d,inlineParams:b||A.shouldInlineParams});if(Ai(A,Qa)){const k=A[Qa.Symbol.Schema],W=A[Qa.Symbol.Name];return{sql:k===void 0||A[kb]?f(W):f(k)+"."+f(W),params:[]}}if(Ai(A,vg)){const k=p.getColumnCasing(A);if(o.invokeSource==="indexes")return{sql:f(k),params:[]};const W=A.table[Qa.Symbol.Schema];return{sql:A.table[kb]||W===void 0?f(A.table[Qa.Symbol.Name])+"."+f(k):f(W)+"."+f(A.table[Qa.Symbol.Name])+"."+f(k),params:[]}}if(Ai(A,U$)){const k=A[Hf].schema,W=A[Hf].name;return{sql:k===void 0||A[Hf].isAlias?f(W):f(k)+"."+f(W),params:[]}}if(Ai(A,j1)){if(Ai(A.value,jb))return{sql:E(C.value++,A),params:[A],typings:["none"]};const k=A.value===null?null:A.encoder.mapToDriverValue(A.value);if(Ai(k,zh))return this.buildQueryFromSourceParams([k],d);if(b)return{sql:this.mapInlineParam(k,d),params:[]};let W=["none"];return y&&(W=[y(A.encoder)]),{sql:E(C.value++,k),params:[k],typings:W}}return Ai(A,jb)?{sql:E(C.value++,A),params:[A],typings:["none"]}:Ai(A,zh.Aliased)&&A.fieldAlias!==void 0?{sql:f(A.fieldAlias),params:[]}:Ai(A,L1)?A._.isWith?{sql:f(A._.alias),params:[]}:this.buildQueryFromSourceParams([new Oo("("),A._.sql,new Oo(") "),new Lb(A._.alias)],d):mIe(A)?A.schema?{sql:f(A.schema)+"."+f(A.enumName),params:[]}:{sql:f(A.enumName),params:[]}:gIe(A)?(D=A.shouldOmitSQLParens)!=null&&D.call(A)?this.buildQueryFromSourceParams([A.getSQL()],d):this.buildQueryFromSourceParams([new Oo("("),A.getSQL(),new Oo(")")],d):b?{sql:this.mapInlineParam(A,d),params:[]}:{sql:E(C.value++,A),params:[A],typings:["none"]}}))}mapInlineParam(s,{escapeString:o}){if(s===null)return"null";if(typeof s=="number"||typeof s=="boolean")return s.toString();if(typeof s=="string")return o(s);if(typeof s=="object"){const d=s.toString();return o(d==="[object Object]"?JSON.stringify(s):d)}throw new Error("Unexpected param value: "+s)}getSQL(){return this}as(s){return s===void 0?this:new zh.Aliased(this,s)}mapWith(s){return this.decoder=typeof s=="function"?{mapFromDriverValue:s}:s,this}inlineParams(){return this.shouldInlineParams=!0,this}if(s){return s?this:void 0}};ge(zh,IK,"SQL");let si=zh;var AK;AK=Qe;class Lb{constructor(s){ge(this,"brand");this.value=s}getSQL(){return new si([this])}}ge(Lb,AK,"Name");const L$={mapFromDriverValue:r=>r},j$={mapToDriverValue:r=>r};({...L$,...j$});var OK;OK=Qe;class j1{constructor(s,o=j$){ge(this,"brand");this.value=s,this.encoder=o}getSQL(){return new si([this])}}ge(j1,OK,"Param");function Oc(r,...s){const o=[];(s.length>0||r.length>0&&r[0]!=="")&&o.push(new Oo(r[0]));for(const[d,p]of s.entries())o.push(p,new Oo(r[d+1]));return new si(o)}(r=>{function s(){return new si([])}r.empty=s;function o(b){return new si(b)}r.fromList=o;function d(b){return new si([new Oo(b)])}r.raw=d;function p(b,C){const A=[];for(const[D,k]of b.entries())D>0&&C!==void 0&&A.push(C),A.push(k);return new si(A)}r.join=p;function f(b){return new Lb(b)}r.identifier=f;function E(b){return new jb(b)}r.placeholder=E;function y(b,C){return new j1(b,C)}r.param=y})(Oc||(Oc={}));(r=>{var o;o=Qe;const d=class d{constructor(f,E){ge(this,"isSelectionField",!1);this.sql=f,this.fieldAlias=E}getSQL(){return this.sql}clone(){return new d(this.sql,this.fieldAlias)}};ge(d,o,"SQL.Aliased");let s=d;r.Aliased=s})(si||(si={}));var PK;PK=Qe;class jb{constructor(s){this.name=s}getSQL(){return new si([this])}}ge(jb,PK,"Placeholder");const M$=Symbol.for("drizzle:IsDrizzleView");var DK,kK,LK;LK=Qe,kK=Hf,DK=M$;class U${constructor({name:s,schema:o,selectedFields:d,query:p}){ge(this,kK);ge(this,DK,!0);this[Hf]={name:s,originalName:s,schema:o,selectedFields:d,query:p,isExisting:!p,isAlias:!1}}getSQL(){return new si([this])}}ge(U$,LK,"View");function EIe(r){return typeof r=="object"&&r!==null&&M$ in r}vg.prototype.getSQL=function(){return new si([this])};Qa.prototype.getSQL=function(){return new si([this])};L1.prototype.getSQL=function(){return new si([this])};function vIe(r){return r[Qa.Symbol.Columns]}function yIe(r){return r[Hf].selectedFields}function gi(r,s){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:s}}var jK,MK;class Xv extends(MK=sr,jK=Qe,MK){generatedAlwaysAsIdentity(s){if(s){const{name:o,...d}=s;this.config.generatedIdentity={type:"always",sequenceName:o,sequenceOptions:d}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(s){if(s){const{name:o,...d}=s;this.config.generatedIdentity={type:"byDefault",sequenceName:o,sequenceOptions:d}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}ge(Xv,jK,"PgIntColumnBaseBuilder");var UK,VK;class V$ extends(VK=Xv,UK=Qe,VK){constructor(s){super(s,"number","PgBigInt53")}build(s){return new F$(s,this.config)}}ge(V$,UK,"PgBigInt53Builder");var FK,BK;class F$ extends(BK=yn,FK=Qe,BK){getSQLType(){return"bigint"}mapFromDriverValue(s){return typeof s=="number"?s:Number(s)}}ge(F$,FK,"PgBigInt53");var GK,WK;class B$ extends(WK=Xv,GK=Qe,WK){constructor(s){super(s,"bigint","PgBigInt64")}build(s){return new G$(s,this.config)}}ge(B$,GK,"PgBigInt64Builder");var HK,KK;class G$ extends(KK=yn,HK=Qe,KK){getSQLType(){return"bigint"}mapFromDriverValue(s){return BigInt(s)}}ge(G$,HK,"PgBigInt64");function SIe(r,s){const{name:o,config:d}=gi(r,s);return d.mode==="number"?new V$(o):new B$(o)}var zK,qK;class W$ extends(qK=sr,zK=Qe,qK){constructor(s){super(s,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new H$(s,this.config)}}ge(W$,zK,"PgBigSerial53Builder");var YK,XK;class H$ extends(XK=yn,YK=Qe,XK){getSQLType(){return"bigserial"}mapFromDriverValue(s){return typeof s=="number"?s:Number(s)}}ge(H$,YK,"PgBigSerial53");var QK,JK;class K$ extends(JK=sr,QK=Qe,JK){constructor(s){super(s,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(s){return new z$(s,this.config)}}ge(K$,QK,"PgBigSerial64Builder");var $K,ZK;class z$ extends(ZK=yn,$K=Qe,ZK){getSQLType(){return"bigserial"}mapFromDriverValue(s){return BigInt(s)}}ge(z$,$K,"PgBigSerial64");function TIe(r,s){const{name:o,config:d}=gi(r,s);return d.mode==="number"?new W$(o):new K$(o)}var ez,tz;class q$ extends(tz=sr,ez=Qe,tz){constructor(s){super(s,"boolean","PgBoolean")}build(s){return new Y$(s,this.config)}}ge(q$,ez,"PgBooleanBuilder");var nz,rz;class Y$ extends(rz=yn,nz=Qe,rz){getSQLType(){return"boolean"}}ge(Y$,nz,"PgBoolean");function bIe(r){return new q$(r??"")}var sz,iz;class X$ extends(iz=sr,sz=Qe,iz){constructor(s,o){super(s,"string","PgChar"),this.config.length=o.length,this.config.enumValues=o.enum}build(s){return new Q$(s,this.config)}}ge(X$,sz,"PgCharBuilder");var az,oz;class Q$ extends(oz=yn,az=Qe,oz){constructor(){super(...arguments);ge(this,"length",this.config.length);ge(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}ge(Q$,az,"PgChar");function wIe(r,s={}){const{name:o,config:d}=gi(r,s);return new X$(o,d)}var cz,lz;class J$ extends(lz=sr,cz=Qe,lz){constructor(s){super(s,"string","PgCidr")}build(s){return new $$(s,this.config)}}ge(J$,cz,"PgCidrBuilder");var dz,uz;class $$ extends(uz=yn,dz=Qe,uz){getSQLType(){return"cidr"}}ge($$,dz,"PgCidr");function CIe(r){return new J$(r??"")}var hz,pz;class Z$ extends(pz=sr,hz=Qe,pz){constructor(s,o,d){super(s,"custom","PgCustomColumn"),this.config.fieldConfig=o,this.config.customTypeParams=d}build(s){return new eZ(s,this.config)}}ge(Z$,hz,"PgCustomColumnBuilder");var mz,fz;class eZ extends(fz=yn,mz=Qe,fz){constructor(o,d){super(o,d);ge(this,"sqlName");ge(this,"mapTo");ge(this,"mapFrom");this.sqlName=d.customTypeParams.dataType(d.fieldConfig),this.mapTo=d.customTypeParams.toDriver,this.mapFrom=d.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(o){return typeof this.mapFrom=="function"?this.mapFrom(o):o}mapToDriverValue(o){return typeof this.mapTo=="function"?this.mapTo(o):o}}ge(eZ,mz,"PgCustomColumn");function RIe(r){return(s,o)=>{const{name:d,config:p}=gi(s,o);return new Z$(d,p,r)}}var gz,_z;class Lg extends(_z=sr,gz=Qe,_z){defaultNow(){return this.default(Oc`now()`)}}ge(Lg,gz,"PgDateColumnBaseBuilder");var Ez,vz;class tZ extends(vz=Lg,Ez=Qe,vz){constructor(s){super(s,"date","PgDate")}build(s){return new nZ(s,this.config)}}ge(tZ,Ez,"PgDateBuilder");var yz,Sz;class nZ extends(Sz=yn,yz=Qe,Sz){getSQLType(){return"date"}mapFromDriverValue(s){return new Date(s)}mapToDriverValue(s){return s.toISOString()}}ge(nZ,yz,"PgDate");var Tz,bz;class rZ extends(bz=Lg,Tz=Qe,bz){constructor(s){super(s,"string","PgDateString")}build(s){return new sZ(s,this.config)}}ge(rZ,Tz,"PgDateStringBuilder");var wz,Cz;class sZ extends(Cz=yn,wz=Qe,Cz){getSQLType(){return"date"}}ge(sZ,wz,"PgDateString");function xIe(r,s){const{name:o,config:d}=gi(r,s);return(d==null?void 0:d.mode)==="date"?new tZ(o):new rZ(o)}var Rz,xz;class iZ extends(xz=sr,Rz=Qe,xz){constructor(s){super(s,"number","PgDoublePrecision")}build(s){return new aZ(s,this.config)}}ge(iZ,Rz,"PgDoublePrecisionBuilder");var Nz,Iz;class aZ extends(Iz=yn,Nz=Qe,Iz){getSQLType(){return"double precision"}mapFromDriverValue(s){return typeof s=="string"?Number.parseFloat(s):s}}ge(aZ,Nz,"PgDoublePrecision");function NIe(r){return new iZ(r??"")}var Az,Oz;class oZ extends(Oz=sr,Az=Qe,Oz){constructor(s){super(s,"string","PgInet")}build(s){return new cZ(s,this.config)}}ge(oZ,Az,"PgInetBuilder");var Pz,Dz;class cZ extends(Dz=yn,Pz=Qe,Dz){getSQLType(){return"inet"}}ge(cZ,Pz,"PgInet");function IIe(r){return new oZ(r??"")}var kz,Lz;class lZ extends(Lz=Xv,kz=Qe,Lz){constructor(s){super(s,"number","PgInteger")}build(s){return new dZ(s,this.config)}}ge(lZ,kz,"PgIntegerBuilder");var jz,Mz;class dZ extends(Mz=yn,jz=Qe,Mz){getSQLType(){return"integer"}mapFromDriverValue(s){return typeof s=="string"?Number.parseInt(s):s}}ge(dZ,jz,"PgInteger");function Jh(r){return new lZ(r??"")}var Uz,Vz;class uZ extends(Vz=sr,Uz=Qe,Vz){constructor(s,o){super(s,"string","PgInterval"),this.config.intervalConfig=o}build(s){return new hZ(s,this.config)}}ge(uZ,Uz,"PgIntervalBuilder");var Fz,Bz;class hZ extends(Bz=yn,Fz=Qe,Bz){constructor(){super(...arguments);ge(this,"fields",this.config.intervalConfig.fields);ge(this,"precision",this.config.intervalConfig.precision)}getSQLType(){const o=this.fields?` ${this.fields}`:"",d=this.precision?`(${this.precision})`:"";return`interval${o}${d}`}}ge(hZ,Fz,"PgInterval");function AIe(r,s={}){const{name:o,config:d}=gi(r,s);return new uZ(o,d)}var Gz,Wz;class pZ extends(Wz=sr,Gz=Qe,Wz){constructor(s){super(s,"json","PgJson")}build(s){return new mZ(s,this.config)}}ge(pZ,Gz,"PgJsonBuilder");var Hz,Kz;class mZ extends(Kz=yn,Hz=Qe,Kz){constructor(s,o){super(s,o)}getSQLType(){return"json"}mapToDriverValue(s){return JSON.stringify(s)}mapFromDriverValue(s){if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s}}ge(mZ,Hz,"PgJson");function OIe(r){return new pZ(r??"")}var zz,qz;class fZ extends(qz=sr,zz=Qe,qz){constructor(s){super(s,"json","PgJsonb")}build(s){return new gZ(s,this.config)}}ge(fZ,zz,"PgJsonbBuilder");var Yz,Xz;class gZ extends(Xz=yn,Yz=Qe,Xz){constructor(s,o){super(s,o)}getSQLType(){return"jsonb"}mapToDriverValue(s){return JSON.stringify(s)}mapFromDriverValue(s){if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s}}ge(gZ,Yz,"PgJsonb");function PIe(r){return new fZ(r??"")}var Qz,Jz;class _Z extends(Jz=sr,Qz=Qe,Jz){constructor(s){super(s,"array","PgLine")}build(s){return new EZ(s,this.config)}}ge(_Z,Qz,"PgLineBuilder");var $z,Zz;class EZ extends(Zz=yn,$z=Qe,Zz){getSQLType(){return"line"}mapFromDriverValue(s){const[o,d,p]=s.slice(1,-1).split(",");return[Number.parseFloat(o),Number.parseFloat(d),Number.parseFloat(p)]}mapToDriverValue(s){return`{${s[0]},${s[1]},${s[2]}}`}}ge(EZ,$z,"PgLine");var e9,t9;class vZ extends(t9=sr,e9=Qe,t9){constructor(s){super(s,"json","PgLineABC")}build(s){return new yZ(s,this.config)}}ge(vZ,e9,"PgLineABCBuilder");var n9,r9;class yZ extends(r9=yn,n9=Qe,r9){getSQLType(){return"line"}mapFromDriverValue(s){const[o,d,p]=s.slice(1,-1).split(",");return{a:Number.parseFloat(o),b:Number.parseFloat(d),c:Number.parseFloat(p)}}mapToDriverValue(s){return`{${s.a},${s.b},${s.c}}`}}ge(yZ,n9,"PgLineABC");function DIe(r,s){const{name:o,config:d}=gi(r,s);return!(d!=null&&d.mode)||d.mode==="tuple"?new _Z(o):new vZ(o)}var s9,i9;class SZ extends(i9=sr,s9=Qe,i9){constructor(s){super(s,"string","PgMacaddr")}build(s){return new TZ(s,this.config)}}ge(SZ,s9,"PgMacaddrBuilder");var a9,o9;class TZ extends(o9=yn,a9=Qe,o9){getSQLType(){return"macaddr"}}ge(TZ,a9,"PgMacaddr");function kIe(r){return new SZ(r??"")}var c9,l9;class bZ extends(l9=sr,c9=Qe,l9){constructor(s){super(s,"string","PgMacaddr8")}build(s){return new wZ(s,this.config)}}ge(bZ,c9,"PgMacaddr8Builder");var d9,u9;class wZ extends(u9=yn,d9=Qe,u9){getSQLType(){return"macaddr8"}}ge(wZ,d9,"PgMacaddr8");function LIe(r){return new bZ(r??"")}var h9,p9;class CZ extends(p9=sr,h9=Qe,p9){constructor(s,o,d){super(s,"string","PgNumeric"),this.config.precision=o,this.config.scale=d}build(s){return new RZ(s,this.config)}}ge(CZ,h9,"PgNumericBuilder");var m9,f9;class RZ extends(f9=yn,m9=Qe,f9){constructor(o,d){super(o,d);ge(this,"precision");ge(this,"scale");this.precision=d.precision,this.scale=d.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}ge(RZ,m9,"PgNumeric");function jIe(r,s){const{name:o,config:d}=gi(r,s);return new CZ(o,d==null?void 0:d.precision,d==null?void 0:d.scale)}var g9,_9;class xZ extends(_9=sr,g9=Qe,_9){constructor(s){super(s,"array","PgPointTuple")}build(s){return new NZ(s,this.config)}}ge(xZ,g9,"PgPointTupleBuilder");var E9,v9;class NZ extends(v9=yn,E9=Qe,v9){getSQLType(){return"point"}mapFromDriverValue(s){if(typeof s=="string"){const[o,d]=s.slice(1,-1).split(",");return[Number.parseFloat(o),Number.parseFloat(d)]}return[s.x,s.y]}mapToDriverValue(s){return`(${s[0]},${s[1]})`}}ge(NZ,E9,"PgPointTuple");var y9,S9;class IZ extends(S9=sr,y9=Qe,S9){constructor(s){super(s,"json","PgPointObject")}build(s){return new AZ(s,this.config)}}ge(IZ,y9,"PgPointObjectBuilder");var T9,b9;class AZ extends(b9=yn,T9=Qe,b9){getSQLType(){return"point"}mapFromDriverValue(s){if(typeof s=="string"){const[o,d]=s.slice(1,-1).split(",");return{x:Number.parseFloat(o),y:Number.parseFloat(d)}}return s}mapToDriverValue(s){return`(${s.x},${s.y})`}}ge(AZ,T9,"PgPointObject");function MIe(r,s){const{name:o,config:d}=gi(r,s);return!(d!=null&&d.mode)||d.mode==="tuple"?new xZ(o):new IZ(o)}function UIe(r){const s=[];for(let o=0;o<r.length;o+=2)s.push(Number.parseInt(r.slice(o,o+2),16));return new Uint8Array(s)}function DH(r,s){const o=new ArrayBuffer(8),d=new DataView(o);for(let p=0;p<8;p++)d.setUint8(p,r[s+p]);return d.getFloat64(0,!0)}function OZ(r){const s=UIe(r);let o=0;const d=s[o];o+=1;const p=new DataView(s.buffer),f=p.getUint32(o,d===1);if(o+=4,f&536870912&&(p.getUint32(o,d===1),o+=4),(f&65535)===1){const E=DH(s,o);o+=8;const y=DH(s,o);return o+=8,[E,y]}throw new Error("Unsupported geometry type")}var w9,C9;class PZ extends(C9=sr,w9=Qe,C9){constructor(s){super(s,"array","PgGeometry")}build(s){return new DZ(s,this.config)}}ge(PZ,w9,"PgGeometryBuilder");var R9,x9;class DZ extends(x9=yn,R9=Qe,x9){getSQLType(){return"geometry(point)"}mapFromDriverValue(s){return OZ(s)}mapToDriverValue(s){return`point(${s[0]} ${s[1]})`}}ge(DZ,R9,"PgGeometry");var N9,I9;class kZ extends(I9=sr,N9=Qe,I9){constructor(s){super(s,"json","PgGeometryObject")}build(s){return new LZ(s,this.config)}}ge(kZ,N9,"PgGeometryObjectBuilder");var A9,O9;class LZ extends(O9=yn,A9=Qe,O9){getSQLType(){return"geometry(point)"}mapFromDriverValue(s){const o=OZ(s);return{x:o[0],y:o[1]}}mapToDriverValue(s){return`point(${s.x} ${s.y})`}}ge(LZ,A9,"PgGeometryObject");function VIe(r,s){const{name:o,config:d}=gi(r,s);return!(d!=null&&d.mode)||d.mode==="tuple"?new PZ(o):new kZ(o)}var P9,D9;class jZ extends(D9=sr,P9=Qe,D9){constructor(s,o){super(s,"number","PgReal"),this.config.length=o}build(s){return new MZ(s,this.config)}}ge(jZ,P9,"PgRealBuilder");var k9,L9;class MZ extends(L9=yn,k9=Qe,L9){constructor(o,d){super(o,d);ge(this,"mapFromDriverValue",o=>typeof o=="string"?Number.parseFloat(o):o)}getSQLType(){return"real"}}ge(MZ,k9,"PgReal");function FIe(r){return new jZ(r??"")}var j9,M9;class UZ extends(M9=sr,j9=Qe,M9){constructor(s){super(s,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new VZ(s,this.config)}}ge(UZ,j9,"PgSerialBuilder");var U9,V9;class VZ extends(V9=yn,U9=Qe,V9){getSQLType(){return"serial"}}ge(VZ,U9,"PgSerial");function BIe(r){return new UZ(r??"")}var F9,B9;class FZ extends(B9=Xv,F9=Qe,B9){constructor(s){super(s,"number","PgSmallInt")}build(s){return new BZ(s,this.config)}}ge(FZ,F9,"PgSmallIntBuilder");var G9,W9;class BZ extends(W9=yn,G9=Qe,W9){constructor(){super(...arguments);ge(this,"mapFromDriverValue",o=>typeof o=="string"?Number(o):o)}getSQLType(){return"smallint"}}ge(BZ,G9,"PgSmallInt");function GIe(r){return new FZ(r??"")}var H9,K9;class GZ extends(K9=sr,H9=Qe,K9){constructor(s){super(s,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(s){return new WZ(s,this.config)}}ge(GZ,H9,"PgSmallSerialBuilder");var z9,q9;class WZ extends(q9=yn,z9=Qe,q9){getSQLType(){return"smallserial"}}ge(WZ,z9,"PgSmallSerial");function WIe(r){return new GZ(r??"")}var Y9,X9;class HZ extends(X9=sr,Y9=Qe,X9){constructor(s,o){super(s,"string","PgText"),this.config.enumValues=o.enum}build(s){return new KZ(s,this.config)}}ge(HZ,Y9,"PgTextBuilder");var Q9,J9;class KZ extends(J9=yn,Q9=Qe,J9){constructor(){super(...arguments);ge(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}}ge(KZ,Q9,"PgText");function Wt(r,s={}){const{name:o,config:d}=gi(r,s);return new HZ(o,d)}var $9,Z9;class zZ extends(Z9=Lg,$9=Qe,Z9){constructor(s,o,d){super(s,"string","PgTime"),this.withTimezone=o,this.precision=d,this.config.withTimezone=o,this.config.precision=d}build(s){return new qZ(s,this.config)}}ge(zZ,$9,"PgTimeBuilder");var eq,tq;class qZ extends(tq=yn,eq=Qe,tq){constructor(o,d){super(o,d);ge(this,"withTimezone");ge(this,"precision");this.withTimezone=d.withTimezone,this.precision=d.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}ge(qZ,eq,"PgTime");function HIe(r,s={}){const{name:o,config:d}=gi(r,s);return new zZ(o,d.withTimezone??!1,d.precision)}var nq,rq;class YZ extends(rq=Lg,nq=Qe,rq){constructor(s,o,d){super(s,"date","PgTimestamp"),this.config.withTimezone=o,this.config.precision=d}build(s){return new XZ(s,this.config)}}ge(YZ,nq,"PgTimestampBuilder");var sq,iq;class XZ extends(iq=yn,sq=Qe,iq){constructor(o,d){super(o,d);ge(this,"withTimezone");ge(this,"precision");ge(this,"mapFromDriverValue",o=>new Date(this.withTimezone?o:o+"+0000"));ge(this,"mapToDriverValue",o=>o.toISOString());this.withTimezone=d.withTimezone,this.precision=d.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}ge(XZ,sq,"PgTimestamp");var aq,oq;class QZ extends(oq=Lg,aq=Qe,oq){constructor(s,o,d){super(s,"string","PgTimestampString"),this.config.withTimezone=o,this.config.precision=d}build(s){return new JZ(s,this.config)}}ge(QZ,aq,"PgTimestampStringBuilder");var cq,lq;class JZ extends(lq=yn,cq=Qe,lq){constructor(o,d){super(o,d);ge(this,"withTimezone");ge(this,"precision");this.withTimezone=d.withTimezone,this.precision=d.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}ge(JZ,cq,"PgTimestampString");function Vs(r,s={}){const{name:o,config:d}=gi(r,s);return(d==null?void 0:d.mode)==="string"?new QZ(o,d.withTimezone??!1,d.precision):new YZ(o,(d==null?void 0:d.withTimezone)??!1,d==null?void 0:d.precision)}var dq,uq;class $Z extends(uq=sr,dq=Qe,uq){constructor(s){super(s,"string","PgUUID")}defaultRandom(){return this.default(Oc`gen_random_uuid()`)}build(s){return new ZZ(s,this.config)}}ge($Z,dq,"PgUUIDBuilder");var hq,pq;class ZZ extends(pq=yn,hq=Qe,pq){getSQLType(){return"uuid"}}ge(ZZ,hq,"PgUUID");function KIe(r){return new $Z(r??"")}var mq,fq;class eee extends(fq=sr,mq=Qe,fq){constructor(s,o){super(s,"string","PgVarchar"),this.config.length=o.length,this.config.enumValues=o.enum}build(s){return new tee(s,this.config)}}ge(eee,mq,"PgVarcharBuilder");var gq,_q;class tee extends(_q=yn,gq=Qe,_q){constructor(){super(...arguments);ge(this,"length",this.config.length);ge(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}ge(tee,gq,"PgVarchar");function zs(r,s={}){const{name:o,config:d}=gi(r,s);return new eee(o,d)}var Eq,vq;class nee extends(vq=sr,Eq=Qe,vq){constructor(s,o){super(s,"string","PgBinaryVector"),this.config.dimensions=o.dimensions}build(s){return new ree(s,this.config)}}ge(nee,Eq,"PgBinaryVectorBuilder");var yq,Sq;class ree extends(Sq=yn,yq=Qe,Sq){constructor(){super(...arguments);ge(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}}ge(ree,yq,"PgBinaryVector");function zIe(r,s){const{name:o,config:d}=gi(r,s);return new nee(o,d)}var Tq,bq;class see extends(bq=sr,Tq=Qe,bq){constructor(s,o){super(s,"array","PgHalfVector"),this.config.dimensions=o.dimensions}build(s){return new iee(s,this.config)}}ge(see,Tq,"PgHalfVectorBuilder");var wq,Cq;class iee extends(Cq=yn,wq=Qe,Cq){constructor(){super(...arguments);ge(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(o){return JSON.stringify(o)}mapFromDriverValue(o){return o.slice(1,-1).split(",").map(d=>Number.parseFloat(d))}}ge(iee,wq,"PgHalfVector");function qIe(r,s){const{name:o,config:d}=gi(r,s);return new see(o,d)}var Rq,xq;class aee extends(xq=sr,Rq=Qe,xq){constructor(s,o){super(s,"string","PgSparseVector"),this.config.dimensions=o.dimensions}build(s){return new oee(s,this.config)}}ge(aee,Rq,"PgSparseVectorBuilder");var Nq,Iq;class oee extends(Iq=yn,Nq=Qe,Iq){constructor(){super(...arguments);ge(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}}ge(oee,Nq,"PgSparseVector");function YIe(r,s){const{name:o,config:d}=gi(r,s);return new aee(o,d)}var Aq,Oq;class cee extends(Oq=sr,Aq=Qe,Oq){constructor(s,o){super(s,"array","PgVector"),this.config.dimensions=o.dimensions}build(s){return new lee(s,this.config)}}ge(cee,Aq,"PgVectorBuilder");var Pq,Dq;class lee extends(Dq=yn,Pq=Qe,Dq){constructor(){super(...arguments);ge(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(o){return JSON.stringify(o)}mapFromDriverValue(o){return o.slice(1,-1).split(",").map(d=>Number.parseFloat(d))}}ge(lee,Pq,"PgVector");function XIe(r,s){const{name:o,config:d}=gi(r,s);return new cee(o,d)}function QIe(){return{bigint:SIe,bigserial:TIe,boolean:bIe,char:wIe,cidr:CIe,customType:RIe,date:xIe,doublePrecision:NIe,inet:IIe,integer:Jh,interval:AIe,json:OIe,jsonb:PIe,line:DIe,macaddr:kIe,macaddr8:LIe,numeric:jIe,point:MIe,geometry:VIe,real:FIe,serial:BIe,smallint:GIe,smallserial:WIe,text:Wt,time:HIe,timestamp:Vs,uuid:KIe,varchar:zs,bit:zIe,halfvec:qIe,sparsevec:YIe,vector:XIe}}const LP=Symbol.for("drizzle:PgInlineForeignKeys"),kH=Symbol.for("drizzle:EnableRLS");var kq,Lq,jq,Mq,Uq;class Mb extends(Uq=Qa,Mq=Qe,jq=LP,Lq=kH,kq=Qa.Symbol.ExtraConfigBuilder,Uq){constructor(){super(...arguments);ge(this,jq,[]);ge(this,Lq,!1);ge(this,kq)}}ge(Mb,Mq,"PgTable"),ge(Mb,"Symbol",Object.assign({},Qa.Symbol,{InlineForeignKeys:LP,EnableRLS:kH}));function JIe(r,s,o,d,p=r){const f=new Mb(r,d,p),E=typeof s=="function"?s(QIe()):s,y=Object.fromEntries(Object.entries(E).map(([A,D])=>{const k=D;k.setName(A);const W=k.build(f);return f[LP].push(...k.buildForeignKeys(W,f)),[A,W]})),b=Object.fromEntries(Object.entries(E).map(([A,D])=>{const k=D;k.setName(A);const W=k.buildExtraConfigColumn(f);return[A,W]})),C=Object.assign(f,y);return C[Qa.Symbol.Columns]=y,C[Qa.Symbol.ExtraConfigColumns]=b,Object.assign(C,{enableRLS:()=>(C[Mb.Symbol.EnableRLS]=!0,C)})}const jp=(r,s,o)=>JIe(r,s,o,void 0);var rr;(function(r){r.assertEqual=p=>{};function s(p){}r.assertIs=s;function o(p){throw new Error}r.assertNever=o,r.arrayToEnum=p=>{const f={};for(const E of p)f[E]=E;return f},r.getValidEnumValues=p=>{const f=r.objectKeys(p).filter(y=>typeof p[p[y]]!="number"),E={};for(const y of f)E[y]=p[y];return r.objectValues(E)},r.objectValues=p=>r.objectKeys(p).map(function(f){return p[f]}),r.objectKeys=typeof Object.keys=="function"?p=>Object.keys(p):p=>{const f=[];for(const E in p)Object.prototype.hasOwnProperty.call(p,E)&&f.push(E);return f},r.find=(p,f)=>{for(const E of p)if(f(E))return E},r.isInteger=typeof Number.isInteger=="function"?p=>Number.isInteger(p):p=>typeof p=="number"&&Number.isFinite(p)&&Math.floor(p)===p;function d(p,f=" | "){return p.map(E=>typeof E=="string"?`'${E}'`:E).join(f)}r.joinValues=d,r.jsonStringifyReplacer=(p,f)=>typeof f=="bigint"?f.toString():f})(rr||(rr={}));var jP;(function(r){r.mergeShapes=(s,o)=>({...s,...o})})(jP||(jP={}));const wt=rr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Zl=r=>{switch(typeof r){case"undefined":return wt.undefined;case"string":return wt.string;case"number":return Number.isNaN(r)?wt.nan:wt.number;case"boolean":return wt.boolean;case"function":return wt.function;case"bigint":return wt.bigint;case"symbol":return wt.symbol;case"object":return Array.isArray(r)?wt.array:r===null?wt.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?wt.promise:typeof Map<"u"&&r instanceof Map?wt.map:typeof Set<"u"&&r instanceof Set?wt.set:typeof Date<"u"&&r instanceof Date?wt.date:wt.object;default:return wt.unknown}},Ze=rr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),$Ie=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class eo extends Error{get errors(){return this.issues}constructor(s){super(),this.issues=[],this.addIssue=d=>{this.issues=[...this.issues,d]},this.addIssues=(d=[])=>{this.issues=[...this.issues,...d]};const o=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,o):this.__proto__=o,this.name="ZodError",this.issues=s}format(s){const o=s||function(f){return f.message},d={_errors:[]},p=f=>{for(const E of f.issues)if(E.code==="invalid_union")E.unionErrors.map(p);else if(E.code==="invalid_return_type")p(E.returnTypeError);else if(E.code==="invalid_arguments")p(E.argumentsError);else if(E.path.length===0)d._errors.push(o(E));else{let y=d,b=0;for(;b<E.path.length;){const C=E.path[b];b===E.path.length-1?(y[C]=y[C]||{_errors:[]},y[C]._errors.push(o(E))):y[C]=y[C]||{_errors:[]},y=y[C],b++}}};return p(this),d}static assert(s){if(!(s instanceof eo))throw new Error(`Not a ZodError: ${s}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,rr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(s=o=>o.message){const o={},d=[];for(const p of this.issues)if(p.path.length>0){const f=p.path[0];o[f]=o[f]||[],o[f].push(s(p))}else d.push(s(p));return{formErrors:d,fieldErrors:o}}get formErrors(){return this.flatten()}}eo.create=r=>new eo(r);const yg=(r,s)=>{let o;switch(r.code){case Ze.invalid_type:r.received===wt.undefined?o="Required":o=`Expected ${r.expected}, received ${r.received}`;break;case Ze.invalid_literal:o=`Invalid literal value, expected ${JSON.stringify(r.expected,rr.jsonStringifyReplacer)}`;break;case Ze.unrecognized_keys:o=`Unrecognized key(s) in object: ${rr.joinValues(r.keys,", ")}`;break;case Ze.invalid_union:o="Invalid input";break;case Ze.invalid_union_discriminator:o=`Invalid discriminator value. Expected ${rr.joinValues(r.options)}`;break;case Ze.invalid_enum_value:o=`Invalid enum value. Expected ${rr.joinValues(r.options)}, received '${r.received}'`;break;case Ze.invalid_arguments:o="Invalid function arguments";break;case Ze.invalid_return_type:o="Invalid function return type";break;case Ze.invalid_date:o="Invalid date";break;case Ze.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(o=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(o=`${o} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?o=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?o=`Invalid input: must end with "${r.validation.endsWith}"`:rr.assertNever(r.validation):r.validation!=="regex"?o=`Invalid ${r.validation}`:o="Invalid";break;case Ze.too_small:r.type==="array"?o=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?o=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?o=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?o=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?o=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:o="Invalid input";break;case Ze.too_big:r.type==="array"?o=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?o=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?o=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?o=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?o=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:o="Invalid input";break;case Ze.custom:o="Invalid input";break;case Ze.invalid_intersection_types:o="Intersection results could not be merged";break;case Ze.not_multiple_of:o=`Number must be a multiple of ${r.multipleOf}`;break;case Ze.not_finite:o="Number must be finite";break;default:o=s.defaultError,rr.assertNever(r)}return{message:o}};let dee=yg;function ZIe(r){dee=r}function Ub(){return dee}const Vb=r=>{const{data:s,path:o,errorMaps:d,issueData:p}=r,f=[...o,...p.path||[]],E={...p,path:f};if(p.message!==void 0)return{...p,path:f,message:p.message};let y="";const b=d.filter(C=>!!C).slice().reverse();for(const C of b)y=C(E,{data:s,defaultError:y}).message;return{...p,path:f,message:y}},eAe=[];function _t(r,s){const o=Ub(),d=Vb({issueData:s,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,o,o===yg?void 0:yg].filter(p=>!!p)});r.common.issues.push(d)}class Ki{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(s,o){const d=[];for(const p of o){if(p.status==="aborted")return Jt;p.status==="dirty"&&s.dirty(),d.push(p.value)}return{status:s.value,value:d}}static async mergeObjectAsync(s,o){const d=[];for(const p of o){const f=await p.key,E=await p.value;d.push({key:f,value:E})}return Ki.mergeObjectSync(s,d)}static mergeObjectSync(s,o){const d={};for(const p of o){const{key:f,value:E}=p;if(f.status==="aborted"||E.status==="aborted")return Jt;f.status==="dirty"&&s.dirty(),E.status==="dirty"&&s.dirty(),f.value!=="__proto__"&&(typeof E.value<"u"||p.alwaysSet)&&(d[f.value]=E.value)}return{status:s.value,value:d}}}const Jt=Object.freeze({status:"aborted"}),Af=r=>({status:"dirty",value:r}),ca=r=>({status:"valid",value:r}),MP=r=>r.status==="aborted",UP=r=>r.status==="dirty",yp=r=>r.status==="valid",_v=r=>typeof Promise<"u"&&r instanceof Promise;var Dt;(function(r){r.errToObj=s=>typeof s=="string"?{message:s}:s||{},r.toString=s=>typeof s=="string"?s:s==null?void 0:s.message})(Dt||(Dt={}));class Rl{constructor(s,o,d,p){this._cachedPath=[],this.parent=s,this.data=o,this._path=d,this._key=p}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const LH=(r,s)=>{if(yp(s))return{success:!0,data:s.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const o=new eo(r.common.issues);return this._error=o,this._error}}};function vn(r){if(!r)return{};const{errorMap:s,invalid_type_error:o,required_error:d,description:p}=r;if(s&&(o||d))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return s?{errorMap:s,description:p}:{errorMap:(E,y)=>{const{message:b}=r;return E.code==="invalid_enum_value"?{message:b??y.defaultError}:typeof y.data>"u"?{message:b??d??y.defaultError}:E.code!=="invalid_type"?{message:y.defaultError}:{message:b??o??y.defaultError}},description:p}}class Nn{get description(){return this._def.description}_getType(s){return Zl(s.data)}_getOrReturnCtx(s,o){return o||{common:s.parent.common,data:s.data,parsedType:Zl(s.data),schemaErrorMap:this._def.errorMap,path:s.path,parent:s.parent}}_processInputParams(s){return{status:new Ki,ctx:{common:s.parent.common,data:s.data,parsedType:Zl(s.data),schemaErrorMap:this._def.errorMap,path:s.path,parent:s.parent}}}_parseSync(s){const o=this._parse(s);if(_v(o))throw new Error("Synchronous parse encountered promise.");return o}_parseAsync(s){const o=this._parse(s);return Promise.resolve(o)}parse(s,o){const d=this.safeParse(s,o);if(d.success)return d.data;throw d.error}safeParse(s,o){const d={common:{issues:[],async:(o==null?void 0:o.async)??!1,contextualErrorMap:o==null?void 0:o.errorMap},path:(o==null?void 0:o.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Zl(s)},p=this._parseSync({data:s,path:d.path,parent:d});return LH(d,p)}"~validate"(s){var d,p;const o={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Zl(s)};if(!this["~standard"].async)try{const f=this._parseSync({data:s,path:[],parent:o});return yp(f)?{value:f.value}:{issues:o.common.issues}}catch(f){(p=(d=f==null?void 0:f.message)==null?void 0:d.toLowerCase())!=null&&p.includes("encountered")&&(this["~standard"].async=!0),o.common={issues:[],async:!0}}return this._parseAsync({data:s,path:[],parent:o}).then(f=>yp(f)?{value:f.value}:{issues:o.common.issues})}async parseAsync(s,o){const d=await this.safeParseAsync(s,o);if(d.success)return d.data;throw d.error}async safeParseAsync(s,o){const d={common:{issues:[],contextualErrorMap:o==null?void 0:o.errorMap,async:!0},path:(o==null?void 0:o.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:s,parsedType:Zl(s)},p=this._parse({data:s,path:d.path,parent:d}),f=await(_v(p)?p:Promise.resolve(p));return LH(d,f)}refine(s,o){const d=p=>typeof o=="string"||typeof o>"u"?{message:o}:typeof o=="function"?o(p):o;return this._refinement((p,f)=>{const E=s(p),y=()=>f.addIssue({code:Ze.custom,...d(p)});return typeof Promise<"u"&&E instanceof Promise?E.then(b=>b?!0:(y(),!1)):E?!0:(y(),!1)})}refinement(s,o){return this._refinement((d,p)=>s(d)?!0:(p.addIssue(typeof o=="function"?o(d,p):o),!1))}_refinement(s){return new Pc({schema:this,typeName:en.ZodEffects,effect:{type:"refinement",refinement:s}})}superRefine(s){return this._refinement(s)}constructor(s){this.spa=this.safeParseAsync,this._def=s,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:o=>this["~validate"](o)}}optional(){return Sl.create(this,this._def)}nullable(){return Fu.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Rc.create(this)}promise(){return Tg.create(this,this._def)}or(s){return Sv.create([this,s],this._def)}and(s){return Tv.create(this,s,this._def)}transform(s){return new Pc({...vn(this._def),schema:this,typeName:en.ZodEffects,effect:{type:"transform",transform:s}})}default(s){const o=typeof s=="function"?s:()=>s;return new xv({...vn(this._def),innerType:this,defaultValue:o,typeName:en.ZodDefault})}brand(){return new M1({typeName:en.ZodBranded,type:this,...vn(this._def)})}catch(s){const o=typeof s=="function"?s:()=>s;return new Nv({...vn(this._def),innerType:this,catchValue:o,typeName:en.ZodCatch})}describe(s){const o=this.constructor;return new o({...this._def,description:s})}pipe(s){return Qv.create(this,s)}readonly(){return Iv.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const tAe=/^c[^\s-]{8,}$/i,nAe=/^[0-9a-z]+$/,rAe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,sAe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,iAe=/^[a-z0-9_-]{21}$/i,aAe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,oAe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,cAe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,lAe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let lO;const dAe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,uAe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,hAe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,pAe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mAe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,fAe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,uee="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",gAe=new RegExp(`^${uee}$`);function hee(r){let s="[0-5]\\d";r.precision?s=`${s}\\.\\d{${r.precision}}`:r.precision==null&&(s=`${s}(\\.\\d+)?`);const o=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${s})${o}`}function _Ae(r){return new RegExp(`^${hee(r)}$`)}function pee(r){let s=`${uee}T${hee(r)}`;const o=[];return o.push(r.local?"Z?":"Z"),r.offset&&o.push("([+-]\\d{2}:?\\d{2})"),s=`${s}(${o.join("|")})`,new RegExp(`^${s}$`)}function EAe(r,s){return!!((s==="v4"||!s)&&dAe.test(r)||(s==="v6"||!s)&&hAe.test(r))}function vAe(r,s){if(!aAe.test(r))return!1;try{const[o]=r.split(".");if(!o)return!1;const d=o.replace(/-/g,"+").replace(/_/g,"/").padEnd(o.length+(4-o.length%4)%4,"="),p=JSON.parse(atob(d));return!(typeof p!="object"||p===null||"typ"in p&&(p==null?void 0:p.typ)!=="JWT"||!p.alg||s&&p.alg!==s)}catch{return!1}}function yAe(r,s){return!!((s==="v4"||!s)&&uAe.test(r)||(s==="v6"||!s)&&pAe.test(r))}class bc extends Nn{_parse(s){if(this._def.coerce&&(s.data=String(s.data)),this._getType(s)!==wt.string){const f=this._getOrReturnCtx(s);return _t(f,{code:Ze.invalid_type,expected:wt.string,received:f.parsedType}),Jt}const d=new Ki;let p;for(const f of this._def.checks)if(f.kind==="min")s.data.length<f.value&&(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.too_small,minimum:f.value,type:"string",inclusive:!0,exact:!1,message:f.message}),d.dirty());else if(f.kind==="max")s.data.length>f.value&&(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.too_big,maximum:f.value,type:"string",inclusive:!0,exact:!1,message:f.message}),d.dirty());else if(f.kind==="length"){const E=s.data.length>f.value,y=s.data.length<f.value;(E||y)&&(p=this._getOrReturnCtx(s,p),E?_t(p,{code:Ze.too_big,maximum:f.value,type:"string",inclusive:!0,exact:!0,message:f.message}):y&&_t(p,{code:Ze.too_small,minimum:f.value,type:"string",inclusive:!0,exact:!0,message:f.message}),d.dirty())}else if(f.kind==="email")cAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"email",code:Ze.invalid_string,message:f.message}),d.dirty());else if(f.kind==="emoji")lO||(lO=new RegExp(lAe,"u")),lO.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"emoji",code:Ze.invalid_string,message:f.message}),d.dirty());else if(f.kind==="uuid")sAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"uuid",code:Ze.invalid_string,message:f.message}),d.dirty());else if(f.kind==="nanoid")iAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"nanoid",code:Ze.invalid_string,message:f.message}),d.dirty());else if(f.kind==="cuid")tAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"cuid",code:Ze.invalid_string,message:f.message}),d.dirty());else if(f.kind==="cuid2")nAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"cuid2",code:Ze.invalid_string,message:f.message}),d.dirty());else if(f.kind==="ulid")rAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"ulid",code:Ze.invalid_string,message:f.message}),d.dirty());else if(f.kind==="url")try{new URL(s.data)}catch{p=this._getOrReturnCtx(s,p),_t(p,{validation:"url",code:Ze.invalid_string,message:f.message}),d.dirty()}else f.kind==="regex"?(f.regex.lastIndex=0,f.regex.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"regex",code:Ze.invalid_string,message:f.message}),d.dirty())):f.kind==="trim"?s.data=s.data.trim():f.kind==="includes"?s.data.includes(f.value,f.position)||(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.invalid_string,validation:{includes:f.value,position:f.position},message:f.message}),d.dirty()):f.kind==="toLowerCase"?s.data=s.data.toLowerCase():f.kind==="toUpperCase"?s.data=s.data.toUpperCase():f.kind==="startsWith"?s.data.startsWith(f.value)||(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.invalid_string,validation:{startsWith:f.value},message:f.message}),d.dirty()):f.kind==="endsWith"?s.data.endsWith(f.value)||(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.invalid_string,validation:{endsWith:f.value},message:f.message}),d.dirty()):f.kind==="datetime"?pee(f).test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.invalid_string,validation:"datetime",message:f.message}),d.dirty()):f.kind==="date"?gAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.invalid_string,validation:"date",message:f.message}),d.dirty()):f.kind==="time"?_Ae(f).test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.invalid_string,validation:"time",message:f.message}),d.dirty()):f.kind==="duration"?oAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"duration",code:Ze.invalid_string,message:f.message}),d.dirty()):f.kind==="ip"?EAe(s.data,f.version)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"ip",code:Ze.invalid_string,message:f.message}),d.dirty()):f.kind==="jwt"?vAe(s.data,f.alg)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"jwt",code:Ze.invalid_string,message:f.message}),d.dirty()):f.kind==="cidr"?yAe(s.data,f.version)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"cidr",code:Ze.invalid_string,message:f.message}),d.dirty()):f.kind==="base64"?mAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"base64",code:Ze.invalid_string,message:f.message}),d.dirty()):f.kind==="base64url"?fAe.test(s.data)||(p=this._getOrReturnCtx(s,p),_t(p,{validation:"base64url",code:Ze.invalid_string,message:f.message}),d.dirty()):rr.assertNever(f);return{status:d.value,value:s.data}}_regex(s,o,d){return this.refinement(p=>s.test(p),{validation:o,code:Ze.invalid_string,...Dt.errToObj(d)})}_addCheck(s){return new bc({...this._def,checks:[...this._def.checks,s]})}email(s){return this._addCheck({kind:"email",...Dt.errToObj(s)})}url(s){return this._addCheck({kind:"url",...Dt.errToObj(s)})}emoji(s){return this._addCheck({kind:"emoji",...Dt.errToObj(s)})}uuid(s){return this._addCheck({kind:"uuid",...Dt.errToObj(s)})}nanoid(s){return this._addCheck({kind:"nanoid",...Dt.errToObj(s)})}cuid(s){return this._addCheck({kind:"cuid",...Dt.errToObj(s)})}cuid2(s){return this._addCheck({kind:"cuid2",...Dt.errToObj(s)})}ulid(s){return this._addCheck({kind:"ulid",...Dt.errToObj(s)})}base64(s){return this._addCheck({kind:"base64",...Dt.errToObj(s)})}base64url(s){return this._addCheck({kind:"base64url",...Dt.errToObj(s)})}jwt(s){return this._addCheck({kind:"jwt",...Dt.errToObj(s)})}ip(s){return this._addCheck({kind:"ip",...Dt.errToObj(s)})}cidr(s){return this._addCheck({kind:"cidr",...Dt.errToObj(s)})}datetime(s){return typeof s=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:s}):this._addCheck({kind:"datetime",precision:typeof(s==null?void 0:s.precision)>"u"?null:s==null?void 0:s.precision,offset:(s==null?void 0:s.offset)??!1,local:(s==null?void 0:s.local)??!1,...Dt.errToObj(s==null?void 0:s.message)})}date(s){return this._addCheck({kind:"date",message:s})}time(s){return typeof s=="string"?this._addCheck({kind:"time",precision:null,message:s}):this._addCheck({kind:"time",precision:typeof(s==null?void 0:s.precision)>"u"?null:s==null?void 0:s.precision,...Dt.errToObj(s==null?void 0:s.message)})}duration(s){return this._addCheck({kind:"duration",...Dt.errToObj(s)})}regex(s,o){return this._addCheck({kind:"regex",regex:s,...Dt.errToObj(o)})}includes(s,o){return this._addCheck({kind:"includes",value:s,position:o==null?void 0:o.position,...Dt.errToObj(o==null?void 0:o.message)})}startsWith(s,o){return this._addCheck({kind:"startsWith",value:s,...Dt.errToObj(o)})}endsWith(s,o){return this._addCheck({kind:"endsWith",value:s,...Dt.errToObj(o)})}min(s,o){return this._addCheck({kind:"min",value:s,...Dt.errToObj(o)})}max(s,o){return this._addCheck({kind:"max",value:s,...Dt.errToObj(o)})}length(s,o){return this._addCheck({kind:"length",value:s,...Dt.errToObj(o)})}nonempty(s){return this.min(1,Dt.errToObj(s))}trim(){return new bc({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new bc({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new bc({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(s=>s.kind==="datetime")}get isDate(){return!!this._def.checks.find(s=>s.kind==="date")}get isTime(){return!!this._def.checks.find(s=>s.kind==="time")}get isDuration(){return!!this._def.checks.find(s=>s.kind==="duration")}get isEmail(){return!!this._def.checks.find(s=>s.kind==="email")}get isURL(){return!!this._def.checks.find(s=>s.kind==="url")}get isEmoji(){return!!this._def.checks.find(s=>s.kind==="emoji")}get isUUID(){return!!this._def.checks.find(s=>s.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(s=>s.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(s=>s.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(s=>s.kind==="cuid2")}get isULID(){return!!this._def.checks.find(s=>s.kind==="ulid")}get isIP(){return!!this._def.checks.find(s=>s.kind==="ip")}get isCIDR(){return!!this._def.checks.find(s=>s.kind==="cidr")}get isBase64(){return!!this._def.checks.find(s=>s.kind==="base64")}get isBase64url(){return!!this._def.checks.find(s=>s.kind==="base64url")}get minLength(){let s=null;for(const o of this._def.checks)o.kind==="min"&&(s===null||o.value>s)&&(s=o.value);return s}get maxLength(){let s=null;for(const o of this._def.checks)o.kind==="max"&&(s===null||o.value<s)&&(s=o.value);return s}}bc.create=r=>new bc({checks:[],typeName:en.ZodString,coerce:(r==null?void 0:r.coerce)??!1,...vn(r)});function SAe(r,s){const o=(r.toString().split(".")[1]||"").length,d=(s.toString().split(".")[1]||"").length,p=o>d?o:d,f=Number.parseInt(r.toFixed(p).replace(".","")),E=Number.parseInt(s.toFixed(p).replace(".",""));return f%E/10**p}class Mu extends Nn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(s){if(this._def.coerce&&(s.data=Number(s.data)),this._getType(s)!==wt.number){const f=this._getOrReturnCtx(s);return _t(f,{code:Ze.invalid_type,expected:wt.number,received:f.parsedType}),Jt}let d;const p=new Ki;for(const f of this._def.checks)f.kind==="int"?rr.isInteger(s.data)||(d=this._getOrReturnCtx(s,d),_t(d,{code:Ze.invalid_type,expected:"integer",received:"float",message:f.message}),p.dirty()):f.kind==="min"?(f.inclusive?s.data<f.value:s.data<=f.value)&&(d=this._getOrReturnCtx(s,d),_t(d,{code:Ze.too_small,minimum:f.value,type:"number",inclusive:f.inclusive,exact:!1,message:f.message}),p.dirty()):f.kind==="max"?(f.inclusive?s.data>f.value:s.data>=f.value)&&(d=this._getOrReturnCtx(s,d),_t(d,{code:Ze.too_big,maximum:f.value,type:"number",inclusive:f.inclusive,exact:!1,message:f.message}),p.dirty()):f.kind==="multipleOf"?SAe(s.data,f.value)!==0&&(d=this._getOrReturnCtx(s,d),_t(d,{code:Ze.not_multiple_of,multipleOf:f.value,message:f.message}),p.dirty()):f.kind==="finite"?Number.isFinite(s.data)||(d=this._getOrReturnCtx(s,d),_t(d,{code:Ze.not_finite,message:f.message}),p.dirty()):rr.assertNever(f);return{status:p.value,value:s.data}}gte(s,o){return this.setLimit("min",s,!0,Dt.toString(o))}gt(s,o){return this.setLimit("min",s,!1,Dt.toString(o))}lte(s,o){return this.setLimit("max",s,!0,Dt.toString(o))}lt(s,o){return this.setLimit("max",s,!1,Dt.toString(o))}setLimit(s,o,d,p){return new Mu({...this._def,checks:[...this._def.checks,{kind:s,value:o,inclusive:d,message:Dt.toString(p)}]})}_addCheck(s){return new Mu({...this._def,checks:[...this._def.checks,s]})}int(s){return this._addCheck({kind:"int",message:Dt.toString(s)})}positive(s){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Dt.toString(s)})}negative(s){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Dt.toString(s)})}nonpositive(s){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Dt.toString(s)})}nonnegative(s){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Dt.toString(s)})}multipleOf(s,o){return this._addCheck({kind:"multipleOf",value:s,message:Dt.toString(o)})}finite(s){return this._addCheck({kind:"finite",message:Dt.toString(s)})}safe(s){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Dt.toString(s)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Dt.toString(s)})}get minValue(){let s=null;for(const o of this._def.checks)o.kind==="min"&&(s===null||o.value>s)&&(s=o.value);return s}get maxValue(){let s=null;for(const o of this._def.checks)o.kind==="max"&&(s===null||o.value<s)&&(s=o.value);return s}get isInt(){return!!this._def.checks.find(s=>s.kind==="int"||s.kind==="multipleOf"&&rr.isInteger(s.value))}get isFinite(){let s=null,o=null;for(const d of this._def.checks){if(d.kind==="finite"||d.kind==="int"||d.kind==="multipleOf")return!0;d.kind==="min"?(o===null||d.value>o)&&(o=d.value):d.kind==="max"&&(s===null||d.value<s)&&(s=d.value)}return Number.isFinite(o)&&Number.isFinite(s)}}Mu.create=r=>new Mu({checks:[],typeName:en.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...vn(r)});class Uu extends Nn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(s){if(this._def.coerce)try{s.data=BigInt(s.data)}catch{return this._getInvalidInput(s)}if(this._getType(s)!==wt.bigint)return this._getInvalidInput(s);let d;const p=new Ki;for(const f of this._def.checks)f.kind==="min"?(f.inclusive?s.data<f.value:s.data<=f.value)&&(d=this._getOrReturnCtx(s,d),_t(d,{code:Ze.too_small,type:"bigint",minimum:f.value,inclusive:f.inclusive,message:f.message}),p.dirty()):f.kind==="max"?(f.inclusive?s.data>f.value:s.data>=f.value)&&(d=this._getOrReturnCtx(s,d),_t(d,{code:Ze.too_big,type:"bigint",maximum:f.value,inclusive:f.inclusive,message:f.message}),p.dirty()):f.kind==="multipleOf"?s.data%f.value!==BigInt(0)&&(d=this._getOrReturnCtx(s,d),_t(d,{code:Ze.not_multiple_of,multipleOf:f.value,message:f.message}),p.dirty()):rr.assertNever(f);return{status:p.value,value:s.data}}_getInvalidInput(s){const o=this._getOrReturnCtx(s);return _t(o,{code:Ze.invalid_type,expected:wt.bigint,received:o.parsedType}),Jt}gte(s,o){return this.setLimit("min",s,!0,Dt.toString(o))}gt(s,o){return this.setLimit("min",s,!1,Dt.toString(o))}lte(s,o){return this.setLimit("max",s,!0,Dt.toString(o))}lt(s,o){return this.setLimit("max",s,!1,Dt.toString(o))}setLimit(s,o,d,p){return new Uu({...this._def,checks:[...this._def.checks,{kind:s,value:o,inclusive:d,message:Dt.toString(p)}]})}_addCheck(s){return new Uu({...this._def,checks:[...this._def.checks,s]})}positive(s){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Dt.toString(s)})}negative(s){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Dt.toString(s)})}nonpositive(s){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Dt.toString(s)})}nonnegative(s){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Dt.toString(s)})}multipleOf(s,o){return this._addCheck({kind:"multipleOf",value:s,message:Dt.toString(o)})}get minValue(){let s=null;for(const o of this._def.checks)o.kind==="min"&&(s===null||o.value>s)&&(s=o.value);return s}get maxValue(){let s=null;for(const o of this._def.checks)o.kind==="max"&&(s===null||o.value<s)&&(s=o.value);return s}}Uu.create=r=>new Uu({checks:[],typeName:en.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,...vn(r)});class Ev extends Nn{_parse(s){if(this._def.coerce&&(s.data=!!s.data),this._getType(s)!==wt.boolean){const d=this._getOrReturnCtx(s);return _t(d,{code:Ze.invalid_type,expected:wt.boolean,received:d.parsedType}),Jt}return ca(s.data)}}Ev.create=r=>new Ev({typeName:en.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...vn(r)});class Sp extends Nn{_parse(s){if(this._def.coerce&&(s.data=new Date(s.data)),this._getType(s)!==wt.date){const f=this._getOrReturnCtx(s);return _t(f,{code:Ze.invalid_type,expected:wt.date,received:f.parsedType}),Jt}if(Number.isNaN(s.data.getTime())){const f=this._getOrReturnCtx(s);return _t(f,{code:Ze.invalid_date}),Jt}const d=new Ki;let p;for(const f of this._def.checks)f.kind==="min"?s.data.getTime()<f.value&&(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.too_small,message:f.message,inclusive:!0,exact:!1,minimum:f.value,type:"date"}),d.dirty()):f.kind==="max"?s.data.getTime()>f.value&&(p=this._getOrReturnCtx(s,p),_t(p,{code:Ze.too_big,message:f.message,inclusive:!0,exact:!1,maximum:f.value,type:"date"}),d.dirty()):rr.assertNever(f);return{status:d.value,value:new Date(s.data.getTime())}}_addCheck(s){return new Sp({...this._def,checks:[...this._def.checks,s]})}min(s,o){return this._addCheck({kind:"min",value:s.getTime(),message:Dt.toString(o)})}max(s,o){return this._addCheck({kind:"max",value:s.getTime(),message:Dt.toString(o)})}get minDate(){let s=null;for(const o of this._def.checks)o.kind==="min"&&(s===null||o.value>s)&&(s=o.value);return s!=null?new Date(s):null}get maxDate(){let s=null;for(const o of this._def.checks)o.kind==="max"&&(s===null||o.value<s)&&(s=o.value);return s!=null?new Date(s):null}}Sp.create=r=>new Sp({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:en.ZodDate,...vn(r)});class Fb extends Nn{_parse(s){if(this._getType(s)!==wt.symbol){const d=this._getOrReturnCtx(s);return _t(d,{code:Ze.invalid_type,expected:wt.symbol,received:d.parsedType}),Jt}return ca(s.data)}}Fb.create=r=>new Fb({typeName:en.ZodSymbol,...vn(r)});class vv extends Nn{_parse(s){if(this._getType(s)!==wt.undefined){const d=this._getOrReturnCtx(s);return _t(d,{code:Ze.invalid_type,expected:wt.undefined,received:d.parsedType}),Jt}return ca(s.data)}}vv.create=r=>new vv({typeName:en.ZodUndefined,...vn(r)});class yv extends Nn{_parse(s){if(this._getType(s)!==wt.null){const d=this._getOrReturnCtx(s);return _t(d,{code:Ze.invalid_type,expected:wt.null,received:d.parsedType}),Jt}return ca(s.data)}}yv.create=r=>new yv({typeName:en.ZodNull,...vn(r)});class Sg extends Nn{constructor(){super(...arguments),this._any=!0}_parse(s){return ca(s.data)}}Sg.create=r=>new Sg({typeName:en.ZodAny,...vn(r)});class op extends Nn{constructor(){super(...arguments),this._unknown=!0}_parse(s){return ca(s.data)}}op.create=r=>new op({typeName:en.ZodUnknown,...vn(r)});class _d extends Nn{_parse(s){const o=this._getOrReturnCtx(s);return _t(o,{code:Ze.invalid_type,expected:wt.never,received:o.parsedType}),Jt}}_d.create=r=>new _d({typeName:en.ZodNever,...vn(r)});class Bb extends Nn{_parse(s){if(this._getType(s)!==wt.undefined){const d=this._getOrReturnCtx(s);return _t(d,{code:Ze.invalid_type,expected:wt.void,received:d.parsedType}),Jt}return ca(s.data)}}Bb.create=r=>new Bb({typeName:en.ZodVoid,...vn(r)});class Rc extends Nn{_parse(s){const{ctx:o,status:d}=this._processInputParams(s),p=this._def;if(o.parsedType!==wt.array)return _t(o,{code:Ze.invalid_type,expected:wt.array,received:o.parsedType}),Jt;if(p.exactLength!==null){const E=o.data.length>p.exactLength.value,y=o.data.length<p.exactLength.value;(E||y)&&(_t(o,{code:E?Ze.too_big:Ze.too_small,minimum:y?p.exactLength.value:void 0,maximum:E?p.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:p.exactLength.message}),d.dirty())}if(p.minLength!==null&&o.data.length<p.minLength.value&&(_t(o,{code:Ze.too_small,minimum:p.minLength.value,type:"array",inclusive:!0,exact:!1,message:p.minLength.message}),d.dirty()),p.maxLength!==null&&o.data.length>p.maxLength.value&&(_t(o,{code:Ze.too_big,maximum:p.maxLength.value,type:"array",inclusive:!0,exact:!1,message:p.maxLength.message}),d.dirty()),o.common.async)return Promise.all([...o.data].map((E,y)=>p.type._parseAsync(new Rl(o,E,o.path,y)))).then(E=>Ki.mergeArray(d,E));const f=[...o.data].map((E,y)=>p.type._parseSync(new Rl(o,E,o.path,y)));return Ki.mergeArray(d,f)}get element(){return this._def.type}min(s,o){return new Rc({...this._def,minLength:{value:s,message:Dt.toString(o)}})}max(s,o){return new Rc({...this._def,maxLength:{value:s,message:Dt.toString(o)}})}length(s,o){return new Rc({...this._def,exactLength:{value:s,message:Dt.toString(o)}})}nonempty(s){return this.min(1,s)}}Rc.create=(r,s)=>new Rc({type:r,minLength:null,maxLength:null,exactLength:null,typeName:en.ZodArray,...vn(s)});function mf(r){if(r instanceof Ts){const s={};for(const o in r.shape){const d=r.shape[o];s[o]=Sl.create(mf(d))}return new Ts({...r._def,shape:()=>s})}else return r instanceof Rc?new Rc({...r._def,type:mf(r.element)}):r instanceof Sl?Sl.create(mf(r.unwrap())):r instanceof Fu?Fu.create(mf(r.unwrap())):r instanceof xl?xl.create(r.items.map(s=>mf(s))):r}class Ts extends Nn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const s=this._def.shape(),o=rr.objectKeys(s);return this._cached={shape:s,keys:o},this._cached}_parse(s){if(this._getType(s)!==wt.object){const C=this._getOrReturnCtx(s);return _t(C,{code:Ze.invalid_type,expected:wt.object,received:C.parsedType}),Jt}const{status:d,ctx:p}=this._processInputParams(s),{shape:f,keys:E}=this._getCached(),y=[];if(!(this._def.catchall instanceof _d&&this._def.unknownKeys==="strip"))for(const C in p.data)E.includes(C)||y.push(C);const b=[];for(const C of E){const A=f[C],D=p.data[C];b.push({key:{status:"valid",value:C},value:A._parse(new Rl(p,D,p.path,C)),alwaysSet:C in p.data})}if(this._def.catchall instanceof _d){const C=this._def.unknownKeys;if(C==="passthrough")for(const A of y)b.push({key:{status:"valid",value:A},value:{status:"valid",value:p.data[A]}});else if(C==="strict")y.length>0&&(_t(p,{code:Ze.unrecognized_keys,keys:y}),d.dirty());else if(C!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const C=this._def.catchall;for(const A of y){const D=p.data[A];b.push({key:{status:"valid",value:A},value:C._parse(new Rl(p,D,p.path,A)),alwaysSet:A in p.data})}}return p.common.async?Promise.resolve().then(async()=>{const C=[];for(const A of b){const D=await A.key,k=await A.value;C.push({key:D,value:k,alwaysSet:A.alwaysSet})}return C}).then(C=>Ki.mergeObjectSync(d,C)):Ki.mergeObjectSync(d,b)}get shape(){return this._def.shape()}strict(s){return Dt.errToObj,new Ts({...this._def,unknownKeys:"strict",...s!==void 0?{errorMap:(o,d)=>{var f,E;const p=((E=(f=this._def).errorMap)==null?void 0:E.call(f,o,d).message)??d.defaultError;return o.code==="unrecognized_keys"?{message:Dt.errToObj(s).message??p}:{message:p}}}:{}})}strip(){return new Ts({...this._def,unknownKeys:"strip"})}passthrough(){return new Ts({...this._def,unknownKeys:"passthrough"})}extend(s){return new Ts({...this._def,shape:()=>({...this._def.shape(),...s})})}merge(s){return new Ts({unknownKeys:s._def.unknownKeys,catchall:s._def.catchall,shape:()=>({...this._def.shape(),...s._def.shape()}),typeName:en.ZodObject})}setKey(s,o){return this.augment({[s]:o})}catchall(s){return new Ts({...this._def,catchall:s})}pick(s){const o={};for(const d of rr.objectKeys(s))s[d]&&this.shape[d]&&(o[d]=this.shape[d]);return new Ts({...this._def,shape:()=>o})}omit(s){const o={};for(const d of rr.objectKeys(this.shape))s[d]||(o[d]=this.shape[d]);return new Ts({...this._def,shape:()=>o})}deepPartial(){return mf(this)}partial(s){const o={};for(const d of rr.objectKeys(this.shape)){const p=this.shape[d];s&&!s[d]?o[d]=p:o[d]=p.optional()}return new Ts({...this._def,shape:()=>o})}required(s){const o={};for(const d of rr.objectKeys(this.shape))if(s&&!s[d])o[d]=this.shape[d];else{let f=this.shape[d];for(;f instanceof Sl;)f=f._def.innerType;o[d]=f}return new Ts({...this._def,shape:()=>o})}keyof(){return mee(rr.objectKeys(this.shape))}}Ts.create=(r,s)=>new Ts({shape:()=>r,unknownKeys:"strip",catchall:_d.create(),typeName:en.ZodObject,...vn(s)});Ts.strictCreate=(r,s)=>new Ts({shape:()=>r,unknownKeys:"strict",catchall:_d.create(),typeName:en.ZodObject,...vn(s)});Ts.lazycreate=(r,s)=>new Ts({shape:r,unknownKeys:"strip",catchall:_d.create(),typeName:en.ZodObject,...vn(s)});class Sv extends Nn{_parse(s){const{ctx:o}=this._processInputParams(s),d=this._def.options;function p(f){for(const y of f)if(y.result.status==="valid")return y.result;for(const y of f)if(y.result.status==="dirty")return o.common.issues.push(...y.ctx.common.issues),y.result;const E=f.map(y=>new eo(y.ctx.common.issues));return _t(o,{code:Ze.invalid_union,unionErrors:E}),Jt}if(o.common.async)return Promise.all(d.map(async f=>{const E={...o,common:{...o.common,issues:[]},parent:null};return{result:await f._parseAsync({data:o.data,path:o.path,parent:E}),ctx:E}})).then(p);{let f;const E=[];for(const b of d){const C={...o,common:{...o.common,issues:[]},parent:null},A=b._parseSync({data:o.data,path:o.path,parent:C});if(A.status==="valid")return A;A.status==="dirty"&&!f&&(f={result:A,ctx:C}),C.common.issues.length&&E.push(C.common.issues)}if(f)return o.common.issues.push(...f.ctx.common.issues),f.result;const y=E.map(b=>new eo(b));return _t(o,{code:Ze.invalid_union,unionErrors:y}),Jt}}get options(){return this._def.options}}Sv.create=(r,s)=>new Sv({options:r,typeName:en.ZodUnion,...vn(s)});const Ql=r=>r instanceof wv?Ql(r.schema):r instanceof Pc?Ql(r.innerType()):r instanceof Cv?[r.value]:r instanceof Vu?r.options:r instanceof Rv?rr.objectValues(r.enum):r instanceof xv?Ql(r._def.innerType):r instanceof vv?[void 0]:r instanceof yv?[null]:r instanceof Sl?[void 0,...Ql(r.unwrap())]:r instanceof Fu?[null,...Ql(r.unwrap())]:r instanceof M1||r instanceof Iv?Ql(r.unwrap()):r instanceof Nv?Ql(r._def.innerType):[];class Lw extends Nn{_parse(s){const{ctx:o}=this._processInputParams(s);if(o.parsedType!==wt.object)return _t(o,{code:Ze.invalid_type,expected:wt.object,received:o.parsedType}),Jt;const d=this.discriminator,p=o.data[d],f=this.optionsMap.get(p);return f?o.common.async?f._parseAsync({data:o.data,path:o.path,parent:o}):f._parseSync({data:o.data,path:o.path,parent:o}):(_t(o,{code:Ze.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[d]}),Jt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(s,o,d){const p=new Map;for(const f of o){const E=Ql(f.shape[s]);if(!E.length)throw new Error(`A discriminator value for key \`${s}\` could not be extracted from all schema options`);for(const y of E){if(p.has(y))throw new Error(`Discriminator property ${String(s)} has duplicate value ${String(y)}`);p.set(y,f)}}return new Lw({typeName:en.ZodDiscriminatedUnion,discriminator:s,options:o,optionsMap:p,...vn(d)})}}function VP(r,s){const o=Zl(r),d=Zl(s);if(r===s)return{valid:!0,data:r};if(o===wt.object&&d===wt.object){const p=rr.objectKeys(s),f=rr.objectKeys(r).filter(y=>p.indexOf(y)!==-1),E={...r,...s};for(const y of f){const b=VP(r[y],s[y]);if(!b.valid)return{valid:!1};E[y]=b.data}return{valid:!0,data:E}}else if(o===wt.array&&d===wt.array){if(r.length!==s.length)return{valid:!1};const p=[];for(let f=0;f<r.length;f++){const E=r[f],y=s[f],b=VP(E,y);if(!b.valid)return{valid:!1};p.push(b.data)}return{valid:!0,data:p}}else return o===wt.date&&d===wt.date&&+r==+s?{valid:!0,data:r}:{valid:!1}}class Tv extends Nn{_parse(s){const{status:o,ctx:d}=this._processInputParams(s),p=(f,E)=>{if(MP(f)||MP(E))return Jt;const y=VP(f.value,E.value);return y.valid?((UP(f)||UP(E))&&o.dirty(),{status:o.value,value:y.data}):(_t(d,{code:Ze.invalid_intersection_types}),Jt)};return d.common.async?Promise.all([this._def.left._parseAsync({data:d.data,path:d.path,parent:d}),this._def.right._parseAsync({data:d.data,path:d.path,parent:d})]).then(([f,E])=>p(f,E)):p(this._def.left._parseSync({data:d.data,path:d.path,parent:d}),this._def.right._parseSync({data:d.data,path:d.path,parent:d}))}}Tv.create=(r,s,o)=>new Tv({left:r,right:s,typeName:en.ZodIntersection,...vn(o)});class xl extends Nn{_parse(s){const{status:o,ctx:d}=this._processInputParams(s);if(d.parsedType!==wt.array)return _t(d,{code:Ze.invalid_type,expected:wt.array,received:d.parsedType}),Jt;if(d.data.length<this._def.items.length)return _t(d,{code:Ze.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Jt;!this._def.rest&&d.data.length>this._def.items.length&&(_t(d,{code:Ze.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),o.dirty());const f=[...d.data].map((E,y)=>{const b=this._def.items[y]||this._def.rest;return b?b._parse(new Rl(d,E,d.path,y)):null}).filter(E=>!!E);return d.common.async?Promise.all(f).then(E=>Ki.mergeArray(o,E)):Ki.mergeArray(o,f)}get items(){return this._def.items}rest(s){return new xl({...this._def,rest:s})}}xl.create=(r,s)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new xl({items:r,typeName:en.ZodTuple,rest:null,...vn(s)})};class bv extends Nn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(s){const{status:o,ctx:d}=this._processInputParams(s);if(d.parsedType!==wt.object)return _t(d,{code:Ze.invalid_type,expected:wt.object,received:d.parsedType}),Jt;const p=[],f=this._def.keyType,E=this._def.valueType;for(const y in d.data)p.push({key:f._parse(new Rl(d,y,d.path,y)),value:E._parse(new Rl(d,d.data[y],d.path,y)),alwaysSet:y in d.data});return d.common.async?Ki.mergeObjectAsync(o,p):Ki.mergeObjectSync(o,p)}get element(){return this._def.valueType}static create(s,o,d){return o instanceof Nn?new bv({keyType:s,valueType:o,typeName:en.ZodRecord,...vn(d)}):new bv({keyType:bc.create(),valueType:s,typeName:en.ZodRecord,...vn(o)})}}class Gb extends Nn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(s){const{status:o,ctx:d}=this._processInputParams(s);if(d.parsedType!==wt.map)return _t(d,{code:Ze.invalid_type,expected:wt.map,received:d.parsedType}),Jt;const p=this._def.keyType,f=this._def.valueType,E=[...d.data.entries()].map(([y,b],C)=>({key:p._parse(new Rl(d,y,d.path,[C,"key"])),value:f._parse(new Rl(d,b,d.path,[C,"value"]))}));if(d.common.async){const y=new Map;return Promise.resolve().then(async()=>{for(const b of E){const C=await b.key,A=await b.value;if(C.status==="aborted"||A.status==="aborted")return Jt;(C.status==="dirty"||A.status==="dirty")&&o.dirty(),y.set(C.value,A.value)}return{status:o.value,value:y}})}else{const y=new Map;for(const b of E){const C=b.key,A=b.value;if(C.status==="aborted"||A.status==="aborted")return Jt;(C.status==="dirty"||A.status==="dirty")&&o.dirty(),y.set(C.value,A.value)}return{status:o.value,value:y}}}}Gb.create=(r,s,o)=>new Gb({valueType:s,keyType:r,typeName:en.ZodMap,...vn(o)});class Tp extends Nn{_parse(s){const{status:o,ctx:d}=this._processInputParams(s);if(d.parsedType!==wt.set)return _t(d,{code:Ze.invalid_type,expected:wt.set,received:d.parsedType}),Jt;const p=this._def;p.minSize!==null&&d.data.size<p.minSize.value&&(_t(d,{code:Ze.too_small,minimum:p.minSize.value,type:"set",inclusive:!0,exact:!1,message:p.minSize.message}),o.dirty()),p.maxSize!==null&&d.data.size>p.maxSize.value&&(_t(d,{code:Ze.too_big,maximum:p.maxSize.value,type:"set",inclusive:!0,exact:!1,message:p.maxSize.message}),o.dirty());const f=this._def.valueType;function E(b){const C=new Set;for(const A of b){if(A.status==="aborted")return Jt;A.status==="dirty"&&o.dirty(),C.add(A.value)}return{status:o.value,value:C}}const y=[...d.data.values()].map((b,C)=>f._parse(new Rl(d,b,d.path,C)));return d.common.async?Promise.all(y).then(b=>E(b)):E(y)}min(s,o){return new Tp({...this._def,minSize:{value:s,message:Dt.toString(o)}})}max(s,o){return new Tp({...this._def,maxSize:{value:s,message:Dt.toString(o)}})}size(s,o){return this.min(s,o).max(s,o)}nonempty(s){return this.min(1,s)}}Tp.create=(r,s)=>new Tp({valueType:r,minSize:null,maxSize:null,typeName:en.ZodSet,...vn(s)});class Kf extends Nn{constructor(){super(...arguments),this.validate=this.implement}_parse(s){const{ctx:o}=this._processInputParams(s);if(o.parsedType!==wt.function)return _t(o,{code:Ze.invalid_type,expected:wt.function,received:o.parsedType}),Jt;function d(y,b){return Vb({data:y,path:o.path,errorMaps:[o.common.contextualErrorMap,o.schemaErrorMap,Ub(),yg].filter(C=>!!C),issueData:{code:Ze.invalid_arguments,argumentsError:b}})}function p(y,b){return Vb({data:y,path:o.path,errorMaps:[o.common.contextualErrorMap,o.schemaErrorMap,Ub(),yg].filter(C=>!!C),issueData:{code:Ze.invalid_return_type,returnTypeError:b}})}const f={errorMap:o.common.contextualErrorMap},E=o.data;if(this._def.returns instanceof Tg){const y=this;return ca(async function(...b){const C=new eo([]),A=await y._def.args.parseAsync(b,f).catch(W=>{throw C.addIssue(d(b,W)),C}),D=await Reflect.apply(E,this,A);return await y._def.returns._def.type.parseAsync(D,f).catch(W=>{throw C.addIssue(p(D,W)),C})})}else{const y=this;return ca(function(...b){const C=y._def.args.safeParse(b,f);if(!C.success)throw new eo([d(b,C.error)]);const A=Reflect.apply(E,this,C.data),D=y._def.returns.safeParse(A,f);if(!D.success)throw new eo([p(A,D.error)]);return D.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...s){return new Kf({...this._def,args:xl.create(s).rest(op.create())})}returns(s){return new Kf({...this._def,returns:s})}implement(s){return this.parse(s)}strictImplement(s){return this.parse(s)}static create(s,o,d){return new Kf({args:s||xl.create([]).rest(op.create()),returns:o||op.create(),typeName:en.ZodFunction,...vn(d)})}}class wv extends Nn{get schema(){return this._def.getter()}_parse(s){const{ctx:o}=this._processInputParams(s);return this._def.getter()._parse({data:o.data,path:o.path,parent:o})}}wv.create=(r,s)=>new wv({getter:r,typeName:en.ZodLazy,...vn(s)});class Cv extends Nn{_parse(s){if(s.data!==this._def.value){const o=this._getOrReturnCtx(s);return _t(o,{received:o.data,code:Ze.invalid_literal,expected:this._def.value}),Jt}return{status:"valid",value:s.data}}get value(){return this._def.value}}Cv.create=(r,s)=>new Cv({value:r,typeName:en.ZodLiteral,...vn(s)});function mee(r,s){return new Vu({values:r,typeName:en.ZodEnum,...vn(s)})}class Vu extends Nn{_parse(s){if(typeof s.data!="string"){const o=this._getOrReturnCtx(s),d=this._def.values;return _t(o,{expected:rr.joinValues(d),received:o.parsedType,code:Ze.invalid_type}),Jt}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(s.data)){const o=this._getOrReturnCtx(s),d=this._def.values;return _t(o,{received:o.data,code:Ze.invalid_enum_value,options:d}),Jt}return ca(s.data)}get options(){return this._def.values}get enum(){const s={};for(const o of this._def.values)s[o]=o;return s}get Values(){const s={};for(const o of this._def.values)s[o]=o;return s}get Enum(){const s={};for(const o of this._def.values)s[o]=o;return s}extract(s,o=this._def){return Vu.create(s,{...this._def,...o})}exclude(s,o=this._def){return Vu.create(this.options.filter(d=>!s.includes(d)),{...this._def,...o})}}Vu.create=mee;class Rv extends Nn{_parse(s){const o=rr.getValidEnumValues(this._def.values),d=this._getOrReturnCtx(s);if(d.parsedType!==wt.string&&d.parsedType!==wt.number){const p=rr.objectValues(o);return _t(d,{expected:rr.joinValues(p),received:d.parsedType,code:Ze.invalid_type}),Jt}if(this._cache||(this._cache=new Set(rr.getValidEnumValues(this._def.values))),!this._cache.has(s.data)){const p=rr.objectValues(o);return _t(d,{received:d.data,code:Ze.invalid_enum_value,options:p}),Jt}return ca(s.data)}get enum(){return this._def.values}}Rv.create=(r,s)=>new Rv({values:r,typeName:en.ZodNativeEnum,...vn(s)});class Tg extends Nn{unwrap(){return this._def.type}_parse(s){const{ctx:o}=this._processInputParams(s);if(o.parsedType!==wt.promise&&o.common.async===!1)return _t(o,{code:Ze.invalid_type,expected:wt.promise,received:o.parsedType}),Jt;const d=o.parsedType===wt.promise?o.data:Promise.resolve(o.data);return ca(d.then(p=>this._def.type.parseAsync(p,{path:o.path,errorMap:o.common.contextualErrorMap})))}}Tg.create=(r,s)=>new Tg({type:r,typeName:en.ZodPromise,...vn(s)});class Pc extends Nn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===en.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(s){const{status:o,ctx:d}=this._processInputParams(s),p=this._def.effect||null,f={addIssue:E=>{_t(d,E),E.fatal?o.abort():o.dirty()},get path(){return d.path}};if(f.addIssue=f.addIssue.bind(f),p.type==="preprocess"){const E=p.transform(d.data,f);if(d.common.async)return Promise.resolve(E).then(async y=>{if(o.value==="aborted")return Jt;const b=await this._def.schema._parseAsync({data:y,path:d.path,parent:d});return b.status==="aborted"?Jt:b.status==="dirty"||o.value==="dirty"?Af(b.value):b});{if(o.value==="aborted")return Jt;const y=this._def.schema._parseSync({data:E,path:d.path,parent:d});return y.status==="aborted"?Jt:y.status==="dirty"||o.value==="dirty"?Af(y.value):y}}if(p.type==="refinement"){const E=y=>{const b=p.refinement(y,f);if(d.common.async)return Promise.resolve(b);if(b instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return y};if(d.common.async===!1){const y=this._def.schema._parseSync({data:d.data,path:d.path,parent:d});return y.status==="aborted"?Jt:(y.status==="dirty"&&o.dirty(),E(y.value),{status:o.value,value:y.value})}else return this._def.schema._parseAsync({data:d.data,path:d.path,parent:d}).then(y=>y.status==="aborted"?Jt:(y.status==="dirty"&&o.dirty(),E(y.value).then(()=>({status:o.value,value:y.value}))))}if(p.type==="transform")if(d.common.async===!1){const E=this._def.schema._parseSync({data:d.data,path:d.path,parent:d});if(!yp(E))return Jt;const y=p.transform(E.value,f);if(y instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:o.value,value:y}}else return this._def.schema._parseAsync({data:d.data,path:d.path,parent:d}).then(E=>yp(E)?Promise.resolve(p.transform(E.value,f)).then(y=>({status:o.value,value:y})):Jt);rr.assertNever(p)}}Pc.create=(r,s,o)=>new Pc({schema:r,typeName:en.ZodEffects,effect:s,...vn(o)});Pc.createWithPreprocess=(r,s,o)=>new Pc({schema:s,effect:{type:"preprocess",transform:r},typeName:en.ZodEffects,...vn(o)});class Sl extends Nn{_parse(s){return this._getType(s)===wt.undefined?ca(void 0):this._def.innerType._parse(s)}unwrap(){return this._def.innerType}}Sl.create=(r,s)=>new Sl({innerType:r,typeName:en.ZodOptional,...vn(s)});class Fu extends Nn{_parse(s){return this._getType(s)===wt.null?ca(null):this._def.innerType._parse(s)}unwrap(){return this._def.innerType}}Fu.create=(r,s)=>new Fu({innerType:r,typeName:en.ZodNullable,...vn(s)});class xv extends Nn{_parse(s){const{ctx:o}=this._processInputParams(s);let d=o.data;return o.parsedType===wt.undefined&&(d=this._def.defaultValue()),this._def.innerType._parse({data:d,path:o.path,parent:o})}removeDefault(){return this._def.innerType}}xv.create=(r,s)=>new xv({innerType:r,typeName:en.ZodDefault,defaultValue:typeof s.default=="function"?s.default:()=>s.default,...vn(s)});class Nv extends Nn{_parse(s){const{ctx:o}=this._processInputParams(s),d={...o,common:{...o.common,issues:[]}},p=this._def.innerType._parse({data:d.data,path:d.path,parent:{...d}});return _v(p)?p.then(f=>({status:"valid",value:f.status==="valid"?f.value:this._def.catchValue({get error(){return new eo(d.common.issues)},input:d.data})})):{status:"valid",value:p.status==="valid"?p.value:this._def.catchValue({get error(){return new eo(d.common.issues)},input:d.data})}}removeCatch(){return this._def.innerType}}Nv.create=(r,s)=>new Nv({innerType:r,typeName:en.ZodCatch,catchValue:typeof s.catch=="function"?s.catch:()=>s.catch,...vn(s)});class Wb extends Nn{_parse(s){if(this._getType(s)!==wt.nan){const d=this._getOrReturnCtx(s);return _t(d,{code:Ze.invalid_type,expected:wt.nan,received:d.parsedType}),Jt}return{status:"valid",value:s.data}}}Wb.create=r=>new Wb({typeName:en.ZodNaN,...vn(r)});const TAe=Symbol("zod_brand");class M1 extends Nn{_parse(s){const{ctx:o}=this._processInputParams(s),d=o.data;return this._def.type._parse({data:d,path:o.path,parent:o})}unwrap(){return this._def.type}}class Qv extends Nn{_parse(s){const{status:o,ctx:d}=this._processInputParams(s);if(d.common.async)return(async()=>{const f=await this._def.in._parseAsync({data:d.data,path:d.path,parent:d});return f.status==="aborted"?Jt:f.status==="dirty"?(o.dirty(),Af(f.value)):this._def.out._parseAsync({data:f.value,path:d.path,parent:d})})();{const p=this._def.in._parseSync({data:d.data,path:d.path,parent:d});return p.status==="aborted"?Jt:p.status==="dirty"?(o.dirty(),{status:"dirty",value:p.value}):this._def.out._parseSync({data:p.value,path:d.path,parent:d})}}static create(s,o){return new Qv({in:s,out:o,typeName:en.ZodPipeline})}}class Iv extends Nn{_parse(s){const o=this._def.innerType._parse(s),d=p=>(yp(p)&&(p.value=Object.freeze(p.value)),p);return _v(o)?o.then(p=>d(p)):d(o)}unwrap(){return this._def.innerType}}Iv.create=(r,s)=>new Iv({innerType:r,typeName:en.ZodReadonly,...vn(s)});function jH(r,s){const o=typeof r=="function"?r(s):typeof r=="string"?{message:r}:r;return typeof o=="string"?{message:o}:o}function U1(r,s={},o){return r?Sg.create().superRefine((d,p)=>{const f=r(d);if(f instanceof Promise)return f.then(E=>{if(!E){const y=jH(s,d),b=y.fatal??o??!0;p.addIssue({code:"custom",...y,fatal:b})}});if(!f){const E=jH(s,d),y=E.fatal??o??!0;p.addIssue({code:"custom",...E,fatal:y})}}):Sg.create()}const bAe={object:Ts.lazycreate};var en;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(en||(en={}));const wAe=(r,s={message:`Input not instance of ${r.name}`})=>U1(o=>o instanceof r,s),kt=bc.create,bp=Mu.create,CAe=Wb.create,RAe=Uu.create,jw=Ev.create,xAe=Sp.create,NAe=Fb.create,IAe=vv.create,fee=yv.create,Hb=Sg.create,AAe=op.create,OAe=_d.create,PAe=Bb.create,_c=Rc.create,ni=Ts.create,DAe=Ts.strictCreate,Mw=Sv.create,kAe=Lw.create,LAe=Tv.create,jAe=xl.create,V1=bv.create,MAe=Gb.create,UAe=Tp.create,VAe=Kf.create,FAe=wv.create,PE=Cv.create,od=Vu.create,BAe=Rv.create,GAe=Tg.create,MH=Pc.create,WAe=Sl.create,HAe=Fu.create,KAe=Pc.createWithPreprocess,zAe=Qv.create,qAe=()=>kt().optional(),YAe=()=>bp().optional(),XAe=()=>jw().optional(),QAe={string:r=>bc.create({...r,coerce:!0}),number:r=>Mu.create({...r,coerce:!0}),boolean:r=>Ev.create({...r,coerce:!0}),bigint:r=>Uu.create({...r,coerce:!0}),date:r=>Sp.create({...r,coerce:!0})},JAe=Jt,$Ae=Object.freeze(Object.defineProperty({__proto__:null,BRAND:TAe,DIRTY:Af,EMPTY_PATH:eAe,INVALID:Jt,NEVER:JAe,OK:ca,ParseStatus:Ki,Schema:Nn,ZodAny:Sg,ZodArray:Rc,ZodBigInt:Uu,ZodBoolean:Ev,ZodBranded:M1,ZodCatch:Nv,ZodDate:Sp,ZodDefault:xv,ZodDiscriminatedUnion:Lw,ZodEffects:Pc,ZodEnum:Vu,ZodError:eo,get ZodFirstPartyTypeKind(){return en},ZodFunction:Kf,ZodIntersection:Tv,ZodIssueCode:Ze,ZodLazy:wv,ZodLiteral:Cv,ZodMap:Gb,ZodNaN:Wb,ZodNativeEnum:Rv,ZodNever:_d,ZodNull:yv,ZodNullable:Fu,ZodNumber:Mu,ZodObject:Ts,ZodOptional:Sl,ZodParsedType:wt,ZodPipeline:Qv,ZodPromise:Tg,ZodReadonly:Iv,ZodRecord:bv,ZodSchema:Nn,ZodSet:Tp,ZodString:bc,ZodSymbol:Fb,ZodTransformer:Pc,ZodTuple:xl,ZodType:Nn,ZodUndefined:vv,ZodUnion:Sv,ZodUnknown:op,ZodVoid:Bb,addIssueToContext:_t,any:Hb,array:_c,bigint:RAe,boolean:jw,coerce:QAe,custom:U1,date:xAe,datetimeRegex:pee,defaultErrorMap:yg,discriminatedUnion:kAe,effect:MH,enum:od,function:VAe,getErrorMap:Ub,getParsedType:Zl,instanceof:wAe,intersection:LAe,isAborted:MP,isAsync:_v,isDirty:UP,isValid:yp,late:bAe,lazy:FAe,literal:PE,makeIssue:Vb,map:MAe,nan:CAe,nativeEnum:BAe,never:OAe,null:fee,nullable:HAe,number:bp,object:ni,get objectUtil(){return jP},oboolean:XAe,onumber:YAe,optional:WAe,ostring:qAe,pipeline:zAe,preprocess:KAe,promise:GAe,quotelessJson:$Ie,record:V1,set:UAe,setErrorMap:ZIe,strictObject:DAe,string:kt,symbol:NAe,transformer:MH,tuple:jAe,undefined:IAe,union:Mw,unknown:AAe,get util(){return rr},void:PAe},Symbol.toStringTag,{value:"Module"})),Ss={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function js(r,s){return s.includes(r.columnType)}function ZAe(r){return"enumValues"in r&&Array.isArray(r.enumValues)&&r.enumValues.length>0}const eOe=Mw([kt(),bp(),jw(),fee()]),tOe=Mw([eOe,V1(Hb()),_c(Hb())]),nOe=U1(r=>r instanceof Buffer);function gee(r,s){const o=(s==null?void 0:s.zodInstance)??$Ae,d=(s==null?void 0:s.coerce)??{};let p;return ZAe(r)&&(p=r.enumValues.length?o.enum(r.enumValues):o.string()),p||(js(r,["PgGeometry","PgPointTuple"])?p=o.tuple([o.number(),o.number()]):js(r,["PgGeometryObject","PgPointObject"])?p=o.object({x:o.number(),y:o.number()}):js(r,["PgHalfVector","PgVector"])?(p=o.array(o.number()),p=r.dimensions?p.length(r.dimensions):p):js(r,["PgLine"])?p=o.tuple([o.number(),o.number(),o.number()]):js(r,["PgLineABC"])?p=o.object({a:o.number(),b:o.number(),c:o.number()}):js(r,["PgArray"])?(p=o.array(gee(r.baseColumn,o)),p=r.size?p.length(r.size):p):r.dataType==="array"?p=o.array(o.any()):r.dataType==="number"?p=rOe(r,o,d):r.dataType==="bigint"?p=sOe(r,o,d):r.dataType==="boolean"?p=d===!0||d.boolean?o.coerce.boolean():o.boolean():r.dataType==="date"?p=d===!0||d.date?o.coerce.date():o.date():r.dataType==="string"?p=iOe(r,o,d):r.dataType==="json"?p=tOe:r.dataType==="custom"?p=o.any():r.dataType==="buffer"&&(p=nOe)),p||(p=o.any()),p}function rOe(r,s,o){let d=r.getSQLType().includes("unsigned"),p,f,E=!1;js(r,["MySqlTinyInt","SingleStoreTinyInt"])?(p=d?0:Ss.INT8_MIN,f=d?Ss.INT8_UNSIGNED_MAX:Ss.INT8_MAX,E=!0):js(r,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(p=d?0:Ss.INT16_MIN,f=d?Ss.INT16_UNSIGNED_MAX:Ss.INT16_MAX,E=!0):js(r,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(p=d?0:Ss.INT24_MIN,f=d?Ss.INT24_UNSIGNED_MAX:Ss.INT24_MAX,E=js(r,["MySqlMediumInt","SingleStoreMediumInt"])):js(r,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(p=d?0:Ss.INT32_MIN,f=d?Ss.INT32_UNSIGNED_MAX:Ss.INT32_MAX,E=!0):js(r,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(p=d?0:Ss.INT48_MIN,f=d?Ss.INT48_UNSIGNED_MAX:Ss.INT48_MAX):js(r,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(d=d||js(r,["MySqlSerial","SingleStoreSerial"]),p=d?0:Number.MIN_SAFE_INTEGER,f=Number.MAX_SAFE_INTEGER,E=!0):js(r,["MySqlYear","SingleStoreYear"])?(p=1901,f=2155,E=!0):(p=Number.MIN_SAFE_INTEGER,f=Number.MAX_SAFE_INTEGER);let y=o===!0||o!=null&&o.number?s.coerce.number():s.number();return y=y.min(p).max(f),E?y.int():y}function sOe(r,s,o){const d=r.getSQLType().includes("unsigned"),p=d?0n:Ss.INT64_MIN,f=d?Ss.INT64_UNSIGNED_MAX:Ss.INT64_MAX;return(o===!0||o!=null&&o.bigint?s.coerce.bigint():s.bigint()).min(p).max(f)}function iOe(r,s,o){if(js(r,["PgUUID"]))return s.string().uuid();let d,p,f=!1;js(r,["PgVarchar","SQLiteText"])?d=r.length:js(r,["MySqlVarChar","SingleStoreVarChar"])?d=r.length??Ss.INT16_UNSIGNED_MAX:js(r,["MySqlText","SingleStoreText"])&&(r.textType==="longtext"?d=Ss.INT32_UNSIGNED_MAX:r.textType==="mediumtext"?d=Ss.INT24_UNSIGNED_MAX:r.textType==="text"?d=Ss.INT16_UNSIGNED_MAX:d=Ss.INT8_UNSIGNED_MAX),js(r,["PgChar","MySqlChar","SingleStoreChar"])&&(d=r.length,f=!0),js(r,["PgBinaryVector"])&&(p=/^[01]+$/,d=r.dimensions);let E=o===!0||o!=null&&o.string?s.coerce.string():s.string();return E=p?E.regex(p):E,d&&f?E.length(d):d?E.max(d):E}function _ee(r){return k$(r)?vIe(r):yIe(r)}function Eee(r,s,o,d){const p={};for(const[f,E]of Object.entries(r)){if(!Ai(E,vg)&&!Ai(E,si)&&!Ai(E,si.Aliased)&&typeof E=="object"){const D=k$(E)||EIe(E)?_ee(E):E;p[f]=Eee(D,s[f]??{},o,d);continue}const y=s[f];if(y!==void 0&&typeof y!="function"){p[f]=y;continue}const b=Ai(E,vg)?E:void 0,C=b?gee(b,d):Hb(),A=typeof y=="function"?y(C):C;o.never(b)||(p[f]=A,b&&(o.nullable(b)&&(p[f]=p[f].nullable()),o.optional(b)&&(p[f]=p[f].optional())))}return ni(p)}const aOe={never:r=>{var s,o;return((s=r==null?void 0:r.generated)==null?void 0:s.type)==="always"||((o=r==null?void 0:r.generatedIdentity)==null?void 0:o.type)==="always"},optional:r=>!r.notNull||r.notNull&&r.hasDefault,nullable:r=>!r.notNull},Mp=(r,s)=>{const o=_ee(r);return Eee(o,{},aOe)},oOe=jp("users",{id:zs("id").primaryKey().default(Oc`gen_random_uuid()`),username:Wt("username").notNull().unique(),password:Wt("password").notNull(),role:Wt("role").notNull(),fullName:Wt("full_name").notNull(),hospitalAdminId:zs("hospital_admin_id"),departmentId:zs("department_id"),isActive:Jh("is_active").notNull().default(1),createdAt:Vs("created_at").defaultNow()});Mp(oOe).omit({id:!0,createdAt:!0});const cOe=jp("patients",{id:zs("id").primaryKey().default(Oc`gen_random_uuid()`),mrn:Wt("mrn").notNull().unique(),firstName:Wt("first_name").notNull(),lastName:Wt("last_name").notNull(),age:Jh("age").notNull(),gender:Wt("gender").notNull(),phoneNumber:Wt("phone_number").notNull(),email:Wt("email"),address:Wt("address"),nin:Wt("nin").notNull(),bloodGroup:Wt("blood_group").notNull(),genotype:Wt("genotype").notNull(),allergies:Wt("allergies"),symptoms:Wt("symptoms"),bloodPressureSystolic:Jh("bp_systolic"),bloodPressureDiastolic:Jh("bp_diastolic"),temperature:Wt("temperature"),heartRate:Jh("heart_rate"),weight:Wt("weight"),facialRecognitionData:Wt("facial_recognition_data"),fingerprintData:Wt("fingerprint_data"),registeredBy:Wt("registered_by").notNull(),lastUpdatedBy:Wt("last_updated_by"),createdAt:Vs("created_at").defaultNow(),updatedAt:Vs("updated_at").defaultNow()}),lOe=Mp(cOe).omit({id:!0,createdAt:!0,updatedAt:!0}),dOe=Mw([ni({authMethod:PE("credentials"),username:kt().min(1,"Username is required"),password:kt().min(1,"Password is required")}),ni({authMethod:PE("nin"),nin:kt().min(1,"NIN is required")}),ni({authMethod:PE("fingerprint"),fingerprintData:kt().min(1,"Fingerprint data is required")}),ni({authMethod:PE("facial"),facialData:kt().min(1,"Facial data is required")})]);ni({username:kt().min(3,"Username must be at least 3 characters"),password:kt().min(6,"Password must be at least 6 characters"),fullName:kt().min(2,"Full name is required"),role:od(["patient","doctor","nurse","admin"],{errorMap:()=>({message:"Please select a valid role"})}),departmentId:kt().optional()});ni({healthRiskScore:bp().min(0).max(100),riskLevel:od(["LOW","MODERATE","HIGH","CRITICAL"]),riskFactors:_c(kt()),suggestedDiagnosis:_c(ni({condition:kt(),confidence:bp().min(0).max(1),symptoms:_c(kt()),severity:od(["mild","moderate","severe"])})),recommendations:_c(ni({category:kt(),recommendation:kt(),priority:od(["low","medium","high"]),action:kt()})),prescribedDrugs:_c(ni({drugName:kt(),dosage:kt(),frequency:kt(),duration:kt(),indication:kt(),contraindications:_c(kt()),sideEffects:_c(kt())})),analysisDetails:ni({bpAnalysis:kt(),heartRateAnalysis:kt(),temperatureAnalysis:kt(),weightAnalysis:kt(),ageRiskAnalysis:kt(),genotypeBenefit:kt()})});const uOe=jp("lab_results",{id:zs("id").primaryKey().default(Oc`gen_random_uuid()`),patientId:zs("patient_id").notNull(),testName:Wt("test_name").notNull(),testCategory:Wt("test_category").notNull(),fileData:Wt("file_data"),fileName:Wt("file_name").notNull(),fileType:Wt("file_type"),testValues:Wt("test_values"),normalRange:Wt("normal_range"),status:Wt("status").notNull(),automatedAnalysis:Wt("automated_analysis"),doctorNotes:Wt("doctor_notes"),recommendations:Wt("recommendations"),uploadedBy:Wt("uploaded_by").notNull(),uploadedAt:Vs("uploaded_at").defaultNow(),reviewedBy:Wt("reviewed_by"),reviewedAt:Vs("reviewed_at"),createdAt:Vs("created_at").defaultNow(),updatedAt:Vs("updated_at").defaultNow()});Mp(uOe).omit({id:!0,createdAt:!0,updatedAt:!0,automatedAnalysis:!0});ni({testName:kt(),overallStatus:od(["normal","abnormal","critical"]),severity:od(["low","moderate","high","critical"]),flaggedAbnormalities:_c(ni({parameter:kt(),value:kt(),normalRange:kt(),status:od(["normal","abnormal","critical"]),clinicalSignificance:kt()})),riskAssessment:ni({diseaseProbability:V1(bp()),acuteTreatmentNeeded:jw(),recommendedFollowUp:kt()}),recommendations:_c(kt()),correlationWithVitals:kt(),historicalComparison:kt()});const hOe=jp("appointments",{id:zs("id").primaryKey().default(Oc`gen_random_uuid()`),patientId:zs("patient_id").notNull(),doctorId:zs("doctor_id").notNull(),appointmentDate:Vs("appointment_date").notNull(),reason:Wt("reason").notNull(),status:Wt("status").notNull().default("pending"),notes:Wt("notes"),paymentAmount:Jh("payment_amount").default(1e3),paymentStatus:Wt("payment_status").default("pending"),createdAt:Vs("created_at").defaultNow(),updatedAt:Vs("updated_at").defaultNow()});Mp(hOe).omit({id:!0,createdAt:!0,updatedAt:!0,status:!0});const pOe=jp("subscriptions",{id:zs("id").primaryKey().default(Oc`gen_random_uuid()`),adminUserId:zs("admin_user_id").notNull().unique(),tier:Wt("tier").notNull().default("free"),trialStartDate:Vs("trial_start_date").defaultNow(),trialEndDate:Vs("trial_end_date"),subscriptionStartDate:Vs("subscription_start_date"),subscriptionEndDate:Vs("subscription_end_date"),billingCycle:Wt("billing_cycle"),status:Wt("status").notNull().default("trial"),stripeCustomerId:Wt("stripe_customer_id"),stripeSubscriptionId:Wt("stripe_subscription_id"),createdAt:Vs("created_at").defaultNow(),updatedAt:Vs("updated_at").defaultNow()});Mp(pOe).omit({id:!0,createdAt:!0,updatedAt:!0,trialStartDate:!0,trialEndDate:!0});const mOe=jp("departments",{id:zs("id").primaryKey().default(Oc`gen_random_uuid()`),hospitalAdminId:zs("hospital_admin_id").notNull(),name:Wt("name").notNull(),description:Wt("description"),headStaffId:zs("head_staff_id"),status:Wt("status").notNull().default("active"),createdAt:Vs("created_at").defaultNow(),updatedAt:Vs("updated_at").defaultNow()});Mp(mOe).omit({id:!0,createdAt:!0,updatedAt:!0});const fOe=jp("notifications",{id:zs("id").primaryKey().default(Oc`gen_random_uuid()`),departmentId:zs("department_id").notNull(),patientId:zs("patient_id").notNull(),appointmentId:zs("appointment_id"),type:Wt("type").notNull(),title:Wt("title").notNull(),message:Wt("message").notNull(),priority:Wt("priority").notNull().default("normal"),requestedBy:zs("requested_by").notNull(),status:Wt("status").notNull().default("unread"),actionData:Wt("action_data"),createdAt:Vs("created_at").defaultNow(),updatedAt:Vs("updated_at").defaultNow()});Mp(fOe).omit({id:!0,createdAt:!0,updatedAt:!0});const gOe=[{icon:fp,title:"Biometric Authentication",description:"Secure access with fingerprint and facial recognition technology"},{icon:yu,title:"AI Diagnosis",description:"Predictive diagnosis powered by advanced AI algorithms"},{icon:nwe,title:"Result Analysis",description:"Intelligent analysis of medical test results and lab reports"},{icon:n1,title:"Role-Based Access",description:"Secure access control for doctors, nurses, and administrators"},{icon:oa,title:"Digital Records",description:"Say goodbye to hard copy files with secure digital storage"},{icon:aQ,title:"Real-Time Updates",description:"Instant access to patient information and medical history"}];function _Oe(){const[,r]=so(),{login:s}=ts(),{toast:o}=jr(),[d,p]=I.useState("credentials"),[f,E]=I.useState(!1),[y,b]=I.useState("facial"),[C,A]=I.useState(""),[D,k]=I.useState(!1),W=Pg({resolver:Dg(dOe),defaultValues:{authMethod:"credentials",username:"",password:""}}),G=Lr({mutationFn:async Z=>await(await Ot("POST","/api/auth/login",Z)).json(),onSuccess:Z=>{console.log("Login successful! User data:",Z.user),console.log("User role:",Z.user.role),s(Z.user),o({title:"Login Successful",description:`Welcome back, ${Z.user.fullName}!`});const ee=R1(Z.user.role);console.log("Calculated dashboard route:",ee),r(ee)},onError:Z=>{o({title:"Login Failed",description:Z.message,variant:"destructive"})}}),L=Z=>{G.mutate(Z)},B=()=>{if(!C.trim()){o({title:"NIN Required",description:"Please enter your NIN to continue",variant:"destructive"});return}G.mutate({authMethod:"nin",nin:C})},H=Z=>{b(Z),E(!0)},V=Z=>{const ee=`${Z}_${Date.now()}_captured`;G.mutate({authMethod:Z,...Z==="facial"?{facialData:ee}:{fingerprintData:ee}}),E(!1)},K=()=>{E(!1)};return c.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 via-blue-50 to-white",children:[c.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-4 pt-8 pb-12",children:[c.jsxs("div",{className:"text-center mb-8 space-y-4",children:[c.jsx("img",{src:vp,alt:"Digital Doctors Assistant",className:"mx-auto h-32 w-auto object-contain","data-testid":"img-dda-logo"}),c.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900",children:"Digital Doctors Assistant"}),c.jsx("p",{className:"text-lg md:text-xl text-gray-600 max-w-2xl mx-auto",children:"Revolutionary healthcare management system with biometric authentication, AI-powered diagnostics, and secure patient record management."})]}),c.jsxs("div",{className:"flex gap-4 mb-16",children:[c.jsx(we,{size:"lg",className:"bg-blue-600 hover:bg-blue-700 text-white rounded-full px-8",onClick:()=>window.location.href="/register","data-testid":"button-get-started",children:"Get Started"}),c.jsx(we,{size:"lg",variant:"outline",className:"rounded-full px-8",onClick:()=>k(!0),"data-testid":"button-sign-in",children:"Sign In"})]}),c.jsx("div",{className:"w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:gOe.map((Z,ee)=>{const $=Z.icon;return c.jsx(_e,{className:"border-0 shadow-sm hover-elevate",children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{className:"inline-flex h-12 w-12 items-center justify-center rounded-lg bg-blue-600 text-white",children:c.jsx($,{className:"h-6 w-6"})}),c.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:Z.title}),c.jsx("p",{className:"text-gray-600 text-sm",children:Z.description})]})})},ee)})})]}),c.jsx(us,{open:D,onOpenChange:k,children:c.jsxs(hs,{className:"max-w-md",children:[c.jsxs(ps,{children:[c.jsx(ms,{children:"Sign In"}),c.jsx(Tc,{children:"Access your account with secure authentication methods"})]}),c.jsxs("div",{className:"space-y-6",children:[d==="credentials"&&c.jsx(kg,{...W,children:c.jsxs("form",{onSubmit:W.handleSubmit(L),className:"space-y-4",children:[c.jsx(_r,{control:W.control,name:"username",render:({field:Z})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Username"}),c.jsx(ur,{children:c.jsxs("div",{className:"relative",children:[c.jsx(gp,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(at,{...Z,placeholder:"Enter username",className:"pl-10","data-testid":"input-username"})]})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:W.control,name:"password",render:({field:Z})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Password"}),c.jsx(ur,{children:c.jsxs("div",{className:"relative",children:[c.jsx(G8,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(at,{...Z,type:"password",placeholder:"Enter password",className:"pl-10","data-testid":"input-password"})]})}),c.jsx(hr,{})]})}),c.jsx(we,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:G.isPending,"data-testid":"button-login",children:G.isPending?"Signing in...":"Sign In"}),c.jsx("div",{className:"text-center text-sm",children:c.jsx(we,{type:"button",variant:"link",className:"p-0 h-auto text-blue-600 hover:text-blue-700",onClick:()=>r("/forgot-password"),"data-testid":"link-forgot-password",children:"Forgot Password?"})})]})}),d==="nin"&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"National Identification Number (NIN)"}),c.jsx(at,{value:C,onChange:Z=>A(Z.target.value),placeholder:"Enter your NIN","data-testid":"input-nin",className:"mt-2"})]}),c.jsx(we,{onClick:B,className:"w-full bg-blue-600 hover:bg-blue-700",disabled:G.isPending,"data-testid":"button-nin-login",children:G.isPending?"Verifying NIN...":"Verify NIN"})]}),c.jsxs("div",{className:"relative my-2",children:[c.jsx("div",{className:"absolute inset-0 flex items-center",children:c.jsx("span",{className:"w-full border-t"})}),c.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:c.jsx("span",{className:"bg-white px-2 text-muted-foreground",children:"More options"})})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs(we,{type:"button",variant:d==="credentials"?"default":"outline",onClick:()=>p("credentials"),size:"sm","data-testid":"button-auth-credentials",children:[c.jsx(gp,{className:"h-3 w-3 mr-1"}),"Username"]}),c.jsxs(we,{type:"button",variant:d==="nin"?"default":"outline",onClick:()=>p("nin"),size:"sm","data-testid":"button-auth-nin",children:[c.jsx(G8,{className:"h-3 w-3 mr-1"}),"NIN"]}),c.jsxs(we,{type:"button",variant:d==="facial"?"default":"outline",onClick:()=>H("facial"),size:"sm","data-testid":"button-facial-recognition",children:[c.jsx(hv,{className:"h-3 w-3 mr-1"}),"Face"]}),c.jsxs(we,{type:"button",variant:d==="fingerprint"?"default":"outline",onClick:()=>H("fingerprint"),size:"sm","data-testid":"button-fingerprint",children:[c.jsx(fp,{className:"h-3 w-3 mr-1"}),"Fingerprint"]})]}),c.jsxs("div",{className:"bg-muted p-3 rounded-md space-y-2",children:[c.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Demo Credentials:"}),c.jsx("div",{className:"space-y-1 text-xs font-mono",children:c.jsx("p",{children:"doctor1 / pass123"})})]})]})]})}),c.jsx(us,{open:f,onOpenChange:E,children:c.jsxs(hs,{className:"max-w-2xl",children:[c.jsxs(ps,{children:[c.jsx(ms,{children:y==="facial"?"Facial Recognition":"Fingerprint Authentication"}),c.jsx(Tc,{children:y==="facial"?"Position your face within the frame for authentication":"Place your finger on the scanner"})]}),c.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-6",children:[y==="facial"?c.jsxs("div",{className:"relative w-full max-w-md aspect-video bg-muted rounded-lg flex items-center justify-center",children:[c.jsx(hv,{className:"h-24 w-24 text-muted-foreground"}),c.jsx("div",{className:"absolute inset-0 border-4 border-blue-600/50 rounded-lg animate-pulse"})]}):c.jsx("div",{className:"relative w-48 h-48 bg-muted rounded-full flex items-center justify-center",children:c.jsx(fp,{className:"h-32 w-32 text-muted-foreground animate-pulse"})}),c.jsxs("div",{className:"text-center space-y-2",children:[c.jsx("p",{className:"text-sm font-medium",children:"Scanning..."}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"This is a demonstration interface. Biometric hardware integration required."})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(we,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>V(y),"data-testid":"button-complete-biometric",disabled:G.isPending,children:G.isPending?"Authenticating...":"Authenticate"}),c.jsx(we,{variant:"outline",onClick:K,"data-testid":"button-cancel-biometric",children:"Cancel"})]})]})]})})]})}function vee(r){const s=I.useRef({value:r,previous:r});return I.useMemo(()=>(s.current.value!==r&&(s.current.previous=s.current.value,s.current.value=r),s.current.previous),[r])}var EOe=[" ","Enter","ArrowUp","ArrowDown"],vOe=[" ","Enter"],Jv="Select",[Uw,Vw,yOe]=XD(Jv),[jg,M1e]=Vo(Jv,[yOe,yw]),Fw=yw(),[SOe,Hu]=jg(Jv),[TOe,bOe]=jg(Jv),yee=r=>{const{__scopeSelect:s,children:o,open:d,defaultOpen:p,onOpenChange:f,value:E,defaultValue:y,onValueChange:b,dir:C,name:A,autoComplete:D,disabled:k,required:W,form:G}=r,L=Fw(s),[B,H]=I.useState(null),[V,K]=I.useState(null),[Z,ee]=I.useState(!1),$=Iw(C),[se=!1,le]=Du({prop:d,defaultProp:p,onChange:f}),[X,oe]=Du({prop:E,defaultProp:y,onChange:b}),je=I.useRef(null),Ce=B?G||!!B.closest("form"):!0,[We,he]=I.useState(new Set),rt=Array.from(We).map(De=>De.props.value).join(";");return c.jsx(UQ,{...L,children:c.jsxs(SOe,{required:W,scope:s,trigger:B,onTriggerChange:H,valueNode:V,onValueNodeChange:K,valueNodeHasChildren:Z,onValueNodeHasChildrenChange:ee,contentId:ad(),value:X,onValueChange:oe,open:se,onOpenChange:le,dir:$,triggerPointerDownPosRef:je,disabled:k,children:[c.jsx(Uw.Provider,{scope:s,children:c.jsx(TOe,{scope:r.__scopeSelect,onNativeOptionAdd:I.useCallback(De=>{he(Oe=>new Set(Oe).add(De))},[]),onNativeOptionRemove:I.useCallback(De=>{he(Oe=>{const Re=new Set(Oe);return Re.delete(De),Re})},[]),children:o})}),Ce?c.jsxs(Kee,{"aria-hidden":!0,required:W,tabIndex:-1,name:A,autoComplete:D,value:X,onChange:De=>oe(De.target.value),disabled:k,form:G,children:[X===void 0?c.jsx("option",{value:""}):null,Array.from(We)]},rt):null]})})};yee.displayName=Jv;var See="SelectTrigger",Tee=I.forwardRef((r,s)=>{const{__scopeSelect:o,disabled:d=!1,...p}=r,f=Fw(o),E=Hu(See,o),y=E.disabled||d,b=Zn(s,E.onTriggerChange),C=Vw(o),A=I.useRef("touch"),[D,k,W]=zee(L=>{const B=C().filter(K=>!K.disabled),H=B.find(K=>K.value===E.value),V=qee(B,L,H);V!==void 0&&E.onValueChange(V.value)}),G=L=>{y||(E.onOpenChange(!0),W()),L&&(E.triggerPointerDownPosRef.current={x:Math.round(L.pageX),y:Math.round(L.pageY)})};return c.jsx(VQ,{asChild:!0,...f,children:c.jsx($t.button,{type:"button",role:"combobox","aria-controls":E.contentId,"aria-expanded":E.open,"aria-required":E.required,"aria-autocomplete":"none",dir:E.dir,"data-state":E.open?"open":"closed",disabled:y,"data-disabled":y?"":void 0,"data-placeholder":Hee(E.value)?"":void 0,...p,ref:b,onClick:Vt(p.onClick,L=>{L.currentTarget.focus(),A.current!=="mouse"&&G(L)}),onPointerDown:Vt(p.onPointerDown,L=>{A.current=L.pointerType;const B=L.target;B.hasPointerCapture(L.pointerId)&&B.releasePointerCapture(L.pointerId),L.button===0&&L.ctrlKey===!1&&L.pointerType==="mouse"&&(G(L),L.preventDefault())}),onKeyDown:Vt(p.onKeyDown,L=>{const B=D.current!=="";!(L.ctrlKey||L.altKey||L.metaKey)&&L.key.length===1&&k(L.key),!(B&&L.key===" ")&&EOe.includes(L.key)&&(G(),L.preventDefault())})})})});Tee.displayName=See;var bee="SelectValue",wee=I.forwardRef((r,s)=>{const{__scopeSelect:o,className:d,style:p,children:f,placeholder:E="",...y}=r,b=Hu(bee,o),{onValueNodeHasChildrenChange:C}=b,A=f!==void 0,D=Zn(s,b.onValueNodeChange);return qs(()=>{C(A)},[C,A]),c.jsx($t.span,{...y,ref:D,style:{pointerEvents:"none"},children:Hee(b.value)?c.jsx(c.Fragment,{children:E}):f})});wee.displayName=bee;var wOe="SelectIcon",Cee=I.forwardRef((r,s)=>{const{__scopeSelect:o,children:d,...p}=r;return c.jsx($t.span,{"aria-hidden":!0,...p,ref:s,children:d||""})});Cee.displayName=wOe;var COe="SelectPortal",Ree=r=>c.jsx(pw,{asChild:!0,...r});Ree.displayName=COe;var wp="SelectContent",xee=I.forwardRef((r,s)=>{const o=Hu(wp,r.__scopeSelect),[d,p]=I.useState();if(qs(()=>{p(new DocumentFragment)},[]),!o.open){const f=d;return f?Op.createPortal(c.jsx(Nee,{scope:r.__scopeSelect,children:c.jsx(Uw.Slot,{scope:r.__scopeSelect,children:c.jsx("div",{children:r.children})})}),f):null}return c.jsx(Iee,{...r,ref:s})});xee.displayName=wp;var pc=10,[Nee,Ku]=jg(wp),ROe="SelectContentImpl",xOe=mg("SelectContent.RemoveScroll"),Iee=I.forwardRef((r,s)=>{const{__scopeSelect:o,position:d="item-aligned",onCloseAutoFocus:p,onEscapeKeyDown:f,onPointerDownOutside:E,side:y,sideOffset:b,align:C,alignOffset:A,arrowPadding:D,collisionBoundary:k,collisionPadding:W,sticky:G,hideWhenDetached:L,avoidCollisions:B,...H}=r,V=Hu(wp,o),[K,Z]=I.useState(null),[ee,$]=I.useState(null),se=Zn(s,Lt=>Z(Lt)),[le,X]=I.useState(null),[oe,je]=I.useState(null),Ce=Vw(o),[We,he]=I.useState(!1),rt=I.useRef(!1);I.useEffect(()=>{if(K)return dJ(K)},[K]),tJ();const De=I.useCallback(Lt=>{const[tr,...Ar]=Ce().map(Xn=>Xn.ref.current),[Un]=Ar.slice(-1),zn=document.activeElement;for(const Xn of Lt)if(Xn===zn||(Xn==null||Xn.scrollIntoView({block:"nearest"}),Xn===tr&&ee&&(ee.scrollTop=0),Xn===Un&&ee&&(ee.scrollTop=ee.scrollHeight),Xn==null||Xn.focus(),document.activeElement!==zn))return},[Ce,ee]),Oe=I.useCallback(()=>De([le,K]),[De,le,K]);I.useEffect(()=>{We&&Oe()},[We,Oe]);const{onOpenChange:Re,triggerPointerDownPosRef:et}=V;I.useEffect(()=>{if(K){let Lt={x:0,y:0};const tr=Un=>{var zn,Xn;Lt={x:Math.abs(Math.round(Un.pageX)-(((zn=et.current)==null?void 0:zn.x)??0)),y:Math.abs(Math.round(Un.pageY)-(((Xn=et.current)==null?void 0:Xn.y)??0))}},Ar=Un=>{Lt.x<=10&&Lt.y<=10?Un.preventDefault():K.contains(Un.target)||Re(!1),document.removeEventListener("pointermove",tr),et.current=null};return et.current!==null&&(document.addEventListener("pointermove",tr),document.addEventListener("pointerup",Ar,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",tr),document.removeEventListener("pointerup",Ar,{capture:!0})}}},[K,Re,et]),I.useEffect(()=>{const Lt=()=>Re(!1);return window.addEventListener("blur",Lt),window.addEventListener("resize",Lt),()=>{window.removeEventListener("blur",Lt),window.removeEventListener("resize",Lt)}},[Re]);const[xe,Pt]=zee(Lt=>{const tr=Ce().filter(zn=>!zn.disabled),Ar=tr.find(zn=>zn.ref.current===document.activeElement),Un=qee(tr,Lt,Ar);Un&&setTimeout(()=>Un.ref.current.focus())}),rn=I.useCallback((Lt,tr,Ar)=>{const Un=!rt.current&&!Ar;(V.value!==void 0&&V.value===tr||Un)&&(X(Lt),Un&&(rt.current=!0))},[V.value]),Gr=I.useCallback(()=>K==null?void 0:K.focus(),[K]),er=I.useCallback((Lt,tr,Ar)=>{const Un=!rt.current&&!Ar;(V.value!==void 0&&V.value===tr||Un)&&je(Lt)},[V.value]),_i=d==="popper"?FP:Aee,ns=_i===FP?{side:y,sideOffset:b,align:C,alignOffset:A,arrowPadding:D,collisionBoundary:k,collisionPadding:W,sticky:G,hideWhenDetached:L,avoidCollisions:B}:{};return c.jsx(Nee,{scope:o,content:K,viewport:ee,onViewportChange:$,itemRefCallback:rn,selectedItem:le,onItemLeave:Gr,itemTextRefCallback:er,focusSelectedItem:Oe,selectedItemText:oe,position:d,isPositioned:We,searchRef:xe,children:c.jsx(_1,{as:xOe,allowPinchZoom:!0,children:c.jsx(g1,{asChild:!0,trapped:V.open,onMountAutoFocus:Lt=>{Lt.preventDefault()},onUnmountAutoFocus:Vt(p,Lt=>{var tr;(tr=V.trigger)==null||tr.focus({preventScroll:!0}),Lt.preventDefault()}),children:c.jsx(Fv,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:f,onPointerDownOutside:E,onFocusOutside:Lt=>Lt.preventDefault(),onDismiss:()=>V.onOpenChange(!1),children:c.jsx(_i,{role:"listbox",id:V.contentId,"data-state":V.open?"open":"closed",dir:V.dir,onContextMenu:Lt=>Lt.preventDefault(),...H,...ns,onPlaced:()=>he(!0),ref:se,style:{display:"flex",flexDirection:"column",outline:"none",...H.style},onKeyDown:Vt(H.onKeyDown,Lt=>{const tr=Lt.ctrlKey||Lt.altKey||Lt.metaKey;if(Lt.key==="Tab"&&Lt.preventDefault(),!tr&&Lt.key.length===1&&Pt(Lt.key),["ArrowUp","ArrowDown","Home","End"].includes(Lt.key)){let Un=Ce().filter(zn=>!zn.disabled).map(zn=>zn.ref.current);if(["ArrowUp","End"].includes(Lt.key)&&(Un=Un.slice().reverse()),["ArrowUp","ArrowDown"].includes(Lt.key)){const zn=Lt.target,Xn=Un.indexOf(zn);Un=Un.slice(Xn+1)}setTimeout(()=>De(Un)),Lt.preventDefault()}})})})})})})});Iee.displayName=ROe;var NOe="SelectItemAlignedPosition",Aee=I.forwardRef((r,s)=>{const{__scopeSelect:o,onPlaced:d,...p}=r,f=Hu(wp,o),E=Ku(wp,o),[y,b]=I.useState(null),[C,A]=I.useState(null),D=Zn(s,se=>A(se)),k=Vw(o),W=I.useRef(!1),G=I.useRef(!0),{viewport:L,selectedItem:B,selectedItemText:H,focusSelectedItem:V}=E,K=I.useCallback(()=>{if(f.trigger&&f.valueNode&&y&&C&&L&&B&&H){const se=f.trigger.getBoundingClientRect(),le=C.getBoundingClientRect(),X=f.valueNode.getBoundingClientRect(),oe=H.getBoundingClientRect();if(f.dir!=="rtl"){const zn=oe.left-le.left,Xn=X.left-zn,Wr=se.left-Xn,Ei=se.width+Wr,Bo=Math.max(Ei,le.width),Ys=window.innerWidth-pc,io=PP(Xn,[pc,Math.max(pc,Ys-Bo)]);y.style.minWidth=Ei+"px",y.style.left=io+"px"}else{const zn=le.right-oe.right,Xn=window.innerWidth-X.right-zn,Wr=window.innerWidth-se.right-Xn,Ei=se.width+Wr,Bo=Math.max(Ei,le.width),Ys=window.innerWidth-pc,io=PP(Xn,[pc,Math.max(pc,Ys-Bo)]);y.style.minWidth=Ei+"px",y.style.right=io+"px"}const je=k(),Ce=window.innerHeight-pc*2,We=L.scrollHeight,he=window.getComputedStyle(C),rt=parseInt(he.borderTopWidth,10),De=parseInt(he.paddingTop,10),Oe=parseInt(he.borderBottomWidth,10),Re=parseInt(he.paddingBottom,10),et=rt+De+We+Re+Oe,xe=Math.min(B.offsetHeight*5,et),Pt=window.getComputedStyle(L),rn=parseInt(Pt.paddingTop,10),Gr=parseInt(Pt.paddingBottom,10),er=se.top+se.height/2-pc,_i=Ce-er,ns=B.offsetHeight/2,Lt=B.offsetTop+ns,tr=rt+De+Lt,Ar=et-tr;if(tr<=er){const zn=je.length>0&&B===je[je.length-1].ref.current;y.style.bottom="0px";const Xn=C.clientHeight-L.offsetTop-L.offsetHeight,Wr=Math.max(_i,ns+(zn?Gr:0)+Xn+Oe),Ei=tr+Wr;y.style.height=Ei+"px"}else{const zn=je.length>0&&B===je[0].ref.current;y.style.top="0px";const Wr=Math.max(er,rt+L.offsetTop+(zn?rn:0)+ns)+Ar;y.style.height=Wr+"px",L.scrollTop=tr-er+L.offsetTop}y.style.margin=`${pc}px 0`,y.style.minHeight=xe+"px",y.style.maxHeight=Ce+"px",d==null||d(),requestAnimationFrame(()=>W.current=!0)}},[k,f.trigger,f.valueNode,y,C,L,B,H,f.dir,d]);qs(()=>K(),[K]);const[Z,ee]=I.useState();qs(()=>{C&&ee(window.getComputedStyle(C).zIndex)},[C]);const $=I.useCallback(se=>{se&&G.current===!0&&(K(),V==null||V(),G.current=!1)},[K,V]);return c.jsx(AOe,{scope:o,contentWrapper:y,shouldExpandOnScrollRef:W,onScrollButtonChange:$,children:c.jsx("div",{ref:b,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Z},children:c.jsx($t.div,{...p,ref:D,style:{boxSizing:"border-box",maxHeight:"100%",...p.style}})})})});Aee.displayName=NOe;var IOe="SelectPopperPosition",FP=I.forwardRef((r,s)=>{const{__scopeSelect:o,align:d="start",collisionPadding:p=pc,...f}=r,E=Fw(o);return c.jsx(FQ,{...E,...f,ref:s,align:d,collisionPadding:p,style:{boxSizing:"border-box",...f.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});FP.displayName=IOe;var[AOe,F1]=jg(wp,{}),BP="SelectViewport",Oee=I.forwardRef((r,s)=>{const{__scopeSelect:o,nonce:d,...p}=r,f=Ku(BP,o),E=F1(BP,o),y=Zn(s,f.onViewportChange),b=I.useRef(0);return c.jsxs(c.Fragment,{children:[c.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:d}),c.jsx(Uw.Slot,{scope:o,children:c.jsx($t.div,{"data-radix-select-viewport":"",role:"presentation",...p,ref:y,style:{position:"relative",flex:1,overflow:"hidden auto",...p.style},onScroll:Vt(p.onScroll,C=>{const A=C.currentTarget,{contentWrapper:D,shouldExpandOnScrollRef:k}=E;if(k!=null&&k.current&&D){const W=Math.abs(b.current-A.scrollTop);if(W>0){const G=window.innerHeight-pc*2,L=parseFloat(D.style.minHeight),B=parseFloat(D.style.height),H=Math.max(L,B);if(H<G){const V=H+W,K=Math.min(G,V),Z=V-K;D.style.height=K+"px",D.style.bottom==="0px"&&(A.scrollTop=Z>0?Z:0,D.style.justifyContent="flex-end")}}}b.current=A.scrollTop})})})]})});Oee.displayName=BP;var Pee="SelectGroup",[OOe,POe]=jg(Pee),DOe=I.forwardRef((r,s)=>{const{__scopeSelect:o,...d}=r,p=ad();return c.jsx(OOe,{scope:o,id:p,children:c.jsx($t.div,{role:"group","aria-labelledby":p,...d,ref:s})})});DOe.displayName=Pee;var Dee="SelectLabel",kee=I.forwardRef((r,s)=>{const{__scopeSelect:o,...d}=r,p=POe(Dee,o);return c.jsx($t.div,{id:p.id,...d,ref:s})});kee.displayName=Dee;var Kb="SelectItem",[kOe,Lee]=jg(Kb),jee=I.forwardRef((r,s)=>{const{__scopeSelect:o,value:d,disabled:p=!1,textValue:f,...E}=r,y=Hu(Kb,o),b=Ku(Kb,o),C=y.value===d,[A,D]=I.useState(f??""),[k,W]=I.useState(!1),G=Zn(s,V=>{var K;return(K=b.itemRefCallback)==null?void 0:K.call(b,V,d,p)}),L=ad(),B=I.useRef("touch"),H=()=>{p||(y.onValueChange(d),y.onOpenChange(!1))};if(d==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return c.jsx(kOe,{scope:o,value:d,disabled:p,textId:L,isSelected:C,onItemTextChange:I.useCallback(V=>{D(K=>K||((V==null?void 0:V.textContent)??"").trim())},[]),children:c.jsx(Uw.ItemSlot,{scope:o,value:d,disabled:p,textValue:A,children:c.jsx($t.div,{role:"option","aria-labelledby":L,"data-highlighted":k?"":void 0,"aria-selected":C&&k,"data-state":C?"checked":"unchecked","aria-disabled":p||void 0,"data-disabled":p?"":void 0,tabIndex:p?void 0:-1,...E,ref:G,onFocus:Vt(E.onFocus,()=>W(!0)),onBlur:Vt(E.onBlur,()=>W(!1)),onClick:Vt(E.onClick,()=>{B.current!=="mouse"&&H()}),onPointerUp:Vt(E.onPointerUp,()=>{B.current==="mouse"&&H()}),onPointerDown:Vt(E.onPointerDown,V=>{B.current=V.pointerType}),onPointerMove:Vt(E.onPointerMove,V=>{var K;B.current=V.pointerType,p?(K=b.onItemLeave)==null||K.call(b):B.current==="mouse"&&V.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Vt(E.onPointerLeave,V=>{var K;V.currentTarget===document.activeElement&&((K=b.onItemLeave)==null||K.call(b))}),onKeyDown:Vt(E.onKeyDown,V=>{var Z;((Z=b.searchRef)==null?void 0:Z.current)!==""&&V.key===" "||(vOe.includes(V.key)&&H(),V.key===" "&&V.preventDefault())})})})})});jee.displayName=Kb;var DE="SelectItemText",Mee=I.forwardRef((r,s)=>{const{__scopeSelect:o,className:d,style:p,...f}=r,E=Hu(DE,o),y=Ku(DE,o),b=Lee(DE,o),C=bOe(DE,o),[A,D]=I.useState(null),k=Zn(s,H=>D(H),b.onItemTextChange,H=>{var V;return(V=y.itemTextRefCallback)==null?void 0:V.call(y,H,b.value,b.disabled)}),W=A==null?void 0:A.textContent,G=I.useMemo(()=>c.jsx("option",{value:b.value,disabled:b.disabled,children:W},b.value),[b.disabled,b.value,W]),{onNativeOptionAdd:L,onNativeOptionRemove:B}=C;return qs(()=>(L(G),()=>B(G)),[L,B,G]),c.jsxs(c.Fragment,{children:[c.jsx($t.span,{id:b.textId,...f,ref:k}),b.isSelected&&E.valueNode&&!E.valueNodeHasChildren?Op.createPortal(f.children,E.valueNode):null]})});Mee.displayName=DE;var Uee="SelectItemIndicator",Vee=I.forwardRef((r,s)=>{const{__scopeSelect:o,...d}=r;return Lee(Uee,o).isSelected?c.jsx($t.span,{"aria-hidden":!0,...d,ref:s}):null});Vee.displayName=Uee;var GP="SelectScrollUpButton",Fee=I.forwardRef((r,s)=>{const o=Ku(GP,r.__scopeSelect),d=F1(GP,r.__scopeSelect),[p,f]=I.useState(!1),E=Zn(s,d.onScrollButtonChange);return qs(()=>{if(o.viewport&&o.isPositioned){let y=function(){const C=b.scrollTop>0;f(C)};const b=o.viewport;return y(),b.addEventListener("scroll",y),()=>b.removeEventListener("scroll",y)}},[o.viewport,o.isPositioned]),p?c.jsx(Gee,{...r,ref:E,onAutoScroll:()=>{const{viewport:y,selectedItem:b}=o;y&&b&&(y.scrollTop=y.scrollTop-b.offsetHeight)}}):null});Fee.displayName=GP;var WP="SelectScrollDownButton",Bee=I.forwardRef((r,s)=>{const o=Ku(WP,r.__scopeSelect),d=F1(WP,r.__scopeSelect),[p,f]=I.useState(!1),E=Zn(s,d.onScrollButtonChange);return qs(()=>{if(o.viewport&&o.isPositioned){let y=function(){const C=b.scrollHeight-b.clientHeight,A=Math.ceil(b.scrollTop)<C;f(A)};const b=o.viewport;return y(),b.addEventListener("scroll",y),()=>b.removeEventListener("scroll",y)}},[o.viewport,o.isPositioned]),p?c.jsx(Gee,{...r,ref:E,onAutoScroll:()=>{const{viewport:y,selectedItem:b}=o;y&&b&&(y.scrollTop=y.scrollTop+b.offsetHeight)}}):null});Bee.displayName=WP;var Gee=I.forwardRef((r,s)=>{const{__scopeSelect:o,onAutoScroll:d,...p}=r,f=Ku("SelectScrollButton",o),E=I.useRef(null),y=Vw(o),b=I.useCallback(()=>{E.current!==null&&(window.clearInterval(E.current),E.current=null)},[]);return I.useEffect(()=>()=>b(),[b]),qs(()=>{var A;const C=y().find(D=>D.ref.current===document.activeElement);(A=C==null?void 0:C.ref.current)==null||A.scrollIntoView({block:"nearest"})},[y]),c.jsx($t.div,{"aria-hidden":!0,...p,ref:s,style:{flexShrink:0,...p.style},onPointerDown:Vt(p.onPointerDown,()=>{E.current===null&&(E.current=window.setInterval(d,50))}),onPointerMove:Vt(p.onPointerMove,()=>{var C;(C=f.onItemLeave)==null||C.call(f),E.current===null&&(E.current=window.setInterval(d,50))}),onPointerLeave:Vt(p.onPointerLeave,()=>{b()})})}),LOe="SelectSeparator",Wee=I.forwardRef((r,s)=>{const{__scopeSelect:o,...d}=r;return c.jsx($t.div,{"aria-hidden":!0,...d,ref:s})});Wee.displayName=LOe;var HP="SelectArrow",jOe=I.forwardRef((r,s)=>{const{__scopeSelect:o,...d}=r,p=Fw(o),f=Hu(HP,o),E=Ku(HP,o);return f.open&&E.position==="popper"?c.jsx(BQ,{...p,...d,ref:s}):null});jOe.displayName=HP;function Hee(r){return r===""||r===void 0}var Kee=I.forwardRef((r,s)=>{const{value:o,...d}=r,p=I.useRef(null),f=Zn(s,p),E=vee(o);return I.useEffect(()=>{const y=p.current,b=window.HTMLSelectElement.prototype,A=Object.getOwnPropertyDescriptor(b,"value").set;if(E!==o&&A){const D=new Event("change",{bubbles:!0});A.call(y,o),y.dispatchEvent(D)}},[E,o]),c.jsx(Bv,{asChild:!0,children:c.jsx("select",{...d,ref:f,defaultValue:o})})});Kee.displayName="BubbleSelect";function zee(r){const s=Ps(r),o=I.useRef(""),d=I.useRef(0),p=I.useCallback(E=>{const y=o.current+E;s(y),function b(C){o.current=C,window.clearTimeout(d.current),C!==""&&(d.current=window.setTimeout(()=>b(""),1e3))}(y)},[s]),f=I.useCallback(()=>{o.current="",window.clearTimeout(d.current)},[]);return I.useEffect(()=>()=>window.clearTimeout(d.current),[]),[o,p,f]}function qee(r,s,o){const p=s.length>1&&Array.from(s).every(C=>C===s[0])?s[0]:s,f=o?r.indexOf(o):-1;let E=MOe(r,Math.max(f,0));p.length===1&&(E=E.filter(C=>C!==o));const b=E.find(C=>C.textValue.toLowerCase().startsWith(p.toLowerCase()));return b!==o?b:void 0}function MOe(r,s){return r.map((o,d)=>r[(s+d)%r.length])}var UOe=yee,Yee=Tee,VOe=wee,FOe=Cee,BOe=Ree,Xee=xee,GOe=Oee,Qee=kee,Jee=jee,WOe=Mee,HOe=Vee,$ee=Fee,Zee=Bee,ete=Wee;const Wn=UOe,Hn=VOe,jn=I.forwardRef(({className:r,children:s,...o},d)=>c.jsxs(Yee,{ref:d,className:ct("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...o,children:[s,c.jsx(FOe,{asChild:!0,children:c.jsx($X,{className:"h-4 w-4 opacity-50"})})]}));jn.displayName=Yee.displayName;const tte=I.forwardRef(({className:r,...s},o)=>c.jsx($ee,{ref:o,className:ct("flex cursor-default items-center justify-center py-1",r),...s,children:c.jsx(rwe,{className:"h-4 w-4"})}));tte.displayName=$ee.displayName;const nte=I.forwardRef(({className:r,...s},o)=>c.jsx(Zee,{ref:o,className:ct("flex cursor-default items-center justify-center py-1",r),...s,children:c.jsx($X,{className:"h-4 w-4"})}));nte.displayName=Zee.displayName;const Mn=I.forwardRef(({className:r,children:s,position:o="popper",...d},p)=>c.jsx(BOe,{children:c.jsxs(Xee,{ref:p,className:ct("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",o==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:o,...d,children:[c.jsx(tte,{}),c.jsx(GOe,{className:ct("p-1",o==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),c.jsx(nte,{})]})}));Mn.displayName=Xee.displayName;const KOe=I.forwardRef(({className:r,...s},o)=>c.jsx(Qee,{ref:o,className:ct("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s}));KOe.displayName=Qee.displayName;const ke=I.forwardRef(({className:r,children:s,...o},d)=>c.jsxs(Jee,{ref:d,className:ct("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...o,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(HOe,{children:c.jsx(bP,{className:"h-4 w-4"})})}),c.jsx(WOe,{children:s})]}));ke.displayName=Jee.displayName;const zOe=I.forwardRef(({className:r,...s},o)=>c.jsx(ete,{ref:o,className:ct("-mx-1 my-1 h-px bg-muted",r),...s}));zOe.displayName=ete.displayName;const qOe=ni({username:kt().min(3,"Username must be at least 3 characters"),password:kt().min(6,"Password must be at least 6 characters"),confirmPassword:kt().min(6,"Password confirmation required"),fullName:kt().min(2,"Full name is required"),role:od(["patient","doctor","nurse","admin"],{errorMap:()=>({message:"Please select a role"})}),departmentId:kt().optional()}).refine(r=>r.password===r.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function YOe(){const[,r]=so(),{toast:s}=jr(),[o,d]=I.useState("patient"),{data:p=[]}=In({queryKey:["/api/departments"],queryFn:async()=>(await Ot("GET","/api/departments")).json()}),f=Pg({resolver:Dg(qOe),defaultValues:{username:"",password:"",confirmPassword:"",fullName:"",role:"patient",departmentId:""}}),E=Lr({mutationFn:async b=>await(await Ot("POST","/api/auth/register",{username:b.username,password:b.password,fullName:b.fullName,role:b.role,departmentId:b.departmentId||null})).json(),onSuccess:()=>{s({title:"Registration Successful",description:"Your account has been created. You can now sign in."}),r("/")},onError:b=>{s({title:"Registration Failed",description:b.message,variant:"destructive"})}}),y=b=>{E.mutate(b)};return c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 via-blue-50 to-white flex items-center justify-center px-4 py-8",children:c.jsxs(_e,{className:"w-full max-w-md",children:[c.jsxs(Ke,{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(we,{variant:"ghost",size:"icon",onClick:()=>r("/"),"data-testid":"button-back",children:c.jsx(xg,{className:"h-4 w-4"})}),c.jsx("img",{src:vp,alt:"DDA Logo",className:"h-10 w-10 object-contain","data-testid":"img-register-logo"})]}),c.jsx(ze,{className:"text-2xl",children:"Create Account"}),c.jsx(Cn,{children:"Register as a patient, doctor, nurse, or administrator to get started"})]}),c.jsx(Te,{children:c.jsx(kg,{...f,children:c.jsxs("form",{onSubmit:f.handleSubmit(y),className:"space-y-4",children:[c.jsx(_r,{control:f.control,name:"fullName",render:({field:b})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Full Name"}),c.jsx(ur,{children:c.jsx(at,{...b,placeholder:"Dr. John Doe","data-testid":"input-full-name"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:f.control,name:"role",render:({field:b})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Role"}),c.jsxs(Wn,{onValueChange:C=>{b.onChange(C),d(C)},defaultValue:b.value,children:[c.jsx(ur,{children:c.jsx(jn,{"data-testid":"select-role",children:c.jsx(Hn,{})})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"patient",children:"Patient"}),c.jsx(ke,{value:"doctor",children:"Doctor"}),c.jsx(ke,{value:"nurse",children:"Nurse"}),c.jsx(ke,{value:"admin",children:"Administrator"})]})]}),c.jsx(hr,{})]})}),(o==="doctor"||o==="nurse")&&c.jsx(_r,{control:f.control,name:"departmentId",render:({field:b})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Department"}),c.jsxs(Wn,{onValueChange:b.onChange,defaultValue:b.value,children:[c.jsx(ur,{children:c.jsx(jn,{"data-testid":"select-department",children:c.jsx(Hn,{placeholder:"Select a department"})})}),c.jsx(Mn,{children:p.map(C=>c.jsx(ke,{value:C.id,children:C.name},C.id))})]}),c.jsx(hr,{})]})}),c.jsx(_r,{control:f.control,name:"username",render:({field:b})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Username"}),c.jsx(ur,{children:c.jsx(at,{...b,placeholder:"johndoe","data-testid":"input-register-username"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:f.control,name:"password",render:({field:b})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Password"}),c.jsx(ur,{children:c.jsx(at,{...b,type:"password",placeholder:"","data-testid":"input-register-password"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:f.control,name:"confirmPassword",render:({field:b})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Confirm Password"}),c.jsx(ur,{children:c.jsx(at,{...b,type:"password",placeholder:"","data-testid":"input-confirm-password"})}),c.jsx(hr,{})]})}),c.jsx(we,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:E.isPending,"data-testid":"button-register",children:E.isPending?"Creating Account...":"Create Account"}),c.jsxs("div",{className:"text-center text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Already have an account? "}),c.jsx(we,{type:"button",variant:"link",className:"p-0 h-auto text-blue-600 hover:text-blue-700",onClick:()=>r("/"),"data-testid":"link-sign-in",children:"Sign In"})]})]})})})]})})}const XOe=ni({username:kt().min(1,"Username is required")});function QOe(){const[,r]=so(),{toast:s}=jr(),[o,d]=I.useState(!1),p=Pg({resolver:Dg(XOe),defaultValues:{username:""}}),f=Lr({mutationFn:async y=>await(await Ot("POST","/api/auth/forgot-password",y)).json(),onSuccess:y=>{d(!0),s({title:"Reset Email Sent",description:y.message||"Check your email for password reset instructions"}),setTimeout(()=>r("/"),5e3)},onError:y=>{s({title:"Request Failed",description:y.message||"Could not process password reset request",variant:"destructive"})}}),E=y=>{f.mutate(y)};return o?c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 via-blue-50 to-white flex items-center justify-center px-4 py-8",children:c.jsxs(_e,{className:"w-full max-w-md",children:[c.jsxs(Ke,{className:"space-y-2",children:[c.jsx("img",{src:vp,alt:"DDA Logo",className:"h-10 w-10 object-contain mb-4","data-testid":"img-forgot-email-logo"}),c.jsx(ze,{className:"text-2xl",children:"Check Your Email"}),c.jsx(Cn,{children:"A password reset link has been sent to your registered email address. Click the link to reset your password."})]}),c.jsxs(Te,{className:"space-y-4",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirecting you to login in 5 seconds..."}),c.jsx(we,{className:"w-full",onClick:()=>r("/"),"data-testid":"button-back-to-login",children:"Back to Login"})]})]})}):c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 via-blue-50 to-white flex items-center justify-center px-4 py-8",children:c.jsxs(_e,{className:"w-full max-w-md",children:[c.jsxs(Ke,{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(we,{variant:"ghost",size:"icon",onClick:()=>r("/"),"data-testid":"button-back",children:c.jsx(xg,{className:"h-4 w-4"})}),c.jsx("img",{src:vp,alt:"DDA Logo",className:"h-10 w-10 object-contain","data-testid":"img-forgot-logo"})]}),c.jsx(ze,{className:"text-2xl",children:"Forgot Password"}),c.jsx(Cn,{children:"Enter your username to receive a password reset link"})]}),c.jsx(Te,{children:c.jsx(kg,{...p,children:c.jsxs("form",{onSubmit:p.handleSubmit(E),className:"space-y-4",children:[c.jsx(_r,{control:p.control,name:"username",render:({field:y})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Username"}),c.jsx(ur,{children:c.jsx(at,{...y,placeholder:"Enter your username","data-testid":"input-forgot-password-username"})}),c.jsx(hr,{})]})}),c.jsx(we,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:f.isPending,"data-testid":"button-reset-password",children:f.isPending?"Sending Reset Link...":"Send Reset Link"}),c.jsx(we,{type:"button",variant:"outline",className:"w-full",onClick:()=>r("/"),"data-testid":"button-cancel-forgot",children:"Back to Login"})]})})})]})})}const JOe=ni({newPassword:kt().min(6,"Password must be at least 6 characters"),confirmPassword:kt().min(6,"Password confirmation required")}).refine(r=>r.newPassword===r.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function $Oe(){const[,r]=so(),o=new URLSearchParams(STe()).get("token"),{toast:d}=jr(),[p,f]=I.useState(!1),E=Pg({resolver:Dg(JOe),defaultValues:{newPassword:"",confirmPassword:""}}),y=Lr({mutationFn:async C=>{if(!o)throw new Error("Invalid reset link");return await(await Ot("POST","/api/auth/reset-password",{token:o,newPassword:C.newPassword})).json()},onSuccess:()=>{f(!0),d({title:"Password Reset Successful",description:"You can now login with your new password"}),setTimeout(()=>r("/"),3e3)},onError:C=>{d({title:"Reset Failed",description:C.message||"Could not reset password",variant:"destructive"})}}),b=C=>{y.mutate(C)};return o?p?c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 via-blue-50 to-white flex items-center justify-center px-4 py-8",children:c.jsxs(_e,{className:"w-full max-w-md",children:[c.jsxs(Ke,{className:"space-y-2",children:[c.jsx("img",{src:vp,alt:"DDA Logo",className:"h-10 w-10 object-contain mb-4","data-testid":"img-reset-success-logo"}),c.jsx(ze,{className:"text-2xl",children:"Password Reset Successful"}),c.jsx(Cn,{children:"Your password has been reset. Redirecting to login..."})]}),c.jsx(Te,{children:c.jsx(we,{className:"w-full",onClick:()=>r("/"),"data-testid":"button-login-now",children:"Go to Login"})})]})}):c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 via-blue-50 to-white flex items-center justify-center px-4 py-8",children:c.jsxs(_e,{className:"w-full max-w-md",children:[c.jsxs(Ke,{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[c.jsx(we,{variant:"ghost",size:"icon",onClick:()=>r("/"),"data-testid":"button-back",children:c.jsx(xg,{className:"h-4 w-4"})}),c.jsx("img",{src:vp,alt:"DDA Logo",className:"h-10 w-10 object-contain","data-testid":"img-reset-logo"})]}),c.jsx(ze,{className:"text-2xl",children:"Reset Password"}),c.jsx(Cn,{children:"Enter your new password"})]}),c.jsx(Te,{children:c.jsx(kg,{...E,children:c.jsxs("form",{onSubmit:E.handleSubmit(b),className:"space-y-4",children:[c.jsx(_r,{control:E.control,name:"newPassword",render:({field:C})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"New Password"}),c.jsx(ur,{children:c.jsx(at,{...C,type:"password",placeholder:"","data-testid":"input-new-password"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:E.control,name:"confirmPassword",render:({field:C})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Confirm Password"}),c.jsx(ur,{children:c.jsx(at,{...C,type:"password",placeholder:"","data-testid":"input-confirm-new-password"})}),c.jsx(hr,{})]})}),c.jsx(we,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:y.isPending,"data-testid":"button-confirm-reset",children:y.isPending?"Resetting Password...":"Reset Password"})]})})})]})}):c.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 via-blue-50 to-white flex items-center justify-center px-4 py-8",children:c.jsxs(_e,{className:"w-full max-w-md",children:[c.jsxs(Ke,{children:[c.jsx(ze,{className:"text-2xl",children:"Invalid Reset Link"}),c.jsx(Cn,{children:"The password reset link is invalid or has expired"})]}),c.jsx(Te,{children:c.jsx(we,{className:"w-full",onClick:()=>r("/forgot-password"),"data-testid":"button-request-new-link",children:"Request New Reset Link"})})]})})}var dO="rovingFocusGroup.onEntryFocus",ZOe={bubbles:!1,cancelable:!0},Bw="RovingFocusGroup",[KP,rte,ePe]=XD(Bw),[tPe,ste]=Vo(Bw,[ePe]),[nPe,rPe]=tPe(Bw),ite=I.forwardRef((r,s)=>c.jsx(KP.Provider,{scope:r.__scopeRovingFocusGroup,children:c.jsx(KP.Slot,{scope:r.__scopeRovingFocusGroup,children:c.jsx(sPe,{...r,ref:s})})}));ite.displayName=Bw;var sPe=I.forwardRef((r,s)=>{const{__scopeRovingFocusGroup:o,orientation:d,loop:p=!1,dir:f,currentTabStopId:E,defaultCurrentTabStopId:y,onCurrentTabStopIdChange:b,onEntryFocus:C,preventScrollOnEntryFocus:A=!1,...D}=r,k=I.useRef(null),W=Zn(s,k),G=Iw(f),[L=null,B]=Du({prop:E,defaultProp:y,onChange:b}),[H,V]=I.useState(!1),K=Ps(C),Z=rte(o),ee=I.useRef(!1),[$,se]=I.useState(0);return I.useEffect(()=>{const le=k.current;if(le)return le.addEventListener(dO,K),()=>le.removeEventListener(dO,K)},[K]),c.jsx(nPe,{scope:o,orientation:d,dir:G,loop:p,currentTabStopId:L,onItemFocus:I.useCallback(le=>B(le),[B]),onItemShiftTab:I.useCallback(()=>V(!0),[]),onFocusableItemAdd:I.useCallback(()=>se(le=>le+1),[]),onFocusableItemRemove:I.useCallback(()=>se(le=>le-1),[]),children:c.jsx($t.div,{tabIndex:H||$===0?-1:0,"data-orientation":d,...D,ref:W,style:{outline:"none",...r.style},onMouseDown:Vt(r.onMouseDown,()=>{ee.current=!0}),onFocus:Vt(r.onFocus,le=>{const X=!ee.current;if(le.target===le.currentTarget&&X&&!H){const oe=new CustomEvent(dO,ZOe);if(le.currentTarget.dispatchEvent(oe),!oe.defaultPrevented){const je=Z().filter(De=>De.focusable),Ce=je.find(De=>De.active),We=je.find(De=>De.id===L),rt=[Ce,We,...je].filter(Boolean).map(De=>De.ref.current);cte(rt,A)}}ee.current=!1}),onBlur:Vt(r.onBlur,()=>V(!1))})})}),ate="RovingFocusGroupItem",ote=I.forwardRef((r,s)=>{const{__scopeRovingFocusGroup:o,focusable:d=!0,active:p=!1,tabStopId:f,...E}=r,y=ad(),b=f||y,C=rPe(ate,o),A=C.currentTabStopId===b,D=rte(o),{onFocusableItemAdd:k,onFocusableItemRemove:W}=C;return I.useEffect(()=>{if(d)return k(),()=>W()},[d,k,W]),c.jsx(KP.ItemSlot,{scope:o,id:b,focusable:d,active:p,children:c.jsx($t.span,{tabIndex:A?0:-1,"data-orientation":C.orientation,...E,ref:s,onMouseDown:Vt(r.onMouseDown,G=>{d?C.onItemFocus(b):G.preventDefault()}),onFocus:Vt(r.onFocus,()=>C.onItemFocus(b)),onKeyDown:Vt(r.onKeyDown,G=>{if(G.key==="Tab"&&G.shiftKey){C.onItemShiftTab();return}if(G.target!==G.currentTarget)return;const L=oPe(G,C.orientation,C.dir);if(L!==void 0){if(G.metaKey||G.ctrlKey||G.altKey||G.shiftKey)return;G.preventDefault();let H=D().filter(V=>V.focusable).map(V=>V.ref.current);if(L==="last")H.reverse();else if(L==="prev"||L==="next"){L==="prev"&&H.reverse();const V=H.indexOf(G.currentTarget);H=C.loop?cPe(H,V+1):H.slice(V+1)}setTimeout(()=>cte(H))}})})})});ote.displayName=ate;var iPe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function aPe(r,s){return s!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function oPe(r,s,o){const d=aPe(r.key,o);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(d))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(d)))return iPe[d]}function cte(r,s=!1){const o=document.activeElement;for(const d of r)if(d===o||(d.focus({preventScroll:s}),document.activeElement!==o))return}function cPe(r,s){return r.map((o,d)=>r[(s+d)%r.length])}var lPe=ite,dPe=ote,B1="Tabs",[uPe,U1e]=Vo(B1,[ste]),lte=ste(),[hPe,G1]=uPe(B1),dte=I.forwardRef((r,s)=>{const{__scopeTabs:o,value:d,onValueChange:p,defaultValue:f,orientation:E="horizontal",dir:y,activationMode:b="automatic",...C}=r,A=Iw(y),[D,k]=Du({prop:d,onChange:p,defaultProp:f});return c.jsx(hPe,{scope:o,baseId:ad(),value:D,onValueChange:k,orientation:E,dir:A,activationMode:b,children:c.jsx($t.div,{dir:A,"data-orientation":E,...C,ref:s})})});dte.displayName=B1;var ute="TabsList",hte=I.forwardRef((r,s)=>{const{__scopeTabs:o,loop:d=!0,...p}=r,f=G1(ute,o),E=lte(o);return c.jsx(lPe,{asChild:!0,...E,orientation:f.orientation,dir:f.dir,loop:d,children:c.jsx($t.div,{role:"tablist","aria-orientation":f.orientation,...p,ref:s})})});hte.displayName=ute;var pte="TabsTrigger",mte=I.forwardRef((r,s)=>{const{__scopeTabs:o,value:d,disabled:p=!1,...f}=r,E=G1(pte,o),y=lte(o),b=_te(E.baseId,d),C=Ete(E.baseId,d),A=d===E.value;return c.jsx(dPe,{asChild:!0,...y,focusable:!p,active:A,children:c.jsx($t.button,{type:"button",role:"tab","aria-selected":A,"aria-controls":C,"data-state":A?"active":"inactive","data-disabled":p?"":void 0,disabled:p,id:b,...f,ref:s,onMouseDown:Vt(r.onMouseDown,D=>{!p&&D.button===0&&D.ctrlKey===!1?E.onValueChange(d):D.preventDefault()}),onKeyDown:Vt(r.onKeyDown,D=>{[" ","Enter"].includes(D.key)&&E.onValueChange(d)}),onFocus:Vt(r.onFocus,()=>{const D=E.activationMode!=="manual";!A&&!p&&D&&E.onValueChange(d)})})})});mte.displayName=pte;var fte="TabsContent",gte=I.forwardRef((r,s)=>{const{__scopeTabs:o,value:d,forceMount:p,children:f,...E}=r,y=G1(fte,o),b=_te(y.baseId,d),C=Ete(y.baseId,d),A=d===y.value,D=I.useRef(A);return I.useEffect(()=>{const k=requestAnimationFrame(()=>D.current=!1);return()=>cancelAnimationFrame(k)},[]),c.jsx(Dc,{present:p||A,children:({present:k})=>c.jsx($t.div,{"data-state":A?"active":"inactive","data-orientation":y.orientation,role:"tabpanel","aria-labelledby":b,hidden:!k,id:C,tabIndex:0,...E,ref:s,style:{...r.style,animationDuration:D.current?"0s":void 0},children:k&&f})})});gte.displayName=fte;function _te(r,s){return`${r}-trigger-${s}`}function Ete(r,s){return`${r}-content-${s}`}var pPe=dte,vte=hte,yte=mte,Ste=gte;const Al=pPe,Lc=I.forwardRef(({className:r,...s},o)=>c.jsx(vte,{ref:o,className:ct("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s}));Lc.displayName=vte.displayName;const kn=I.forwardRef(({className:r,...s},o)=>c.jsx(yte,{ref:o,className:ct("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s}));kn.displayName=yte.displayName;const Ln=I.forwardRef(({className:r,...s},o)=>c.jsx(Ste,{ref:o,className:ct("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s}));Ln.displayName=Ste.displayName;function mPe(){const[,r]=so(),{user:s,logout:o}=ts(),{toast:d}=jr(),[p,f]=I.useState(""),[E,y]=I.useState("general"),[b,C]=I.useState(null),[A,D]=I.useState(!1),[k,W]=I.useState("all"),{data:G,isLoading:L}=In({queryKey:["/api/patients",(s==null?void 0:s.role)==="doctor"?s==null?void 0:s.id:null],queryFn:async()=>{const X=(s==null?void 0:s.role)==="doctor"?`/api/patients?doctor_id=${s.id}`:"/api/patients";return(await Ot("GET",X)).json()}}),B=Lr({mutationFn:async X=>await(await Ot("POST","/api/patients/search",{query:X,searchType:E})).json(),onSuccess:X=>{X.length===0?(d({title:"No Results",description:"Patient not found with the provided information."}),C(null)):X.length===1?(C(X[0]),D(!0)):C(null)},onError:X=>{d({title:"Search Error",description:X.message,variant:"destructive"})}}),H=In({queryKey:["/api/patients",b==null?void 0:b.id,"health-analysis"],queryFn:async()=>await(await Ot("GET",`/api/patients/${b==null?void 0:b.id}/health-analysis`)).json(),enabled:!!(b!=null&&b.id)}),V=()=>{if(!p.trim()){d({title:"Empty Search",description:"Please enter a search query.",variant:"destructive"});return}B.mutate(p)},K=()=>{f(""),C(null),D(!1)},Z=()=>{o(),r("/")},ee=X=>{switch(X){case"CRITICAL":return"bg-red-100 text-red-900";case"HIGH":return"bg-orange-100 text-orange-900";case"MODERATE":return"bg-yellow-100 text-yellow-900";case"LOW":return"bg-green-100 text-green-900";default:return"bg-gray-100 text-gray-900"}},$=X=>{const oe=new Date,je=X.createdAt?new Date(X.createdAt):new Date,Ce=Math.floor((oe.getTime()-je.getTime())/(1e3*60*60*24)),We=Ce<=1,he=Ce<=7,rt=X.bloodPressureSystolic&&X.bloodPressureSystolic>160||X.heartRate&&X.heartRate>120,De=!rt&&X.temperature&&parseFloat(X.temperature)<37.5,Oe=X.phoneNumber&&X.phoneNumber.length>0,Re=X.age&&X.age>60&&De;return{isNew:We,isLastVisit:he,isCritical:rt,isLowRisk:De,isBooked:Oe,isDischarged:Re,isDeath:!1}},se=(G||[]).filter(X=>{if(k==="all")return!0;const oe=$(X);switch(k){case"new":return oe.isNew;case"last-visit":return oe.isLastVisit;case"critical":return oe.isCritical;case"low-risk":return oe.isLowRisk;case"booked":return oe.isBooked;case"discharged":return oe.isDischarged;case"death":return oe.isDeath;default:return!0}}),le={new:(G||[]).filter(X=>$(X).isNew).length,lastVisit:(G||[]).filter(X=>$(X).isLastVisit).length,critical:(G||[]).filter(X=>$(X).isCritical).length,lowRisk:(G||[]).filter(X=>$(X).isLowRisk).length,booked:(G||[]).filter(X=>$(X).isBooked).length,discharged:(G||[]).filter(X=>$(X).isDischarged).length,death:(G||[]).filter(X=>$(X).isDeath).length};return(s==null?void 0:s.role)==="patient"?c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"My Health Dashboard"}),c.jsxs("p",{className:"text-muted-foreground",children:["Welcome, ",s==null?void 0:s.fullName]})]}),c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"My Appointments"}),c.jsx(Cn,{children:"View and manage your appointments"})]}),c.jsx(Te,{children:c.jsx(we,{onClick:()=>r("/appointments"),className:"w-full",children:"View Appointments"})})]}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"My Health Records"}),c.jsx(Cn,{children:"Access your medical history and vitals"})]}),c.jsx(Te,{children:c.jsx(we,{onClick:()=>r("/patients/"+(s==null?void 0:s.id)),variant:"outline",className:"w-full",children:"View Records"})})]}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Billing & Subscriptions"}),c.jsx(Cn,{children:"Manage your billing information"})]}),c.jsx(Te,{children:c.jsx(we,{onClick:()=>r("/billing"),variant:"outline",className:"w-full",children:"View Billing"})})]})]})]}):c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white px-6 py-6",children:c.jsxs("div",{className:"max-w-7xl mx-auto",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[c.jsx("div",{className:"h-10 w-10 bg-white/20 rounded-lg flex items-center justify-center",children:c.jsx("span",{className:"text-lg font-bold",children:""})}),c.jsx("h1",{className:"text-3xl font-bold",children:"Doctor's Assistant"})]}),c.jsxs("p",{className:"text-blue-100",children:["Welcome, ",s==null?void 0:s.fullName,"  AI & CDS tools at your fingertips"]})]})}),c.jsx("div",{className:"bg-white border-b px-6 py-4",children:c.jsxs("div",{className:"max-w-7xl mx-auto flex gap-3 flex-wrap",children:[c.jsxs(we,{onClick:()=>r("/patients/new"),className:"bg-blue-600 hover:bg-blue-700 text-white","data-testid":"button-add-patient",children:[c.jsx(wl,{className:"h-4 w-4 mr-2"}),"Add New Patient"]}),c.jsxs(we,{variant:"outline",className:"border-blue-600 text-blue-600 hover:bg-blue-50","data-testid":"button-fingerprint-verify",children:[c.jsx(fp,{className:"h-4 w-4 mr-2"}),"ID Fingerprint Verification"]}),c.jsxs(we,{onClick:Z,variant:"destructive","data-testid":"button-logout",children:[c.jsx(ZX,{className:"h-4 w-4 mr-2"}),"Logout"]})]})}),c.jsx("div",{className:"px-6 py-8",children:c.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[c.jsx(fPe,{userId:s==null?void 0:s.id}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Uo,{className:"h-5 w-5 text-gray-600"}),c.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Search Patient"})]}),c.jsx(_e,{className:"p-6 bg-white",children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsx(we,{size:"sm",variant:E==="general"?"default":"outline",onClick:()=>y("general"),"data-testid":"button-search-type-general",children:"Name/NIN"}),c.jsx(we,{size:"sm",variant:E==="nin"?"default":"outline",onClick:()=>y("nin"),"data-testid":"button-search-type-nin",children:"NIN"}),c.jsx(we,{size:"sm",variant:E==="fingerprint"?"default":"outline",onClick:()=>y("fingerprint"),"data-testid":"button-search-type-fingerprint",children:"Fingerprint"})]}),c.jsxs("div",{className:"flex gap-3 flex-wrap items-center",children:[c.jsx(at,{placeholder:E==="general"?"Search by name or NIN (e.g. NIN123 or John Doe)":`Enter ${E} data`,value:p,onChange:X=>f(X.target.value),onKeyDown:X=>X.key==="Enter"&&V(),className:"max-w-sm","data-testid":"input-patient-search"}),c.jsx(we,{onClick:V,disabled:B.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white","data-testid":"button-search",children:B.isPending?"Searching...":"Search"}),c.jsx(we,{onClick:K,variant:"outline","data-testid":"button-clear",children:"Clear"}),c.jsx("span",{className:"text-sm text-gray-600",children:"Tip: you can enter full or partial NIN or name."})]})]})})]}),A&&b&&c.jsxs("div",{className:"space-y-4",children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Clinical Decision Support (CDS)"}),H.isLoading?c.jsxs("div",{className:"space-y-3",children:[c.jsx(yl,{className:"h-40 w-full"}),c.jsx(yl,{className:"h-40 w-full"})]}):H.data?c.jsxs(Al,{defaultValue:"overview",className:"w-full",children:[c.jsxs(Lc,{className:"grid w-full grid-cols-4",children:[c.jsx(kn,{value:"overview",children:"Overview"}),c.jsx(kn,{value:"diagnosis",children:"Diagnosis"}),c.jsx(kn,{value:"prescription",children:"Prescriptions"}),c.jsx(kn,{value:"recommendations",children:"Recommendations"})]}),c.jsxs(Ln,{value:"overview",className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Patient Information"})}),c.jsxs(Te,{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-gray-600",children:"Name"}),c.jsxs("p",{className:"font-semibold",children:[b.firstName," ",b.lastName]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-gray-600",children:"Age"}),c.jsxs("p",{className:"font-semibold",children:[b.age," years"]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-gray-600",children:"Blood Group"}),c.jsx("p",{className:"font-semibold",children:b.bloodGroup})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm text-gray-600",children:"Genotype"}),c.jsx("p",{className:"font-semibold",children:b.genotype})]})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Health Risk Assessment"})}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:`text-5xl font-bold mb-2 ${H.data.riskLevel==="CRITICAL"?"text-red-600":H.data.riskLevel==="HIGH"?"text-orange-600":H.data.riskLevel==="MODERATE"?"text-yellow-600":"text-green-600"}`,children:H.data.healthRiskScore}),c.jsxs(xt,{className:`${ee(H.data.riskLevel)}`,children:[H.data.riskLevel," RISK"]})]}),H.data.riskFactors.length>0&&c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold mb-2",children:"Risk Factors:"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:H.data.riskFactors.map(X=>c.jsx(xt,{variant:"outline",children:X},X))})]})]})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Vital Signs Analysis"})}),c.jsxs(Te,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Blood Pressure"}),c.jsx("p",{className:"text-sm text-gray-700",children:H.data.analysisDetails.bpAnalysis})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Heart Rate"}),c.jsx("p",{className:"text-sm text-gray-700",children:H.data.analysisDetails.heartRateAnalysis})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Temperature"}),c.jsx("p",{className:"text-sm text-gray-700",children:H.data.analysisDetails.temperatureAnalysis})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Weight"}),c.jsx("p",{className:"text-sm text-gray-700",children:H.data.analysisDetails.weightAnalysis})]})]})]})]}),c.jsx(Ln,{value:"diagnosis",className:"space-y-4",children:H.data.suggestedDiagnosis.length>0?c.jsx("div",{className:"space-y-3",children:H.data.suggestedDiagnosis.map((X,oe)=>c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{children:[c.jsx(ze,{className:"flex items-center gap-2",children:X.condition}),c.jsxs(Cn,{children:["Confidence: ",(X.confidence*100).toFixed(0),"%"]})]}),c.jsx(xt,{variant:X.severity==="severe"?"destructive":X.severity==="moderate"?"default":"secondary",children:X.severity.toUpperCase()})]})}),c.jsx(Te,{children:c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold mb-2",children:"Symptoms:"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:X.symptoms.map(je=>c.jsx(xt,{variant:"outline",children:je},je))})]})})]},oe))}):c.jsx(_e,{children:c.jsx(Te,{className:"py-8 text-center text-gray-600",children:"No diagnoses suggested based on current vitals."})})}),c.jsx(Ln,{value:"prescription",className:"space-y-4",children:H.data.prescribedDrugs.length>0?c.jsx("div",{className:"space-y-3",children:H.data.prescribedDrugs.map((X,oe)=>c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(pv,{className:"h-4 w-4"}),X.drugName]}),c.jsx(Cn,{children:X.indication})]})})}),c.jsxs(Te,{className:"space-y-3",children:[c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-gray-600",children:"Dosage"}),c.jsx("p",{className:"font-semibold text-sm",children:X.dosage})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-gray-600",children:"Frequency"}),c.jsx("p",{className:"font-semibold text-sm",children:X.frequency})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-gray-600",children:"Duration"}),c.jsx("p",{className:"font-semibold text-sm",children:X.duration})]})]}),X.contraindications.length>0&&c.jsxs("div",{children:[c.jsxs("p",{className:"text-sm font-semibold text-red-600 flex items-center gap-2",children:[c.jsx(id,{className:"h-4 w-4"}),"Contraindications:"]}),c.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:X.contraindications.map(je=>c.jsx(xt,{variant:"destructive",children:je},je))})]}),X.sideEffects.length>0&&c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold text-orange-600",children:"Side Effects:"}),c.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:X.sideEffects.map(je=>c.jsx(xt,{variant:"outline",children:je},je))})]})]})]},oe))}):c.jsx(_e,{children:c.jsx(Te,{className:"py-8 text-center text-gray-600",children:"No prescriptions recommended at this time."})})}),c.jsx(Ln,{value:"recommendations",className:"space-y-4",children:H.data.recommendations.length>0?c.jsx("div",{className:"space-y-3",children:H.data.recommendations.map((X,oe)=>c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(Tl,{className:"h-4 w-4"}),X.category]}),c.jsx(Cn,{children:X.recommendation})]}),c.jsx(xt,{variant:X.priority==="high"?"destructive":X.priority==="medium"?"default":"secondary",children:X.priority.toUpperCase()})]})}),c.jsx(Te,{children:c.jsxs("p",{className:"text-sm bg-gray-50 p-3 rounded",children:[c.jsx("span",{className:"font-semibold",children:"Action:"})," ",X.action]})})]},oe))}):c.jsx(_e,{children:c.jsx(Te,{className:"py-8 text-center text-gray-600",children:"No additional recommendations at this time."})})})]}):null,c.jsxs(we,{onClick:()=>r(`/patients/${b.id}`),className:"w-full bg-blue-600 hover:bg-blue-700 text-white","data-testid":"button-view-full-record",children:[c.jsx(Gv,{className:"h-4 w-4 mr-2"}),"View Full Patient Record"]})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[c.jsx("div",{className:"lg:col-span-1",children:c.jsxs(_e,{className:"bg-white",children:[c.jsxs(Ke,{children:[c.jsx(ze,{className:"text-lg",children:"Filter Patients"}),c.jsx(Cn,{children:"Search by status"})]}),c.jsxs(Te,{className:"space-y-2",children:[c.jsxs(we,{variant:k==="all"?"default":"outline",className:"w-full justify-between text-left",onClick:()=>W("all"),"data-testid":"button-filter-all",children:[c.jsx("span",{children:"All Patients"}),c.jsx("span",{className:"text-xs bg-gray-200 px-2 py-1 rounded",children:(G==null?void 0:G.length)||0})]}),c.jsxs(we,{variant:k==="new"?"default":"outline",className:"w-full justify-between text-left",onClick:()=>W("new"),"data-testid":"button-filter-new",children:[c.jsx("span",{children:"New Patients"}),c.jsx("span",{className:"text-xs bg-blue-200 text-blue-900 px-2 py-1 rounded",children:le.new})]}),c.jsxs(we,{variant:k==="last-visit"?"default":"outline",className:"w-full justify-between text-left",onClick:()=>W("last-visit"),"data-testid":"button-filter-last-visit",children:[c.jsx("span",{children:"Last Visit"}),c.jsx("span",{className:"text-xs bg-purple-200 text-purple-900 px-2 py-1 rounded",children:le.lastVisit})]}),c.jsxs(we,{variant:k==="critical"?"default":"outline",className:"w-full justify-between text-left",onClick:()=>W("critical"),"data-testid":"button-filter-critical",children:[c.jsx("span",{children:"Critical"}),c.jsx("span",{className:"text-xs bg-red-200 text-red-900 px-2 py-1 rounded",children:le.critical})]}),c.jsxs(we,{variant:k==="low-risk"?"default":"outline",className:"w-full justify-between text-left",onClick:()=>W("low-risk"),"data-testid":"button-filter-low-risk",children:[c.jsx("span",{children:"Low Risk"}),c.jsx("span",{className:"text-xs bg-green-200 text-green-900 px-2 py-1 rounded",children:le.lowRisk})]}),c.jsxs(we,{variant:k==="booked"?"default":"outline",className:"w-full justify-between text-left",onClick:()=>W("booked"),"data-testid":"button-filter-booked",children:[c.jsx("span",{children:"Booked Appointment"}),c.jsx("span",{className:"text-xs bg-yellow-200 text-yellow-900 px-2 py-1 rounded",children:le.booked})]}),c.jsxs(we,{variant:k==="discharged"?"default":"outline",className:"w-full justify-between text-left",onClick:()=>W("discharged"),"data-testid":"button-filter-discharged",children:[c.jsx("span",{children:"Discharged"}),c.jsx("span",{className:"text-xs bg-gray-300 text-gray-900 px-2 py-1 rounded",children:le.discharged})]})]})]})}),c.jsxs("div",{className:"lg:col-span-3 space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"h-5 w-5 text-gray-600",children:""}),c.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:k==="all"?"Patient Records":`${k.replace(/-/g," ").split(" ").map(X=>X.charAt(0).toUpperCase()+X.slice(1)).join(" ")} Patients`})]}),c.jsxs("div",{className:"text-sm text-gray-700 font-semibold",children:["Showing: ",c.jsx("span",{"data-testid":"text-filtered-patients",children:se.length})," of ",c.jsx("span",{"data-testid":"text-total-patients",children:(G==null?void 0:G.length)||0})," patients"]}),c.jsx(_e,{className:"bg-white overflow-hidden",children:L?c.jsx("div",{className:"space-y-3 p-6",children:[1,2,3].map(X=>c.jsx(yl,{className:"h-12 w-full"},X))}):se.length>0?c.jsx("div",{className:"overflow-x-auto",children:c.jsxs("table",{className:"w-full",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-blue-600 text-white",children:[c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold",children:"Name"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold",children:"Age"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold",children:"Gender"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold",children:"BP"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold",children:"Temp (C)"}),c.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold",children:"Heart Rate"})]})}),c.jsx("tbody",{children:se.map(X=>c.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer transition",onClick:()=>r(`/patients/${X.id}`),"data-testid":`row-patient-${X.id}`,children:[c.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:[X.firstName," ",X.lastName]}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:X.age}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:X.gender.charAt(0).toUpperCase()+X.gender.slice(1)}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-700 font-mono",children:X.bloodPressureSystolic&&X.bloodPressureDiastolic?`${X.bloodPressureSystolic}/${X.bloodPressureDiastolic}`:""}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:X.temperature||""}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:X.heartRate?`${X.heartRate} bpm`:""})]},X.id))})]})}):c.jsx("div",{className:"text-center py-12",children:c.jsx("p",{className:"text-gray-600",children:"No patients found for this filter."})})})]})]})]})}),c.jsx(i$,{})]})}function fPe({userId:r}){const{data:s,isLoading:o}=In({queryKey:["user-department-info",r],queryFn:async()=>(await Ot("GET",`/api/department-management/user/${r}`)).json(),enabled:!!r});if(o||!s)return null;const d=s.department||s.departments_leading&&s.departments_leading.length>0,p=s.teams&&s.teams.length>0;return!d&&!p?null:c.jsxs(_e,{className:"border-blue-200 bg-blue-50/30",children:[c.jsx(Ke,{className:"pb-3",children:c.jsxs(ze,{className:"text-lg flex items-center gap-2",children:[c.jsx(ml,{className:"h-5 w-5 text-blue-600"}),"My Department & Teams"]})}),c.jsx(Te,{children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(s.department||s.departments_leading&&s.departments_leading.length>0)&&c.jsxs("div",{className:"bg-white rounded-lg p-4 border",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(ml,{className:"h-4 w-4 text-blue-600"}),c.jsx("h3",{className:"font-semibold",children:"Department"})]}),s.department&&c.jsxs("div",{className:"mb-3",children:[c.jsx("p",{className:"text-lg font-medium text-blue-900",children:s.department.name}),s.department.description&&c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.department.description}),s.department.is_head&&c.jsx(xt,{className:"mt-2 bg-yellow-100 text-yellow-900",children:"Department Head"}),s.department.head_staff&&!s.department.is_head&&c.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Head: ",s.department.head_staff.name]}),c.jsx(xt,{className:"mt-2",variant:s.department.status==="active"?"default":"secondary",children:s.department.status})]}),s.departments_leading&&s.departments_leading.map(f=>c.jsxs("div",{className:"mb-3 border-l-4 border-yellow-500 pl-3",children:[c.jsx("p",{className:"text-lg font-medium text-blue-900",children:f.name}),f.description&&c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.description}),c.jsx(xt,{className:"mt-2 bg-yellow-100 text-yellow-900",children:"Department Head"}),c.jsx(xt,{className:"mt-2 ml-2",variant:f.status==="active"?"default":"secondary",children:f.status})]},f.id))]}),p&&c.jsxs("div",{className:"bg-white rounded-lg p-4 border",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Lp,{className:"h-4 w-4 text-green-600"}),c.jsxs("h3",{className:"font-semibold",children:["Teams (",s.teams.length,")"]})]}),c.jsx("div",{className:"space-y-2",children:s.teams.map(f=>c.jsxs("div",{className:`border-l-2 ${f.is_lead?"border-yellow-500":"border-green-500"} pl-3`,children:[c.jsx("p",{className:"font-medium text-green-900",children:f.name}),c.jsx("p",{className:"text-xs text-muted-foreground",children:f.team_type}),f.is_lead&&c.jsx(xt,{className:"text-xs mt-1 bg-yellow-100 text-yellow-900",children:"Team Lead"})]},f.id))})]})]})})]})}function gPe(){const[r,s]=I.useState(""),{data:o,isLoading:d}=In({queryKey:["/api/patients"]}),p=o==null?void 0:o.filter(y=>`${y.firstName} ${y.lastName}`.toLowerCase().includes(r.toLowerCase())||y.mrn.toLowerCase().includes(r.toLowerCase())||y.nin.toLowerCase().includes(r.toLowerCase())),f=(y,b)=>`${y[0]}${b[0]}`.toUpperCase(),E=y=>{if(!y.bloodPressureSystolic)return"No vitals";const b=y.bloodPressureSystolic;return b>140?{label:"High BP",color:"bg-destructive text-destructive-foreground"}:b<90?{label:"Low BP",color:"bg-warning text-warning-foreground"}:{label:"Normal",color:"bg-success text-success-foreground"}};return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold","data-testid":"text-patients-title",children:"Patients"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Browse and search patient records"})]}),c.jsx(we,{asChild:!0,"data-testid":"button-add-patient",children:c.jsxs(UT,{href:"/patients/new",children:[c.jsx(Tb,{className:"h-4 w-4 mr-2"}),"Add Patient"]})})]}),c.jsxs("div",{className:"relative",children:[c.jsx(Uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(at,{placeholder:"Search by name, MRN, or NIN...",value:r,onChange:y=>s(y.target.value),className:"pl-10","data-testid":"input-search-patients"})]}),d?c.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3,4,5,6].map(y=>c.jsx(yl,{className:"h-48"},y))}):p&&p.length>0?c.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(y=>c.jsx(_e,{className:"hover-elevate active-elevate-2","data-testid":`card-patient-${y.id}`,children:c.jsxs(Te,{className:"p-6",children:[c.jsxs("div",{className:"flex items-start gap-4",children:[c.jsx(xw,{className:"h-14 w-14",children:c.jsx(Nw,{className:"bg-primary text-primary-foreground text-lg",children:f(y.firstName,y.lastName)})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("h3",{className:"font-semibold text-lg truncate",children:[y.firstName," ",y.lastName]}),c.jsxs("p",{className:"text-sm text-muted-foreground font-mono",children:["MRN: ",y.mrn]})]})]}),c.jsxs("div",{className:"mt-4 space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Age:"}),c.jsxs("span",{className:"font-medium","data-testid":`text-age-${y.id}`,children:[y.age," years"]})]}),c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Gender:"}),c.jsx("span",{className:"font-medium capitalize","data-testid":`text-gender-${y.id}`,children:y.gender})]}),c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Blood Group:"}),c.jsx(xt,{variant:"outline","data-testid":`badge-blood-group-${y.id}`,children:y.bloodGroup})]}),c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-muted-foreground",children:"Genotype:"}),c.jsx(xt,{variant:"outline","data-testid":`badge-genotype-${y.id}`,children:y.genotype})]})]}),c.jsxs("div",{className:"mt-4 pt-4 border-t flex items-center justify-between",children:[c.jsx(xt,{className:E(y).color,"data-testid":`badge-vital-status-${y.id}`,children:E(y).label}),c.jsx(we,{variant:"ghost",size:"sm",asChild:!0,"data-testid":`button-view-patient-${y.id}`,children:c.jsxs(UT,{href:`/patients/${y.id}`,children:[c.jsx(owe,{className:"h-4 w-4 mr-2"}),"View"]})})]})]})},y.id))}):c.jsx(_e,{children:c.jsxs(Te,{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(Uo,{className:"h-12 w-12 text-muted-foreground mb-4 opacity-50"}),c.jsx("p",{className:"text-lg font-medium",children:"No patients found"}),c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r?"Try adjusting your search":"Start by adding your first patient"}),!r&&c.jsx(we,{asChild:!0,className:"mt-4","data-testid":"button-add-first-patient",children:c.jsxs(UT,{href:"/patients/new",children:[c.jsx(Tb,{className:"h-4 w-4 mr-2"}),"Add Patient"]})})]})})]})}const ii=I.forwardRef(({className:r,...s},o)=>c.jsx("textarea",{className:ct("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:o,...s}));ii.displayName="Textarea";const _Pe=lOe.extend({mrn:kt().min(1,"MRN is required"),firstName:kt().min(1,"First name is required"),lastName:kt().min(1,"Last name is required"),age:bp().min(1,"Age must be at least 1").max(150,"Invalid age"),gender:kt().min(1,"Gender is required"),phoneNumber:kt().min(1,"Phone number is required"),nin:kt().min(1,"NIN is required"),bloodGroup:kt().min(1,"Blood group is required"),genotype:kt().min(1,"Genotype is required"),registeredBy:kt()});function EPe(){const[,r]=so(),{user:s}=ts(),{toast:o}=jr(),[d,p]=I.useState(!1),[f,E]=I.useState("facial"),[y,b]=I.useState(null),[C,A]=I.useState(null),D=Pg({resolver:Dg(_Pe),defaultValues:{mrn:`MRN${Date.now()}`,firstName:"",lastName:"",age:0,gender:"",phoneNumber:"",email:"",address:"",nin:"",bloodGroup:"",genotype:"",allergies:"",symptoms:"",bloodPressureSystolic:void 0,bloodPressureDiastolic:void 0,temperature:"",heartRate:void 0,weight:"",facialRecognitionData:null,fingerprintData:null,registeredBy:(s==null?void 0:s.id)||"",lastUpdatedBy:null}}),k=Lr({mutationFn:async B=>await(await Ot("POST","/api/patients",{...B,facialRecognitionData:y,fingerprintData:C})).json(),onSuccess:()=>{o({title:"Patient Registered",description:"Patient has been successfully registered."}),Nc.invalidateQueries({queryKey:["/api/patients"]}),r("/patients")},onError:B=>{o({title:"Registration Failed",description:B.message,variant:"destructive"})}}),W=B=>{k.mutate(B)},G=B=>{E(B),p(!0)},L=()=>{const B=`${f}_${Date.now()}_captured`;f==="facial"?b(B):A(B),o({title:"Biometric Captured",description:`${f==="facial"?"Facial recognition":"Fingerprint"} data captured successfully.`}),p(!1)};return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx(we,{variant:"ghost",size:"icon",onClick:()=>r("/patients"),"data-testid":"button-back",children:c.jsx(xg,{className:"h-5 w-5"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold","data-testid":"text-new-patient-title",children:"Register New Patient"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Complete patient biodata and medical information"})]})]}),c.jsx(kg,{...D,children:c.jsxs("form",{onSubmit:D.handleSubmit(W),className:"space-y-6",children:[c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Personal Information"}),c.jsx(Cn,{children:"Basic biodata and contact details"})]}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsx(_r,{control:D.control,name:"firstName",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"First Name *"}),c.jsx(ur,{children:c.jsx(at,{...B,placeholder:"John","data-testid":"input-first-name"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"lastName",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Last Name *"}),c.jsx(ur,{children:c.jsx(at,{...B,placeholder:"Doe","data-testid":"input-last-name"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"age",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Age *"}),c.jsx(ur,{children:c.jsx(at,{...B,type:"number",onChange:H=>B.onChange(parseInt(H.target.value)||0),placeholder:"25","data-testid":"input-age"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"gender",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Gender *"}),c.jsxs(Wn,{onValueChange:B.onChange,value:B.value,children:[c.jsx(ur,{children:c.jsx(jn,{"data-testid":"select-gender",children:c.jsx(Hn,{placeholder:"Select gender"})})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"male",children:"Male"}),c.jsx(ke,{value:"female",children:"Female"}),c.jsx(ke,{value:"other",children:"Other"})]})]}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"phoneNumber",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Phone Number *"}),c.jsx(ur,{children:c.jsx(at,{...B,placeholder:"+234 800 000 0000","data-testid":"input-phone"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"email",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Email"}),c.jsx(ur,{children:c.jsx(at,{...B,type:"email",placeholder:"john.doe@example.com","data-testid":"input-email"})}),c.jsx(hr,{})]})})]}),c.jsx(_r,{control:D.control,name:"address",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Address"}),c.jsx(ur,{children:c.jsx(ii,{...B,placeholder:"Full address","data-testid":"input-address"})}),c.jsx(hr,{})]})})]})]}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Identification & Biometrics"}),c.jsx(Cn,{children:"National identification and biometric data"})]}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsx(_r,{control:D.control,name:"mrn",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Medical Record Number *"}),c.jsx(ur,{children:c.jsx(at,{...B,className:"font-mono",readOnly:!0,"data-testid":"input-mrn"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"nin",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"National ID Number (NIN)"}),c.jsx(ur,{children:c.jsx(at,{...B,className:"font-mono",placeholder:"12345678901","data-testid":"input-nin"})}),c.jsx(hr,{})]})})]}),c.jsx(td,{}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx(tt,{className:"text-base font-semibold",children:"Identification Methods"}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Select at least one identification method: NIN, Fingerprint, or Facial Recognition"})]}),c.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{children:"National ID (NIN)"}),c.jsx("div",{className:"p-3 border rounded-md bg-muted/50 space-y-2",children:c.jsx("p",{className:"text-xs text-muted-foreground",children:D.getValues("nin")?" NIN entered":"Enter NIN above"})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{children:"Facial Recognition"}),c.jsxs(we,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>G("facial"),"data-testid":"button-capture-facial",children:[c.jsx(hv,{className:"h-4 w-4 mr-2"}),y?"Recapture":"Capture"]}),y&&c.jsx("p",{className:"text-xs text-success","data-testid":"status-facial-captured",children:" Facial data captured"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{children:"Fingerprint"}),c.jsxs(we,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>G("fingerprint"),"data-testid":"button-capture-fingerprint",children:[c.jsx(fp,{className:"h-4 w-4 mr-2"}),C?"Recapture":"Capture"]}),C&&c.jsx("p",{className:"text-xs text-success","data-testid":"status-fingerprint-captured",children:" Fingerprint captured"})]})]})]})]})]}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Medical Information"}),c.jsx(Cn,{children:"Blood type and genetic information"})]}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsx(_r,{control:D.control,name:"bloodGroup",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Blood Group *"}),c.jsxs(Wn,{onValueChange:B.onChange,value:B.value,children:[c.jsx(ur,{children:c.jsx(jn,{"data-testid":"select-blood-group",children:c.jsx(Hn,{placeholder:"Select blood group"})})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"A+",children:"A+"}),c.jsx(ke,{value:"A-",children:"A-"}),c.jsx(ke,{value:"B+",children:"B+"}),c.jsx(ke,{value:"B-",children:"B-"}),c.jsx(ke,{value:"AB+",children:"AB+"}),c.jsx(ke,{value:"AB-",children:"AB-"}),c.jsx(ke,{value:"O+",children:"O+"}),c.jsx(ke,{value:"O-",children:"O-"})]})]}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"genotype",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Genotype *"}),c.jsxs(Wn,{onValueChange:B.onChange,value:B.value,children:[c.jsx(ur,{children:c.jsx(jn,{"data-testid":"select-genotype",children:c.jsx(Hn,{placeholder:"Select genotype"})})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"AA",children:"AA"}),c.jsx(ke,{value:"AS",children:"AS"}),c.jsx(ke,{value:"SS",children:"SS"}),c.jsx(ke,{value:"AC",children:"AC"}),c.jsx(ke,{value:"SC",children:"SC"})]})]}),c.jsx(hr,{})]})})]}),c.jsx(_r,{control:D.control,name:"allergies",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Allergies"}),c.jsx(ur,{children:c.jsx(ii,{...B,placeholder:"List any known allergies (e.g., Penicillin, Peanuts)","data-testid":"input-allergies"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"symptoms",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Current Symptoms"}),c.jsx(ur,{children:c.jsx(ii,{...B,placeholder:"List any presenting symptoms (e.g., Headache, Fever, Cough, Body pain)","data-testid":"input-symptoms"})}),c.jsx(hr,{})]})})]})]}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Current Vitals"}),c.jsx(Cn,{children:"Record current vital signs"})]}),c.jsx(Te,{className:"space-y-4",children:c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsx(_r,{control:D.control,name:"bloodPressureSystolic",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Blood Pressure (Systolic) mmHg"}),c.jsx(ur,{children:c.jsx(at,{...B,type:"number",onChange:H=>B.onChange(H.target.value?parseInt(H.target.value):void 0),value:B.value||"",placeholder:"120","data-testid":"input-bp-systolic"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"bloodPressureDiastolic",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Blood Pressure (Diastolic) mmHg"}),c.jsx(ur,{children:c.jsx(at,{...B,type:"number",onChange:H=>B.onChange(H.target.value?parseInt(H.target.value):void 0),value:B.value||"",placeholder:"80","data-testid":"input-bp-diastolic"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"temperature",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Temperature (C)"}),c.jsx(ur,{children:c.jsx(at,{...B,placeholder:"36.5","data-testid":"input-temperature"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"heartRate",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Heart Rate (bpm)"}),c.jsx(ur,{children:c.jsx(at,{...B,type:"number",onChange:H=>B.onChange(H.target.value?parseInt(H.target.value):void 0),value:B.value||"",placeholder:"72","data-testid":"input-heart-rate"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:D.control,name:"weight",render:({field:B})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Weight (kg)"}),c.jsx(ur,{children:c.jsx(at,{...B,placeholder:"70.5","data-testid":"input-weight"})}),c.jsx(hr,{})]})})]})})]}),c.jsxs("div",{className:"flex gap-4 justify-end",children:[c.jsx(we,{type:"button",variant:"outline",onClick:()=>r("/patients"),"data-testid":"button-cancel",children:"Cancel"}),c.jsxs(we,{type:"submit",disabled:k.isPending,"data-testid":"button-register",children:[c.jsx(nQ,{className:"h-4 w-4 mr-2"}),k.isPending?"Registering...":"Register Patient"]})]})]})}),c.jsx(us,{open:d,onOpenChange:p,children:c.jsxs(hs,{className:"max-w-2xl",children:[c.jsxs(ps,{children:[c.jsx(ms,{children:f==="facial"?"Capture Facial Recognition":"Capture Fingerprint"}),c.jsx(Tc,{children:f==="facial"?"Position the patient's face within the frame":"Place finger on the scanner"})]}),c.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-6",children:[f==="facial"?c.jsxs("div",{className:"relative w-full max-w-md aspect-video bg-muted rounded-lg flex items-center justify-center",children:[c.jsx(hv,{className:"h-24 w-24 text-muted-foreground"}),c.jsx("div",{className:"absolute inset-0 border-4 border-primary/50 rounded-lg"})]}):c.jsx("div",{className:"relative w-48 h-48 bg-muted rounded-full flex items-center justify-center",children:c.jsx(fp,{className:"h-32 w-32 text-muted-foreground"})}),c.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Demo interface - Biometric hardware integration required"}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx(we,{variant:"outline",onClick:()=>p(!1),"data-testid":"button-cancel-capture",children:"Cancel"}),c.jsx(we,{onClick:L,"data-testid":"button-confirm-capture",children:"Capture"})]})]})]})})]})}function vPe({patientId:r,onUploadSuccess:s}){const{toast:o}=jr(),[d,p]=I.useState(""),[f,E]=I.useState(""),[y,b]=I.useState(""),[C,A]=I.useState(""),[D,k]=I.useState(""),[W,G]=I.useState(""),[L,B]=I.useState(""),H=Lr({mutationFn:async ee=>await(await Ot("POST","/api/lab-results",ee)).json(),onSuccess:()=>{o({title:"Lab Result Uploaded",description:"Lab result has been uploaded and analyzed successfully."}),Nc.invalidateQueries({queryKey:["/api/patients",r,"lab-results"]}),V(),s==null||s()},onError:ee=>{o({title:"Upload Failed",description:ee.message,variant:"destructive"})}}),V=()=>{p(""),E(""),b(""),A(""),k(""),G(""),B("")},K=async ee=>{var le;const $=(le=ee.target.files)==null?void 0:le[0];if(!$)return;b($.name),k($.type);const se=new FileReader;se.onload=X=>{var je;const oe=(je=X.target)==null?void 0:je.result;A(oe)},se.readAsDataURL($)},Z=ee=>{if(ee.preventDefault(),!d||!f||!y){o({title:"Missing Information",description:"Please fill in test name, category, and upload a file.",variant:"destructive"});return}H.mutate({patientId:r,testName:d,testCategory:f,fileName:y,fileData:C,fileType:D,testValues:W,normalRange:L,status:"normal",uploadedBy:"current-user"})};return c.jsxs(_e,{className:"w-full",children:[c.jsxs(Ke,{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(mv,{className:"h-5 w-5"}),"Upload Lab Result"]}),c.jsx(Cn,{children:"Upload lab test files for automated analysis (PDF, images, or data)"})]}),c.jsx(Te,{children:c.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{htmlFor:"testName",children:"Test Name *"}),c.jsx(at,{id:"testName",placeholder:"e.g., Blood Test, ECG",value:d,onChange:ee=>p(ee.target.value),"data-testid":"input-test-name"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{htmlFor:"testCategory",children:"Test Category *"}),c.jsxs(Wn,{value:f,onValueChange:E,children:[c.jsx(jn,{id:"testCategory","data-testid":"select-test-category",children:c.jsx(Hn,{placeholder:"Select category"})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"Hematology",children:"Hematology"}),c.jsx(ke,{value:"Biochemistry",children:"Biochemistry"}),c.jsx(ke,{value:"Immunology",children:"Immunology"}),c.jsx(ke,{value:"Imaging",children:"Imaging"}),c.jsx(ke,{value:"Cardiology",children:"Cardiology"}),c.jsx(ke,{value:"Microbiology",children:"Microbiology"}),c.jsx(ke,{value:"Radiology",children:"Radiology"}),c.jsx(ke,{value:"Other",children:"Other"})]})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{htmlFor:"fileUpload",children:"Upload File *"}),c.jsx(at,{id:"fileUpload",type:"file",onChange:K,accept:".pdf,.jpg,.jpeg,.png,.json,.csv","data-testid":"input-file-upload"}),y&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[c.jsx(Ng,{className:"h-4 w-4"}),y]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{htmlFor:"testValues",children:"Test Values (Optional)"}),c.jsx(ii,{id:"testValues",placeholder:"e.g., RBC: 4.5, WBC: 7.2",value:W,onChange:ee=>G(ee.target.value),className:"h-20","data-testid":"textarea-test-values"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{htmlFor:"normalRange",children:"Normal Range (Optional)"}),c.jsx(ii,{id:"normalRange",placeholder:"e.g., RBC: 4.5-5.5, WBC: 4.5-11.0",value:L,onChange:ee=>B(ee.target.value),className:"h-20","data-testid":"textarea-normal-range"})]})]}),c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 flex gap-3",children:[c.jsx(bl,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),c.jsx("p",{className:"text-sm text-blue-800",children:"Uploaded lab results will be automatically analyzed using AI to detect abnormalities and provide clinical insights."})]}),c.jsxs("div",{className:"flex gap-2 justify-end",children:[c.jsx(we,{type:"button",variant:"outline",onClick:V,"data-testid":"button-cancel-upload",children:"Cancel"}),c.jsx(we,{type:"submit",disabled:H.isPending,className:"bg-blue-600 hover:bg-blue-700","data-testid":"button-submit-upload",children:H.isPending?c.jsxs(c.Fragment,{children:[c.jsx(hwe,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):c.jsxs(c.Fragment,{children:[c.jsx(mv,{className:"h-4 w-4 mr-2"}),"Upload & Analyze"]})})]})]})})]})}function yPe({patientId:r}){const{data:s,isLoading:o}=In({queryKey:["/api/patients",r,"lab-results"]}),d=f=>{switch(f){case"normal":return"bg-green-100 text-green-900";case"abnormal":return"bg-yellow-100 text-yellow-900";case"critical":return"bg-red-100 text-red-900";default:return"bg-gray-100 text-gray-900"}},p=f=>{switch(f){case"normal":return c.jsx(Ng,{className:"h-5 w-5 text-green-600"});case"abnormal":return c.jsx(id,{className:"h-5 w-5 text-yellow-600"});case"critical":return c.jsx(bl,{className:"h-5 w-5 text-red-600"});default:return null}};return o?c.jsxs("div",{className:"space-y-3",children:[c.jsx(yl,{className:"h-32 w-full"}),c.jsx(yl,{className:"h-32 w-full"})]}):!s||s.length===0?c.jsx(_e,{children:c.jsxs(Te,{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(oa,{className:"h-12 w-12 text-muted-foreground mb-4 opacity-50"}),c.jsx("p",{className:"text-lg font-medium",children:"No lab results yet"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload lab results to get automated analysis"})]})}):c.jsx("div",{className:"space-y-4",children:(s||[]).map(f=>{var y;const E=f.automatedAnalysis?JSON.parse(f.automatedAnalysis):null;return c.jsxs(_e,{className:"overflow-hidden",children:[c.jsx(Ke,{className:"pb-3",children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[c.jsx(oa,{className:"h-5 w-5 text-blue-600 mt-1 flex-shrink-0"}),c.jsxs("div",{className:"flex-1",children:[c.jsx(ze,{className:"text-lg",children:f.testName}),c.jsx(Cn,{children:f.testCategory})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[p(f.status),c.jsx(xt,{className:d(f.status),children:f.status.toUpperCase()})]})]})}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"Uploaded"}),c.jsx("p",{className:"font-medium",children:f.uploadedAt?new Date(f.uploadedAt).toLocaleDateString():""})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"File"}),c.jsx("p",{className:"font-medium truncate",children:f.fileName})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"Category"}),c.jsx("p",{className:"font-medium",children:f.testCategory})]})]}),f.testValues&&c.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[c.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Test Values"}),c.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:f.testValues})]}),E&&c.jsxs(Al,{defaultValue:"analysis",className:"w-full",children:[c.jsxs(Lc,{className:"grid w-full grid-cols-2",children:[c.jsx(kn,{value:"analysis",children:"AI Analysis"}),c.jsx(kn,{value:"notes",children:"Doctor Notes"})]}),c.jsxs(Ln,{value:"analysis",className:"space-y-3 mt-3",children:[c.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[c.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Overall Status"}),c.jsx("p",{className:"text-sm text-blue-800",children:((y=E.overallStatus)==null?void 0:y.toUpperCase())||"Analyzing..."})]}),E.flaggedAbnormalities&&E.flaggedAbnormalities.length>0&&c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold mb-2",children:"Flagged Abnormalities"}),c.jsx("div",{className:"space-y-2",children:E.flaggedAbnormalities.map((b,C)=>c.jsxs("div",{className:"border-l-4 border-yellow-400 pl-3 py-2",children:[c.jsx("p",{className:"text-sm font-medium",children:b.parameter}),c.jsxs("p",{className:"text-xs text-gray-600",children:["Value: ",b.value," (Normal: ",b.normalRange,")"]}),c.jsx("p",{className:"text-xs text-gray-700 mt-1",children:b.clinicalSignificance})]},C))})]}),E.recommendations&&E.recommendations.length>0&&c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold mb-2",children:"Recommendations"}),c.jsx("ul",{className:"space-y-1",children:E.recommendations.map((b,C)=>c.jsxs("li",{className:"text-sm text-gray-700 flex gap-2",children:[c.jsx("span",{className:"text-blue-600",children:""})," ",b]},C))})]})]}),c.jsx(Ln,{value:"notes",className:"space-y-3 mt-3",children:f.doctorNotes?c.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:c.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:f.doctorNotes})}):c.jsx("p",{className:"text-sm text-gray-500 italic",children:"No doctor notes yet"})})]})]})]},f.id)})})}function SPe(){const[,r]=TTe("/patients/:id"),[,s]=so(),{user:o}=ts(),{toast:d}=jr(),[p,f]=I.useState(!1),[E,y]=I.useState({}),b=r==null?void 0:r.id,{data:C,isLoading:A}=In({queryKey:["/api/patients",b],enabled:!!b}),D=Lr({mutationFn:async V=>await(await Ot("PATCH",`/api/patients/${b}`,V)).json(),onSuccess:()=>{d({title:"Patient Updated",description:"Patient information has been successfully updated."}),Nc.invalidateQueries({queryKey:["/api/patients"]}),Nc.invalidateQueries({queryKey:["/api/patients",b]}),f(!1),y({})},onError:V=>{d({title:"Update Failed",description:V.message,variant:"destructive"})}}),k=()=>{C&&(y(C),f(!0))},W=()=>{D.mutate(E)},G=()=>{f(!1),y({})},L=(o==null?void 0:o.role)==="admin"||(o==null?void 0:o.role)==="doctor",B=(V,K)=>!V||!K?"P":`${V[0]}${K[0]}`.toUpperCase(),H=(V,K)=>V?V<K.min||V>K.max?"text-destructive":"text-success":"text-muted-foreground";return A?c.jsxs("div",{className:"space-y-6",children:[c.jsx(yl,{className:"h-12 w-64"}),c.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[c.jsx(yl,{className:"h-96"}),c.jsx(yl,{className:"h-96 md:col-span-2"})]})]}):C?c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx(we,{variant:"ghost",size:"icon",onClick:()=>s("/patients"),"data-testid":"button-back",children:c.jsx(xg,{className:"h-5 w-5"})}),c.jsxs("div",{children:[c.jsxs("h1",{className:"text-3xl font-bold","data-testid":"text-patient-name",children:[C.firstName," ",C.lastName]}),c.jsxs("p",{className:"text-muted-foreground font-mono",children:["MRN: ",C.mrn]})]})]}),L&&!p&&c.jsxs(we,{onClick:k,"data-testid":"button-edit",children:[c.jsx(sQ,{className:"h-4 w-4 mr-2"}),"Edit"]}),p&&c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(we,{variant:"outline",onClick:G,"data-testid":"button-cancel-edit",children:[c.jsx(fg,{className:"h-4 w-4 mr-2"}),"Cancel"]}),c.jsxs(we,{onClick:W,disabled:D.isPending,"data-testid":"button-save",children:[c.jsx(nQ,{className:"h-4 w-4 mr-2"}),D.isPending?"Saving...":"Save"]})]})]}),c.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Patient Profile"})}),c.jsxs(Te,{className:"space-y-6",children:[c.jsxs("div",{className:"flex flex-col items-center text-center",children:[c.jsx(xw,{className:"h-24 w-24 mb-4",children:c.jsx(Nw,{className:"bg-primary text-primary-foreground text-2xl",children:B(C.firstName,C.lastName)})}),c.jsxs("h2",{className:"text-xl font-bold","data-testid":"text-patient-full-name",children:[C.firstName," ",C.lastName]}),c.jsxs("p",{className:"text-sm text-muted-foreground","data-testid":"text-patient-age-gender",children:[C.age," years  ",C.gender]})]}),c.jsx(td,{}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Twe,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{className:"text-sm","data-testid":"text-phone-number",children:C.phoneNumber})]}),C.email&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(pwe,{className:"h-4 w-4 text-muted-foreground"}),c.jsx("span",{className:"text-sm","data-testid":"text-email",children:C.email})]}),C.address&&c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(mwe,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),c.jsx("span",{className:"text-sm","data-testid":"text-address",children:C.address})]})]}),c.jsx(td,{}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Blood Group"}),c.jsx(xt,{variant:"outline","data-testid":"badge-blood-group",children:C.bloodGroup})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Genotype"}),c.jsx(xt,{variant:"outline","data-testid":"badge-genotype",children:C.genotype})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"NIN"}),c.jsx("span",{className:"text-sm font-mono","data-testid":"text-nin",children:C.nin})]})]}),(C.facialRecognitionData||C.fingerprintData)&&c.jsxs(c.Fragment,{children:[c.jsx(td,{}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium",children:"Biometric Data"}),C.facialRecognitionData&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-success","data-testid":"status-facial-enrolled",children:[c.jsx(hv,{className:"h-4 w-4"}),c.jsx("span",{children:"Facial recognition enrolled"})]}),C.fingerprintData&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-success","data-testid":"status-fingerprint-enrolled",children:[c.jsx(fp,{className:"h-4 w-4"}),c.jsx("span",{children:"Fingerprint enrolled"})]})]})]})]})]}),c.jsxs(_e,{className:"md:col-span-2",children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Medical Information"}),c.jsx(Cn,{children:p?"Update patient medical details":"Patient medical records and vital signs"})]}),c.jsxs(Te,{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Current Vitals"}),c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsx(_e,{children:c.jsxs(Te,{className:"p-4",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Tl,{className:"h-4 w-4 text-destructive"}),c.jsx("span",{className:"text-sm font-medium",children:"Blood Pressure"})]})}),p?c.jsxs("div",{className:"flex gap-2",children:[c.jsx(at,{type:"number",placeholder:"Systolic",value:E.bloodPressureSystolic||"",onChange:V=>y({...E,bloodPressureSystolic:parseInt(V.target.value)||void 0}),"data-testid":"input-edit-bp-systolic"}),c.jsx(at,{type:"number",placeholder:"Diastolic",value:E.bloodPressureDiastolic||"",onChange:V=>y({...E,bloodPressureDiastolic:parseInt(V.target.value)||void 0}),"data-testid":"input-edit-bp-diastolic"})]}):c.jsxs(c.Fragment,{children:[c.jsx("p",{className:`text-2xl font-bold font-mono ${H(C.bloodPressureSystolic,{min:90,max:140})}`,"data-testid":"text-blood-pressure",children:C.bloodPressureSystolic&&C.bloodPressureDiastolic?`${C.bloodPressureSystolic}/${C.bloodPressureDiastolic}`:""}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"mmHg"})]})]})}),c.jsx(_e,{children:c.jsxs(Te,{className:"p-4",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Cwe,{className:"h-4 w-4 text-warning"}),c.jsx("span",{className:"text-sm font-medium",children:"Temperature"})]})}),p?c.jsx(at,{placeholder:"36.5",value:E.temperature||"",onChange:V=>y({...E,temperature:V.target.value}),"data-testid":"input-edit-temperature"}):c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-2xl font-bold font-mono","data-testid":"text-temperature",children:C.temperature||""}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"C"})]})]})}),c.jsx(_e,{children:c.jsxs(Te,{className:"p-4",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(e1,{className:"h-4 w-4 text-destructive"}),c.jsx("span",{className:"text-sm font-medium",children:"Heart Rate"})]})}),p?c.jsx(at,{type:"number",placeholder:"72",value:E.heartRate||"",onChange:V=>y({...E,heartRate:parseInt(V.target.value)||void 0}),"data-testid":"input-edit-heart-rate"}):c.jsxs(c.Fragment,{children:[c.jsx("p",{className:`text-2xl font-bold font-mono ${H(C.heartRate,{min:60,max:100})}`,"data-testid":"text-heart-rate",children:C.heartRate||""}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"bpm"})]})]})}),c.jsx(_e,{children:c.jsxs(Te,{className:"p-4",children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Iwe,{className:"h-4 w-4 text-primary"}),c.jsx("span",{className:"text-sm font-medium",children:"Weight"})]})}),p?c.jsx(at,{placeholder:"70.5",value:E.weight||"",onChange:V=>y({...E,weight:V.target.value}),"data-testid":"input-edit-weight"}):c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"text-2xl font-bold font-mono","data-testid":"text-weight",children:C.weight||""}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"kg"})]})]})})]})]}),c.jsx(td,{}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Allergies & Notes"}),p?c.jsx(ii,{placeholder:"List any known allergies...",value:E.allergies||"",onChange:V=>y({...E,allergies:V.target.value}),rows:4,"data-testid":"input-edit-allergies"}):C.allergies?c.jsx("p",{className:"text-sm","data-testid":"text-allergies",children:C.allergies}):c.jsx("p",{className:"text-sm text-muted-foreground",children:"No allergies recorded"})]}),c.jsx(td,{}),c.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[c.jsxs("p",{children:["Registered by: User ID ",C.registeredBy]}),C.lastUpdatedBy&&c.jsxs("p",{children:["Last updated by: User ID ",C.lastUpdatedBy]}),C.createdAt&&c.jsxs("p",{children:["Registration date: ",new Date(C.createdAt).toLocaleDateString()]})]})]})]})]}),L&&c.jsx("div",{className:"mt-8 space-y-6",children:c.jsxs(Al,{defaultValue:"upload",className:"w-full",children:[c.jsxs(Lc,{className:"grid w-full grid-cols-2",children:[c.jsxs(kn,{value:"upload",className:"flex items-center gap-2",children:[c.jsx(oa,{className:"h-4 w-4"}),"Upload Lab Results"]}),c.jsxs(kn,{value:"history",className:"flex items-center gap-2",children:[c.jsx(oa,{className:"h-4 w-4"}),"Lab History"]})]}),c.jsx(Ln,{value:"upload",className:"mt-6",children:c.jsx(vPe,{patientId:b||""})}),c.jsx(Ln,{value:"history",className:"mt-6",children:c.jsx(yPe,{patientId:b||""})})]})})]}):c.jsx(_e,{children:c.jsxs(Te,{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(gp,{className:"h-12 w-12 text-muted-foreground mb-4 opacity-50"}),c.jsx("p",{className:"text-lg font-medium",children:"Patient not found"}),c.jsx(we,{onClick:()=>s("/patients"),className:"mt-4",children:"Back to Patients"})]})})}var W1="Switch",[TPe,V1e]=Vo(W1),[bPe,wPe]=TPe(W1),Tte=I.forwardRef((r,s)=>{const{__scopeSwitch:o,name:d,checked:p,defaultChecked:f,required:E,disabled:y,value:b="on",onCheckedChange:C,form:A,...D}=r,[k,W]=I.useState(null),G=Zn(s,K=>W(K)),L=I.useRef(!1),B=k?A||!!k.closest("form"):!0,[H=!1,V]=Du({prop:p,defaultProp:f,onChange:C});return c.jsxs(bPe,{scope:o,checked:H,disabled:y,children:[c.jsx($t.button,{type:"button",role:"switch","aria-checked":H,"aria-required":E,"data-state":Cte(H),"data-disabled":y?"":void 0,disabled:y,value:b,...D,ref:G,onClick:Vt(r.onClick,K=>{V(Z=>!Z),B&&(L.current=K.isPropagationStopped(),L.current||K.stopPropagation())})}),B&&c.jsx(CPe,{control:k,bubbles:!L.current,name:d,value:b,checked:H,required:E,disabled:y,form:A,style:{transform:"translateX(-100%)"}})]})});Tte.displayName=W1;var bte="SwitchThumb",wte=I.forwardRef((r,s)=>{const{__scopeSwitch:o,...d}=r,p=wPe(bte,o);return c.jsx($t.span,{"data-state":Cte(p.checked),"data-disabled":p.disabled?"":void 0,...d,ref:s})});wte.displayName=bte;var CPe=r=>{const{control:s,checked:o,bubbles:d=!0,...p}=r,f=I.useRef(null),E=vee(o),y=NQ(s);return I.useEffect(()=>{const b=f.current,C=window.HTMLInputElement.prototype,D=Object.getOwnPropertyDescriptor(C,"checked").set;if(E!==o&&D){const k=new Event("click",{bubbles:d});D.call(b,o),b.dispatchEvent(k)}},[E,o,d]),c.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o,...p,tabIndex:-1,ref:f,style:{...r.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Cte(r){return r?"checked":"unchecked"}var Rte=Tte,RPe=wte;const xte=I.forwardRef(({className:r,...s},o)=>c.jsx(Rte,{className:ct("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...s,ref:o,children:c.jsx(RPe,{className:ct("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));xte.displayName=Rte.displayName;const Cp=I.forwardRef(({className:r,...s},o)=>c.jsx("div",{className:"relative w-full overflow-auto",children:c.jsx("table",{ref:o,className:ct("w-full caption-bottom text-sm",r),...s})}));Cp.displayName="Table";const Rp=I.forwardRef(({className:r,...s},o)=>c.jsx("thead",{ref:o,className:ct("[&_tr]:border-b",r),...s}));Rp.displayName="TableHeader";const xp=I.forwardRef(({className:r,...s},o)=>c.jsx("tbody",{ref:o,className:ct("[&_tr:last-child]:border-0",r),...s}));xp.displayName="TableBody";const xPe=I.forwardRef(({className:r,...s},o)=>c.jsx("tfoot",{ref:o,className:ct("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s}));xPe.displayName="TableFooter";const ia=I.forwardRef(({className:r,...s},o)=>c.jsx("tr",{ref:o,className:ct("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...s}));ia.displayName="TableRow";const $n=I.forwardRef(({className:r,...s},o)=>c.jsx("th",{ref:o,className:ct("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s}));$n.displayName="TableHead";const Gn=I.forwardRef(({className:r,...s},o)=>c.jsx("td",{ref:o,className:ct("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s}));Gn.displayName="TableCell";const NPe=I.forwardRef(({className:r,...s},o)=>c.jsx("caption",{ref:o,className:ct("mt-4 text-sm text-muted-foreground",r),...s}));NPe.displayName="TableCaption";var Nte="AlertDialog",[IPe,F1e]=Vo(Nte,[hJ]),vd=hJ(),Ite=r=>{const{__scopeAlertDialog:s,...o}=r,d=vd(s);return c.jsx(T1,{...d,...o,modal:!0})};Ite.displayName=Nte;var APe="AlertDialogTrigger",OPe=I.forwardRef((r,s)=>{const{__scopeAlertDialog:o,...d}=r,p=vd(o);return c.jsx(NJ,{...p,...d,ref:s})});OPe.displayName=APe;var PPe="AlertDialogPortal",Ate=r=>{const{__scopeAlertDialog:s,...o}=r,d=vd(s);return c.jsx(b1,{...d,...o})};Ate.displayName=PPe;var DPe="AlertDialogOverlay",Ote=I.forwardRef((r,s)=>{const{__scopeAlertDialog:o,...d}=r,p=vd(o);return c.jsx(Hv,{...p,...d,ref:s})});Ote.displayName=DPe;var zf="AlertDialogContent",[kPe,LPe]=IPe(zf),jPe=CX("AlertDialogContent"),Pte=I.forwardRef((r,s)=>{const{__scopeAlertDialog:o,children:d,...p}=r,f=vd(o),E=I.useRef(null),y=Zn(s,E),b=I.useRef(null);return c.jsx(Gxe,{contentName:zf,titleName:Dte,docsSlug:"alert-dialog",children:c.jsx(kPe,{scope:o,cancelRef:b,children:c.jsxs(Kv,{role:"alertdialog",...f,...p,ref:y,onOpenAutoFocus:Vt(p.onOpenAutoFocus,C=>{var A;C.preventDefault(),(A=b.current)==null||A.focus({preventScroll:!0})}),onPointerDownOutside:C=>C.preventDefault(),onInteractOutside:C=>C.preventDefault(),children:[c.jsx(jPe,{children:d}),c.jsx(UPe,{contentRef:E})]})})})});Pte.displayName=zf;var Dte="AlertDialogTitle",kte=I.forwardRef((r,s)=>{const{__scopeAlertDialog:o,...d}=r,p=vd(o);return c.jsx(zv,{...p,...d,ref:s})});kte.displayName=Dte;var Lte="AlertDialogDescription",jte=I.forwardRef((r,s)=>{const{__scopeAlertDialog:o,...d}=r,p=vd(o);return c.jsx(qv,{...p,...d,ref:s})});jte.displayName=Lte;var MPe="AlertDialogAction",Mte=I.forwardRef((r,s)=>{const{__scopeAlertDialog:o,...d}=r,p=vd(o);return c.jsx(Rw,{...p,...d,ref:s})});Mte.displayName=MPe;var Ute="AlertDialogCancel",Vte=I.forwardRef((r,s)=>{const{__scopeAlertDialog:o,...d}=r,{cancelRef:p}=LPe(Ute,o),f=vd(o),E=Zn(s,p);return c.jsx(Rw,{...f,...d,ref:E})});Vte.displayName=Ute;var UPe=({contentRef:r})=>{const s=`\`${zf}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${zf}\` by passing a \`${Lte}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${zf}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return I.useEffect(()=>{var d;document.getElementById((d=r.current)==null?void 0:d.getAttribute("aria-describedby"))||console.warn(s)},[s,r]),null},VPe=Ite,FPe=Ate,Fte=Ote,Bte=Pte,Gte=Mte,Wte=Vte,Hte=kte,Kte=jte;const BPe=VPe,GPe=FPe,zte=I.forwardRef(({className:r,...s},o)=>c.jsx(Fte,{className:ct("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...s,ref:o}));zte.displayName=Fte.displayName;const qte=I.forwardRef(({className:r,...s},o)=>c.jsxs(GPe,{children:[c.jsx(zte,{}),c.jsx(Bte,{ref:o,className:ct("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s})]}));qte.displayName=Bte.displayName;const Yte=({className:r,...s})=>c.jsx("div",{className:ct("flex flex-col space-y-2 text-center sm:text-left",r),...s});Yte.displayName="AlertDialogHeader";const Xte=({className:r,...s})=>c.jsx("div",{className:ct("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...s});Xte.displayName="AlertDialogFooter";const Qte=I.forwardRef(({className:r,...s},o)=>c.jsx(Hte,{ref:o,className:ct("text-lg font-semibold",r),...s}));Qte.displayName=Hte.displayName;const Jte=I.forwardRef(({className:r,...s},o)=>c.jsx(Kte,{ref:o,className:ct("text-sm text-muted-foreground",r),...s}));Jte.displayName=Kte.displayName;const $te=I.forwardRef(({className:r,...s},o)=>c.jsx(Gte,{ref:o,className:ct(f1(),r),...s}));$te.displayName=Gte.displayName;const Zte=I.forwardRef(({className:r,...s},o)=>c.jsx(Wte,{ref:o,className:ct(f1({variant:"outline"}),"mt-2 sm:mt-0",r),...s}));Zte.displayName=Wte.displayName;function WPe(){const{user:r}=ts(),{toast:s}=jr(),[o,d]=I.useState(""),[p,f]=I.useState({open:!1,userId:"",action:"activate"}),{data:E,isLoading:y}=In({queryKey:["/api/users"]}),b=Lr({mutationFn:async({userId:W,isActive:G})=>await(await Ot("PATCH",`/api/users/${W}`,{isActive:G?1:0})).json(),onSuccess:(W,G)=>{s({title:G.isActive?"User Activated":"User Deactivated",description:`User account has been ${G.isActive?"activated":"deactivated"} successfully.`}),Nc.invalidateQueries({queryKey:["/api/users"]})},onError:W=>{s({title:"Action Failed",description:W.message,variant:"destructive"})}}),C=(W,G)=>{f({open:!0,userId:W,action:(G===1?0:1)===1?"activate":"deactivate"})},A=()=>{b.mutate({userId:p.userId,isActive:p.action==="activate"}),f({open:!1,userId:"",action:"activate"})},D=E==null?void 0:E.filter(W=>W.fullName.toLowerCase().includes(o.toLowerCase())||W.username.toLowerCase().includes(o.toLowerCase())),k=W=>{switch(W){case"admin":return"bg-destructive text-destructive-foreground";case"doctor":return"bg-primary text-primary-foreground";case"nurse":return"bg-success text-success-foreground";default:return"bg-secondary text-secondary-foreground"}};return(r==null?void 0:r.role)!=="admin"?c.jsx(_e,{children:c.jsxs(Te,{className:"flex flex-col items-center justify-center py-12",children:[c.jsx(iQ,{className:"h-12 w-12 text-muted-foreground mb-4 opacity-50"}),c.jsx("p",{className:"text-lg font-medium",children:"Access Denied"}),c.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Only administrators can access user management"})]})}):c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold","data-testid":"text-users-title",children:"User Management"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage doctor and nurse accounts"})]})}),c.jsxs("div",{className:"relative",children:[c.jsx(Uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(at,{placeholder:"Search by name or username...",value:o,onChange:W=>d(W.target.value),className:"pl-10","data-testid":"input-search-users"})]}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"System Users"}),c.jsx(Cn,{children:"All registered doctors, nurses, and administrators"})]}),c.jsx(Te,{children:y?c.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(W=>c.jsx(yl,{className:"h-16 w-full"},W))}):D&&D.length>0?c.jsx("div",{className:"rounded-md border",children:c.jsxs(Cp,{children:[c.jsx(Rp,{children:c.jsxs(ia,{children:[c.jsx($n,{children:"Name"}),c.jsx($n,{children:"Username"}),c.jsx($n,{children:"Role"}),c.jsx($n,{children:"Status"}),c.jsx($n,{className:"text-right",children:"Actions"})]})}),c.jsx(xp,{children:D.map(W=>c.jsxs(ia,{"data-testid":`row-user-${W.id}`,children:[c.jsx(Gn,{className:"font-medium","data-testid":`text-user-name-${W.id}`,children:W.fullName}),c.jsx(Gn,{className:"font-mono text-sm","data-testid":`text-username-${W.id}`,children:W.username}),c.jsx(Gn,{children:c.jsx(xt,{className:k(W.role),"data-testid":`badge-role-${W.id}`,children:W.role.toUpperCase()})}),c.jsx(Gn,{children:c.jsx(xt,{variant:W.isActive?"default":"outline",className:W.isActive?"bg-success text-success-foreground":"","data-testid":`badge-status-${W.id}`,children:W.isActive?"Active":"Inactive"})}),c.jsx(Gn,{className:"text-right",children:W.id!==r.id&&c.jsxs("div",{className:"flex items-center justify-end gap-2",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:W.isActive?"Active":"Inactive"}),c.jsx(xte,{checked:W.isActive===1,onCheckedChange:()=>C(W.id,W.isActive),"data-testid":`switch-user-status-${W.id}`})]})})]},W.id))})]})}):c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(Uo,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),c.jsx("p",{children:"No users found"})]})})]}),c.jsx(BPe,{open:p.open,onOpenChange:W=>!W&&f({...p,open:W}),children:c.jsxs(qte,{children:[c.jsxs(Yte,{children:[c.jsx(Qte,{children:p.action==="activate"?"Activate User?":"Deactivate User?"}),c.jsx(Jte,{children:p.action==="activate"?"This user will be able to log in and access the system.":"This user will no longer be able to log in or access the system."})]}),c.jsxs(Xte,{children:[c.jsx(Zte,{"data-testid":"button-cancel-confirm",children:"Cancel"}),c.jsx($te,{onClick:A,"data-testid":"button-confirm-action",children:p.action==="activate"?"Activate":"Deactivate"})]})]})})]})}const HPe=ni({appointmentDate:kt().min(1,"Date is required"),reason:kt().min(5,"Please provide a reason"),doctorId:kt().min(1,"Please select a doctor")});function KPe(){const{user:r}=ts(),{toast:s}=jr(),[o,d]=I.useState(!1),[p,f]=I.useState(null),E=Pg({resolver:Dg(HPe),defaultValues:{appointmentDate:"",reason:"",doctorId:""}}),{data:y=[],isLoading:b}=In({queryKey:["/api/appointments/patient",r==null?void 0:r.id],queryFn:async()=>(await Ot("GET",`/api/appointments/patient/${r==null?void 0:r.id}`)).json()}),{data:C=[]}=In({queryKey:["/api/doctors"],queryFn:async()=>(await(await Ot("GET","/api/auth/users")).json()).filter(H=>H.role==="doctor")}),A=Lr({mutationFn:async L=>p?(await Ot("PATCH",`/api/appointments/${p}`,{appointmentDate:new Date(L.appointmentDate),reason:L.reason,doctorId:L.doctorId})).json():(await Ot("POST","/api/appointments",{patientId:r==null?void 0:r.id,appointmentDate:new Date(L.appointmentDate),reason:L.reason,doctorId:L.doctorId})).json(),onSuccess:()=>{Nc.invalidateQueries({queryKey:["/api/appointments/patient",r==null?void 0:r.id]}),s({title:"Success",description:p?"Appointment updated successfully!":"Appointment booked successfully!"}),E.reset(),f(null),d(!1)},onError:()=>{s({title:"Error",description:p?"Failed to update appointment":"Failed to book appointment",variant:"destructive"})}}),D=Lr({mutationFn:async L=>(await Ot("DELETE",`/api/appointments/${L}`,{})).json(),onSuccess:()=>{Nc.invalidateQueries({queryKey:["/api/appointments/patient",r==null?void 0:r.id]}),s({title:"Success",description:"Appointment cancelled successfully!"})},onError:()=>{s({title:"Error",description:"Failed to cancel appointment",variant:"destructive"})}}),k=L=>{f(L.id),E.reset({doctorId:L.doctorId,appointmentDate:new Date(L.appointmentDate).toISOString().slice(0,16),reason:L.reason}),d(!0)},W=()=>{f(null),E.reset(),d(!1)},G=L=>{switch(L){case"confirmed":return"default";case"pending":return"secondary";case"completed":return"outline";case"cancelled":return"destructive";default:return"secondary"}};return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"My Appointments"}),c.jsx("p",{className:"text-muted-foreground",children:"View and book appointments with doctors"})]}),c.jsxs(us,{open:o,onOpenChange:W,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{"data-testid":"button-book-appointment-new",children:[c.jsx(wl,{className:"w-4 h-4 mr-2"}),"Book Appointment"]})}),c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsx(ms,{children:p?"Edit Appointment":"Book an Appointment"})}),c.jsx(kg,{...E,children:c.jsxs("form",{onSubmit:E.handleSubmit(L=>A.mutate(L)),className:"space-y-4",children:[c.jsx(_r,{control:E.control,name:"doctorId",render:({field:L})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Select Doctor"}),c.jsxs(Wn,{onValueChange:L.onChange,defaultValue:L.value,children:[c.jsx(ur,{children:c.jsx(jn,{children:c.jsx(Hn,{placeholder:"Choose a doctor"})})}),c.jsx(Mn,{children:C.map(B=>c.jsx(ke,{value:B.id,children:B.fullName},B.id))})]}),c.jsx(hr,{})]})}),c.jsx(_r,{control:E.control,name:"appointmentDate",render:({field:L})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Date & Time"}),c.jsx(ur,{children:c.jsx(at,{type:"datetime-local",...L,"data-testid":"input-appointment-date"})}),c.jsx(hr,{})]})}),c.jsx(_r,{control:E.control,name:"reason",render:({field:L})=>c.jsxs(lr,{children:[c.jsx(dr,{children:"Reason for Visit"}),c.jsx(ur,{children:c.jsx(ii,{placeholder:"Describe your reason for the appointment",...L,"data-testid":"textarea-appointment-reason"})}),c.jsx(hr,{})]})}),c.jsx(we,{type:"submit",className:"w-full",disabled:A.isPending,"data-testid":"button-book-appointment",children:A.isPending?p?"Updating...":"Booking...":p?"Update Appointment":"Book Appointment"})]})})]})]})]}),b?c.jsx("div",{className:"text-center py-8",children:"Loading appointments..."}):y.length===0?c.jsxs(_e,{className:"p-8 text-center",children:[c.jsx("p",{className:"text-muted-foreground mb-4",children:"No appointments booked yet"}),c.jsx(us,{open:o,onOpenChange:d,children:c.jsx(Wi,{asChild:!0,children:c.jsx(we,{children:"Book Your First Appointment"})})})]}):c.jsx("div",{className:"grid gap-4",children:y.map(L=>c.jsx(_e,{className:"p-4",children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"space-y-2 flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(gp,{className:"w-4 h-4"}),c.jsxs("span",{className:"font-semibold",children:["Doctor: ",L.doctorId]})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(pd,{className:"w-4 h-4"}),c.jsx("span",{"data-testid":`text-appointment-date-${L.id}`,children:new Date(L.appointmentDate).toLocaleDateString()})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(md,{className:"w-4 h-4"}),c.jsx("span",{children:new Date(L.appointmentDate).toLocaleTimeString()})]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:L.reason})]}),c.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[c.jsx(xt,{variant:G(L.status),children:L.status}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(we,{size:"sm",variant:"outline",onClick:()=>k(L),"data-testid":`button-edit-appointment-${L.id}`,children:c.jsx(ywe,{className:"w-4 h-4"})}),c.jsx(we,{size:"sm",variant:"destructive",onClick:()=>D.mutate(L.id),disabled:D.isPending,"data-testid":`button-delete-appointment-${L.id}`,children:c.jsx(r1,{className:"w-4 h-4"})})]})]})]})},L.id))})]})}function zPe(){const{user:r}=ts(),{toast:s}=jr(),{data:o=[],isLoading:d}=In({queryKey:["/api/appointments/doctor",r==null?void 0:r.id],queryFn:async()=>(await Ot("GET",`/api/appointments/doctor/${r==null?void 0:r.id}`)).json()}),p=Lr({mutationFn:async C=>(await Ot("PATCH",`/api/appointments/${C}`,{status:"confirmed"})).json(),onSuccess:()=>{Nc.invalidateQueries({queryKey:["/api/appointments/doctor",r==null?void 0:r.id]}),s({title:"Success",description:"Appointment confirmed!"})},onError:()=>{s({title:"Error",description:"Failed to confirm appointment",variant:"destructive"})}}),f=Lr({mutationFn:async C=>(await Ot("PATCH",`/api/appointments/${C}`,{status:"cancelled"})).json(),onSuccess:()=>{Nc.invalidateQueries({queryKey:["/api/appointments/doctor",r==null?void 0:r.id]}),s({title:"Success",description:"Appointment cancelled"})},onError:()=>{s({title:"Error",description:"Failed to cancel appointment",variant:"destructive"})}}),E=C=>{switch(C){case"confirmed":return"default";case"pending":return"secondary";case"completed":return"outline";case"cancelled":return"destructive";default:return"secondary"}},y=o.filter(C=>C.status==="pending"),b=o.filter(C=>C.status==="confirmed");return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Appointments"}),c.jsx("p",{className:"text-muted-foreground",children:"Manage patient appointments and confirmations"})]}),d?c.jsx("div",{className:"text-center py-8",children:"Loading appointments..."}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Pending Confirmations (",y.length,")"]}),y.length===0?c.jsx(_e,{className:"p-4 text-center text-muted-foreground",children:"No pending appointments"}):c.jsx("div",{className:"grid gap-4",children:y.map(C=>c.jsx(_e,{className:"p-4",children:c.jsxs("div",{className:"flex items-start justify-between gap-4",children:[c.jsxs("div",{className:"space-y-2 flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(gp,{className:"w-4 h-4"}),c.jsxs("span",{className:"font-semibold",children:["Patient ID: ",C.patientId]})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(pd,{className:"w-4 h-4"}),c.jsx("span",{children:new Date(C.appointmentDate).toLocaleDateString()})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(md,{className:"w-4 h-4"}),c.jsx("span",{children:new Date(C.appointmentDate).toLocaleTimeString()})]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:C.reason})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(we,{size:"sm",variant:"default",onClick:()=>p.mutate(C.id),disabled:p.isPending,"data-testid":`button-confirm-${C.id}`,children:[c.jsx(Na,{className:"w-4 h-4 mr-1"}),"Confirm"]}),c.jsxs(we,{size:"sm",variant:"destructive",onClick:()=>f.mutate(C.id),disabled:f.isPending,"data-testid":`button-cancel-${C.id}`,children:[c.jsx(gw,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]})},C.id))})]}),c.jsxs("div",{children:[c.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Confirmed Appointments (",b.length,")"]}),b.length===0?c.jsx(_e,{className:"p-4 text-center text-muted-foreground",children:"No confirmed appointments"}):c.jsx("div",{className:"grid gap-4",children:b.map(C=>c.jsx(_e,{className:"p-4",children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(gp,{className:"w-4 h-4"}),c.jsxs("span",{className:"font-semibold",children:["Patient ID: ",C.patientId]})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(pd,{className:"w-4 h-4"}),c.jsx("span",{children:new Date(C.appointmentDate).toLocaleDateString()})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[c.jsx(md,{className:"w-4 h-4"}),c.jsx("span",{children:new Date(C.appointmentDate).toLocaleTimeString()})]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:C.reason})]}),c.jsx(xt,{variant:E(C.status),children:C.status})]})},C.id))})]})]})]})}function qPe(){const{user:r}=ts(),{toast:s}=jr(),o=(r==null?void 0:r.role)==="admin",d=o?r==null?void 0:r.id:r==null?void 0:r.hospitalAdminId,[p,f]=I.useState(!1),[E,y]=I.useState(null),[b,C]=I.useState(null),[A,D]=I.useState(!1),[k,W]=I.useState({email:"",cardNumber:"",expiry:"",cvc:"",cardholderName:"",country:"Nigeria",address1:"",address2:"",suburb:""}),{data:G,isLoading:L}=In({queryKey:["/api/subscription",d],enabled:!!d}),B=Lr({mutationFn:async oe=>await(await Ot("POST",`/api/subscription/${d}/upgrade`,{billingCycle:oe.billingCycle,paymentMethod:oe.paymentMethod,...oe.cardDetails&&{cardDetails:oe.cardDetails}})).json(),onSuccess:()=>{s({title:"Success",description:"You've upgraded to Hospital plan! Your entire team gets access."}),window.location.reload()},onError:()=>{s({title:"Error",description:"Failed to upgrade subscription",variant:"destructive"})}}),H=()=>{navigator.clipboard.writeText("1228732577"),D(!0),setTimeout(()=>D(!1),2e3)},V=()=>{E==="monthly"?window.location.href=`https://paystack.com/pay/hospital-plan-monthly?reference=${d}`:window.location.href=`https://paystack.com/pay/hospital-plan-yearly?reference=${d}`},K=()=>{B.mutate({billingCycle:E,paymentMethod:"bank"}),f(!1)},Z=()=>{if(!k.email||!k.cardNumber||!k.expiry||!k.cvc||!k.cardholderName){s({title:"Error",description:"Please fill in all card details",variant:"destructive"});return}B.mutate({billingCycle:E,paymentMethod:"card",cardDetails:k}),f(!1)},ee=Lr({mutationFn:async()=>await(await Ot("POST",`/api/subscription/${d}/cancel`,{})).json(),onSuccess:()=>{s({title:"Subscription Cancelled",description:"Your Hospital subscription has been cancelled."}),window.location.reload()},onError:()=>{s({title:"Error",description:"Failed to cancel subscription",variant:"destructive"})}}),$=(G==null?void 0:G.status)==="trial",se=(G==null?void 0:G.status)==="active"&&(G==null?void 0:G.tier)==="hospital";if(!o)return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Billing & Subscription"}),c.jsx("p",{className:"text-gray-600 mt-2",children:"Appointment Booking"})]}),c.jsx(_e,{className:"bg-blue-50 border-blue-200",children:c.jsxs(Te,{className:"pt-6 space-y-4",children:[c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(bl,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-blue-900",children:"Appointment Fee"}),c.jsxs("p",{className:"text-blue-800 mt-1",children:["Each appointment booking costs ",c.jsx("span",{className:"font-bold",children:"1,000"})]})]})]}),c.jsx("div",{className:"pt-4 border-t border-blue-200",children:c.jsx("p",{className:"text-sm text-blue-800",children:"Your hospital admin manages the hospital subscription. You have access to all features through your hospital's plan."})})]})})]});const X=(()=>{if(!(G!=null&&G.trialEndDate))return 0;const oe=new Date,je=new Date(G.trialEndDate),Ce=Math.ceil((je.getTime()-oe.getTime())/(1e3*60*60*24));return Math.max(0,Ce)})();return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Billing & Subscription"}),c.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your subscription plan and billing settings"})]}),L?c.jsx("div",{className:"flex items-center justify-center py-12",children:c.jsx("p",{className:"text-muted-foreground",children:"Loading subscription info..."})}):c.jsxs(c.Fragment,{children:[c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Current Plan"})}),c.jsxs(Te,{className:"space-y-4",children:[c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"text-lg font-semibold",children:se?"Hospital Plan":"Free Trial"}),c.jsx(xt,{variant:se?"default":"secondary",children:se?"Active":"Trial"})]}),$&&c.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[X," days remaining in your free trial"]}),se&&(G==null?void 0:G.billingCycle)&&c.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[G.billingCycle==="monthly"?"15,000 per month":"100,000 per year"," - All staff get access"]})]})}),se&&c.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[c.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 flex gap-3",children:[c.jsx(bl,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),c.jsxs("div",{children:[c.jsx("h4",{className:"font-semibold text-red-900",children:"Warning"}),c.jsx("p",{className:"text-sm text-red-800 mt-1",children:"If you cancel your subscription, all hospital records will be lost permanently."})]})]}),c.jsx(we,{variant:"destructive",onClick:()=>ee.mutate(),disabled:ee.isPending,"data-testid":"button-cancel-subscription",children:ee.isPending?"Cancelling...":"Cancel Subscription"})]})]})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Hospital Subscription Plans"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs(_e,{className:"relative",children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Monthly"}),c.jsx(Cn,{children:"Perfect for ongoing access"})]}),c.jsxs(Te,{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-4xl font-bold",children:"15,000"}),c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"per month"})]}),c.jsx("ul",{className:"space-y-3",children:["All staff get full access","All AI features","Advanced diagnostics","Lab analysis","Appointment management","Email support"].map(oe=>c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx(bP,{className:"h-4 w-4 text-green-600"}),c.jsx("span",{className:"text-sm",children:oe})]},oe))}),c.jsx(we,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{y("monthly"),f(!0)},disabled:se,"data-testid":"button-upgrade-monthly",children:se?"Current Plan":"Upgrade Now"})]})]}),c.jsxs(_e,{className:"relative border-2 border-blue-600",children:[c.jsx("div",{className:"absolute top-0 right-0 bg-blue-600 text-white px-4 py-1 rounded-bl-md text-sm font-semibold",children:"Save 33%"}),c.jsxs(Ke,{children:[c.jsx(ze,{children:"Yearly"}),c.jsx(Cn,{children:"Best value - Save 2 months"})]}),c.jsxs(Te,{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-4xl font-bold",children:"100,000"}),c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"per year"})]}),c.jsx("ul",{className:"space-y-3",children:["All staff get full access","All AI features","Advanced diagnostics","Lab analysis","Appointment management","Priority support"].map(oe=>c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx(bP,{className:"h-4 w-4 text-green-600"}),c.jsx("span",{className:"text-sm",children:oe})]},oe))}),c.jsx(we,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{y("yearly"),f(!0)},disabled:se,"data-testid":"button-upgrade-yearly",children:se?"Current Plan":"Upgrade Now"})]})]})]})]}),$&&c.jsxs(_e,{className:"bg-blue-50 border-blue-200",children:[c.jsx(Ke,{children:c.jsx(ze,{className:"text-blue-900",children:"Free Trial Information"})}),c.jsxs(Te,{className:"text-blue-800",children:[c.jsx("p",{children:"You're currently on a free 30-day trial with access to all Pro features. After your trial ends, you'll need to upgrade to continue using advanced features like AI diagnostics, lab analysis, and more."}),c.jsxs("p",{className:"mt-4 font-semibold",children:["Trial ends on: ",G!=null&&G.trialEndDate?new Date(G.trialEndDate).toLocaleDateString():"N/A"]})]})]})]}),c.jsx(us,{open:p,onOpenChange:f,children:c.jsxs(hs,{className:"max-w-md",children:[c.jsxs(ps,{children:[c.jsx(ms,{children:"Select Payment Method"}),c.jsx(Tc,{children:E==="monthly"?"15,000 per month - All staff get full access":"100,000 per year - All staff get full access"})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"border rounded-lg p-4 space-y-3 hover-elevate cursor-pointer",onClick:()=>C("bank"),children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("input",{type:"radio",name:"payment",value:"bank",checked:b==="bank",onChange:()=>C("bank"),className:"mt-1","data-testid":"radio-bank-transfer"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-sm",children:"Bank Transfer"}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Transfer to Zenith Bank"})]})]})}),b==="bank"&&c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground font-semibold",children:"Bank"}),c.jsx("p",{className:"text-sm font-semibold",children:"Zenith Bank"})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground font-semibold",children:"Account Number"}),c.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[c.jsx("p",{className:"text-sm font-mono font-bold",children:"1228732577"}),c.jsx("button",{onClick:H,className:"p-1 hover-elevate rounded","data-testid":"button-copy-account",children:A?c.jsx(Ng,{className:"h-4 w-4 text-green-600"}):c.jsx(swe,{className:"h-4 w-4"})})]})]}),c.jsx("div",{className:"text-xs text-blue-700 bg-blue-100 rounded p-2",children:"Please note your reference ID for verification after transfer"})]}),c.jsx("div",{className:"border rounded-lg p-4 space-y-3 hover-elevate cursor-pointer",onClick:()=>C("paystack"),children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("input",{type:"radio",name:"payment",value:"paystack",checked:b==="paystack",onChange:()=>C("paystack"),className:"mt-1","data-testid":"radio-paystack"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-sm",children:"Paystack"}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Online card payment"})]})]})}),c.jsx("div",{className:"border rounded-lg p-4 space-y-3 hover-elevate cursor-pointer",onClick:()=>C("card"),children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("input",{type:"radio",name:"payment",value:"card",checked:b==="card",onChange:()=>C("card"),className:"mt-1","data-testid":"radio-card"}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"font-semibold text-sm",children:"Card"}),c.jsx(Uf,{className:"h-4 w-4"})]}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Direct card payment"})]})]})}),b==="card"&&c.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-xs font-semibold text-muted-foreground",children:"Email"}),c.jsx(at,{type:"email",placeholder:"contact@hospital.com",value:k.email,onChange:oe=>W({...k,email:oe.target.value}),"data-testid":"input-card-email",className:"mt-1"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs font-semibold text-muted-foreground",children:"Card Number"}),c.jsx(at,{placeholder:"1234 1234 1234 1234",value:k.cardNumber,onChange:oe=>W({...k,cardNumber:oe.target.value.replace(/\s/g,"").slice(0,16)}),"data-testid":"input-card-number",className:"mt-1 font-mono"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-xs font-semibold text-muted-foreground",children:"MM / YY"}),c.jsx(at,{placeholder:"MM/YY",value:k.expiry,onChange:oe=>W({...k,expiry:oe.target.value.slice(0,5)}),"data-testid":"input-card-expiry",className:"mt-1"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs font-semibold text-muted-foreground",children:"CVC"}),c.jsx(at,{placeholder:"123",value:k.cvc,onChange:oe=>W({...k,cvc:oe.target.value.slice(0,4)}),"data-testid":"input-card-cvc",className:"mt-1"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs font-semibold text-muted-foreground",children:"Cardholder Name"}),c.jsx(at,{placeholder:"Full name on card",value:k.cardholderName,onChange:oe=>W({...k,cardholderName:oe.target.value}),"data-testid":"input-cardholder-name",className:"mt-1"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs font-semibold text-muted-foreground",children:"Billing Address"}),c.jsxs(Wn,{value:k.country,onValueChange:oe=>W({...k,country:oe}),children:[c.jsx(jn,{className:"mt-1","data-testid":"select-country",children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"Nigeria",children:"Nigeria"}),c.jsx(ke,{value:"Ghana",children:"Ghana"}),c.jsx(ke,{value:"Kenya",children:"Kenya"}),c.jsx(ke,{value:"South Africa",children:"South Africa"}),c.jsx(ke,{value:"Other",children:"Other"})]})]})]}),c.jsx("div",{children:c.jsx(at,{placeholder:"Address line 1",value:k.address1,onChange:oe=>W({...k,address1:oe.target.value}),"data-testid":"input-address-line1"})}),c.jsx("div",{children:c.jsx(at,{placeholder:"Address line 2",value:k.address2,onChange:oe=>W({...k,address2:oe.target.value}),"data-testid":"input-address-line2"})}),c.jsx("div",{children:c.jsx(at,{placeholder:"Suburb/City",value:k.suburb,onChange:oe=>W({...k,suburb:oe.target.value}),"data-testid":"input-suburb"})})]}),c.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[c.jsx(we,{variant:"outline",onClick:()=>{f(!1),C(null)},"data-testid":"button-cancel-payment",children:"Cancel"}),c.jsx(we,{onClick:()=>{b==="bank"?K():b==="paystack"?V():b==="card"&&Z()},disabled:!b||B.isPending,className:"flex-1 bg-blue-600 hover:bg-blue-700","data-testid":"button-proceed-payment",children:B.isPending?"Processing...":"Proceed"})]})]})]})})]})}function YPe(){const{user:r}=ts(),s=r==null?void 0:r.departmentId,{data:o=[],isLoading:d}=In({queryKey:["/api/departments",s,"notifications"],enabled:!!s}),p=b=>{switch(b){case"critical":return"bg-red-100 text-red-800 border-red-300";case"high":return"bg-orange-100 text-orange-800 border-orange-300";case"normal":return"bg-blue-100 text-blue-800 border-blue-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},f=b=>{switch(b){case"emergency_alert":return c.jsx(bl,{className:"h-5 w-5 text-red-600"});case"lab_result":return c.jsx(Ng,{className:"h-5 w-5 text-green-600"});default:return c.jsx(md,{className:"h-5 w-5 text-blue-600"})}},E=o.filter(b=>b.status==="unread").length,y=o.filter(b=>b.status!=="completed").length;return s?c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Department Dashboard"}),c.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage service requests and patient notifications"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-2",children:c.jsx(ze,{className:"text-sm font-medium text-muted-foreground",children:"Unread Notifications"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-3xl font-bold",children:E}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Require attention"})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-2",children:c.jsx(ze,{className:"text-sm font-medium text-muted-foreground",children:"Active Requests"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-3xl font-bold",children:y}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"In progress"})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-2",children:c.jsx(ze,{className:"text-sm font-medium text-muted-foreground",children:"Total Notifications"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-3xl font-bold",children:o.length}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"All time"})]})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx(ze,{children:"Service Requests"}),c.jsx(Cn,{children:"Patient requests and consultations"})]}),c.jsx(dwe,{className:"h-5 w-5 text-muted-foreground"})]})}),c.jsx(Te,{children:d?c.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):o.length===0?c.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No notifications yet"}):c.jsx("div",{className:"space-y-3",children:o.map(b=>c.jsx("div",{className:"border rounded-lg p-4 hover-elevate transition-colors","data-testid":`notification-${b.id}`,children:c.jsxs("div",{className:"flex items-start justify-between gap-4",children:[c.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[f(b.type),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"font-semibold",children:b.title}),c.jsx(xt,{variant:"outline",className:`text-xs ${p(b.priority)}`,"data-testid":`badge-priority-${b.priority}`,children:b.priority})]}),c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:b.message}),c.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-muted-foreground",children:[c.jsx("span",{children:"Status:"}),c.jsx(xt,{variant:"secondary","data-testid":`badge-status-${b.status}`,children:b.status})]})]})]}),c.jsx("div",{className:"text-xs text-muted-foreground text-right",children:new Date(b.createdAt).toLocaleDateString()})]})},b.id))})})]})]}):c.jsx("div",{className:"text-center py-8",children:c.jsx("p",{className:"text-muted-foreground",children:"You are not assigned to any department"})})}function XPe(){const{user:r}=ts(),{toast:s}=jr(),[o,d]=I.useState(!1),[p,f]=I.useState(null),[E,y]=I.useState({title:"",message:"",type:"consultation_request",priority:"normal"}),{data:b=[]}=In({queryKey:["/api/admin/departments",r==null?void 0:r.id],queryFn:async()=>await(await Ot("GET",`/api/admin/departments/${r==null?void 0:r.id}`)).json(),enabled:!!(r!=null&&r.id)}),{data:C={}}=In({queryKey:["/api/admin/departments/staff"],queryFn:async()=>await(await Ot("GET","/api/admin/departments/staff")).json()}),A=Lr({mutationFn:async()=>p?await(await Ot("POST",`/api/departments/${p.id}/notifications`,{...E,patientId:"system-task",requestedBy:r==null?void 0:r.id,status:"unread"})).json():void 0,onSuccess:()=>{s({title:"Success",description:"Task assigned to department"}),d(!1),y({title:"",message:"",type:"consultation_request",priority:"normal"}),Nc.invalidateQueries({queryKey:["/api/departments"]})},onError:()=>{s({title:"Error",description:"Failed to assign task",variant:"destructive"})}});return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Department Management"}),c.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage all hospital departments and assign tasks"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-2",children:c.jsx(ze,{className:"text-sm font-medium text-muted-foreground",children:"Total Departments"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-3xl font-bold",children:b.length})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-2",children:c.jsx(ze,{className:"text-sm font-medium text-muted-foreground",children:"Active Departments"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-3xl font-bold",children:b.filter(D=>D.status==="active").length})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-2",children:c.jsx(ze,{className:"text-sm font-medium text-muted-foreground",children:"Total Staff"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-3xl font-bold",children:Object.values(C).reduce((D,k)=>D+k,0)})})]})]}),c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b.map(D=>c.jsxs(_e,{"data-testid":`card-department-${D.id}`,children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx(ze,{children:D.name}),c.jsx(Cn,{children:D.description})]}),c.jsx(xt,{variant:D.status==="active"?"default":"secondary",children:D.status})]})}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[c.jsx(Lp,{className:"h-4 w-4"}),c.jsxs("span",{children:[C[D.id]||0," staff members"]})]}),c.jsxs(we,{onClick:()=>{f(D),d(!0)},className:"w-full","data-testid":`button-assign-task-${D.id}`,children:[c.jsx(t1,{className:"h-4 w-4 mr-2"}),"Assign Task"]})]})]},D.id))}),c.jsx(us,{open:o,onOpenChange:d,children:c.jsxs(hs,{className:"max-w-md",children:[c.jsxs(ps,{children:[c.jsxs(ms,{children:["Assign Task to ",p==null?void 0:p.name]}),c.jsx(Tc,{children:"Create a service request or notification"})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-semibold",children:"Task Type"}),c.jsxs(Wn,{value:E.type,onValueChange:D=>y({...E,type:D}),children:[c.jsx(jn,{"data-testid":"select-task-type",children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"consultation_request",children:"Consultation Request"}),c.jsx(ke,{value:"emergency_alert",children:"Emergency Alert"}),c.jsx(ke,{value:"lab_result",children:"Lab Result"}),c.jsx(ke,{value:"follow_up",children:"Follow Up"}),c.jsx(ke,{value:"status_update",children:"Status Update"})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-semibold",children:"Priority"}),c.jsxs(Wn,{value:E.priority,onValueChange:D=>y({...E,priority:D}),children:[c.jsx(jn,{"data-testid":"select-priority",children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"low",children:"Low"}),c.jsx(ke,{value:"normal",children:"Normal"}),c.jsx(ke,{value:"high",children:"High"}),c.jsx(ke,{value:"critical",children:"Critical"})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-semibold",children:"Title"}),c.jsx(at,{placeholder:"Task title",value:E.title,onChange:D=>y({...E,title:D.target.value}),"data-testid":"input-task-title"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-sm font-semibold",children:"Message"}),c.jsx("textarea",{placeholder:"Task details",value:E.message,onChange:D=>y({...E,message:D.target.value}),className:"w-full px-3 py-2 border rounded-md text-sm",rows:4,"data-testid":"textarea-task-message"})]}),c.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[c.jsx(we,{variant:"outline",onClick:()=>d(!1),"data-testid":"button-cancel-task",children:"Cancel"}),c.jsx(we,{onClick:()=>A.mutate(),disabled:!E.title||!E.message||A.isPending,className:"flex-1","data-testid":"button-assign-confirm",children:A.isPending?"Assigning...":"Assign Task"})]})]})]})})]})}function UH({health:r,loading:s}){if(s||!r)return c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"System Health"})}),c.jsx(Te,{children:c.jsx("div",{className:"flex items-center justify-center h-20",children:c.jsx(Tl,{className:"h-5 w-5 animate-spin text-muted-foreground"})})})]});const o=p=>{switch(p){case"healthy":return c.jsx(Ng,{className:"h-8 w-8 text-green-500"});case"warning":return c.jsx(bl,{className:"h-8 w-8 text-yellow-500"});case"critical":case"error":return c.jsx(gw,{className:"h-8 w-8 text-red-500"});default:return c.jsx(Tl,{className:"h-8 w-8 text-gray-500"})}},d=p=>{switch(p){case"healthy":return"bg-green-100 text-green-800 border-green-200";case"warning":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"critical":case"error":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"System Health"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-3",children:[o(r.status),c.jsxs("div",{children:[c.jsx(xt,{className:`${d(r.status)} border`,children:r.status.toUpperCase()}),c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Last checked: ",new Date(r.timestamp).toLocaleTimeString()]})]})]})}),r.issues&&r.issues.length>0&&c.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:[c.jsx("p",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"Issues Detected:"}),r.issues.map((p,f)=>c.jsxs("p",{className:"text-xs text-yellow-700",children:[" ",p]},f))]}),c.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${r.services.database==="healthy"?"bg-green-500":"bg-red-500"}`}),c.jsx("span",{className:"text-muted-foreground",children:"Database"})]}),c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${r.services.api==="healthy"?"bg-green-500":"bg-red-500"}`}),c.jsx("span",{className:"text-muted-foreground",children:"API"})]})]})]})]})}function VH({metrics:r,historicalData:s}){return r?(r.cpu.usage_percent,r.memory.percent,r.disk.percent,c.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"CPU Usage"}),c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsxs("p",{className:"text-3xl font-bold",children:[r.cpu.usage_percent.toFixed(1),"%"]}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.cpu.count," cores"]})]}),c.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:c.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${r.cpu.usage_percent}%`}})})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Memory Usage"}),c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsxs("p",{className:"text-3xl font-bold",children:[r.memory.percent.toFixed(1),"%"]}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.memory.used_gb.toFixed(1)," / ",r.memory.total_gb.toFixed(1)," GB"]})]}),c.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:c.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all",style:{width:`${r.memory.percent}%`}})})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Disk Usage"}),c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsxs("p",{className:"text-3xl font-bold",children:[r.disk.percent.toFixed(1),"%"]}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.disk.used_gb.toFixed(1)," / ",r.disk.total_gb.toFixed(1)," GB"]})]}),c.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:c.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all",style:{width:`${r.disk.percent}%`}})})]})})})]})):c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsx("div",{className:"h-48 flex items-center justify-center text-muted-foreground",children:"Loading metrics..."})})})}function QPe({logs:r,loading:s}){const o=d=>({create:"bg-green-100 text-green-800",update:"bg-blue-100 text-blue-800",delete:"bg-red-100 text-red-800",login:"bg-purple-100 text-purple-800",logout:"bg-gray-100 text-gray-800",suspend:"bg-orange-100 text-orange-800",activate:"bg-teal-100 text-teal-800"})[d]||"bg-gray-100 text-gray-800";return c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Audit Trail"}),c.jsx(Cn,{children:"System-wide action history and security logs"})]}),c.jsx(Te,{children:c.jsx(Su,{className:"h-[400px]",children:s?c.jsx("div",{className:"flex items-center justify-center h-40",children:c.jsx("p",{className:"text-muted-foreground",children:"Loading audit logs..."})}):r.length===0?c.jsx("div",{className:"flex items-center justify-center h-40",children:c.jsx("p",{className:"text-muted-foreground",children:"No audit logs found"})}):c.jsxs(Cp,{children:[c.jsx(Rp,{children:c.jsxs(ia,{children:[c.jsx($n,{children:"Timestamp"}),c.jsx($n,{children:"Action"}),c.jsx($n,{children:"Resource"}),c.jsx($n,{children:"User ID"}),c.jsx($n,{children:"IP Address"}),c.jsx($n,{children:"Details"})]})}),c.jsx(xp,{children:r.map(d=>c.jsxs(ia,{children:[c.jsx(Gn,{className:"text-xs text-muted-foreground",children:new Date(d.timestamp).toLocaleString()}),c.jsx(Gn,{children:c.jsx(xt,{className:o(d.action_type),children:d.action_type})}),c.jsxs(Gn,{className:"text-sm",children:[d.resource_type,d.resource_id&&c.jsxs("span",{className:"text-xs text-muted-foreground block",children:["ID: ",d.resource_id.substring(0,8),"..."]})]}),c.jsx(Gn,{className:"text-xs font-mono",children:d.user_id?d.user_id.substring(0,8)+"...":"system"}),c.jsx(Gn,{className:"text-xs",children:d.ip_address||"N/A"}),c.jsx(Gn,{className:"text-xs max-w-xs truncate",children:d.details||""})]},d.id))})]})})})]})}function JPe(){const{toast:r}=jr(),[s,o]=I.useState("overview"),[d,p]=I.useState([]),[f,E]=I.useState([]),[y,b]=I.useState(null),[C,A]=I.useState(null),[D,k]=I.useState(null),[W,G]=I.useState([]),[L,B]=I.useState([]),[H,V]=I.useState(!1),[K,Z]=I.useState(""),[ee,$]=I.useState("all"),[se,le]=I.useState({name:"",address:"",phone:"",email:"",subscription_tier:"free",admin_user_id:"admin"}),[X,oe]=I.useState(!1),[je,Ce]=I.useState(""),[We,he]=I.useState(!0),[rt,De]=I.useState(""),[Oe,Re]=I.useState(!0),[et,xe]=I.useState(""),[Pt,rn]=I.useState(""),[Gr,er]=I.useState("normal");I.useEffect(()=>{_i();const qe=setInterval(()=>{Ar(),Un()},3e4);return()=>clearInterval(qe)},[]);const _i=async()=>{await Promise.all([ns(),Lt(),tr(),Ar(),Un(),zn(),Xn()])},ns=async()=>{try{const mr=await(await fetch("/api/admin/hospitals/overview")).json();p(mr)}catch(qe){console.error("Failed to fetch hospitals:",qe)}},Lt=async()=>{try{const mr=await(await fetch("/api/admin/users?limit=200")).json();E(mr.users||[])}catch(qe){console.error("Failed to fetch users:",qe)}},tr=async()=>{try{const mr=await(await fetch("/api/admin/system/stats")).json();b(mr)}catch(qe){console.error("Failed to fetch platform stats:",qe)}},Ar=async()=>{try{const mr=await(await fetch("/api/admin/system/health")).json();A(mr)}catch(qe){console.error("Failed to fetch system health:",qe)}},Un=async()=>{try{const mr=await(await fetch("/api/admin/system/metrics")).json();k(mr)}catch(qe){console.error("Failed to fetch system metrics:",qe)}},zn=async()=>{try{const mr=await(await fetch("/api/admin/audit-logs?limit=100")).json();G(mr.logs||[])}catch(qe){console.error("Failed to fetch audit logs:",qe)}},Xn=async()=>{try{const mr=await(await fetch("/api/admin/security/events?limit=50")).json();B(mr.events||[])}catch(qe){console.error("Failed to fetch security events:",qe)}},Wr=async()=>{try{(await fetch("/api/hospitals/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)})).ok&&(V(!1),ns(),tr(),le({name:"",address:"",phone:"",email:"",subscription_tier:"free",admin_user_id:"admin"}))}catch(qe){console.error("Failed to create hospital:",qe)}},Ei=async qe=>{try{await fetch(`/api/admin/hospitals/${qe}/suspend`,{method:"POST"}),ns(),tr()}catch(mr){console.error("Failed to suspend hospital:",mr)}},Bo=async qe=>{try{await fetch(`/api/admin/hospitals/${qe}/activate`,{method:"POST"}),ns(),tr()}catch(mr){console.error("Failed to activate hospital:",mr)}},Ys=async(qe,mr)=>{try{await fetch(`/api/admin/users/${qe}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_active:mr===1?0:1})}),Lt()}catch(ce){console.error("Failed to toggle user status:",ce)}},io=qe=>{const mr={free:"bg-gray-100 text-gray-800",basic:"bg-blue-100 text-blue-800",premium:"bg-purple-100 text-purple-800",enterprise:"bg-amber-100 text-amber-800"};return mr[qe]||mr.free},rs=qe=>({active:"bg-green-100 text-green-800",suspended:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800"})[qe]||"bg-gray-100 text-gray-800",fs=f.filter(qe=>{const mr=qe.username.toLowerCase().includes(K.toLowerCase())||qe.full_name.toLowerCase().includes(K.toLowerCase()),ce=ee==="all"||qe.role===ee;return mr&&ce});return c.jsxs("div",{className:"p-6 space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"System Admin Dashboard"}),c.jsx("p",{className:"text-muted-foreground",children:"Comprehensive platform oversight and management"})]}),c.jsxs(us,{open:H,onOpenChange:V,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{children:[c.jsx(wl,{className:"mr-2 h-4 w-4"}),"Create Hospital"]})}),c.jsxs(hs,{className:"sm:max-w-[500px]",children:[c.jsxs(ps,{children:[c.jsx(ms,{children:"Create New Hospital"}),c.jsx(Tc,{children:"Add a new hospital to the platform"})]}),c.jsxs("div",{className:"grid gap-4 py-4",children:[c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"name",children:"Hospital Name"}),c.jsx(at,{id:"name",value:se.name,onChange:qe=>le({...se,name:qe.target.value}),placeholder:"City General Hospital"})]}),c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"address",children:"Address"}),c.jsx(at,{id:"address",value:se.address,onChange:qe=>le({...se,address:qe.target.value}),placeholder:"123 Main Street"})]}),c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"phone",children:"Phone"}),c.jsx(at,{id:"phone",value:se.phone,onChange:qe=>le({...se,phone:qe.target.value}),placeholder:"+1234567890"})]}),c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"email",children:"Email"}),c.jsx(at,{id:"email",type:"email",value:se.email,onChange:qe=>le({...se,email:qe.target.value}),placeholder:"admin@hospital.com"})]}),c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"tier",children:"Subscription Tier"}),c.jsxs(Wn,{value:se.subscription_tier,onValueChange:qe=>le({...se,subscription_tier:qe}),children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"free",children:"Free (5 staff, 100 patients)"}),c.jsx(ke,{value:"basic",children:"Basic (20 staff, 500 patients)"}),c.jsx(ke,{value:"premium",children:"Premium (50 staff, 2000 patients)"}),c.jsx(ke,{value:"enterprise",children:"Enterprise (Unlimited)"})]})]})]})]}),c.jsxs(If,{children:[c.jsx(we,{variant:"outline",onClick:()=>V(!1),children:"Cancel"}),c.jsx(we,{onClick:Wr,children:"Create Hospital"})]})]})]})]}),c.jsxs(Al,{value:s,onValueChange:o,children:[c.jsxs(Lc,{className:"grid w-full grid-cols-6",children:[c.jsxs(kn,{value:"overview",children:[c.jsx(Tl,{className:"h-4 w-4 mr-2"}),"Overview"]}),c.jsxs(kn,{value:"hospitals",children:[c.jsx(ml,{className:"h-4 w-4 mr-2"}),"Hospitals"]}),c.jsxs(kn,{value:"users",children:[c.jsx(Lp,{className:"h-4 w-4 mr-2"}),"Users"]}),c.jsxs(kn,{value:"security",children:[c.jsx(n1,{className:"h-4 w-4 mr-2"}),"Security"]}),c.jsxs(kn,{value:"monitoring",children:[c.jsx(bwe,{className:"h-4 w-4 mr-2"}),"Monitoring"]}),c.jsxs(kn,{value:"settings",children:[c.jsx(rQ,{className:"h-4 w-4 mr-2"}),"Settings"]})]}),c.jsxs(Ln,{value:"overview",className:"space-y-4",children:[c.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[c.jsx(UH,{health:C}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Total Hospitals"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-3xl font-bold",children:(y==null?void 0:y.hospitals.total)||0}),c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(y==null?void 0:y.hospitals.active)||0," active"]})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Total Users"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-3xl font-bold",children:(y==null?void 0:y.users.total)||0}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Across all hospitals"})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Today's Appointments"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-3xl font-bold",children:(y==null?void 0:y.appointments.today)||0}),c.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(y==null?void 0:y.appointments.total)||0," total"]})]})]})]}),c.jsx(VH,{metrics:D}),c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{className:"text-base",children:"Recent Security Events"})}),c.jsx(Te,{children:c.jsxs(Su,{className:"h-48",children:[L.slice(0,5).map(qe=>c.jsxs("div",{className:"mb-3 pb-3 border-b last:border-0",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx(xt,{variant:"outline",children:qe.event_type}),c.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(qe.timestamp).toLocaleTimeString()})]}),c.jsx("p",{className:"text-sm mt-1",children:qe.username||"Unknown user"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:qe.ip_address})]},qe.id)),L.length===0&&c.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No security events"})]})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{className:"text-base",children:"System Statistics"})}),c.jsxs(Te,{className:"space-y-3",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Doctors"}),c.jsx("span",{className:"font-semibold",children:(y==null?void 0:y.users.by_role.doctor)||0})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Nurses"}),c.jsx("span",{className:"font-semibold",children:(y==null?void 0:y.users.by_role.nurse)||0})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Patients"}),c.jsx("span",{className:"font-semibold",children:(y==null?void 0:y.patients.total)||0})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Premium Tier Hospitals"}),c.jsx("span",{className:"font-semibold",children:((y==null?void 0:y.hospitals.by_tier.premium)||0)+((y==null?void 0:y.hospitals.by_tier.enterprise)||0)})]})]})]})]})]}),c.jsx(Ln,{value:"hospitals",className:"space-y-4",children:c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"All Hospitals"}),c.jsx(Cn,{children:"Manage and monitor all hospitals in the system"})]}),c.jsx(Te,{children:c.jsx(Su,{className:"h-[600px]",children:c.jsx("div",{className:"space-y-3",children:d.map(qe=>c.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(ml,{className:"h-5 w-5 text-muted-foreground"}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold",children:qe.name}),c.jsx("p",{className:"text-sm text-muted-foreground",children:qe.address})]})]}),qe.staff_count!==void 0&&c.jsxs("div",{className:"ml-8 mt-2 grid grid-cols-2 gap-2 text-xs",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Staff: "}),c.jsxs("span",{className:"font-medium",children:[qe.staff_count," / ",qe.max_staff]}),c.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",qe.staff_usage_percent,"%)"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-muted-foreground",children:"Patients: "}),c.jsxs("span",{className:"font-medium",children:[qe.patient_count," / ",qe.max_patients]}),c.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",qe.patient_usage_percent,"%)"]})]})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(xt,{className:io(qe.subscription_tier),children:qe.subscription_tier.toUpperCase()}),c.jsx(xt,{className:rs(qe.subscription_status),children:qe.subscription_status.toUpperCase()}),qe.subscription_status==="active"?c.jsxs(we,{variant:"outline",size:"sm",onClick:()=>Ei(qe.id),children:[c.jsx(Zbe,{className:"h-4 w-4 mr-1"}),"Suspend"]}):c.jsxs(we,{variant:"outline",size:"sm",onClick:()=>Bo(qe.id),children:[c.jsx(Na,{className:"h-4 w-4 mr-1"}),"Activate"]})]})]},qe.id))})})})]})}),c.jsx(Ln,{value:"users",className:"space-y-4",children:c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"User Management"}),c.jsx(Cn,{children:"Search and manage all users across the platform"})]}),c.jsxs(Te,{children:[c.jsxs("div",{className:"flex gap-4 mb-4",children:[c.jsx("div",{className:"flex-1",children:c.jsx(at,{placeholder:"Search users...",value:K,onChange:qe=>Z(qe.target.value),className:"max-w-sm"})}),c.jsxs(Wn,{value:ee,onValueChange:$,children:[c.jsx(jn,{className:"w-[180px]",children:c.jsx(Hn,{placeholder:"Filter by role"})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"all",children:"All Roles"}),c.jsx(ke,{value:"doctor",children:"Doctor"}),c.jsx(ke,{value:"nurse",children:"Nurse"}),c.jsx(ke,{value:"patient",children:"Patient"}),c.jsx(ke,{value:"hospital_admin",children:"Hospital Admin"}),c.jsx(ke,{value:"system_admin",children:"System Admin"})]})]})]}),c.jsx(Su,{className:"h-[500px]",children:c.jsxs(Cp,{children:[c.jsx(Rp,{children:c.jsxs(ia,{children:[c.jsx($n,{children:"Username"}),c.jsx($n,{children:"Full Name"}),c.jsx($n,{children:"Role"}),c.jsx($n,{children:"Status"}),c.jsx($n,{children:"Created"}),c.jsx($n,{children:"Actions"})]})}),c.jsx(xp,{children:fs.map(qe=>c.jsxs(ia,{children:[c.jsx(Gn,{className:"font-medium",children:qe.username}),c.jsx(Gn,{children:qe.full_name}),c.jsx(Gn,{children:c.jsx(xt,{variant:"outline",children:qe.role})}),c.jsx(Gn,{children:qe.is_active===1?c.jsx(xt,{className:"bg-green-100 text-green-800",children:"Active"}):c.jsx(xt,{className:"bg-red-100 text-red-800",children:"Inactive"})}),c.jsx(Gn,{className:"text-xs text-muted-foreground",children:new Date(qe.created_at).toLocaleDateString()}),c.jsx(Gn,{children:c.jsx(we,{variant:"ghost",size:"sm",onClick:()=>Ys(qe.id,qe.is_active),children:qe.is_active===1?c.jsxs(c.Fragment,{children:[c.jsx(gw,{className:"h-4 w-4 mr-1"}),"Deactivate"]}):c.jsxs(c.Fragment,{children:[c.jsx(Na,{className:"h-4 w-4 mr-1"}),"Activate"]})})})]},qe.id))})]})})]})]})}),c.jsxs(Ln,{value:"security",className:"space-y-4",children:[c.jsx(QPe,{logs:W}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Security Events"}),c.jsx(Cn,{children:"Monitor failed logins and security alerts"})]}),c.jsx(Te,{children:c.jsx(Su,{className:"h-[300px]",children:c.jsxs(Cp,{children:[c.jsx(Rp,{children:c.jsxs(ia,{children:[c.jsx($n,{children:"Type"}),c.jsx($n,{children:"User"}),c.jsx($n,{children:"IP Address"}),c.jsx($n,{children:"Severity"}),c.jsx($n,{children:"Time"})]})}),c.jsxs(xp,{children:[L.map(qe=>c.jsxs(ia,{children:[c.jsx(Gn,{children:qe.event_type}),c.jsx(Gn,{children:qe.username||"N/A"}),c.jsx(Gn,{className:"font-mono text-xs",children:qe.ip_address}),c.jsx(Gn,{children:c.jsx(xt,{className:qe.severity==="critical"?"bg-red-100 text-red-800":qe.severity==="high"?"bg-orange-100 text-orange-800":"bg-yellow-100 text-yellow-800",children:qe.severity})}),c.jsx(Gn,{className:"text-xs",children:new Date(qe.timestamp).toLocaleString()})]},qe.id)),L.length===0&&c.jsx(ia,{children:c.jsx(Gn,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No security events found"})})]})]})})})]})]}),c.jsxs(Ln,{value:"monitoring",className:"space-y-4",children:[c.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[c.jsx(UH,{health:C}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Database"})}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(iwe,{className:"h-5 w-5"}),c.jsx("span",{className:"font-semibold",children:"Connected"})]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"All database operations normal"})]})})]})]}),c.jsx(VH,{metrics:D}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"System Information"})}),c.jsxs(Te,{className:"space-y-2",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Platform Version"}),c.jsx("span",{className:"text-sm font-medium",children:"2.0.0"})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Backend"}),c.jsx("span",{className:"text-sm font-medium",children:"Python/FastAPI"})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-sm text-muted-foreground",children:"Database"}),c.jsx("span",{className:"text-sm font-medium",children:"PostgreSQL"})]})]})]})]}),c.jsx(Ln,{value:"settings",className:"space-y-4",children:c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"System Settings"}),c.jsx(Cn,{children:"Configure platform-wide settings"})]}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Maintenance Mode"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Temporarily disable user access for system updates"})]}),c.jsxs(us,{children:[c.jsx(Wi,{asChild:!0,children:c.jsx(we,{variant:"outline",children:"Configure"})}),c.jsxs(hs,{children:[c.jsxs(ps,{children:[c.jsx(ms,{children:"Maintenance Mode"}),c.jsx(Tc,{children:"Enable or disable maintenance mode. When enabled, users will see a maintenance message."})]}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx(tt,{children:"Maintenance Mode"}),c.jsx(we,{variant:X?"default":"outline",size:"sm",onClick:()=>oe(!X),children:X?"Enabled":"Disabled"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{children:"Maintenance Message"}),c.jsx(at,{placeholder:"System is undergoing maintenance...",value:je,onChange:qe=>Ce(qe.target.value),disabled:!X})]})]}),c.jsxs(If,{children:[c.jsx(we,{variant:"outline",children:"Cancel"}),c.jsx(we,{onClick:()=>{r({title:"Settings Updated",description:`Maintenance mode ${X?"enabled":"disabled"}`})},children:"Save Changes"})]})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"User Registrations"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow or restrict new user sign-ups"})]}),c.jsxs(us,{children:[c.jsx(Wi,{asChild:!0,children:c.jsx(we,{variant:"outline",children:"Manage"})}),c.jsxs(hs,{children:[c.jsxs(ps,{children:[c.jsx(ms,{children:"User Registration Settings"}),c.jsx(Tc,{children:"Control who can register new accounts on the platform"})]}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx(tt,{children:"Allow Public Registration"}),c.jsx(we,{variant:We?"default":"outline",size:"sm",onClick:()=>he(!We),children:We?"Enabled":"Disabled"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{children:"Allowed Domains"}),c.jsx(at,{placeholder:"example.com, hospital.org",value:rt,onChange:qe=>De(qe.target.value)}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Comma-separated list of allowed email domains"})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx(tt,{children:"Require Email Verification"}),c.jsx(we,{variant:Oe?"default":"outline",size:"sm",onClick:()=>Re(!Oe),children:Oe?"Enabled":"Disabled"})]})]}),c.jsxs(If,{children:[c.jsx(we,{variant:"outline",children:"Cancel"}),c.jsx(we,{onClick:()=>{r({title:"Settings Updated",description:"Registration settings saved successfully"})},children:"Save Changes"})]})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"System Announcements"}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Broadcast important messages to all users"})]}),c.jsxs(us,{children:[c.jsx(Wi,{asChild:!0,children:c.jsx(we,{variant:"outline",children:"Create"})}),c.jsxs(hs,{className:"max-w-lg",children:[c.jsxs(ps,{children:[c.jsx(ms,{children:"Create System Announcement"}),c.jsx(Tc,{children:"This announcement will be visible to all users across all hospitals"})]}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{children:"Announcement Title"}),c.jsx(at,{placeholder:"Important: System Update",value:et,onChange:qe=>xe(qe.target.value)})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{children:"Message"}),c.jsx("textarea",{className:"w-full min-h-[100px] px-3 py-2 text-sm border rounded-md",placeholder:"Enter announcement message...",value:Pt,onChange:qe=>rn(qe.target.value)})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(tt,{children:"Priority"}),c.jsxs(Wn,{value:Gr,onValueChange:er,children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"low",children:"Low"}),c.jsx(ke,{value:"normal",children:"Normal"}),c.jsx(ke,{value:"high",children:"High"}),c.jsx(ke,{value:"urgent",children:"Urgent"})]})]})]})]}),c.jsxs(If,{children:[c.jsx(we,{variant:"outline",onClick:()=>{xe(""),rn(""),er("normal")},children:"Cancel"}),c.jsx(we,{onClick:async()=>{try{await fetch("/api/admin/announcements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:et,message:Pt,priority:Gr})}),r({title:"Announcement Created",description:"System announcement has been broadcast to all users"}),xe(""),rn(""),er("normal")}catch{r({title:"Error",description:"Failed to create announcement",variant:"destructive"})}},children:"Broadcast Announcement"})]})]})]})]})]})]})})]})]})}function $Pe({hospitalId:r,hospitalName:s}){const[o,d]=I.useState([]),[p,f]=I.useState(!1),[E,y]=I.useState({username:"",password:"",full_name:"",role:"doctor",hospital_id:r,department_id:null}),{toast:b}=jr();I.useEffect(()=>{C()},[r]);const C=async()=>{try{const L=await(await fetch(`/api/staff/hospital/${r}`)).json();d(L)}catch(G){console.error("Failed to fetch staff:",G),b({title:"Error",description:"Failed to load staff members",variant:"destructive"})}},A=async()=>{try{const G=await fetch("/api/staff/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(G.ok)f(!1),C(),y({username:"",password:"",full_name:"",role:"doctor",hospital_id:r,department_id:null}),b({title:"Success",description:"Staff member added successfully"});else{const L=await G.json();b({title:"Error",description:L.detail||"Failed to add staff member",variant:"destructive"})}}catch(G){console.error("Failed to add staff:",G),b({title:"Error",description:"Failed to add staff member",variant:"destructive"})}},D=async G=>{if(confirm("Are you sure you want to remove this staff member?"))try{(await fetch(`/api/staff/${G}`,{method:"DELETE"})).ok&&(C(),b({title:"Success",description:"Staff member removed successfully"}))}catch(L){console.error("Failed to remove staff:",L),b({title:"Error",description:"Failed to remove staff member",variant:"destructive"})}},k=G=>({doctor:"bg-blue-100 text-blue-800",nurse:"bg-green-100 text-green-800",pharmacist:"bg-purple-100 text-purple-800",lab_tech:"bg-yellow-100 text-yellow-800",receptionist:"bg-pink-100 text-pink-800"})[G]||"bg-gray-100 text-gray-800",W=o.reduce((G,L)=>(G[L.role]=(G[L.role]||0)+1,G),{});return c.jsxs("div",{className:"p-6 space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Hospital Admin Dashboard"}),c.jsxs("p",{className:"text-muted-foreground",children:[s," - Staff Management"]})]}),c.jsxs(us,{open:p,onOpenChange:f,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{children:[c.jsx(wl,{className:"mr-2 h-4 w-4"}),"Add Staff Member"]})}),c.jsxs(hs,{className:"sm:max-w-[500px]",children:[c.jsxs(ps,{children:[c.jsx(ms,{children:"Add New Staff Member"}),c.jsx(Tc,{children:"Add a new staff member to your hospital"})]}),c.jsxs("div",{className:"grid gap-4 py-4",children:[c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"full_name",children:"Full Name"}),c.jsx(at,{id:"full_name",value:E.full_name,onChange:G=>y({...E,full_name:G.target.value}),placeholder:"Dr. John Smith"})]}),c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"username",children:"Username"}),c.jsx(at,{id:"username",value:E.username,onChange:G=>y({...E,username:G.target.value}),placeholder:"dr.smith"})]}),c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"password",children:"Password"}),c.jsx(at,{id:"password",type:"password",value:E.password,onChange:G=>y({...E,password:G.target.value}),placeholder:""})]}),c.jsxs("div",{className:"grid gap-2",children:[c.jsx(tt,{htmlFor:"role",children:"Role"}),c.jsxs(Wn,{value:E.role,onValueChange:G=>y({...E,role:G}),children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"doctor",children:"Doctor"}),c.jsx(ke,{value:"nurse",children:"Nurse"}),c.jsx(ke,{value:"pharmacist",children:"Pharmacist"}),c.jsx(ke,{value:"lab_tech",children:"Lab Technician"}),c.jsx(ke,{value:"receptionist",children:"Receptionist"})]})]})]})]}),c.jsxs(If,{children:[c.jsx(we,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),c.jsx(we,{onClick:A,children:"Add Staff Member"})]})]})]})]}),c.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[c.jsxs(_e,{children:[c.jsxs(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[c.jsx(ze,{className:"text-sm font-medium",children:"Total Staff"}),c.jsx(Lp,{className:"h-4 w-4 text-muted-foreground"})]}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:o.length})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:c.jsx(ze,{className:"text-sm font-medium",children:"Doctors"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:W.doctor||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:c.jsx(ze,{className:"text-sm font-medium",children:"Nurses"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:W.nurse||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:c.jsx(ze,{className:"text-sm font-medium",children:"Pharmacists"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:W.pharmacist||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:c.jsx(ze,{className:"text-sm font-medium",children:"Lab Techs"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:W.lab_tech||0})})]})]}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Staff Members"}),c.jsx(Cn,{children:"Manage your hospital's staff members and their roles"})]}),c.jsx(Te,{children:c.jsxs(Cp,{children:[c.jsx(Rp,{children:c.jsxs(ia,{children:[c.jsx($n,{children:"Name"}),c.jsx($n,{children:"Username"}),c.jsx($n,{children:"Role"}),c.jsx($n,{children:"Status"}),c.jsx($n,{className:"text-right",children:"Actions"})]})}),c.jsxs(xp,{children:[o.map(G=>c.jsxs(ia,{children:[c.jsx(Gn,{className:"font-medium",children:G.full_name}),c.jsx(Gn,{children:G.username}),c.jsx(Gn,{children:c.jsx(xt,{className:k(G.role),children:G.role.replace("_"," ").toUpperCase()})}),c.jsx(Gn,{children:c.jsx(xt,{variant:G.is_active?"default":"secondary",children:G.is_active?"Active":"Inactive"})}),c.jsx(Gn,{className:"text-right",children:c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(we,{variant:"ghost",size:"sm",children:c.jsx(sQ,{className:"h-4 w-4"})}),c.jsx(we,{variant:"ghost",size:"sm",onClick:()=>D(G.id),children:c.jsx(r1,{className:"h-4 w-4 text-destructive"})})]})})]},G.id)),o.length===0&&c.jsx(ia,{children:c.jsx(Gn,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No staff members found. Add your first staff member to get started."})})]})]})})]})]})}var ene={exports:{}};(function(r,s){(function(o,d){r.exports=d()})($0,function(){function o(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof $0<"u"?$0:typeof self<"u"?self:{};function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f=function(e){try{return!!e()}catch{return!0}},E=!f(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=E,b=Function.prototype,C=b.call,A=y&&b.bind.bind(C,C),D=y?A:function(e){return function(){return C.apply(e,arguments)}},k=D({}.isPrototypeOf),W=function(e){return e&&e.Math===Math&&e},G=W(typeof globalThis=="object"&&globalThis)||W(typeof window=="object"&&window)||W(typeof self=="object"&&self)||W(typeof d=="object"&&d)||W(typeof d=="object"&&d)||function(){return this}()||Function("return this")(),L=E,B=Function.prototype,H=B.apply,V=B.call,K=typeof Reflect=="object"&&Reflect.apply||(L?V.bind(H):function(){return V.apply(H,arguments)}),Z=D,ee=Z({}.toString),$=Z("".slice),se=function(e){return $(ee(e),8,-1)},le=se,X=D,oe=function(e){if(le(e)==="Function")return X(e)},je=typeof document=="object"&&document.all,Ce=je===void 0&&je!==void 0?function(e){return typeof e=="function"||e===je}:function(e){return typeof e=="function"},We={},he=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),rt=E,De=Function.prototype.call,Oe=rt?De.bind(De):function(){return De.apply(De,arguments)},Re={},et={}.propertyIsEnumerable,xe=Object.getOwnPropertyDescriptor,Pt=xe&&!et.call({1:2},1);Re.f=Pt?function(e){var t=xe(this,e);return!!t&&t.enumerable}:et;var rn,Gr,er=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},_i=f,ns=se,Lt=Object,tr=D("".split),Ar=_i(function(){return!Lt("z").propertyIsEnumerable(0)})?function(e){return ns(e)==="String"?tr(e,""):Lt(e)}:Lt,Un=function(e){return e==null},zn=Un,Xn=TypeError,Wr=function(e){if(zn(e))throw new Xn("Can't call method on "+e);return e},Ei=Ar,Bo=Wr,Ys=function(e){return Ei(Bo(e))},io=Ce,rs=function(e){return typeof e=="object"?e!==null:io(e)},fs={},qe=fs,mr=G,ce=Ce,Ie=function(e){return ce(e)?e:void 0},Le=function(e,t){return arguments.length<2?Ie(qe[e])||Ie(mr[e]):qe[e]&&qe[e][t]||mr[e]&&mr[e][t]},St=G.navigator,dt=St&&St.userAgent,Je=dt?String(dt):"",It=G,qn=Je,gs=It.process,Xs=It.Deno,$v=gs&&gs.versions||Xs&&Xs.version,Up=$v&&$v.v8;Up&&(Gr=(rn=Up.split("."))[0]>0&&rn[0]<4?1:+(rn[0]+rn[1])),!Gr&&qn&&(!(rn=qn.match(/Edge\/(\d+)/))||rn[1]>=74)&&(rn=qn.match(/Chrome\/(\d+)/))&&(Gr=+rn[1]);var Go=Gr,Zv=Go,ey=f,Ww=G.String,Ol=!!Object.getOwnPropertySymbols&&!ey(function(){var e=Symbol("symbol detection");return!Ww(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Zv&&Zv<41}),H1=Ol&&!Symbol.sham&&typeof Symbol.iterator=="symbol",one=Le,cne=Ce,lne=k,dne=Object,Mg=H1?function(e){return typeof e=="symbol"}:function(e){var t=one("Symbol");return cne(t)&&lne(t.prototype,dne(e))},une=String,Vp=function(e){try{return une(e)}catch{return"Object"}},hne=Ce,pne=Vp,mne=TypeError,ua=function(e){if(hne(e))return e;throw new mne(pne(e)+" is not a function")},fne=ua,gne=Un,Ug=function(e,t){var n=e[t];return gne(n)?void 0:fne(n)},K1=Oe,z1=Ce,q1=rs,_ne=TypeError,Y1={exports:{}},X1=G,Ene=Object.defineProperty,vne=G,yne=function(e,t){try{Ene(X1,e,{value:t,configurable:!0,writable:!0})}catch{X1[e]=t}return t},Q1="__core-js_shared__",J1=Y1.exports=vne[Q1]||yne(Q1,{});(J1.versions||(J1.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Hw=Y1.exports,$1=Hw,Fp=function(e,t){return $1[e]||($1[e]=t||{})},Sne=Wr,Tne=Object,Mc=function(e){return Tne(Sne(e))},bne=Mc,wne=D({}.hasOwnProperty),Bs=Object.hasOwn||function(e,t){return wne(bne(e),t)},Cne=D,Rne=0,xne=Math.random(),Nne=Cne(1.1.toString),Kw=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Nne(++Rne+xne,36)},Ine=Fp,Z1=Bs,Ane=Kw,One=Ol,Pne=H1,Bp=G.Symbol,zw=Ine("wks"),Dne=Pne?Bp.for||Bp:Bp&&Bp.withoutSetter||Ane,Or=function(e){return Z1(zw,e)||(zw[e]=One&&Z1(Bp,e)?Bp[e]:Dne("Symbol."+e)),zw[e]},kne=Oe,ek=rs,tk=Mg,Lne=Ug,jne=function(e,t){var n,i;if(z1(n=e.toString)&&!q1(i=K1(n,e))||z1(n=e.valueOf)&&!q1(i=K1(n,e)))return i;throw new _ne("Can't convert object to primitive value")},Mne=TypeError,Une=Or("toPrimitive"),Vne=function(e,t){if(!ek(e)||tk(e))return e;var n,i=Lne(e,Une);if(i){if(n=kne(i,e,t),!ek(n)||tk(n))return n;throw new Mne("Can't convert object to primitive value")}return jne(e)},Fne=Mg,qw=function(e){var t=Vne(e,"string");return Fne(t)?t:t+""},nk=rs,Yw=G.document,Bne=nk(Yw)&&nk(Yw.createElement),Xw=function(e){return Bne?Yw.createElement(e):{}},Gne=Xw,rk=!he&&!f(function(){return Object.defineProperty(Gne("div"),"a",{get:function(){return 7}}).a!==7}),Wne=he,Hne=Oe,Kne=Re,zne=er,qne=Ys,Yne=qw,Xne=Bs,Qne=rk,sk=Object.getOwnPropertyDescriptor;We.f=Wne?sk:function(e,t){if(e=qne(e),t=Yne(t),Qne)try{return sk(e,t)}catch{}if(Xne(e,t))return zne(!Hne(Kne.f,e,t),e[t])};var Jne=f,$ne=Ce,Zne=/#|\.prototype\./,Vg=function(e,t){var n=tre[ere(e)];return n===rre||n!==nre&&($ne(t)?Jne(t):!!t)},ere=Vg.normalize=function(e){return String(e).replace(Zne,".").toLowerCase()},tre=Vg.data={},nre=Vg.NATIVE="N",rre=Vg.POLYFILL="P",ik=Vg,sre=ua,ire=E,are=oe(oe.bind),yd=function(e,t){return sre(e),t===void 0?e:ire?are(e,t):function(){return e.apply(t,arguments)}},ao={},ak=he&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),ore=rs,cre=String,lre=TypeError,zi=function(e){if(ore(e))return e;throw new lre(cre(e)+" is not an object")},dre=he,ure=rk,hre=ak,ty=zi,ok=qw,pre=TypeError,Qw=Object.defineProperty,mre=Object.getOwnPropertyDescriptor,Jw="enumerable",$w="configurable",Zw="writable";ao.f=dre?hre?function(e,t,n){if(ty(e),t=ok(t),ty(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Zw in n&&!n[Zw]){var i=mre(e,t);i&&i[Zw]&&(e[t]=n.value,n={configurable:$w in n?n[$w]:i[$w],enumerable:Jw in n?n[Jw]:i[Jw],writable:!1})}return Qw(e,t,n)}:Qw:function(e,t,n){if(ty(e),t=ok(t),ty(n),ure)try{return Qw(e,t,n)}catch{}if("get"in n||"set"in n)throw new pre("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var fre=ao,gre=er,zu=he?function(e,t,n){return fre.f(e,t,gre(1,n))}:function(e,t,n){return e[t]=n,e},Fg=G,_re=K,Ere=oe,vre=Ce,yre=We.f,Sre=ik,Gp=fs,Tre=yd,Wp=zu,ck=Bs,bre=function(e){var t=function(n,i,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,a)}return _re(e,this,arguments)};return t.prototype=e.prototype,t},an=function(e,t){var n,i,a,l,u,h,m,g,_,v=e.target,S=e.global,T=e.stat,P=e.proto,x=S?Fg:T?Fg[v]:Fg[v]&&Fg[v].prototype,N=S?Gp:Gp[v]||Wp(Gp,v,{})[v],M=N.prototype;for(l in t)i=!(n=Sre(S?l:v+(T?".":"#")+l,e.forced))&&x&&ck(x,l),h=N[l],i&&(m=e.dontCallGetSet?(_=yre(x,l))&&_.value:x[l]),u=i&&m?m:t[l],(n||P||typeof h!=typeof u)&&(g=e.bind&&i?Tre(u,Fg):e.wrap&&i?bre(u):P&&vre(u)?Ere(u):u,(e.sham||u&&u.sham||h&&h.sham)&&Wp(g,"sham",!0),Wp(N,l,g),P&&(ck(Gp,a=v+"Prototype")||Wp(Gp,a,{}),Wp(Gp[a],l,u),e.real&&M&&(n||!M[l])&&Wp(M,l,u)))},wre=Math.ceil,Cre=Math.floor,Rre=Math.trunc||function(e){var t=+e;return(t>0?Cre:wre)(t)},xre=Rre,eC=function(e){var t=+e;return t!=t||t===0?0:xre(t)},Nre=eC,Ire=Math.max,Are=Math.min,tC=function(e,t){var n=Nre(e);return n<0?Ire(n+t,0):Are(n,t)},Ore=eC,Pre=Math.min,lk=function(e){var t=Ore(e);return t>0?Pre(t,9007199254740991):0},Dre=lk,Sd=function(e){return Dre(e.length)},kre=Ys,Lre=tC,jre=Sd,dk=function(e){return function(t,n,i){var a=kre(t),l=jre(a);if(l===0)return!e&&-1;var u,h=Lre(i,l);if(e&&n!=n){for(;l>h;)if((u=a[h++])!=u)return!0}else for(;l>h;h++)if((e||h in a)&&a[h]===n)return e||h||0;return!e&&-1}},nC={includes:dk(!0),indexOf:dk(!1)},Mre=nC.includes;an({target:"Array",proto:!0,forced:f(function(){return!Array(1).includes()})},{includes:function(e){return Mre(this,e,arguments.length>1?arguments[1]:void 0)}});var Ure=G,Vre=fs,Da=function(e,t){var n=Vre[e+"Prototype"],i=n&&n[t];if(i)return i;var a=Ure[e],l=a&&a.prototype;return l&&l[t]},Fre=Da("Array","includes"),Bre=rs,Gre=se,Wre=Or("match"),rC=function(e){var t;return Bre(e)&&((t=e[Wre])!==void 0?!!t:Gre(e)==="RegExp")},Hre=rC,Kre=TypeError,uk={};uk[Or("toStringTag")]="z";var sC=String(uk)==="[object z]",zre=sC,qre=Ce,ny=se,Yre=Or("toStringTag"),Xre=Object,Qre=ny(function(){return arguments}())==="Arguments",Td=zre?ny:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(a,l){try{return a[l]}catch{}}(t=Xre(e),Yre))=="string"?n:Qre?ny(t):(i=ny(t))==="Object"&&qre(t.callee)?"Arguments":i},Jre=Td,$re=String,qi=function(e){if(Jre(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return $re(e)},Zre=Or("match"),ese=an,tse=function(e){if(Hre(e))throw new Kre("The method doesn't accept regular expressions");return e},nse=Wr,hk=qi,rse=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[Zre]=!1,"/./"[e](t)}catch{}}return!1},sse=D("".indexOf);ese({target:"String",proto:!0,forced:!rse("includes")},{includes:function(e){return!!~sse(hk(nse(this)),hk(tse(e)),arguments.length>1?arguments[1]:void 0)}});var ise=Da("String","includes"),pk=k,ase=Fre,ose=ise,iC=Array.prototype,aC=String.prototype,cse=function(e){var t=e.includes;return e===iC||pk(iC,e)&&t===iC.includes?ase:typeof e=="string"||e===aC||pk(aC,e)&&t===aC.includes?ose:t},Ee=p(cse),lse=ua,dse=Mc,use=Ar,hse=Sd,mk=TypeError,fk="Reduce of empty array with no initial value",gk=function(e){return function(t,n,i,a){var l=dse(t),u=use(l),h=hse(l);if(lse(n),h===0&&i<2)throw new mk(fk);var m=e?h-1:0,g=e?-1:1;if(i<2)for(;;){if(m in u){a=u[m],m+=g;break}if(m+=g,e?m<0:h<=m)throw new mk(fk)}for(;e?m>=0:h>m;m+=g)m in u&&(a=n(a,u[m],m,l));return a}},pse={left:gk(!1),right:gk(!0)},mse=f,ry=function(e,t){var n=[][e];return!!n&&mse(function(){n.call(null,t||function(){return 1},1)})},Bg=G,fse=Je,gse=se,sy=function(e){return fse.slice(0,e.length)===e},oC=sy("Bun/")?"BUN":sy("Cloudflare-Workers")?"CLOUDFLARE":sy("Deno/")?"DENO":sy("Node.js/")?"NODE":Bg.Bun&&typeof Bun.version=="string"?"BUN":Bg.Deno&&typeof Deno.version=="object"?"DENO":gse(Bg.process)==="process"?"NODE":Bg.window&&Bg.document?"BROWSER":"REST",iy=oC==="NODE",_se=pse.left;an({target:"Array",proto:!0,forced:!iy&&Go>79&&Go<83||!ry("reduce")},{reduce:function(e){var t=arguments.length;return _se(this,e,t,t>1?arguments[1]:void 0)}});var Ese=Da("Array","reduce"),vse=k,yse=Ese,cC=Array.prototype,Sse=function(e){var t=e.reduce;return e===cC||vse(cC,e)&&t===cC.reduce?yse:t},_k=Sse,ka=p(_k),Tse=se,Gg=Array.isArray||function(e){return Tse(e)==="Array"},bse=an,wse=Gg,Cse=D([].reverse),Ek=[1,2];bse({target:"Array",proto:!0,forced:String(Ek)===String(Ek.reverse())},{reverse:function(){return wse(this)&&(this.length=this.length),Cse(this)}});var Rse=Da("Array","reverse"),xse=k,Nse=Rse,lC=Array.prototype,Ise=function(e){var t=e.reverse;return e===lC||xse(lC,e)&&t===lC.reverse?Nse:t},vk=Ise,yk=p(vk),Ase=Kw,Sk=Fp("keys"),ay=function(e){return Sk[e]||(Sk[e]=Ase(e))},Ose=!f(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Pse=Bs,Dse=Ce,kse=Mc,Lse=Ose,Tk=ay("IE_PROTO"),dC=Object,jse=dC.prototype,uC=Lse?dC.getPrototypeOf:function(e){var t=kse(e);if(Pse(t,Tk))return t[Tk];var n=t.constructor;return Dse(n)&&t instanceof n?n.prototype:t instanceof dC?jse:null},Mse=D,Use=ua,Vse=rs,Fse=function(e){return Vse(e)||e===null},Bse=String,Gse=TypeError,Wse=function(e,t,n){try{return Mse(Use(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},Hse=rs,Kse=Wr,zse=function(e){if(Fse(e))return e;throw new Gse("Can't set "+Bse(e)+" as a prototype")},qse=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Wse(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,a){return Kse(i),zse(a),Hse(i)&&(t?e(i,a):i.__proto__=a),i}}():void 0),oy={},cy={},hC=Bs,Yse=Ys,Xse=nC.indexOf,Qse=cy,bk=D([].push),wk=function(e,t){var n,i=Yse(e),a=0,l=[];for(n in i)!hC(Qse,n)&&hC(i,n)&&bk(l,n);for(;t.length>a;)hC(i,n=t[a++])&&(~Xse(l,n)||bk(l,n));return l},pC=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Jse=wk,$se=pC.concat("length","prototype");oy.f=Object.getOwnPropertyNames||function(e){return Jse(e,$se)};var Wg={};Wg.f=Object.getOwnPropertySymbols;var Zse=Le,eie=oy,tie=Wg,nie=zi,rie=D([].concat),sie=Zse("Reflect","ownKeys")||function(e){var t=eie.f(nie(e)),n=tie.f;return n?rie(t,n(e)):t},Ck=Bs,iie=sie,aie=We,oie=ao,mC={},cie=wk,lie=pC,ly=Object.keys||function(e){return cie(e,lie)},die=he,uie=ak,hie=ao,pie=zi,mie=Ys,fie=ly;mC.f=die&&!uie?Object.defineProperties:function(e,t){pie(e);for(var n,i=mie(t),a=fie(t),l=a.length,u=0;l>u;)hie.f(e,n=a[u++],i[n]);return e};var dy,Rk=Le("document","documentElement"),gie=zi,_ie=mC,xk=pC,Eie=cy,vie=Rk,yie=Xw,fC="prototype",gC="script",Nk=ay("IE_PROTO"),_C=function(){},Ik=function(e){return"<"+gC+">"+e+"</"+gC+">"},Ak=function(e){e.write(Ik("")),e.close();var t=e.parentWindow.Object;return e=null,t},uy=function(){try{dy=new ActiveXObject("htmlfile")}catch{}var e,t,n;uy=typeof document<"u"?document.domain&&dy?Ak(dy):(t=yie("iframe"),n="java"+gC+":",t.style.display="none",vie.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Ik("document.F=Object")),e.close(),e.F):Ak(dy);for(var i=xk.length;i--;)delete uy[fC][xk[i]];return uy()};Eie[Nk]=!0;var Hg=Object.create||function(e,t){var n;return e!==null?(_C[fC]=gie(e),n=new _C,_C[fC]=null,n[Nk]=e):n=uy(),t===void 0?n:_ie.f(n,t)},Sie=rs,Tie=zu,Ok=Error,bie=D("".replace),wie=String(new Ok("zxcasd").stack),Pk=/\n\s*at [^:]*:[^\n]*/,Cie=Pk.test(wie),Rie=er,xie=!f(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Rie(1,7)),e.stack!==7)}),Nie=zu,Iie=function(e,t){if(Cie&&typeof e=="string"&&!Ok.prepareStackTrace)for(;t--;)e=bie(e,Pk,"");return e},Aie=xie,Dk=Error.captureStackTrace,Hp={},Oie=Hp,Pie=Or("iterator"),Die=Array.prototype,kk=function(e){return e!==void 0&&(Oie.Array===e||Die[Pie]===e)},kie=Td,Lk=Ug,Lie=Un,jie=Hp,Mie=Or("iterator"),hy=function(e){if(!Lie(e))return Lk(e,Mie)||Lk(e,"@@iterator")||jie[kie(e)]},Uie=Oe,Vie=ua,Fie=zi,Bie=Vp,Gie=hy,Wie=TypeError,EC=function(e,t){var n=arguments.length<2?Gie(e):t;if(Vie(n))return Fie(Uie(n,e));throw new Wie(Bie(e)+" is not iterable")},Hie=Oe,jk=zi,Kie=Ug,Mk=function(e,t,n){var i,a;jk(e);try{if(!(i=Kie(e,"return"))){if(t==="throw")throw n;return n}i=Hie(i,e)}catch(l){a=!0,i=l}if(t==="throw")throw n;if(a)throw i;return jk(i),n},zie=yd,qie=Oe,Yie=zi,Xie=Vp,Qie=kk,Jie=Sd,Uk=k,$ie=EC,Zie=hy,Vk=Mk,eae=TypeError,py=function(e,t){this.stopped=e,this.result=t},Fk=py.prototype,Kg=function(e,t,n){var i,a,l,u,h,m,g,_=n&&n.that,v=!(!n||!n.AS_ENTRIES),S=!(!n||!n.IS_RECORD),T=!(!n||!n.IS_ITERATOR),P=!(!n||!n.INTERRUPTED),x=zie(t,_),N=function(F){return i&&Vk(i,"normal"),new py(!0,F)},M=function(F){return v?(Yie(F),P?x(F[0],F[1],N):x(F[0],F[1])):P?x(F,N):x(F)};if(S)i=e.iterator;else if(T)i=e;else{if(!(a=Zie(e)))throw new eae(Xie(e)+" is not iterable");if(Qie(a)){for(l=0,u=Jie(e);u>l;l++)if((h=M(e[l]))&&Uk(Fk,h))return h;return new py(!1)}i=$ie(e,a)}for(m=S?e.next:i.next;!(g=qie(m,i)).done;){try{h=M(g.value)}catch(F){Vk(i,"throw",F)}if(typeof h=="object"&&h&&Uk(Fk,h))return h}return new py(!1)},tae=qi,nae=an,rae=k,sae=uC,my=qse,iae=function(e,t,n){for(var i=iie(t),a=oie.f,l=aie.f,u=0;u<i.length;u++){var h=i[u];Ck(e,h)||n&&Ck(n,h)||a(e,h,l(t,h))}},Bk=Hg,vC=zu,yC=er,aae=function(e,t){Sie(t)&&"cause"in t&&Tie(e,"cause",t.cause)},oae=function(e,t,n,i){Aie&&(Dk?Dk(e,t):Nie(e,"stack",Iie(n,i)))},cae=Kg,lae=function(e,t){return e===void 0?arguments.length<2?"":t:tae(e)},dae=Or("toStringTag"),fy=Error,uae=[].push,Kp=function(e,t){var n,i=rae(SC,this);my?n=my(new fy,i?sae(this):SC):(n=i?this:Bk(SC),vC(n,dae,"Error")),t!==void 0&&vC(n,"message",lae(t)),oae(n,Kp,n.stack,1),arguments.length>2&&aae(n,arguments[2]);var a=[];return cae(e,uae,{that:a}),vC(n,"errors",a),n};my?my(Kp,fy):iae(Kp,fy,{name:!0});var SC=Kp.prototype=Bk(fy.prototype,{constructor:yC(1,Kp),message:yC(1,""),name:yC(1,"AggregateError")});nae({global:!0,constructor:!0,arity:2},{AggregateError:Kp});var gy,zg,_y,hae=Ce,Gk=G.WeakMap,pae=hae(Gk)&&/native code/.test(String(Gk)),Wk=G,mae=rs,fae=zu,TC=Bs,bC=Hw,gae=ay,_ae=cy,Hk="Object already initialized",wC=Wk.TypeError,Eae=Wk.WeakMap;if(pae||bC.state){var Uc=bC.state||(bC.state=new Eae);Uc.get=Uc.get,Uc.has=Uc.has,Uc.set=Uc.set,gy=function(e,t){if(Uc.has(e))throw new wC(Hk);return t.facade=e,Uc.set(e,t),t},zg=function(e){return Uc.get(e)||{}},_y=function(e){return Uc.has(e)}}else{var zp=gae("state");_ae[zp]=!0,gy=function(e,t){if(TC(e,zp))throw new wC(Hk);return t.facade=e,fae(e,zp,t),t},zg=function(e){return TC(e,zp)?e[zp]:{}},_y=function(e){return TC(e,zp)}}var qu,Kk,zk,Yu={set:gy,get:zg,has:_y,enforce:function(e){return _y(e)?zg(e):gy(e,{})},getterFor:function(e){return function(t){var n;if(!mae(t)||(n=zg(t)).type!==e)throw new wC("Incompatible receiver, "+e+" required");return n}}},CC=he,vae=Bs,qk=Function.prototype,yae=CC&&Object.getOwnPropertyDescriptor,RC=vae(qk,"name"),Yk={EXISTS:RC,PROPER:RC&&(function(){}).name==="something",CONFIGURABLE:RC&&(!CC||CC&&yae(qk,"name").configurable)},Sae=zu,bd=function(e,t,n,i){return i&&i.enumerable?e[t]=n:Sae(e,t,n),e},Tae=f,bae=Ce,wae=rs,Cae=Hg,Xk=uC,Rae=bd,xC=Or("iterator"),Qk=!1;[].keys&&("next"in(zk=[].keys())?(Kk=Xk(Xk(zk)))!==Object.prototype&&(qu=Kk):Qk=!0);var xae=!wae(qu)||Tae(function(){var e={};return qu[xC].call(e)!==e});bae((qu=xae?{}:Cae(qu))[xC])||Rae(qu,xC,function(){return this});var Jk={IteratorPrototype:qu,BUGGY_SAFARI_ITERATORS:Qk},Nae=Td,Iae=sC?{}.toString:function(){return"[object "+Nae(this)+"]"},Aae=sC,Oae=ao.f,Pae=zu,Dae=Bs,kae=Iae,$k=Or("toStringTag"),Pl=function(e,t,n,i){var a=n?e:e&&e.prototype;a&&(Dae(a,$k)||Oae(a,$k,{configurable:!0,value:t}),i&&!Aae&&Pae(a,"toString",kae))},Lae=Jk.IteratorPrototype,jae=Hg,Mae=er,Uae=Pl,Vae=Hp,Fae=function(){return this},NC=function(e,t,n,i){var a=t+" Iterator";return e.prototype=jae(Lae,{next:Mae(+!i,n)}),Uae(e,a,!1,!0),Vae[a]=Fae,e},Bae=an,Gae=Oe,Wae=Yk,Hae=NC,Kae=uC,zae=Pl,Zk=bd,eL=Hp,qae=Jk,Yae=Wae.PROPER,Ey=qae.BUGGY_SAFARI_ITERATORS,IC=Or("iterator"),tL="keys",vy="values",nL="entries",Xae=function(){return this},rL=function(e,t,n,i,a,l,u){Hae(n,t,i);var h,m,g,_=function(M){if(M===a&&x)return x;if(!Ey&&M&&M in T)return T[M];switch(M){case tL:case vy:case nL:return function(){return new n(this,M)}}return function(){return new n(this)}},v=t+" Iterator",S=!1,T=e.prototype,P=T[IC]||T["@@iterator"]||a&&T[a],x=!Ey&&P||_(a),N=t==="Array"&&T.entries||P;if(N&&(h=Kae(N.call(new e)))!==Object.prototype&&h.next&&(zae(h,v,!0,!0),eL[v]=Xae),Yae&&a===vy&&P&&P.name!==vy&&(S=!0,x=function(){return Gae(P,this)}),a)if(m={values:_(vy),keys:l?x:_(tL),entries:_(nL)},u)for(g in m)(Ey||S||!(g in T))&&Zk(T,g,m[g]);else Bae({target:t,proto:!0,forced:Ey||S},m);return u&&T[IC]!==x&&Zk(T,IC,x,{name:a}),eL[t]=x,m},yy=function(e,t){return{value:e,done:t}},Qae=Ys,sL=Hp,iL=Yu;ao.f;var Jae=rL,Sy=yy,aL="Array Iterator",$ae=iL.set,Zae=iL.getterFor(aL);Jae(Array,"Array",function(e,t){$ae(this,{type:aL,target:Qae(e),index:0,kind:t})},function(){var e=Zae(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Sy(void 0,!0);switch(e.kind){case"keys":return Sy(n,!1);case"values":return Sy(t[n],!1)}return Sy([n,t[n]],!1)},"values"),sL.Arguments=sL.Array;var eoe=ao,Ty=function(e,t,n){return eoe.f(e,t,n)},toe=Le,noe=Ty,roe=he,oL=Or("species"),soe=k,ioe=TypeError,AC=function(e,t){if(soe(t,e))return e;throw new ioe("Incorrect invocation")},aoe=Ce,OC=Hw,ooe=D(Function.toString);aoe(OC.inspectSource)||(OC.inspectSource=function(e){return ooe(e)});var cL=OC.inspectSource,coe=D,loe=f,lL=Ce,doe=Td,uoe=cL,dL=function(){},uL=Le("Reflect","construct"),PC=/^\s*(?:class|function)\b/,hoe=coe(PC.exec),poe=!PC.test(dL),qg=function(e){if(!lL(e))return!1;try{return uL(dL,[],e),!0}catch{return!1}},hL=function(e){if(!lL(e))return!1;switch(doe(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return poe||!!hoe(PC,uoe(e))}catch{return!0}};hL.sham=!0;var Yg,qp,pL,DC,by=!uL||loe(function(){var e;return qg(qg.call)||!qg(Object)||!qg(function(){e=!0})||e})?hL:qg,moe=by,foe=Vp,goe=TypeError,mL=zi,_oe=function(e){if(moe(e))return e;throw new goe(foe(e)+" is not a constructor")},Eoe=Un,voe=Or("species"),kC=function(e,t){var n,i=mL(e).constructor;return i===void 0||Eoe(n=mL(i)[voe])?t:_oe(n)},wd=D([].slice),yoe=TypeError,Xu=function(e,t){if(e<t)throw new yoe("Not enough arguments");return e},fL=/(?:ipad|iphone|ipod).*applewebkit/i.test(Je),La=G,Soe=K,Toe=yd,gL=Ce,boe=Bs,_L=f,EL=Rk,woe=wd,vL=Xw,Coe=Xu,Roe=fL,xoe=iy,LC=La.setImmediate,jC=La.clearImmediate,Noe=La.process,MC=La.Dispatch,Ioe=La.Function,yL=La.MessageChannel,Aoe=La.String,UC=0,Xg={},SL="onreadystatechange";_L(function(){Yg=La.location});var VC=function(e){if(boe(Xg,e)){var t=Xg[e];delete Xg[e],t()}},FC=function(e){return function(){VC(e)}},TL=function(e){VC(e.data)},bL=function(e){La.postMessage(Aoe(e),Yg.protocol+"//"+Yg.host)};LC&&jC||(LC=function(e){Coe(arguments.length,1);var t=gL(e)?e:Ioe(e),n=woe(arguments,1);return Xg[++UC]=function(){Soe(t,void 0,n)},qp(UC),UC},jC=function(e){delete Xg[e]},xoe?qp=function(e){Noe.nextTick(FC(e))}:MC&&MC.now?qp=function(e){MC.now(FC(e))}:yL&&!Roe?(DC=(pL=new yL).port2,pL.port1.onmessage=TL,qp=Toe(DC.postMessage,DC)):La.addEventListener&&gL(La.postMessage)&&!La.importScripts&&Yg&&Yg.protocol!=="file:"&&!_L(bL)?(qp=bL,La.addEventListener("message",TL,!1)):qp=SL in vL("script")?function(e){EL.appendChild(vL("script"))[SL]=function(){EL.removeChild(this),VC(e)}}:function(e){setTimeout(FC(e),0)});var wy={set:LC,clear:jC},wL=G,Ooe=he,Poe=Object.getOwnPropertyDescriptor,CL=function(e){if(!Ooe)return wL[e];var t=Poe(wL,e);return t&&t.value},RL=function(){this.head=null,this.tail=null};RL.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Yp,BC,GC,WC,xL,NL=RL,Doe=/ipad|iphone|ipod/i.test(Je)&&typeof Pebble<"u",koe=/web0s(?!.*chrome)/i.test(Je),Xp=G,Loe=CL,IL=yd,HC=wy.set,joe=NL,Moe=fL,Uoe=Doe,Voe=koe,KC=iy,AL=Xp.MutationObserver||Xp.WebKitMutationObserver,OL=Xp.document,PL=Xp.process,Cy=Xp.Promise,zC=Loe("queueMicrotask");if(!zC){var Ry=new joe,xy=function(){var e,t;for(KC&&(e=PL.domain)&&e.exit();t=Ry.get();)try{t()}catch(n){throw Ry.head&&Yp(),n}e&&e.enter()};Moe||KC||Voe||!AL||!OL?!Uoe&&Cy&&Cy.resolve?((WC=Cy.resolve(void 0)).constructor=Cy,xL=IL(WC.then,WC),Yp=function(){xL(xy)}):KC?Yp=function(){PL.nextTick(xy)}:(HC=IL(HC,Xp),Yp=function(){HC(xy)}):(BC=!0,GC=OL.createTextNode(""),new AL(xy).observe(GC,{characterData:!0}),Yp=function(){GC.data=BC=!BC}),zC=function(e){Ry.head||Yp(),Ry.add(e)}}var DL=zC,Qp=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Qu=G.Promise,Foe=G,Qg=Qu,Boe=Ce,Goe=ik,Woe=cL,Hoe=Or,kL=oC,qC=Go,LL=Qg&&Qg.prototype,Koe=Hoe("species"),jL=!1,ML=Boe(Foe.PromiseRejectionEvent),zoe=Goe("Promise",function(){var e=Woe(Qg),t=e!==String(Qg);if(!t&&qC===66||!LL.catch||!LL.finally)return!0;if(!qC||qC<51||!/native code/.test(e)){var n=new Qg(function(a){a(1)}),i=function(a){a(function(){},function(){})};if((n.constructor={})[Koe]=i,!(jL=n.then(function(){})instanceof i))return!0}return!(t||kL!=="BROWSER"&&kL!=="DENO"||ML)}),Jg={CONSTRUCTOR:zoe,REJECTION_EVENT:ML,SUBCLASSING:jL},Vc={},UL=ua,qoe=TypeError,Yoe=function(e){var t,n;this.promise=new e(function(i,a){if(t!==void 0||n!==void 0)throw new qoe("Bad Promise constructor");t=i,n=a}),this.resolve=UL(t),this.reject=UL(n)};Vc.f=function(e){return new Yoe(e)};var YC,VL,FL,Xoe=an,Ny=iy,Cd=G,Qoe=fs,$g=Oe,Joe=bd,$oe=Pl,Zoe=function(e){var t=toe(e);roe&&t&&!t[oL]&&noe(t,oL,{configurable:!0,get:function(){return this}})},ece=ua,XC=Ce,tce=rs,nce=AC,rce=kC,BL=wy.set,QC=DL,sce=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},ice=Qp,ace=NL,GL=Yu,JC=Qu,WL=Jg,HL=Vc,Iy="Promise",KL=WL.CONSTRUCTOR,oce=WL.REJECTION_EVENT,$C=GL.getterFor(Iy),cce=GL.set,lce=JC&&JC.prototype,Zg=JC,ZC=lce,zL=Cd.TypeError,eR=Cd.document,tR=Cd.process,nR=HL.f,dce=nR,uce=!!(eR&&eR.createEvent&&Cd.dispatchEvent),qL="unhandledrejection",YL=function(e){var t;return!(!tce(e)||!XC(t=e.then))&&t},XL=function(e,t){var n,i,a,l=t.value,u=t.state===1,h=u?e.ok:e.fail,m=e.resolve,g=e.reject,_=e.domain;try{h?(u||(t.rejection===2&&pce(t),t.rejection=1),h===!0?n=l:(_&&_.enter(),n=h(l),_&&(_.exit(),a=!0)),n===e.promise?g(new zL("Promise-chain cycle")):(i=YL(n))?$g(i,n,m,g):m(n)):g(l)}catch(v){_&&!a&&_.exit(),g(v)}},QL=function(e,t){e.notified||(e.notified=!0,QC(function(){for(var n,i=e.reactions;n=i.get();)XL(n,e);e.notified=!1,t&&!e.rejection&&hce(e)}))},JL=function(e,t,n){var i,a;uce?((i=eR.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Cd.dispatchEvent(i)):i={promise:t,reason:n},!oce&&(a=Cd["on"+e])?a(i):e===qL&&sce("Unhandled promise rejection",n)},hce=function(e){$g(BL,Cd,function(){var t,n=e.facade,i=e.value;if($L(e)&&(t=ice(function(){Ny?tR.emit("unhandledRejection",i,n):JL(qL,n,i)}),e.rejection=Ny||$L(e)?2:1,t.error))throw t.value})},$L=function(e){return e.rejection!==1&&!e.parent},pce=function(e){$g(BL,Cd,function(){var t=e.facade;Ny?tR.emit("rejectionHandled",t):JL("rejectionhandled",t,e.value)})},Jp=function(e,t,n){return function(i){e(t,i,n)}},$p=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,QL(e,!0))},rR=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new zL("Promise can't be resolved itself");var i=YL(t);i?QC(function(){var a={done:!1};try{$g(i,t,Jp(rR,a,e),Jp($p,a,e))}catch(l){$p(a,l,e)}}):(e.value=t,e.state=1,QL(e,!1))}catch(a){$p({done:!1},a,e)}}};KL&&(ZC=(Zg=function(e){nce(this,ZC),ece(e),$g(YC,this);var t=$C(this);try{e(Jp(rR,t),Jp($p,t))}catch(n){$p(t,n)}}).prototype,(YC=function(e){cce(this,{type:Iy,done:!1,notified:!1,parent:!1,reactions:new ace,rejection:!1,state:0,value:null})}).prototype=Joe(ZC,"then",function(e,t){var n=$C(this),i=nR(rce(this,Zg));return n.parent=!0,i.ok=!XC(e)||e,i.fail=XC(t)&&t,i.domain=Ny?tR.domain:void 0,n.state===0?n.reactions.add(i):QC(function(){XL(i,n)}),i.promise}),VL=function(){var e=new YC,t=$C(e);this.promise=e,this.resolve=Jp(rR,t),this.reject=Jp($p,t)},HL.f=nR=function(e){return e===Zg||e===FL?new VL(e):dce(e)}),Xoe({global:!0,constructor:!0,wrap:!0,forced:KL},{Promise:Zg}),FL=Qoe.Promise,$oe(Zg,Iy,!1,!0),Zoe(Iy);var ZL=Or("iterator"),ej=!1;try{var mce=0,tj={next:function(){return{done:!!mce++}},return:function(){ej=!0}};tj[ZL]=function(){return this},Array.from(tj,function(){throw 2})}catch{}var fce=Qu,gce=function(e,t){try{if(!t&&!ej)return!1}catch{return!1}var n=!1;try{var i={};i[ZL]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},Ay=Jg.CONSTRUCTOR||!gce(function(e){fce.all(e).then(void 0,function(){})}),_ce=Oe,Ece=ua,vce=Vc,yce=Qp,Sce=Kg;an({target:"Promise",stat:!0,forced:Ay},{all:function(e){var t=this,n=vce.f(t),i=n.resolve,a=n.reject,l=yce(function(){var u=Ece(t.resolve),h=[],m=0,g=1;Sce(e,function(_){var v=m++,S=!1;g++,_ce(u,t,_).then(function(T){S||(S=!0,h[v]=T,--g||i(h))},a)}),--g||i(h)});return l.error&&a(l.value),n.promise}});var Tce=an,bce=Jg.CONSTRUCTOR;Qu&&Qu.prototype,Tce({target:"Promise",proto:!0,forced:bce,real:!0},{catch:function(e){return this.then(void 0,e)}});var wce=Oe,Cce=ua,Rce=Vc,xce=Qp,Nce=Kg;an({target:"Promise",stat:!0,forced:Ay},{race:function(e){var t=this,n=Rce.f(t),i=n.reject,a=xce(function(){var l=Cce(t.resolve);Nce(e,function(u){wce(l,t,u).then(n.resolve,i)})});return a.error&&i(a.value),n.promise}});var Ice=Vc;an({target:"Promise",stat:!0,forced:Jg.CONSTRUCTOR},{reject:function(e){var t=Ice.f(this);return(0,t.reject)(e),t.promise}});var Ace=zi,Oce=rs,Pce=Vc,nj=function(e,t){if(Ace(e),Oce(t)&&t.constructor===e)return t;var n=Pce.f(e);return(0,n.resolve)(t),n.promise},Dce=an,kce=Qu,Lce=Jg.CONSTRUCTOR,jce=nj,Mce=Le("Promise"),Uce=!Lce;Dce({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return jce(Uce&&this===Mce?kce:this,e)}});var Vce=Oe,Fce=ua,Bce=Vc,Gce=Qp,Wce=Kg;an({target:"Promise",stat:!0,forced:Ay},{allSettled:function(e){var t=this,n=Bce.f(t),i=n.resolve,a=n.reject,l=Gce(function(){var u=Fce(t.resolve),h=[],m=0,g=1;Wce(e,function(_){var v=m++,S=!1;g++,Vce(u,t,_).then(function(T){S||(S=!0,h[v]={status:"fulfilled",value:T},--g||i(h))},function(T){S||(S=!0,h[v]={status:"rejected",reason:T},--g||i(h))})}),--g||i(h)});return l.error&&a(l.value),n.promise}});var Hce=Oe,Kce=ua,zce=Le,qce=Vc,Yce=Qp,Xce=Kg,rj="No one promise resolved";an({target:"Promise",stat:!0,forced:Ay},{any:function(e){var t=this,n=zce("AggregateError"),i=qce.f(t),a=i.resolve,l=i.reject,u=Yce(function(){var h=Kce(t.resolve),m=[],g=0,_=1,v=!1;Xce(e,function(S){var T=g++,P=!1;_++,Hce(h,t,S).then(function(x){P||v||(v=!0,a(x))},function(x){P||v||(P=!0,m[T]=x,--_||l(new n(m,rj)))})}),--_||l(new n(m,rj))});return u.error&&l(u.value),i.promise}});var Qce=an,Jce=K,$ce=wd,Zce=Vc,ele=ua,sj=Qp,sR=G.Promise,ij=!1;Qce({target:"Promise",stat:!0,forced:!sR||!sR.try||sj(function(){sR.try(function(e){ij=e===8},8)}).error||!ij},{try:function(e){var t=arguments.length>1?$ce(arguments,1):[],n=Zce.f(this),i=sj(function(){return Jce(ele(e),void 0,t)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var tle=Vc;an({target:"Promise",stat:!0},{withResolvers:function(){var e=tle.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var nle=an,iR=Qu,rle=f,sle=Le,ile=Ce,ale=kC,aj=nj,ole=iR&&iR.prototype;nle({target:"Promise",proto:!0,real:!0,forced:!!iR&&rle(function(){ole.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=ale(this,sle("Promise")),n=ile(e);return this.then(n?function(i){return aj(t,e()).then(function(){return i})}:e,n?function(i){return aj(t,e()).then(function(){throw i})}:e)}});var aR=D,cle=eC,lle=qi,dle=Wr,ule=aR("".charAt),oj=aR("".charCodeAt),hle=aR("".slice),cj=function(e){return function(t,n){var i,a,l=lle(dle(t)),u=cle(n),h=l.length;return u<0||u>=h?e?"":void 0:(i=oj(l,u))<55296||i>56319||u+1===h||(a=oj(l,u+1))<56320||a>57343?e?ule(l,u):i:e?hle(l,u,u+2):a-56320+(i-55296<<10)+65536}},oR={codeAt:cj(!1),charAt:cj(!0)},ple=oR.charAt,mle=qi,lj=Yu,fle=rL,dj=yy,uj="String Iterator",gle=lj.set,_le=lj.getterFor(uj);fle(String,"String",function(e){gle(this,{type:uj,string:mle(e),index:0})},function(){var e,t=_le(this),n=t.string,i=t.index;return i>=n.length?dj(void 0,!0):(e=ple(n,i),t.index+=e.length,dj(e,!1))});var Ele=fs.Promise,vle={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},yle=G,Sle=Pl,hj=Hp;for(var cR in vle)Sle(yle[cR],cR),hj[cR]=hj.Array;var pj=Ele,Ne=p(pj),Tle=Da("Array","values"),ble=Td,wle=Bs,Cle=k,Rle=Tle,lR=Array.prototype,xle={DOMTokenList:!0,NodeList:!0},Nle=function(e){var t=e.values;return e===lR||Cle(lR,e)&&t===lR.values||wle(xle,ble(e))?Rle:t},Yi=p(Nle),mj=Vp,Ile=TypeError,fj=wd,Ale=Math.floor,dR=function(e,t){var n=e.length;if(n<8)for(var i,a,l=1;l<n;){for(a=l,i=e[l];a&&t(e[a-1],i)>0;)e[a]=e[--a];a!==l++&&(e[a]=i)}else for(var u=Ale(n/2),h=dR(fj(e,0,u),t),m=dR(fj(e,u),t),g=h.length,_=m.length,v=0,S=0;v<g||S<_;)e[v+S]=v<g&&S<_?t(h[v],m[S])<=0?h[v++]:m[S++]:v<g?h[v++]:m[S++];return e},gj=dR,_j=Je.match(/firefox\/(\d+)/i),Ole=!!_j&&+_j[1],Ple=/MSIE|Trident/.test(Je),Ej=Je.match(/AppleWebKit\/(\d+)\./),Dle=!!Ej&&+Ej[1],kle=an,vj=D,Lle=ua,jle=Mc,yj=Sd,Mle=function(e,t){if(!delete e[t])throw new Ile("Cannot delete property "+mj(t)+" of "+mj(e))},Sj=qi,uR=f,Ule=gj,Vle=ry,Tj=Ole,Fle=Ple,bj=Go,wj=Dle,Rd=[],Cj=vj(Rd.sort),Ble=vj(Rd.push),Gle=uR(function(){Rd.sort(void 0)}),Wle=uR(function(){Rd.sort(null)}),Hle=Vle("sort"),Rj=!uR(function(){if(bj)return bj<70;if(!(Tj&&Tj>3)){if(Fle)return!0;if(wj)return wj<603;var e,t,n,i,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Rd.push({k:t+i,v:n})}for(Rd.sort(function(l,u){return u.v-l.v}),i=0;i<Rd.length;i++)t=Rd[i].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return a!=="DGBEFHACIJK"}});kle({target:"Array",proto:!0,forced:Gle||!Wle||!Hle||!Rj},{sort:function(e){e!==void 0&&Lle(e);var t=jle(this);if(Rj)return e===void 0?Cj(t):Cj(t,e);var n,i,a=[],l=yj(t);for(i=0;i<l;i++)i in t&&Ble(a,t[i]);for(Ule(a,function(u){return function(h,m){return m===void 0?-1:h===void 0?1:u!==void 0?+u(h,m)||0:Sj(h)>Sj(m)?1:-1}}(e)),n=yj(a),i=0;i<n;)t[i]=a[i++];for(;i<l;)Mle(t,i++);return t}});var Kle=Da("Array","sort"),zle=k,qle=Kle,hR=Array.prototype,Yle=function(e){var t=e.sort;return e===hR||zle(hR,e)&&t===hR.sort?qle:t},Ju=p(Yle),Xle=an,Qle=D,Jle=tC,$le=RangeError,xj=String.fromCharCode,Nj=String.fromCodePoint,Zle=Qle([].join);Xle({target:"String",stat:!0,arity:1,forced:!!Nj&&Nj.length!==1},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,a=0;i>a;){if(t=+arguments[a++],Jle(t,1114111)!==t)throw new $le(t+" is not a valid code point");n[a]=t<65536?xj(t):xj(55296+((t-=65536)>>10),t%1024+56320)}return Zle(n,"")}});var ede=f,tde=Or("iterator"),Oy=!ede(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(a,l){t.delete("b"),i+=l+a}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[tde]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),nde=bd,pR=an,Ij=G,mR=CL,rde=Le,Py=Oe,Wo=D,e_=he,Aj=Oy,Oj=bd,sde=Ty,ide=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:nde(e,i,t[i],n);return e},ade=Pl,ode=NC,fR=Yu,Pj=AC,gR=Ce,cde=Bs,lde=yd,dde=Td,ude=zi,Dj=rs,Xi=qi,hde=Hg,kj=er,Lj=EC,pde=hy,Dy=yy,Zp=Xu,mde=gj,fde=Or("iterator"),em="URLSearchParams",jj=em+"Iterator",Mj=fR.set,oo=fR.getterFor(em),gde=fR.getterFor(jj),Uj=mR("fetch"),ky=mR("Request"),t_=mR("Headers"),_R=ky&&ky.prototype,Vj=t_&&t_.prototype,_de=Ij.TypeError,Ede=Ij.encodeURIComponent,vde=String.fromCharCode,yde=rde("String","fromCodePoint"),Sde=parseInt,Ly=Wo("".charAt),Fj=Wo([].join),xd=Wo([].push),Bj=Wo("".replace),Tde=Wo([].shift),Gj=Wo([].splice),Wj=Wo("".split),Hj=Wo("".slice),bde=Wo(/./.exec),wde=/\+/g,Cde=/^[0-9a-f]+$/i,Kj=function(e,t){var n=Hj(e,t,t+2);return bde(Cde,n)?Sde(n,16):NaN},Rde=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},xde=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},zj=function(e){for(var t=(e=Bj(e,wde," ")).length,n="",i=0;i<t;){var a=Ly(e,i);if(a==="%"){if(Ly(e,i+1)==="%"||i+3>t){n+="%",i++;continue}var l=Kj(e,i+1);if(l!=l){n+=a,i++;continue}i+=2;var u=Rde(l);if(u===0)a=vde(l);else{if(u===1||u>4){n+="",i++;continue}for(var h=[l],m=1;m<u&&!(++i+3>t||Ly(e,i)!=="%");){var g=Kj(e,i+1);if(g!=g){i+=3;break}if(g>191||g<128)break;xd(h,g),i+=2,m++}if(h.length!==u){n+="";continue}var _=xde(h);_===null?n+="":a=yde(_)}}n+=a,i++}return n},Nde=/[!'()~]|%20/g,Ide={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Ade=function(e){return Ide[e]},qj=function(e){return Bj(Ede(e),Nde,Ade)},ER=ode(function(e,t){Mj(this,{type:jj,target:oo(e).entries,index:0,kind:t})},em,function(){var e=gde(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Dy(void 0,!0);var i=t[n];switch(e.kind){case"keys":return Dy(i.key,!1);case"values":return Dy(i.value,!1)}return Dy([i.key,i.value],!1)},!0),Yj=function(e){this.entries=[],this.url=null,e!==void 0&&(Dj(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Ly(e,0)==="?"?Hj(e,1):e:Xi(e)))};Yj.prototype={type:em,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,a,l,u,h,m=this.entries,g=pde(e);if(g)for(n=(t=Lj(e,g)).next;!(i=Py(n,t)).done;){if(l=(a=Lj(ude(i.value))).next,(u=Py(l,a)).done||(h=Py(l,a)).done||!Py(l,a).done)throw new _de("Expected sequence with length 2");xd(m,{key:Xi(u.value),value:Xi(h.value)})}else for(var _ in e)cde(e,_)&&xd(m,{key:_,value:Xi(e[_])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,a=Wj(e,"&"),l=0;l<a.length;)(t=a[l++]).length&&(n=Wj(t,"="),xd(i,{key:zj(Tde(n)),value:zj(Fj(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],xd(n,qj(e.key)+"="+qj(e.value));return Fj(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var jy=function(){Pj(this,tm);var e=Mj(this,new Yj(arguments.length>0?arguments[0]:void 0));e_||(this.size=e.entries.length)},tm=jy.prototype;if(ide(tm,{append:function(e,t){var n=oo(this);Zp(arguments.length,2),xd(n.entries,{key:Xi(e),value:Xi(t)}),e_||this.length++,n.updateURL()},delete:function(e){for(var t=oo(this),n=Zp(arguments.length,1),i=t.entries,a=Xi(e),l=n<2?void 0:arguments[1],u=l===void 0?l:Xi(l),h=0;h<i.length;){var m=i[h];if(m.key!==a||u!==void 0&&m.value!==u)h++;else if(Gj(i,h,1),u!==void 0)break}e_||(this.size=i.length),t.updateURL()},get:function(e){var t=oo(this).entries;Zp(arguments.length,1);for(var n=Xi(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=oo(this).entries;Zp(arguments.length,1);for(var n=Xi(e),i=[],a=0;a<t.length;a++)t[a].key===n&&xd(i,t[a].value);return i},has:function(e){for(var t=oo(this).entries,n=Zp(arguments.length,1),i=Xi(e),a=n<2?void 0:arguments[1],l=a===void 0?a:Xi(a),u=0;u<t.length;){var h=t[u++];if(h.key===i&&(l===void 0||h.value===l))return!0}return!1},set:function(e,t){var n=oo(this);Zp(arguments.length,1);for(var i,a=n.entries,l=!1,u=Xi(e),h=Xi(t),m=0;m<a.length;m++)(i=a[m]).key===u&&(l?Gj(a,m--,1):(l=!0,i.value=h));l||xd(a,{key:u,value:h}),e_||(this.size=a.length),n.updateURL()},sort:function(){var e=oo(this);mde(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=oo(this).entries,i=lde(e,arguments.length>1?arguments[1]:void 0),a=0;a<n.length;)i((t=n[a++]).value,t.key,this)},keys:function(){return new ER(this,"keys")},values:function(){return new ER(this,"values")},entries:function(){return new ER(this,"entries")}},{enumerable:!0}),Oj(tm,fde,tm.entries,{name:"entries"}),Oj(tm,"toString",function(){return oo(this).serialize()},{enumerable:!0}),e_&&sde(tm,"size",{get:function(){return oo(this).entries.length},configurable:!0,enumerable:!0}),ade(jy,em),pR({global:!0,constructor:!0,forced:!Aj},{URLSearchParams:jy}),!Aj&&gR(t_)){var Ode=Wo(Vj.has),Pde=Wo(Vj.set),Xj=function(e){if(Dj(e)){var t,n=e.body;if(dde(n)===em)return t=e.headers?new t_(e.headers):new t_,Ode(t,"content-type")||Pde(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),hde(e,{body:kj(0,Xi(n)),headers:kj(0,t)})}return e};if(gR(Uj)&&pR({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Uj(e,arguments.length>1?Xj(arguments[1]):{})}}),gR(ky)){var vR=function(e){return Pj(this,_R),new ky(e,arguments.length>1?Xj(arguments[1]):{})};_R.constructor=vR,vR.prototype=_R,pR({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:vR})}}var co,Dde={URLSearchParams:jy,getState:oo},kde=fs.URLSearchParams,Qj=he,Lde=D,jde=Oe,Mde=f,yR=ly,Ude=Wg,Vde=Re,Fde=Mc,Bde=Ar,nm=Object.assign,Jj=Object.defineProperty,Gde=Lde([].concat),Wde=!nm||Mde(function(){if(Qj&&nm({b:1},nm(Jj({},"a",{enumerable:!0,get:function(){Jj(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(a){t[a]=a}),nm({},e)[n]!==7||yR(nm({},t)).join("")!==i})?function(e,t){for(var n=Fde(e),i=arguments.length,a=1,l=Ude.f,u=Vde.f;i>a;)for(var h,m=Bde(arguments[a++]),g=l?Gde(yR(m),l(m)):yR(m),_=g.length,v=0;_>v;)h=g[v++],Qj&&!jde(u,m,h)||(n[h]=m[h]);return n}:nm,Hde=zi,Kde=Mk,zde=he,qde=ao,Yde=er,SR=function(e,t,n){zde?qde.f(e,t,Yde(0,n)):e[t]=n},Xde=yd,Qde=Oe,Jde=Mc,$de=function(e,t,n,i){try{return i?t(Hde(n)[0],n[1]):t(n)}catch(a){Kde(e,"throw",a)}},Zde=kk,eue=by,tue=Sd,$j=SR,nue=EC,rue=hy,Zj=Array,$u=D,TR=2147483647,sue=/[^\0-\u007E]/,e2=/[.\u3002\uFF0E\uFF61]/g,t2="Overflow: input needs wider integers to process",n2=RangeError,iue=$u(e2.exec),rm=Math.floor,bR=String.fromCharCode,r2=$u("".charCodeAt),s2=$u([].join),Nd=$u([].push),aue=$u("".replace),oue=$u("".split),cue=$u("".toLowerCase),i2=function(e){return e+22+75*(e<26)},lue=function(e,t,n){var i=0;for(e=n?rm(e/700):e>>1,e+=rm(e/t);e>455;)e=rm(e/35),i+=36;return rm(i+36*e/(e+38))},due=function(e){var t=[];e=function(M){for(var F=[],q=0,J=M.length;q<J;){var te=r2(M,q++);if(te>=55296&&te<=56319&&q<J){var Y=r2(M,q++);(64512&Y)==56320?Nd(F,((1023&te)<<10)+(1023&Y)+65536):(Nd(F,te),q--)}else Nd(F,te)}return F}(e);var n,i,a=e.length,l=128,u=0,h=72;for(n=0;n<e.length;n++)(i=e[n])<128&&Nd(t,bR(i));var m=t.length,g=m;for(m&&Nd(t,"-");g<a;){var _=TR;for(n=0;n<e.length;n++)(i=e[n])>=l&&i<_&&(_=i);var v=g+1;if(_-l>rm((TR-u)/v))throw new n2(t2);for(u+=(_-l)*v,l=_,n=0;n<e.length;n++){if((i=e[n])<l&&++u>TR)throw new n2(t2);if(i===l){for(var S=u,T=36;;){var P=T<=h?1:T>=h+26?26:T-h;if(S<P)break;var x=S-P,N=36-P;Nd(t,bR(i2(P+x%N))),S=rm(x/N),T+=36}Nd(t,bR(i2(S))),h=lue(u,v,g===m),u=0,g++}}u++,l++}return s2(t,"")},uue=an,wR=he,hue=Oy,CR=G,a2=yd,lo=D,My=bd,uo=Ty,pue=AC,RR=Bs,xR=Wde,sm=function(e){var t=Jde(e),n=eue(this),i=arguments.length,a=i>1?arguments[1]:void 0,l=a!==void 0;l&&(a=Xde(a,i>2?arguments[2]:void 0));var u,h,m,g,_,v,S=rue(t),T=0;if(!S||this===Zj&&Zde(S))for(u=tue(t),h=n?new this(u):Zj(u);u>T;T++)v=l?a(t[T],T):t[T],$j(h,T,v);else for(h=n?new this:[],_=(g=nue(t,S)).next;!(m=Qde(_,g)).done;T++)v=l?$de(g,a,[m.value,T],!0):m.value,$j(h,T,v);return h.length=T,h},Ho=wd,mue=oR.codeAt,fue=function(e){var t,n,i=[],a=oue(aue(cue(e),e2,"."),".");for(t=0;t<a.length;t++)n=a[t],Nd(i,iue(sue,n)?"xn--"+due(n):n);return s2(i,".")},Dl=qi,gue=Pl,_ue=Xu,o2=Dde,c2=Yu,Eue=c2.set,Uy=c2.getterFor("URL"),vue=o2.URLSearchParams,yue=o2.getState,n_=CR.URL,NR=CR.TypeError,Vy=CR.parseInt,Sue=Math.floor,l2=Math.pow,ho=lo("".charAt),Ko=lo(/./.exec),r_=lo([].join),Tue=lo(1.1.toString),bue=lo([].pop),im=lo([].push),IR=lo("".replace),wue=lo([].shift),Cue=lo("".split),s_=lo("".slice),Fy=lo("".toLowerCase),Rue=lo([].unshift),AR="Invalid scheme",Zu="Invalid host",d2="Invalid port",u2=/[a-z]/i,xue=/[\d+-.a-z]/i,OR=/\d/,Nue=/^0x/i,Iue=/^[0-7]+$/,Aue=/^\d+$/,h2=/^[\da-f]+$/i,Oue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Pue=/[\0\t\n\r #/:<>?@[\\\]^|]/,Due=/^[\u0000-\u0020]+/,kue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Lue=/[\t\n\r]/g,i_=function(e){var t,n,i,a;if(typeof e=="number"){for(t=[],n=0;n<4;n++)Rue(t,e%256),e=Sue(e/256);return r_(t,".")}if(typeof e=="object"){for(t="",i=function(l){for(var u=null,h=1,m=null,g=0,_=0;_<8;_++)l[_]!==0?(g>h&&(u=m,h=g),m=null,g=0):(m===null&&(m=_),++g);return g>h?m:u}(e),n=0;n<8;n++)a&&e[n]===0||(a&&(a=!1),i===n?(t+=n?":":"::",a=!0):(t+=Tue(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},By={},p2=xR({},By,{" ":1,'"':1,"<":1,">":1,"`":1}),m2=xR({},p2,{"#":1,"?":1,"{":1,"}":1}),PR=xR({},m2,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Id=function(e,t){var n=mue(e,0);return n>32&&n<127&&!RR(t,e)?e:encodeURIComponent(e)},Gy={ftp:21,file:null,http:80,https:443,ws:80,wss:443},a_=function(e,t){var n;return e.length===2&&Ko(u2,ho(e,0))&&((n=ho(e,1))===":"||!t&&n==="|")},f2=function(e){var t;return e.length>1&&a_(s_(e,0,2))&&(e.length===2||(t=ho(e,2))==="/"||t==="\\"||t==="?"||t==="#")},jue=function(e){return e==="."||Fy(e)==="%2e"},DR={},g2={},kR={},_2={},E2={},LR={},v2={},y2={},Wy={},Hy={},jR={},MR={},UR={},VR={},S2={},FR={},am={},Fc={},T2={},eh={},kl={},BR=function(e,t,n){var i,a,l,u=Dl(e);if(t){if(a=this.parse(u))throw new NR(a);this.searchParams=null}else{if(n!==void 0&&(i=new BR(n,!0)),a=this.parse(u,null,i))throw new NR(a);(l=yue(new vue)).bindURL(this),this.searchParams=l}};BR.prototype={type:"URL",parse:function(e,t,n){var i,a,l,u,h,m=this,g=t||DR,_=0,v="",S=!1,T=!1,P=!1;for(e=Dl(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=IR(e,Due,""),e=IR(e,kue,"$1")),e=IR(e,Lue,""),i=sm(e);_<=i.length;){switch(a=i[_],g){case DR:if(!a||!Ko(u2,a)){if(t)return AR;g=kR;continue}v+=Fy(a),g=g2;break;case g2:if(a&&(Ko(xue,a)||a==="+"||a==="-"||a==="."))v+=Fy(a);else{if(a!==":"){if(t)return AR;v="",g=kR,_=0;continue}if(t&&(m.isSpecial()!==RR(Gy,v)||v==="file"&&(m.includesCredentials()||m.port!==null)||m.scheme==="file"&&!m.host))return;if(m.scheme=v,t)return void(m.isSpecial()&&Gy[m.scheme]===m.port&&(m.port=null));v="",m.scheme==="file"?g=VR:m.isSpecial()&&n&&n.scheme===m.scheme?g=_2:m.isSpecial()?g=y2:i[_+1]==="/"?(g=E2,_++):(m.cannotBeABaseURL=!0,im(m.path,""),g=T2)}break;case kR:if(!n||n.cannotBeABaseURL&&a!=="#")return AR;if(n.cannotBeABaseURL&&a==="#"){m.scheme=n.scheme,m.path=Ho(n.path),m.query=n.query,m.fragment="",m.cannotBeABaseURL=!0,g=kl;break}g=n.scheme==="file"?VR:LR;continue;case _2:if(a!=="/"||i[_+1]!=="/"){g=LR;continue}g=Wy,_++;break;case E2:if(a==="/"){g=Hy;break}g=Fc;continue;case LR:if(m.scheme=n.scheme,a===co)m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=Ho(n.path),m.query=n.query;else if(a==="/"||a==="\\"&&m.isSpecial())g=v2;else if(a==="?")m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=Ho(n.path),m.query="",g=eh;else{if(a!=="#"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=Ho(n.path),m.path.length--,g=Fc;continue}m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=Ho(n.path),m.query=n.query,m.fragment="",g=kl}break;case v2:if(!m.isSpecial()||a!=="/"&&a!=="\\"){if(a!=="/"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,g=Fc;continue}g=Hy}else g=Wy;break;case y2:if(g=Wy,a!=="/"||ho(v,_+1)!=="/")continue;_++;break;case Wy:if(a!=="/"&&a!=="\\"){g=Hy;continue}break;case Hy:if(a==="@"){S&&(v="%40"+v),S=!0,l=sm(v);for(var x=0;x<l.length;x++){var N=l[x];if(N!==":"||P){var M=Id(N,PR);P?m.password+=M:m.username+=M}else P=!0}v=""}else if(a===co||a==="/"||a==="?"||a==="#"||a==="\\"&&m.isSpecial()){if(S&&v==="")return"Invalid authority";_-=sm(v).length+1,v="",g=jR}else v+=a;break;case jR:case MR:if(t&&m.scheme==="file"){g=FR;continue}if(a!==":"||T){if(a===co||a==="/"||a==="?"||a==="#"||a==="\\"&&m.isSpecial()){if(m.isSpecial()&&v==="")return Zu;if(t&&v===""&&(m.includesCredentials()||m.port!==null))return;if(u=m.parseHost(v))return u;if(v="",g=am,t)return;continue}a==="["?T=!0:a==="]"&&(T=!1),v+=a}else{if(v==="")return Zu;if(u=m.parseHost(v))return u;if(v="",g=UR,t===MR)return}break;case UR:if(!Ko(OR,a)){if(a===co||a==="/"||a==="?"||a==="#"||a==="\\"&&m.isSpecial()||t){if(v!==""){var F=Vy(v,10);if(F>65535)return d2;m.port=m.isSpecial()&&F===Gy[m.scheme]?null:F,v=""}if(t)return;g=am;continue}return d2}v+=a;break;case VR:if(m.scheme="file",a==="/"||a==="\\")g=S2;else{if(!n||n.scheme!=="file"){g=Fc;continue}switch(a){case co:m.host=n.host,m.path=Ho(n.path),m.query=n.query;break;case"?":m.host=n.host,m.path=Ho(n.path),m.query="",g=eh;break;case"#":m.host=n.host,m.path=Ho(n.path),m.query=n.query,m.fragment="",g=kl;break;default:f2(r_(Ho(i,_),""))||(m.host=n.host,m.path=Ho(n.path),m.shortenPath()),g=Fc;continue}}break;case S2:if(a==="/"||a==="\\"){g=FR;break}n&&n.scheme==="file"&&!f2(r_(Ho(i,_),""))&&(a_(n.path[0],!0)?im(m.path,n.path[0]):m.host=n.host),g=Fc;continue;case FR:if(a===co||a==="/"||a==="\\"||a==="?"||a==="#"){if(!t&&a_(v))g=Fc;else if(v===""){if(m.host="",t)return;g=am}else{if(u=m.parseHost(v))return u;if(m.host==="localhost"&&(m.host=""),t)return;v="",g=am}continue}v+=a;break;case am:if(m.isSpecial()){if(g=Fc,a!=="/"&&a!=="\\")continue}else if(t||a!=="?")if(t||a!=="#"){if(a!==co&&(g=Fc,a!=="/"))continue}else m.fragment="",g=kl;else m.query="",g=eh;break;case Fc:if(a===co||a==="/"||a==="\\"&&m.isSpecial()||!t&&(a==="?"||a==="#")){if((h=Fy(h=v))===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(m.shortenPath(),a==="/"||a==="\\"&&m.isSpecial()||im(m.path,"")):jue(v)?a==="/"||a==="\\"&&m.isSpecial()||im(m.path,""):(m.scheme==="file"&&!m.path.length&&a_(v)&&(m.host&&(m.host=""),v=ho(v,0)+":"),im(m.path,v)),v="",m.scheme==="file"&&(a===co||a==="?"||a==="#"))for(;m.path.length>1&&m.path[0]==="";)wue(m.path);a==="?"?(m.query="",g=eh):a==="#"&&(m.fragment="",g=kl)}else v+=Id(a,m2);break;case T2:a==="?"?(m.query="",g=eh):a==="#"?(m.fragment="",g=kl):a!==co&&(m.path[0]+=Id(a,By));break;case eh:t||a!=="#"?a!==co&&(a==="'"&&m.isSpecial()?m.query+="%27":m.query+=a==="#"?"%23":Id(a,By)):(m.fragment="",g=kl);break;case kl:a!==co&&(m.fragment+=Id(a,p2))}_++}},parseHost:function(e){var t,n,i;if(ho(e,0)==="["){if(ho(e,e.length-1)!=="]"||(t=function(a){var l,u,h,m,g,_,v,S=[0,0,0,0,0,0,0,0],T=0,P=null,x=0,N=function(){return ho(a,x)};if(N()===":"){if(ho(a,1)!==":")return;x+=2,P=++T}for(;N();){if(T===8)return;if(N()!==":"){for(l=u=0;u<4&&Ko(h2,N());)l=16*l+Vy(N(),16),x++,u++;if(N()==="."){if(u===0||(x-=u,T>6))return;for(h=0;N();){if(m=null,h>0){if(!(N()==="."&&h<4))return;x++}if(!Ko(OR,N()))return;for(;Ko(OR,N());){if(g=Vy(N(),10),m===null)m=g;else{if(m===0)return;m=10*m+g}if(m>255)return;x++}S[T]=256*S[T]+m,++h!=2&&h!==4||T++}if(h!==4)return;break}if(N()===":"){if(x++,!N())return}else if(N())return;S[T++]=l}else{if(P!==null)return;x++,P=++T}}if(P!==null)for(_=T-P,T=7;T!==0&&_>0;)v=S[T],S[T--]=S[P+_-1],S[P+--_]=v;else if(T!==8)return;return S}(s_(e,1,-1)),!t))return Zu;this.host=t}else if(this.isSpecial()){if(e=fue(e),Ko(Oue,e)||(t=function(a){var l,u,h,m,g,_,v,S=Cue(a,".");if(S.length&&S[S.length-1]===""&&S.length--,(l=S.length)>4)return a;for(u=[],h=0;h<l;h++){if((m=S[h])==="")return a;if(g=10,m.length>1&&ho(m,0)==="0"&&(g=Ko(Nue,m)?16:8,m=s_(m,g===8?1:2)),m==="")_=0;else{if(!Ko(g===10?Aue:g===8?Iue:h2,m))return a;_=Vy(m,g)}im(u,_)}for(h=0;h<l;h++)if(_=u[h],h===l-1){if(_>=l2(256,5-l))return null}else if(_>255)return null;for(v=bue(u),h=0;h<u.length;h++)v+=u[h]*l2(256,3-h);return v}(e),t===null))return Zu;this.host=t}else{if(Ko(Pue,e))return Zu;for(t="",n=sm(e),i=0;i<n.length;i++)t+=Id(n[i],By);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return RR(Gy,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&a_(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,a=e.host,l=e.port,u=e.path,h=e.query,m=e.fragment,g=t+":";return a!==null?(g+="//",e.includesCredentials()&&(g+=n+(i?":"+i:"")+"@"),g+=i_(a),l!==null&&(g+=":"+l)):t==="file"&&(g+="//"),g+=e.cannotBeABaseURL?u[0]:u.length?"/"+r_(u,"/"):"",h!==null&&(g+="?"+h),m!==null&&(g+="#"+m),g},setHref:function(e){var t=this.parse(e);if(t)throw new NR(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new om(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+i_(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Dl(e)+":",DR)},getUsername:function(){return this.username},setUsername:function(e){var t=sm(Dl(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Id(t[n],PR)}},getPassword:function(){return this.password},setPassword:function(e){var t=sm(Dl(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Id(t[n],PR)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?i_(e):i_(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,jR)},getHostname:function(){var e=this.host;return e===null?"":i_(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,MR)},getPort:function(){var e=this.port;return e===null?"":Dl(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Dl(e))===""?this.port=null:this.parse(e,UR))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+r_(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,am))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Dl(e))===""?this.query=null:(ho(e,0)==="?"&&(e=s_(e,1)),this.query="",this.parse(e,eh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Dl(e))!==""?(ho(e,0)==="#"&&(e=s_(e,1)),this.fragment="",this.parse(e,kl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var om=function(e){var t=pue(this,Qi),n=_ue(arguments.length,1)>1?arguments[1]:void 0,i=Eue(t,new BR(e,!1,n));wR||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},Qi=om.prototype,po=function(e,t){return{get:function(){return Uy(this)[e]()},set:t&&function(n){return Uy(this)[t](n)},configurable:!0,enumerable:!0}};if(wR&&(uo(Qi,"href",po("serialize","setHref")),uo(Qi,"origin",po("getOrigin")),uo(Qi,"protocol",po("getProtocol","setProtocol")),uo(Qi,"username",po("getUsername","setUsername")),uo(Qi,"password",po("getPassword","setPassword")),uo(Qi,"host",po("getHost","setHost")),uo(Qi,"hostname",po("getHostname","setHostname")),uo(Qi,"port",po("getPort","setPort")),uo(Qi,"pathname",po("getPathname","setPathname")),uo(Qi,"search",po("getSearch","setSearch")),uo(Qi,"searchParams",po("getSearchParams")),uo(Qi,"hash",po("getHash","setHash"))),My(Qi,"toJSON",function(){return Uy(this).serialize()},{enumerable:!0}),My(Qi,"toString",function(){return Uy(this).serialize()},{enumerable:!0}),n_){var b2=n_.createObjectURL,w2=n_.revokeObjectURL;b2&&My(om,"createObjectURL",a2(b2,n_)),w2&&My(om,"revokeObjectURL",a2(w2,n_))}gue(om,"URL"),uue({global:!0,constructor:!0,forced:!hue,sham:!wR},{URL:om});var Mue=an,C2=f,Uue=Xu,R2=qi,Vue=Oy,GR=Le("URL"),Fue=Vue&&C2(function(){GR.canParse()}),Bue=C2(function(){return GR.canParse.length!==1});Mue({target:"URL",stat:!0,forced:!Fue||Bue},{canParse:function(e){var t=Uue(arguments.length,1),n=R2(e),i=t<2||arguments[1]===void 0?void 0:R2(arguments[1]);try{return!!new GR(n,i)}catch{return!1}}});var Gue=an,Wue=Xu,x2=qi,Hue=Oy,Kue=Le("URL");Gue({target:"URL",stat:!0,forced:!Hue},{parse:function(e){var t=Wue(arguments.length,1),n=x2(e),i=t<2||arguments[1]===void 0?void 0:x2(arguments[1]);try{return new Kue(n,i)}catch{return null}}});var Ky=p(fs.URL);let N2=!0,I2=!0;function zy(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function th(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,a=i.addEventListener;i.addEventListener=function(u,h){if(u!==t)return a.apply(this,arguments);const m=g=>{const _=n(g);_&&(h.handleEvent?h.handleEvent(_):h(_))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(h,m),a.apply(this,[u,m])};const l=i.removeEventListener;i.removeEventListener=function(u,h){if(u!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(h))return l.apply(this,arguments);const m=this._eventMap[t].get(h);return this._eventMap[t].delete(h),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[u,m])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(u){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),u&&this.addEventListener(t,this["_on"+t]=u)},enumerable:!0,configurable:!0})}function zue(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(N2=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function que(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(I2=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function A2(){if(typeof window=="object"){if(N2)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function WR(e,t){I2&&console.warn(e+" is deprecated, please use "+t+" instead.")}function O2(e){return Object.prototype.toString.call(e)==="[object Object]"}function P2(e){var t;return O2(e)?ka(t=Object.keys(e)).call(t,function(n,i){const a=O2(e[i]),l=a?P2(e[i]):e[i],u=a&&!Object.keys(l).length;return l===void 0||u?n:Object.assign(n,{[i]:l})},{}):e}function HR(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?HR(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(a=>{HR(e,e.get(a),n)})}))}function D2(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",a=new Map;if(t===null)return a;const l=[];return e.forEach(u=>{u.type==="track"&&u.trackIdentifier===t.id&&l.push(u)}),l.forEach(u=>{e.forEach(h=>{h.type===i&&h.trackId===u.id&&HR(e,h,a)})}),a}const k2=A2;function L2(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const h={};return Object.keys(u).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const g=typeof u[m]=="object"?u[m]:{ideal:u[m]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const _=function(v,S){return v?v+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(g.ideal!==void 0){h.optional=h.optional||[];let v={};typeof g.ideal=="number"?(v[_("min",m)]=g.ideal,h.optional.push(v),v={},v[_("max",m)]=g.ideal,h.optional.push(v)):(v[_("",m)]=g.ideal,h.optional.push(v))}g.exact!==void 0&&typeof g.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[_("",m)]=g.exact):["min","max"].forEach(v=>{g[v]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[_(v,m)]=g[v])})}),u.advanced&&(h.optional=(h.optional||[]).concat(u.advanced)),h},a=function(u,h){if(t.version>=61)return h(u);if((u=JSON.parse(JSON.stringify(u)))&&typeof u.audio=="object"){const m=function(g,_,v){_ in g&&!(v in g)&&(g[v]=g[_],delete g[_])};m((u=JSON.parse(JSON.stringify(u))).audio,"autoGainControl","googAutoGainControl"),m(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=i(u.audio)}if(u&&typeof u.video=="object"){let m=u.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const g=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||g)){let _;if(delete u.video.facingMode,m.exact==="environment"||m.ideal==="environment"?_=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(_=["front"]),_)return n.mediaDevices.enumerateDevices().then(v=>{v=v.filter(T=>T.kind==="videoinput");let S=v.find(T=>_.some(P=>{var x;return Ee(x=T.label.toLowerCase()).call(x,P)}));return!S&&v.length&&Ee(_).call(_,"back")&&(S=v[v.length-1]),S&&(u.video.deviceId=m.exact?{exact:S.deviceId}:{ideal:S.deviceId}),u.video=i(u.video),k2("chrome: "+JSON.stringify(u)),h(u)})}u.video=i(u.video)}return k2("chrome: "+JSON.stringify(u)),h(u)},l=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(u,h,m){a(u,g=>{n.webkitGetUserMedia(g,h,_=>{m&&m(l(_))})})}).bind(n),n.mediaDevices.getUserMedia){const u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(h){return a(h,m=>u(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return g},g=>Ne.reject(l(g))))}}}function j2(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function M2(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===i.track.id):{track:i.track};const l=new Event("track");l.track=i.track,l.receiver=a,l.transceiver={receiver:a},l.streams=[n.stream],this.dispatchEvent(l)}),n.stream.getTracks().forEach(i=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===i.id):{track:i};const l=new Event("track");l.track=i,l.receiver=a,l.transceiver={receiver:a},l.streams=[n.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else th(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function U2(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(a,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=a.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){let m=a.apply(this,arguments);return m||(m=t(this,u),this._senders.push(m)),m};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);const h=this._senders.indexOf(u);h!==-1&&this._senders.splice(h,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],i.apply(this,[a]),a.getTracks().forEach(l=>{const u=this._senders.find(h=>h.track===l);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function V2(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const l=function(h){const m={};return h.result().forEach(g=>{const _={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(v=>{_[v]=g.stat(v)}),m[_.id]=_}),m},u=function(h){return new Map(Object.keys(h).map(m=>[m,h[m]]))};if(arguments.length>=2){const h=function(m){i(u(l(m)))};return t.apply(this,[h,n])}return new Ne((h,m)=>{t.apply(this,[function(g){h(u(l(g)))},m])}).then(i,a)}}function F2(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=n.apply(this,[]);return a.forEach(l=>l._pc=this),a});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=i.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(l=>D2(l,a.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(a=>a._pc=this),i}),th(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>D2(a,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,a,l;return this.getSenders().forEach(u=>{u.track===n&&(i?l=!0:i=u)}),this.getReceivers().forEach(u=>(u.track===n&&(a?l=!0:a=u),u.track===n)),l||i&&a?Ne.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():Ne.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function B2(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(h)===-1&&this._shimmedLocalStreams[u.id].push(h):this._shimmedLocalStreams[u.id]=[u,h],h};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();n.apply(this,arguments);const h=this.getSenders().filter(m=>u.indexOf(m)===-1);this._shimmedLocalStreams[l.id]=[l].concat(h)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],i.apply(this,arguments)};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const h=this._shimmedLocalStreams[u].indexOf(l);h!==-1&&this._shimmedLocalStreams[u].splice(h,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),a.apply(this,arguments)}}function G2(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return B2(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=n.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(v=>v.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new e.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}i.apply(this,[m])};const a=e.RTCPeerConnection.prototype.removeStream;function l(m,g){let _=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const S=m._reverseStreams[v],T=m._streams[S.id];_=_.replace(new RegExp(T.id,"g"),S.id)}),new RTCSessionDescription({type:g.type,sdp:_})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(T=>T===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[g.id];if(S)S.addTrack(m),Ne.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new e.MediaStream([m]);this._streams[g.id]=T,this._reverseStreams[T.id]=g,this.addStream(T)}return this.getSenders().find(T=>T.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=e.RTCPeerConnection.prototype[m],_={[m](){const v=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[S=>{const T=l(this,S);v[0].apply(null,[T])},S=>{v[1]&&v[1].apply(null,S)},arguments[2]]):g.apply(this,arguments).then(S=>l(this,S))}};e.RTCPeerConnection.prototype[m]=_[m]});const u=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let _=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const S=m._reverseStreams[v],T=m._streams[S.id];_=_.replace(new RegExp(S.id,"g"),T.id)}),new RTCSessionDescription({type:g.type,sdp:_})}(this,arguments[0]),u.apply(this,arguments)):u.apply(this,arguments)};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=h.get.apply(this);return m.type===""?m:l(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(v=>m.track===v)&&(g=this._streams[_])}),g&&(g.getTracks().length===1?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function KR(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]})}function W2(e,t){th(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var H2=Object.freeze({__proto__:null,fixNegotiationNeeded:W2,shimAddTrackRemoveTrack:G2,shimAddTrackRemoveTrackWithNative:B2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const a=n.video&&n.video.width,l=n.video&&n.video.height,u=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:u||3}},a&&(n.video.mandatory.maxWidth=a),l&&(n.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:U2,shimGetStats:V2,shimGetUserMedia:L2,shimMediaStream:j2,shimOnTrack:M2,shimPeerConnection:KR,shimSenderReceiverGetStats:F2});function K2(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(a,l,u){WR("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(a).then(l,u)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const a=function(u,h,m){h in u&&!(m in u)&&(u[m]=u[h],delete u[h])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),a(u.audio,"autoGainControl","mozAutoGainControl"),a(u.audio,"noiseSuppression","mozNoiseSuppression")),l(u)},i&&i.prototype.getSettings){const u=i.prototype.getSettings;i.prototype.getSettings=function(){const h=u.apply(this,arguments);return a(h,"mozAutoGainControl","autoGainControl"),a(h,"mozNoiseSuppression","noiseSuppression"),h}}if(i&&i.prototype.applyConstraints){const u=i.prototype.applyConstraints;i.prototype.applyConstraints=function(h){return this.kind==="audio"&&typeof h=="object"&&(h=JSON.parse(JSON.stringify(h)),a(h,"autoGainControl","mozAutoGainControl"),a(h,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[h])}}}}function z2(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zR(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const l=e.RTCPeerConnection.prototype[a],u={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=u[a]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[a,l,u]=arguments;return i.apply(this,[a||null]).then(h=>{if(t.version<53&&!l)try{h.forEach(m=>{m.type=n[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;h.forEach((g,_)=>{h.set(_,Object.assign({},g,{type:n[g.type]||g.type}))})}return h}).then(l,u)}}function q2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ne.resolve(new Map)}}function Y2(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),th(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function X2(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){WR("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&Ee(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function Q2(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function J2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=t.apply(this,arguments);if(i){const{sender:l}=a,u=l.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=n,l.sendEncodings=n,this.setParametersPromises.push(l.setParameters(u).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return a})}function $2(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Z2(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ne.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function eM(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ne.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var tM=Object.freeze({__proto__:null,shimAddTransceiver:J2,shimCreateAnswer:eM,shimCreateOffer:Z2,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Ne.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:$2,shimGetUserMedia:K2,shimOnTrack:z2,shimPeerConnection:zR,shimRTCDataChannel:Q2,shimReceiverGetStats:Y2,shimRemoveStream:X2,shimSenderGetStats:q2});function nM(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),Ee(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(a=>t.call(this,a,n)),n.getVideoTracks().forEach(a=>t.call(this,a,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,a=new Array(i>1?i-1:0),l=1;l<i;l++)a[l-1]=arguments[l];return a&&a.forEach(u=>{var h;this._localStreams?Ee(h=this._localStreams).call(h,u)||this._localStreams.push(u):this._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(a=>{Ee(i).call(i,a.track)&&this.removeTrack(a)})})}}function rM(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(a=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),Ee(l=this._remoteStreams).call(l,a))return;this._remoteStreams.push(a);const u=new Event("addstream");u.stream=a,this.dispatchEvent(u)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);const l=new Event("addstream");l.stream=a,n.dispatchEvent(l)})}),t.apply(n,arguments)}}}function sM(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,a=t.setLocalDescription,l=t.setRemoteDescription,u=t.addIceCandidate;t.createOffer=function(m,g){const _=arguments.length>=2?arguments[2]:arguments[0],v=n.apply(this,[_]);return g?(v.then(m,g),Ne.resolve()):v},t.createAnswer=function(m,g){const _=arguments.length>=2?arguments[2]:arguments[0],v=i.apply(this,[_]);return g?(v.then(m,g),Ne.resolve()):v};let h=function(m,g,_){const v=a.apply(this,[m]);return _?(v.then(g,_),Ne.resolve()):v};t.setLocalDescription=h,h=function(m,g,_){const v=l.apply(this,[m]);return _?(v.then(g,_),Ne.resolve()):v},t.setRemoteDescription=h,h=function(m,g,_){const v=u.apply(this,[m]);return _?(v.then(g,_),Ne.resolve()):v},t.addIceCandidate=h}function iM(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=a=>i(aM(a))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,a){t.mediaDevices.getUserMedia(n).then(i,a)}).bind(t))}function aM(e){return e&&e.video!==void 0?Object.assign({},e,{video:P2(e.video)}):e}function oM(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const a=[];for(let l=0;l<n.iceServers.length;l++){let u=n.iceServers[l];!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(WR("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,a.push(u)):a.push(n.iceServers[l])}n.iceServers=a}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function cM(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function lM(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const a=this.getTransceivers().find(l=>l.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo!==!0||a||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function dM(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var uM=Object.freeze({__proto__:null,shimAudioContext:dM,shimCallbacksAPI:sM,shimConstraints:aM,shimCreateOfferLegacy:lM,shimGetUserMedia:iM,shimLocalStreamsAPI:nM,shimRTCIceServerUrls:oM,shimRemoteStreamsAPI:rM,shimTrackEventTransceiver:cM}),hM=`	
\v\f\r \u2028\u2029\uFEFF`,Yue=Wr,Xue=qi,qR=hM,pM=D("".replace),Que=RegExp("^["+qR+"]+"),Jue=RegExp("(^|[^"+qR+"])["+qR+"]+$"),YR=function(e){return function(t){var n=Xue(Yue(t));return 1&e&&(n=pM(n,Que,"")),2&e&&(n=pM(n,Jue,"$1")),n}},$ue={start:YR(1),end:YR(2),trim:YR(3)},Zue=Yk.PROPER,ehe=f,mM=hM,the=$ue.trim;an({target:"String",proto:!0,forced:function(e){return ehe(function(){return!!mM[e]()||""[e]()!==""||Zue&&mM[e].name!==e})}("trim")},{trim:function(){return the(this)}});var nhe=Da("String","trim"),rhe=k,she=nhe,XR=String.prototype,ihe=function(e){var t=e.trim;return typeof e=="string"||e===XR||rhe(XR,e)&&t===XR.trim?she:t},ai=p(ihe),fM={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((i,a)=>(a>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(a=>a.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const a={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let l=8;l<i.length;l+=2)switch(i[l]){case"raddr":a.relatedAddress=i[l+1];break;case"rport":a.relatedPort=parseInt(i[l+1],10);break;case"tcptype":a.tcpType=i[l+1];break;case"ufrag":a.ufrag=i[l+1],a.usernameFragment=i[l+1];break;default:a[i[l]]===void 0&&(a[i[l]]=i[l+1])}return a},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const a=n.component;a==="rtp"?i.push(1):a==="rtcp"?i.push(2):i.push(a),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const l=n.type;return i.push("typ"),i.push(l),l!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const a=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let a;const l=n.substring(n.indexOf(" ")+1).split(";");for(let u=0;u<l.length;u++)a=l[u].trim().split("="),i[a[0].trim()]=a[1];return i},t.writeFmtp=function(n){let i="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const l=[];Object.keys(n.parameters).forEach(u=>{n.parameters[u]!==void 0?l.push(u+"="+n.parameters[u]):l.push(u)}),i+="a=fmtp:"+a+" "+l.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(l=>{i+="a=rtcp-fb:"+a+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),a={ssrc:parseInt(n.substring(7,i),10)},l=n.indexOf(":",i);return l>-1?(a.attribute=n.substring(i+1,l),a.value=n.substring(l+1)):a.attribute=n.substring(i+1),a},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(a=>parseInt(a,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let a="a=setup:"+i+`\r
`;return n.fingerprints.forEach(l=>{a+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),a},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const a=t.matchPrefix(n+i,"a=ice-ufrag:")[0],l=t.matchPrefix(n+i,"a=ice-pwd:")[0];return a&&l?{usernameFragment:a.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=t.splitLines(n)[0].split(" ");i.profile=a[2];for(let u=3;u<a.length;u++){const h=a[u],m=t.matchPrefix(n,"a=rtpmap:"+h+" ")[0];if(m){const g=t.parseRtpMap(m),_=t.matchPrefix(n,"a=fmtp:"+h+" ");switch(g.parameters=_.length?t.parseFmtp(_[0]):{},g.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+h+" ").map(t.parseRtcpFb),i.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(g.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(u=>{i.headerExtensions.push(t.parseExtmap(u))});const l=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(u=>{l.forEach(h=>{u.rtcpFeedback.find(m=>m.type===h.type&&m.parameter===h.parameter)||u.rtcpFeedback.push(h)})}),i},t.writeRtpDescription=function(n,i){let a="";a+="m="+n+" ",a+=i.codecs.length>0?"9":"0",a+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=i.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(u=>{a+=t.writeRtpMap(u),a+=t.writeFmtp(u),a+=t.writeRtcpFb(u)});let l=0;return i.codecs.forEach(u=>{u.maxptime>l&&(l=u.maxptime)}),l>0&&(a+="a=maxptime:"+l+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(u=>{a+=t.writeExtmap(u)}),a},t.parseRtpEncodingParameters=function(n){const i=[],a=t.parseRtpParameters(n),l=a.fecMechanisms.indexOf("RED")!==-1,u=a.fecMechanisms.indexOf("ULPFEC")!==-1,h=t.matchPrefix(n,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),m=h.length>0&&h[0].ssrc;let g;const _=t.matchPrefix(n,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(T=>parseInt(T,10)));_.length>0&&_[0].length>1&&_[0][0]===m&&(g=_[0][1]),a.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let T={ssrc:m,codecPayloadType:parseInt(S.parameters.apt,10)};m&&g&&(T.rtx={ssrc:g}),i.push(T),l&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:m,mechanism:u?"red+ulpfec":"red"},i.push(T))}}),i.length===0&&m&&i.push({ssrc:m});let v=t.matchPrefix(n,"b=");return v.length&&(v=v[0].indexOf("b=TIAS:")===0?parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,i.forEach(S=>{S.maxBitrate=v})),i},t.parseRtcpParameters=function(n){const i={},a=t.matchPrefix(n,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname")[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);const l=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=l.length>0,i.compound=l.length===0;const u=t.matchPrefix(n,"a=rtcp-mux");return i.mux=u.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const a=t.matchPrefix(n,"a=msid:");if(a.length===1)return i=a[0].substring(7).split(" "),{stream:i[0],track:i[1]};const l=t.matchPrefix(n,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");return l.length>0?(i=l[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),a=t.matchPrefix(n,"a=max-message-size:");let l;a.length>0&&(l=parseInt(a[0].substring(19),10)),isNaN(l)&&(l=65536);const u=t.matchPrefix(n,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:i.fmt,maxMessageSize:l};const h=t.matchPrefix(n,"a=sctpmap:");if(h.length>0){const m=h[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},t.writeSctpDescription=function(n,i){let a=[];return a=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,a){let l;const u=i!==void 0?i:2;return l=n||t.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+l+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const a=t.splitLines(n);for(let l=0;l<a.length;l++)switch(a[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[l].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},e.exports=t})(fM);var gM=fM.exports,cm=p(gM),ahe=o({__proto__:null,default:cm},[gM]);function qy(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),a=cm.parseCandidate(n.candidate),l=Object.assign(i,a);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,th(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function QR(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||th(e,"icecandidate",t=>{if(t.candidate){const n=cm.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Yy(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(h){if(!h||!h.sdp)return!1;const m=cm.splitSections(h.sdp);return m.shift(),m.some(g=>{const _=cm.parseMLine(g);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},i=function(h){const m=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g},a=function(h){let m=65536;return t.browser==="firefox"&&(m=t.version<57?h===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},l=function(h,m){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const _=cm.matchPrefix(h.sdp,"a=max-message-size:");return _.length>0?g=parseInt(_[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(g=2147483637),g},u=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const h=i(arguments[0]),m=a(h),g=l(arguments[0],h);let _;_=m===0&&g===0?Number.POSITIVE_INFINITY:m===0||g===0?Math.max(m,g):Math.min(m,g);const v={};Object.defineProperty(v,"maxMessageSize",{get:()=>_}),this._sctp=v}return u.apply(this,arguments)}}function Xy(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,a){const l=i.send;i.send=function(){const u=arguments[0],h=u.length||u.size||u.byteLength;if(i.readyState==="open"&&a.sctp&&h>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return l.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},th(e,"datachannel",i=>(t(i.channel,i.target),i))}function JR(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const l=a.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const u=new Event("connectionstatechange",a);l.dispatchEvent(u)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function $R(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=i.sdp.split(`
`).filter(l=>ai(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return n.apply(this,arguments)}}function Qy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ne.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ne.resolve())})}function Jy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var ohe=Object.freeze({__proto__:null,removeExtmapAllowMixed:$R,shimAddIceCandidateNullOrEmpty:Qy,shimConnectionState:JR,shimMaxMessageSize:Yy,shimParameterlessSetLocalDescription:Jy,shimRTCIceCandidate:qy,shimRTCIceCandidateRelayProtocol:QR,shimSendThrowTypeError:Xy});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=A2,i=function(l){const u={browser:null,version:null};if(l===void 0||!l.navigator)return u.browser="Not a browser.",u;const{navigator:h}=l;if(h.mozGetUserMedia)u.browser="firefox",u.version=zy(h.userAgent,/Firefox\/(\d+)\./,1);else if(h.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)u.browser="chrome",u.version=zy(h.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!h.userAgent.match(/AppleWebKit\/(\d+)\./))return u.browser="Not a supported browser.",u;u.browser="safari",u.version=zy(h.userAgent,/AppleWebKit\/(\d+)\./,1),u.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return u}(e),a={browserDetails:i,commonShim:ohe,extractVersion:zy,disableLog:zue,disableWarnings:que,sdp:ahe};switch(i.browser){case"chrome":if(!H2||!KR||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=H2,Qy(e,i),Jy(e),L2(e,i),j2(e),KR(e,i),M2(e),G2(e,i),U2(e),V2(e),F2(e),W2(e,i),qy(e),QR(e),JR(e),Yy(e,i),Xy(e),$R(e,i);break;case"firefox":if(!tM||!zR||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=tM,Qy(e,i),Jy(e),K2(e,i),zR(e,i),z2(e),X2(e),q2(e),Y2(e),Q2(e),J2(e),$2(e),Z2(e),eM(e),qy(e),JR(e),Yy(e,i),Xy(e);break;case"safari":if(!uM||!t.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=uM,Qy(e,i),Jy(e),oM(e),lM(e),sM(e),nM(e),rM(e),cM(e),iM(e),dM(e),qy(e),QR(e),Yy(e,i),Xy(e),$R(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var che=f,_M=G.RegExp,lhe=!che(function(){var e=!0;try{_M(".","d")}catch{e=!1}var t={},n="",i=e?"dgimsy":"gimsy",a=function(h,m){Object.defineProperty(t,h,{get:function(){return n+=m,!0}})},l={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var u in e&&(l.hasIndices="d"),l)a(u,l[u]);return Object.getOwnPropertyDescriptor(_M.prototype,"flags").get.call(t)!==i||n!==i}),dhe=zi,uhe=Oe,hhe=Bs,phe=k,EM={correct:lhe},mhe=function(){var e=dhe(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},fhe=RegExp.prototype,ZR=EM.correct?function(e){return e.flags}:function(e){return EM.correct||!phe(fhe,e)||hhe(e,"flags")?e.flags:uhe(mhe,e)},ex=D,ghe=Math.floor,tx=ex("".charAt),_he=ex("".replace),nx=ex("".slice),Ehe=/\$([$&'`]|\d{1,2})/g,vhe=an,yhe=Oe,rx=D,vM=Wr,She=Ce,The=rs,bhe=rC,lm=qi,whe=Ug,Che=ZR,Rhe=function(e,t,n,i,a,l){var u=n+e.length,h=i.length,m=Ehe;return _he(l,m,function(g,_){var v;switch(tx(_,0)){case"$":return"$";case"&":return e;case"`":return nx(t,0,n);case"'":return nx(t,u);case"<":v=a[nx(_,1,-1)];break;default:var S=+_;if(S===0)return g;if(S>h){var T=ghe(S/10);return T===0?g:T<=h?i[T-1]===void 0?tx(_,1):i[T-1]+tx(_,1):g}v=i[S-1]}return v===void 0?"":v})},xhe=Or("replace"),Nhe=TypeError,sx=rx("".indexOf),Ihe=rx("".replace),yM=rx("".slice),Ahe=Math.max;vhe({target:"String",proto:!0},{replaceAll:function(e,t){var n,i,a,l,u,h,m,g,_,v,S=vM(this),T=0,P="";if(The(e)){if((n=bhe(e))&&(i=lm(vM(Che(e))),!~sx(i,"g")))throw new Nhe("`.replaceAll` does not allow non-global regexes");if(a=whe(e,xhe))return yhe(a,e,S,t);if(n)return Ihe(lm(S),e,t)}for(l=lm(S),u=lm(e),(h=She(t))||(t=lm(t)),m=u.length,g=Ahe(1,m),_=sx(l,u);_!==-1;)v=h?lm(t(u,_,l)):Rhe(u,l,_,[],void 0,t),P+=yM(l,T,_)+v,T=_+m,_=_+g>l.length?-1:sx(l,u,_+g);return T<l.length&&(P+=yM(l,T)),P}});var Ohe=Da("String","replaceAll"),Phe=k,Dhe=Ohe,ix=String.prototype,khe=function(e){var t=e.replaceAll;return typeof e=="string"||e===ix||Phe(ix,e)&&t===ix.replaceAll?Dhe:t},Lhe=p(khe),ax=G;an({global:!0,forced:ax.globalThis!==ax},{globalThis:ax});var SM=p(G),ox={exports:{}};(function(e,t){(function(n,i){var a="function",l="undefined",u="object",h="string",m="major",g="model",_="name",v="type",S="vendor",T="version",P="architecture",x="console",N="mobile",M="tablet",F="smarttv",q="wearable",J="embedded",te="Amazon",Y="Apple",ne="ASUS",ue="BlackBerry",fe="Browser",Me="Chrome",ut="Firefox",ot="Google",Ct="Honor",vt="Huawei",Zt="LG",Bn="Microsoft",pe="Motorola",be="Nvidia",Fe="OnePlus",me="Opera",R="OPPO",z="Samsung",Q="Sharp",ye="Sony",mt="Xiaomi",bn="Zebra",Jr="Facebook",Ka="Chromium OS",Qd="Mac OS",Y0=" Browser",af=function(kr){for(var Br={},Dn=0;Dn<kr.length;Dn++)Br[kr[Dn].toUpperCase()]=kr[Dn];return Br},X0=function(kr,Br){return typeof kr===h&&Vh(Br).indexOf(Vh(kr))!==-1},Vh=function(kr){return kr.toLowerCase()},uE=function(kr,Br){if(typeof kr===h)return kr=kr.replace(/^\s\s*/,""),typeof Br===l?kr:kr.substring(0,500)},Fh=function(kr,Br){for(var Dn,Ui,dc,Sr,zl,zt,uc=0;uc<Br.length&&!zl;){var Bh=Br[uc],al=Br[uc+1];for(Dn=Ui=0;Dn<Bh.length&&!zl&&Bh[Dn];)if(zl=Bh[Dn++].exec(kr))for(dc=0;dc<al.length;dc++)zt=zl[++Ui],typeof(Sr=al[dc])===u&&Sr.length>0?Sr.length===2?typeof Sr[1]==a?this[Sr[0]]=Sr[1].call(this,zt):this[Sr[0]]=Sr[1]:Sr.length===3?typeof Sr[1]!==a||Sr[1].exec&&Sr[1].test?this[Sr[0]]=zt?zt.replace(Sr[1],Sr[2]):i:this[Sr[0]]=zt?Sr[1].call(this,zt,Sr[2]):i:Sr.length===4&&(this[Sr[0]]=zt?Sr[3].call(this,zt.replace(Sr[1],Sr[2])):i):this[Sr]=zt||i;uc+=2}},Jd=function(kr,Br){for(var Dn in Br)if(typeof Br[Dn]===u&&Br[Dn].length>0){for(var Ui=0;Ui<Br[Dn].length;Ui++)if(X0(Br[Dn][Ui],kr))return Dn==="?"?i:Dn}else if(X0(Br[Dn],kr))return Dn==="?"?i:Dn;return Br.hasOwnProperty("*")?Br["*"]:kr},cW={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},lW={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,T],[/opios[\/ ]+([\w\.]+)/i],[T,[_,me+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[T,[_,me+" GX"]],[/\bopr\/([\w\.]+)/i],[T,[_,me]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[T,[_,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[T,[_,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[_,T],[/quark(?:pc)?\/([-\w\.]+)/i],[T,[_,"Quark"]],[/\bddg\/([\w\.]+)/i],[T,[_,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[_,"UC"+fe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[T,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[_,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[T,[_,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[T,[_,"Smart Lenovo "+fe]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+fe],T],[/\bfocus\/([\w\.]+)/i],[T,[_,ut+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[_,me+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[_,me+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[_,"MIUI"+Y0]],[/fxios\/([\w\.-]+)/i],[T,[_,ut]],[/\bqihoobrowser\/?([\w\.]*)/i],[T,[_,"360"]],[/\b(qq)\/([\w\.]+)/i],[[_,/(.+)/,"$1Browser"],T],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1"+Y0],T],[/samsungbrowser\/([\w\.]+)/i],[T,[_,z+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[T,[_,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[_,"Sogou Mobile"],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[_,T],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[_],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[T,_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,Jr],T],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[_,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[_,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[T,[_,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[_,Me+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,Me+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[_,"Android "+fe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[T,Jd,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],T],[/(wolvic|librewolf)\/([\w\.]+)/i],[_,T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[_,ut+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[_,[T,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[_,[T,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[P,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[P,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[P,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[P,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[P,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[P,/ower/,"",Vh]],[/ sun4\w[;\)]/i],[[P,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[P,Vh]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[S,z],[v,M]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[g,[S,z],[v,N]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[g,[S,Y],[v,N]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[S,Y],[v,M]],[/(macintosh);/i],[g,[S,Y]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[S,Q],[v,N]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[g,[S,Ct],[v,M]],[/honor([-\w ]+)[;\)]/i],[g,[S,Ct],[v,N]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[g,[S,vt],[v,M]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[S,vt],[v,N]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[g,/_/g," "],[S,mt],[v,M]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[g,/_/g," "],[S,mt],[v,N]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[S,R],[v,N]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[g,[S,Jd,{OnePlus:["304","403","203"],"*":R}],[v,M]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[S,"Vivo"],[v,N]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[g,[S,"Realme"],[v,N]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[S,pe],[v,N]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[S,pe],[v,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[S,Zt],[v,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[S,Zt],[v,N]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[g,[S,"Lenovo"],[v,M]],[/(nokia) (t[12][01])/i],[S,g,[v,M]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[g,/_/g," "],[v,N],[S,"Nokia"]],[/(pixel (c|tablet))\b/i],[g,[S,ot],[v,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[S,ot],[v,N]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[S,ye],[v,N]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[S,ye],[v,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[S,Fe],[v,N]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[S,te],[v,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[S,te],[v,N]],[/(playbook);[-\w\),; ]+(rim)/i],[g,S,[v,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[S,ue],[v,N]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[S,ne],[v,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[S,ne],[v,N]],[/(nexus 9)/i],[g,[S,"HTC"],[v,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[g,/_/g," "],[v,N]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[g,[S,"TCL"],[v,M]],[/(itel) ((\w+))/i],[[S,Vh],g,[v,Jd,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[S,"Acer"],[v,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[S,"Meizu"],[v,N]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[g,[S,"Ulefone"],[v,N]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[g,[S,"Energizer"],[v,N]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[g,[S,"Cat"],[v,N]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[g,[S,"Smartfren"],[v,N]],[/droid.+; (a(?:015|06[35]|142p?))/i],[g,[S,"Nothing"],[v,N]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[g,[S,"Archos"],[v,M]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[g,[S,"Archos"],[v,N]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[S,g,[v,M]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[S,g,[v,N]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,g,[v,M]],[/(surface duo)/i],[g,[S,Bn],[v,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[S,"Fairphone"],[v,N]],[/(u304aa)/i],[g,[S,"AT&T"],[v,N]],[/\bsie-(\w*)/i],[g,[S,"Siemens"],[v,N]],[/\b(rct\w+) b/i],[g,[S,"RCA"],[v,M]],[/\b(venue[\d ]{2,7}) b/i],[g,[S,"Dell"],[v,M]],[/\b(q(?:mv|ta)\w+) b/i],[g,[S,"Verizon"],[v,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[S,"Barnes & Noble"],[v,M]],[/\b(tm\d{3}\w+) b/i],[g,[S,"NuVision"],[v,M]],[/\b(k88) b/i],[g,[S,"ZTE"],[v,M]],[/\b(nx\d{3}j) b/i],[g,[S,"ZTE"],[v,N]],[/\b(gen\d{3}) b.+49h/i],[g,[S,"Swiss"],[v,N]],[/\b(zur\d{3}) b/i],[g,[S,"Swiss"],[v,M]],[/\b((zeki)?tb.*\b) b/i],[g,[S,"Zeki"],[v,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],g,[v,M]],[/\b(ns-?\w{0,9}) b/i],[g,[S,"Insignia"],[v,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[S,"NextBook"],[v,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],g,[v,N]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],g,[v,N]],[/\b(ph-1) /i],[g,[S,"Essential"],[v,N]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[S,"Envizen"],[v,M]],[/\b(trio[-\w\. ]+) b/i],[g,[S,"MachSpeed"],[v,M]],[/\btu_(1491) b/i],[g,[S,"Rotor"],[v,M]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[g,[S,be],[v,M]],[/(sprint) (\w+)/i],[S,g,[v,N]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[S,Bn],[v,N]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[S,bn],[v,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[S,bn],[v,N]],[/smart-tv.+(samsung)/i],[S,[v,F]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[S,z],[v,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Zt],[v,F]],[/(apple) ?tv/i],[S,[g,Y+" TV"],[v,F]],[/crkey/i],[[g,Me+"cast"],[S,ot],[v,F]],[/droid.+aft(\w+)( bui|\))/i],[g,[S,te],[v,F]],[/(shield \w+ tv)/i],[g,[S,be],[v,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[S,Q],[v,F]],[/(bravia[\w ]+)( bui|\))/i],[g,[S,ye],[v,F]],[/(mi(tv|box)-?\w+) bui/i],[g,[S,mt],[v,F]],[/Hbbtv.*(technisat) (.*);/i],[S,g,[v,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,uE],[g,uE],[v,F]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[g,[v,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,F]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,g,[v,x]],[/droid.+; (shield)( bui|\))/i],[g,[S,be],[v,x]],[/(playstation \w+)/i],[g,[S,ye],[v,x]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[S,Bn],[v,x]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[g,[S,z],[v,q]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[S,g,[v,q]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[g,[S,R],[v,q]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[S,Y],[v,q]],[/(opwwe\d{3})/i],[g,[S,Fe],[v,q]],[/(moto 360)/i],[g,[S,pe],[v,q]],[/(smartwatch 3)/i],[g,[S,ye],[v,q]],[/(g watch r)/i],[g,[S,Zt],[v,q]],[/droid.+; (wt63?0{2,3})\)/i],[g,[S,bn],[v,q]],[/droid.+; (glass) \d/i],[g,[S,ot],[v,q]],[/(pico) (4|neo3(?: link|pro)?)/i],[S,g,[v,q]],[/; (quest( \d| pro)?)/i],[g,[S,Jr],[v,q]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[v,J]],[/(aeobc)\b/i],[g,[S,te],[v,J]],[/(homepod).+mac os/i],[g,[S,Y],[v,J]],[/windows iot/i],[[v,J]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[g,[v,N]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[v,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,N]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[g,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[_,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[_,T],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[_,T],[/ladybird\//i],[[_,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,T],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[_,[T,Jd,cW]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,Jd,cW],[_,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,Qd],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,_],[/(ubuntu) ([\w\.]+) like android/i],[[_,/(.+)/,"$1 Touch"],T],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[_,T],[/\(bb(10);/i],[T,[_,ue]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[T,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[_,ut+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[_,Me+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,Ka],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,T],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[_,T]]},lc=function(kr,Br){if(typeof kr===u&&(Br=kr,kr=i),!(this instanceof lc))return new lc(kr,Br).getResult();var Dn=typeof n!==l&&n.navigator?n.navigator:i,Ui=kr||(Dn&&Dn.userAgent?Dn.userAgent:""),dc=Dn&&Dn.userAgentData?Dn.userAgentData:i,Sr=Br?function(zt,uc){var Bh={};for(var al in zt)uc[al]&&uc[al].length%2==0?Bh[al]=uc[al].concat(zt[al]):Bh[al]=zt[al];return Bh}(lW,Br):lW,zl=Dn&&Dn.userAgent==Ui;return this.getBrowser=function(){var zt={};return zt[_]=i,zt[T]=i,Fh.call(zt,Ui,Sr.browser),zt[m]=function(uc){return typeof uc===h?uc.replace(/[^\d\.]/g,"").split(".")[0]:i}(zt[T]),zl&&Dn&&Dn.brave&&typeof Dn.brave.isBrave==a&&(zt[_]="Brave"),zt},this.getCPU=function(){var zt={};return zt[P]=i,Fh.call(zt,Ui,Sr.cpu),zt},this.getDevice=function(){var zt={};return zt[S]=i,zt[g]=i,zt[v]=i,Fh.call(zt,Ui,Sr.device),zl&&!zt[v]&&dc&&dc.mobile&&(zt[v]=N),zl&&zt[g]=="Macintosh"&&Dn&&typeof Dn.standalone!==l&&Dn.maxTouchPoints&&Dn.maxTouchPoints>2&&(zt[g]="iPad",zt[v]=M),zt},this.getEngine=function(){var zt={};return zt[_]=i,zt[T]=i,Fh.call(zt,Ui,Sr.engine),zt},this.getOS=function(){var zt={};return zt[_]=i,zt[T]=i,Fh.call(zt,Ui,Sr.os),zl&&!zt[_]&&dc&&dc.platform&&dc.platform!="Unknown"&&(zt[_]=dc.platform.replace(/chrome os/i,Ka).replace(/macos/i,Qd)),zt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ui},this.setUA=function(zt){return Ui=typeof zt===h&&zt.length>500?uE(zt,500):zt,this},this.setUA(Ui),this};lc.VERSION="0.7.41",lc.BROWSER=af([_,T,m]),lc.CPU=af([P]),lc.DEVICE=af([g,S,v,x,N,F,M,q,J]),lc.ENGINE=lc.OS=af([_,T]),e.exports&&(t=e.exports=lc),t.UAParser=lc;var of=typeof n!==l&&(n.jQuery||n.Zepto);if(of&&!of.ua){var Q0=new lc;of.ua=Q0.getResult(),of.ua.get=function(){return Q0.getUA()},of.ua.set=function(kr){Q0.setUA(kr);var Br=Q0.getResult();for(var Dn in Br)of.ua[Dn]=Br[Dn]}}})(typeof window=="object"?window:d)})(ox,ox.exports);var jhe=p(ox.exports),TM=wy.clear;an({global:!0,bind:!0,enumerable:!0,forced:G.clearImmediate!==TM},{clearImmediate:TM});var bM=G,Mhe=K,Uhe=Ce,Vhe=oC,Fhe=Je,Bhe=wd,Ghe=Xu,Whe=bM.Function,Hhe=/MSIE .\./.test(Fhe)||Vhe==="BUN"&&function(){var e=bM.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Khe=an,wM=G,CM=wy.set,zhe=function(e,t){var n=1;return Hhe?function(i,a){var l=Ghe(arguments.length,1)>n,u=Uhe(i)?i:Whe(i),h=l?Bhe(arguments,n):[],m=l?function(){Mhe(u,this,h)}:u;return e(m)}:e},RM=wM.setImmediate?zhe(CM):CM;Khe({global:!0,bind:!0,enumerable:!0,forced:wM.setImmediate!==RM},{setImmediate:RM});var xM=p(fs.setImmediate),qhe=G,Yhe=DL,Xhe=ua,Qhe=Xu,Jhe=he;an({global:!0,enumerable:!0,dontCallGetSet:!0,forced:f(function(){return Jhe&&Object.getOwnPropertyDescriptor(qhe,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){Qhe(arguments.length,1),Yhe(Xhe(e))}});var NM=p(fs.queueMicrotask);function IM(e,t){return function(){return e.apply(t,arguments)}}const{toString:$he}=Object.prototype,{getPrototypeOf:cx}=Object,{iterator:$y,toStringTag:AM}=Symbol,Zy=(lx=Object.create(null),e=>{const t=$he.call(e);return lx[t]||(lx[t]=t.slice(8,-1).toLowerCase())});var lx;const zo=e=>(e=e.toLowerCase(),t=>Zy(t)===e),eS=e=>t=>typeof t===e,{isArray:dm}=Array,um=eS("undefined");function o_(e){return e!==null&&!um(e)&&e.constructor!==null&&!um(e.constructor)&&ha(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const OM=zo("ArrayBuffer"),Zhe=eS("string"),ha=eS("function"),PM=eS("number"),c_=e=>e!==null&&typeof e=="object",tS=e=>{if(Zy(e)!=="object")return!1;const t=cx(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||AM in e||$y in e)},epe=zo("Date"),tpe=zo("File"),npe=zo("Blob"),rpe=zo("FileList"),spe=zo("URLSearchParams"),[ipe,ape,ope,cpe]=["ReadableStream","Request","Response","Headers"].map(zo);function l_(e,t){let n,i,{allOwnKeys:a=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),dm(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{if(o_(e))return;const l=a?Object.getOwnPropertyNames(e):Object.keys(e),u=l.length;let h;for(n=0;n<u;n++)h=l[n],t.call(null,e[h],h,e)}}function DM(e,t){if(o_(e))return null;t=t.toLowerCase();const n=Object.keys(e);let i,a=n.length;for(;a-- >0;)if(i=n[a],t===i.toLowerCase())return i;return null}const nh=SM!==void 0?SM:typeof self<"u"?self:typeof window<"u"?window:$0,kM=e=>!um(e)&&e!==nh,lpe=(dx=typeof Uint8Array<"u"&&cx(Uint8Array),e=>dx&&e instanceof dx);var dx;const dpe=zo("HTMLFormElement"),LM=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),upe=zo("RegExp"),jM=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};l_(n,(a,l)=>{let u;(u=t(a,l,e))!==!1&&(i[l]=u||a)}),Object.defineProperties(e,i)},hpe=zo("AsyncFunction"),MM=(UM=typeof xM=="function",VM=ha(nh.postMessage),UM?xM:VM?(ux="axios@".concat(Math.random()),nS=[],nh.addEventListener("message",e=>{let{source:t,data:n}=e;t===nh&&n===ux&&nS.length&&nS.shift()()},!1),e=>{nS.push(e),nh.postMessage(ux,"*")}):e=>setTimeout(e));var UM,VM,ux,nS;const ppe=NM!==void 0?NM.bind(nh):typeof process<"u"&&process.nextTick||MM;var Pe={isArray:dm,isArrayBuffer:OM,isBuffer:o_,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ha(e.append)&&((t=Zy(e))==="formdata"||t==="object"&&ha(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&OM(e.buffer),t},isString:Zhe,isNumber:PM,isBoolean:e=>e===!0||e===!1,isObject:c_,isPlainObject:tS,isEmptyObject:e=>{if(!c_(e)||o_(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:ipe,isRequest:ape,isResponse:ope,isHeaders:cpe,isUndefined:um,isDate:epe,isFile:tpe,isBlob:npe,isRegExp:upe,isFunction:ha,isStream:e=>c_(e)&&ha(e.pipe),isURLSearchParams:spe,isTypedArray:lpe,isFileList:rpe,forEach:l_,merge:function e(){const{caseless:t,skipUndefined:n}=kM(this)&&this||{},i={},a=(l,u)=>{const h=t&&DM(i,u)||u;tS(i[h])&&tS(l)?i[h]=e(i[h],l):tS(l)?i[h]=e({},l):dm(l)?i[h]=l.slice():n&&um(l)||(i[h]=l)};for(let l=0,u=arguments.length;l<u;l++)arguments[l]&&l_(arguments[l],a);return i},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return l_(t,(a,l)=>{n&&ha(a)?e[l]=IM(a,n):e[l]=a},{allOwnKeys:i}),e},trim:e=>ai(e)?ai(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let a,l,u;const h={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),l=a.length;l-- >0;)u=a[l],i&&!i(u,e,t)||h[u]||(t[u]=e[u],h[u]=!0);e=n!==!1&&cx(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Zy,kindOfTest:zo,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(dm(e))return e;let t=e.length;if(!PM(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[$y]).call(e);let i;for(;(i=n.next())&&!i.done;){const a=i.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:dpe,hasOwnProperty:LM,hasOwnProp:LM,reduceDescriptors:jM,freezeMethods:e=>{jM(e,(t,n)=>{if(ha(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];ha(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=a=>{a.forEach(l=>{n[l]=!0})};return dm(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:DM,global:nh,isContextDefined:kM,isSpecCompliantForm:function(e){return!!(e&&ha(e.append)&&e[AM]==="FormData"&&e[$y])},toJSONObject:e=>{const t=new Array(10),n=(i,a)=>{if(c_(i)){if(t.indexOf(i)>=0)return;if(o_(i))return i;if(!("toJSON"in i)){t[a]=i;const l=dm(i)?[]:{};return l_(i,(u,h)=>{const m=n(u,a+1);!um(m)&&(l[h]=m)}),t[a]=void 0,l}}return i};return n(e,0)},isAsyncFn:hpe,isThenable:e=>e&&(c_(e)||ha(e))&&ha(e.then)&&ha(e.catch),setImmediate:MM,asap:ppe,isIterable:e=>e!=null&&ha(e[$y])};function mn(e,t,n,i,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),a&&(this.response=a,this.status=a.status?a.status:null)}Pe.inherits(mn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Pe.toJSONObject(this.config),code:this.code,status:this.status}}});const FM=mn.prototype,BM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{BM[e]={value:e}}),Object.defineProperties(mn,BM),Object.defineProperty(FM,"isAxiosError",{value:!0}),mn.from=(e,t,n,i,a,l)=>{const u=Object.create(FM);Pe.toFlatObject(e,u,function(g){return g!==Error.prototype},g=>g!=="isAxiosError");const h=e&&e.message?e.message:"Error",m=t==null&&e?e.code:t;return mn.call(u,h,m,n,i,a),e&&u.cause==null&&Object.defineProperty(u,"cause",{value:e,configurable:!0}),u.name=e&&e.name||"Error",l&&Object.assign(u,l),u};function hx(e){return Pe.isPlainObject(e)||Pe.isArray(e)}function GM(e){return Pe.endsWith(e,"[]")?e.slice(0,-2):e}function WM(e,t,n){return e?e.concat(t).map(function(i,a){return i=GM(i),!n&&a?"["+i+"]":i}).join(n?".":""):t}const mpe=Pe.toFlatObject(Pe,{},null,function(e){return/^is[A-Z]/.test(e)});function rS(e,t,n){if(!Pe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=Pe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,T){return!Pe.isUndefined(T[S])})).metaTokens,a=n.visitor||g,l=n.dots,u=n.indexes,h=(n.Blob||typeof Blob<"u"&&Blob)&&Pe.isSpecCompliantForm(t);if(!Pe.isFunction(a))throw new TypeError("visitor must be a function");function m(S){if(S===null)return"";if(Pe.isDate(S))return S.toISOString();if(Pe.isBoolean(S))return S.toString();if(!h&&Pe.isBlob(S))throw new mn("Blob is not supported. Use a Buffer instead.");return Pe.isArrayBuffer(S)||Pe.isTypedArray(S)?h&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function g(S,T,P){let x=S;if(S&&!P&&typeof S=="object"){if(Pe.endsWith(T,"{}"))T=i?T:T.slice(0,-2),S=JSON.stringify(S);else if(Pe.isArray(S)&&function(N){return Pe.isArray(N)&&!N.some(hx)}(S)||(Pe.isFileList(S)||Pe.endsWith(T,"[]"))&&(x=Pe.toArray(S)))return T=GM(T),x.forEach(function(N,M){!Pe.isUndefined(N)&&N!==null&&t.append(u===!0?WM([T],M,l):u===null?T:T+"[]",m(N))}),!1}return!!hx(S)||(t.append(WM(P,T,l),m(S)),!1)}const _=[],v=Object.assign(mpe,{defaultVisitor:g,convertValue:m,isVisitable:hx});if(!Pe.isObject(e))throw new TypeError("data must be an object");return function S(T,P){if(!Pe.isUndefined(T)){if(_.indexOf(T)!==-1)throw Error("Circular reference detected in "+P.join("."));_.push(T),Pe.forEach(T,function(x,N){(!(Pe.isUndefined(x)||x===null)&&a.call(t,x,Pe.isString(N)?ai(N).call(N):N,P,v))===!0&&S(x,P?P.concat(N):[N])}),_.pop()}}(e),t}function HM(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function px(e,t){this._pairs=[],e&&rS(e,this,t)}const KM=px.prototype;function fpe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function zM(e,t,n){if(!t)return e;const i=n&&n.encode||fpe;Pe.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let l;if(l=a?a(t,n):Pe.isURLSearchParams(t)?t.toString():new px(t,n).toString(i),l){const u=e.indexOf("#");u!==-1&&(e=e.slice(0,u)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}KM.append=function(e,t){this._pairs.push([e,t])},KM.toString=function(e){const t=e?function(n){return e.call(this,n,HM)}:HM;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var qM=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Pe.forEach(this.handlers,function(t){t!==null&&e(t)})}},YM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},XM={exports:{}},gpe=an,_pe=he,QM=ao.f;gpe({target:"Object",stat:!0,forced:Object.defineProperty!==QM,sham:!_pe},{defineProperty:QM});var JM=fs.Object,Epe=XM.exports=function(e,t,n){return JM.defineProperty(e,t,n)};JM.defineProperty.sham&&(Epe.sham=!0);var $M=p(XM.exports),vpe=TypeError,ZM=Gg,ype=by,Spe=rs,Tpe=Or("species"),eU=Array,bpe=function(e){var t;return ZM(e)&&(t=e.constructor,(ype(t)&&(t===eU||ZM(t.prototype))||Spe(t)&&(t=t[Tpe])===null)&&(t=void 0)),t===void 0?eU:t},tU=function(e,t){return new(bpe(e))(t===0?0:t)},wpe=f,Cpe=Go,Rpe=Or("species"),nU=function(e){return Cpe>=51||!wpe(function(){var t=[];return(t.constructor={})[Rpe]=function(){return{foo:1}},t[e](Boolean).foo!==1})},xpe=an,Npe=f,Ipe=Gg,Ape=rs,Ope=Mc,Ppe=Sd,rU=function(e){if(e>9007199254740991)throw vpe("Maximum allowed index exceeded");return e},sU=SR,Dpe=tU,kpe=nU,Lpe=Go,iU=Or("isConcatSpreadable"),jpe=Lpe>=51||!Npe(function(){var e=[];return e[iU]=!1,e.concat()[0]!==e}),Mpe=function(e){if(!Ape(e))return!1;var t=e[iU];return t!==void 0?!!t:Ipe(e)};xpe({target:"Array",proto:!0,arity:1,forced:!jpe||!kpe("concat")},{concat:function(e){var t,n,i,a,l,u=Ope(this),h=Dpe(u,0),m=0;for(t=-1,i=arguments.length;t<i;t++)if(Mpe(l=t===-1?u:arguments[t]))for(a=Ppe(l),rU(m+a),n=0;n<a;n++,m++)n in l&&sU(h,m,l[n]);else rU(m+1),sU(h,m++,l);return h.length=m,h}});var aU={},Upe=se,Vpe=Ys,oU=oy.f,Fpe=wd,cU=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];aU.f=function(e){return cU&&Upe(e)==="Window"?function(t){try{return oU(t)}catch{return Fpe(cU)}}(e):oU(Vpe(e))};var hm={},Bpe=Or;hm.f=Bpe;var lU=fs,Gpe=Bs,Wpe=hm,Hpe=ao.f,_s=function(e){var t=lU.Symbol||(lU.Symbol={});Gpe(t,e)||Hpe(t,e,{value:Wpe.f(e)})},Kpe=Oe,zpe=Le,qpe=Or,Ype=bd,dU=function(){var e=zpe("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=qpe("toPrimitive");t&&!t[i]&&Ype(t,i,function(a){return Kpe(n,this)},{arity:1})},Xpe=yd,Qpe=Ar,Jpe=Mc,$pe=Sd,Zpe=tU,uU=D([].push),Ad=function(e){var t=e===1,n=e===2,i=e===3,a=e===4,l=e===6,u=e===7,h=e===5||l;return function(m,g,_,v){for(var S,T,P=Jpe(m),x=Qpe(P),N=$pe(x),M=Xpe(g,_),F=0,q=v||Zpe,J=t?q(m,N):n||u?q(m,0):void 0;N>F;F++)if((h||F in x)&&(T=M(S=x[F],F,P),e))if(t)J[F]=T;else if(T)switch(e){case 3:return!0;case 5:return S;case 6:return F;case 2:uU(J,S)}else switch(e){case 4:return!1;case 7:uU(J,S)}return l?-1:i||a?a:J}},hU={forEach:Ad(0),map:Ad(1),filter:Ad(2),some:Ad(3),every:Ad(4),find:Ad(5),findIndex:Ad(6),filterReject:Ad(7)},sS=an,d_=G,mx=Oe,eme=D,pm=he,mm=Ol,tme=f,oi=Bs,nme=k,fx=zi,iS=Ys,gx=qw,rme=qi,_x=er,fm=Hg,pU=ly,sme=oy,mU=aU,ime=Wg,fU=We,gU=ao,ame=mC,_U=Re,EU=bd,ome=Ty,Ex=Fp,vU=cy,yU=Kw,cme=Or,lme=hm,dme=_s,ume=dU,hme=Pl,SU=Yu,aS=hU.forEach,pa=ay("hidden"),oS="Symbol",u_="prototype",pme=SU.set,TU=SU.getterFor(oS),qo=Object[u_],rh=d_.Symbol,cS=rh&&rh[u_],mme=d_.RangeError,fme=d_.TypeError,vx=d_.QObject,bU=fU.f,sh=gU.f,wU=mU.f,gme=_U.f,CU=eme([].push),Ll=Ex("symbols"),h_=Ex("op-symbols"),_me=Ex("wks"),yx=!vx||!vx[u_]||!vx[u_].findChild,RU=function(e,t,n){var i=bU(qo,t);i&&delete qo[t],sh(e,t,n),i&&e!==qo&&sh(qo,t,i)},Sx=pm&&tme(function(){return fm(sh({},"a",{get:function(){return sh(this,"a",{value:7}).a}})).a!==7})?RU:sh,Tx=function(e,t){var n=Ll[e]=fm(cS);return pme(n,{type:oS,tag:e,description:t}),pm||(n.description=t),n},lS=function(e,t,n){e===qo&&lS(h_,t,n),fx(e);var i=gx(t);return fx(n),oi(Ll,i)?(n.enumerable?(oi(e,pa)&&e[pa][i]&&(e[pa][i]=!1),n=fm(n,{enumerable:_x(0,!1)})):(oi(e,pa)||sh(e,pa,_x(1,fm(null))),e[pa][i]=!0),Sx(e,i,n)):sh(e,i,n)},bx=function(e,t){fx(e);var n=iS(t),i=pU(n).concat(AU(n));return aS(i,function(a){pm&&!mx(xU,n,a)||lS(e,a,n[a])}),e},xU=function(e){var t=gx(e),n=mx(gme,this,t);return!(this===qo&&oi(Ll,t)&&!oi(h_,t))&&(!(n||!oi(this,t)||!oi(Ll,t)||oi(this,pa)&&this[pa][t])||n)},NU=function(e,t){var n=iS(e),i=gx(t);if(n!==qo||!oi(Ll,i)||oi(h_,i)){var a=bU(n,i);return!a||!oi(Ll,i)||oi(n,pa)&&n[pa][i]||(a.enumerable=!0),a}},IU=function(e){var t=wU(iS(e)),n=[];return aS(t,function(i){oi(Ll,i)||oi(vU,i)||CU(n,i)}),n},AU=function(e){var t=e===qo,n=wU(t?h_:iS(e)),i=[];return aS(n,function(a){!oi(Ll,a)||t&&!oi(qo,a)||CU(i,Ll[a])}),i};mm||(rh=function(){if(nme(cS,this))throw new fme("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?rme(arguments[0]):void 0,t=yU(e),n=function(i){var a=this===void 0?d_:this;a===qo&&mx(n,h_,i),oi(a,pa)&&oi(a[pa],t)&&(a[pa][t]=!1);var l=_x(1,i);try{Sx(a,t,l)}catch(u){if(!(u instanceof mme))throw u;RU(a,t,l)}};return pm&&yx&&Sx(qo,t,{configurable:!0,set:n}),Tx(t,e)},EU(cS=rh[u_],"toString",function(){return TU(this).tag}),EU(rh,"withoutSetter",function(e){return Tx(yU(e),e)}),_U.f=xU,gU.f=lS,ame.f=bx,fU.f=NU,sme.f=mU.f=IU,ime.f=AU,lme.f=function(e){return Tx(cme(e),e)},pm&&ome(cS,"description",{configurable:!0,get:function(){return TU(this).description}})),sS({global:!0,constructor:!0,wrap:!0,forced:!mm,sham:!mm},{Symbol:rh}),aS(pU(_me),function(e){dme(e)}),sS({target:oS,stat:!0,forced:!mm},{useSetter:function(){yx=!0},useSimple:function(){yx=!1}}),sS({target:"Object",stat:!0,forced:!mm,sham:!pm},{create:function(e,t){return t===void 0?fm(e):bx(fm(e),t)},defineProperty:lS,defineProperties:bx,getOwnPropertyDescriptor:NU}),sS({target:"Object",stat:!0,forced:!mm},{getOwnPropertyNames:IU}),ume(),hme(rh,oS),vU[pa]=!0;var OU=Ol&&!!Symbol.for&&!!Symbol.keyFor,Eme=an,vme=Le,yme=Bs,Sme=qi,PU=Fp,Tme=OU,wx=PU("string-to-symbol-registry"),bme=PU("symbol-to-string-registry");Eme({target:"Symbol",stat:!0,forced:!Tme},{for:function(e){var t=Sme(e);if(yme(wx,t))return wx[t];var n=vme("Symbol")(t);return wx[t]=n,bme[n]=t,n}});var wme=an,Cme=Bs,Rme=Mg,xme=Vp,Nme=OU,DU=Fp("symbol-to-string-registry");wme({target:"Symbol",stat:!0,forced:!Nme},{keyFor:function(e){if(!Rme(e))throw new TypeError(xme(e)+" is not a symbol");if(Cme(DU,e))return DU[e]}});var kU=Gg,Ime=Ce,LU=se,Ame=qi,jU=D([].push),Ome=an,MU=Le,UU=K,Pme=Oe,p_=D,VU=f,FU=Ce,BU=Mg,GU=wd,Dme=function(e){if(Ime(e))return e;if(kU(e)){for(var t=e.length,n=[],i=0;i<t;i++){var a=e[i];typeof a=="string"?jU(n,a):typeof a!="number"&&LU(a)!=="Number"&&LU(a)!=="String"||jU(n,Ame(a))}var l=n.length,u=!0;return function(h,m){if(u)return u=!1,m;if(kU(this))return m;for(var g=0;g<l;g++)if(n[g]===h)return m}}},kme=Ol,Lme=String,Od=MU("JSON","stringify"),dS=p_(/./.exec),WU=p_("".charAt),jme=p_("".charCodeAt),Mme=p_("".replace),Ume=p_(1.1.toString),Vme=/[\uD800-\uDFFF]/g,HU=/^[\uD800-\uDBFF]$/,KU=/^[\uDC00-\uDFFF]$/,zU=!kme||VU(function(){var e=MU("Symbol")("stringify detection");return Od([e])!=="[null]"||Od({a:e})!=="{}"||Od(Object(e))!=="{}"}),qU=VU(function(){return Od("\uDF06\uD834")!=='"\\udf06\\ud834"'||Od("\uDEAD")!=='"\\udead"'}),Fme=function(e,t){var n=GU(arguments),i=Dme(t);if(FU(i)||e!==void 0&&!BU(e))return n[1]=function(a,l){if(FU(i)&&(l=Pme(i,this,Lme(a),l)),!BU(l))return l},UU(Od,null,n)},Bme=function(e,t,n){var i=WU(n,t-1),a=WU(n,t+1);return dS(HU,e)&&!dS(KU,a)||dS(KU,e)&&!dS(HU,i)?"\\u"+Ume(jme(e,0),16):e};Od&&Ome({target:"JSON",stat:!0,arity:3,forced:zU||qU},{stringify:function(e,t,n){var i=GU(arguments),a=UU(zU?Fme:Od,null,i);return qU&&typeof a=="string"?Mme(a,Vme,Bme):a}});var YU=Wg,Gme=Mc;an({target:"Object",stat:!0,forced:!Ol||f(function(){YU.f(1)})},{getOwnPropertySymbols:function(e){var t=YU.f;return t?t(Gme(e)):[]}}),_s("asyncDispose"),_s("asyncIterator"),_s("dispose"),_s("hasInstance"),_s("isConcatSpreadable"),_s("iterator"),_s("match"),_s("matchAll"),_s("replace"),_s("search"),_s("species"),_s("split");var Wme=dU;_s("toPrimitive"),Wme();var Hme=Le,Kme=Pl;_s("toStringTag"),Kme(Hme("Symbol"),"Symbol"),_s("unscopables"),Pl(G.JSON,"JSON",!0);var zme=fs.Symbol,qme=Or,Yme=ao.f,XU=qme("metadata"),QU=Function.prototype;QU[XU]===void 0&&Yme(QU,XU,{value:null}),_s("metadata");var Xme=zme,Qme=D,Cx=Le("Symbol"),Jme=Cx.keyFor,$me=Qme(Cx.prototype.valueOf),JU=Cx.isRegisteredSymbol||function(e){try{return Jme($me(e))!==void 0}catch{return!1}};an({target:"Symbol",stat:!0},{isRegisteredSymbol:JU});for(var Zme=Fp,$U=Le,efe=D,tfe=Mg,nfe=Or,uS=$U("Symbol"),ZU=uS.isWellKnownSymbol,eV=$U("Object","getOwnPropertyNames"),rfe=efe(uS.prototype.valueOf),tV=Zme("wks"),Rx=0,nV=eV(uS),sfe=nV.length;Rx<sfe;Rx++)try{var rV=nV[Rx];tfe(uS[rV])&&nfe(rV)}catch{}var sV=function(e){if(ZU&&ZU(e))return!0;try{for(var t=rfe(e),n=0,i=eV(tV),a=i.length;n<a;n++)if(tV[i[n]]==t)return!0}catch{}return!1};an({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:sV}),_s("customMatcher"),_s("observable"),an({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:JU}),an({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:sV}),_s("matcher"),_s("metadataKey"),_s("patternMatch"),_s("replaceAll");var gm=p(Xme),iV=p(hm.f("iterator"));function m_(e){return m_=typeof gm=="function"&&typeof iV=="symbol"?function(t){return typeof t}:function(t){return t&&typeof gm=="function"&&t.constructor===gm&&t!==gm.prototype?"symbol":typeof t},m_(e)}var ife=p(hm.f("toPrimitive"));function afe(e){var t=function(n,i){if(m_(n)!="object"||!n)return n;var a=n[ife];if(a!==void 0){var l=a.call(n,i||"default");if(m_(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(e,"string");return m_(t)=="symbol"?t:t+""}function O(e,t,n){return(t=afe(t))in e?$M(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var aV=p(kde),ofe={isBrowser:!0,classes:{URLSearchParams:aV!==void 0?aV:px,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const xx=typeof window<"u"&&typeof document<"u",Nx=typeof navigator=="object"&&navigator||void 0,cfe=xx&&(!Nx||["ReactNative","NativeScript","NS"].indexOf(Nx.product)<0),lfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",dfe=xx&&window.location.href||"http://localhost";function oV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function cV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oV(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Di=cV(cV({},Object.freeze({__proto__:null,hasBrowserEnv:xx,hasStandardBrowserEnv:cfe,hasStandardBrowserWebWorkerEnv:lfe,navigator:Nx,origin:dfe})),ofe);function lV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function ufe(e,t){return rS(e,new Di.classes.URLSearchParams,function(n){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?lV(Object(a),!0).forEach(function(l){O(n,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):lV(Object(a)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(a,l))})}return n}({visitor:function(n,i,a,l){return Di.isNode&&Pe.isBuffer(n)?(this.append(i,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},t))}var hfe=oR.charAt,dV=Oe,pfe=zi,mfe=Ce,ffe=se,gfe=/./.exec,_fe=TypeError,Efe=an,uV=Oe,hV=oe,vfe=NC,hS=yy,pV=Wr,mV=lk,f_=qi,yfe=zi,Sfe=rs,Tfe=se,bfe=rC,fV=ZR,wfe=Ug,Cfe=f,Rfe=kC,xfe=function(e,t,n){return t+(n?hfe(e,t).length:1)},Nfe=function(e,t){var n=e.exec;if(mfe(n)){var i=dV(n,e,t);return i!==null&&pfe(i),i}if(ffe(e)==="RegExp")return dV(gfe,e,t);throw new _fe("RegExp#exec called on incompatible receiver")},gV=Yu,Ife=Or("matchAll"),_V="RegExp String",EV=_V+" Iterator",Afe=gV.set,Ofe=gV.getterFor(EV),Pfe=TypeError,Ix=hV("".indexOf),pS=hV("".matchAll),Ax=!!pS&&!Cfe(function(){pS("a",/./)}),Dfe=vfe(function(e,t,n,i){Afe(this,{type:EV,regexp:e,string:t,global:n,unicode:i,done:!1})},_V,function(){var e=Ofe(this);if(e.done)return hS(void 0,!0);var t=e.regexp,n=e.string,i=Nfe(t,n);return i===null?(e.done=!0,hS(void 0,!0)):e.global?(f_(i[0])===""&&(t.lastIndex=xfe(n,mV(t.lastIndex),e.unicode)),hS(i,!1)):(e.done=!0,hS(i,!1))}),vV=function(e){var t,n,i,a=yfe(this),l=f_(e),u=Rfe(a,RegExp),h=f_(fV(a));return t=new u(u===RegExp?a.source:a,h),n=!!~Ix(h,"g"),i=!!~Ix(h,"u"),t.lastIndex=mV(a.lastIndex),new Dfe(t,l,n,i)};Efe({target:"String",proto:!0,forced:Ax},{matchAll:function(e){var t,n,i,a,l=pV(this);if(Sfe(e)){if(bfe(e)&&(t=f_(pV(fV(e))),!~Ix(t,"g")))throw new Pfe("`.matchAll` does not allow non-global regexes");if(Ax)return pS(l,e);if((i=wfe(e,Ife))===void 0&&Tfe(e)==="RegExp"&&(i=vV),i)return uV(i,e,l)}else if(Ax)return pS(l,e);return n=f_(l),a=new RegExp(e,"g"),uV(vV,a,n)}});var kfe=Da("String","matchAll"),Lfe=k,jfe=kfe,Ox=String.prototype,Mfe=function(e){var t=e.matchAll;return typeof e=="string"||e===Ox||Lfe(Ox,e)&&t===Ox.matchAll?jfe:t},Ufe=p(Mfe);function yV(e){function t(n,i,a,l){let u=n[l++];if(u==="__proto__")return!0;const h=Number.isFinite(+u),m=l>=n.length;return u=!u&&Pe.isArray(a)?a.length:u,m?(Pe.hasOwnProp(a,u)?a[u]=[a[u],i]:a[u]=i,!h):(a[u]&&Pe.isObject(a[u])||(a[u]=[]),t(n,i,a[u],l)&&Pe.isArray(a[u])&&(a[u]=function(g){const _={},v=Object.keys(g);let S;const T=v.length;let P;for(S=0;S<T;S++)P=v[S],_[P]=g[P];return _}(a[u])),!h)}if(Pe.isFormData(e)&&Pe.isFunction(e.entries)){const n={};return Pe.forEachEntry(e,(i,a)=>{t(function(l){return Ufe(Pe).call(Pe,/\w+|\[(\w*)]/g,l).map(u=>u[0]==="[]"?"":u[1]||u[0])}(i),a,n,0)}),n}return null}const Px={transitional:YM,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,a=Pe.isObject(e);if(a&&Pe.isHTMLForm(e)&&(e=new FormData(e)),Pe.isFormData(e))return i?JSON.stringify(yV(e)):e;if(Pe.isArrayBuffer(e)||Pe.isBuffer(e)||Pe.isStream(e)||Pe.isFile(e)||Pe.isBlob(e)||Pe.isReadableStream(e))return e;if(Pe.isArrayBufferView(e))return e.buffer;if(Pe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return ufe(e,this.formSerializer).toString();if((l=Pe.isFileList(e))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return rS(l?{"files[]":e}:e,u&&new u,this.formSerializer)}}return a||i?(t.setContentType("application/json",!1),function(u,h,m){if(Pe.isString(u))try{return(h||JSON.parse)(u),ai(Pe).call(Pe,u)}catch(g){if(g.name!=="SyntaxError")throw g}return(0,JSON.stringify)(u)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Px.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Pe.isResponse(e)||Pe.isReadableStream(e))return e;if(e&&Pe.isString(e)&&(n&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(l){if(a)throw l.name==="SyntaxError"?mn.from(l,mn.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Di.classes.FormData,Blob:Di.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Pe.forEach(["delete","get","head","post","put","patch"],e=>{Px.headers[e]={}});var Dx=Px;const Vfe=Pe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),SV=Symbol("internals");function g_(e){var t;return e&&ai(t=String(e)).call(t).toLowerCase()}function mS(e){return e===!1||e==null?e:Pe.isArray(e)?e.map(mS):String(e)}function kx(e,t,n,i,a){return Pe.isFunction(i)?i.call(this,t,n):(a&&(t=n),Pe.isString(t)?Pe.isString(i)?t.indexOf(i)!==-1:Pe.isRegExp(i)?i.test(t):void 0:void 0)}class fS{constructor(t){t&&this.set(t)}set(t,n,i){const a=this;function l(m,g,_){const v=g_(g);if(!v)throw new Error("header name must be a non-empty string");const S=Pe.findKey(a,v);(!S||a[S]===void 0||_===!0||_===void 0&&a[S]!==!1)&&(a[S||g]=mS(m))}const u=(m,g)=>Pe.forEach(m,(_,v)=>l(_,v,g));if(Pe.isPlainObject(t)||t instanceof this.constructor)u(t,n);else if(Pe.isString(t)&&(t=ai(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ai(h=t).call(h)))u((m=>{const g={};let _,v,S;return m&&m.split(`
`).forEach(function(T){var P,x;S=T.indexOf(":"),_=ai(P=T.substring(0,S)).call(P).toLowerCase(),v=ai(x=T.substring(S+1)).call(x),!_||g[_]&&Vfe[_]||(_==="set-cookie"?g[_]?g[_].push(v):g[_]=[v]:g[_]=g[_]?g[_]+", "+v:v)}),g})(t),n);else if(Pe.isObject(t)&&Pe.isIterable(t)){let m,g,_={};for(const v of t){if(!Pe.isArray(v))throw TypeError("Object iterator must return a key-value pair");_[g=v[0]]=(m=_[g])?Pe.isArray(m)?[...m,v[1]]:[m,v[1]]:v[1]}u(_,n)}else t!=null&&l(n,t,i);var h;return this}get(t,n){if(t=g_(t)){const i=Pe.findKey(this,t);if(i){const a=this[i];if(!n)return a;if(n===!0)return function(l){const u=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=h.exec(l);)u[m[1]]=m[2];return u}(a);if(Pe.isFunction(n))return n.call(this,a,i);if(Pe.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=g_(t)){const i=Pe.findKey(this,t);return!(!i||this[i]===void 0||n&&!kx(0,this[i],i,n))}return!1}delete(t,n){const i=this;let a=!1;function l(u){if(u=g_(u)){const h=Pe.findKey(i,u);!h||n&&!kx(0,i[h],h,n)||(delete i[h],a=!0)}}return Pe.isArray(t)?t.forEach(l):l(t),a}clear(t){const n=Object.keys(this);let i=n.length,a=!1;for(;i--;){const l=n[i];t&&!kx(0,this[l],l,t,!0)||(delete this[l],a=!0)}return a}normalize(t){const n=this,i={};return Pe.forEach(this,(a,l)=>{var u;const h=Pe.findKey(i,l);if(h)return n[h]=mS(a),void delete n[l];const m=t?function(g){return ai(g).call(g).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,v,S)=>v.toUpperCase()+S)}(l):ai(u=String(l)).call(u);m!==l&&delete n[l],n[m]=mS(a),i[m]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Pe.forEach(this,(i,a)=>{i!=null&&i!==!1&&(n[a]=t&&Pe.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,a=new Array(i>1?i-1:0),l=1;l<i;l++)a[l-1]=arguments[l];return a.forEach(u=>n.set(u)),n}static accessor(t){const n=(this[SV]=this[SV]={accessors:{}}).accessors,i=this.prototype;function a(l){const u=g_(l);n[u]||(function(h,m){const g=Pe.toCamelCase(" "+m);["get","set","has"].forEach(_=>{Object.defineProperty(h,_+g,{value:function(v,S,T){return this[_].call(this,m,v,S,T)},configurable:!0})})}(i,l),n[u]=!0)}return Pe.isArray(t)?t.forEach(a):a(t),this}}fS.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Pe.reduceDescriptors(fS.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(a){this[i]=a}}}),Pe.freezeMethods(fS);var Yo=fS;function Lx(e,t){const n=this||Dx,i=t||n,a=Yo.from(i.headers);let l=i.data;return Pe.forEach(e,function(u){l=u.call(n,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function TV(e){return!(!e||!e.__CANCEL__)}function _m(e,t,n){mn.call(this,e??"canceled",mn.ERR_CANCELED,t,n),this.name="CanceledError"}function bV(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new mn("Request failed with status code "+n.status,[mn.ERR_BAD_REQUEST,mn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Pe.inherits(_m,mn,{__CANCEL__:!0});const gS=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const a=function(l,u){l=l||10;const h=new Array(l),m=new Array(l);let g,_=0,v=0;return u=u!==void 0?u:1e3,function(S){const T=Date.now(),P=m[v];g||(g=T),h[_]=S,m[_]=T;let x=v,N=0;for(;x!==_;)N+=h[x++],x%=l;if(_=(_+1)%l,_===v&&(v=(v+1)%l),T-g<u)return;const M=P&&T-P;return M?Math.round(1e3*N/M):void 0}}(50,250);return function(l,u){let h,m,g=0,_=1e3/u;const v=function(S){g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),h=null,m&&(clearTimeout(m),m=null),l(...S)};return[function(){const S=Date.now(),T=S-g;for(var P=arguments.length,x=new Array(P),N=0;N<P;N++)x[N]=arguments[N];T>=_?v(x,S):(h=x,m||(m=setTimeout(()=>{m=null,v(h)},_-T)))},()=>h&&v(h)]}(l=>{const u=l.loaded,h=l.lengthComputable?l.total:void 0,m=u-i,g=a(m);i=u,e({loaded:u,total:h,progress:h?u/h:void 0,bytes:m,rate:g||void 0,estimated:g&&h&&u<=h?(h-u)/g:void 0,event:l,lengthComputable:h!=null,[t?"download":"upload"]:!0})},n)},wV=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},CV=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Pe.asap(()=>e(...n))};var Ffe=Di.hasStandardBrowserEnv?((e,t)=>n=>(n=new Ky(n,Di.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new Ky(Di.origin),Di.navigator&&/(msie|trident)/i.test(Di.navigator.userAgent)):()=>!0,Bfe=Di.hasStandardBrowserEnv?{write(e,t,n,i,a,l,u){if(typeof document>"u")return;const h=["".concat(e,"=").concat(encodeURIComponent(t))];Pe.isNumber(n)&&h.push("expires=".concat(new Date(n).toUTCString())),Pe.isString(i)&&h.push("path=".concat(i)),Pe.isString(a)&&h.push("domain=".concat(a)),l===!0&&h.push("secure"),Pe.isString(u)&&h.push("SameSite=".concat(u)),document.cookie=h.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function RV(e,t,n){let i=!function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}(t);return e&&(i||n==0)?function(a,l){return l?a.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):a}(e,t):t}function xV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function jx(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xV(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const NV=e=>e instanceof Yo?jx({},e):e;function ih(e,t){t=t||{};const n={};function i(g,_,v,S){return Pe.isPlainObject(g)&&Pe.isPlainObject(_)?Pe.merge.call({caseless:S},g,_):Pe.isPlainObject(_)?Pe.merge({},_):Pe.isArray(_)?_.slice():_}function a(g,_,v,S){return Pe.isUndefined(_)?Pe.isUndefined(g)?void 0:i(void 0,g,0,S):i(g,_,0,S)}function l(g,_){if(!Pe.isUndefined(_))return i(void 0,_)}function u(g,_){return Pe.isUndefined(_)?Pe.isUndefined(g)?void 0:i(void 0,g):i(void 0,_)}function h(g,_,v){return v in t?i(g,_):v in e?i(void 0,g):void 0}const m={url:l,method:l,data:l,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:h,headers:(g,_,v)=>a(NV(g),NV(_),0,!0)};return Pe.forEach(Object.keys(jx(jx({},e),t)),function(g){const _=m[g]||a,v=_(e[g],t[g],g);Pe.isUndefined(v)&&_!==h||(n[g]=v)}),n}var IV=e=>{const t=ih({},e);let{data:n,withXSRFToken:i,xsrfHeaderName:a,xsrfCookieName:l,headers:u,auth:h}=t;if(t.headers=u=Yo.from(u),t.url=zM(RV(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),h&&u.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),Pe.isFormData(n)){if(Di.hasStandardBrowserEnv||Di.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if(Pe.isFunction(n.getHeaders)){const m=n.getHeaders(),g=["content-type","content-length"];Object.entries(m).forEach(_=>{let[v,S]=_;Ee(g).call(g,v.toLowerCase())&&u.set(v,S)})}}if(Di.hasStandardBrowserEnv&&(i&&Pe.isFunction(i)&&(i=i(t)),i||i!==!1&&Ffe(t.url))){const m=a&&l&&Bfe.read(l);m&&u.set(a,m)}return t},Gfe=typeof XMLHttpRequest<"u"&&function(e){return new Ne(function(t,n){const i=IV(e);let a=i.data;const l=Yo.from(i.headers).normalize();let u,h,m,g,_,{responseType:v,onUploadProgress:S,onDownloadProgress:T}=i;function P(){g&&g(),_&&_(),i.cancelToken&&i.cancelToken.unsubscribe(u),i.signal&&i.signal.removeEventListener("abort",u)}let x=new XMLHttpRequest;function N(){if(!x)return;const F=Yo.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders());bV(function(q){t(q),P()},function(q){n(q),P()},{data:v&&v!=="text"&&v!=="json"?x.response:x.responseText,status:x.status,statusText:x.statusText,headers:F,config:e,request:x}),x=null}x.open(i.method.toUpperCase(),i.url,!0),x.timeout=i.timeout,"onloadend"in x?x.onloadend=N:x.onreadystatechange=function(){x&&x.readyState===4&&(x.status!==0||x.responseURL&&x.responseURL.indexOf("file:")===0)&&setTimeout(N)},x.onabort=function(){x&&(n(new mn("Request aborted",mn.ECONNABORTED,e,x)),x=null)},x.onerror=function(F){const q=new mn(F&&F.message?F.message:"Network Error",mn.ERR_NETWORK,e,x);q.event=F||null,n(q),x=null},x.ontimeout=function(){let F=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const q=i.transitional||YM;i.timeoutErrorMessage&&(F=i.timeoutErrorMessage),n(new mn(F,q.clarifyTimeoutError?mn.ETIMEDOUT:mn.ECONNABORTED,e,x)),x=null},a===void 0&&l.setContentType(null),"setRequestHeader"in x&&Pe.forEach(l.toJSON(),function(F,q){x.setRequestHeader(q,F)}),Pe.isUndefined(i.withCredentials)||(x.withCredentials=!!i.withCredentials),v&&v!=="json"&&(x.responseType=i.responseType),T&&([m,_]=gS(T,!0),x.addEventListener("progress",m)),S&&x.upload&&([h,g]=gS(S),x.upload.addEventListener("progress",h),x.upload.addEventListener("loadend",g)),(i.cancelToken||i.signal)&&(u=F=>{x&&(n(!F||F.type?new _m(null,e,x):F),x.abort(),x=null)},i.cancelToken&&i.cancelToken.subscribe(u),i.signal&&(i.signal.aborted?u():i.signal.addEventListener("abort",u)));const M=function(F){const q=/^([-+\w]{1,25})(:?\/\/|:)/.exec(F);return q&&q[1]||""}(i.url);M&&Di.protocols.indexOf(M)===-1?n(new mn("Unsupported protocol "+M+":",mn.ERR_BAD_REQUEST,e)):x.send(a||null)})},Wfe=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,a=new AbortController;const l=function(g){if(!i){i=!0,h();const _=g instanceof Error?g:this.reason;a.abort(_ instanceof mn?_:new _m(_ instanceof Error?_.message:_))}};let u=t&&setTimeout(()=>{u=null,l(new mn("timeout ".concat(t," of ms exceeded"),mn.ETIMEDOUT))},t);const h=()=>{e&&(u&&clearTimeout(u),u=null,e.forEach(g=>{g.unsubscribe?g.unsubscribe(l):g.removeEventListener("abort",l)}),e=null)};e.forEach(g=>g.addEventListener("abort",l));const{signal:m}=a;return m.unsubscribe=()=>Pe.asap(h),m}},Mx=p(pj),AV=hm.f("asyncIterator"),Hfe=p(AV);function Ux(e,t){this.v=e,this.k=t}function vi(e){return function(){return new __(e.apply(this,arguments))}}function __(e){var t,n;function i(l,u){try{var h=e[l](u),m=h.value,g=m instanceof Ux;Mx.resolve(g?m.v:m).then(function(_){if(g){var v=l==="return"?"return":"next";if(!m.k||_.done)return i(v,_);_=e[v](_).value}a(h.done?"return":"normal",_)},function(_){i("throw",_)})}catch(_){a("throw",_)}}function a(l,u){switch(l){case"return":t.resolve({value:u,done:!0});break;case"throw":t.reject(u);break;default:t.resolve({value:u,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(l,u){return new Mx(function(h,m){var g={key:l,arg:u,resolve:h,reject:m,next:null};n?n=n.next=g:(t=n=g,i(l,u))})},typeof e.return!="function"&&(this.return=void 0)}function Rt(e){return new Ux(e,0)}function Em(e){var t={},n=!1;function i(a,l){return n=!0,l=new Mx(function(u){u(e[a](l))}),{done:!1,value:new Ux(l,1)}}return t[gm!==void 0&&iV||"@@iterator"]=function(){return this},t.next=function(a){return n?(n=!1,a):i("next",a)},typeof e.throw=="function"&&(t.throw=function(a){if(n)throw n=!1,a;return i("throw",a)}),typeof e.return=="function"&&(t.return=function(a){return n?(n=!1,a):i("return",a)}),t}__.prototype[typeof gm=="function"&&Hfe||"@@asyncIterator"]=function(){return this},__.prototype.next=function(e){return this._invoke("next",e)},__.prototype.throw=function(e){return this._invoke("throw",e)},__.prototype.return=function(e){return this._invoke("return",e)};var _S=p(AV);function Vx(e){var t,n,i,a=2;for(typeof Symbol<"u"&&(n=_S,i=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new ES(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function ES(e){function t(n){if(Object(n)!==n)return Ne.reject(new TypeError(n+" is not an object."));var i=n.done;return Ne.resolve(n.value).then(function(a){return{value:a,done:i}})}return ES=function(n){this.s=n,this.n=n.next},ES.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Ne.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Ne.reject(n):t(i.apply(this.s,arguments))}},new ES(e)}const Kfe=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,a=0;for(;a<n;)i=a+t,yield e.slice(a,i),a=i},zfe=function(){var e=vi(function*(t,n){var i,a=!1,l=!1;try{for(var u,h=Vx(qfe(t));a=!(u=yield Rt(h.next())).done;a=!1){const m=u.value;yield*Em(Vx(Kfe(m,n)))}}catch(m){l=!0,i=m}finally{try{a&&h.return!=null&&(yield Rt(h.return()))}finally{if(l)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),qfe=function(){var e=vi(function*(t){if(t[_S])return void(yield*Em(Vx(t)));const n=t.getReader();try{for(;;){const{done:i,value:a}=yield Rt(n.read());if(i)break;yield a}}finally{yield Rt(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),OV=(e,t,n,i)=>{const a=zfe(e,t);let l,u=0,h=m=>{l||(l=!0,i&&i(m))};return new ReadableStream({async pull(m){try{const{done:g,value:_}=await a.next();if(g)return h(),void m.close();let v=_.byteLength;if(n){let S=u+=v;n(S)}m.enqueue(new Uint8Array(_))}catch(g){throw h(g),g}},cancel:m=>(h(m),a.return())},{highWaterMark:2})};function PV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function DV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PV(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PV(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const{isFunction:vS}=Pe,Yfe=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(Pe.global),{ReadableStream:kV,TextEncoder:LV}=Pe.global,jV=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},Xfe=e=>{e=Pe.merge.call({skipUndefined:!0},Yfe,e);const{fetch:t,Request:n,Response:i}=e,a=t?vS(t):typeof fetch=="function",l=vS(n),u=vS(i);if(!a)return!1;const h=a&&vS(kV),m=a&&(typeof LV=="function"?(g=new LV,P=>g.encode(P)):async P=>new Uint8Array(await new n(P).arrayBuffer()));var g;const _=l&&h&&jV(()=>{let P=!1;const x=new n(Di.origin,{body:new kV,method:"POST",get duplex(){return P=!0,"half"}}).headers.has("Content-Type");return P&&!x}),v=u&&h&&jV(()=>Pe.isReadableStream(new i("").body)),S={stream:v&&(P=>P.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(P=>{!S[P]&&(S[P]=(x,N)=>{let M=x&&x[P];if(M)return M.call(x);throw new mn("Response type '".concat(P,"' is not supported"),mn.ERR_NOT_SUPPORT,N)})});const T=async(P,x)=>{const N=Pe.toFiniteNumber(P.getContentLength());return N??(async M=>M==null?0:Pe.isBlob(M)?M.size:Pe.isSpecCompliantForm(M)?(await new n(Di.origin,{method:"POST",body:M}).arrayBuffer()).byteLength:Pe.isArrayBufferView(M)||Pe.isArrayBuffer(M)?M.byteLength:(Pe.isURLSearchParams(M)&&(M+=""),Pe.isString(M)?(await m(M)).byteLength:void 0))(x)};return async P=>{let{url:x,method:N,data:M,signal:F,cancelToken:q,timeout:J,onDownloadProgress:te,onUploadProgress:Y,responseType:ne,headers:ue,withCredentials:fe="same-origin",fetchOptions:Me}=IV(P),ut=t||fetch;ne=ne?(ne+"").toLowerCase():"text";let ot=Wfe([F,q&&q.toAbortSignal()],J),Ct=null;const vt=ot&&ot.unsubscribe&&(()=>{ot.unsubscribe()});let Zt;try{if(Y&&_&&N!=="get"&&N!=="head"&&(Zt=await T(ue,M))!==0){let R,z=new n(x,{method:"POST",body:M,duplex:"half"});if(Pe.isFormData(M)&&(R=z.headers.get("content-type"))&&ue.setContentType(R),z.body){const[Q,ye]=wV(Zt,gS(CV(Y)));M=OV(z.body,65536,Q,ye)}}Pe.isString(fe)||(fe=fe?"include":"omit");const Bn=l&&"credentials"in n.prototype,pe=DV(DV({},Me),{},{signal:ot,method:N.toUpperCase(),headers:ue.normalize().toJSON(),body:M,duplex:"half",credentials:Bn?fe:void 0});Ct=l&&new n(x,pe);let be=await(l?ut(Ct,Me):ut(x,pe));const Fe=v&&(ne==="stream"||ne==="response");if(v&&(te||Fe&&vt)){const R={};["status","statusText","headers"].forEach(mt=>{R[mt]=be[mt]});const z=Pe.toFiniteNumber(be.headers.get("content-length")),[Q,ye]=te&&wV(z,gS(CV(te),!0))||[];be=new i(OV(be.body,65536,Q,()=>{ye&&ye(),vt&&vt()}),R)}ne=ne||"text";let me=await S[Pe.findKey(S,ne)||"text"](be,P);return!Fe&&vt&&vt(),await new Ne((R,z)=>{bV(R,z,{data:me,headers:Yo.from(be.headers),status:be.status,statusText:be.statusText,config:P,request:Ct})})}catch(Bn){throw vt&&vt(),Bn&&Bn.name==="TypeError"&&/Load failed|fetch/i.test(Bn.message)?Object.assign(new mn("Network Error",mn.ERR_NETWORK,P,Ct),{cause:Bn.cause||Bn}):mn.from(Bn,Bn&&Bn.code,P,Ct)}}},Qfe=new Map,MV=e=>{let t=e&&e.env||{};const{fetch:n,Request:i,Response:a}=t,l=[i,a,n];let u,h,m=l.length,g=Qfe;for(;m--;)u=l[m],h=g.get(u),h===void 0&&g.set(u,h=m?new Map:Xfe(t)),g=h;return h};MV();const Fx={http:null,xhr:Gfe,fetch:{get:MV}};Pe.forEach(Fx,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const UV=e=>"- ".concat(e),Jfe=e=>Pe.isFunction(e)||e===null||e===!1;var VV={getAdapter:function(e,t){e=Pe.isArray(e)?e:[e];const{length:n}=e;let i,a;const l={};for(let u=0;u<n;u++){let h;if(i=e[u],a=i,!Jfe(i)&&(a=Fx[(h=String(i)).toLowerCase()],a===void 0))throw new mn("Unknown adapter '".concat(h,"'"));if(a&&(Pe.isFunction(a)||(a=a.get(t))))break;l[h||"#"+u]=a}if(!a){const u=Object.entries(l).map(h=>{let[m,g]=h;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")});throw new mn("There is no suitable adapter to dispatch the request "+(n?u.length>1?`since :
`+u.map(UV).join(`
`):" "+UV(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:Fx};function Bx(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new _m(null,e)}function FV(e){return Bx(e),e.headers=Yo.from(e.headers),e.data=Lx.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),VV.getAdapter(e.adapter||Dx.adapter,e)(e).then(function(t){return Bx(e),t.data=Lx.call(e,e.transformResponse,t),t.headers=Yo.from(t.headers),t},function(t){return TV(t)||(Bx(e),t&&t.response&&(t.response.data=Lx.call(e,e.transformResponse,t.response),t.response.headers=Yo.from(t.response.headers))),Ne.reject(t)})}const BV="1.13.2",yS={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{yS[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const GV={};yS.transitional=function(e,t,n){function i(a,l){return"[Axios v"+BV+"] Transitional option '"+a+"'"+l+(n?". "+n:"")}return(a,l,u)=>{if(e===!1)throw new mn(i(l," has been removed"+(t?" in "+t:"")),mn.ERR_DEPRECATED);return t&&!GV[l]&&(GV[l]=!0,console.warn(i(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,l,u)}},yS.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var SS={assertOptions:function(e,t,n){if(typeof e!="object")throw new mn("options must be an object",mn.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let a=i.length;for(;a-- >0;){const l=i[a],u=t[l];if(u){const h=e[l],m=h===void 0||u(h,l,e);if(m!==!0)throw new mn("option "+l+" must be "+m,mn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new mn("Unknown option "+l,mn.ERR_BAD_OPTION)}},validators:yS};const Bc=SS.validators;let TS=class{constructor(e){this.defaults=e||{},this.interceptors={request:new qM,response:new qM}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const a=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=ih(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:a}=t;n!==void 0&&SS.assertOptions(n,{silentJSONParsing:Bc.transitional(Bc.boolean),forcedJSONParsing:Bc.transitional(Bc.boolean),clarifyTimeoutError:Bc.transitional(Bc.boolean)},!1),i!=null&&(Pe.isFunction(i)?t.paramsSerializer={serialize:i}:SS.assertOptions(i,{encode:Bc.function,serialize:Bc.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),SS.assertOptions(t,{baseUrl:Bc.spelling("baseURL"),withXsrfToken:Bc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=a&&Pe.merge(a.common,a[t.method]);a&&Pe.forEach(["delete","get","head","post","put","patch","common"],T=>{delete a[T]}),t.headers=Yo.concat(l,a);const u=[];let h=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(h=h&&T.synchronous,u.unshift(T.fulfilled,T.rejected))});const m=[];let g;this.interceptors.response.forEach(function(T){m.push(T.fulfilled,T.rejected)});let _,v=0;if(!h){const T=[FV.bind(this),void 0];for(T.unshift(...u),T.push(...m),_=T.length,g=Ne.resolve(t);v<_;)g=g.then(T[v++],T[v++]);return g}_=u.length;let S=t;for(;v<_;){const T=u[v++],P=u[v++];try{S=T(S)}catch(x){P.call(this,x);break}}try{g=FV.call(this,S)}catch(T){return Ne.reject(T)}for(v=0,_=m.length;v<_;)g=g.then(m[v++],m[v++]);return g}getUri(e){return zM(RV((e=ih(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Pe.forEach(["delete","get","head","options"],function(e){TS.prototype[e]=function(t,n){return this.request(ih(n||{},{method:e,url:t,data:(n||{}).data}))}}),Pe.forEach(["post","put","patch"],function(e){function t(n){return function(i,a,l){return this.request(ih(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}TS.prototype[e]=t(),TS.prototype[e+"Form"]=t(!0)});var bS=TS;class Gx{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Ne(function(a){n=a});const i=this;this.promise.then(a=>{if(!i._listeners)return;let l=i._listeners.length;for(;l-- >0;)i._listeners[l](a);i._listeners=null}),this.promise.then=a=>{let l;const u=new Ne(h=>{i.subscribe(h),l=h}).then(a);return u.cancel=function(){i.unsubscribe(l)},u},t(function(a,l,u){i.reason||(i.reason=new _m(a,l,u),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new Gx(function(i){t=i}),cancel:t}}}var $fe=Gx;const Wx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Wx).forEach(e=>{let[t,n]=e;Wx[n]=t});var Zfe=Wx;const Gs=function e(t){const n=new bS(t),i=IM(bS.prototype.request,n);return Pe.extend(i,bS.prototype,n,{allOwnKeys:!0}),Pe.extend(i,n,null,{allOwnKeys:!0}),i.create=function(a){return e(ih(t,a))},i}(Dx);Gs.Axios=bS,Gs.CanceledError=_m,Gs.CancelToken=$fe,Gs.isCancel=TV,Gs.VERSION=BV,Gs.toFormData=rS,Gs.AxiosError=mn,Gs.Cancel=Gs.CanceledError,Gs.all=function(e){return Ne.all(e)},Gs.spread=function(e){return function(t){return e.apply(null,t)}},Gs.isAxiosError=function(e){return Pe.isObject(e)&&e.isAxiosError===!0},Gs.mergeConfig=ih,Gs.AxiosHeaders=Yo,Gs.formToJSON=e=>yV(Pe.isHTMLForm(e)?new FormData(e):e),Gs.getAdapter=VV.getAdapter,Gs.HttpStatusCode=Zfe,Gs.default=Gs;var yi=Gs;const ege=()=>{};function E_(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:ege};return e.promise=new Ne((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const wS=new Map,CS=new Map,Gc=new Map;let zr=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Qt=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const WV=new jhe;let Xo=WV.getResult(),Hx=null;function qt(e){if(!Hx){Xo=WV.getResult();const t=function(h){if(h.engine.name==="Blink"&&h.browser.name!=="WeChat")return Qt.CHROME;switch(h.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Qt.CHROME;case"Safari":case"Mobile Safari":return Qt.SAFARI;case"Edge":return Qt.EDGE;case"Firefox":return Qt.FIREFOX;case"QQ":case"QQBrowser":return Qt.QQ;case"Opera":return Qt.OPERA;case"WeChat":return Qt.WECHAT;default:return h.browser.name||""}}(Xo),n=HV(Xo),i=function(h){return h.os.name==="Windows"?h.os.version?h.os.name+" "+h.os.version:h.os.name:h.os.name||""}(Xo),a=Xo.os.version,l=HV(Xo,!1),u=Xo.device.type;if(!(t&&n&&i&&a))return{name:t,version:n,os:i,osVersion:a,browserVersion:l,deviceType:u};Hx={name:t,version:n,os:i,osVersion:a,browserVersion:l,deviceType:u}}return Hx}function HV(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function RS(){return qt().os}function KV(){const e=qt();return"".concat(e.os," ").concat(e.osVersion)}function xS(){const e=qt();return!!(Xo.engine.name==="WebKit"&&e.os===zr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Qt.SAFARI||Ws()&&e.name!==Qt.SAFARI)}function jl(){return qt().name===Qt.CHROME}function ss(){return qt().name===Qt.SAFARI}function zV(){const e=qt();if(e.name!==Qt.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function qV(){return qt().name===Qt.EDGE}function An(){return qt().name===Qt.FIREFOX}function Ws(){return qt().os===zr.IOS}function Wc(e){const t=qt();return!(t.name!==Qt.CHROME||!t.osVersion)&&Number(t.version)>=e}function YV(e){const t=qt();return!(t.name!==Qt.CHROME||!t.osVersion)&&Number(t.version)<e}function Kx(e,t,n){const i=qt();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function ah(e){const t=qt();return!(t.name!==Qt.EDGE||!t.osVersion)&&Number(t.version)>=e}function zx(e){const t=qt();return!(t.name!==Qt.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function XV(e){const t=qt();return!(t.name!==Qt.SAFARI||!t.osVersion)&&Number(t.version)>=e}function QV(e,t,n){const i=qt();if(i.os!==zr.IOS||!i.osVersion)return!1;const a=i.osVersion.split(".");return t?Number(a[0])===e&&Number(a[1])>=t||Number(a[0])>e:Number(a[0])>=e}function JV(e,t,n){const i=qt();if(i.os!==zr.IOS||!i.osVersion)return!1;const a=i.osVersion.split(".");return t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e}function qx(e,t,n){const i=qt();if(i.name!==Qt.SAFARI||!i.osVersion||!i.browserVersion)return!1;const a=i.browserVersion.split(".");return t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e}function oh(e){const t=qt();return!(t.name!==Qt.OPERA||!t.osVersion)&&Number(t.version)>=e}function $V(){const e=qt();if(e.os!==zr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function vm(){const e=qt();if(e.os!==zr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function Yx(){const e=qt();if(e.os!==zr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function ZV(){const e=qt();if(e.os!==zr.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function mo(){return ss()&&navigator.maxTouchPoints>0}function eF(){return qt().name===Qt.WECHAT}function tF(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function nF(){const e=RS();return function(){const{deviceType:t}=qt();return t==="mobile"||t==="tablet"}()||e===zr.ANDROID||e===zr.IOS||e===zr.HARMONY_OS}function Hc(){const e=qt();return e.name!==Qt.EDGE&&e.name!==Qt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function v_(){return RS()===zr.ANDROID}function y_(){const e=qt();return v_()&&(e.name===Qt.CHROME||e.name===Qt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function gt(e,t,n){return(t=function(i){var a=function(l,u){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var m=h.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rF(Object(n),!0).forEach(function(i){gt(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let U=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),ae=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),gt(this,"code",void 0),gt(this,"message",void 0),gt(this,"data",void 0),gt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function fo(e,t){if(typeof e!="boolean")throw new ae(U.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function wr(e,t,n){if(!Ee(n).call(n,e))throw new ae(U.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function fn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(a){return typeof a=="number"&&a%1==0}(e))throw new ae(U.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function Xx(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new ae(U.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&fn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&fn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&fn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&fn(e.ideal,"".concat(t,".ideal"),1,1/0)}else fn(e,t,1,1/0)}function Es(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new ae(U.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!sF(e,n,i,a))throw new ae(U.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(a?" ASCII characters only.":""))}function Ml(e,t){if(!Array.isArray(e))throw new ae(U.INVALID_PARAMS,"".concat(t," should be an array"))}function ir(e){return e==null}function sF(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||function(a){if(typeof a!="string")return!1;for(let l=0;l<a.length;l+=1){const u=a.charCodeAt(l);if(u<0||u>255)return!1}return!0}(e))}function iF(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const i=e.getUint32(t,n),a=e.getUint32(t+4,n),l=+!!n,u=+!n;return BigInt(i*u+a*l)<<BigInt(32)|BigInt(i*l+a*u)}function aF(e,t,n,i){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,i);const a=Number(n>>BigInt(32)),l=Number(n&BigInt(4294967295));e.setUint32(t,a,i),e.setUint32(t+4,l,i)}var S_=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(S_||{}),Qx=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Qx||{});const oF=new class{constructor(){gt(this,"_clientSize",null),gt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),gt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),gt(this,"getStyle",e=>window.getComputedStyle(e,null)),gt(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:a,visibility:l,opacity:u,filter:h}=i;return(a==="none"||Ee(t=["hidden","collapse"]).call(t,l)||Number(u)<.1)&&(n=!1),!!n&&(h&&h.split(" ").filter(m=>{var g;const _=m.split("(")[0];return Ee(g=["brightness","blur","opacity"]).call(g,_)}).map(m=>{const[g,_]=m.split(/\(|\)/);return[g,Number(_.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,_]=m;switch(g){case"brightness":(_<.1||_>3)&&(n=!1);break;case"blur":_>3&&(n=!1);break;case"opacity":_<.1&&(n=!1)}}),n)}),gt(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const a=u=>t(u);let l=e;for(;l&&i;)a(l)||(n=!1,i=!1),l=l.parentElement,l||(i=!1);return n}),gt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),gt(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:a,top:l,bottom:u}=e.getBoundingClientRect(),h=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:n,left:i,right:a,top:l,bottom:u,clientWidth:h,clientHeight:m,clientMin:Math.min(h,m)}}),gt(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),gt(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),gt(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),gt(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,a=e/6,l=t/6,u=[],h=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++){const _=(n*h+(m===0?.1:m===4?(a*m*h-1e5)/h:a*m)*h)/h,v=(i*h+(g===0?.1:g===4?(l*g*h-1e5)/h:l*g)*h)/h;u.push({x:_,y:v})}return[...u]}),gt(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),gt(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),gt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:a,clientWidth:l,clientMin:u}=this._clientSize;let h,m,g,_;if(e<0)h=0;else{if(!(e<l))return!1;h=e}if(t<0)return!1;if(m=t<l?t:l,n<0)g=0;else{if(!(n<a))return!1;g=n}if(i<0)return!1;_=i<a?i:a;const v=m-h,S=_-g;return this.checkSizeIsVisible(v,S,u)}),gt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),gt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(S_.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(S_.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(S_.SIZE)}}return this.returnHiddenResult(S_.STYLE)}return this.returnHiddenResult(Qx.UNMOUNTED)}return this.returnHiddenResult(Qx.INVALID_HTML_ELEMENT)}),gt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function Jx(e){return new TextEncoder().encode(e)}const cF=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},$x=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(a=>{i+=a.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",Jx(e)),16);let Yn=class{constructor(){gt(this,"_events",{}),gt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],i=this._indexOfListener(n,t);i!==-1&&n.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];for(let l=0;l<t.length;l+=1){const u=t[l];u.once&&this.off(e,u.listener),u.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];[...this._events[e]||[]].forEach(a=>{a.once&&this.off(e,a.listener);try{a.listener.apply(this,n)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},T_=null;function lF(){if(T_)return T_;if(window.electron)return T_=window.electron;if(!window.require)return null;try{return T_=window.require("electron"),T_}catch{return null}}let Vn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e}({}),gn=function(e){return e.TRACER="tracer",e}({});function dF(e){return fn(e.timeout,"config.timeout",0,1e5),fn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),fn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),fn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let tge=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ft=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e}({});function ch(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function uF(e){return Es(e.turnServerURL,"turnServerURL"),Es(e.username,"username"),Es(e.password,"password"),e.udpport&&fn(e.udpport,"udpport",1,99999,!0),e.forceturn&&fo(e.forceturn,"forceturn"),e.security&&fo(e.security,"security"),e.tcpport&&fn(e.tcpport,"tcpport",1,99999,!0),!0}let ym=function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e}({});function Zx(e){return e.level!==void 0&&wr(e.level,"level",[1,2,3]),e.delay!==void 0&&fn(e.delay,"delay",0,3e3,!0),!0}let At=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e}({}),eN=function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e}({}),Rs=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),ci=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),lh=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Pr(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return e.getListeners(t).length===0?Ne.reject(new ae(U.UNEXPECTED_ERROR,"can not emit promise")):new Ne((l,u)=>{e.emit(t,...i,l,u)})}function Sn(e,t){if(e.getListeners(t).length===0)return Ne.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return Pr(e,t,...i)}function Ji(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];return dh(e,t,...i)}function dh(e,t){let n=null,i=null;for(var a=arguments.length,l=new Array(a>2?a-2:0),u=2;u<a;u++)l[u-2]=arguments[u];if(e.emit(t,...l,h=>{n=h},h=>{i=h}),i!==null)throw i;if(n===null)throw new ae(U.UNEXPECTED_ERROR,"handler is not sync");return n}const ar=new class extends Yn{set networkState(e){this.emit(lh.NETWORK_STATE_CHANGE,e,this._networkState),e===ci.ONLINE?this.emit(lh.ONLINE):e===ci.OFFLINE&&(this.onlineWaiter=new Ne(t=>{this.once(lh.ONLINE,()=>{this.onlineWaiter=void 0,t(ci.ONLINE)})}),this.emit(lh.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ci.ONLINE}constructor(){super(),gt(this,"_moduleName","network-indicator"),gt(this,"_networkState",ci.ONLINE),gt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ci.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ci.OFFLINE})}},Si=[];for(let e=0;e<256;++e)Si.push((e+256).toString(16).slice(1));const hF=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);let tN;const nge=new Uint8Array(16);function rge(){return hF?hF():function(n,i,a){var l,u,h,m;const g=(l=(u=(n=n||{}).random)!==null&&u!==void 0?u:(h=(m=n).rng)===null||h===void 0?void 0:h.call(m))!==null&&l!==void 0?l:function(){if(!tN){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");tN=crypto.getRandomValues.bind(crypto)}return tN(nge)}();if(g.length<16)throw new Error("Random bytes length must be >= 16");if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,i){if((a=a||0)<0||a+16>i.length)throw new RangeError("UUID byte range ".concat(a,":").concat(a+15," is out of buffer bounds"));for(let _=0;_<16;++_)i[a+_]=g[_];return i}return function(_){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(Si[_[v+0]]+Si[_[v+1]]+Si[_[v+2]]+Si[_[v+3]]+"-"+Si[_[v+4]]+Si[_[v+5]]+"-"+Si[_[v+6]]+Si[_[v+7]]+"-"+Si[_[v+8]]+Si[_[v+9]]+"-"+Si[_[v+10]]+Si[_[v+11]]+Si[_[v+12]]+Si[_[v+13]]+Si[_[v+14]]+Si[_[v+15]]).toLowerCase()}(g)}(e,t,void 0);var e,t}function NS(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Sm(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function IS(e){Ne!==void 0?Ne.resolve().then(e):setTimeout(e,0)}function On(e){return JSON.parse(JSON.stringify(e))}function uh(e){try{return On(e)}catch{return e}}const pF={};function Pd(e,t){pF[t]||(pF[t]=!0,e())}function hh(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function Dd(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function mF(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function fF(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=ka(t).call(t,(u,h)=>u+h.length,0),a=new Uint8Array(new ArrayBuffer(i));let l=0;return t.forEach(u=>{a.set(u,l),l+=u.length}),a}function Kc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function gF(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Kc(n):n.size}),t+138}function sge(e){const t=new ae(U.TIMEOUT,"timeout");return new Ne((n,i)=>{window.setTimeout(()=>i(t),e)})}function qr(e){return new Ne(t=>{window.setTimeout(t,e)})}function on(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+on(e-n.length,"")}function ph(){let e,t=!1;try{var n;e=Lhe(n=rge()).call(n,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=on(32,"")),e.toUpperCase()}const b_=()=>{},_F=new class{constructor(){gt(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var a=arguments.length,l=new Array(a>4?a-4:0),u=4;u<a;u++)l[u-4]=arguments[u];if(this.fnMap.has(t)){const h=this.fnMap.get(t);if(h.threshold!==n){h.fn(...h.args),clearTimeout(h.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:m,args:l,skipFn:i})}else h.skipFn&&h.skipFn(...h.args),this.fnMap.set(t,Se(Se({},h),{},{fn:e,args:l,skipFn:i}))}else{const h=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:l,skipFn:i})}}},EF=_F.throttleByKey.bind(_F);function vF(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function nN(e,t){if(!vF(e)||!vF(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=nN(e[i],t[i]);return n}{const n=Se({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=nN(e[i],t[i]):n[i]=t[i]);return n}}function yF(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function Tm(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function rN(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function sN(e){return ka(e).call(e,(t,n)=>t+n,0)}function SF(e){const t="0123456789abcdef";function n(q){let J,te="";for(J=0;J<=3;J++)te+=t.charAt(q>>8*J+4&15)+t.charAt(q>>8*J&15);return te}function i(q,J){const te=(65535&q)+(65535&J);return(q>>16)+(J>>16)+(te>>16)<<16|65535&te}function a(q,J,te,Y,ne,ue){return i(function(fe,Me){return fe<<Me|fe>>>32-Me}(i(i(J,q),i(Y,ue)),ne),te)}function l(q,J,te,Y,ne,ue,fe){return a(J&te|~J&Y,q,J,ne,ue,fe)}function u(q,J,te,Y,ne,ue,fe){return a(J&Y|te&~Y,q,J,ne,ue,fe)}function h(q,J,te,Y,ne,ue,fe){return a(J^te^Y,q,J,ne,ue,fe)}function m(q,J,te,Y,ne,ue,fe){return a(te^(J|~Y),q,J,ne,ue,fe)}const g=function(q){let J;const te=1+(q.length+8>>6),Y=new Array(16*te);for(J=0;J<16*te;J++)Y[J]=0;for(J=0;J<q.length;J++)Y[J>>2]|=q.charCodeAt(J)<<J%4*8;return Y[J>>2]|=128<<J%4*8,Y[16*te-2]=8*q.length,Y}(e);let _,v,S,T,P,x=1732584193,N=-271733879,M=-1732584194,F=271733878;for(_=0;_<g.length;_+=16)v=x,S=N,T=M,P=F,x=l(x,N,M,F,g[_+0],7,-680876936),F=l(F,x,N,M,g[_+1],12,-389564586),M=l(M,F,x,N,g[_+2],17,606105819),N=l(N,M,F,x,g[_+3],22,-1044525330),x=l(x,N,M,F,g[_+4],7,-176418897),F=l(F,x,N,M,g[_+5],12,1200080426),M=l(M,F,x,N,g[_+6],17,-1473231341),N=l(N,M,F,x,g[_+7],22,-45705983),x=l(x,N,M,F,g[_+8],7,1770035416),F=l(F,x,N,M,g[_+9],12,-1958414417),M=l(M,F,x,N,g[_+10],17,-42063),N=l(N,M,F,x,g[_+11],22,-1990404162),x=l(x,N,M,F,g[_+12],7,1804603682),F=l(F,x,N,M,g[_+13],12,-40341101),M=l(M,F,x,N,g[_+14],17,-1502002290),N=l(N,M,F,x,g[_+15],22,1236535329),x=u(x,N,M,F,g[_+1],5,-165796510),F=u(F,x,N,M,g[_+6],9,-1069501632),M=u(M,F,x,N,g[_+11],14,643717713),N=u(N,M,F,x,g[_+0],20,-373897302),x=u(x,N,M,F,g[_+5],5,-701558691),F=u(F,x,N,M,g[_+10],9,38016083),M=u(M,F,x,N,g[_+15],14,-660478335),N=u(N,M,F,x,g[_+4],20,-405537848),x=u(x,N,M,F,g[_+9],5,568446438),F=u(F,x,N,M,g[_+14],9,-1019803690),M=u(M,F,x,N,g[_+3],14,-187363961),N=u(N,M,F,x,g[_+8],20,1163531501),x=u(x,N,M,F,g[_+13],5,-1444681467),F=u(F,x,N,M,g[_+2],9,-51403784),M=u(M,F,x,N,g[_+7],14,1735328473),N=u(N,M,F,x,g[_+12],20,-1926607734),x=h(x,N,M,F,g[_+5],4,-378558),F=h(F,x,N,M,g[_+8],11,-2022574463),M=h(M,F,x,N,g[_+11],16,1839030562),N=h(N,M,F,x,g[_+14],23,-35309556),x=h(x,N,M,F,g[_+1],4,-1530992060),F=h(F,x,N,M,g[_+4],11,1272893353),M=h(M,F,x,N,g[_+7],16,-155497632),N=h(N,M,F,x,g[_+10],23,-1094730640),x=h(x,N,M,F,g[_+13],4,681279174),F=h(F,x,N,M,g[_+0],11,-358537222),M=h(M,F,x,N,g[_+3],16,-722521979),N=h(N,M,F,x,g[_+6],23,76029189),x=h(x,N,M,F,g[_+9],4,-640364487),F=h(F,x,N,M,g[_+12],11,-421815835),M=h(M,F,x,N,g[_+15],16,530742520),N=h(N,M,F,x,g[_+2],23,-995338651),x=m(x,N,M,F,g[_+0],6,-198630844),F=m(F,x,N,M,g[_+7],10,1126891415),M=m(M,F,x,N,g[_+14],15,-1416354905),N=m(N,M,F,x,g[_+5],21,-57434055),x=m(x,N,M,F,g[_+12],6,1700485571),F=m(F,x,N,M,g[_+3],10,-1894986606),M=m(M,F,x,N,g[_+10],15,-1051523),N=m(N,M,F,x,g[_+1],21,-2054922799),x=m(x,N,M,F,g[_+8],6,1873313359),F=m(F,x,N,M,g[_+15],10,-30611744),M=m(M,F,x,N,g[_+6],15,-1560198380),N=m(N,M,F,x,g[_+13],21,1309151649),x=m(x,N,M,F,g[_+4],6,-145523070),F=m(F,x,N,M,g[_+11],10,-1120210379),M=m(M,F,x,N,g[_+2],15,718787259),N=m(N,M,F,x,g[_+9],21,-343485551),x=i(x,v),N=i(N,S),M=i(M,T),F=i(F,P);return n(x)+n(N)+n(M)+n(F)}let ige=1,TF=console,is=class{static setLogger(e){TF=e}constructor(e,t){gt(this,"id",void 0),gt(this,"lockingPromise",Ne.resolve()),gt(this,"locks",0),gt(this,"name",""),gt(this,"lockId",void 0),this.lockId=ige++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");TF.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new Ne(a=>{t=()=>{this.locks-=1,this.logger("unlocked",e),a()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function bm(e,t){return function(n,i,a){const l=a.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const u=this[t];if(!u)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const h=await u.lock("From ".concat(e,".").concat(i));try{for(var m=arguments.length,g=new Array(m),_=0;_<m;_++)g[_]=arguments[_];return await l.apply(this,g)}finally{h()}},a}}const Cr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function AS(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Qo(e,t,n,i){const a=Object.assign({},Cr,i);let l=a.timeout;const u=async()=>{await function(g){return new Ne(_=>{window.setTimeout(_,g)})}(l),l*=a.timeoutFactor,l=Math.min(a.maxRetryTimeout,l)};let h=!1;const m=new Ne(async(g,_)=>{t=t||(()=>!1),n=n||(()=>!0);for(let v=0;v<a.maxRetryCount;v+=1){if(h)return _(new ae(U.OPERATION_ABORTED));try{const S=await e();if(!t(S,v)||v+1===a.maxRetryCount)return g(S);await u()}catch(S){if(!n(S,v)||v+1===a.maxRetryCount)return _(S);await u()}}});return m.cancel=()=>h=!0,m}let OS,iN=class{constructor(e){gt(this,"input",[]),gt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ka(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},PS=0,aN=0;function oN(e,t,n,i){return new Ne((a,l)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),PS+=Kc(t.data)):n&&(t.data.size?PS+=t.data.size:t.data instanceof FormData?PS+=gF(t.data):PS+=Kc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,yi.request(t).then(u=>{typeof u.data=="string"?aN+=Kc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?aN+=u.data.byteLength:aN+=Kc(JSON.stringify(u.data)),a(u.data)}).catch(u=>{yi.isCancel(u)?l(new ae(U.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?l(new ae(U.NETWORK_TIMEOUT,u.message)):u.response?l(new ae(U.NETWORK_RESPONSE_ERROR,u.response.status)):l(new ae(U.NETWORK_ERROR,u.message))})})}async function age(e,t){const n=new Blob([t.data],{type:"buffer"});return await oN(e,Se(Se({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const bF=()=>window.isSecureContext!==void 0;function go(e){if(Array.isArray(e))return e.map(n=>n);if(!wF(e))return e;const t={};for(const n in e){const i=e[n];wF(i)||Array.isArray(i)?t[n]=go(i):t[n]=i}return t}function wF(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let cN=class{constructor(e){gt(this,"input",[]),gt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const _o={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},w_={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:_o,remoteCandidate:_o},updateInterval:0},CF={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},RF={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},xF={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},NF={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let lN=class{constructor(e,t){gt(this,"onFirstVideoReceived",void 0),gt(this,"onFirstVideoDecoded",void 0),gt(this,"onFirstAudioReceived",void 0),gt(this,"onFirstVideoDecodedTimeout",void 0),gt(this,"onFirstAudioDecoded",void 0),gt(this,"onSelectedLocalCandidateChanged",void 0),gt(this,"onSelectedRemoteCandidateChanged",void 0),gt(this,"videoIsReady",!1),gt(this,"videoIsReady2",{}),gt(this,"pc",void 0),gt(this,"options",void 0),gt(this,"intervalTimer",void 0),gt(this,"stats",go(w_)),gt(this,"isFirstVideoReceived",{}),gt(this,"isFirstVideoDecoded",{}),gt(this,"isFirstAudioReceived",{}),gt(this,"isFirstAudioDecoded",{}),gt(this,"isFirstVideoDecodedTimeout",{}),gt(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ne(e=>{e({local:Se({},_o),remote:Se({},_o)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,a=0,l=0,u=0;for(const h of n)e[h].forEach((m,g)=>{if(!this.lossRateWindowStats[t-1][h][g]||!this.lossRateWindowStats[0][h][g])return;const _=this.lossRateWindowStats[t-1][h][g].packets-this.lossRateWindowStats[0][h][g].packets,v=this.lossRateWindowStats[t-1][h][g].packetsLost-this.lossRateWindowStats[0][h][g].packetsLost;h==="videoSend"||h==="audioSend"?(i+=_,l+=v):(a+=_,u+=v),Number.isNaN(_)||Number.isNaN(_)?m.packetLostRate=0:m.packetLostRate=_<=0||v<=0?0:v/(_+v)});e.sendPacketLossRate=i<=0||l<=0?0:l/(i+l),e.recvPacketLossRate=a<=0||u<=0?0:u/(a+u)}},oge=class extends lN{constructor(){super(...arguments),gt(this,"_stats",w_),gt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=go(w_);const n=t.filter(a=>a.type==="ssrc");this.processSSRCStats(n);const i=t.find(a=>a.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const i=Ee(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const a=go(RF);a.codec=t.googCodecName,a.adaptionChangeReason="none",t.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(t.googAvgEncodeMs),a.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},a.firsCount=Number(t.googFirReceived),a.nacksCount=Number(t.googNacksReceived),a.plisCount=Number(t.googPlisReceived),a.frameCount=Number(t.framesEncoded),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=go(CF),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(a.codec=t.googCodecName,a.targetDelayMs=Number(t.googTargetDelayMs),a.renderDelayMs=Number(t.googRenderDelayMs),a.currentDelayMs=Number(t.googCurrentDelayMs),a.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),a.decodeMs=Number(t.googDecodeMs),a.maxDecodeMs=Number(t.googMaxDecodeMs),a.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},a.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},a.decodeFrameRate=Number(t.googFrameRateDecoded),a.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},a.jitterBufferMs=Number(t.googJitterBufferMs),a.firsCount=Number(t.googFirsSent),a.nacksCount=Number(t.googNacksSent),a.plisCount=Number(t.googPlisSent),a.framesDecodeCount=Number(t.framesDecoded),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),l){const u=l.stats,h=Date.now()-l.lts;a.framesDecodeFreezeTime=u.framesDecodeFreezeTime,a.framesDecodeInterval=u.framesDecodeInterval,a.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(l.lts=Date.now(),a.framesDecodeInterval=h,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):a.framesDecodeCount<l.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:Se({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=go(NF);a.codec=t.googCodecName,a.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,a.decodingCNG=Number(t.googDecodingCNG),a.decodingCTN=Number(t.googDecodingCTN),a.decodingCTSG=Number(t.googDecodingCTSG),a.decodingNormal=Number(t.googDecodingNormal),a.decodingPLC=Number(t.googDecodingPLC),a.decodingPLCCNG=Number(t.googDecodingPLCCNG),a.expandRate=Number(t.googExpandRate),a.accelerateRate=Number(t.googAccelerateRate),a.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),a.speechExpandRate=Number(t.googSpeechExpandRate),a.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),a.jitterBufferMs=Number(t.googJitterBufferMs),a.jitterMs=Number(t.googJitterReceived),a.bytes=Number(t.bytesReceived),a.packets=Number(t.packetsReceived),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),a.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=go(xF);a.codec=t.googCodecName,a.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,a.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(t.bytesSent),a.packets=Number(t.packetsSent),a.packetsLost=Number(t.packetsLost),a.ssrc=Number(t.ssrc),a.rttMs=Number(t.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new Ne((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(a=>{i[a]=n.stat(a)}),t.push(i)}),t}},wm=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),DS=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),dN=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),ma=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Cm=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Cm||{});function C_(e,t,n,i){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Cm.kNone;if(!t)return;const l=Number(t[n]);if(typeof l!="number")return;const u=Number(t[i]);if(typeof u!="number")return;if(!e)return u?l/u*a:void 0;const h=Number(e[n]);if(typeof h!="number")return;const m=Number(e[i]);if(typeof m!="number")return;const g=u-m;return g?(l-h)/g*a:void 0}let IF=class extends lN{constructor(){super(...arguments),gt(this,"_stats",w_),gt(this,"report",void 0),gt(this,"lastDecodeVideoReceiverStats",new Map),gt(this,"lastVideoFramesRecv",new Map),gt(this,"lastVideoFramesSent",new Map),gt(this,"lastVideoFramesDecode",new Map),gt(this,"lastVideoFramesOutput",new Map),gt(this,"lastVideoJBDelay",new Map),gt(this,"lastAudioJBDelay",new Map),gt(this,"mediaBytesSent",new Map),gt(this,"mediaBytesRetransmit",new Map),gt(this,"mediaBytesTargetEncode",new Map),gt(this,"lastDecodeAudioReceiverStats",new Map),gt(this,"lastAudioConcealment",new Map),gt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=go(w_),this.report.forEach(e=>{switch(e.type){case ma.OUTBOUND:case ma.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===ma.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===ma.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case ma.TRANSPORT:{this.processTransportStats(e);const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case ma.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Se({},_o),remote:Se({},_o)};return e.forEach(n=>{let i;if(n.type===ma.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===ma.CANDIDATE_PAIR&&n.selected&&(i=n),i){const a=(l,u)=>{l.type=u.type,l.id=u.id,u.address&&(l.address=u.address),u.candidateType&&(l.candidateType=u.candidateType),u.port&&(l.port=u.port),u.priority&&(l.priority=u.priority),u.protocol&&(l.protocol=u.protocol),u.relayProtocol&&(l.relayProtocol=u.relayProtocol)};if(i.localCandidateId){const l=e.get(i.localCandidateId);l&&a(t.local,l)}if(i.remoteCandidateId){const l=e.get(i.remoteCandidateId);l&&a(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===ma.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ma.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ma.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Se({},t),Se({},this.stats.selectedCandidatePair.localCandidate)),e.type===ma.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Se({},t),Se({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(i=>i.ssrc===e.ssrc);t||(t=go(NF),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=C_(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Cm.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Se({},t))}calculateAudioFreeze(e,t,n){const i=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&i!=null){const a=i.lts,l=n.timestamp,u=l-a;if(u<=0)return;const h=e.concealedSamples-t.concealedSamples-0,m=i.nonSilent+h,g=e.totalSamplesReceived-t.totalSamplesReceived;if(g<=0)return;const _=80*g/u,v=200*g/u,S=u/g;let T=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,m>_&&(i.plc80>0?(e.freezeSamples80+=h,e.freezeMs80+=Math.round(h*S)):(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*S)),T=i.plc80+1);let P=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,m>v&&(i.plc200>0?(e.freezeSamples200+=h,e.freezeMs200+=Math.round(h*S)):(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*S)),P=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:h,lts:l,plc80:T,plc200:P})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(u=>u.ssrc===e.ssrc);t||(t=go(CF),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),a=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const u=t.decodedFrame?t.decodedFrame.width:0,h=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,u,h),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const u=n.stats,h=l-n.lts;t.framesDecodeFreezeTime=u.framesDecodeFreezeTime,t.framesDecodeInterval=u.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&h>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=h,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<u.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=C_(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=C_(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",Cm.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=C_(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Cm.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=C_(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",Cm.kMillisecondsFromSeconds),i&&l-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((l-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(a&&l-a.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-a.count)/((l-a.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):a?t.outputFrameRate=a.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Se({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);t||(t=go(RF),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const i=new cN(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const a=new cN(10);a.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,a)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const a=new cN(10);a.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,a)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const a=e.framesEncoded-i.lastFrameCount,l=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*l/a}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,ma.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=go(xF),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,ma.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var n;const i=Array.from(Yi(n=this.report).call(n)).find(a=>a.type===t&&a.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,a,l,u;const h=t?this.report.get(t):void 0,m=(i=h==null?void 0:h.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof m!="number")return;let g=(a=h==null?void 0:h.frameWidth)!==null&&a!==void 0?a:e.frameWidth,_=(l=h==null?void 0:h.frameHeight)!==null&&l!==void 0?l:e.frameHeight,v=(u=h==null?void 0:h.framesPerSecond)!==null&&u!==void 0?u:e.framesPerSecond;if(typeof g=="number"&&typeof _=="number"||(g=0,_=0),v==null){const S=Date.now(),T=this.lastVideoFramesSent.get(n.ssrc);T&&S-T.lts>=800?(v=Math.round((m-T.count)/((S-T.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:S,rate:v})):T?v=T.rate:this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:S,rate:0})}n.sentFrame={width:g,height:_,frameRate:Math.max(0,v)}}processVideoTrackReceiverStats(e,t,n){var i,a,l,u,h;const m=t?this.report.get(t):void 0,g=(i=m==null?void 0:m.framesReceived)!==null&&i!==void 0?i:e.framesReceived,_=(a=m==null?void 0:m.frameWidth)!==null&&a!==void 0?a:e.frameWidth,v=(l=m==null?void 0:m.frameHeight)!==null&&l!==void 0?l:e.frameHeight,S=(u=m==null?void 0:m.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,T=(h=m==null?void 0:m.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount;if(typeof g=="number"){const P=this.lastVideoFramesRecv.get(n.ssrc),x=Date.now();n.framesReceivedCount=g;let N=0;P&&x-P.lts>=800?(N=Math.round((g-P.count)/((x-P.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:x,rate:N})):P?N=P.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:x,rate:0}),n.receivedFrame={width:_||0,height:v||0,frameRate:N||0},n.decodedFrame={width:_||0,height:v||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:_||0,height:v||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(S&&T){const P=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let x=P.jitterBufferMs;const N=T-P.jitterBufferEmittedCount;N>0&&(x=1e3*(S-P.jitterBufferDelay)/N),n.jitterBufferMs=x,n.currentDelayMs=Math.round(x),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:T,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,a,l,u;const h=t?this.report.get(t):void 0,m=(i=(a=h==null?void 0:h.echoReturnLoss)!==null&&a!==void 0?a:e.echoReturnLoss)!==null&&i!==void 0?i:0,g=(l=(u=h==null?void 0:h.echoReturnLossEnhancement)!==null&&u!==void 0?u:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;n.aecReturnLoss=m,n.aecReturnLossEnhancement=g}processAudioTrackReceiverStats(e,t,n){var i,a,l,u,h,m,g,_,v;const S=t?this.report.get(t):void 0,T=(i=S==null?void 0:S.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,P=(a=S==null?void 0:S.totalSamplesReceived)!==null&&a!==void 0?a:e.totalSamplesReceived,x=(l=S==null?void 0:S.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,N=(u=S==null?void 0:S.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount,M=(h=S==null?void 0:S.audioLevel)!==null&&h!==void 0?h:e==null?void 0:e.audioLevel,F=(m=S==null?void 0:S.totalSamplesDuration)!==null&&m!==void 0?m:e==null?void 0:e.totalSamplesDuration,q=(g=S==null?void 0:S.concealedSamples)!==null&&g!==void 0?g:e.concealedSamples,J=(_=S==null?void 0:S.silentConcealedSamples)!==null&&_!==void 0?_:e.silentConcealedSamples,te=(v=S==null?void 0:S.concealmentEvents)!==null&&v!==void 0?v:e.concealmentEvents;if(typeof P=="number"&&(n.totalSamplesReceived=P),typeof J=="number"&&(n.silentConcealedSamples=J),typeof te=="number"&&(n.concealmentEvents=te),typeof q=="number"&&(n.concealedSamples=q),T&&P&&(n.accelerateRate=T/P),x&&N){const ne=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ue=ne.jitterBufferMs;const fe=N-ne.jitterBufferEmittedCount;fe>0&&(ue=1e3*(x-ne.jitterBufferDelay)/fe),n.jitterBufferMs=Math.round(ue),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:x,jitterBufferEmittedCount:N,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=M;let Y=1920;F&&P&&(Y=P/F/50,n.receivedFrames=Math.round(P/Y)),q&&(n.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(a=>{e+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{t=t===null?a.diffMean():t+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()});const i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},cge=class extends lN{updateStats(){return Ne.resolve()}};function kS(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const u=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return u&&u[0]?Number(u[0].split("/")[1]):null}();return l?l<76?new oge(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:a}):new IF(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:a}):function(u){if(!window.RTCStatsReport)return!1;const h=u.getStats();return!!(h instanceof Ne||function(m){return!!m&&(typeof m=="object"||typeof m=="function")&&typeof m.then=="function"}(h))}(e)?new IF(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:a}):new cge(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:a})}const AF="websdk_ng_install_id";function uN(){try{if(j("INSTALL_ID"))return j("INSTALL_ID");let e=window.localStorage.getItem(AF);return e||(e=ph(),window.localStorage.setItem(AF,e)),hn("INSTALL_ID",e),e}catch{return}}const ja=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.24.1"),hN=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let mh=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const xs=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),a=[];for(let h=0;h<6;h++)a.push("1");const l=a.join(""),u={};return u[e]=i,u[t]=l,Object.assign(u,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=xs;const LS={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},pN={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},mN="v4.24.1-0-g2cff7c6c-dirty(11/18/2025, 5:40:47 PM)",fN={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},cn=Se(Se(Se(Se({},fN),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:pN,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},LS),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1});function hn(e,t,n){var i,a,l;Ee(i=Object.keys(cn)).call(i,e)&&(!n&&Ee(a=Object.keys(fa)).call(a,e)||(cn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(cn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,cn.USE_NEW_NETWORK_CONFIG=l,l&&(cn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],cn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],cn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],cn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],cn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",cn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",cn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(cn.ENABLE_INSTANT_VIDEO=!0,cn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(cn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(cn.NEW_TURN_MODE||(cn.NEW_TURN_MODE=4))))}function j(e){if(e==="TURN_DOMAINS"){const t=cn.TURN_DOMAINS;return Ee(t).call(t,j("TURN_DOMAIN"))?t:[j("TURN_DOMAIN")].concat(t)}return cn[e]}hN||(cn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],cn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],cn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],cn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],cn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],cn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],cn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",cn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",cn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",cn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",cn.AREAS=["NORTH_AMERICA","OVERSEA"]);let OF=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const fa={};var ht=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ht||{});let fh=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const PF=128,lge=96,DF=1e3,Rm=10;let dge=0;var kF=(()=>{var e={8:(i,a,l)=>{l.r(a),l.d(a,{Parser:()=>fe,Printer:()=>vt,parse:()=>be,print:()=>Fe});const u=`
`,h="".concat("\r").concat(u),m=" ";let g;function _(me){return me>="0"&&me<="9"}function v(me){return me>="!"&&me<="~"}function S(me){return v(me)||me>=""&&me<=""}function T(me){return me==="!"||me>="#"&&me<="'"||me>="*"&&me<="+"||me>="-"&&me<="."||me>="0"&&me<="9"||me>="A"&&me<="Z"||me>="^"&&me<="~"}function P(me){return me>="1"&&me<="9"}function x(me){return me>="A"&&me<="Z"||me>="a"&&me<="z"}function N(me){return me==="d"||me==="h"||me==="m"||me==="s"}function M(me){return me>""&&me<"	"||me>"\v"&&me<"\f"||me>""&&me<""}function F(me){return x(me)||_(me)||me==="+"||me==="/"}function q(me){return _(me)||x(me)||me==="+"||me==="/"||me==="-"||me==="_"}function J(me){return x(me)||_(me)||me==="+"||me==="/"}function te(me,R){var z=Object.keys(me);if(Object.getOwnPropertySymbols){var Q=Object.getOwnPropertySymbols(me);R&&(Q=Q.filter(function(ye){return Object.getOwnPropertyDescriptor(me,ye).enumerable})),z.push.apply(z,Q)}return z}function Y(me){for(var R=1;R<arguments.length;R++){var z=arguments[R]!=null?arguments[R]:{};R%2?te(Object(z),!0).forEach(function(Q){ne(me,Q,z[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(me,Object.getOwnPropertyDescriptors(z)):te(Object(z)).forEach(function(Q){Object.defineProperty(me,Q,Object.getOwnPropertyDescriptor(z,Q))})}return me}function ne(me,R,z){return R in me?Object.defineProperty(me,R,{value:z,enumerable:!0,configurable:!0,writable:!0}):me[R]=z,me}(function(me){me.VERSION="v",me.ORIGIN="o",me.SESSION_NAME="s",me.INFORMATION="i",me.URI="u",me.EMAIL="e",me.PHONE="p",me.CONNECTION="c",me.BANDWIDTH="b",me.TIME="t",me.REPEAT="r",me.ZONE_ADJUSTMENTS="z",me.KEY="k",me.ATTRIBUTE="a",me.MEDIA="m"})(g||(g={}));class ue{consumeText(R,z){let Q=z;for(;Q<R.length;){const ye=R[Q];if(ye==="\0"||ye==="\r"||ye===u)break;Q+=1}if(Q-z==0)throw new Error("Invalid text, at ".concat(R));return Q}consumeUnicastAddress(R,z,Q){return this.consumeTill(R,z,m)}consumeOneOrMore(R,z,Q){let ye=z;for(;Q(R[ye]);)ye++;if(ye-z==0)throw new Error("Invalid rule at ".concat(z,"."));return ye}consumeSpace(R,z){if(R[z]===m)return z+1;throw new Error("Invalid space at ".concat(z,"."))}consumeIP4Address(R,z){let Q=z;for(let ye=0;ye<4;ye++)if(Q=this.consumeDecimalUChar(R,Q),ye!==3){if(R[Q]!==".")throw new Error("Invalid IP4 address.");Q++}return Q}consumeDecimalUChar(R,z){let Q=z;for(let mt=0;mt<3&&_(R[Q]);mt++,Q++);if(Q-z==0)throw new Error("Invalid decimal uchar.");const ye=parseInt(R.slice(z,Q));if(ye>=0&&ye<=255)return Q;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,z){let Q=this.consumeHexpart(R,z);return R[Q]===":"&&(Q+=1,Q=this.consumeIP4Address(R,Q)),Q}consumeHexpart(R,z){let Q=z;if(R[Q]===":"&&R[Q+1]===":"){Q+=2;try{Q=this.consumeHexseq(R,Q)}catch{}return Q}if(Q=this.consumeHexseq(R,Q),R[Q]===":"&&R[Q+1]===":"){Q+=2;try{Q=this.consumeHexseq(R,Q)}catch{}return Q}return Q}consumeHexseq(R,z){let Q=z;for(;Q=this.consumeHex4(R,Q),R[Q]===":"&&R[Q+1]!==":";)Q+=1;return Q}consumeHex4(R,z){let Q=0;for(;Q<4;Q++)if(!((ye=R[z+Q])>="0"&&ye<="9"||ye>="a"&&ye<="f"||ye>="A"&&ye<="F")){if(Q===0)throw new Error("Invalid hex 4");break}var ye;return z+Q}consumeFQDN(R,z){let Q=z;for(;_(R[Q])||x(R[Q])||R[Q]==="-"||R[Q]===".";)Q+=1;if(Q-z<4)throw new Error("Invalid FQDN");return Q}consumeExtnAddr(R,z){return this.consumeOneOrMore(R,z,S)}consumeMulticastAddress(R,z,Q){switch(Q){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,z);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,z);default:try{return this.consumeFQDN(R,z)}catch{return this.consumeExtnAddr(R,z)}}}consumeIP6MulticastAddress(R,z){const Q=this.consumeHexpart(R,z);return R[Q]==="/"?this.consumeInteger(R,Q+1):Q}consumeIP4MulticastAddress(R,z){let Q=z+3;const ye=R.slice(z,Q),mt=parseInt(ye);if(mt<224||mt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let bn=0;bn<3;bn++){if(R[Q]!==".")throw new Error("Invalid IP4 multicast address.");Q+=1,Q=this.consumeDecimalUChar(R,Q)}return R[Q]==="/"&&(Q+=1),Q=this.consumeTTL(R,Q),R[Q]==="/"&&(Q=this.consumeInteger(R,Q)),Q}consumeInteger(R,z){if(!P(R[z]))throw new Error("Invalid integer.");for(z+=1;_(R[z]);)z+=1;return z}consumeTTL(R,z){if(R[z]==="0")return z+1;if(!P(R[z]))throw new Error("Invalid TTL.");z+=1;for(let Q=0;Q<2&&_(R[z]);Q++)z+=1;return z}consumeToken(R,z){return this.consumeOneOrMore(R,z,T)}consumeTime(R,z){let Q=z;if(R[Q]==="0")return Q+1;for(P(R[Q])&&(Q+=1);_(R[Q]);)Q++;if(Q-z<10)throw new Error("Invalid time");return Q}consumeAddress(R,z){return this.consumeTill(R,z,m)}consumeTypedTime(R,z){let Q=z;return Q=this.consumeOneOrMore(R,Q,_),N(R[Q])?Q+1:Q}consumeRepeatInterval(R,z){if(!P(R[z]))throw new Error("Invalid repeat interval");for(z+=1;_(R[z]);)z+=1;return N(R[z])&&(z+=1),z}consumePort(R,z){return this.consumeOneOrMore(R,z,_)}consume(R,z,Q){for(let ye=0;ye<Q.length;ye++){if(z+ye>=R.length)throw new Error("consume exceeding value length");if(R[z+ye]!==Q[ye])throw new Error("consume ".concat(Q," failed at ").concat(ye))}return z+Q.length}consumeTill(R,z,Q){let ye=z;for(;ye<R.length&&(typeof Q!="string"||R[ye]!==Q)&&(typeof Q!="function"||!Q(R[ye]));)ye++;return ye}}class fe extends ue{constructor(){super(),ne(this,"records",[]),ne(this,"currentLine",0)}parse(R){const z=this.probeEOL(R);this.records=R.split(z).filter(Jd=>!!ai(Jd).call(Jd)).map(this.parseLine),this.currentLine=0;const Q=this.parseVersion(),ye=this.parseOrigin(),mt=this.parseSessionName(),bn=this.parseInformation(),Jr=this.parseUri(),Ka=this.parseEmail(),Qd=this.parsePhone(),Y0=this.parseConnection(),af=this.parseBandWidth(),X0=this.parseTimeFields(),Vh=this.parseKey(),uE=this.parseSessionAttribute(),Fh=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:Q,origin:ye,sessionName:mt,information:bn,uri:Jr,emails:Ka,phones:Qd,connection:Y0,bandwidths:af,timeFields:X0,key:Vh,attributes:uE,mediaDescriptions:Fh}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let z=0;z<R.length;z++)if(R[z]===u)return R[z-1]==="\r"?h:u;throw new Error("Invalid newline character.")}parseLine(R,z){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const Q=R[0];if(R[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:Q,value:R.slice(2),line:z,cur:0}}parseSessionAttribute(){const R=new ut;for(;this.currentLine<this.records.length;){const z=this.getCurrentRecord();if(z.type!==g.ATTRIBUTE)break;const Q={attField:this.extractOneOrMore(z,ye=>T(ye)&&ye!==":"),_cur:0};z.value[z.cur]===":"&&(z.cur+=1,Q.attValue=this.extractOneOrMore(z,M)),R.parse(Q),this.currentLine++}return R.digest()}parseMediaAttributes(R){const z=new ot(R);for(;this.currentLine<this.records.length;){const Q=this.getCurrentRecord();if(Q.type!==g.ATTRIBUTE)break;const ye={attField:this.extractOneOrMore(Q,mt=>T(mt)&&mt!==":"),_cur:0};Q.value[Q.cur]===":"&&(Q.cur+=1,ye.attValue=this.extractOneOrMore(Q,M)),z.parse(ye),this.currentLine++}return z.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===g.KEY){if(R.value==="prompt"||R.value==="clear:"||R.value==="base64:"||R.value==="uri:")return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===g.ZONE_ADJUSTMENTS){const z=[];for(;;)try{const Q=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let ye=!1;R.value[R.cur]==="-"&&(ye=!0,R.cur+=1);const mt=this.extract(R,this.consumeTypedTime);z.push({time:Q,typedTime:mt,back:ye})}catch{break}if(z.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,z}return[]}parseRepeat(){const R=[];for(;;){const z=this.getCurrentRecord();if(z.type!==g.REPEAT)break;{const Q=this.extract(z,this.consumeRepeatInterval),ye=this.parseTypedTime(z);R.push({repeatInterval:Q,typedTimes:ye}),this.currentLine++}}return R}parseTypedTime(R){const z=[];for(;;)try{this.consumeSpaceForRecord(R),z.push(this.extract(R,this.consumeTypedTime))}catch{break}if(z.length===0)throw new Error("Invalid typed time.");return z}parseTime(){const R=this.getCurrentRecord(),z=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const Q=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:z,stopTime:Q}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const z=this.getCurrentRecord();if(z.type!==g.BANDWIDTH)break;{const Q=this.extractOneOrMore(z,T);if(z.value[z.cur]!==":")throw new Error("Invalid bandwidth field.");z.cur++;const ye=this.extractOneOrMore(z,_);R.push({bwtype:Q,bandwidth:ye}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==g.VERSION)throw new Error("first sdp record must be version");const z=R.value.slice(0,this.consumeOneOrMore(R.value,0,_));if(z.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,z}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==g.ORIGIN)throw new Error("second line of sdp must be origin");const z=this.extractOneOrMore(R,S);this.consumeSpaceForRecord(R);const Q=this.extractOneOrMore(R,_);this.consumeSpaceForRecord(R);const ye=this.extractOneOrMore(R,_);this.consumeSpaceForRecord(R);const mt=this.extractOneOrMore(R,T);this.consumeSpaceForRecord(R);const bn=this.extractOneOrMore(R,T);this.consumeSpaceForRecord(R);const Jr=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:z,sessId:Q,sessVersion:ye,nettype:mt,addrtype:bn,unicastAddress:Jr}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===g.SESSION_NAME){const z=this.extract(R,this.consumeText);return this.currentLine++,z}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==g.INFORMATION)return;const z=this.extract(R,this.consumeText);return this.currentLine++,z}parseUri(){const R=this.getCurrentRecord();if(R.type===g.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const z=this.getCurrentRecord();if(z.type!==g.EMAIL)break;R.push(z.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const z=this.getCurrentRecord();if(z.type!==g.PHONE)break;R.push(z.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===g.CONNECTION){const z=this.extractOneOrMore(R,T);this.consumeSpaceForRecord(R);const Q=this.extractOneOrMore(R,T);this.consumeSpaceForRecord(R);const ye=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:z,addrtype:Q,address:ye}}}parseMedia(){const R=this.getCurrentRecord(),z=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let Q=this.extract(R,this.consumePort);R.value[R.cur]==="/"&&(R.cur+=1,Q+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const ye=[];for(ye.push(this.extract(R,this.consumeToken));R.value[R.cur]==="/";)R.cur+=1,ye.push(this.extract(R,this.consumeToken));if(ye.length===0)throw new Error("Invalid proto");const mt=this.parseFmt(R);return this.currentLine++,{mediaType:z,port:Q,protos:ye,fmts:mt}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===g.TIME;){const z=this.parseTime(),Q=this.parseRepeat(),ye=this.parseZone();R.push({time:z,repeats:Q,zones:ye})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.MEDIA;){const z=this.parseMedia(),Q=this.parseInformation(),ye=this.parseConnections(),mt=this.parseBandWidth(),bn=this.parseKey(),Jr=this.parseMediaAttributes(z);R.push({media:z,information:Q,connections:ye,bandwidths:mt,key:bn,attributes:Jr})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const z=[];for(;;)try{this.consumeSpaceForRecord(R),z.push(this.extract(R,this.consumeToken))}catch{break}if(z.length===0)throw new Error("Invalid fmts");return z}extract(R,z){for(var Q=arguments.length,ye=new Array(Q>2?Q-2:0),mt=2;mt<Q;mt++)ye[mt-2]=arguments[mt];const bn=z.call(this,R.value,R.cur,...ye),Jr=R.value.slice(R.cur,bn);return R.cur=bn,Jr}extractOneOrMore(R,z){const Q=this.consumeOneOrMore(R.value,R.cur,z),ye=R.value.slice(R.cur,Q);return R.cur=Q,ye}consumeSpaceForRecord(R){if(R.value[R.cur]!==m)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class Me extends ue{constructor(){super(...arguments),ne(this,"attributes",void 0),ne(this,"digested",!1)}extractOneOrMore(R,z,Q){const ye=this.consumeOneOrMore(R.attValue,R._cur,z),mt=R.attValue.slice(R._cur,ye),[bn,Jr]=Q||[];if(typeof bn=="number"&&mt.length<bn)throw new Error("error in length, should be more or equal than ".concat(bn," characters."));if(typeof Jr=="number"&&mt.length>Jr)throw new Error("error in length, should be less or equal than ".concat(Jr," characters."));return R._cur=ye,mt}consumeAttributeSpace(R){if(R.attValue[R._cur]!==m)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,z){if(!R.attValue)throw new Error("Nothing to extract from attValue.");for(var Q=arguments.length,ye=new Array(Q>2?Q-2:0),mt=2;mt<Q;mt++)ye[mt-2]=arguments[mt];const bn=z.call(this,R.attValue,R._cur,...ye),Jr=R.attValue.slice(R._cur,bn);return R._cur=bn,Jr}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,z){if(!R.attValue)throw new Error;for(let Q=0;Q<z.length;Q++)if(z[Q]!==R.attValue[R._cur+Q])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,F,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,F,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const z=[];for(;!this.atEnd(R);){z.push(this.extractOneOrMore(R,F));try{this.consumeAttributeSpace(R)}catch(Q){if(this.atEnd(R))break;throw Q}}this.attributes.iceOptions=z}parseFingerprint(R){const z=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:z,fingerprint:Q})}parseExtmap(R){const z=this.extractOneOrMore(R,_);let Q;this.peekChar(R)==="/"&&(this.extract(R,this.consume,"/"),Q=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const ye=this.extract(R,this.consumeTill,m),mt=Y(Y({entry:parseInt(z,10)},Q&&{direction:Q}),{},{extensionName:ye});this.peekChar(R)===m&&(this.consumeAttributeSpace(R),mt.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(mt)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const z=this.extract(R,this.consumeTill);if(z!=="active"&&z!=="passive"&&z!=="actpass"&&z!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=z}}class ut extends Me{constructor(){super(...arguments),ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(z){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),z}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const z=this.extract(R,this.consumeToken),Q=[];for(;!this.atEnd(R)&&this.peekChar(R)===m;)this.consumeAttributeSpace(R),Q.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:z,identificationTag:Q})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,q)}parseIdentity(R){const z=this.extractOneOrMore(R,J),Q=[];for(;!this.atEnd(R)&&this.peekChar(R)===m;){this.consumeAttributeSpace(R);const ye=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const mt=this.extractOneOrMore(R,bn=>bn!==m&&M(bn));Q.push({name:ye,value:mt})}this.attributes.identities.push({assertionValue:z,extensions:Q})}parseMsidSemantic(R){this.peekChar(R)===m&&this.consumeAttributeSpace(R);const z={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if(this.peekChar(R)==="*"){this.extract(R,this.consume,"*"),z.applyForAll=!0;break}{const Q=this.extract(R,this.consumeTill,m);z.identifierList.push(Q)}}this.attributes.msidSemantic=z}}class ot extends Me{constructor(R){super(),ne(this,"attributes",void 0),R.protos.indexOf("RTP")!==-1||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(z){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),z}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const z=this.extractOneOrMore(R,F,[1,32]);this.consumeAttributeSpace(R);const Q=this.extractOneOrMore(R,_,[1,5]);this.consumeAttributeSpace(R);const ye=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const mt=this.extractOneOrMore(R,_,[1,10]);this.consumeAttributeSpace(R);const bn=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Jr=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const Ka={foundation:z,componentId:Q,transport:ye,priority:mt,connectionAddress:bn,port:Jr,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),Ka.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),Ka.relPort=this.extract(R,this.consumePort));this.peekChar(R)===m;){this.consumeAttributeSpace(R);const Qd=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),Ka.extension[Qd]=this.extractOneOrMore(R,v)}this.attributes.candidates.push(Ka)}parseRemoteCandidate(R){const z=[];for(;;){const Q=this.extractOneOrMore(R,_,[1,5]);this.consumeAttributeSpace(R);const ye=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const mt=this.extract(R,this.consumePort);z.push({componentId:Q,connectionAddress:ye,port:mt});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(z)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const z=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const ye={encodingName:Q,clockRate:this.extractOneOrMore(R,_)};this.atEnd(R)||this.peekChar(R)!=="/"||(this.extract(R,this.consume,"/"),ye.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const mt=this.attributes.payloads.find(bn=>bn.payloadType===parseInt(z,10));mt?mt.rtpMap=ye:this.attributes.payloads.push({payloadType:parseInt(z,10),rtpMap:ye,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const z=this.extractOneOrMore(R,_);this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill,":");let ye;this.peekChar(R)===":"&&(this.extract(R,this.consume,":"),ye=this.extract(R,this.consumeTill));const mt=this.attributes.ssrcs.find(bn=>bn.ssrcId===parseInt(z,10));mt?mt.attributes[Q]=ye:this.attributes.ssrcs.push({ssrcId:parseInt(z,10),attributes:{[Q]:ye}})}parseFmtp(R){const z=this.extract(R,this.consumeTill,m);this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill),ye={};Q.split(";").forEach(bn=>{let[Jr,Ka]=bn.split("=");Jr=ai(Jr).call(Jr);const Qd=typeof Ka=="string"?ai(Ka).call(Ka):null;typeof Jr=="string"&&Jr.length>0&&(ye[Jr]=Qd)});const mt=this.attributes.payloads.find(bn=>bn.payloadType===parseInt(z,10));mt?mt.fmtp={parameters:ye}:this.attributes.payloads.push({payloadType:parseInt(z,10),rtcpFeedbacks:[],fmtp:{parameters:ye}})}parseFmtParameters(R){const z={},Q=this.extract(R,this.consumeTill,"=");R._cur++;const ye=this.extract(R,this.consumeTill,";");for(z[Q]=ye;R.attValue[R._cur]===";";){const mt=this.extract(R,this.consumeTill,"=");R._cur++;const bn=this.extract(R,this.consumeTill,";");z[mt]=bn}return z}parseRtcpFb(R){let z="";z=this.peekChar(R)==="*"?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,m),this.consumeAttributeSpace(R);const Q=this.extract(R,this.consumeTill,m);let ye;if(Q==="trr-int")ye={type:Q,interval:this.extract(R,this.consumeTill)};else{const mt={type:Q};this.peekChar(R)===m&&(this.consumeAttributeSpace(R),mt.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===m&&(mt.additional=this.extract(R,this.consumeTill))),ye=mt}if(z==="*")this.attributes.rtcpFeedbackWildcards.push(ye);else{const mt=this.attributes.payloads.find(bn=>bn.payloadType===parseInt(z,10));mt?mt.rtcpFeedbacks.push(ye):this.attributes.payloads.push({payloadType:parseInt(z,10),rtcpFeedbacks:[ye]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const z={port:this.extract(R,this.consumePort)};this.peekChar(R)===m&&(this.consumeAttributeSpace(R),z.netType=this.extractOneOrMore(R,T),this.consumeAttributeSpace(R),z.addressType=this.extractOneOrMore(R,T),this.consumeAttributeSpace(R),z.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=z}parseMsid(R){const z={id:this.extractOneOrMore(R,T,[1,64])};this.peekChar(R)===m&&(this.consumeAttributeSpace(R),z.appdata=this.extractOneOrMore(R,T,[1,64])),this.attributes.msids.push(z)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const z=this.extractOneOrMore(R,ye=>x(ye)||_(ye)||ye==="_"||ye==="-");this.consumeAttributeSpace(R);const Q={id:z,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===m){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const ye=[];for(;;){const mt=this.extract(R,this.consumeToken);ye.push(mt);try{this.extract(R,this.consume,",")}catch{break}}Q.payloads=ye,this.peekChar(R)===m&&this.extract(R,this.consume,m)}for(;;){const ye=this.extract(R,this.consumeToken);switch(ye){case"depend":{const mt={type:ye,rids:this.extract(R,this.consume,"=").split(",")};Q.params.push(mt);break}default:{const mt={type:ye};this.peekChar(R)==="="&&(this.extract(R,this.consume,"="),mt.val=this.extract(R,this.consumeTill,";")),Q.params.push(mt)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(Q)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,_,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const z=this.extract(R,this.consumeToken),Q=[];for(;;)try{this.consumeAttributeSpace(R);const ye=this.extract(R,this.consumeInteger);Q.push(parseInt(ye,10))}catch{break}this.attributes.ssrcGroups.push({semantic:z,ssrcIds:Q})}}function Ct(me,R,z){return R in me?Object.defineProperty(me,R,{value:z,enumerable:!0,configurable:!0,writable:!0}):me[R]=z,me}class vt{constructor(){Ct(this,"eol",h)}print(R,z){let Q="";return z&&(this.eol=z),Q+=this.printVersion(R.version),Q+=this.printOrigin(R.origin),Q+=this.printSessionName(R.sessionName),Q+=this.printInformation(R.information),Q+=this.printUri(R.uri),Q+=this.printEmail(R.emails),Q+=this.printPhone(R.phones),Q+=this.printConnection(R.connection),Q+=this.printBandwidth(R.bandwidths),Q+=this.printTimeFields(R.timeFields),Q+=this.printKey(R.key),Q+=this.printSessionAttributes(R.attributes),Q+=this.printMediaDescription(R.mediaDescriptions),Q}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let z="";for(const Q of R)z+="e=".concat(Q).concat(this.eol);return z}printPhone(R){let z="";for(const Q of R)z+="e=".concat(Q).concat(this.eol);return z}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let z="";for(const Q of R)z+="b=".concat(Q.bwtype,":").concat(Q.bandwidth).concat(this.eol);return z}printTimeFields(R){let z="";for(const Q of R){z+="t=".concat(Q.time.startTime," ").concat(Q.time.startTime).concat(this.eol);for(const ye of Q.repeats)z+="r=".concat(ye.repeatInterval," ").concat(ye.typedTimes.join(" ")).concat(this.eol);Q.zoneAdjustments&&(z+="z=",z+="z=".concat(Q.zoneAdjustments.map(ye=>"".concat(ye.time," ").concat(ye.back?"-":""," ").concat(ye.typedTime)).join(" ")).concat(this.eol),z+=this.eol)}return z}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let z="";for(const Q of R)z+="a=".concat(Q.attField).concat(Q.attValue?":".concat(Q.attValue):"").concat(this.eol);return z}printMediaDescription(R){let z="";for(const Q of R)z+=this.printMedia(Q.media),z+=this.printInformation(Q.information),z+=this.printConnections(Q.connections),z+=this.printBandwidth(Q.bandwidths),z+=this.printKey(Q.key),z+=this.printMediaAttributes(Q);return z}printConnections(R){let z="";for(const Q of R)z+=this.printConnection(Q);return z}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new Bn(this.eol).print(R)}printMediaAttributes(R){return new pe(this.eol).print(R)}}class Zt{constructor(R){Ct(this,"eol",void 0),this.eol=R}printIceUfrag(R){return R===void 0?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return R===void 0?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return R===void 0?"":"a=ice-options:".concat(R.join(m)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(z=>"a=fingerprint:".concat(z.hashFunction).concat(m).concat(z.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(z=>"a=extmap:".concat(z.entry).concat(z.direction?"/".concat(z.direction):"").concat(m).concat(z.extensionName).concat(z.extensionAttributes?"".concat(m).concat(z.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return R===void 0?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(z=>"a=".concat(z.attField).concat(z.attValue?":".concat(z.attValue):"").concat(this.eol)).join("")}}class Bn extends Zt{print(R){let z="";return z+=this.printGroups(R.groups),z+=this.printMsidSemantic(R.msidSemantic),z+=this.printIceLite(R.iceLite),z+=this.printIceUfrag(R.iceUfrag),z+=this.printIcePwd(R.icePwd),z+=this.printIceOptions(R.iceOptions),z+=this.printFingerprints(R.fingerprints),z+=this.printSetup(R.setup),z+=this.printTlsId(R.tlsId),z+=this.printIdentity(R.identities),z+=this.printExtmap(R.extmaps),z+=this.printUnrecognized(R.unrecognized),z}printGroups(R){let z="";return R.length>0&&(z+=R.map(Q=>"a=group:".concat(Q.semantic).concat(Q.identificationTag.map(ye=>"".concat(m).concat(ye)).join("")).concat(this.eol)).join("")),z}printIceLite(R){return R===void 0?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return R.length===0?"":R.map(z=>"a=identity:".concat(z.assertionValue).concat(z.extensions.map(Q=>"".concat(m).concat(Q.name).concat(Q.value?"=".concat(Q.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let z="a=msid-semantic:".concat(R.semantic);return R.applyForAll?z+="".concat(m,"*"):R.identifierList.length>0&&(z+=R.identifierList.map(Q=>"".concat(m).concat(Q))),z+this.eol}}class pe extends Zt{print(R){const z=R.attributes;let Q="";return Q+=this.printRTCP(z.rtcp),Q+=this.printIceUfrag(z.iceUfrag),Q+=this.printIcePwd(z.icePwd),Q+=this.printIceOptions(z.iceOptions),Q+=this.printCandidates(z.candidates),Q+=this.printRemoteCandidatesList(z.remoteCandidatesList),Q+=this.printEndOfCandidates(z.endOfCandidates),Q+=this.printFingerprints(z.fingerprints),Q+=this.printSetup(z.setup),Q+=this.printMid(z.mid),Q+=this.printExtmap(z.extmaps),Q+=this.printRTPRelated(z),Q+=this.printPtime(z.ptime),Q+=this.printMaxPtime(z.maxPtime),Q+=this.printDirection(z.direction),Q+=this.printSSRCGroups(z.ssrcGroups),Q+=this.printSSRC(z.ssrcs),Q+=this.printRTCPMux(z.rtcpMux),Q+=this.printRTCPMuxOnly(z.rtcpMuxOnly),Q+=this.printRTCPRsize(z.rtcpRsize),Q+=this.printMSId(z.msids),Q+=this.printImageattr(z.imageattr),Q+=this.printRid(z.rids),Q+=this.printSimulcast(z.simulcast),Q+=this.printSCTPPort(z.sctpPort),Q+=this.printMaxMessageSize(z.maxMessageSize),Q+=this.printUnrecognized(z.unrecognized),Q}printCandidates(R){return R.map(z=>"a=candidate:".concat(z.foundation).concat(m).concat(z.componentId).concat(m).concat(z.transport).concat(m).concat(z.priority).concat(m).concat(z.connectionAddress).concat(m).concat(z.port).concat(m,"typ").concat(m).concat(z.type).concat(z.relAddr?"".concat(m,"raddr").concat(m).concat(z.relAddr):"").concat(z.relPort?"".concat(m,"rport").concat(m).concat(z.relPort):"").concat(Object.keys(z.extension).map(Q=>"".concat(m).concat(Q).concat(m).concat(z.extension[Q])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(z=>"a=remote-candidates:".concat(z.join(m)).concat(this.eol)).join("")}printEndOfCandidates(R){return R===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const z=R.payloads;let Q="";Q+=R.rtcpFeedbackWildcards.map(ye=>this.printRTCPFeedback("*",ye)).join("");for(const ye of z)Q+=this.printRtpMap(ye.payloadType,ye.rtpMap),Q+=this.printFmtp(ye.payloadType,ye.fmtp),Q+=ye.rtcpFeedbacks.map(mt=>this.printRTCPFeedback(ye.payloadType,mt)).join("");return Q}printFmtp(R,z){if(!z)return"";const Q=Object.keys(z.parameters);return Q.length===1&&z.parameters[Q[0]]===null?"a=fmtp:".concat(R).concat(m).concat(Q[0]).concat(this.eol):"a=fmtp:".concat(R).concat(m).concat(Object.keys(z.parameters).map(ye=>"".concat(ye,"=").concat(z.parameters[ye])).join(";")).concat(this.eol)}printRtpMap(R,z){return z?"a=rtpmap:".concat(R).concat(m).concat(z.encodingName,"/").concat(z.clockRate).concat(z.encodingParameters?"/".concat(z.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,z){let Q="a=rtcp-fb:".concat(R).concat(m),ye=z;return ye.type==="trr-int"?Q+="ttr-int".concat(m).concat(ye.interval):(Q+="".concat(ye.type),ye.parameter&&(Q+="".concat(m).concat(ye.parameter),ye.additional&&(Q+="".concat(m).concat(ye.additional)))),Q+this.eol}printPtime(R){return R===void 0?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return R===void 0?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return R===void 0?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(z=>Object.keys(z.attributes).map(Q=>"a=ssrc:".concat(z.ssrcId.toString(10)).concat(m).concat(Q).concat(z.attributes[Q]?":".concat(z.attributes[Q]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return R===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return R===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return R===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(R===void 0)return"";let z="a=rtcp:".concat(R.port);return R.netType&&(z+="".concat(m).concat(R.netType)),R.addressType&&(z+="".concat(m).concat(R.addressType)),R.address&&(z+="".concat(m).concat(R.address)),z+this.eol}printMSId(R){return R.map(z=>"a=msid:".concat(z.id).concat(z.appdata?"".concat(m).concat(z.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(z=>"a=imageattr:".concat(z).concat(this.eol)).join("")}printRid(R){return R.map(z=>{let Q="a=rid:".concat(z.id).concat(m).concat(z.direction);return z.payloads&&(Q+="".concat(m,"pt=").concat(z.payloads.join(","))),z.params.length>0&&(Q+="".concat(m).concat(z.params.map(ye=>ye.type==="depend"?"depend=".concat(ye.rids.join(",")):"".concat(ye.type,"=").concat(ye.val)).join(";"))),Q+this.eol}).join("")}printSimulcast(R){return R===void 0?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return R===void 0?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return R===void 0?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return R===void 0?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(z=>"a=ssrc-group:".concat(z.semantic).concat(z.ssrcIds.map(Q=>"".concat(m).concat(Q.toString(10))).join("")).concat(this.eol)).join("")}}function be(me){return new fe().parse(me)}function Fe(me,R){return new vt().print(me,R)}}},t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}return n.d=(i,a)=>{for(var l in a)n.o(a,l)&&!n.o(i,l)&&Object.defineProperty(i,l,{enumerable:!0,get:a[l]})},n.o=(i,a)=>Object.prototype.hasOwnProperty.call(i,a),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function li(e){return kF.parse(e)}function Ul(e,t){return kF.print(e,t)}var uge=Da("Array","keys"),hge=Td,pge=Bs,mge=k,fge=uge,gN=Array.prototype,gge={DOMTokenList:!0,NodeList:!0},_ge=function(e){var t=e.keys;return e===gN||mge(gN,e)&&t===gN.keys||pge(gge,hge(e))?fge:t},Hs=p(_ge);function or(e,t,n){return(t=function(i){var a=function(l,u){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var m=h.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LF(Object(n),!0).forEach(function(i){or(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function jS(e,t){return jS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},jS(e,t)}function _N(){_N=function(a,l){return new n(a,void 0,l)};var e=RegExp.prototype,t=new WeakMap;function n(a,l,u){var h=RegExp(a,l);return t.set(h,u||t.get(a)),jS(h,n.prototype)}function i(a,l){var u,h=t.get(l);return ka(u=Object.keys(h)).call(u,function(m,g){var _=h[g];if(typeof _=="number")m[g]=a[_];else{for(var v=0;a[_[v]]===void 0&&v+1<_.length;)v++;m[g]=a[_[v]]}return m},Object.create(null))}return function(a,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(l&&l.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),l&&jS(a,l)}(n,RegExp),n.prototype.exec=function(a){var l=e.exec.call(this,a);if(l){l.groups=i(l,this);var u=l.indices;u&&(u.groups=i(u,this))}return l},n.prototype[Symbol.replace]=function(a,l){if(typeof l=="string"){var u=t.get(this);return e[Symbol.replace].call(this,a,l.replace(/\$<([^>]+)(>|$)/g,function(m,g,_){if(_==="")return m;var v=u[g];return Array.isArray(v)?"$"+v.join("$"):typeof v=="number"?"$"+v:""}))}if(typeof l=="function"){var h=this;return e[Symbol.replace].call(this,a,function(){var m=arguments;return typeof m[m.length-1]!="object"&&(m=[].slice.call(m)).push(i(m,h)),l.apply(this,m)})}return e[Symbol.replace].call(this,a,l)},_N.apply(this,arguments)}const jF=new class extends Yn{constructor(){super(...arguments),or(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Ege{constructor(t){or(this,"logger",void 0),or(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function EN(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function MF(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Ma={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},MS=Date.now(),R_=e=>{for(const t in Ma)if(Object.prototype.hasOwnProperty.call(Ma,t)&&Ma[t]===e)return t;return"DEFAULT"},w=new class{constructor(){or(this,"proxyServerURL",void 0),or(this,"logLevel",Ma.DEBUG),or(this,"uploadState","collecting"),or(this,"uploadLogWaitingList",[]),or(this,"uploadLogUploadingList",[]),or(this,"uploadErrorCount",0),or(this,"currentLogID",0),or(this,"url",void 0),or(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ma.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ma.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ma.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ma.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ma.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){hn("UPLOAD_LOG",!0)}disableLogUpload(){hn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Ege(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-MS<100)return void setTimeout(()=>{this.log(...t)},Date.now()-MS);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=EN()+" Agora-SDK [".concat(R_(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const a=EN()+" %cAgora-SDK [".concat(R_(i),"]:");let l=[];if(!j("USE_NEW_LOG"))switch(i){case Ma.DEBUG:l=[a,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case Ma.INFO:l=[a,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case Ma.WARNING:l=[a,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case Ma.ERROR:l=[a,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-MS<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-MS);const i=Math.max(0,Math.min(4,t[0]));t[0]=EN()+" Agora-SDK [".concat(R_(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!j("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=MF()+" Agora-SDK [".concat(R_(e),"]:"):n[0]=MF()+" Agora-SDK [".concat(R_(e),"]:");let a="";n.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),a+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:a,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:ja,process_id:j("PROCESS_ID"),payload:JSON.stringify(e)};return Qo(async()=>{const n=await yi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(j("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(j("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:e.map(a=>a.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),jF.reportLogUploadError(i),!0},{timeout:j("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:j("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,j("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var UF;function vge(e){return Es(e.reportId,"params.reportId",0,100,!1),Es(e.category,"params.category",0,100,!1),Es(e.event,"params.event",0,100,!1),Es(e.label,"params.label",0,100,!1),fn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(UF={}).FREE="free",UF.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const yge={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Mr=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Fn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Sge=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function st(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const a=i.value;if(typeof a=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var u,h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];let _=m;if(e.argsMap)try{_=e.argsMap(this,...m)}catch(S){w.warning(S),_=[]}try{JSON.stringify(_)}catch{w.warning("arguments for method ".concat(l,".").concat(String(n)," not serializable for apiInvoke.")),_=[]}const v=(e.report||Be).reportApiInvoke(this._sessionId||null,{id:this._clientId||((u=this.store)===null||u===void 0?void 0:u.clientId)||this._ID,name:"".concat(l,".").concat(String(n)),options:_,tag:gn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const S=a.apply(this,m);return S instanceof Ne?S.then(T=>(v.onSuccess(e.reportResult&&T),T)).catch(T=>{throw v.onError(T),T}):(v.onSuccess(e.reportResult&&S),S)}catch(S){throw v.onError(S),S}}}return i}}const Be=new class{constructor(){or(this,"baseInfoMap",new Map),or(this,"proxyServer",void 0),or(this,"eventUploadTimer",void 0),or(this,"setSessionIdTimer",void 0),or(this,"url",void 0),or(this,"sids",new Set),or(this,"backupUrl",void 0),or(this,"_appId",void 0),or(this,"_aid",0),or(this,"keyEventUploadPendingItems",[]),or(this,"normalEventUploadPendingItems",[]),or(this,"apiInvokeUploadPendingItems",[]),or(this,"apiInvokeCount",0),or(this,"apiInvokeLoggedCount",0),or(this,"ltsList",[]),or(this,"lastSendNormalEventTime",Date.now()),or(this,"customReportCounterTimer",void 0),or(this,"customReportCount",0),or(this,"extApiInvoke",async e=>{for(const t of e){const n=Tt(Tt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:gn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),j("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),j("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,i]=t;return n+i}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,l=!!j("SHOW_REPORT_INVOKER_LOG"),u=!!j("SHOW_REPORT_USER_INVOKER_LOG"),h=l||u&&t.id;h&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function g(T,P){if(h){let x="[apiInvoke-".concat(m,"]");if(t.id&&(x+="[".concat(t.id,"]")),t.name&&(x+="[".concat(t.name,"]"),t.name===Vn.JOIN))return w.info("".concat(x," ").concat(T));w.info("".concat(x," ").concat(T),T==="start"?t.options:P||"")}}const _=()=>({tag:t.tag,invokeId:a,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});g("start");let v=!1;qr(t.timeout).then(()=>{v||(this.sendApiInvoke(Tt(Tt({},_()),{},{error:U.API_INVOKE_TIMEOUT,success:!1})),g("timeout"))});const S=new ae(U.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:T=>{const P=()=>{if(v)throw S;return v=!0,this.sendApiInvoke(Tt(Tt({},_()),{},{success:!0},t.reportResult&&{result:T})),g("onSuccess"),T};return n?EF(P,t.name+"Success",n,()=>v=!0):P()},onError:T=>{const P=()=>{if(v)throw T;v=!0,this.sendApiInvoke(Tt(Tt({},_()),{},{success:!1,error:T})),g("onFailure",T.toString())};return n?EF(P,t.name+"Error",n,()=>v=!0):P()}}}_send(e,t,n){this.send({type:e,data:t},n)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname,i.rteUrl=t.rteUrl;const a=Object.assign({},{willUploadConsoleLog:j("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:hN?"global":"oversea",areas:j("AREAS")&&j("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:u,channelMode:h,isABTestSuccess:m,lsid:g,clientRole:_}=t,v=Date.now(),S=Tt(Tt({},i),{},{eventType:Mr.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:mN,lts:v,elapse:v-n,extend:JSON.stringify(a),mode:t.mode,process:j("PROCESS_ID"),appType:j("APP_TYPE"),success:!0,version:ja,stringUid:l,channelProfile:u,channelMode:h,isABTestSuccess:m,lsid:g,clientType:Ee(T=window.navigator.userAgent).call(T,"AgoraWebView")?42:20,clientRole:_,serviceId:j("PROCESS_ID"),extensionID:j("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var T;this.send({type:Fn.SESSION,data:S},!0)}reportRteDetail(e){const t=this.baseInfoMap.get(e);if(!t)return;const n=t.info,i=Date.now(),a=Tt(Tt({},n),{},{eventType:Mr.RTE_DETAIL,lts:i,success:!0,elapse:i-t.startTime,vid:n.vid===void 0?0:Number(n.vid),ua:navigator.userAgent});this.send({type:Fn.RTE_DETAIL,data:a},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid);const a=Date.now(),l=Tt(Tt({},i),{},{role:t.role,eventType:Mr.JOIN_CHOOSE_SERVER,lts:a,eventElapse:t.elapse||a-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:a-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:Fn.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt({},i),{},{eventType:Mr.REQ_USER_ACCOUNT,lts:a,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||a-n.startTime,eventElapse:a-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Fn.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const a=Date.now(),{firstSuccess:l,addr:u,isProxy:h}=t,m=a-n.startTime,g=Tt(Tt({},i),{},{eventType:Mr.JOIN_GATEWAY,lts:a,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:m,eventElapse:a-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:uN(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:h?1:0}),_=g.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=a),u)if(g.signalChannel==="1"){const v=_N(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),S=u.match(v);g.gatewayIp=S&&S.groups?S.groups.ip:"",g.gatewayPort=S&&S.groups?S.groups.port:""}else if(h){const v=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),S=u.match(/p=[0-9]{1,6}/g);g.gatewayIp=v&&v.length?v[0].split("=")[1].replace(/-/g,"."):"",g.gatewayPort=S&&S.length?S[0].split("=")[1]:""}else{const v=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),S=u.match(/(:|p=)[0-9]{1,6}/g);g.gatewayIp=v&&v.length?v[0].split("//")[1].replace(/-/g,"."):"",g.gatewayPort=S&&S.length?S[0].split(/:|p=/g)[1]:""}if(l)this.send({type:Fn.JOIN_GATEWAY,data:g},!0);else{let v={isSuccess:_,port:g.gatewayPort};delete g.success,delete g.eventType,delete g.firstSuccess,delete g.gatewayPort,g.vid=Number(g.vid);const S=Object.assign({},g,v,{eventType:Mr.REJOIN_GATEWAY});this.send({type:Fn.RE_JOIN_GATEWAY,data:S},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),a=Tt(Tt({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:Fn.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt({},i),{},{eventType:Mr.PUBLISH,lts:a,eventElapse:t.eventElapse,elapse:a-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Fn.PUBLISH,data:l},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const a=i.info,l=Date.now(),u=Tt(Tt({},a),{},{eventType:Mr.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?u.peerSuid=t.peerid:u.peer=t.peerid,this.send({type:Fn.SUBSCRIBE,data:u},!0)}wsCompressorInit(e){var t;const n=[...Hs(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",a=this.baseInfoMap.get(i);if(!a)return;const l=a.info,u=Date.now(),h=Tt(Tt({},l),{},{eventType:Mr.WS_COMPRESSOR_INIT,lts:u,eventElapse:e.eventElapse,elapse:u-a.startTime,status:e.status?1:2});this.send({type:Fn.WS_COMPRESSOR_INIT,data:h},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=t.peerPubStatusMs-(n.lastJoinSuccessTime||a),u=Tt(Tt({},i),{},{elapse:a-n.startTime,eventType:Mr.XLA_PEER_FIRST_VIDEO_FRAME,lts:a,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:l,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>l?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:Fn.XLA_PEER_FIRST_VIDEO_FRAME,data:u},!0)}firstRemoteVideoDecode(e,t,n,i){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,u=Date.now(),h=Tt(Tt(Tt({},l),i),{},{elapse:u-a.startTime,eventType:t,lts:u,firstDecodeFrame:Math.max((i.firstFrame||u)-a.startTime,0),apEnd:Math.max(i.apEnd-a.startTime,0),apStart:Math.max(i.apStart-a.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-a.startTime,0),joinGwStart:Math.max(i.joinGwStart-a.startTime,0),pcEnd:Math.max(i.pcEnd-a.startTime,0),pcStart:Math.max(i.pcStart-a.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-a.startTime,0),subscriberStart:Math.max(i.subscriberStart-a.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-a.startTime,0)});this.send({type:n,data:h},!0)}firstRemoteFrame(e,t,n,i){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,u=Date.now(),h=Tt(Tt(Tt({},l),i),{},{elapse:u-a.startTime,eventType:t,lts:u});this.send({type:n,data:h},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt(Tt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:a-n.startTime,eventType:Mr.AB_TEST,lts:a});this.send({type:Fn.AB_TEST,data:l},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt(Tt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:a-n.startTime,eventType:Mr.PC_STATS,lts:a,preallocation:t.preallocation?1:0});this.send({type:Fn.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt(Tt({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Mr.UPDATE_REMOTE_RTPCAPABILITIES,lts:a});this.send({type:Fn.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,n,i){const a=this.baseInfoMap.get(e);if(!a)return;const l=a.info,u=Date.now(),h=Tt(Tt(Tt({},l),i),{},{eventType:t,lts:u});this.send({type:n,data:h},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt({},i),{},{eventType:Mr.STREAM_SWITCH,lts:a,isDual:t.isdual,elapse:a-n.startTime,success:t.succ});this.send({type:Fn.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt({},i),{},{eventType:Mr.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-t.lts,elapse:a-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Fn.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt({},i),{},{eventType:Mr.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-t.lts,elapse:a-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Fn.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?w.debug("reportProxyServerurl: ".concat(e)):w.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:a,elapse:a-n.startTime,joinChannelSuccessElapse:a-(n.lastJoinSuccessTime||a),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Fn.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now();(function(l,u,h){const m=l[u];if(!m||typeof m!="string")return[l];l[u]="";const g=Kc(JSON.stringify(l));let _=0;const v=[];let S=0;for(let T=0;T<m.length;T++)S+=m.charCodeAt(T)<=127?1:3,S<=h-g||(v[v.length]=Se(Se({},l),{},{[u]:m.substring(_,T)}),_=T,S=m.charCodeAt(T)<=127?1:3);return _!==m.length-1&&(v[v.length]=Se(Se({},l),{},{[u]:m.substring(_)})),v})(Tt(Tt(Tt({},i),t),{},{elapse:a-n.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:Fn.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt(Tt({},i),t),{},{elapse:a-n.startTime,lts:a});this.send({type:Fn.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt(Tt({},i),t),{},{elapse:a-n.startTime,lts:a,extend:t.extend||void 0});this.send({type:Fn.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,a=Date.now(),l=Tt(Tt(Tt({},i),t),{},{elapse:a-n.startTime,lts:a});this.send({type:Fn.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>j("CUSTOM_REPORT_LIMIT"))throw new ae(U.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(a=>({type:Fn.USER_ANALYTICS,data:Tt(Tt({sid:e},a),{},{lts:n})}));try{j("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(a){throw w.error("send custom report message failed",a.toString()),new ae(U.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(e){const t=j("NOT_REPORT_EVENT");if(e.tag&&Ee(t)&&Ee(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:a,cid:l}=n.info;let u;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ae){const{code:m,message:g}=e.error;u=m||g||e.error.toString()}else u=e.error.toString();const h={invokeId:e.invokeId,sid:e.sid,cname:i,cid:l,uid:a,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?u:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Fn.API_INVOKE,data:h},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const l=e.shift();n.length<20?n.push(l):i.push(l)}e.push(...i);for(const l of[...n]){var a;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),Ju(a=this.ltsList).call(a,(u,h)=>u-h))}return t||(this.lastSendNormalEventTime=Date.now()),j("ENABLE_EVENT_REPORT")&&n.length&&(j("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((l=>u=>{j("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-j("NORMAL_EVENT_QUEUE_CAPACITY")),w.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){ar.networkState===ci.OFFLINE&&await Ne.race([ar.onlineWaiter,qr(2*Cr.maxRetryTimeout)]);const t=a=>{let l=new Uint8Array;return a.forEach(u=>{const h=Jx(JSON.stringify(u.data)),m=new ArrayBuffer(5),g=(v=>{let S=0;return Object.entries(Fn).forEach(T=>{let[P,x]=T;x===v.type&&(S=Sge[P])}),S})(u),_=new DataView(m);_.setUint16(0,h.byteLength,!0),_.setUint8(2,255&g),_.setUint8(3,g>>>8&255),_.setUint8(4,g>>>16&255),l=cF(l,new Uint8Array(m)),l=cF(l,h)}),l},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let a=0;a<2;a+=1){a===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await oN(i,{timeout:1e4,data:t(e),headers:Tt(Tt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(a===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(h=>{const m=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return m&&m.info.vid&&+m.info.vid||0})(e[0]),i=n?void 0:this._aid,a={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(h=>JSON.stringify(h)),vid:n,aid:i};ar.networkState===ci.OFFLINE&&await Ne.race([ar.onlineWaiter,qr(2*Cr.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let u=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(j("EVENT_REPORT_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(l));for(let h=0;h<2;h+=1){h===1&&(u=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(j("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(l)));try{t?await age(u,{timeout:1e4,data:a}):await oN(u,{timeout:1e4,data:a})}catch(m){if(h===1)throw m;continue}return}}createBaseInfo(e,t){const n=Object.assign({},yge);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:gn.TRACER}).onSuccess()}};jF.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ar.networkState,Be.reportApiInvoke(null,{name:"logUploadError",options:e,tag:gn.TRACER}).onSuccess("logUploadError")});let re=class extends ae{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),or(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,w)}throw(){super.throw(w)}};const Yr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function jt(){return Yr}function VF(){return"setSinkId"in HTMLAudioElement.prototype&&(!j("RESTRICTION_SET_PLAYBACK_DEVICE")||(jl()||qV())&&!nF())}function US(){return!Yr.supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&Hc()}function x_(e){return!(An()||YV(87)||US()||!j("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||j("FORCE_DISABLE_AUTO_SUB")))}function FF(e){return j("ENABLE_INSTANT_VIDEO")?j("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||j("FORCE_DISABLE_AUTO_SUB"))}function BF(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function GF(){if(BF()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return Wc(141)||ah(141)||oh(141)}function WF(){if(BF()){const e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return Wc(141)||ah(141)||oh(125)}let vs=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function xm(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Yt(e,t,n,i,a){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:a}}function Eo(e,t,n,i,a){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:a}}function vN(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Tge={"90p":Yt(160,90),"90p_1":Yt(160,90),"120p":Yt(160,120,15,30,65),"120p_1":Yt(160,120,15,30,65),"120p_3":Yt(120,120,15,30,50),"120p_4":Yt(212,120),"180p":Yt(320,180,15,30,140),"180p_1":Yt(320,180,15,30,140),"180p_3":Yt(180,180,15,30,100),"180p_4":Yt(240,180,15,30,120),"240p":Yt(320,240,15,40,200),"240p_1":Yt(320,240,15,40,200),"240p_3":Yt(240,240,15,40,140),"240p_4":Yt(424,240,15,40,220),"360p":Yt(640,360,15,80,400),"360p_1":Yt(640,360,15,80,400),"360p_3":Yt(360,360,15,80,260),"360p_4":Yt(640,360,30,80,600),"360p_6":Yt(360,360,30,80,400),"360p_7":Yt(480,360,15,80,320),"360p_8":Yt(480,360,30,80,490),"360p_9":Yt(640,360,15,80,800),"360p_10":Yt(640,360,24,80,800),"360p_11":Yt(640,360,24,80,1e3),"480p":Yt(640,480,15,100,500),"480p_1":Yt(640,480,15,100,500),"480p_2":Yt(640,480,30,100,1e3),"480p_3":Yt(480,480,15,100,400),"480p_4":Yt(640,480,30,100,750),"480p_6":Yt(480,480,30,100,600),"480p_8":Yt(848,480,15,100,610),"480p_9":Yt(848,480,30,100,930),"480p_10":Yt(640,480,10,100,400),"720p":Yt(1280,720,15,120,1130),"720p_auto":Yt(1280,720,30,900,3e3),"720p_1":Yt(1280,720,15,120,1130),"720p_2":Yt(1280,720,30,120,2e3),"720p_3":Yt(1280,720,30,120,1710),"720p_5":Yt(960,720,15,120,910),"720p_6":Yt(960,720,30,120,1380),"1080p":Yt(1920,1080,15,120,2080),"1080p_1":Yt(1920,1080,15,120,2080),"1080p_2":Yt(1920,1080,30,120,3e3),"1080p_3":Yt(1920,1080,30,120,3150),"1080p_5":Yt(1920,1080,60,120,4780),"1440p":Yt(2560,1440,30,120,4850),"1440p_1":Yt(2560,1440,30,120,4850),"1440p_2":Yt(2560,1440,60,120,7350),"4k":Yt(3840,2160,30,120,8910),"4k_1":Yt(3840,2160,30,120,8910),"4k_3":Yt(3840,2160,60,120,13500)},bge={"480p":Eo(640,480,5),"480p_1":Eo(640,480,5),"480p_2":Eo(640,480,30),"480p_3":Eo(640,480,15),"720p":Eo(1280,720,5),"720p_auto":Yt(1280,720,30,900,3e3),"720p_1":Eo(1280,720,5),"720p_2":Eo(1280,720,30),"720p_3":Eo(1280,720,15),"1080p":Eo(1920,1080,5),"1080p_1":Eo(1920,1080,5),"1080p_2":Eo(1920,1080,30),"1080p_3":Eo(1920,1080,15)},wge={"1SL1TL":vN(1,1),"3SL3TL":vN(3,3),"2SL3TL":vN(2,3)};function vo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Tge[e]):e}function yN(e){return typeof e=="string"?Object.assign({},bge[e]):e}function VS(e){return typeof e=="string"?Object.assign({},wge[e]):e}const Cge={speech_low_quality:xm(16e3,!1),speech_standard:xm(32e3,!1,18),music_standard:xm(48e3,!1),standard_stereo:xm(48e3,!0,56),high_quality:xm(48e3,!1,128),high_quality_stereo:xm(48e3,!0,192)};function FS(e){return typeof e=="string"?Object.assign({},Cge[e]):e}const gh=[];function HF(e){return wr(e,"mediaSource",["screen","window","application"]),!0}let Ge=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),sn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Nm=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Rge=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),xge=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),_h=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Im=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Ua=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Am=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),ga=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const SN={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},TN={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},KF={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Nge={uplinkNetworkQuality:0,downlinkNetworkQuality:0},zF={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let di=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),_a=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),N_=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Eh=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Ds=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),zc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const bN={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let BS=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Gt(e,t,n,i,a){var l,u,h={};return Object.keys(i).forEach(function(m){h[m]=i[m]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=ka(l=yk(u=n.slice()).call(u)).call(l,function(m,g){return g(e,t,m)||m},h),a&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(a):void 0,h.initializer=void 0),h.initializer===void 0?(Object.defineProperty(e,t,h),null):h}function ie(e,t,n){return(t=function(i){var a=function(l,u){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var m=h.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(i);return typeof a=="symbol"?a:a+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Rn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qF(Object(n),!0).forEach(function(i){ie(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class YF extends Yn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(_h.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),ie(this,"trackMediaType",void 0),ie(this,"_ID",void 0),ie(this,"_rtpTransceiver",void 0),ie(this,"_lowRtpTransceiver",void 0),ie(this,"_hints",[]),ie(this,"_isClosed",!1),ie(this,"_originMediaStreamTrack",void 0),ie(this,"mediaStreamTrack",void 0),ie(this,"_external",{}),this._ID=n||on(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(i){Ee(gh).call(gh,i)||gh.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Pd(()=>{var n;Be.reportApiInvoke(null,{name:Vn.GET_MEDIA_STREAM_TRACK,options:[],tag:gn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Nm.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=gh.indexOf(t);n!==-1&&gh.splice(n,1)}(this),this.emit(Im.CLOSED),this.removeAllListeners(_h.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===Nm.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(_h.TRANSCEIVER_UPDATED,t,n)}}class Om extends YF{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),ie(this,"_enabled",!0),ie(this,"_muted",!1),ie(this,"_isExternalTrack",!1),ie(this,"_isClosed",!1),ie(this,"_enabledMutex",void 0),ie(this,"processor",void 0),ie(this,"_processorContext",void 0),ie(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new is("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,w.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ge.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Sn(this,Ge.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Im.TRACK_ENDED)}stateCheck(t,n){if(w.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),fo(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new ae(U.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",w);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new ae(U.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",w)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Ne.resolve([])}}const XF=window.AudioContext||window.webkitAudioContext;let wN,Ea=null;const pn=new class extends Yn{constructor(){super(...arguments),ie(this,"prevState",void 0),ie(this,"curState",void 0),ie(this,"currentTime",void 0),ie(this,"currentTimeStuckAt",void 0),ie(this,"interruptDetectorTrack",void 0),ie(this,"onLocalAudioTrackMute",()=>{w.info("ios15-interruption-start"),this.emit(vs.IOS_15_16_INTERRUPTION_START)}),ie(this,"onLocalAudioTrackUnmute",async()=>{w.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?w.info("ios15-interruption-end-canceled"):(Ea&&await Ea.suspend(),this.emit(vs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){w.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){w.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Pm(){if(!Ea){if(function(){if(!XF)return void w.error("your browser is not support web audio");w.info("create audio context");const e=Rn({},j("WEBAUDIO_INIT_OPTIONS"));w.debug("audio context init option:",JSON.stringify(e)),Ea=new XF(e),pn.curState=Ea.state,Ea.onstatechange=()=>{pn.prevState=pn.curState,pn.curState=Ea?Ea.state:void 0;const{prevState:t,curState:n}=pn,i=n==="running",a=n==="interrupted",l=t==="running",u=t==="suspended",h=t==="interrupted",m=qt().osVersion;(Ws()||mo())&&l&&a&&(w.info("ios".concat(m,"-interruption-start")),pn.emit(vs.IOS_INTERRUPTION_START)),(Ws()||mo())&&(u||h)&&i&&(w.info("ios".concat(m,"-interruption-end")),pn.emit(vs.IOS_INTERRUPTION_END)),t!==n&&pn.emit(vs.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Ea)===null||t===void 0?void 0:t.currentTime;pn.currentTime!==n?(pn.currentTimeStuckAt&&(w.debug("AudioContext current time resume at ".concat(n)),pn.currentTimeStuckAt=void 0),pn.currentTime=n):(n!==pn.currentTimeStuckAt&&(Be.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:gn.TRACER}).onSuccess(),w.warning("AudioContext current time stuck at ".concat(n))),pn.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,a,l=!1,u=!1,h=!1;function m(M){t.state==="running"?g(!1):Ws()||mo()?t.state==="suspended"&&(g(!0),M&&t.resume().then(_,_)):t.state!=="closed"&&(g(!0),M&&t.resume().then(_,_))}function g(M){if(l!==M){l=M;for(let F=0,q=n;F<q.length;F+=1){const J=q[F];M?window.addEventListener(J,v,{capture:!0,passive:!0}):window.removeEventListener(J,v,{capture:!0,passive:!0})}}}function _(){m(!1)}function v(){m(!0)}function S(){let M;try{M=i.play(),M?M.then(x,x):(i.addEventListener("playing",x),i.addEventListener("abort",x),i.addEventListener("error",x))}catch{x()}}function T(M){h||(i.paused?M?(P(!1),h=!0,S()):P(!0):P(!1))}function P(M){if(u!==M){u=M;for(let F=0,q=n;F<q.length;F++){const J=q[F];M?window.addEventListener(J,N,{capture:!0,passive:!0}):window.removeEventListener(J,N,{capture:!0,passive:!0})}}}function x(){i.removeEventListener("playing",x),i.removeEventListener("abort",x),i.removeEventListener("error",x),h=!1,T(!1)}function N(){T(!0)}if(Ws()&&j("IOS_BG_TAG")){const M=t.createMediaStreamDestination(),F=document.createElement("div");F.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=F.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=M.stream,a=()=>{if(j("IOS_AUTO_RESTART_BG_TAG")&&i&&i.srcObject&&!h&&(!i.paused||u!==!0)){i.paused||i.pause();try{h=!0,S()}catch{h=!1}return!0}},T(!0)}return pn.on(vs.STATE_CHANGE,function(){m(!0)}),m(!1),a}(Ea).then(t=>{wN=t})}(),!Ea)throw new ae(U.NOT_SUPPORTED,"can not create audio context");return Ea}return Ea}function vh(e){if(function(){if(CN!==null)return CN;const i=Pm(),a=i.createBufferSource(),l=i.createGain(),u=i.createGain();a.connect(l),a.connect(u),a.disconnect(l);let h=!1;try{a.disconnect(l)}catch{h=!0}return a.disconnect(),CN=h,h}())return;const t=e.connect,n=e.disconnect;e.connect=(i,a,l)=>{var u;return e._inputNodes||(e._inputNodes=[]),Ee(u=e._inputNodes).call(u,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,a,l)):t.call(e,i,a)),e},e.disconnect=(i,a,l)=>{n.call(e),i?NS(e._inputNodes,i):e._inputNodes=[];for(const u of e._inputNodes)t.call(e,u)}}let CN=null;function RN(e,t){let n=!1;const i=1/t;if(j("DISABLE_WEBAUDIO")){const a=window.setInterval(()=>{n?window.clearInterval(a):e(performance.now()/1e3)},1e3*i)}else{const a=Pm();let l=a.createGain();l.gain.value=0,l.connect(a.destination);const u=()=>{if(n)return void(l=null);const h=a.createOscillator();h.onended=u,h.connect(l),h.start(0),h.stop(a.currentTime+i),e(a.currentTime)};u()}return()=>{n=!0}}class QF{constructor(){ie(this,"context",void 0),ie(this,"analyserNode",void 0),ie(this,"sourceNode",void 0),this.context=Pm(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ws()||mo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let a=0;a<t.length;++a)t[a]=i[a]/128-1}const n=ka(t).call(t,(i,a)=>i+a*a,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{w.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class JF extends Yn{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ie(this,"outputNode",void 0),ie(this,"outputTrack",void 0),ie(this,"isPlayed",!1),ie(this,"sourceNode",void 0),ie(this,"context",void 0),ie(this,"audioBufferNode",void 0),ie(this,"destNode",void 0),ie(this,"audioOutputLevel",0),ie(this,"volumeLevelAnalyser",void 0),ie(this,"_processedNode",void 0),ie(this,"playNode",void 0),ie(this,"isDestroyed",!1),ie(this,"onNoAudioInput",void 0),ie(this,"isNoAudioInput",!1),ie(this,"_noAudioInputCount",0),this.context=Pm(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),vh(this.outputNode),this.volumeLevelAnalyser=new QF}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(ga.ON_AUDIO_BUFFER,function(i){for(let a=0;a<i.outputBuffer.numberOfChannels;a+=1){const l=i.outputBuffer.getChannelData(a);for(let u=0;u<l.length;u+=1)l[u]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!jt().webAudioMediaStreamDest)throw new ae(U.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&IS(()=>{pn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ws()||mo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let a=!1;for(let l=0;l<i.length;l++)i[l]!==0&&(a=!0);return a?(this.isNoAudioInput=!1,!0):(await qr(200),await this.checkHasAudioInput(t?t+1:1)&&a)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class xN extends JF{get isFreeze(){return!1}constructor(t,n,i){var a;if(super(),ie(this,"sourceNode",void 0),ie(this,"track",void 0),ie(this,"clonedTrack",void 0),ie(this,"audioElement",void 0),ie(this,"isCurrentTrackCloned",!1),ie(this,"isRemoteTrack",!1),ie(this,"originVolumeLevelAnalyser",void 0),ie(this,"rebuildWebAudio",async()=>{if(w.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void w.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>w.info("resume success")),w.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const h=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?h.stop():this.isCurrentTrackCloned=!0;const m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),vh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const g=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(g,this.context.currentTime),vh(this.outputNode),this.emit(ga.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new ae(U.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(l),vh(this.sourceNode),i){const h=i.clone();h.enabled=!0,this.clonedTrack=h,w.debug("create an unmuted track ".concat(h.id," from the original track ").concat(i.id," to get the volume"));const m=this.context.createMediaStreamSource(new MediaStream([h]));vh(m),this.originVolumeLevelAnalyser=new QF,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const u=qt();n&&u.os===zr.IOS&&Number((a=u.osVersion)===null||a===void 0?void 0:a.split(".")[0])<15&&(pn.on(vs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(h=>{h||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),vh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ga.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),pn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),w.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));vh(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function $F(e,t,n){const i=(l,u)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||u:l:u,a={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(a.video.mandatory.maxFrameRate=t.frameRate.max,a.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(a.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(a)}async function Ige(e,t){const n=await ZF(e.mediaSource),{sourceId:i,audio:a}=await function(l){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Ne((h,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const v=document.createElement("div");v.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",v.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const P=document.createElement("button");P.innerHTML="cancel",P.setAttribute("style","width: 85px;"),P.onclick=()=>{document.body.removeChild(M);const F=new Error("NotAllowedError");F.name="NotAllowedError",m(F)};let x=u;const N=document.createElement("div");if(u){const F=document.createElement("input");F.setAttribute("type","checkbox");const q=document.createElement("span");F.setAttribute("style","margin-right: 6px;"),q.innerText="Share audio",F.checked=x,F.onchange=()=>{x=F.checked},N.appendChild(F),N.appendChild(q)}T.appendChild(N),T.appendChild(P),_.appendChild(v),_.appendChild(S),_.appendChild(T);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(g),M.appendChild(_),document.body.appendChild(M),l.map(F=>{if(F.id){const q=document.createElement("div");q.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let J=F.thumbnail;try{const{width:te}=J.getSize();te>1920&&(J=J.resize({width:1920}))}catch(te){throw te&&te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),te}q.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+J.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+F.name.replace(/[\u00A0-\u9999<>\&]/g,function(te){return"&#"+te.charCodeAt(0)+";"})+"</span>",q.onclick=()=>{document.body.removeChild(M),h({sourceId:F.id,audio:x})},S.appendChild(q)}})})}(n,t);return await $F(i,e,a)}async function ZF(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=lF();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ae(U.ELECTRON_IS_NULL);let i=null;try{var a;i=((a=n.desktopCapturer)===null||a===void 0?void 0:a.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new Ne((l,u)=>{n.desktopCapturer.getSources({types:t},(h,m)=>{h?u(h):l(m)})}));try{return await i}catch(l){throw new ae(U.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const NN=new is("safari");let e4=!1,t4=!1;async function va(e,t){let n=0,i=null;for(;n<2;)try{i=await Age(e,t,n>0);break}catch(a){if(a instanceof ae)throw w.error("[".concat(t,"] ").concat(a.toString())),a;const l=GS(a.name||a.code||a,a.message);if(l.code===U.MEDIA_OPTION_INVALID){w.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await qr(500);continue}throw w.error("[".concat(t,"] ").concat(l.toString())),l}if(!i)throw new ae(U.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function Age(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ae(U.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=jt(),a=new MediaStream;if(e.audioSource&&a.addTrack(e.audioSource),e.videoSource&&a.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return w.debug("Using Video Source/ Audio Source"),a;if(e.screen)if(lF())e.screen.sourceId?Dm(a,await $F(e.screen.sourceId,e.screen,!!e.screenAudio)):Dm(a,await Ige(e.screen,!!e.screenAudio));else if(jl()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new ae(U.NOT_SUPPORTED,"This browser does not support screen sharing");w.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const S=await(u=e.screen.extensionId,h=t,new Ne((T,P)=>{try{chrome.runtime.sendMessage(u,{getStream:!0},x=>{if(!x||!x.streamId)return w.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),x),void P(new ae(U.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(x.streamId)})}catch(x){w.error("[".concat(h,"] AgoraRTC screensharing plugin is not accessible(").concat(u,")"),x.toString()),P(new ae(U.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=S,Dm(a,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var l;e.screen.mediaSource&&HF(e.screen.mediaSource);const S={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:P,systemAudio:x,preferCurrentTab:N,windowAudio:M,monitorTypeSurfaces:F}=e.screen,q={selfBrowserSurface:T,surfaceSwitching:P,systemAudio:x,preferCurrentTab:N,windowAudio:M,monitorTypeSurfaces:F};!T&&delete q.selfBrowserSurface,!P&&delete q.surfaceSwitching,!x&&delete q.systemAudio,!N&&delete q.preferCurrentTab,!M&&delete q.windowAudio,!F&&delete q.monitorTypeSurfaces,w.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:S,audio:e.screenAudio,controls:q})),Dm(a,await navigator.mediaDevices.getDisplayMedia(Rn({video:S,audio:e.screenAudio},q)))}else{if(!An())throw w.error("[".concat(t,"] This browser does not support screenSharing")),new ae(U.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&HF(e.screen.mediaSource);const S={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};w.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(S))),Dm(a,await navigator.mediaDevices.getUserMedia(S))}}var u,h;if(!e.video&&!e.audio)return a;let m={video:e.video,audio:e.audio},g=j("MEDIA_DEVICE_CONSTRAINTS");if(g)try{typeof g=="string"&&(g=JSON.parse(g)),m=nN(m,g)}catch{}w.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),qt();let _,v=null;(ss()||Ws()||xS())&&(v=await NN.lock());try{_=await navigator.mediaDevices.getUserMedia(m)}catch(S){throw v&&v(),S}return m.audio&&(e4=!0),m.video&&(t4=!0),Dm(a,_),v&&v(),a}function GS(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ae(U.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new ae(U.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new ae(U.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new ae(U.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ae(U.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new ae(U.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return w.error("getUserMedia unexpected error",e),new ae(U.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Dm(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],a=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(i&&e.removeTrack(i),e.addTrack(l)),a&&(n&&e.removeTrack(n),e.addTrack(a))}const ya=new class extends Yn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Eh.STATE_CHANGE,e),this._state=e)}constructor(){super(),ie(this,"_state",N_.IDLE),ie(this,"isAccessMicrophonePermission",!1),ie(this,"isAccessCameraPermission",!1),ie(this,"lastAccessMicrophonePermission",!1),ie(this,"lastAccessCameraPermission",!1),ie(this,"checkdeviceMatched",!1),ie(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(j("ENUMERATE_DEVICES_INTERVAL")||(v_()||RS()===zr.HARMONY_OS)&&Hc())&&this.updateDevicesInfo()},j("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>w.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new ae(U.NOT_SUPPORTED,"enumerateDevices() not supported.");const i=await navigator.mediaDevices.enumerateDevices(),a=this.checkMediaDeviceInfoIsOk(i);let l=!this.isAccessMicrophonePermission&&e,u=!this.isAccessCameraPermission&&t;a.audio&&(l=!1),a.video&&(u=!1);let h=null,m=null,g=null;if(!n&&(l||u)){if(NN.isLocked&&(w.debug("[device manager] wait GUM lock"),(await NN.lock())(),w.debug("[device manager] GUM unlock")),e4&&(l=!1,this.isAccessMicrophonePermission=!0),t4&&(u=!1,this.isAccessCameraPermission=!0),w.debug("[device manager] check media device permissions",e,t,l,u),l&&u){try{g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const v=GS(_.name||_.code||_,_.message);if(v.code===U.PERMISSION_DENIED)throw v;w.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({audio:e})}catch(_){const v=GS(_.name||_.code||_,_.message);if(v.code===U.PERMISSION_DENIED)throw v;w.warning("getUserMedia failed in getDevices",v)}this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(_){const v=GS(_.name||_.code||_,_.message);if(v.code===U.PERMISSION_DENIED)throw v;w.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0}w.debug("[device manager] mic permission",e,"cam permission",t)}try{const _=await navigator.mediaDevices.enumerateDevices();return h&&h.getTracks().forEach(v=>v.stop()),m&&m.getTracks().forEach(v=>v.stop()),g&&g.getTracks().forEach(v=>v.stop()),h=null,m=null,g=null,_}catch(_){return h&&h.getTracks().forEach(v=>v.stop()),m&&m.getTracks().forEach(v=>v.stop()),g&&g.getTracks().forEach(v=>v.stop()),h=null,m=null,g=null,new ae(U.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new ae(U.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=N_.INITING;try{await this.updateDevicesInfo(),this.state=N_.INITEND}catch(e){throw this.state=N_.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(w.warning("Device Detection functionality cannot start properly.",e.toString()),e):new ae(U.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const a=e.find(u=>u.kind==="audioinput"&&u.deviceId==="default"),l=e.find(u=>u.kind==="audiooutput"&&u.deviceId==="default");a&&l?l.groupId===a.groupId?w.debug("[device-check] default input ".concat(a.label," and output ").concat(l.label," is the same group")):w.debug("[device-check] default input ".concat(a.label," and output ").concat(l.label," is not the same group")):w.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(a=>{if(!a.deviceId)return;const l=this.deviceInfoMap.get("".concat(a.kind,"_").concat(a.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const u={initAt:t,updateAt:t,device:a,state:"ACTIVE"};this.deviceInfoMap.set("".concat(a.kind,"_").concat(a.deviceId),u),n.push(u)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((a,l)=>{a.state==="ACTIVE"&&a.updateAt!==t&&(a.state="INACTIVE",n.push(a))}),this.state!==N_.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(a=>{switch(a.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Eh.RECORDING_DEVICE_CHANGED,a);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Eh.CAMERA_DEVICE_CHANGED,a);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Eh.PLAYOUT_DEVICE_CHANGED,a)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(a=>a.kind==="audioinput"),n=e.filter(a=>a.kind==="videoinput"),i={audio:!1,video:!1};for(const a of t)if(a.label&&a.deviceId){i.audio=!0;break}for(const a of n)if(a.label&&a.deviceId){i.video=!0;break}return i}};let IN=!1;const Ti=new class extends Yn{constructor(){super(...arguments),ie(this,"onAutoplayFailed",void 0),ie(this,"onAudioAutoplayFailed",void 0)}};function n4(){if(IN)return j("FLS_AUTOPLAY_EMITS")?(Ti.onAutoplayFailed&&Ti.onAutoplayFailed(),Ti.emit("autoplay-failed")):void 0;{const e=t=>{t.preventDefault(),IN=!1,y_()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};IN=!0,y_()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),w.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ti.onAutoplayFailed?Ti.onAutoplayFailed():Ti.onAudioAutoplayFailed?w.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):w.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ti.emit("autoplay-failed")}}function r4(e,t,n,i){if(!e)return;const a=Be.getBaseInfoBySessionId(e);if(!a)return;const l=a.info,u=Date.now(),h=Rn(Rn({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:u,elapse:u-a.startTime,cbRegistered:Ti.onAutoplayFailed||Ti.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});Be.send({type:Fn.AUTOPLAY_FAILED,data:h},!0)}const Oge=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Qs=new class{constructor(){ie(this,"onAutoplayFailed",void 0),ie(this,"elementMap",new Map),ie(this,"elementStateMap",new Map),ie(this,"elementsNeedToResume",[]),ie(this,"sinkIdMap",new Map),ie(this,"autoResumeAfterInterruption",e=>Ne.all(Array.from(this.elementMap.entries()).map(async t=>{let[n,i]=t;const a=this.elementStateMap.get(n),l=i.srcObject.getAudioTracks()[0],u=l&&l.readyState;if(w.debug("resume after interrupted, ele: ".concat(a," audio: ").concat(u," ").concat(e)),u==="live"){if(e)return i.pause(),i.play();if(pn.curState==="running")return vm()?(i.pause(),i.play()):a&&a==="paused"?i.play():void 0}}))),ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(w.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),pn.on(vs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pn.on(vs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),pn.on(vs.STATE_CHANGE,()=>{Ws()&&pn.prevState==="suspended"&&pn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new ae(U.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,a),this.elementMap.set(t,a),this.elementStateMap.set(t,Ds.INIT),this.setVolume(t,n);const l=this.sinkIdMap.get(t);if(l)try{a.setSinkId(l).catch(h=>{w.warning("[".concat(t,"] set sink id failed"),h.toString())})}catch(h){w.warning("[".concat(t,"] set sink id failed"),h.toString())}const u=a.play();u&&u.then&&u.catch(h=>{i&&r4(i,"audio",h.message,t),w.warning("audio element play warning",h.toString()),this.elementMap.has(t)&&h.name==="NotAllowedError"&&(w.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(a),IS(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),n4()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}getVolume(e){const t=this.elementMap.get(e);return t?t.volume:0}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Oge.forEach(n=>{t.addEventListener(n,i=>{const a=this.elementStateMap.get(e),l=i.type==="pause"?"paused":i.type;if(w.debug("[".concat(e,"] audio-element-status change ").concat(a," => ").concat(l)),i.type==="error"){const u=t==null?void 0:t.error;u&&w.error("[".concat(e,"] media error, code: ").concat(u.code,", message: ").concat(u.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{w.debug("Auto resume audio element success")}).catch(n=>{w.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Ne(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{y_()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function fr(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new ae(U.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",w);for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];const h=i.apply(this,l);return h instanceof Ne?new Ne((m,g)=>{h.then(m).catch(g)}):h}),n}}class s4 extends Yn{constructor(t){super(),ie(this,"name","VideoProcessorDestination"),ie(this,"ID","0"),ie(this,"_source",void 0),ie(this,"videoContext",void 0),ie(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ae(U.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ae(U.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(di.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(di.ON_TRACK,void 0)}}class i4 extends Yn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),ie(this,"constraintsMap",new Map),ie(this,"statsRegistry",[]),ie(this,"usageRegistry",[]),ie(this,"trackId",void 0),ie(this,"direction",void 0),ie(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Pr(this,_a.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return w.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Sn(this,_a.REQUEST_UPDATE_CONSTRAINTS,Array.from(Yi(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return w.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Sn(this,_a.REQUEST_UPDATE_CONSTRAINTS,Array.from(Yi(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:a,cb:l}of this.statsRegistry)try{const u=l();t.push({processorID:n,processorName:i,type:a,stats:u})}catch(u){w.error(new ae(U.UNEXPECTED_ERROR,u.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Ne&&(i=await i),t.push(Rn(Rn({},i),{},{direction:this.direction}))}catch(i){w.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class a4 extends Yn{constructor(t){super(),ie(this,"name","AudioProcessorDestination"),ie(this,"ID","0"),ie(this,"inputTrack",void 0),ie(this,"inputNode",void 0),ie(this,"audioProcessorContext",void 0),ie(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ae(U.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ae(U.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(di.ON_TRACK,void 0),this.emit(di.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(di.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(di.ON_NODE,this.inputNode))}}class o4 extends Yn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),ie(this,"constraintsMap",new Map),ie(this,"statsRegistry",[]),ie(this,"audioContext",void 0),ie(this,"trackId",void 0),ie(this,"direction",void 0),ie(this,"usageRegistry",[]),ie(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return Pr(this,_a.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return w.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Sn(this,_a.REQUEST_UPDATE_CONSTRAINTS,Array.from(Yi(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Sn(this,_a.REQUEST_UPDATE_CONSTRAINTS,Array.from(Yi(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:a,cb:l}of this.statsRegistry)try{const u=l();t.push({processorID:n,processorName:i,type:a,stats:u})}catch(u){w.error(new ae(U.UNEXPECTED_ERROR,u.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Ne&&(i=await i),t.push(Rn(Rn({},i),{},{direction:this.direction}))}catch(i){w.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class AN extends Yn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ie(this,"context",void 0),ie(this,"processSourceNode",void 0),ie(this,"outputTrack",void 0),ie(this,"processedNode",void 0),ie(this,"clonedTrack",void 0),ie(this,"outputNode",void 0),this.outputNode=new Pge}setVolume(){}createOutputTrack(){throw new ae(U.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Pge{disconnect(){}connect(){}}function c4(e){return new Ne((t,n)=>{let i=!1;const a=document.createElement("video");a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.muted=!0,a.autoplay=!0,a.setAttribute("playsinline",""),a.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(a);const l=Ws()?"canplay":"playing";a.addEventListener(l,()=>{const u=a.videoWidth,h=a.videoHeight;!u&&An()||(i=!0,a.srcObject=null,a.remove(),t([u,h]))}),a.srcObject=new MediaStream([e]),a.play().catch(b_),setTimeout(()=>{i||(a.srcObject=null,a.remove(),t([a.videoWidth,a.videoHeight]))},4e3)})}function WS(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=vo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!tF()&&n.frameRate&&(t.frameRate=n.frameRate),qV()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),An()&&(t.frameRate={ideal:30,max:30}),t}function l4(e){const t={};return tF()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,jl()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function d4(e){const t=l4(e);if(e.encoderConfig){const n=FS(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),v_()&&(t.sampleRate=void 0),t}const u4=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:a}=e.getMediaStreamTrackSettings();let{frameRate:l=n,width:u=i,height:h=a}=t;if(!l||!u||!h)return;u=Tm(u),h=Tm(h),l=Tm(l);const{max:m,min:g}=function(T,P,x){const N=200*Math.pow(x/15,.6)*Math.pow(T*P/640/360,.75);return{min:Math.floor(N),max:Math.floor(4*N)}}(u,h,l),{bitrateMax:_,bitrateMin:v}=t||{};_||w.debug("calculate bitrate: [w: ".concat(u,", h: ").concat(h,", fps: ").concat(l,"] => [brMax: ").concat(_,", brMin: ").concat(v,"]"));const{maxFramerate:S}=j("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(l=Math.min(l,S)),{frameRate:l,bitrateMax:_||m,bitrateMin:v||g,scaleResolutionDownBy:1,scale:0}},h4=async(e,t,n)=>await(async(i,a,l)=>{const u=function(g){const _=[];for(let v=0;v<g.length;v+=2)_.push(parseInt(g.slice(v,v+2),16));return Uint8Array.from(_)}(SF(""+a+l)).slice(0,16),h=u.slice(0,12),m=await window.crypto.subtle.importKey("raw",u,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h},m,i))})(e.buffer,t,n),ON=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Ne((n,i)=>{t.toBlob(async a=>{if(t.remove(),a){const l=await p4(a);n({buffer:l,width:t.width,height:t.height})}else i(new ae(U.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},p4=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var m4,f4,g4,_4,E4,v4,y4,S4,T4,b4,w4,C4,R4,x4,N4,I4,A4,O4,nr,P4,D4,k4,L4,j4,M4,qc,U4,V4,F4,B4,G4,W4,H4,K4,z4,q4,Y4,X4,Q4,Ns;let gr=(m4=st({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),f4=st({argsMap:(e,t)=>[e.getTrackId(),t]}),g4=fr(),_4=bm("LocalAudioTrack","_enabledMutex"),E4=st({argsMap:(e,t)=>[e.getTrackId(),t]}),v4=fr(),y4=bm("LocalAudioTrack","_enabledMutex"),S4=st({argsMap:(e,t)=>[e.getTrackId(),t]}),T4=fr(),b4=fr(),w4=fr(),C4=st({argsMap:e=>[e.getTrackId()]}),R4=fr(),x4=st({argsMap:e=>[e.getTrackId()]}),N4=fr(),I4=st({argsMap:e=>[e.getTrackId()]}),A4=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),O4=st({argsMap:e=>[e.getTrackId()]}),Gt((nr=class extends Om{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Qs.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),ie(this,"trackMediaType",Am.AUDIO),ie(this,"_encoderConfig",void 0),ie(this,"_trackSource",void 0),ie(this,"metadata",[]),ie(this,"_enabled",!0),ie(this,"_volume",100),ie(this,"_useAudioElement",!0),ie(this,"_bypassWebAudio",!1),ie(this,"processor",void 0),ie(this,"_processorContext",void 0),ie(this,"_processorDestination",void 0),ie(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new AN,j("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ss()&&!Ea?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){fn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Qs.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void w.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Sn(this,Ge.NEED_REPLACE_TRACK,this).then(()=>{w.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{w.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!VF())throw new ae(U.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qs.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Sn(this,Ge.NEED_ENABLE_TRACK,this),w.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),w.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Sn(this,Ge.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,w.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Sn(this,Ge.NEED_MUTE_TRACK,this):await Sn(this,Ge.NEED_UNMUTE_TRACK,this))}getStats(){return Pd(()=>{w.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ji(this,Ge.GET_STATS)||Rn({},SN)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ga.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ga.ON_AUDIO_BUFFER),this._source.on(ga.ON_AUDIO_BUFFER,n=>e(n))}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Qs.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Qs.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qs.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Sn(this,Ge.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ne.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new ae(U.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new ae(U.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(di.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Sn(this,Ge.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Sn(this,Ge.NEED_REPLACE_TRACK,this))}),e.on(di.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(di.ON_TRACK),e.removeAllListeners(di.ON_NODE)}bindProcessorContextEvents(e){e.on(_a.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(_a.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof AN&&(this._trackSource=new xN(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new o4(this._source.context,this.getTrackId(),"local"),t=new a4(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ga.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Qs.stop(this.getTrackId()),this._source.play()),Sn(this,Ge.NEED_REPLACE_MIXING_TRACK,this).then(()=>{w.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{w.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[m4],Object.getOwnPropertyDescriptor(nr.prototype,"setVolume"),nr.prototype),Gt(nr.prototype,"setPlaybackDevice",[f4,g4],Object.getOwnPropertyDescriptor(nr.prototype,"setPlaybackDevice"),nr.prototype),Gt(nr.prototype,"setEnabled",[_4,E4,v4],Object.getOwnPropertyDescriptor(nr.prototype,"setEnabled"),nr.prototype),Gt(nr.prototype,"setMuted",[y4,S4,T4],Object.getOwnPropertyDescriptor(nr.prototype,"setMuted"),nr.prototype),Gt(nr.prototype,"getStats",[b4],Object.getOwnPropertyDescriptor(nr.prototype,"getStats"),nr.prototype),Gt(nr.prototype,"setAudioFrameCallback",[w4],Object.getOwnPropertyDescriptor(nr.prototype,"setAudioFrameCallback"),nr.prototype),Gt(nr.prototype,"play",[C4,R4],Object.getOwnPropertyDescriptor(nr.prototype,"play"),nr.prototype),Gt(nr.prototype,"stop",[x4,N4],Object.getOwnPropertyDescriptor(nr.prototype,"stop"),nr.prototype),Gt(nr.prototype,"close",[I4],Object.getOwnPropertyDescriptor(nr.prototype,"close"),nr.prototype),Gt(nr.prototype,"pipe",[A4],Object.getOwnPropertyDescriptor(nr.prototype,"pipe"),nr.prototype),Gt(nr.prototype,"unpipe",[O4],Object.getOwnPropertyDescriptor(nr.prototype,"unpipe"),nr.prototype),nr),I_=(P4=st({argsMap:(e,t)=>[e.getTrackId(),t]}),D4=fr(),k4=bm("MicrophoneAudioTrack","_enabledMutex"),L4=st({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),j4=fr(),M4=st({argsMap:e=>[e.getTrackId()]}),Gt((qc=class extends gr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?FS(t.encoderConfig):{},i,j("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ie(this,"_config",void 0),ie(this,"_deviceName","default"),ie(this,"_constraints",void 0),ie(this,"_originalConstraints",void 0),ie(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(vm()||Yx())&&pn.bindInterruptDetectorTrack(this)}async setDevice(e){if(w.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await ya.getDeviceById(e),n={};n.audio=Rn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await va(n,this.getTrackId())}catch(a){throw w.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),i=await va({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await ya.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}w.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return w.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),e),j("AUTO_RESET_AUDIO_ROUTE")&&(Ws()||mo())){const u=navigator.audioSession;u&&(e||(u.type="playback"),u.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Sn(this,Ge.NEED_DISABLE_TRACK,this)}catch(u){throw w.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),u}return}const a=Rn({},this._constraints),l=ya.searchDeviceIdByName(this._deviceName);l&&!a.deviceId&&(a.deviceId=l);try{n||(this._enabled=!0);const u=await va({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),await Sn(this,Ge.NEED_ENABLE_TRACK,this)}catch(u){throw n||(this._enabled=!1),w.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),u}w.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(vm()||Yx())&&pn.unbindInterruptDetectorTrack(this),gh.some(e=>function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"}(e))||wN&&wN()&&(Be.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:gn.TRACER}).onSuccess(),w.debug("restart background audio tag success"))}onTrackEnded(){if((Ws()||mo())&&this._enabled&&!this._isClosed&&pn.duringInterruption){const e=async()=>{pn.off(vs.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pn.on(vs.IOS_INTERRUPTION_END,e)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Im.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=ya.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await va({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(_a.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),n()}catch(a){i(a)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(_a.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[P4,D4],Object.getOwnPropertyDescriptor(qc.prototype,"setDevice"),qc.prototype),Gt(qc.prototype,"setEnabled",[k4,L4,j4],Object.getOwnPropertyDescriptor(qc.prototype,"setEnabled"),qc.prototype),Gt(qc.prototype,"close",[M4],Object.getOwnPropertyDescriptor(qc.prototype,"close"),qc.prototype),qc),Dge=(U4=st({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),V4=fr(),F4=st({argsMap:e=>[e.getTrackId()]}),B4=fr(),G4=st({argsMap:e=>[e.getTrackId()]}),W4=fr(),H4=st({argsMap:e=>[e.getTrackId()]}),K4=fr(),z4=st({argsMap:e=>[e.getTrackId()]}),q4=fr(),Y4=st({argsMap:e=>[e.getTrackId()]}),X4=st({argsMap:e=>[e.getTrackId()]}),Q4=fr(),Gt((Ns=class extends gr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),ie(this,"source",void 0),ie(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ga.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(Im.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){fn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[U4,V4],Object.getOwnPropertyDescriptor(Ns.prototype,"startProcessAudioBuffer"),Ns.prototype),Gt(Ns.prototype,"pauseProcessAudioBuffer",[F4,B4],Object.getOwnPropertyDescriptor(Ns.prototype,"pauseProcessAudioBuffer"),Ns.prototype),Gt(Ns.prototype,"seekAudioBuffer",[G4,W4],Object.getOwnPropertyDescriptor(Ns.prototype,"seekAudioBuffer"),Ns.prototype),Gt(Ns.prototype,"resumeProcessAudioBuffer",[H4,K4],Object.getOwnPropertyDescriptor(Ns.prototype,"resumeProcessAudioBuffer"),Ns.prototype),Gt(Ns.prototype,"stopProcessAudioBuffer",[z4,q4],Object.getOwnPropertyDescriptor(Ns.prototype,"stopProcessAudioBuffer"),Ns.prototype),Gt(Ns.prototype,"close",[Y4],Object.getOwnPropertyDescriptor(Ns.prototype,"close"),Ns.prototype),Gt(Ns.prototype,"setAudioBufferPlaybackSpeed",[X4,Q4],Object.getOwnPropertyDescriptor(Ns.prototype,"setAudioBufferPlaybackSpeed"),Ns.prototype),Ns);class Ur extends gr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Pm().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,on(8,"track-mix-")),ie(this,"trackList",void 0),ie(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(w.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):w.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){w.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}NS(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof Ur?n.emit(_h.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class kge extends JF{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ga.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ie(this,"audioBuffer",void 0),ie(this,"sourceNode",void 0),ie(this,"startPlayTime",0),ie(this,"startPlayOffset",0),ie(this,"pausePlayTime",0),ie(this,"options",void 0),ie(this,"currentLoopCount",0),ie(this,"currentPlaybackSpeed",100),ie(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):w.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const J4=new Map;function $4(e,t){if(e.length===0||t.length===0)return 1/0;const n=sN(e),i=sN(t);return Math.floor(i/n)}class PN{get rendFrameRate(){const t=Math.max(1,$4(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Ds.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(w.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){ie(this,"trackId",void 0),ie(this,"config",void 0),ie(this,"onFirstVideoFrameDecoded",void 0),ie(this,"onFirstVideoFrameRender",void 0),ie(this,"onVideoBufferReady",void 0),ie(this,"onVideoStateChanged",void 0),ie(this,"freezeTimeCounterList",[]),ie(this,"renderFreezeAccTime",0),ie(this,"renderFreezeAccTime2",0),ie(this,"isKeepLastFrame",!1),ie(this,"isDestroyed",!1),ie(this,"timeUpdatedCount",0),ie(this,"freezeTime",0),ie(this,"playbackTime",0),ie(this,"lastTimeUpdatedTime",0),ie(this,"autoplayFailed",!1),ie(this,"videoTrack",void 0),ie(this,"videoElement",void 0),ie(this,"cacheVideoElement",void 0),ie(this,"cancelRVFId",void 0),ie(this,"internal",!1),ie(this,"_render_interframe_delays",[]),ie(this,"_render_interframe_delays_sizes",[]),ie(this,"_videoState",zc.VideoStateStopped),ie(this,"videoElementCheckInterval",void 0),ie(this,"videoElementFreezeTimeout",void 0),ie(this,"_videoElementStatus",Ds.NONE),ie(this,"_isInPage",!0),ie(this,"isGettingVideoDimensions",!1),ie(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return w.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),ie(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&pn.curState==="running"&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(KV())),ZV()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ie(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&w.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Ds.PLAYING;break;case"loadeddata":if(this.videoState=zc.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Ds.CANPLAY;break;case"stalled":this.videoElementStatus=Ds.STALLED;break;case"suspend":this.videoElementStatus=Ds.SUSPEND;break;case"pause":this.videoElementStatus=Ds.PAUSED,Ws()||mo()||ss()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Ds.WAITING;break;case"abort":this.videoElementStatus=Ds.ABORT;break;case"ended":this.videoElementStatus=Ds.ENDED;break;case"emptied":this.videoElementStatus=Ds.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=Ds.ERROR,w.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>j("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const a=i-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,$i.lastVisibleTime<$i.lastHiddenTime||l<$i.lastHiddenTime||l<$i.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(a>j("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=a),this.playbackTime+=a;this.playbackTime>=6e3;){this.playbackTime-=6e3;const u=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(u),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(KV())),ZV()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),pn.on(vs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pn.on(vs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(a=>{t&&r4(t,"video",a.message,this.trackId),a.name==="NotAllowedError"?(w.warning("detected video element autoplay failed",a),this.autoplayFailed=!0,this.handleAutoPlayFailed()):w.warning("[".concat(this.trackId,"] play warning: "),a)});const i=qt();if((i.name==="Safari"&&Number(i.version)===15||vm())&&n&&n.then){const a=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(a).catch(a)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return w.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const a=i.getContext("2d");return a?(a.drawImage(this.videoElement,0,0,i.width,i.height),new Ne((l,u)=>{i.toBlob(async h=>{if(i.remove(),h){const m=await p4(h);l({buffer:m,width:i.width,height:i.height})}else u(new ae(U.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await ON(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,pn.off(vs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pn.off(vs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=zc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Ds.INIT,!this.videoElementCheckInterval&&(Z4.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(l){return l!==document.body&&document.body.contains(l)}(this.videoElement)},1e3),j("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let l;const u=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",u),this.videoElementFreezeTimeout=window.setTimeout(h,j("VIDEO_FREEZE_DURATION")))},h=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===zc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=zc.VideoStateFrozen:document.addEventListener("visibilitychange",u))},m=(g,_)=>{if(this.videoElementStatus===Ds.PLAYING){if(l){const T=_.presentationTime-l.presentationTime,P=_.presentedFrames-l.presentedFrames;this._render_interframe_delays_sizes.push(P),this._render_interframe_delays.push(T);const x=sN(this._render_interframe_delays_sizes),N=x-this._render_interframe_delays_sizes[0];if(x>30&&N>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===zc.VideoStateStarting&&(this.videoState=zc.VideoStateDecoding),this.videoState===zc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(h,j("VIDEO_FREEZE_DURATION"))),T<j("VIDEO_FREEZE_DURATION")&&this.videoState===zc.VideoStateFrozen&&(this.videoState=zc.VideoStateDecoding),T>j("VIDEO_FREEZE_DURATION")&&$i.lastVisibleTime>=$i.lastHiddenTime&&l.timestamp>$i.lastVisibleTime&&l.timestamp>$i.lastHiddenTime){const M=Math.min(66,$4(this._render_interframe_delays_sizes,this._render_interframe_delays)),F=Math.max(0,T-(P-1)*M);this.renderFreezeAccTime2+=F>M?F:0,this.renderFreezeAccTime+=T}}l=Rn(Rn({},_),{},{timestamp:g})}else this.isSkipCalcRenderFreezeTime()&&(l=Rn(Rn({},_),{},{timestamp:g}));var v,S;j("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(v=(S=this.videoElement).requestVideoFrameCallback)===null||v===void 0?void 0:v.call(S,m))};this.cancelRVFId=(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(n,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),v_()&&!j("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=qt();this.config.noStyle||(i.name==="Safari"&&Number(i.version)===15||vm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,An()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,An()&&this.videoElement.load());const a=this.videoElement.play();a!==void 0&&a.catch(l=>{w.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){var t,n;Z4.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(n=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(n,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=Ds.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Ds.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{w.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{w.error(i)}),this.autoplayFailed=!1,y_()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};y_()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),n4()}}const Z4=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class HS extends PN{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),ie(this,"container",void 0),ie(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await ON(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",j("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var eB,tB,nB,rB,sB,iB,aB,oB,cB,lB,dB,uB,hB,pB,mB,fB,gB,_B,EB,vB,yB,SB,TB,bB,wB,CB,RB,xB,Mt,NB,IB,AB,OB,PB,DB,kB,LB,Sa;let _n=(eB=st({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),tB=fr(),nB=st({argsMap:e=>[e.getTrackId()]}),rB=bm("LocalVideoTrack","_enabledMutex"),sB=st({argsMap:(e,t)=>[e.getTrackId(),t]}),iB=fr(),aB=bm("LocalVideoTrack","_enabledMutex"),oB=st({argsMap:(e,t)=>[e.getTrackId(),t]}),cB=fr(),lB=st({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),dB=fr(),uB=st({argsMap:(e,t)=>[e.getTrackId(),t]}),hB=fr(),pB=fr(),mB=st({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),fB=fr(),gB=fr(),_B=fr(),EB=st({argsMap:e=>[e.getTrackId()]}),vB=fr(),yB=fr(),SB=fr(),TB=fr(),bB=fr(),wB=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),CB=st({argsMap:e=>[e.getTrackId()]}),RB=st({argsMap:e=>[e.getTrackId()]}),xB=st({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Mt=class tne extends Om{get videoHeight(){if(ss()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(ss()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ds.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,a,l,u){if(super(t,l),ie(this,"trackMediaType",Am.VIDEO),ie(this,"_player",void 0),ie(this,"isUseScaleResolutionDownBy",!1),ie(this,"_videoVisibleTimer",null),ie(this,"_previousVideoVisibleStatus",void 0),ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ie(this,"_encoderConfig",void 0),ie(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ie(this,"_optimizationMode",void 0),ie(this,"_saveEncodeBitrateRatio",1),ie(this,"_videoHeight",void 0),ie(this,"_videoWidth",void 0),ie(this,"_forceBitrateLimit",void 0),ie(this,"_enabled",!0),ie(this,"_processorDestination",void 0),ie(this,"_processorContext",void 0),ss()){const{width:h,height:m}=t.getSettings();this._videoWidth=h,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=a,this._hints=u||[],n&&this._hints.indexOf(sn.CUSTOM_TRACK)!==-1?this._encoderConfig=On(n):this._encoderConfig=n,this._hints.indexOf(sn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Kx(Qt.CHROME,115)&&RS().indexOf("Windows")!==-1){const h=function(m,g){if("VideoFrame"in window&&"TransformStream"in window&&jt().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(m),v=new MediaStreamTrackGenerator({kind:"video"});let S,T,P=Date.now();const x=()=>{N&&(clearInterval(N),N=void 0),S&&(S.close(),S=void 0),m.stop(),T=void 0,v.removeEventListener("ended",x)};let N=window.setInterval(()=>{if(T&&S&&Date.now()-P>1e3)try{v.readyState==="live"?T.enqueue(S.clone()):x()}catch{x()}},1e3);const M=new TransformStream({transform:(F,q)=>{v.readyState==="live"?(T=q,P=Date.now(),S===void 0?(S=F,q.enqueue(F.clone())):(q.enqueue(S),S=F)):F.close()}});return v.addEventListener("ended",x),_.readable.pipeThrough(M).pipeTo(v.writable),v}}(t);h&&(w.info("local screen video track begin to inject frame"),this._mediaStreamTrack=h)}n&&this._hints.indexOf(sn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new i4(this.getTrackId(),"local"),this._processorDestination=new s4(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Rn(Rn(Rn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new PN(i):this._player=new HS(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Im.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Sn(this,Ge.NEED_DISABLE_TRACK,this)}catch(i){throw w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void w.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Sn(this,Ge.NEED_ENABLE_TRACK,this)}catch(i){throw w.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}w.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,w.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Sn(this,Ge.NEED_MUTE_TRACK,this):await Sn(this,Ge.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),w.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await Sn(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(w)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ae(U.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=vo(t),j("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=WS({encoderConfig:t});(ss()||Ws()||mo())&&(i.deviceId=void 0),w.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(a){const l=new ae(U.UNEXPECTED_ERROR,a.toString());throw w.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(sn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Sn(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(w)}}getStats(){return Pd(()=>{w.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ji(this,Ge.GET_STATS)||Rn({},TN)}async setBeautyEffect(t){w.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await ON(t)}async findClosestProfile(){const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:a,height:l,frameRate:u}=this._encoderConfig||{},h=Tm(this._videoWidth||t||a||0),m=Tm(this._videoHeight||n||l||0),g=function(_,v,S){if(!Array.isArray(j("VIDEO_ENCODER_CONFIG_LIST"))||j("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const T=Math.min(_,v);return!(T>=480)&&Rn(Rn({},j("VIDEO_ENCODER_CONFIG_LIST").find(P=>P.height>T)),{},{frameRate:S})}(h,m,Tm(i||u||15));if(g)return w.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(h,"x").concat(m," => ").concat(JSON.stringify(g))),this.setEncoderConfiguration(g)}async setBitrateLimit(t){w.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void w.error(U.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Sn(this,Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,w.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}w.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return w.error(U.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,w.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){c4(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(b_)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new ae(U.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");w.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=vo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(sn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Sn(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(w)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:a,bitrateMin:l}=this._encoderConfig;if(l==null||a==null){const{max:u,min:h}=function(m,g,_,v,S){const T=j("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:v,max:S};if(S===void 0){const P=Math.floor(200*Math.pow(_/15,.6)*Math.pow(m*g/640/360,.75));S=T==="STANDARD_BITRATE"?4*P:2*P,v=v??P}else v=v??Math.floor(S/10);return{min:v,max:S}}(t,n,i,l,a);if(this._encoderConfig.bitrateMin=h,this._encoderConfig.bitrateMax=u,j("VIDEO_STANDARD_BITRATE_VERSION")&&l==null&&a==null){const[m,g]=function(_,v,S){const T=4*Math.floor(2e5*Math.pow(S/15,.6)*Math.pow(_*v/230400,.75)),P=_*v,x=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),N=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let M=Yi(x).call(x).next().value,F=1;if(x.has(P))M=x.get(P);else{var q;const Me=Ju(q=Array.from(x.entries())).call(q,(ot,Ct)=>{let[vt]=ot,[Zt]=Ct;return vt-Zt}),ut=Me.find(ot=>{let[Ct]=ot;return Ct>P});if(ut){const ot=Me.indexOf(ut);if(ot>0){const Ct=Me[ot-1],vt=(P-Ct[0])/(ut[0]-Ct[0]);M=Ct[1]+vt*(ut[1]-Ct[1])}else M=ut[1]}else M=Me[Me.length-1][1]}if(N.has(P))F=N.get(P);else{var J;const Me=Ju(J=Array.from(N.entries())).call(J,(ot,Ct)=>{let[vt]=ot,[Zt]=Ct;return vt-Zt}),ut=Me.find(ot=>{let[Ct]=ot;return Ct>P});if(ut){const ot=Me.indexOf(ut);if(ot>0){const Ct=Me[ot-1],vt=(P-Ct[0])/(ut[0]-Ct[0]);F=Ct[1]+vt*(ut[1]-Ct[1])}else F=ut[1]}else F=Me[Me.length-1][1]}const te=j("VIDEO_NEW_BITRATE_RATIO");te&&te>0&&(M=te/100);const Y=Math.floor(T*M),ne=Math.floor(65e4*Math.pow(_*v/230400,.5)*Math.pow(S/15,.69));let ue=Y;const fe=j("VIDEO_STANDARD_BITRATE_VERSION");return fe&&fe>0&&(fe===1?ue=T:fe===2?ue=Y:fe===3&&(ue=ne)),[Math.floor(ue/1e3),F]}(t,n,i);this._encoderConfig.bitrateMax=m,this._encoderConfig.bitrateMin=h?Math.min(h,m):m,this._saveEncodeBitrateRatio=g,w.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else w.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(u,", brMin: ").concat(h,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:l,slot:u}=a;if(this.isPlaying&&l instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=oF.checkOneElementVisible(l),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=Be.reportApiInvoke(null,{tag:gn.TRACER,name:Vn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new ae(U.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new ae(U.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Rn(Rn({},i),vo(t))),i=uh(i);const a=on(8,"track-video-cloned-"),l=new tne(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,uh(this._scalabilityMode),this._optimizationMode,a,uh(this._hints));return t&&i&&l.setEncoderConfiguration(i),w.debug("clone video track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(n)),l}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new ae(U.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new ae(U.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Pd(()=>{Be.reportApiInvoke(null,{name:Vn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:gn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!j("ENABLE_VIDEO_SEI")||!j("ENABLE_ENCODED_TRANSFORM"))return void w.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new ae(U.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void w.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const a=i.codecs[0].mimeType.toLocaleLowerCase();a==="video/h264"||a==="video/h265"?this.safeEmit("sei-to-send",t):w.warning("SEI is not supported by ".concat(a))}bindProcessorDestinationEvents(){this.processorDestination.on(di.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Sn(this,Ge.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Sn(this,Ge.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(di.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(_a.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(_a.REQUEST_CONSTRAINTS)}},Gt(Mt.prototype,"play",[eB,tB],Object.getOwnPropertyDescriptor(Mt.prototype,"play"),Mt.prototype),Gt(Mt.prototype,"stop",[nB],Object.getOwnPropertyDescriptor(Mt.prototype,"stop"),Mt.prototype),Gt(Mt.prototype,"setEnabled",[rB,sB,iB],Object.getOwnPropertyDescriptor(Mt.prototype,"setEnabled"),Mt.prototype),Gt(Mt.prototype,"setMuted",[aB,oB,cB],Object.getOwnPropertyDescriptor(Mt.prototype,"setMuted"),Mt.prototype),Gt(Mt.prototype,"setSaveEncodeBitrateRatio",[lB,dB],Object.getOwnPropertyDescriptor(Mt.prototype,"setSaveEncodeBitrateRatio"),Mt.prototype),Gt(Mt.prototype,"setEncoderConfiguration",[uB,hB],Object.getOwnPropertyDescriptor(Mt.prototype,"setEncoderConfiguration"),Mt.prototype),Gt(Mt.prototype,"getStats",[pB],Object.getOwnPropertyDescriptor(Mt.prototype,"getStats"),Mt.prototype),Gt(Mt.prototype,"setBeautyEffect",[mB,fB],Object.getOwnPropertyDescriptor(Mt.prototype,"setBeautyEffect"),Mt.prototype),Gt(Mt.prototype,"getCurrentFrameData",[gB],Object.getOwnPropertyDescriptor(Mt.prototype,"getCurrentFrameData"),Mt.prototype),Gt(Mt.prototype,"getCurrentFrameImage",[_B],Object.getOwnPropertyDescriptor(Mt.prototype,"getCurrentFrameImage"),Mt.prototype),Gt(Mt.prototype,"findClosestProfile",[EB,vB],Object.getOwnPropertyDescriptor(Mt.prototype,"findClosestProfile"),Mt.prototype),Gt(Mt.prototype,"setBitrateLimit",[yB],Object.getOwnPropertyDescriptor(Mt.prototype,"setBitrateLimit"),Mt.prototype),Gt(Mt.prototype,"setOptimizationMode",[SB],Object.getOwnPropertyDescriptor(Mt.prototype,"setOptimizationMode"),Mt.prototype),Gt(Mt.prototype,"setScalabiltyMode",[TB],Object.getOwnPropertyDescriptor(Mt.prototype,"setScalabiltyMode"),Mt.prototype),Gt(Mt.prototype,"updateMediaStreamTrackResolution",[bB],Object.getOwnPropertyDescriptor(Mt.prototype,"updateMediaStreamTrackResolution"),Mt.prototype),Gt(Mt.prototype,"pipe",[wB],Object.getOwnPropertyDescriptor(Mt.prototype,"pipe"),Mt.prototype),Gt(Mt.prototype,"unpipe",[CB],Object.getOwnPropertyDescriptor(Mt.prototype,"unpipe"),Mt.prototype),Gt(Mt.prototype,"close",[RB],Object.getOwnPropertyDescriptor(Mt.prototype,"close"),Mt.prototype),Gt(Mt.prototype,"replaceTrack",[xB],Object.getOwnPropertyDescriptor(Mt.prototype,"replaceTrack"),Mt.prototype),Mt),KS=(NB=st({argsMap:(e,t)=>[e.getTrackId(),t]}),IB=fr(),AB=bm("CameraVideoTrack","_enabledMutex"),OB=st({argsMap:(e,t)=>[e.getTrackId(),t]}),PB=fr(),DB=st({argsMap:(e,t)=>[e.getTrackId(),t]}),kB=fr(),LB=st({argsMap:e=>[e.getTrackId()]}),Sa=class nne extends _n{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,a,l,u){super(t,vo(n.encoderConfig),a,l,u),ie(this,"_config",void 0),ie(this,"_originalConstraints",void 0),ie(this,"_constraints",void 0),ie(this,"_enabled",!0),ie(this,"_deviceName","default"),ie(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(vm()||Yx())&&!function(){const h=qt();if(h.os!==zr.IOS||!h.osVersion)return!1;const m=h.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&eF()&&this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=vo(this._config.encoderConfig),pn.on(vs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pn.on(vs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(w.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await ya.getDeviceById(t),i={};i.video=Rn({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let a=null;try{a=await va(i,this.getTrackId())}catch(l){throw w.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),a=await va({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await ya.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw w.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}w.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){w.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Rn(Rn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await va(n,this.getTrackId())}catch(a){throw w.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),a.toString()),i=await va({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Rn({},n.video),w.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(w.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await va({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Sn(this,Ge.NEED_ENABLE_TRACK,this)}catch(i){throw w.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),w.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Sn(this,Ge.NEED_DISABLE_TRACK,this)}catch(i){throw w.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}w.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new ae(U.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=vo(t),j("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=On(this._config);i.encoderConfig=t;const a=WS(i);(ss()||Ws()||mo())&&(a.deviceId=void 0),w.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(l){const u=new ae(U.UNEXPECTED_ERROR,l.toString());throw w.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}this._config=i,this._constraints=a,this._originalConstraints=a,this._encoderConfig=t,this._hints.indexOf(sn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Sn(this,Ge.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(w)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ws()||mo())&&this._enabled&&!this._isClosed&&pn.duringInterruption){const t=async()=>{pn.off(vs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(w.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pn.on(vs.IOS_INTERRUPTION_END,t)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Im.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=ya.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const a=await va({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),pn.off(vs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pn.off(vs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Rn(Rn({},i),vo(t))),i=uh(i);const a=on(8,"track-cam-cloned-"),l=new nne(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,uh(Rn(Rn({},this._config),{},{encoderConfig:i})),uh(this._constraints),uh(this._scalabilityMode),this._optimizationMode,a);return t&&i&&l.setEncoderConfiguration(i),w.debug("clone track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(n)),l}bindProcessorContextEvents(){this.processorContext.on(_a.REQUEST_UPDATE_CONSTRAINTS,async(t,n,i)=>{try{const a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),n()}catch(a){i(a)}}),this.processorContext.on(_a.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Gt(Sa.prototype,"setDevice",[NB,IB],Object.getOwnPropertyDescriptor(Sa.prototype,"setDevice"),Sa.prototype),Gt(Sa.prototype,"setEnabled",[AB,OB,PB],Object.getOwnPropertyDescriptor(Sa.prototype,"setEnabled"),Sa.prototype),Gt(Sa.prototype,"setEncoderConfiguration",[DB,kB],Object.getOwnPropertyDescriptor(Sa.prototype,"setEncoderConfiguration"),Sa.prototype),Gt(Sa.prototype,"close",[LB],Object.getOwnPropertyDescriptor(Sa.prototype,"close"),Sa.prototype),Sa);function jB(e){const t=on(8,"track-cus-"),n=Be.reportApiInvoke(null,{id:t,tag:gn.TRACER,name:Vn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new gr(e.mediaStreamTrack,e.encoderConfig?FS(e.encoderConfig):{},t,!1);return w.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i}function DN(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Rn(Rn({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?w.debug("[".concat(e,"] set content hint to"),n.optimizationMode):w.debug("[".concat(e,"] set content hint failed")))):w.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var MB,UB,VB,FB,Va,BB,GB,WB,HB,KB,zB,qB,Is;class YB extends YF{getUserId(){return this._userId}constructor(t,n,i,a){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(a.clientId,"_").concat(on(5,""))),ie(this,"_userId",void 0),ie(this,"_uintId",void 0),ie(this,"_isDestroyed",!1),ie(this,"store",void 0),ie(this,"processor",void 0),ie(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=a}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,w.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let km=(MB=st({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),UB=st({argsMap:e=>[e.getTrackId()]}),VB=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),FB=st({argsMap:e=>[e.getTrackId()]}),Gt((Va=class extends YB{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ds.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i,a){super(e,t,n,i),ie(this,"_videoVisibleTimer",null),ie(this,"_previousVideoVisibleStatus",void 0),ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ie(this,"trackMediaType",Am.VIDEO),ie(this,"_videoWidth",void 0),ie(this,"_videoHeight",void 0),ie(this,"_player",void 0),ie(this,"_prePlayer",void 0),ie(this,"processorDestination",void 0),ie(this,"processorContext",void 0),this._prePlayer=a,this.updateMediaStreamTrackResolution(),this.processorContext=new i4(this.getTrackId(),"remote"),this.processorDestination=new s4(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Pd(()=>{w.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ji(this,Ge.GET_STATS)||Rn({},zF)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Ua.PLAY_START),typeof e=="string"){const i=document.getElementById(e);i?e=i:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Rn(Rn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let i=!1,a=!1;e instanceof HTMLVideoElement?(this._player=new PN(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,a=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new HS(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ua.FIRST_FRAME_DECODED),a&&this.safeEmit(Ua.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=l=>{this.safeEmit(Ua.VIDEO_STATE_CHANGED,l)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Ua.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Ua.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){c4(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(b_)}_updatePlayerSource(){w.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:a,slot:l}=i;if(this.isPlaying&&a instanceof HTMLVideoElement&&l instanceof HTMLElement){const u=oF.checkOneElementVisible(a),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const m=Be.reportApiInvoke(null,{tag:gn.TRACER,name:Vn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(n){throw new ae(U.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new ae(U.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(di.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(di.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(_h.SEI_RECEIVED,e)}}).prototype,"play",[MB],Object.getOwnPropertyDescriptor(Va.prototype,"play"),Va.prototype),Gt(Va.prototype,"stop",[UB],Object.getOwnPropertyDescriptor(Va.prototype,"stop"),Va.prototype),Gt(Va.prototype,"pipe",[VB],Object.getOwnPropertyDescriptor(Va.prototype,"pipe"),Va.prototype),Gt(Va.prototype,"unpipe",[FB],Object.getOwnPropertyDescriptor(Va.prototype,"unpipe"),Va.prototype),Va),Lm=(BB=st({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),GB=st({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),WB=st({argsMap:(e,t)=>[e.getTrackId(),t]}),HB=st({argsMap:e=>[e.getTrackId()]}),KB=st({argsMap:e=>[e.getTrackId()]}),zB=st({argsMap:(e,t)=>[e.getTrackId(),t.name]}),qB=st({argsMap:e=>[e.getTrackId()]}),Gt((Is=class extends YB{get isPlaying(){return this._useAudioElement?Qs.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),ie(this,"trackMediaType",Am.AUDIO),ie(this,"_source",void 0),ie(this,"_useAudioElement",!0),ie(this,"_volume",100),ie(this,"processorContext",void 0),ie(this,"processorDestination",void 0),ie(this,"_played",!1),ie(this,"_bypassWebAudio",!1),j("DISABLE_WEBAUDIO")?(this._source=new AN,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new xN(e,!0),j("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ga.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ua.FIRST_FRAME_DECODED)}),this.processorContext=new o4(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new a4(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ga.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ga.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ga.ON_AUDIO_BUFFER),this._source.on(ga.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Qs.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(Qs.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,j("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!VF())throw new ae(U.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qs.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?Qs.getVolume(this.getTrackId()):this._source instanceof xN?this._source.getAudioVolume():0}getStats(){return Pd(()=>{w.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ji(this,Ge.GET_STATS)||Rn({},KF)}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] use audio element to play")),Qs.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(w.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Qs.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qs.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new ae(U.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new ae(U.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new ae(U.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(di.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(di.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(di.ON_TRACK),this.processorDestination.removeAllListeners(di.ON_NODE)}}).prototype,"setVolume",[BB],Object.getOwnPropertyDescriptor(Is.prototype,"setVolume"),Is.prototype),Gt(Is.prototype,"setAmplifiedVolume",[GB],Object.getOwnPropertyDescriptor(Is.prototype,"setAmplifiedVolume"),Is.prototype),Gt(Is.prototype,"setPlaybackDevice",[WB],Object.getOwnPropertyDescriptor(Is.prototype,"setPlaybackDevice"),Is.prototype),Gt(Is.prototype,"play",[HB],Object.getOwnPropertyDescriptor(Is.prototype,"play"),Is.prototype),Gt(Is.prototype,"stop",[KB],Object.getOwnPropertyDescriptor(Is.prototype,"stop"),Is.prototype),Gt(Is.prototype,"pipe",[zB],Object.getOwnPropertyDescriptor(Is.prototype,"pipe"),Is.prototype),Gt(Is.prototype,"unpipe",[qB],Object.getOwnPropertyDescriptor(Is.prototype,"unpipe"),Is.prototype),Is);const $i=new class extends Yn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ie(this,"_lastHiddenTime",0),ie(this,"_lastVisibleTime",0),ie(this,"needUploadStats",[]),ie(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),w.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class XB extends Yn{constructor(t,n){super(),ie(this,"trackMediaType",Am.DATA),ie(this,"_version",1),ie(this,"_type",3),ie(this,"_config",void 0),ie(this,"_originDataChannel",void 0),ie(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ie(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),ie(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return j("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Ne((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var a;n(new ae(U.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((a=this._originDataChannel)===null||a===void 0?void 0:a.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new ae(U.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ae(U.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[BS.OPEN,BS.CLOSE,BS.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,a]=n;t.removeEventListener(i,a)}),this._datachannelEventMap.clear()}}class Lge extends XB{constructor(t){super(t),ie(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),a=new DataView(i).getUint8(3);if(a!==this.id)return void(j("SHOW_DATASTREAM2_LOG")&&w.debug("invalid datachannel id: ".concat(a," !== ").concat(this.id)));let l=n.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(BS.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class jge extends XB{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function zS(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>Ky.revokeObjectURL(e),0),new Worker(Ky.createObjectURL(e))}const QB=71,kN=1,LN=2,jN=1,JB=2;var kd=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(kd||{});function MN(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==QB)return;const i=e.getUint16(1),a=kN+LN+i,l=new Uint8Array(e.byteLength-a);l.set(new Uint8Array(e.buffer,a,e.byteLength-a));const u={m:n,tlvLen:i,tlv:[],frame:l};let h=kN+LN;for(;h<a;){const m=e.getUint8(h),g=e.getUint16(h+jN),_=jN+JB;if(m===kd.AUDIO_LEVEL){let v=e.getUint8(h+_);for(let S=1;S<g;S++)v=v<<8|e.getUint8(h+_+S);u.tlv.push({tag:m,length:g,value:t?127^v>>1:127&v})}else if(m===kd.METADATA||m===kd.AUDIO_64_BIT_PTS){const v=new Uint8Array(g);for(let S=0;S<g;S++)v[S]=e.getUint8(h+_+S);u.tlv.push({tag:m,length:g,value:v})}h+=_+g}return u}const qS=new Map,YS=127,yh=1e-10,UN=139/13,XS=new Map;function VN(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let a=0;return XS.has(i)?a=XS.get(i):(a=Math.log(function(u,h){const m=u-h;h<m&&(h=m);let g=1;for(let _=u,v=1;_>h;_--,v++)g=g*_/v;return g}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,XS.set(i,a)),a<yh&&(a=yh),a}function $B(e,t,n){const i=t.length,a=e.length/i;let l=!1;for(let u=0,h=0;u<i;u++){let m=0;for(let g=h+a;h<g;h++)e[h]>n&&m++;t[u]!==m&&(t[u]=m,l=!0)}return l}window.cache=XS;let Mge=0;class ZB{constructor(t){ie(this,"id",void 0),ie(this,"immediates",[]),ie(this,"lastNonSilence",-1),ie(this,"immediateSpeechActivityScore",yh),ie(this,"lastLevelChangedTime",Date.now()),ie(this,"levels",[]),ie(this,"longs",[]),ie(this,"longSpeechActivityScore",yh),ie(this,"mediums",[]),ie(this,"mediumSpeechActivityScore",yh),ie(this,"minLevel",0),ie(this,"nextMinLevel",0),ie(this,"nextMinLevelWindowLength",0),ie(this,"energyScore",0),this.id=t||"".concat(Mge++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,i=this.minLevel+UN;let a=!1;for(let l=0;l<t.length;++l){let u=n[l];u<i&&(u=0);const h=Math.floor(u/UN);t[l]!==h&&(t[l]=h,a=!0)}return a}computeLongs(){return $B(this.mediums,this.longs,4)}computeMediums(){return $B(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=VN(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=VN(this.longs[0],10,47),this.longSpeechActivityScore>yh&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=VN(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(yk(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=t;return t<0&&(i=0),t>YS&&(i=YS),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+UN?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>YS&&(n=YS),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Uge{constructor(t){ie(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class FN{constructor(t,n,i){ie(this,"isDominant",void 0),ie(this,"energyRanking",void 0),ie(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=i}}class Vge extends Yn{constructor(t){super(),ie(this,"dominantId",null),ie(this,"lastDecisionTime",0),ie(this,"lastLevelChangedTime",0),ie(this,"lastLevelIdleTime",0),ie(this,"relativeSpeechActivities",[]),ie(this,"speakers",new Map),ie(this,"enableSilence",!1),ie(this,"timeoutToSilenceInterval",0),ie(this,"decisionMaker",null),ie(this,"loudest",[]),ie(this,"numLoudestToTrack",3),ie(this,"energyExpireTimeMs",250),ie(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const i=Date.now(),a=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const l=a.levelChanged(n,i);return this.updateLoudestList(a,l,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new ZB(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,i){const a=t.id===this.dominantId;if(n<0){let m=0;for(;m<this.loudest.length&&this.loudest[m]!==t;)++m;return new FN(a,m,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new FN(a,0,t.energyScore);const l=i-this.energyExpireTimeMs;let u=0;for(;u<this.loudest.length;){const m=this.loudest[u];if(m.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(u,1);else if(m.id!==t.id)++u;else if(this.loudest.splice(u,1),this.loudest.length<this.numLoudestToTrack)break}let h=0;for(;h<this.loudest.length&&!(this.loudest[h].energyScore<t.energyScore);)++h;return h<this.numLoudestToTrack&&(this.loudest.splice(h,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new FN(a,h,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Uge(this),this.decisionMaker.execute())}makeDecision(t){let n=null,i=null;const a=this.speakers.size;let l=null;if(a===0)l=null;else if(a===1){var u;const h=Yi(u=this.speakers).call(u).next().value;this.enableSilence&&h&&(l=h.id,h.evaluateSpeechActivityScores(t),t-h.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let h=this.dominantId==null?null:this.speakers.get(this.dominantId);if(h==null){const _=this.speakers.entries().next();_.value&&(l=_.value[0],h=_.value[1])}else l=h.id;h!=null&&h.evaluateSpeechActivityScores(t);const m=this.relativeSpeechActivities;let g=2;for(const _ of this.speakers.entries()){const[v,S]=_;if(S===h)continue;S.evaluateSpeechActivityScores(t);for(let N=0;N<m.length;++N){const M=h==null?yh:h.getSpeechActivityScore(N);m[N]=Math.log(S.getSpeechActivityScore(N)/M)}const T=m[0],P=m[1],x=m[2];T>3&&P>2&&x>0&&P>g&&(g=P,l=v)}this.enableSilence&&h!=null&&l===h.id&&t-h.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(n=this.dominantId,this.dominantId=l,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=n;let a=300-(t-this.lastDecisionTime);return a<=0&&(this.lastDecisionTime=t,this.makeDecision(t),a=300-(Date.now()-t)),a>0&&i>a&&(i=a),i}timeoutIdleLevels(t){const n=[];for(const a of Yi(i=this.speakers).call(i)){var i;const l=t-a.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||a.id!==this.dominantId)?n.push(a.id):300<l&&a.levelTimedOut()}n.forEach(a=>this.speakers.delete(a))}}const jm=new Map;let Jo=null,QS=null;const e3=3;let Sh=[];const $o=new Map,JS=new Map;class Fge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){ie(this,"id",void 0),ie(this,"track",void 0),ie(this,"score",0),ie(this,"active",!0),ie(this,"muted",!1),ie(this,"timer",0),ie(this,"actives",0),ie(this,"inactives",0),this.id=t,this.track=n,this.setActive($o.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const a=[],l=[];return Array.from(Yi($o).call($o)).forEach(u=>{u.active?a.push(u):l.push(u)}),{actives:a,inactives:l}}();if(n.length>3){let a;n.forEach(l=>{(!a||a.score>l.score)&&(a=l)}),a&&a.setActive(!1)}if(n.length<3&&i.length>0){let a;i.forEach(l=>{(!a||a.score<l.score)&&l.id!==this.id&&(a=l)}),a&&t&&!this.active&&(a.samples>40&&a.activeRate-this.activeRate>.4?a.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let i;return Array.from(Yi($o).call($o)).forEach(a=>{!a.active||a.id===n||a.samples<40||(!i||a.score<i.score)&&(i=a)}),i}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let i;return Array.from(Yi($o).call($o)).forEach(a=>{a.active||a.id===n||a.samples<40||(!i||a.score>i.score)&&(i=a)}),i}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let $S;function t3(e){const t=$o.get(e);t&&($o.delete(e),t.clearTimer())}const ZS=new Map,Bge=new Map,BN="video/h264",GN="video/h265";function n3(e,t,n){let i=new Uint8Array(e,t,n),a=[],l=0;for(;a.length<n;)l+3<n&&i[l]===0&&i[l+1]===0&&i[l+2]===3&&(i[l+3]===0||i[l+3]===1||i[l+3]===2||i[l+3]===3)?(a.push(i[l],i[l+1],i[l+3]),l+=4):(a.push(i[l]),l++);return new Uint8Array(a)}function r3(e){const t=e.length;let n=[],i=0;for(;i<t;)i+2<t&&e[i]===0&&e[i+1]===0&&(e[i+2]===0||e[i+2]===1||e[i+2]===2||e[i+2]===3)?(n.push(e[i],e[i+1],3,e[i+2]),i+=3):(n.push(e[i]),i++);return new Uint8Array(n)}function s3(e){if(e.length<5)return"";let t=-1;for(let a=0;a<e.length-3;a++){if(e[a]===0&&e[a+1]===0&&e[a+2]===1){t=a;break}if(a<e.length-4&&e[a]===0&&e[a+1]===0&&e[a+2]===0&&e[a+3]===1){t=a;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const i=e[n];return 128&i?"":(i>>1&63)>=32||n+1<e.length&&!(248&e[n+1])?GN:(31&i)<=31?BN:""}const e0=new Map,A_=new Map;(function(){const e=qt();Yr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Yr.getStreamFromExtension=e.name===Qt.CHROME&&Number(e.version)>34,Yr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Yr.supportMinBitrate=e.name===Qt.CHROME||e.name===Qt.EDGE,Yr.supportSetRtpSenderParameters=function(){const t=qt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Hc()||!(!ss()&&!xS())||t.name===Qt.FIREFOX&&Number(t.version)>=64)}(),e.name===Qt.SAFARI&&(Number(e.version)>=14?Yr.supportDualStream=!0:Yr.supportDualStream=!1),Yr.webAudioMediaStreamDest=function(){const t=qt();return!(t.name===Qt.SAFARI&&Number(t.version)<12)}(),Yr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Yr.supportWebGL=typeof WebGLRenderingContext<"u",Yr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Hc()||(Yr.webAudioWithAEC=!0),Yr.supportShareAudio=function(){const t=qt();return(t.os===zr.WIN_10||t.os===zr.WIN_81||t.os===zr.WIN_7||t.os===zr.LINUX||t.os===zr.MAC_OS||t.os===zr.CHROMIUM_OS)&&t.name===Qt.CHROME&&Number(t.version)>=74}(),Yr.supportDataChannel=!!(Wc(76)||zx(68)||XV(14)),Yr.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!An()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Yr.supportWebRTCEncodedTransform=Wc(87)||zV()||zx(117),Yr.supportWebRTCInsertableStream=function(){const t=qt();return(t.name===Qt.CHROME||t.name===Qt.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Yr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Yr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Yr.supportSuppressLocalAudioPlayback=GF(),Yr.supportRestrictOwnAudio=WF(),IS(()=>{Yr.supportDualStreamEncoding=function(){const t=qt();return!!j("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&j("CHROME_DUAL_STREAM_USE_ENCODING"))}(),w.debug("browser ua: ",navigator.userAgent),w.info("browser info: ",e),w.info("browser compatibility: ",Yr)})})();const Gge=["CHINA","GLOBAL"],i3=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Th=[],Mm=[];function bh(e,t){return!!t&&Th.some(n=>n.uid===e&&n.channelName===t)}function WN(){return Mm.length>0}var Wge=hU.forEach,a3=ry("forEach")?[].forEach:function(e){return Wge(this,e,arguments.length>1?arguments[1]:void 0)};an({target:"Array",proto:!0,forced:[].forEach!==a3},{forEach:a3});var Hge=Da("Array","forEach"),Kge=Td,zge=Bs,qge=k,Yge=Hge,HN=Array.prototype,Xge={DOMTokenList:!0,NodeList:!0},Qge=function(e){var t=e.forEach;return e===HN||qge(HN,e)&&t===HN.forEach||zge(Xge,Kge(e))?Yge:t},Jge=p(Qge),$ge=Mc,o3=ly;an({target:"Object",stat:!0,forced:f(function(){o3(1)})},{keys:function(e){return o3($ge(e))}});var Zge=p(fs.Object.keys),e_e=p(_k),t_e=p(vk),n_e=an,c3=Gg,r_e=by,s_e=rs,l3=tC,i_e=Sd,a_e=Ys,o_e=SR,c_e=Or,l_e=wd,d_e=nU("slice"),u_e=c_e("species"),KN=Array,h_e=Math.max;n_e({target:"Array",proto:!0,forced:!d_e},{slice:function(e,t){var n,i,a,l=a_e(this),u=i_e(l),h=l3(e,u),m=l3(t===void 0?u:t,u);if(c3(l)&&(n=l.constructor,(r_e(n)&&(n===KN||c3(n.prototype))||s_e(n)&&(n=n[u_e])===null)&&(n=void 0),n===KN||n===void 0))return l_e(l,h,m);for(i=new(n===void 0?KN:n)(h_e(m-h,0)),a=0;h<m;h++,a++)h in l&&o_e(i,a,l[h]);return i.length=a,i}});var p_e=Da("Array","slice"),m_e=k,f_e=p_e,zN=Array.prototype,g_e=function(e){var t=e.slice;return e===zN||m_e(zN,e)&&t===zN.slice?f_e:t},__e=p(g_e);function Ae(e,t,n,i,a){var l,u,h,m={};return Jge(l=Zge(i)).call(l,function(g){m[g]=i[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=e_e(u=t_e(h=__e(n).call(n)).call(h)).call(u,function(g,_){return _(e,t,g)||g},m),a&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(a):void 0,m.initializer=void 0),m.initializer===void 0?($M(e,t,m),null):m}let t0=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),qN=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Fa=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e}({}),ui=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),$e=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Bt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),He=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e}({}),Ye=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),wh=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),pt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e}({}),hi=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),yt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e}({});function n0(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw w.error("Invalid Channel Name ".concat(e)),new re(U.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function r0(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||sF(e,1,255)))throw new re(U.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&w.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Vl=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const E_e={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},YN={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function XN(e,t){Es(e.url,"".concat(t,".url"),1,1e3,!1),ir(e.x)||fn(e.x,"".concat(t,".x"),0,1e4),ir(e.y)||fn(e.y,"".concat(t,".y"),0,1e4),ir(e.width)||fn(e.width,"".concat(t,".width"),0,1e4),ir(e.height)||fn(e.height,"".concat(t,".height"),0,1e4),ir(e.zOrder)||fn(e.zOrder,"".concat(t,".zOrder"),0,255),ir(e.alpha)||fn(e.alpha,"".concat(t,".alpha"),0,1,!1)}const v_e={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Ld=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),QN=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Vr=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function d3(e){if(!e.channelName)throw new re(U.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new re(U.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Es(e.token,"info.token",1,2047),r0(e.uid),n0(e.channelName),!0}let bi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Fl=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),ki=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Um=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),ln=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),vr=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e}({}),s0=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Xr=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),tn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const u3=[tn.AFRICA,tn.ASIA,tn.CHINA,tn.EUROPE,tn.GLOBAL,tn.INDIA,tn.JAPAN,tn.NORTH_AMERICA,tn.OCEANIA,tn.OVERSEA,tn.SOUTH_AMERICA];let ks=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const i0={CHINA:{},ASIA:{CODE:ks.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ks.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ks.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ks.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ks.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ks.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ks.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ks.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ks.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ks.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ks.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ks.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ks.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};hN&&(i0.CHINA={CODE:ks.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Zo=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e}({});function h3(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class p3 extends Yn{constructor(t,n){super(),O(this,"onICEConnectionStateChange",void 0),O(this,"onConnectionStateChange",void 0),O(this,"onDTLSTransportStateChange",void 0),O(this,"onDTLSTransportError",void 0),O(this,"onICETransportStateChange",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoReceived",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstVideoRender",void 0),O(this,"onFirstVideoBufferReady",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"onICECandidateError",void 0),O(this,"getLocalVideoStats",void 0)}}class a0 extends p3{constructor(t,n){super(t,n),O(this,"establishPromise",void 0)}}let Ve=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),as=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Bl=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const m3=["disconnected","failed"];let ve=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),nn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Xe=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e}({}),yo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),So=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),os=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),jd=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),Fr=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Yc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Ba=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ec=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Vm=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),yr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Fm=function(e){return e.ABORT="abort",e}({}),Md=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),y_e=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const S_e={[t0.ACCESS_POINT]:{[ui.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ui.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ui.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ui.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ui.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ui.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ui.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[t0.UNILBS]:{[Fa.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Fa.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Fa.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Fa.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Fa.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Fa.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Fa.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Fa.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Fa.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Fa.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Fa.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Fa.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[Fa.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[t0.STRING_UID_ALLOCATOR]:{[qN.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[qN.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[qN.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Bm(e){const t=S_e[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===t0.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const T_e={[$e.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[$e.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[$e.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[$e.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[$e.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[$e.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[$e.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[$e.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[$e.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[$e.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[$e.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[$e.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[$e.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[$e.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[$e.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[$e.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[$e.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[$e.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[$e.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[$e.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[$e.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[$e.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[$e.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[$e.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[$e.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[$e.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[$e.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[$e.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[$e.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[$e.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[$e.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[$e.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[$e.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[$e.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[$e.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[$e.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[$e.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[$e.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[$e.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[$e.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[$e.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[$e.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[$e.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[$e.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[$e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[$e.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[$e.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[$e.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[$e.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[$e.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[$e.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[$e.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[$e.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[$e.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[$e.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[$e.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[$e.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[$e.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[$e.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[$e.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[$e.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[$e.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[$e.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[$e.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[$e.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Ch(e){return T_e[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function f3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function JN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f3(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function $N(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:a}=e;if(t){const l=j("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(i,"/ws/?p=").concat(Number(a)+150):"wss://".concat(i,":").concat(l,"/ws/?p=").concat(Number(a)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(a):"wss://".concat(i,":").concat(a)}const b_e=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,w_e=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,C_e=/wss:\/\/(.+):([0-9]+)\/?/,R_e=/wss:\/\/(.[^\/]+)\/?/;let x_e=0;class N_e{constructor(t,n){O(this,"id",0),O(this,"store",void 0),O(this,"recordIndex",void 0),O(this,"websockets",[]),O(this,"try443PortDuration",2e3),O(this,"forceCloseWSDuration",5e3),O(this,"try443PortTimeout",null),O(this,"forceCloseTimeout",null),O(this,"isTry443PortFailed",!1),O(this,"isNormalPortFailed",!1),O(this,"useDoubleDomain",!1),O(this,"useProxy",!1),O(this,"startTime",Date.now()),this.id=++x_e,this.try443PortDuration=j("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,a=new Array(i),l=0;l<i;l++)a[l]=arguments[l];w.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...a)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const a=j("GATEWAY_DOMAINS"),l=Date.now(),u=[],h=a.find(S=>{var T;return Ee(T=t.host).call(T,S)});h||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)a.forEach(S=>{m.push($N(JN(JN({},t),{},{host:t.host.replace(h,S)}),n))});else{const S=JN({},t);if(n&&h){const T=a.find(P=>P!==h);T&&(S.host=S.host.replace(h,T))}m.push($N(S,n))}try{m.forEach(S=>{const T=new WebSocket(S);T.binaryType="arraybuffer",u.push(T),this.logger("ws is connecting:",T.url)})}catch(S){if(this.logger("ws create failed"),u.forEach(T=>T.close()),u.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new re(U.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}const g=E_();this.store&&this.store.recordJoinChannelService({urls:u.map(S=>S.url),service:"gateway"},this.recordIndex),u.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(T=>{T!==S&&(T.onopen=null,T.onclose=null,T.onmessage=null,T.close(),this.logger("close backup websocket: ".concat(T.url)))}),this.websockets.length=0,g.resolve(S)},S.onclose=T=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(S.readyState));const P=u.every(x=>x.readyState===WebSocket.CLOSED||x.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(P)),P&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(T.reason)),g.reject({code:T.code,reason:s0.A_ROUND_WS_FAILED})):!n&&P&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),v()),n?this.isTry443PortFailed=P:this.isNormalPortFailed=P},S.onmessage=T=>this.logger("".concat(S.url," onmessage: ").concat(T.data))}),this.websockets.push(...u);const _=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},v=()=>{if(g.isResolved)return _();qt().os===zr.MAC_OS&&An()&&_(),this.createWebSocket(t,!0,!0).then(S=>{g.resolve(S)}).catch(S=>{this.isNormalPortFailed&&g.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",g.isResolved),this.try443PortTimeout=null,v()},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(t,n,i,a){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(l){let u,h,m;return[,u,h,m]=l.match(b_e)||[],u||([,h,m]=l.match(w_e)||[]),h&&m||([,h,m]=l.match(C_e)||[]),h&&m||([,h]=l.match(R_e)||[]),h||w.warning("un-destructible url: ",l),{proxy:u,host:h,port:m||"443"}}(t)),this.recordIndex=a,this.useProxy=!!t.proxy,i&&this.useProxy&&(w.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function g3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}class _3 extends Yn{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Ee(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(yt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(yt.CONNECTED):this._state==="closed"?this.emit(yt.CLOSED):this._state==="failed"&&this.emit(yt.FAILED))}resetReconnectCount(t){w.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],u=arguments.length>5?arguments[5]:void 0;super(),O(this,"_websocketUrl",null),O(this,"connectionID",0),O(this,"currentURLIndex",0),O(this,"urls",[]),O(this,"_reconnectMode","tryNext"),O(this,"reconnectReason",void 0),O(this,"_initMutex",void 0),O(this,"name",void 0),O(this,"_state","closed"),O(this,"reconnectInterrupter",void 0),O(this,"websocket",void 0),O(this,"retryConfig",void 0),O(this,"reconnectCount",0),O(this,"forceCloseTimeout",5e3),O(this,"onlineReconnectListener",void 0),O(this,"useCompress",void 0),O(this,"tryDoubleDomain",!1),O(this,"use443PortOnly",!1),O(this,"wsInflateLength",0),O(this,"wsDeflateLength",0),O(this,"closeEstablishingWs",()=>{}),O(this,"store",void 0),O(this,"joinGatewayRecordIndex",void 0),this.store=u,this.name=t,this.retryConfig=function(v){for(var S=1;S<arguments.length;S++){var T=arguments[S]!=null?arguments[S]:{};S%2?g3(Object(T),!0).forEach(function(P){O(v,P,T[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(T)):g3(Object(T)).forEach(function(P){Object.defineProperty(v,P,Object.getOwnPropertyDescriptor(T,P))})}return v}({},n),this.useCompress=i,this.tryDoubleDomain=a,this.use443PortOnly=l,this._initMutex=new is("websocket",u?u.clientId:void 0);const{timeout:h,timeoutFactor:m}=n,g=Math.max(300,Math.floor(3*h/5)),_=Math.max(1.2,Math.floor(8*m)/10);ci.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=_),ar.on(lh.NETWORK_STATE_CHANGE,(v,S)=>{v!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(v)),v===ci.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var a;const l=E_(),u=this.urls[this.currentURLIndex];(a=this.store)===null||a===void 0||a.beforeConnect(),function(h){return!(US()||j("USE_NEW_TOKEN")||!j("ENABLE_PREALLOC_PC")&&(h==null||!h.autoSubscribe||j("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(Fr.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(l.resolve).catch(l.reject),this.once(yt.CLOSED,()=>{l.reject(new ae(U.WS_DISCONNECT))}),this.once(yt.CONNECTED,l.resolve),await l.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void w.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),w.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ae(U.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new ae(U.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=E_();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const a=_=>{var v;(v=this.store)===null||v===void 0||v.signalChannelOpen(),w.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},l=async _=>{var v;if(w.debug("[".concat(this.name,"] websocket close ").concat((v=this.websocket)===null||v===void 0?void 0:v.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new ae(U.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=Ji(this,yt.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,T=await this.reconnectWithAction(S);if(this.state==="closed")return void w.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return i.reject(new ae(U.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);i.resolve()}},u=_=>{this.emit(yt.ON_MESSAGE,_)},h=_=>{w.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),j("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=j("GATEWAY_WSS_ADDRESS")),w.debug("[".concat(this.name,"] start connect, url:"),t);const m=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var g;this._websocketUrl=$N(t);const _=await this.chooseBestWebsocketConnection(t);this.websocket=_,a&&a(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=u,this.websocket.onerror=h,(g=this.store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(_){const v=this.state==="closed",S=_ instanceof ae,T=S&&_.code===U.WS_ABORT,P=S&&_.code===U.WS_ERR,x=S?_.message:_&&(_.reason||_.toString());w.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(x)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[_]},m),v||P?(i.reject(v?new ae(U.WS_DISCONNECT,"websocket is closed: ".concat(x)):new ae(U.WS_ERR,"init websocket failed: ".concat(x))),P&&w.error("[".concat(this.name,"] init websocket failed: ").concat(x))):l&&l(_)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;w.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||ar.isOnline||!ar.onlineWaiter||(this.onlineReconnectListener=ar.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const u=AS(this.reconnectCount,this.retryConfig);w.debug("[".concat(this.name,"] wait ").concat(u,"ms to reconnect websocket, mode: ").concat(t)),await Ne.race([qr(u),this.onlineReconnectListener||new Ne(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const a=async(u,h)=>{this.emit(yt.RECONNECT_CREATE_CONNECTION,h),await this.createWebSocketConnection(u)};try{if(t==="retry")await a(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);w.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await a(this.urls[this.currentURLIndex],t)}else t==="recover"&&(w.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Pr(this,yt.REQUEST_NEW_URLS),this.currentURLIndex=0,await a(this.urls[this.currentURLIndex],t))}catch(u){var l;w.error("[".concat(this.name,"] reconnect failed ").concat(u&&u.toString()));const h=u==null||(l=u.data)===null||l===void 0?void 0:l.desc;if(Array.isArray(h)){if(Ee(h).call(h,"dynamic key expired"))return this.emit(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(Ee(h).call(h,"request downgrade fallback"))return this.emit(yt.ON_FALLBACK),!1}return this.reconnectWithAction(t,n)}return!0}}class ZN extends _3{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=E_(),a=function(u,h){return new N_e(u,h)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),a.closeAllWebsockets(),i.reject(new ae(U.WS_ABORT,"choose best websocket aborted"))};const l=j("GATEWAY_DOMAINS");return w.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),a.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class O_ extends _3{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new Ne((i,a)=>{let l=!1;const u=[];this.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),u.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),a(new ae(U.WS_ABORT,"choose best websocket aborted"))};const h=j("GATEWAY_DOMAINS");let m;const g=t.indexOf("?h="),_=h.find(P=>g!==-1?Ee(t).call(t,P,g):Ee(t).call(t,P));w.debug("[choose-best-ws] currentDomain: ",_,", domains: ",h);let v=!this.tryDoubleDomain||!_;if(!v&&_){var S;const P=Date.now();try{h.forEach(x=>{const N=g===-1?t.replace(_,x):t.substr(0,g)+t.substr(g).replace(_,x),M=new WebSocket(N);M.binaryType="arraybuffer",u.push(M),w.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(w.debug("[choose-best-ws] ws create failed, fallback to single url"),u.forEach(N=>N.close());u.length;)u.pop();v=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:u.map(x=>x.url),service:"gateway"},n),u.forEach(x=>{x.onopen=()=>{if(l)return;const N=Date.now()-P;w.debug("[choose-best-ws] ws open cost ".concat(N,"ms")),u.filter(M=>M!==x).forEach(M=>{w.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),l=!0,i(x)},x.onclose=N=>{m=N,!l&&(u.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(w.debug("[choose-best-ws] all websocket is closed"),l=!0,a(m)))},x.onmessage=N=>{w.debug("[choose-best-ws]".concat(x.url," onmessage: ").concat(N.data))}}),qr(this.forceCloseTimeout).then(()=>{u.forEach(x=>{x.readyState!==WebSocket.OPEN&&x.close()})})}if(v){var T;let P;w.debug("[choose-best-ws] use single url: ",t),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[t],service:"gateway"},n);try{P=new WebSocket(t),u.push(P),P.binaryType="arraybuffer"}catch(x){const N=new ae(U.WS_ERR,"init websocket failed! Error: ".concat(x.toString()));return w.error("[".concat(this.name,"]").concat(N)),void a(N)}P.onopen=()=>{i(P)},P.onclose=x=>{a(x)},P.onmessage=x=>{w.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(x.data))},qr(this.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class E3 extends Yn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Bt.CONNECTED?this.emit(He.WS_CONNECTED):t===Bt.RECONNECTING?this.emit(He.WS_RECONNECTING,this._websocketReconnectReason):t===Bt.CLOSED&&this.emit(He.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),O(this,"__name__","AgoraRTCSignal"),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Bt.CLOSED),O(this,"reconnectToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new iN(5)),O(this,"pingpongTimer",void 0),O(this,"wsInflateDataTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"ortc",void 0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(He.ON_BINARY_DATA,i.data);const a=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const l="res-@".concat(a._id);this.emit(l,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){if(this.emit(a._type,a._message),a._type===pt.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===pt.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(Ft.UID_BANNED);break;case 15:this.close(Ft.IP_BANNED);break;case 16:this.close(Ft.CHANNEL_BANNED)}if(a._type===pt.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case $e.ERR_LICENSE_MISSING:this.close(Ft.LICENSE_MISSING);break;case $e.ERR_LICENSE_EXPIRED:this.close(Ft.LICENSE_EXPIRED);break;case $e.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ft.LICENSE_MINUTES_EXCEEDED);break;case $e.ERR_LICENSE_PERIOD_INVALID:this.close(Ft.LICENSE_PERIOD_INVALID);break;case $e.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ft.LICENSE_MULTIPLE_SDK_SERVICE);break;case $e.ERR_LICENSE_ILLEGAL:this.close(Ft.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new ZN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Bt.CONNECTED&&this.reconnect("retry",Rs.OFFLINE)})}async request(t,n,i,a){const l=on(6,""),u={_id:l,_type:t,_message:n},h=this.websocket.connectionID,m=()=>new Ne((P,x)=>{if(this.connectionState===Bt.CONNECTED)return P();const N=()=>{this.off(He.WS_CLOSED,M),P()},M=()=>{this.off(He.WS_CONNECTED,N),x(new re(U.WS_ABORT))};this.once(He.WS_CONNECTED,N),this.once(He.WS_CLOSED,M),t!==Ye.PUBLISH&&t!==Ye.PUBLISH_DATASTREAM&&t!==Ye.SUBSCRIBE&&t!==Ye.SUBSCRIBE_DATASTREAM&&t!==Ye.UNSUBSCRIBE&&t!==Ye.UNSUBSCRIBE_DATASTREAM&&t!==Ye.UNPUBLISH&&t!==Ye.UNPUBLISH_DATASTREAM&&t!==Ye.CONTROL&&t!==Ye.RESTART_ICE||this.once(He.DISCONNECT_P2P,()=>{x(new re(U.DISCONNECT_P2P))}),t!==Ye.PUBLISH&&t!==Ye.RESTART_ICE||this.once(He.ABORT_P2P_EXECUTION,()=>{x(new re(U.DISCONNECT_P2P))})});if(this.connectionState!==Bt.CONNECTING&&this.connectionState!==Bt.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await m(),this.websocket.sendMessage(u,!0),a)return;const g=new Ne((P,x)=>{let N=!1;const M=(q,J)=>{N=!0,P({isSuccess:q==="success",message:J||{}}),this.off(He.WS_CLOSED,F),this.off(He.WS_RECONNECTING,F),this.emit(He.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),M);const F=()=>{x(new re(U.WS_ABORT,"type: ".concat(t))),this.off(He.WS_CLOSED,F),this.off(He.WS_RECONNECTING,F),this.off("res-@".concat(l),M)};this.once(He.WS_CLOSED,F),this.once(He.WS_RECONNECTING,F),qr(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||N||(w.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(He.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(P){if(this.connectionState===Bt.CLOSED||t===Ye.LEAVE)throw new re(U.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?P.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await m(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),S=Ch(v),T=new re(U.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:v,data:_.message,desc:S.desc});return S.action==="success"?_.message:(w.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(S.desc,", action: ").concat(S.action)),v===$e.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=T,this.close()),T.throw()):S.action==="failed"?T.throw():S.action==="quit"?(this.initError=T,this.close(),T.throw()):(v===$e.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Rs.MULTI_IP)):this.reconnect(S.action,Rs.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ne(i=>{const a=l=>{(!n||n(l))&&(this.off(t,a),i(l))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(wh.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Bt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ne((n,i)=>{this.once(He.WS_CONNECTED,()=>n(this.joinResponse)),this.once(He.WS_CLOSED,a=>i(this.initError||new re(U.WS_ABORT,a))),this.connectionState=Bt.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ft.LEAVE,this.connectionState=Bt.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(He.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Pr(this,He.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(Ye.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!n)return this.emit(He.REPORT_JOIN_GATEWAY,s0.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(He.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new re(U.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=dh(this,He.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ye.REJOIN,t);return!!n&&(this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(pt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(pt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(pt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(pt.MUTE_AUDIO,{uid:i.uid}):this.emit(pt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(pt.MUTE_VIDEO,{uid:i.uid}):this.emit(pt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(pt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(pt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(pt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(pt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(pt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Ye.DOWNGRADE_CODEC,n)}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ch(t.code);if(t.code===28&&"detail"in t&&(w.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(He.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===$e.ERR_REPEAT_JOIN_CHANNEL&&j("IGNORE_UID_CHECK")?void this.close(Ft.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ft.UID_BANNED),void this.close()):t.code===$e.K_VOS_FALLBACK&&"detail"in t?(w.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&j("ENABLE_QUALITY_FALLBACK")?void Pr(this,He.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",n.desc)}).catch(i=>{w.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),i)}):t.detail==="fallback_hls"&&j("ENABLE_FALLBACK_TO_HLS")?(this.emit(He.VOS_FALLBACK,t.detail),void this.close(Ft.FALLBACK_TO_HLS)):this.reconnect(n.action,n.desc)):void this.reconnect(n.action,Rs.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Rs.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),j("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(wh.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(yt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(He.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(yt.CLOSED,()=>{this.connectionState=Bt.CLOSED}),this.websocket.on(yt.FAILED,()=>{this._disconnectedReason=Ft.NETWORK_ERROR,this.connectionState=Bt.CLOSED}),this.websocket.on(yt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Bt.CONNECTED?this.connectionState=Bt.RECONNECTING:this.connectionState=Bt.CONNECTING}),this.websocket.on(yt.WILL_RECONNECT,(t,n,i)=>{const a=dh(this,He.IS_P2P_DISCONNECTED),l=a||t!=="retry";a&&t==="retry"&&(w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=s0.P2P_DISCONNECTED),l&&(w.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(He.REPORT_JOIN_GATEWAY,n||s0.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(He.DISCONNECT_P2P)),i(t)}),this.websocket.on(yt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Rs.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(He.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof re){if(t.code===U.UNEXPECTED_RESPONSE&&t.data.code===$e.ERR_NO_AUTHORIZED)return this.initError=new re(U.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ft.TOKEN_EXPIRE);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Rs.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(yt.REQUEST_NEW_URLS,(t,n)=>{Pr(this,He.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Fr.PRE_CONNECT_PC,()=>{this.emit(He.PRE_CONNECT_PC)}),this.websocket.on(yt.ON_FALLBACK,()=>{j("ENABLE_FALLBACK_TO_HLS")&&this.emit(He.VOS_FALLBACK,"fallback_hls")})}}let I_e=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Rr=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function v3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function o0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v3(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let eI=0;function To(e){const t=j("TURN_DOMAINS");eI=(eI+1)%t.length;const n=t[eI]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(n):(w.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function c0(e){try{const t=j("TURN_DOMAINS"),n=j("GATEWAY_DOMAINS").concat(t).find(i=>Ee(e).call(e,i));return n?e.split(".".concat(n))[0].replace(/-/g,"."):e}catch{return w.debug("serverUrlToIp error, fallback to url",e),e}}function tI(e,t){e.addresses||(e.addresses=[]);const n=function(h,m){if(j("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return h.map(v=>{let{ip:S,port:T}=v;return{address:"".concat(S,":").concat(T)}});const g=j("GATEWAY_DOMAINS");let _=g[1]&&Ee(m).call(m,g[1])?1:0;return h.map(v=>{let{domain_prefix:S,port:T,ip:P}=v;if(S)return{address:"".concat(S,".").concat(g[_++%g.length],":").concat(T)};const x=/^[\.\:\d]+$/.test(P),N=x?"".concat(P.replace(/[^\d]/g,"-"),".").concat(g[_++%g.length],":").concat(T):"".concat(P,":").concat(T);return x||w.debug("Cannot recognized as ip address: ".concat(P,", use as host3")),{ip:P,port:T,address:N}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const h=i.split(";");for(let m=0;m<h.length;m++){var a;const g=ai(a=h[m]).call(a);n[m]&&g&&(n[m].ip6=g)}}const l=e.detail&&e.detail.candidate;let u;if(l){const[h,m]=l.split(":");h&&m&&(u={port:Number(m),ip:h,address:"".concat(h,":").concat(m)})}return{gatewayAddrs:n,apGatewayAddress:u,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function wi(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function y3(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(wi(t.width),"x").concat(wi(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function l0(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function P_(e,t){let n,i,a;switch(t){case Rr.CHOOSE_SERVER:i=4096,a="choose server";break;case Rr.CLOUD_PROXY:i=1048576,a="proxy";break;case Rr.CLOUD_PROXY_5:i=4194304,a="proxy5";break;case Rr.CLOUD_PROXY_FALLBACK:i=4194310,a="proxy fallback";break;default:throw new re(U.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===i&&(n={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(u=>o0(o0({},u),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:o0(o0({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!n)throw new re(U.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(a," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function S3(e,t){return await Ne.all(e.addresses.map(async n=>({address:To(n.ip),tcpport:n.port,udpport:n.port,username:t&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():xs.username,password:t&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await $x(t.toString()):xs.password})))}function nI(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,a=t.videoWidth||n.width;return i&&a?Math.max(Math.min(i,a)/Math.min(wi(e.height),wi(e.width)),1):(w.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ud(e){let{candidateType:t,relayProtocol:n,type:i,address:a,port:l,protocol:u}=e;const h={candidateType:t,relayProtocol:n,protocol:u};if(i!=="local-candidate"){const m=a.split(".");m.length>=4&&(m[1]="*",m[2]="*"),h.address=m.join("."),h.port=l}return h}function Xc(e){const t=e.split(":"),n=e.split(/[-.]/),i=Ee(e).call(e,"-")?"-":".";let a=e;return t.length>1?n.length>1?(n[1]="**",a=n[0]+i+"**:"+t[t.length-1]):a=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(a=n[0]+i+"**"),a}function T3(e,t){return e.getTransceivers().find(n=>n.sender.track===t||n.receiver.track===t)}function D_(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j("SVC_MODE");if(j("ENABLE_SVC"))return function(t){return t in DS}(e)?e:DS.L1T3}const b3={[Ve.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Ve.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function w3(e){e.send&&(Gm(Ve.VIDEO,e.send.videoExtensions),Gm(Ve.AUDIO,e.send.audioExtensions)),e.recv&&(Gm(Ve.VIDEO,e.recv.videoExtensions),Gm(Ve.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(Gm(Ve.VIDEO,e.sendrecv.videoExtensions),Gm(Ve.AUDIO,e.sendrecv.audioExtensions))}function C3(e,t){e.send&&(d0(Ve.VIDEO,e.send.videoExtensions,t.send.videoExtensions),d0(Ve.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(d0(Ve.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),d0(Ve.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function d0(e,t,n){t.forEach(i=>{var a;const l=b3[e].find(h=>{var m;let{key:g}=h;return Ee(m=i.extensionName).call(m,g)});if(!l)return;const u=n.find(h=>{let{extensionName:m}=h;return Ee(m).call(m,l.key)});u&&Ee(a=u.extensionName).call(a,"gdpr_forbidden")&&(i.extensionName=u.extensionName)})}function Gm(e,t){t.forEach(n=>{var i;const a=b3[e].find(l=>{var u;let{key:h}=l;return Ee(u=n.extensionName).call(u,h)});Ee(i=n.extensionName).call(i,"gdpr_forbidden")&&a&&(n.extensionName=a.extensionName)})}function R3(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Ee(e).call(e,"abs-send-time")}function u0(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Ee(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function x3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function N3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x3(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function k_(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:a,filterVideoFec:l,filterAudioFec:u,filterAudioCodec:h,filterVideoCodec:m,unsupportedVideoUplinkCodec:g,unsupportedVideoDownlinkCodec:_}=t,{useXR:v}=n;let S=[],T=[],P=[],x=[],N=!1,M=!1;if(li(e).mediaDescriptions.forEach(q=>{i&&i!==q.attributes.direction||(q.media.mediaType!=="video"||N||(T=q.attributes.payloads,x=q.attributes.extmaps,N=!0),q.media.mediaType!=="audio"||M||(S=q.attributes.payloads,P=q.attributes.extmaps,M=!0))}),!x||T.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(T.forEach(q=>{var J;(J=q.rtpMap)!==null&&J!==void 0&&J.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),v&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var J;(J=q.rtpMap)!==null&&J!==void 0&&J.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),v&&q.rtcpFeedbacks.push({type:"rrtr"})}),a&&(S=S.filter(q=>{var J;return((J=q.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())!=="rtx"}),T=T.filter(q=>{var J;return((J=q.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())!=="rtx"})),l){const q=T.filter(Y=>{var ne;return/(red)|(ulpfec)|(flexfec)/i.test(((ne=Y.rtpMap)===null||ne===void 0?void 0:ne.encodingName)||"")}),J=Vd(q,T).map(Y=>Y.payloadType),te=[...q.map(Y=>Y.payloadType),...J];T=T.filter(Y=>!Ee(te).call(te,Y.payloadType))}if(u&&(S=S.filter(q=>{var J;return!/(red)|(ulpfec)|(flexfec)/i.test(((J=q.rtpMap)===null||J===void 0?void 0:J.encodingName)||"")})),h&&(h==null?void 0:h.length)>0&&(S=S.filter(q=>{var J;return Ee(h).call(h,((J=q.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){const q=T.filter(J=>{var te;return Ee(m).call(m,((te=J.rtpMap)===null||te===void 0?void 0:te.encodingName.toLowerCase())||"")});T=q.concat(a?[]:Vd(q,T))}const F=j("UNSUPPORTED_VIDEO_CODEC");if(F&&F.length>0){const q=T.filter(Y=>Y.rtpMap&&Ee(F).call(F,Y.rtpMap.encodingName.toLowerCase())),J=Vd(q,T),te=q.concat(J).map(Y=>Y.payloadType);T=T.filter(Y=>!Ee(te).call(te,Y.payloadType)),w.debug("unsupportedVideoCodec: ".concat(F,", toBeRemoved: ").concat(te))}if(g&&g.length>0&&i==="sendonly"){const q=T.filter(Y=>Y.rtpMap&&Ee(g).call(g,Y.rtpMap.encodingName.toLowerCase())),J=Vd(q,T),te=q.concat(J).map(Y=>Y.payloadType);T=T.filter(Y=>!Ee(te).call(te,Y.payloadType)),w.debug("unsupportedVideoUplinkCodec: ".concat(g,", toBeRemoved: ").concat(te))}if(_&&_.length>0&&i==="recvonly"){const q=T.filter(Y=>Y.rtpMap&&Ee(_).call(_,Y.rtpMap.encodingName.toLowerCase())),J=Vd(q,T),te=q.concat(J).map(Y=>Y.payloadType);T=T.filter(Y=>!Ee(te).call(te,Y.payloadType)),w.debug("unsupportedVideoDownlinkCodec: ".concat(_,", toBeRemoved: ").concat(te))}return{audioCodecs:S,videoCodecs:T,audioExtensions:P,videoExtensions:x}}function Qc(e){const t=li(e);let n,i;for(const a of t.mediaDescriptions){if(!n){const l=a.attributes.iceUfrag,u=a.attributes.icePwd;if(!l||!u)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:l,icePwd:u}}if(!i){const l=a.attributes.fingerprints;l.length>0&&(i={fingerprints:l})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function rI(e,t){const n=[],i=e.attributes.ssrcGroups.filter(u=>u.semantic==="FID"),a=e.attributes.ssrcGroups.find(u=>u.semantic==="SIM"),l=e.attributes.ssrcs;if(a)a.ssrcIds.forEach(u=>{var h;const m=(h=i.find(g=>g.ssrcIds[0]===u))===null||h===void 0?void 0:h.ssrcIds[1];n.push({ssrcId:u,rtx:t?m:void 0})});else if(i.length>0){const u=i[0].ssrcIds[0],h=i[0].ssrcIds[1];n.push({ssrcId:u,rtx:t?h:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:l[0].ssrcId})}return n}function I3(e,t,n){const{cname:i}=e;let a=[];t&&(a=A3(t)),a.length===0&&(a=e.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),w.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},u={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let h;switch(e.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}const m=j_(e.rtpCapabilities),g=[];return Array.isArray(n)&&n.length>0&&n.forEach(_=>{g.push({kind:Ve.VIDEO,ssrcMsg:[{ssrcId:_.v,rtx:_.v_rtx}],mslabel:"".concat(_.v,"_").concat(_.a)},{kind:Ve.AUDIO,ssrcMsg:[{ssrcId:_.a}],mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:l,iceParameters:u,candidates:a,rtpCapabilities:m,setup:h,cname:i,preSSRCs:g}}function A3(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(Xc(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(Xc(e.ip6),":").concat(e.port)))),t}function L_(e,t,n){const i=[],a=[];return e.forEach(l=>{let{ssrcId:u,rtx:h}=l;const m=on(8,"track-"),g={ssrcId:u,attributes:N3({label:m,mslabel:n=n||on(10,""),msid:"".concat(n," ").concat(m)},t&&{cname:t})};if(i.push(g),h!==void 0){const _={ssrcId:h,attributes:N3({label:m,mslabel:n,msid:"".concat(n," ").concat(m)},t&&{cname:t})};i.push(_),a.push({semantic:"FID",ssrcIds:[u,h]})}}),e.length>1&&a.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:u}=l;return u})}),{ssrcs:i,ssrcGroups:a}}function Rh(e,t){t instanceof gr&&e.attributes.payloads.forEach(n=>{var i;const a=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!a||["opus","pcmu","pcma","g722"].indexOf(a)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),a==="opus"&&typeof j("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=j("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&(a!=="pcmu"&&a!=="pcma"&&a!=="g722"&&(l.bitrate&&!An()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof I_&&a==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function sI(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function iI(e,t){var n;if(e.attributes.payloads.forEach(a=>{var l;((l=a.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())==="h264"&&a.fmtp&&a.fmtp.parameters&&j("ENABLE_UP_SPS_PPS")&&(a.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof _n&&t._encoderConfig&&t._hints.indexOf(sn.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;jt().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(a=>{var l,u;Ee(l=["h264","h265","vp8","vp9","av1"]).call(l,((u=a.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),jt().supportMinBitrate&&!Ee(n=t._hints).call(n,sn.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(a=>{var l,u;Ee(l=["h264","h265","vp8","vp9","av1"]).call(l,((u=a.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-start-bitrate"]="".concat(j("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function O3(e){if(e.media.mediaType!=="video")return;const t=qt();if(t.name!==Qt.SAFARI&&t.os!==zr.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function h0(e,t,n){if(!t)return;let i,a;if(e.media.mediaType==="video"?(i=n.videoExtensions,a=n.videoCodecs):(i=n.audioExtensions,a=n.audioCodecs),t.twcc===!0){const l=i.find(u=>u0(u.extensionName));if(l){const u=l.extensionName;e.attributes.extmaps.find(m=>u0(m.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:u}),function(m,g){return g.filter(_=>!!m.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(S=>S.type==="transport-cc")))}(a,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="transport-cc")||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(u=>u0(u.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}if(t.remb===!0){const l=i.find(u=>R3(u.extensionName));if(l){const u=l.extensionName;e.attributes.extmaps.find(m=>m.extensionName===u)||e.attributes.extmaps.push({entry:l.entry,extensionName:u}),function(m,g){return g.filter(_=>!!m.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(S=>S.type==="goog-remb")))}(a,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="goog-remb")||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(u=>R3(u.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}}function aI(e,t,n){if(An()||e.media.mediaType!=="video"||!(t instanceof _n)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!j("SIMULCAST")||n==="vp9"&&j("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,a=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(h=>h.semantic==="FID"&&h.ssrcIds[0]===a.ssrcId),u={semantic:"SIM",ssrcIds:[a.ssrcId]};for(let h=1;h<i;h++)e.attributes.ssrcs.push({ssrcId:a.ssrcId+h,attributes:On(a.attributes)}),u.ssrcIds.push(a.ssrcId+h),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+h,attributes:On(a.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[a.ssrcId+h,l.ssrcIds[1]+h]}));e.attributes.ssrcGroups.unshift(u)}async function P3(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:DS.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=li(t.sdp).mediaDescriptions[0];if(!n)return;const i=n.attributes.extmaps.find(a=>a.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),i}catch{return}}async function oI(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:a,recv:l,sendrecv:u}=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const _=k_(g,h,m,"sendonly"),v=k_(g,h,m,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bo(_,v,"videoExtensions",S,T,P),bo(_,v,"videoCodecs",S,T,P),bo(_,v,"audioExtensions",S,T,P),bo(_,v,"audioCodecs",S,T,P),j("RAISE_H264_BASELINE_PRIORITY")){const x=[],N=[];if(P.videoCodecs.forEach((M,F)=>{var q;if(((q=M.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"){var J,te;const Y=P.videoCodecs[F+1],ne=Y&&j3(M,Y),ue=(J=M.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"],fe=(te=M.fmtp)===null||te===void 0?void 0:te.parameters["packetization-mode"];!ue||ue!==j("FIRST_H264_PROFILE_LEVEL_ID")||j("FIRST_PACKETIZATION_MODE")&&fe!==j("FIRST_PACKETIZATION_MODE")?ne?N.push([M,Y]):N.push([M]):ne?x.push([M,Y]):x.push([M])}}),x.length>0&&N.length>0){w.debug("raising H264 baseline profile priority"),P.videoCodecs.forEach((F,q)=>{var J;if(((J=F.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"){const te=j3(F,P.videoCodecs[q+1]),Y=x.shift()||N.shift()||[];Y.length>0&&(te?P.videoCodecs.splice(q,2,...Y):P.videoCodecs.splice(q,1,...Y))}});const M=T.videoCodecs.filter(F=>{var q,J;return((q=F.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((J=F.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"])!==j("FIRST_H264_PROFILE_LEVEL_ID")});if(M.length>0){const F=Vd(M,T.videoCodecs).map(J=>J.payloadType),q=[...M.map(J=>J.payloadType),...F];T.videoCodecs=T.videoCodecs.filter(J=>!Ee(q).call(q,J.payloadType))}j("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(F=>{var q,J;return!(((q=F.rtpMap)===null||q===void 0?void 0:q.encodingName.toLocaleLowerCase())==="h264"&&((J=F.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"])!==j("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:S,recv:T,sendrecv:P}}return{send:S,recv:T,sendrecv:P}}(e,t,i);try{n.close()}catch{}return{send:a,recv:l,sendrecv:u}}function D3(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=k_(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bo(e,t,"videoExtensions",n,i,a),bo(e,t,"videoCodecs",n,i,a),bo(e,t,"audioExtensions",n,i,a),bo(e,t,"audioCodecs",n,i,a),j("RAISE_H264_BASELINE_PRIORITY")){const l=a.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const u=a.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(u<l){w.debug("raising H264 baseline profile priority");const h=a.videoCodecs[l];a.videoCodecs.splice(l,1),a.videoCodecs.splice(u,0,h)}u!==-1&&(i.videoCodecs=i.videoCodecs.filter(h=>!(h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:a}}function bo(e,t,n,i,a,l){if(n==="videoExtensions"||n==="audioExtensions"){const u=[];return e[n].forEach(h=>{t[n].some((m,g)=>{if(h.entry===m.entry&&h.extensionName===m.extensionName)return u.push(g),!0})?l[n].push(h):i[n].push(h)}),void t[n].forEach((h,m)=>{u.indexOf(m)===-1&&a[n].push(h)})}if(n==="videoCodecs"||n==="audioCodecs"){const u=[];return e[n].forEach(h=>{t[n].some((m,g)=>{if(h.payloadType===m.payloadType&&JSON.stringify(h)===JSON.stringify(m))return u.push(g),!0})?l[n].push(h):i[n].push(h)}),void t[n].forEach((h,m)=>{u.indexOf(m)===-1&&a[n].push(h)})}}function j_(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let a,l;return t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...i.audioCodecs],a.videoCodecs=[...t.videoCodecs,...i.videoCodecs],a.audioExtensions=[...t.audioExtensions,...i.audioExtensions],a.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):a=On(i),n?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...n.audioCodecs,...i.audioCodecs],l.videoCodecs=[...n.videoCodecs,...i.videoCodecs],l.audioExtensions=[...n.audioExtensions,...i.audioExtensions],l.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):l=On(i),{send:a,recv:l}}function Wm(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function M_(e,t,n,i){let a=[];if(e===Ve.VIDEO){if(j("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(a=t.videoCodecs.filter(l=>{var u;return Ee(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,i)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===j("H264_PROFILE_LEVEL_ID")})),!Array.isArray(a)||a.length===0){let l=[];const u=[],h=[],m=[];if(n.videoCodecs.forEach(g=>{const _=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"";Ee(_).call(_,i)?l.push(g):Ee(_).call(_,"vp9")?u.push(g):Ee(_).call(_,"vp8")?h.push(g):Ee(_).call(_,"h264")&&m.push(g)}),l.length===0){let g="";u.length!==0?(l=u,g="vp9"):h.length!==0?(l=h,g="vp8"):m.length!==0&&(l=m,g="h264"),w.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(g))}l.length!==0&&(a=t.videoCodecs.filter(g=>l.some(_=>_.payloadType===g.payloadType)))}if(a.length===0&&(w.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),a=t.videoCodecs),j("USE_PUB_RTX")||j("USE_SUB_RTX")){const l=Vd(a,t.videoCodecs);a=[...a,...l]}}else{a=t.audioCodecs.filter(u=>{var h;return Ee(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,i)});const l=t.audioCodecs.filter(u=>{var h;return Ee(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"red")});a.length===0&&(w.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),a=t.audioCodecs.filter(u=>{var h;return Ee(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")})),j("ENABLE_AUDIO_RED")&&l.length!==0&&(a=[...l,...a])}return a}function Vd(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&Ee(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Li(e,t,n){const i=t.toString(),a=k3(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let u=l.sdp;u=cI(u,n||{}),a==null||a(u||""),await e.setLocalDescription({type:"answer",sdp:u})}function cI(e,t,n){const i=li(e),{useXR:a}=t;return i.mediaDescriptions.forEach(l=>{var u;l.attributes.mid&&(Array.isArray(n)&&!Ee(n).call(n,l.attributes.mid)||(l.media.mediaType==="audio"&&Wm(l),l.media.mediaType==="video"&&function(h){h.media.mediaType==="video"&&j("ENABLE_DOWN_SPS_PPS")&&h.attributes.payloads.filter(m=>{var g;return((g=m.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())==="h264"}).forEach(m=>{m.fmtp||(m.fmtp={parameters:{}}),m.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})}(l),a&&Ee(u=["audio","video"]).call(u,l.media.mediaType)&&l.attributes.payloads.forEach(h=>{h.rtcpFeedbacks.findIndex(m=>m.type==="rrtr")===-1&&h.rtcpFeedbacks.push({type:"rrtr"})})))}),Ul(i)}function k3(e,t,n,i){if(j("SDP_LOGGING"))return w.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?a=>{k3(a,"answer",n==="local"?"remote":"local",i)}:void 0}async function L3(e,t,n){try{var i;if(!jt().supportSetRtpSenderParameters||!function(m){return m==="vp9"||m==="av1"}(e)||!j("ENABLE_SVC"))return;const a={},l={},u=t.getParameters(),h=(i=u.encodings)===null||i===void 0?void 0:i[0];l.scalabilityMode=D_(n),h&&Object.assign(h,l),Object.assign(u,a),await t.setParameters(u),w.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(u.encodings)))}catch(a){w.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",a)}}function p0(e){const t=j("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>Ee(e).call(e,n))}function j3(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function M3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Zi(e,t){return typeof j(e)===t?j(e):void 0}function A_e(){try{const e=j("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?M3(Object(i),!0).forEach(function(a){O(t,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):M3(Object(i)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(i,a))})}return t}({},e)}catch(e){return w.debug("handle gateway attributes failed: ",e),{}}}const U3={};function Jc(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&w.debug("install service ".concat(e.name)),U3[e.name]=e}function tc(e){const t=U3[e];if(!t)throw new ae(U.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function V3(e,t){return tc("DataStream").create(e,t)}function m0(){return tc("InterceptFrame").create()}function F3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function cs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?F3(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const lI=new Map;class O_e extends Yn{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(vr.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(vr.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){w.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var i,a,l;super(),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"key",void 0),O(this,"ntpOffset",0),O(this,"usingProxy",!1),O(this,"signal",void 0),O(this,"role",void 0),O(this,"isPreallocation",void 0),O(this,"isPreSub",void 0),O(this,"inChannelInfo",{joinAt:null,duration:0}),O(this,"spec",void 0),O(this,"_state","DISCONNECTED"),O(this,"_statsCollector",void 0),O(this,"_disconnectedReason",void 0),O(this,"isSignalRecover",!1),O(this,"hasChangeBGPAddress",!1),O(this,"trafficStatsInterval",void 0),O(this,"networkQualityInterval",void 0),O(this,"_joinGatewayStartTime",0),O(this,"_signalTimeout",!1),O(this,"_clientRoleOptions",void 0),O(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(i={spec:cs(cs({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(a=(l=tc("P2PChannel")).createSubmodule)===null||a===void 0?void 0:a.call(l,i)):this.store.useDcSignal?function(u){return tc("DataChannelSignal").create(u)}({spec:cs(cs({},n),{},{retryConfig:n.websocketRetryConfig}),store:t}):new E3(cs(cs({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,n,i){if(this.store.useDcSignal){let _=!1;t.cloudProxyServer!=="disabled"?(w.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),_=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(w.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):t.apResponse.addresses.some(v=>v.fingerprint)||j("FINGERPRINT")||(w.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const a=Date.now();let l=lI.get(t.cname);if(l||(l=new Map,lI.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const _=new re(U.UID_CONFLICT);throw Be.joinGateway(t.sid,{lts:a,succ:!1,ec:_.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),_}l.set(t.uid,!0),this.joinInfo=t,this.key=n;let u=0;this.joinGatewayStartTime=a;const h=t.proxyServer,m=this.store.useDcSignal?"datachannel":"websocket";try{w.debug("[".concat(this.store.clientId,"] use ").concat(m," join uid ").concat(u));const _=t.gatewayAddrs.map(S=>{let{address:T}=S;const[P,x]=T.split(":"),N={host:P,port:x};return t.proxyServer&&(N.proxy=t.proxyServer),N});let v;v=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(_),u=v.uid,w.debug("[".concat(this.store.clientId,"] ").concat(m," join uid ").concat(u," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_){var g;throw _.code===U.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||Be.joinGateway(t.sid,{lts:a,succ:!1,ec:((g=_.data)===null||g===void 0?void 0:g.desc)||_.code,errorMsg:_.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!h||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),_&&_.code===U.INIT_DATACHANNEL_TIMEOUT?(w.warning("[".concat(this.store.clientId,"] User join datachannel failed"),_.toString()),this.resetSignal(),_):(w.error("[".concat(this.store.clientId,"] User join failed"),_.toString()),l.delete(t.uid),this.signal.close(),_)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),w.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_=>{w.warning("[".concat(this.store.clientId,"] get traffic stats error"),_.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(vr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(vr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(vr.NETWORK_QUALITY,{uplinkNetworkQuality:l0(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:l0(this._statsCollector.trafficStats.B_dnq)}):this.emit(vr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),u}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ft.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Bt.CONNECTED||await function(i,a){return a===1/0?i:Ne.race([i,sge(a)])}(this.signal.request(Ye.LEAVE,void 0,!0),3e3)}catch(i){w.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Ft.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:j("PUB_EXTEND"),twcc:!!j("PUBLISH_TWCC"),rtx:!!j("USE_PUB_RTX")};try{return(await this.signal.request(Ye.PUBLISH,a,!0))._message}catch(l){if(i&&l.data&&l.data.code===$e.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw l}}async publishDataChannel(t,n,i){var a;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(a=n.maxRetransmits)!==null&&a!==void 0?a:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Ye.PUBLISH_DATASTREAM,l,!0)}catch(u){if(i&&u.data&&u.data.code===$e.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),u.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw u}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ye.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){w.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ne.all(t.map(n=>this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){w.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const a={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX")||void 0,extend:j("SUB_EXTEND"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(Ye.PRE_SUBSCRIBE,a,!0)}catch(l){if(i&&l.data&&l.data.code===$e.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,n,!1);throw l}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const a={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX"),extend:j("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return(await this.signal.request(Ye.SUBSCRIBE,a,!0))._message}catch(l){if(i&&l.data&&l.data.code===$e.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw l}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const a={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Ye.SUBSCRIBE_DATASTREAM,a,!0)}catch(l){if(i&&l.data&&l.data.code===$e.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw l}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!j("USE_SUB_RTX"),twcc:!!j("SUBSCRIBE_TWCC"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(Ye.SUBSCRIBE_STREAMS,i,!0)}catch(a){if(n&&a.data&&a.data.code===$e.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),a.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw a}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let a=i.frameRate,l=i.width,u=i.height,h=!0;return typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(h=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(h=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,a||(h=!1)),h?{stream_type:0,width:l,height:u,fps:a,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ye.SET_VIDEO_PROFILE,n);w.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){w.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Ne.all(t.map(i=>this.signal.request(Ye.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){w.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){w.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:a}=t;return{gatewayEstablishParams:await this.signal.request(Ye.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:a}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ye.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ye.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),j("CLIENT_ROLE_OPTIONS")&&(w.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(j("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},j("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),j("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},j("CLIENT_ROLE_OPTIONS")),w.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(j("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,a=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,a=1):a=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:a=0;const l=Object.assign({},n);delete l.delay,delete l.level,await this.signal.request(Ye.SET_CLIENT_ROLE,cs(cs({role:t,level:a,delay:i},l),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,n,i){await this.signal.request(Ye.SET_DUAL_STREAM_MODE,{mode:t},i,n)}async setRemoteVideoStreamType(t,n){await this.signal.request(Ye.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ye.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ye.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ye.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ye.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),cs({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(Ye.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(Ye.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=lI.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:xs.username,password:xs.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(cs(cs({},xs),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ye.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(a=>a.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&IS(()=>{this.emit(vr.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,i,a,l;if(!this.joinInfo||!this.key)throw new re(U.UNEXPECTED_ERROR,"can not generate join message, no join info");const u=Object.assign({},this.joinInfo.apResponse);let h=j("REPORT_APP_SCENARIO");if(typeof h!="string")try{h=JSON.stringify(h)}catch{h=void 0}var m;h&&h.length>128&&(h=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(vr.UPDATE_GATEWAY_CONFIG),m=this.store.clientId,Ee(Mm).call(Mm,m)||Mm.push(m);const g=x_(this.store),_=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),v=FF(this.store),S=A_e(),T=Wc(87)||zV()||zx(117),P=(function(){const F=qt();if(F.name!==Qt.SAFARI||!F.browserVersion)return!1;const q=F.browserVersion.split(".");return Number(q[0])>18||Number(q[0])===18&&Number(q[1])>=4}()||QV(18,4))&&qx(18,6)&&this.spec.codec==="h264"&&j("ENABLE_ABSSENDTIME_AS_SENTTS"),x=!(((i=u.detail)===null||i===void 0?void 0:i[3])!=="CN"||!j("ENABLE_QUALITY_FALLBACK"))&&j("ENABLE_QUALITY_FALLBACK"),N=!!j("ENABLE_AP_MULTI_IP")&&((a=u.detail)===null||a===void 0?void 0:a[5])==="multi-ip",M=cs({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ja,browser:navigator.userAgent,process_id:j("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:N||this.hasChangeBGPAddress,ap_response:u,extend:j("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:h,attributes:{userAttributes:cs(cs({enableEncodedTransform:(!!j("ENABLE_AUDIO_METADATA")||!!j("ENABLE_AUDIO_PTS"))&&T||!!j("ENABLE_AUDIO_TOPN")&&Kx(Qt.CHROME,87,116)||void 0,enableAudioMetadata:!!j("ENABLE_AUDIO_METADATA")&&T,enableAudioPts:!!j("ENABLE_AUDIO_PTS")&&T,topnSmoothLevel:j("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:j("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:j("TOPN_SWITCH_HOLD_MS"),topnAudioGain:j("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:j("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:j("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Zi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Zi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Zi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:j("USE_PUB_RTX")===!0||j("USE_SUB_RTX")===!0||void 0,disableFEC:j("DISABLE_FEC"),enableNTPReport:!!j("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:v,enableFulllinkAvSync:!!j("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Zi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!j("FORCE_ENABLE_AUT_CC")||!US()&&(!!j("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!j("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Zi("USE_XR","boolean"),enableLossbasedBwe:Zi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!j("FORCE_ENABLE_AUT_CC")||!US()&&(!!j("ENABLE_AUT_CC")||void 0),enableCCFallback:Zi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:_,preSubNum:g?Zi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Zi("PUBLISH_TWCC","boolean"),enableSubTWCC:Zi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Zi("USE_PUB_RTX","boolean"),enableSubRTX:Zi("USE_SUB_RTX","boolean"),enableSubSVC:j("ENABLE_SVC")?j("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0,enableSvcExtended:j("ENABLE_SVC")&&Array.isArray(j("SVC_EXTENDED"))&&j("SVC_EXTENDED").length!==0?j("SVC_EXTENDED"):void 0,enableVosFallback:j("ENABLE_VOS_FALLBACK"),enableQualityFallback:x},S),{},{audioDuplicate:Zi("ENABLE_AUDIO_RED","boolean")?(l=Zi("AUDIO_DUPLICATE_NUM","number"))!==null&&l!==void 0?l:2:void 0,senttsUsesAbsSendTime:!!P||void 0,enableDualStreamFlag:Zi("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(M.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(M.aes_mode=this.joinInfo.aesmode,j("ENCRYPT_AES")?(M.aes_secret=this.joinInfo.aespassword,M.aes_encrypt=!0):M.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(M.aes_salt=this.joinInfo.aessalt)),u.addresses[this.signal.websocket.currentURLIndex]&&(M.ap_response.ticket=u.addresses[this.signal.websocket.currentURLIndex].ticket,delete u.addresses),this.joinInfo.defaultVideoStream!==void 0&&(M.default_video_stream=this.joinInfo.defaultVideoStream),M}getRejoinMessage(){if(!this.joinInfo)throw new re(U.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(He.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(He.WS_RECONNECTING,t=>{this.joinInfo&&Be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Rs.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Be.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(He.WS_CLOSED,t=>{let n;switch(t){case Ft.LEAVE:n=Rs.LEAVE;break;case Ft.UID_BANNED:case Ft.IP_BANNED:case Ft.CHANNEL_BANNED:case Ft.SERVER_ERROR:n=Rs.SERVER_ERROR;break;case Ft.FALLBACK:n=Rs.FALLBACK;break;case Ft.LICENSE_MISSING:case Ft.LICENSE_EXPIRED:case Ft.LICENSE_MINUTES_EXCEEDED:case Ft.LICENSE_PERIOD_INVALID:case Ft.LICENSE_MULTIPLE_SDK_SERVICE:case Ft.LICENSE_ILLEGAL:case Ft.TOKEN_EXPIRE:n=t;break;default:n=Rs.NETWORK_ERROR}w.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Rs.NETWORK_ERROR)),this.joinInfo&&Be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ft.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Ft.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(He.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=j("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(w.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(Be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void w.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));hn("EVENT_REPORT_DOMAIN",t[1]),hn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),hn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(pt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(He.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new re(U.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Pr(this,vr.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(He.REQUEST_JOIN_INFO,async(t,n,i)=>{var a,l,u;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const h=On((a=this.joinInfo)===null||a===void 0?void 0:a.turnServer);if(j("NEW_TURN_MODE")&&h&&((l=this.joinInfo)===null||l===void 0?void 0:l.cloudProxyServer)==="disabled"){var m;let S=h.servers.map(x=>"turnServerURL"in x&&j("USE_TURN_IP")?cs(cs({},x),{},{turnServerURL:c0(x.turnServerURL)}):x),T=(m=h.serversFromGateway)===null||m===void 0?void 0:m.map(x=>j("USE_TURN_IP")?cs(cs({},x),{},{turnServerURL:c0(x.turnServerURL)}):x);const P=this.signal.currentURLIndex;S.length>0&&(S=[S[P%S.length]],h.servers=S),Array.isArray(T)&&T.length>0&&(T=[T[0]],h.serversFromGateway=T),w.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(P))}const{iceParameters:g,dtlsParameters:_,rtpCapabilities:v}=await Pr(this,vr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:h,cloudProxyServer:(u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:g,dtlsParameters:_,rtpCapabilities:v,version:"2"}}))}catch(S){n(S)}}),this.signal.on(He.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(He.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let i,a="";var l;t instanceof re?(i=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,a=t.message):i=t,Be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:a,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(He.IS_P2P_DISCONNECTED,t=>{t(dh(this,vr.IS_P2P_DISCONNECTED))}),this.signal.on(He.DISCONNECT_P2P,()=>{this.emit(vr.DISCONNECT_P2P)}),this.signal.on(He.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(He.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(He.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(vr.JOIN_RESPONSE,t,n)}),this.signal.on(He.PRE_CONNECT_PC,async(t,n)=>{if(this.joinInfo){var i,a;this.updateTurnConfigFromSignal();const u=this.getCurrentGatewayAddress(),h=On((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(j("NEW_TURN_MODE")&&h&&((a=this.joinInfo)===null||a===void 0?void 0:a.cloudProxyServer)==="disabled"){var l;let g=h.servers.map(S=>"turnServerURL"in S&&j("USE_TURN_IP")?cs(cs({},S),{},{turnServerURL:c0(S.turnServerURL)}):S),_=(l=h.serversFromGateway)===null||l===void 0?void 0:l.map(S=>j("USE_TURN_IP")?cs(cs({},S),{},{turnServerURL:c0(S.turnServerURL)}):S);const v=this.signal.currentURLIndex;g.length>0&&(g=[g[v%g.length]],h.servers=g),Array.isArray(_)&&_.length>0&&(_=[_[0]],h.serversFromGateway=_),w.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(v,",in pre pc"))}const m=j("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(u&&m){const g=A3(u);Pr(this,vr.PRE_CONNECT_PC,{candidates:g,fingerprint:m,turnServer:h}).then(_=>{t==null||t(_)}).catch(n||(()=>{}))}}}),this.signal.on(He.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof j("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(j("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(He.VOS_FALLBACK,t=>{this.emit(vr.VOS_FALLBACK,t)}),this.signal.on(He.DATACHANNEL_FAILBACK,t=>{w.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(vr.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw w.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ye.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw w.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(a=>a.stream_type===ln.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ye.CONTROL,i,!0,!0)}catch(a){throw w.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),a),a}}async unmuteLocal(t,n){const i={action:t.find(a=>a.stream_type===ln.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ye.CONTROL,i,!0,!0)}catch(a){throw w.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),a),a}}async muteRemote(t,n){const i={action:t===Ve.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ye.CONTROL,i,!0,!0)}catch(a){throw w.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),a),a}}async unmuteRemote(t,n){const i={action:t===Ve.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ye.CONTROL,i,!0,!0)}catch(a){throw w.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),a),a}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ye.RESTART_ICE,n,!0)}catch(i){throw w.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||Rs.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!j("GATEWAY_WSS_ADDRESS"))return j("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(w.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ye.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ft.FALLBACK)),this.store.useDcSignal=!1,this.signal=new E3(cs(cs({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(vr.RESET_SIGNAL)}}let f0=0,dI=0;function nc(e,t,n,i){return new Ne((a,l)=>{t.timeout=t.timeout||j("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),f0+=Kc(t.data)):n&&(t.data.size?f0+=t.data.size:t.data instanceof FormData?f0+=gF(t.data):f0+=Kc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,yi.request(t).then(u=>{typeof u.data=="string"?dI+=Kc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?dI+=u.data.byteLength:dI+=Kc(JSON.stringify(u.data)),i&&a({data:u.data,headers:u.headers}),a(u.data)}).catch(u=>{yi.isCancel(u)?l(new re(U.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?l(new re(U.NETWORK_TIMEOUT,u.message)):u.response?l(new re(U.NETWORK_RESPONSE_ERROR,u.response.status)):l(new re(U.NETWORK_ERROR,u.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(pe){var be=0;return function(){return be<pe.length?{done:!1,value:pe[be++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(pe,be,Fe){return pe==Array.prototype||pe==Object.prototype||(pe[be]=Fe.value),pe},i,a=function(pe){pe=[typeof globalThis=="object"&&globalThis,pe,typeof window=="object"&&window,typeof self=="object"&&self,typeof d=="object"&&d];for(var be=0;be<pe.length;++be){var Fe=pe[be];if(Fe&&Fe.Math==Math)return Fe}throw Error("Cannot find global object")}(this);function l(pe,be){if(be)e:{var Fe=a;pe=pe.split(".");for(var me=0;me<pe.length-1;me++){var R=pe[me];if(!(R in Fe))break e;Fe=Fe[R]}(be=be(me=Fe[pe=pe[pe.length-1]]))!=me&&be!=null&&n(Fe,pe,{configurable:!0,writable:!0,value:be})}}function u(pe){return(pe={next:pe})[Symbol.iterator]=function(){return this},pe}function h(pe){var be=typeof Symbol<"u"&&Symbol.iterator&&pe[Symbol.iterator];return be?be.call(pe):{next:t(pe)}}if(l("Symbol",function(pe){function be(R,z){this.A=R,n(this,"description",{configurable:!0,writable:!0,value:z})}if(pe)return pe;be.prototype.toString=function(){return this.A};var Fe="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",me=0;return function R(z){if(this instanceof R)throw new TypeError("Symbol is not a constructor");return new be(Fe+(z||"")+"_"+me++,z)}}),l("Symbol.iterator",function(pe){if(pe)return pe;pe=Symbol("Symbol.iterator");for(var be="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Fe=0;Fe<be.length;Fe++){var me=a[be[Fe]];typeof me=="function"&&typeof me.prototype[pe]!="function"&&n(me.prototype,pe,{configurable:!0,writable:!0,value:function(){return u(t(this))}})}return pe}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch{}m=!1}i=m?function(pe,be){if(pe.__proto__=be,pe.__proto__!==be)throw new TypeError(pe+" is not extensible");return pe}:null}var _=i;function v(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(pe){if(pe.m)throw new TypeError("Generator is already running");pe.m=!0}function T(pe,be){return pe.h=3,{value:be}}function P(pe){this.g=new v,this.G=pe}function x(pe,be,Fe,me){try{var R=be.call(pe.g.j,Fe);if(!(R instanceof Object))throw new TypeError("Iterator result "+R+" is not an object");if(!R.done)return pe.g.m=!1,R;var z=R.value}catch(Q){return pe.g.j=null,pe.g.s(Q),N(pe)}return pe.g.j=null,me.call(pe.g,z),N(pe)}function N(pe){for(;pe.g.h;)try{var be=pe.G(pe.g);if(be)return pe.g.m=!1,{value:be.value,done:!1}}catch(Fe){pe.g.v=void 0,pe.g.s(Fe)}if(pe.g.m=!1,pe.g.l){if(be=pe.g.l,pe.g.l=null,be.F)throw be.D;return{value:be.return,done:!0}}return{value:void 0,done:!0}}function M(pe){this.next=function(be){return pe.o(be)},this.throw=function(be){return pe.s(be)},this.return=function(be){return function(Fe,me){S(Fe.g);var R=Fe.g.j;return R?x(Fe,"return"in R?R.return:function(z){return{value:z,done:!0}},me,Fe.g.return):(Fe.g.return(me),N(Fe))}(pe,be)},this[Symbol.iterator]=function(){return this}}function F(pe,be){return be=new M(new P(be)),_&&pe.prototype&&_(be,pe.prototype),be}if(v.prototype.o=function(pe){this.v=pe},v.prototype.s=function(pe){this.l={D:pe,F:!0},this.h=this.C||this.u},v.prototype.return=function(pe){this.l={return:pe},this.h=this.u},P.prototype.o=function(pe){return S(this.g),this.g.j?x(this,this.g.j.next,pe,this.g.o):(this.g.o(pe),N(this))},P.prototype.s=function(pe){return S(this.g),this.g.j?x(this,this.g.j.throw,pe,this.g.o):(this.g.s(pe),N(this))},l("Array.prototype.entries",function(pe){return pe||function(){return function(be,Fe){be instanceof String&&(be+="");var me=0,R=!1,z={next:function(){if(!R&&me<be.length){var Q=me++;return{value:Fe(Q,be[Q]),done:!1}}return R=!0,{done:!0,value:void 0}}};return z[Symbol.iterator]=function(){return z},z}(this,function(be,Fe){return[be,Fe]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var q=function(pe,be){for(var Fe=0;Fe<pe.length;Fe++)be(pe[Fe])},J=function(pe){return pe.replace(/\r?\n|\r/g,`\r
`)},te=function(pe,be,Fe){return be instanceof Blob?(Fe=Fe!==void 0?Fe+"":typeof be.name=="string"?be.name:"blob",be.name===Fe&&Object.prototype.toString.call(be)!=="[object Blob]"||(be=new File([be],Fe)),[String(pe),be]):[String(pe),String(be)]},Y=function(pe,be){if(pe.length<be)throw new TypeError(be+" argument required, but only "+pe.length+" present.")},ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ue=ne.FormData,fe=ne.XMLHttpRequest&&ne.XMLHttpRequest.prototype.send,Me=ne.Request&&ne.fetch,ut=ne.navigator&&ne.navigator.sendBeacon,ot=ne.Element&&ne.Element.prototype,Ct=ne.Symbol&&Symbol.toStringTag;Ct&&(Blob.prototype[Ct]||(Blob.prototype[Ct]="Blob"),"File"in ne&&!File.prototype[Ct]&&(File.prototype[Ct]="File"));try{new File([],"")}catch{ne.File=function(be,Fe,me){return be=new Blob(be,me||{}),Object.defineProperties(be,{name:{value:Fe},lastModified:{value:+(me&&me.lastModified!==void 0?new Date(me.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ct&&Object.defineProperty(be,Ct,{value:"File"}),be}}var vt=function(pe){return pe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Zt=function(pe){this.i=[];var be=this;pe&&q(pe.elements,function(Fe){if(Fe.name&&!Fe.disabled&&Fe.type!=="submit"&&Fe.type!=="button"&&!Fe.matches("form fieldset[disabled] *"))if(Fe.type==="file"){var me=Fe.files&&Fe.files.length?Fe.files:[new File([],"",{type:"application/octet-stream"})];q(me,function(R){be.append(Fe.name,R)})}else Fe.type==="select-multiple"||Fe.type==="select-one"?q(Fe.options,function(R){!R.disabled&&R.selected&&be.append(Fe.name,R.value)}):Fe.type==="checkbox"||Fe.type==="radio"?Fe.checked&&be.append(Fe.name,Fe.value):(me=Fe.type==="textarea"?J(Fe.value):Fe.value,be.append(Fe.name,me))})};if((e=Zt.prototype).append=function(pe,be,Fe){Y(arguments,2),this.i.push(te(pe,be,Fe))},e.delete=function(pe){Y(arguments,1);var be=[];pe=String(pe),q(this.i,function(Fe){Fe[0]!==pe&&be.push(Fe)}),this.i=be},e.entries=function pe(){var be,Fe=this;return F(pe,function(me){if(me.h==1&&(be=0),me.h!=3)return be<Fe.i.length?me=T(me,Fe.i[be]):(me.h=0,me=void 0),me;be++,me.h=2})},e.forEach=function(pe,be){Y(arguments,1);for(var Fe=h(this),me=Fe.next();!me.done;me=Fe.next()){var R=h(me.value);me=R.next().value,R=R.next().value,pe.call(be,R,me,this)}},e.get=function(pe){Y(arguments,1);var be=this.i;pe=String(pe);for(var Fe=0;Fe<be.length;Fe++)if(be[Fe][0]===pe)return be[Fe][1];return null},e.getAll=function(pe){Y(arguments,1);var be=[];return pe=String(pe),q(this.i,function(Fe){Fe[0]===pe&&be.push(Fe[1])}),be},e.has=function(pe){Y(arguments,1),pe=String(pe);for(var be=0;be<this.i.length;be++)if(this.i[be][0]===pe)return!0;return!1},e.keys=function pe(){var be,Fe,me,R,z=this;return F(pe,function(Q){if(Q.h==1&&(be=h(z),Fe=be.next()),Q.h!=3)return Fe.done?void(Q.h=0):(me=Fe.value,R=h(me),T(Q,R.next().value));Fe=be.next(),Q.h=2})},e.set=function(pe,be,Fe){Y(arguments,2),pe=String(pe);var me=[],R=te(pe,be,Fe),z=!0;q(this.i,function(Q){Q[0]===pe?z&&(z=!me.push(R)):me.push(Q)}),z&&me.push(R),this.i=me},e.values=function pe(){var be,Fe,me,R,z=this;return F(pe,function(Q){if(Q.h==1&&(be=h(z),Fe=be.next()),Q.h!=3)return Fe.done?void(Q.h=0):(me=Fe.value,(R=h(me)).next(),T(Q,R.next().value));Fe=be.next(),Q.h=2})},Zt.prototype._asNative=function(){for(var pe=new ue,be=h(this),Fe=be.next();!Fe.done;Fe=be.next()){var me=h(Fe.value);Fe=me.next().value,me=me.next().value,pe.append(Fe,me)}return pe},Zt.prototype._blob=function(){var pe="----formdata-polyfill-"+Math.random(),be=[],Fe="--"+pe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(me,R){return typeof me=="string"?be.push(Fe+vt(J(R))+`"\r
\r
`+J(me)+`\r
`):be.push(Fe+vt(J(R))+'"; filename="'+vt(me.name)+`"\r
Content-Type: `+(me.type||"application/octet-stream")+`\r
\r
`,me,`\r
`)}),be.push("--"+pe+"--"),new Blob(be,{type:"multipart/form-data; boundary="+pe})},Zt.prototype[Symbol.iterator]=function(){return this.entries()},Zt.prototype.toString=function(){return"[object FormData]"},ot&&!ot.matches&&(ot.matches=ot.matchesSelector||ot.mozMatchesSelector||ot.msMatchesSelector||ot.oMatchesSelector||ot.webkitMatchesSelector||function(pe){for(var be=(pe=(this.document||this.ownerDocument).querySelectorAll(pe)).length;0<=--be&&pe.item(be)!==this;);return-1<be}),Ct&&(Zt.prototype[Ct]="FormData"),fe){var Bn=ne.XMLHttpRequest.prototype.setRequestHeader;ne.XMLHttpRequest.prototype.setRequestHeader=function(pe,be){Bn.call(this,pe,be),pe.toLowerCase()==="content-type"&&(this.B=!0)},ne.XMLHttpRequest.prototype.send=function(pe){pe instanceof Zt?(pe=pe._blob(),this.B||this.setRequestHeader("Content-Type",pe.type),fe.call(this,pe)):fe.call(this,pe)}}Me&&(ne.fetch=function(pe,be){return be&&be.body&&be.body instanceof Zt&&(be.body=be.body._blob()),Me.call(this,pe,be)}),ut&&(ne.navigator.sendBeacon=function(pe,be){return be instanceof Zt&&(be=be._asNative()),ut.call(this,pe,be)}),ne.FormData=Zt}})();const U_=()=>{const e=j("AREAS");return e.length===0&&e.push(tn.GLOBAL),ka(e).call(e,(t,n,i)=>{const a=B3(n);return a?i===0?a:"".concat(t,",").concat(a):t},"")},B3=e=>e===tn.OVERSEA?"".concat(ks.ASIA,",").concat(ks.EUROPE,",").concat(ks.AFRICA,",").concat(ks.NORTH_AMERICA,",").concat(ks.SOUTH_AMERICA,",").concat(ks.OCEANIA):ks[e],P_e=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=i0[n],a=Object.keys(i);a&&a.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(i[l]))})}),t},g0={GLOBAL:{ASIA:[tn.CHINA,tn.JAPAN,tn.INDIA,tn.KOREA,tn.HKMC],EUROPE:[],NORTH_AMERICA:[tn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},_0=Object.keys(g0[tn.GLOBAL]),uI=[tn.CHINA,tn.NORTH_AMERICA,tn.EUROPE,tn.ASIA,tn.JAPAN,tn.INDIA,tn.OCEANIA,tn.SOUTH_AMERICA,tn.AFRICA,tn.KOREA,tn.HKMC,tn.US],D_e=function(e,t){let n=[];if(Ee(e).call(e,tn.GLOBAL)){const l=[tn.GLOBAL,tn.OVERSEA],u=Object.keys(i0);if(t===tn.GLOBAL)throw new re(U.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===tn.CHINA)n=[tn.OVERSEA];else if(a=t,Ee(_0).call(_0,a)){const h=(i=t,g0[tn.GLOBAL][i]||[]),m=[...l,t,...h];n=u.filter(g=>!Ee(m).call(m,g))}else if(function(h){let m=!1;return _0.forEach(g=>{var _;Ee(_=g0[tn.GLOBAL][g]).call(_,h)&&(m=!0)}),m}(t)){const h=function(g){let _;return _0.forEach(v=>{var S;Ee(S=g0[tn.GLOBAL][v]).call(S,g)&&(_=v)}),_}(t),m=[...l,h,t];n=u.filter(g=>!Ee(m).call(m,g))}else n=e;n=function(h){const m=[];return uI.forEach(g=>{Ee(h).call(h,g)&&m.push(g)}),m.concat(h.filter(g=>!Ee(uI).call(uI,g)))}(n)}else n=e;var i,a;return n};function G3(e){var t,n;if(!e&&Ee(t=j("AREAS")).call(t,tn.EXTENSIONS))return w.debug("update area from ap : reset"),void hI(Gge,!0);if(!Ee(n=j("AREAS")).call(n,tn.GLOBAL)||!e)return;let i=i0.EXTENSIONS;i&&(i={CODE:B3(tn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},w.debug("update area from ap success: ".concat(e,",config is "),i),hn("AREAS",[tn.EXTENSIONS],!0),Object.keys(i).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?hn(a,i[a][0]):hn(a,i[a])}))}function hI(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Be.reportApiInvoke(null,{name:Vn.SET_AREA,options:e,tag:gn.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!Ee(u3).call(u3,l))throw new re(U.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:u}=e;if(!l)throw new re(U.INVALID_PARAMS,"area code is needed");let h=l;typeof l=="string"&&(h=[l]),i=u?D_e(h,u):h}if(!t){if(fa.AREAS){const l=new re(U.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(l),void w.warning("setArea is prohibited because of config-distribute")}if(Ee(i).call(i,tn.GLOBAL)&&j("AREAS")===tn.EXTENSIONS){const l=new re(U.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(l),void w.warning("setArea is prohibited because of ap extensions")}}hn("AREAS",i,t);const a=P_e(i);Object.keys(a).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?hn(l,a[l][0]):hn(l,a[l])}),w.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function W3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function $c(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?W3(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let pI=1;function k_e(e,t,n,i,a){pI+=1;const l={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:pI,requestId:pI,version:ja,cname:n.cname},u={service_name:t,json_body:JSON.stringify(l)};let h,m,g=e[0];return Qo(async()=>{h=Date.now();const _=await nc(g,{data:u,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-h,_.code!==0){const T=new re(U.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:m});throw w.error(T.toString()),T}const v=JSON.parse(_.json_body);if(v.code!==200){const T=new re(U.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(v.code,", reason: ").concat(v.reason),{code:v.code,responseTime:m});throw w.error(T.toString()),T}if(!v.servers||v.servers.length===0){const T=new re(U.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:m});throw w.error(T.toString()),T}const S=function(T,P){return{addressList:T.servers.map(x=>"wss://".concat(x.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(x.wss,"?serviceName=").concat(encodeURIComponent(P))),workerToken:T.workerToken,vid:T.vid}}(v,t);return j("LIVE_STREAMING_ADDRESS")&&(S.addressList=j("LIVE_STREAMING_ADDRESS")instanceof Array?j("LIVE_STREAMING_ADDRESS"):[j("LIVE_STREAMING_ADDRESS")]),$c($c({},S),{},{responseTime:m})},(_,v)=>(Be.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(_.addressList),firstSuccess:v===0,responseTime:m,serverIp:e[v%e.length]}),!1),(_,v)=>(Be.apworkerEvent(n.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:t,responseTime:m,serverIp:e[v%e.length]}),!!(_.code!==U.OPERATION_ABORTED&&_.code!==U.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(g=e[(v+1)%e.length],!0)),a)}let mI=1;function H3(e,t,n,i){let{url:a,areaCode:l}=e;const{clientId:u,sid:h}=t,m=Date.now();let g;const _=t.role,[v,S]=gI(t,l,[Rr.CHOOSE_SERVER]);let T=ar.networkState;return Qo(async()=>{T&&ar.networkState===ci.OFFLINE&&ar.onlineWaiter&&await Ne.race([ar.onlineWaiter,qr(i&&i.maxRetryTimeout||Cr.maxRetryTimeout)]),T=ar.networkState;const{data:P,headers:x}=await nc(a,{data:v,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=x.http3==="1"?1:-1,Be.reportResourceTiming(a,h),z3(P,a,t,m,[Rr.CHOOSE_SERVER],g);const N=P_(P,Rr.CHOOSE_SERVER);return fI(N),tI(N,a)},P=>(P&&Be.joinChooseServer(h,{role:_,lts:m,succ:!0,csAddr:a,opid:S,serverList:P.gatewayAddrs.map(x=>x.address),ec:null,cid:P.cid.toString(),uid:P.uid.toString(),csIp:P.csIp,unilbsServerIds:[Rr.CHOOSE_SERVER].toString(),isHttp3:g,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:P.res.detail&&P.res.detail[38],vid:P.vid}),!1),P=>P.code!==U.OPERATION_ABORTED&&(P.code===U.CAN_NOT_GET_GATEWAY_SERVER?P.data.retry:(Be.joinChooseServer(h,{role:_,lts:m,succ:!1,csAddr:a,serverList:null,opid:S,ec:P.code,csIp:P.data&&P.data.csIp,unilbsServerIds:[Rr.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:T}),isHttp3:g,corssRegionTagReq:t.apRequestDetail}),w.warning("[".concat(u||"sid-".concat(h.slice(0,6)),"] Choose server network error, retry"),P),!0)),i)}function K3(e,t,n,i){let a,{url:l,areaCode:u,serviceIds:h}=e;const m=Date.now(),g=t.role,[_,v]=gI(t,u,h);let S;return Qo(async()=>{S&&ar.networkState===ci.OFFLINE&&ar.onlineWaiter&&await Ne.race([ar.onlineWaiter,qr(i&&i.maxRetryTimeout||Cr.maxRetryTimeout)]),S=ar.networkState;const{data:T,headers:P}=await nc(l,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a=P.http3==="1"?1:-1,Be.reportResourceTiming(l,t.sid),z3(T,l,t,m,h,a);const x=P_(T,Rr.CHOOSE_SERVER),N=P_(T,t.cloudProxyServer==="proxy5"?Rr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Rr.CLOUD_PROXY:Rr.CLOUD_PROXY_FALLBACK),M=performance.getEntriesByName(l),F=M[M.length-1];let q;return F&&(q={name:F.name,protocol:"nextHopProtocol"in F?F.nextHopProtocol:"",dnscost:"domainLookupEnd"in F&&"domainLookupStart"in F&&typeof F.domainLookupEnd=="number"&&typeof F.domainLookupStart=="number"?F.domainLookupEnd-F.domainLookupStart:-1,tcpTlsCost:"connectEnd"in F&&"connectStart"in F&&typeof F.connectEnd=="number"&&typeof F.connectStart=="number"?F.connectEnd-F.connectStart:-1,reqCost:"requestStart"in F&&typeof F.requestStart=="number"&&"responseEnd"in F&&typeof F.responseEnd=="number"?F.responseEnd-F.requestStart:-1,handleCost:"leave_ts"in T&&"enter_ts"in T&&typeof T.leave_ts=="number"&&typeof T.enter_ts=="number"?T.leave_ts-T.enter_ts:-1}),fI(x),{gatewayInfo:tI(x,l),proxyInfo:N,url:l,resourceTimingInfo:q}},T=>{var P;return T.gatewayInfo&&Be.joinChooseServer(t.sid,{role:g,lts:m,succ:!0,csAddr:l,serverList:T.gatewayInfo.gatewayAddrs.map(x=>x.address),ec:null,opid:v,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:h.toString(),isHttp3:a,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:T.gatewayInfo.res.detail&&T.gatewayInfo.res.detail[38],vid:(P=T.gatewayInfo)===null||P===void 0?void 0:P.vid,resourceTimingInfo:T.resourceTimingInfo?JSON.stringify(T.resourceTimingInfo):void 0}),T.proxyInfo&&Be.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:l,turnServerAddrList:T.proxyInfo.addresses.map(x=>x.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:h.toString()}),!1},T=>T.code!==U.OPERATION_ABORTED&&(T.code===U.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(Be.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:T.code,eventType:t.cloudProxyServer,unilbsServerIds:h.toString(),extend:JSON.stringify({networkState:S})}),w.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),T),!0)),i)}const z3=(e,t,n,i,a,l)=>{const{sid:u,clientId:h,cloudProxyServer:m}=n,g=[],_=v=>{v.flag===4096?Be.joinChooseServer(u,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:v.error.message,csIp:v.error.data&&v.error.data.csIp,unilbsServerIds:a.toString(),isHttp3:l,corssRegionTagReq:n.apRequestDetail}):v.flag!==1048576&&v.flag!==4194304&&v.flag!==4194310||Be.joinWebProxyAP(u,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:v.error.code,eventType:m,unilbsServerIds:a.toString()})};if(e.response_body.forEach(v=>{const S=v.buffer.code;if(v.uri===23&&S===0&&!v.buffer.edges_services)if(v.buffer.flag===4194310)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),v.buffer.edges_services=[];else{const T={error:new re(U.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:j("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:v.buffer.flag};g.push(T),_(T)}if(S!==0){const T=Bm(S),P={error:new re(U.CAN_NOT_GET_GATEWAY_SERVER,T.desc,{desc:T.desc,retry:T.retry,csIp:e.detail[502]}),flag:v.buffer.flag};v.buffer.flag===4194310?w.warning(P.error.toString()):g.push(P),_(P)}}),g.length)throw w.warning("[".concat(h||"sid-".concat(u.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(g.map(v=>"flag: ".concat(v.flag,", message: ").concat(v.error.message,", retry: ").concat(v.error.data.retry)).join(" | "))),new re(U.CAN_NOT_GET_GATEWAY_SERVER,g.map(v=>"flag: ".concat(v.flag,", message: ").concat(v.error.message)).join(" | "),{retry:!!g.find(v=>v.error.data.retry),csIp:e.detail[502],desc:[...new Set(g.map(v=>{var S;return v==null||(S=v.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(v=>!!v))]})},fI=e=>{var t,n,i,a;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new re(U.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(j("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((a=e.detail)===null||a===void 0?void 0:a[23])=="string"?G3(e.detail[23].toLowerCase()):G3()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const u=e.detail[19],h=u==null?void 0:u.split(";");for(let m=0;m<h.length;m++){var l;const g=ai(l=h[m]).call(l);e.addresses[m]&&h&&(e.addresses[m].fingerprint=g)}}if(j("GATEWAY_ADDRESS")&&j("GATEWAY_ADDRESS").length>0){w.debug("assign gateway address to",j("GATEWAY_ADDRESS"));const u=j("GATEWAY_ADDRESS").map(h=>{var m,g;const _=(m=(g=e.addresses.find(v=>v.ip===h.ip&&v.port===h.port))===null||g===void 0?void 0:g.fingerprint)!==null&&m!==void 0?m:"";return{ip:h.ip,port:h.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:h.fingerprint||_}});e.addresses=u}},L_e=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=Bm(n.buffer.code);throw new re(U.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw w.debug("update ticket request received ap response without response body:",t),new re(U.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},gI=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),a=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:$c($c($c({6:e.stringUid,11:t,12:j("USE_NEW_TOKEN")?"1":void 0},a?{17:a}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};l.request_bodies.forEach(h=>{e.multiIP&&e.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const u=new FormData;return u.append("request",JSON.stringify(l)),[u,i]},j_e=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},a=new FormData;return a.append("request",JSON.stringify(i)),[a,n]};let Hm=0;function Km(e){return Ne.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const V_=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:a,promisesCollector:l}=e,u=0;const h=t;let m,g=0;const _=async()=>{const v=(()=>{const S=u*h,T=S+h;return n.slice(S,T).map(i)})();l&&l.push(...v);try{m=await Km(v)}catch(S){if(g+=h,u++,!(g>=n.length))return void await _();a(S)}v.forEach(S=>S.cancel())};return await _(),m},q3=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const a=t.length;let l=0;const u=async()=>{const h=n(t.shift());try{return await h}catch(m){if(l++,l>=a||i!=null&&i(m))throw m;return u()}};return u()};async function M_e(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],a=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],l=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],u=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new Ne((m,g)=>{let _;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:S=>{S.close(),clearTimeout(_),m(!0)},error:S=>{clearTimeout(_),m(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const v=[t,n,i,a,l,u];for(let S=0;S<v.length;S++){const T=new EncodedVideoChunk({type:S==0?"key":"delta",timestamp:33333*S,duration:33333,data:new Uint8Array(v[S])});try{await e.decode(T)}catch{return void m(!1)}}})(),_=setTimeout(()=>{m(!1)},5e3)})}async function E0(e,t,n,i){return{gatewayInfo:await async function(l,u,h,m){let g=null;const _=[],v=async()=>{const T=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(N=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:U_()})),P=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(N=>N.url)}),x=await V_({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:N=>(w.debug("[".concat(l.clientId,"] Connect to choose_server:"),N.url),H3(N,l,u,h)),allFailedhandler:N=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},P),N[0]},promisesCollector:_});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},P),x},S=async()=>{if(await qr(1e3),g!==null)return g;const T=j("WEBCS_DOMAIN_BACKUP_LIST").map(N=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(N+"/api/v2/transpond/webrtc?v=2"):"https://".concat(N,"/api/v2/transpond/webrtc?v=2"),areaCode:U_()})),P=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(N=>N.url)}),x=await V_({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:N=>(w.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),N.url),H3(N,l,u,h)),allFailedhandler:N=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},P),N[0]},promisesCollector:_});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},P),x};try{return g=await Km([v(),S()]),_.length&&_.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),g}catch(T){throw T[0]}}(e,t,n,i)}}async function Y3(e,t,n,i,a){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await E0(e,t,n,a);if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:S,proxyInfo:T}=await J3(e,t,n,a);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:S};const P=T.map(x=>({turnServerURL:x.address,tcpport:x.tcpport||xs.tcpport,udpport:x.udpport||xs.udpport,username:x.username||xs.username,password:x.password||xs.password,forceturn:!1,security:!0}));if(a.useP2P){var u;const x=(u=e.uid)!==null&&u!==void 0?u:S.uid,N="glb:".concat(x.toString()),M=await $x(N),F=T.map(q=>({turnServerURL:q.address,tcpport:q.tcpport||xs.tcpport,udpport:q.udpport||xs.udpport,username:N,password:M,forceturn:!1,security:!0}));P.push(...F)}return e.turnServer={mode:"manual",servers:P},{gatewayInfo:S}}return await E0(e,t,n,a)}const{proxyInfo:h,gatewayInfo:m}=await J3(e,t,n,a),g={gatewayInfo:m},_=h.map(S=>({turnServerURL:S.address,tcpport:l==="proxy3"?void 0:S.tcpport?S.tcpport:xs.tcpport,udpport:l==="proxy4"?void 0:S.udpport?S.udpport:xs.udpport,username:S.username||xs.username,password:S.password||xs.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(a.useP2P){var v;const S=(v=e.uid)!==null&&v!==void 0?v:m.uid,T="glb:".concat(S.toString()),P=await $x(T),x=h.map(N=>({turnServerURL:N.address,tcpport:l==="proxy3"?void 0:N.tcpport||xs.tcpport,udpport:l==="proxy4"?void 0:N.udpport||xs.udpport,username:T,password:P,forceturn:l!=="proxy4",security:l==="proxy5"}));_.push(...x)}return e.turnServer={mode:"manual",servers:_},w.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),g}async function X3(e,t,n,i,a){const l=j("ACCOUNT_REGISTER").slice(0,j("AJAX_REQUEST_CONCURRENT"));let u=[];u=t.proxyServer?l.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):l.map(m=>"https://".concat(m,"/api/v1"));const h=a==null?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:u});try{const m=await async function(g,_,v,S,T){const P=Date.now(),x={sid:v.sid,opid:10,appid:v.appId,string_uid:_};let N=g[0];const M=await Qo(()=>nc(N+"".concat(N.indexOf("?")===-1?"?":"&","action=stringuid"),{data:x,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(F,q)=>{if(F.code===0){if(F.uid<=0||F.uid>=Math.pow(2,32))throw w.error("Invalid Uint Uid ".concat(_," => ").concat(F.uid),F),Be.reqUserAccount(x.sid,{lts:P,success:!1,serverAddr:N,stringUid:x.string_uid,uid:F.uid,errorCode:U.INVALID_UINT_UID_FROM_STRING_UID,extend:x}),new re(U.INVALID_UINT_UID_FROM_STRING_UID);return Be.reqUserAccount(x.sid,{lts:P,success:!0,serverAddr:N,stringUid:x.string_uid,uid:F.uid,errorCode:null,extend:x}),!1}const J=Bm(F.code);return J.retry&&(N=g[(q+1)%g.length]),Be.reqUserAccount(x.sid,{lts:P,success:!1,serverAddr:N,stringUid:x.string_uid,uid:F.uid,errorCode:J.desc,extend:x}),J.retry},(F,q)=>F.code!==U.OPERATION_ABORTED&&(Be.reqUserAccount(x.sid,{lts:P,success:!1,serverAddr:N,stringUid:x.string_uid,uid:null,errorCode:F.code,extend:x}),N=g[(q+1)%g.length],!0),T);if(M.code!==0){const F=Bm(M.code);throw new re(U.UNEXPECTED_RESPONSE,F.desc)}return M}(u,e,t,n,i);return a==null||a.recordJoinChannelService({status:"success",endTs:Date.now()},h),m.uid}catch(m){throw a==null||a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},h),m}}async function U_e(e,t,n){const i=j("ACCOUNT_REGISTER");let a=[];a=t.proxyServer?i.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):i.map(l=>"https://".concat(l,"/api/v1"));try{return await q3({referenceList:a,asyncMapHandler:u=>async function(h,m,g,_){const v=Date.now(),S={sid:g.sid,opid:10,appid:g.appId,string_uid:m};try{const T=await nc(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(T.code!==0){const P=Bm(T.code);throw new re(U.UNEXPECTED_RESPONSE,"preload sua error:".concat(P.desc),P)}if(T.uid<=0||T.uid>=Math.pow(2,32))throw new re(U.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:v,url:h,req:S,uid:T.uid,elapse:Date.now()-v}}catch(T){throw T}}(u,e,t,n),closeFn:u=>u.code===U.OPERATION_ABORTED||u.code===U.UNEXPECTED_RESPONSE&&!u.data.retry})}catch(l){throw l}}async function V_e(e,t,n){const i=j("CDS_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),a=i.map(m=>function(g,_,v,S){const T=qt(),P={flag:64,cipher_method:0,features:$c($c($c($c($c({install_id:uN(),device:T.name,system:T.os,system_general:navigator.userAgent,vendor:_.appId,version:ja,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:I_e.WEB_RTC,browser_name:T.name,browser_version:T.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),T.os&&{os_name:T.os}),T.osVersion&&{os_version:T.osVersion}),{},{detail:""})};return Qo(()=>nc(g,{data:P,timeout:1e3,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,x=>x.code!==U.OPERATION_ABORTED,S)}(m,e,t,n));let l=null,u=null,h={};try{l=await Km(a)}catch(m){if(m.code===U.OPERATION_ABORTED)throw m;u=m}if(a.forEach(m=>m.cancel()),Be.reportApiInvoke(e.sid,{name:Vn.REQUEST_CONFIG_DISTRIBUTE,options:{error:u,res:l}}).onSuccess(),l&&l.test_tags)try{h=function(m){if(!m.test_tags)return{};const g=m.test_tags,_=Object.keys(g),v={};return _.forEach(S=>{var T;const P=ai(T=S.slice(4)).call(T),x=JSON.parse(g[S]),N=x[1];v[P]={tag:x[0]||"",value:N}}),v}(l)}catch{}return h}async function Q3(e,t){const n=j("WEBCS_DOMAIN").concat(j("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:U_(),serviceIds:[Rr.CHOOSE_SERVER,Rr.CLOUD_PROXY_FALLBACK]}));try{return await q3({referenceList:n,asyncMapHandler:a=>async function(l,u,h){let m,{url:g,areaCode:_,serviceIds:v}=l;const S=Date.now(),[T,P]=gI(u,_,v);let x=ar.networkState;try{x&&ar.networkState===ci.OFFLINE&&ar.onlineWaiter&&await Ne.race([ar.onlineWaiter,qr(Cr.maxRetryTimeout)]),x=ar.networkState;const{data:N,headers:M}=await nc(g,{data:T,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=M.http3==="1"?1:-1,(te=>{const Y=[];if(te.response_body.forEach(ne=>{const ue=ne.buffer.code;if(ne.uri===23&&ue===0&&!ne.buffer.edges_services)if(ne.buffer.flag===4194310)ne.buffer.edges_services=[];else{const fe={error:new re(U.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:j("NO_EDGES_RETRY"),csIp:te.detail[502]}),flag:ne.buffer.flag};Y.push(fe)}if(ue!==0){const fe=Bm(ue),Me={error:new re(U.CAN_NOT_GET_GATEWAY_SERVER,fe.desc,{desc:fe.desc,retry:fe.retry,csIp:te.detail[502]}),flag:ne.buffer.flag};ne.buffer.flag===4194310?w.warning(Me.error.toString()):Y.push(Me)}}),Y.length)throw new re(U.CAN_NOT_GET_GATEWAY_SERVER,Y.map(ne=>"flag: ".concat(ne.flag,", message: ").concat(ne.error.message)).join(" | "),{retry:!!Y.find(ne=>ne.error.data.retry),csIp:te.detail[502],desc:[...new Set(Y.map(ne=>{var ue;return ne==null||(ue=ne.error)===null||ue===void 0||(ue=ue.data)===null||ue===void 0?void 0:ue.desc}).filter(ne=>!!ne))]})})(N);const q=P_(N,Rr.CHOOSE_SERVER),J=P_(N,Rr.CLOUD_PROXY_FALLBACK);return fI(q),{gatewayInfo:tI(q,g),proxyInfo:J,opid:P,requestTime:S,url:g,isHttp3:m,elapse:Date.now()-S}}catch(N){throw N}}(a,e,t),closeFn:a=>a.code===U.OPERATION_ABORTED||a.code===U.CAN_NOT_GET_GATEWAY_SERVER&&!a.data.retry})}catch(i){throw i}}async function J3(e,t,n,i){const a=j("PROXY_SERVER_TYPE3"),l=(T,P,x)=>{let N=x||a;return Array.isArray(N)&&(N=P%2==0&&a[1]||a[0]),"https://".concat(N,"/ap/?url=").concat(T)};let u=null;const h=[],m=async()=>{const T=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map((N,M)=>{let F;return F=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(N,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):l("".concat(N,"/api/v2/transpond/webrtc?v=2"),M),{url:F,areaCode:U_(),serviceIds:[Rr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Rr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Rr.CLOUD_PROXY:Rr.CLOUD_PROXY_FALLBACK]}}),P=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(N=>N.url)}),x=await V_({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:N=>(w.debug("[".concat(e.clientId,"] Connect to choose_server:"),N.url),K3(N,e,t,n)),allFailedhandler:N=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},P),N[0]},promisesCollector:h});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},P),x},g=async()=>{if(await qr(1e3),u!==null)return u;const T=j("WEBCS_DOMAIN_BACKUP_LIST").map((N,M)=>{let F;return F=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(N,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(N,"/api/v2/transpond/webrtc?v=2"):l("".concat(N,"/api/v2/transpond/webrtc?v=2"),M),{url:F,areaCode:U_(),serviceIds:[Rr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Rr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Rr.CLOUD_PROXY:Rr.CLOUD_PROXY_FALLBACK]}}),P=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(N=>N.url)}),x=await V_({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:N=>(w.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),N.url),K3(N,e,t,n)),allFailedhandler:N=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:N},P),N[0]},promisesCollector:h});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},P),x};let _,v,S;try{({gatewayInfo:_,proxyInfo:v,url:S}=await Km([m(),g()]))}catch(T){throw T[0]}if(h.length&&h.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!_||!v)throw new re(U.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=S,e.cloudProxyServer!=="disabled"&&Array.isArray(a)&&S){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];Ee(a).call(a,T)&&(e.proxyServer=T,w.setProxyServer(T),Be.setProxyServer(T))}return u={gatewayInfo:_,proxyInfo:await S3(v,_.uid)},u}async function F_e(e,t,n){const i=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),a=i.map(l=>function(u,h,m,g){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:ja,cname:h.cname,uid:h.uid.toString(),requestId:mI,seq:mI};mI+=1;const v={service_name:"tele_channel",json_body:JSON.stringify(_)};return Qo(async()=>{const S=await nc(u,{data:v,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){const P=new re(U.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw w.error(P.toString()),P}const T=JSON.parse(S.json_body);if(T.code!==200){const P=new re(U.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw w.error(P.toString()),P}if(!T.servers||T.servers.length===0){const P=new re(U.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw w.error(P.toString()),P}return{vid:T.vid,workerToken:T.workerToken,addressList:(j("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(P.wss))}},void 0,S=>!!(S.code!==U.OPERATION_ABORTED&&S.code!==U.UNEXPECTED_RESPONSE||S.data&&S.data.retry),g)}(l,e,t,n));try{const l=await Km(a);return a.forEach(u=>u.cancel()),l}catch(l){throw l[0]}}async function B_e(e,t,n){let i=null;const a=[],l=async u=>{const h=j(u?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return u&&(await qr(1e3),i!==null)?i:await V_({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:m=>(w.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(u?"backup":""," choose_server:"),m),function(g,_,v,S){const[T]=j_e(_,[Rr.CHOOSE_SERVER]);let P=ar.networkState;return Qo(async()=>{P&&ar.networkState===ci.OFFLINE&&ar.onlineWaiter&&await Ne.race([ar.onlineWaiter,qr(S&&S.maxRetryTimeout||Cr.maxRetryTimeout)]),P=ar.networkState;const x=await nc(g,{data:T,cancelToken:v,headers:{"Content-Type":"multipart/form-data;"}},!0);return L_e(x,g)},()=>!1,x=>x.code!==U.OPERATION_ABORTED&&(x.code===U.UPDATE_TICKET_FAILED?x.data.retry:(w.warning("[".concat(_.clientId,"] update ticket network error, retry"),x),!0)),S)}(m,e,t,n)),allFailedhandler:m=>{throw m[0]},promisesCollector:a})};try{return i=await Km([l(!1),l(!0)]),a.length&&a.forEach(u=>u.cancel&&typeof u.cancel=="function"&&u.cancel()),i}catch(u){throw u[0]}}function $3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function _I(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$3(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class G_e extends Yn{get isSuccess(){return!!this.configs}constructor(t,n){super(),O(this,"configs",void 0),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"cancelToken",void 0),O(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),O(this,"interval",void 0),O(this,"mutex",void 0),O(this,"mutableParamsRead",!1),O(this,"configCache",{}),O(this,"limit_bitrate",void 0),this.mutex=new is("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),j("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},j("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Be.reportApiInvoke(null,{options:void 0,name:Vn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:gn.TRACER}).onSuccess(JSON.stringify(fa))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void w.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await V_e(this.joinInfo,this.cancelToken,this.retryConfig),w.debug("[config-distribute] get config distribute",JSON.stringify(t));const i=function(a){var l;const u=Ju(l=Object.keys(a).filter(g=>/^webrtc_ng_global_parameter/.test(g))).call(l);for(let g=0;g<u.length;g++)for(let _=u.length-1;_>g;_--){const v=u[_],S=a[v].value;if(typeof S.__priority=="number"){const T=S.__priority,P=u[_-1],x=a[P].value;if(typeof x.__priority=="number"){if(!(T>x.__priority))continue;{const N=v;u[_]=u[_-1],u[_-1]=N}}else{const N=v;u[_]=u[_-1],u[_-1]=N}}}const h=Date.now(),m={};return u.forEach(g=>{const _=a[g].value.__expires;_&&_<=h||(m[g]=a[g])}),m}(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const a=new re(U.NETWORK_RESPONSE_ERROR,i);w.warning("[config-distribute] ".concat(a.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){h3(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Zo.UPDATE_BITRATE_LIMIT,t):this.emit(Zo.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&_I({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},i=Object.keys(t),a=[];i.forEach(l=>{const u=t[l].value;n[l]=u;const h=u.__id;if(h&&this.configCache[l]&&this.configCache[l].__id===h)return;const m=u.__type,g=t[l].value,_=t[l].tag;let v=0;m?m===OF.REALTIME&&(v=1):Object.keys(g).some(S=>Object.prototype.hasOwnProperty.call(fN,S)||!WN()&&Object.prototype.hasOwnProperty.call(LS,S)?(v=1,!0):void 0),a.push({tag:_,isApplied:v,feature:l,params:JSON.stringify(u)})}),a.forEach(l=>{let{tag:u,feature:h,params:m,isApplied:g}=l;this.store.sessionId&&Be.abTest(this.store.sessionId,{intSucc:1,isApplied:g,tag:u,feature:h,params:m,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){w.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(a){const l={};return Object.keys(a).forEach(u=>{const h=a[u].value,m=h.__expires,g=h.__type;Object.keys(h).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(l,_)||(l[_]=_I(_I({value:h[_]},m&&{expires:m}),g&&{type:g}))})}),l}(t);try{var i;const a=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,a&&h3(a)&&this.handleBitrateLimit(a),this.limit_bitrate=a,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(h){try{const m=Date.now();Object.keys(h).forEach(g=>{const{value:_,type:v,expires:S}=h[g];S&&S<=m||((v===OF.REALTIME||Object.prototype.hasOwnProperty.call(fN,g))&&(fa[g]=_,cn[g]=_,w.debug("Update realtime parameters from config distribute",g,_)),v||WN()||!Object.prototype.hasOwnProperty.call(LS,g)||(fa[g]=_,cn[g]=_,w.debug("Update gateway parameters from config distribute",g,_)))})}catch(m){w.error("Error update config immediately: ".concat(h),m.message)}}(n);const l=JSON.stringify(n),u=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",u),w.debug("Caching global parameters ".concat(l))}catch(a){w.error("Error caching global parameters:",a.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(i=>{switch(i){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(cn,i)){const{value:l,expires:u}=t[i];if(u&&u<=n)return;rN(cn[i],l)||(fa[i]=l,cn[i]=l,this.emit(Zo.UPDATE_CLIENT_ROLE_OPTIONS,l),w.debug("Updating client role options: ".concat(JSON.stringify(l))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(cn,i)){var a;const{value:l,expires:u}=t[i];if(u&&u<=n)return;typeof l=="number"&&Ee(a=[0,1,4,5,6,7,8,9]).call(a,l)&&(fa[i]={value:l},cn[i]=l,this.emit(Zo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,l),w.debug("Updating client remote stream type: ".concat(JSON.stringify(l))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(cn,i)){const{value:l,expires:u}=t[i];if(u&&u<=n)return;rN(cn[i],l)||(fa[i]=l,cn[i]=l,this.emit(Zo.FALLBACK_TO_HLS,l),w.debug("Updating enable force hls: ".concat(JSON.stringify(l))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(cn,i)){const{value:l,expires:u}=t[i];if(u&&u<=n)return;rN(cn[i],l)||(fa[i]=l,cn[i]=l,this.emit(Zo.UPDATE_VOS_CONFIGURE,l),w.debug("Updating vos configure: ".concat(JSON.stringify(l))))}}})}catch(n){w.error("Error handling global parameter config:",n.message)}}}class W_e extends Yn{constructor(){super(...arguments),O(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(j("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const a=this.resultStorage.get(t);if(!a)return;a.result.push(i);const l=t==="VIDEO_ENCODE_FAILED"?j("ENCODE_EXCEPTION_TIMES"):5;if(a.result.length>=l){var u;const h=Ee(u=a.result).call(u,!0);a.isPrevNormal&&!h&&this.emit("exception",EI[t],t,n),!a.isPrevNormal&&h&&this.emit("exception",EI[t]+2e3,t+"_RECOVER",n),a.isPrevNormal=h,a.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Ur&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=wi(n._encoderConfig.frameRate));const a=t.captureFrameRate;return!i||!a||!(i>10&&a<5||i<10&&i>=5&&a<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||Ee(n=j("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Ur&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const EI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Ls=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function Z3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function xh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Z3(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z3(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class F_{constructor(t){O(this,"store",void 0),O(this,"onStatsException",void 0),O(this,"onUploadPublishDuration",void 0),O(this,"onStatsChanged",void 0),O(this,"onVideoCodecChanged",void 0),O(this,"localStats",new Map),O(this,"remoteStats",new Map),O(this,"updateStatsInterval",void 0),O(this,"trafficStats",void 0),O(this,"trafficStatsPeerList",[]),O(this,"uplinkStats",void 0),O(this,"exceptionMonitor",void 0),O(this,"p2pChannel",void 0),O(this,"scalabilityMode",DS.L1T1),O(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new W_e,this.exceptionMonitor.on("exception",(n,i,a)=>{this.onStatsException&&this.onStatsException(n,i,a)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ve.LocalAudioTrack)||xh({},SN)}getLocalVideoTrackStats(){return this.localStats.get(ve.LocalVideoTrack)||xh({},TN)}getRemoteAudioTrackStats(t){const n=(l,u)=>{if(!this.trafficStats)return u;const h=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return h&&(u.publishDuration=h.B_ppad+(Date.now()-this.trafficStats.timestamp)),u},i={};if(t){var a;const l=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.audioStats;l&&(i[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[u,{audioStats:h}]=l;h&&(i[u]=n(u,h))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const a=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;a&&(n[t]=a)}else Array.from(this.remoteStats.entries()).forEach(a=>{let[l,{networkStats:u}]=a;u&&(n[l]=u)});return n}getNetworkQuality(){let t=0,n=0;return this.trafficStats&&(t=l0(this.trafficStats.B_unq),n=l0(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:n}}getRemoteVideoTrackStats(t){const n=(l,u)=>{if(!this.trafficStats)return u;const h=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return h&&(u.publishDuration=h.B_ppvd+(Date.now()-this.trafficStats.timestamp)),u},i={};if(t){var a;const l=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.videoStats;l&&(i[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[u,{videoStats:h}]=l;h&&(i[u]=n(u,h))});return i}getRTCStats(){let t=0,n=0,i=0,a=0;const l=this.localStats.get(ve.LocalAudioTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);const u=this.localStats.get(ve.LocalVideoTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate);const h=this.localStats.get(ve.LocalVideoLowTrack);h&&(t+=h.sendBytes,n+=h.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:_,videoStats:v}=g;_&&(i+=_.receiveBytes,a+=_.receiveBitrate),v&&(i+=v.receiveBytes,a+=v.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const a=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),l=a!=null&&a.videoSSRC?Ls.measureFromSubscribeStart(this.store.clientId,a.videoSSRC):0,u=a!=null&&a.audioSSRC?Ls.measureFromSubscribeStart(this.store.clientId,a.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,l>u?l:u),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&w.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const a=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,l=!i||n.framesDecodeCount>i.framesDecodeCount;return a||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,a]=n;switch(i){case ve.LocalVideoTrack:case ve.LocalVideoLowTrack:{const h=a,m=xh({},TN),g=t.getStats(),_=t.getLocalMedia(i);if(g){const v=g.videoSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(v){const S=t.getLocalVideoSize(),T=t.getEncoderConfig(ve.LocalVideoTrack);var l;(v.codec==="H264"||v.codec==="H265"||v.codec==="VP8"||v.codec==="VP9"||v.codec==="AV1X"||v.codec==="AV1")&&(m.codecType=v.codec,(h==null?void 0:h.codecType)!==v.codec&&((l=this.onVideoCodecChanged)===null||l===void 0||l.call(this,v.codec.toLocaleLowerCase()))),m.sendBytes=v.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,v.inputFrame?(m.captureFrameRate=v.inputFrame.frameRate,m.captureResolutionHeight=v.inputFrame.height,m.captureResolutionWidth=v.inputFrame.width):S&&(m.captureResolutionWidth=S.width,m.captureResolutionHeight=S.height),v.sentFrame?(m.sendFrameRate=v.sentFrame.frameRate,m.sendResolutionHeight=v.sentFrame.height,m.sendResolutionWidth=v.sentFrame.width):S&&(m.sendResolutionWidth=S.width,m.sendResolutionHeight=S.height),v.avgEncodeMs&&(m.encodeDelay=v.avgEncodeMs),T&&T.bitrateMax?m.targetSendBitrate=1e3*T.bitrateMax:v.targetBitrate&&(m.targetSendBitrate=v.targetBitrate),m.sendPackets=v.packets,m.sendPacketsLost=v.packetsLost,m.sendJitterMs=v.jitterMs,m.sendRttMs=v.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(m.totalFreezeTime+=1),v.scalabilityMode&&this.scalabilityMode!==v.scalabilityMode&&(w.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(v.scalabilityMode)),this.scalabilityMode=v.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(i,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,m);break}case ve.LocalAudioTrack:{const h=a,m=xh({},SN),g=t.getStats(),_=t.getLocalMedia(i);if(g){const v=g.audioSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(v){if(v.codec!=="opus"&&v.codec!=="aac"&&v.codec!=="PCMU"&&v.codec!=="PCMA"&&v.codec!=="G722"||(m.codecType=v.codec),v.inputLevel)m.sendVolumeLevel=Math.round(32767*v.inputLevel);else{const S=t.getLocalAudioVolume();S&&(m.sendVolumeLevel=Math.round(32767*S))}m.sendBytes=v.bytes,m.sendPackets=v.packets,m.sendPacketsLost=v.packetsLost,m.sendJitterMs=v.jitterMs,m.sendRttMs=v.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ve.LocalAudioTrack,m),m&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,m);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,a;let[l,{videoStats:u,audioStats:h,videoPcStats:m}]=n;const g=h,_=u,v=m,S=xh({},KF),T=xh({},zF),P=xh({},Nge),{audioTrack:x,videoTrack:N,audioSSRC:M,videoSSRC:F}=t.getRemoteMedia(l);let q;q=this.store.useP2P?t.getStats(!0):t.getStats();const J=(i=q)===null||i===void 0?void 0:i.audioRecv.find(ue=>ue.ssrc===M),te=(a=q)===null||a===void 0?void 0:a.videoRecv.find(ue=>ue.ssrc===F),Y=this.trafficStats&&this.trafficStats.peer_delay.find(ue=>ue.peer_uid===l);if(J&&(J.codec!=="opus"&&J.codec!=="aac"&&J.codec!=="PCMU"&&J.codec!=="PCMA"&&J.codec!=="G722"||(S.codecType=J.codec),J.outputLevel?S.receiveLevel=Math.round(32767*J.outputLevel):x&&(S.receiveLevel=Math.round(32767*x.getVolumeLevel())),S.receiveBytes=J.bytes,S.receivePackets=J.packets,S.receivePacketsLost=J.packetsLost,S.receivePacketsDiscarded=J.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=g?8*Math.max(0,S.receiveBytes-g.receiveBytes):0,S.totalDuration=g?g.totalDuration+1:1,S.totalFreezeTime=g?g.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=J.jitterBufferMs,S.totalDuration>10&&F_.isRemoteAudioFreeze(x)&&(S.totalFreezeTime+=1)),te){var ne;te.codec!=="H264"&&te.codec!=="H265"&&te.codec!=="VP8"&&te.codec!=="VP9"&&te.codec!=="AV1X"&&te.codec!=="AV1"||(T.codecType=te.codec),T.receiveBytes=te.bytes,T.receiveBitrate=_?8*Math.max(0,T.receiveBytes-_.receiveBytes):0,T.decodeFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,T.renderFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,te.outputFrame&&(T.renderFrameRate=te.outputFrame.frameRate),te.receivedFrame?(T.receiveFrameRate=te.receivedFrame.frameRate,T.receiveResolutionHeight=te.receivedFrame.height,T.receiveResolutionWidth=te.receivedFrame.width):N&&(T.receiveResolutionHeight=N._videoHeight||0,T.receiveResolutionWidth=N._videoWidth||0),te.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(te.framesRateFirefox)),T.receivePackets=te.packets,T.receivePacketsLost=te.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost);const ue=_?_.totalFreezeTime:0,fe=_?_.totalDuration:0;T.totalDuration=_?_.totalDuration+1:1,T.totalFreezeTime=(ne=te.totalFreezesDuration)!==null&&ne!==void 0?ne:ue||0,T.receiveDelay=te.jitterBufferMs||0;const Me=!!F&&t.getRemoteVideoIsReady(F);te.totalFreezesDuration===void 0&&N&&Me&&F_.isRemoteVideoFreeze(N,te,v)&&(T.totalFreezeTime+=1),T.freezeRate=Math.max(0,Math.min((T.totalFreezeTime-ue)/(T.totalDuration-fe),1))}Y&&(S.end2EndDelay=Y.B_ad,T.end2EndDelay=Y.B_vd,S.transportDelay=Y.B_ed,T.transportDelay=Y.B_ed,S.currentPacketLossRate=Y.B_ealr4/100,T.currentPacketLossRate=Y.B_evlr4/100,P.uplinkNetworkQuality=Y.B_punq?Y.B_punq:0,P.downlinkNetworkQuality=Y.B_pdnq?Y.B_pdnq:0),this.remoteStats.set(l,{audioStats:S,videoStats:T,videoPcStats:te,networkStats:P}),x&&this.exceptionMonitor.setRemoteAudioStats(x,S),N&&this.exceptionMonitor.setRemoteVideoStats(N,T)})}}class e5{constructor(){O(this,"destChannelMediaInfos",new Map),O(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){d3(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){d3(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){n0(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function t5(e){if(!(e instanceof e5))return new re(U.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new re(U.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new re(U.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Fd{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){O(this,"uid",void 0),O(this,"_uintid",void 0),O(this,"_trust_in_room_",!0),O(this,"_trust_audio_enabled_state_",!0),O(this,"_trust_video_enabled_state_",!0),O(this,"_trust_audio_mute_state_",!0),O(this,"_trust_video_mute_state_",!0),O(this,"_audio_muted_",!1),O(this,"_video_muted_",!1),O(this,"_audio_enabled_",!0),O(this,"_video_enabled_",!0),O(this,"_audio_added_",!1),O(this,"_video_added_",!1),O(this,"_is_pre_created",!1),O(this,"_video_pre_subscribed",!1),O(this,"_audio_pre_subscribed",!1),O(this,"_trust_video_stream_added_state_",!0),O(this,"_trust_audio_stream_added_state_",!0),O(this,"_audioTrack",void 0),O(this,"_videoTrack",void 0),O(this,"_dataChannels",[]),O(this,"_audioSSRC",void 0),O(this,"_videoSSRC",void 0),O(this,"_audioOrtc",void 0),O(this,"_videoOrtc",void 0),O(this,"_cname",void 0),O(this,"_rtxSsrcId",void 0),O(this,"_videoMid",void 0),O(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function n5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function vI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?n5(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const H_e=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),v0="9",yI=2e4,y0=4e4;let r5=class{get localCapabilities(){return On(this._localCapabilities)}get rtpCapabilities(){return On(this._rtpCapabilities)}get candidates(){return On(this._candidates)}get iceParameters(){return On(this._iceParameters)}get dtlsParameters(){return On(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_originCandidates",void 0),O(this,"_iceParameters",void 0),O(this,"_isUseExtmapAllowMixed",void 0),O(this,"_isUseLocalCodecs",void 0),O(this,"_isUseDataChannel",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),O(this,"useLocalCodecsMids",[]),O(this,"preloadSsrcs",[]),O(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,this._isUseDataChannel=i,e=On(e);const{iceParameters:a,dtlsParameters:l,candidates:u,rtpCapabilities:h,setup:m,localCapabilities:g,cname:_}=e;this._rtpCapabilities=h,this._candidates=u,this._originCandidates=On(u),this._iceParameters=a,this._dtlsParameters=l,this._localCapabilities=g,this.setup=m,this.cname=_,[this.sessionDesc]=this.updateRemoteRTPCapabilities(h),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var n;return Ee(n=this.preloadSsrcs).call(n,t)})}preloadRemoteMedia(e){let t=0;const n=[],i=[];for(;e>0;){const a=[vI({ssrcId:y0+t},j("USE_SUB_RTX")?{rtx:y0+t+1}:{})],l="".concat(y0+t,"_").concat(yI+t),{ssrcs:u,ssrcGroups:h}=L_(a,this.cname,j("SYNC_GROUP")?l:void 0),m=this.preCreateOrRecycleSendMedia("video",u,h,void 0),g=[{ssrcId:yI+t}],_="".concat(y0+t,"_").concat(yI+t),{ssrcs:v,ssrcGroups:S}=L_(g,this.cname,j("SYNC_GROUP")?_:void 0),T=this.preCreateOrRecycleSendMedia("audio",v,S,void 0);e--,t+=2,n.push(m,T),i.push(u[0].ssrcId,v[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=i,{mids:n,preSSRCs:i,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,i){const a=this.rtpCapabilities.send.videoCodecs,l=this._isUseLocalCodecs||a.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;w.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const u=e===Ve.VIDEO?l.videoCodecs:l.audioCodecs,h=e===Ve.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let g={media:{mediaType:e,port:v0,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};return g=this.mungSendMediaDesc(g,i),this.sessionDesc.mediaDescriptions.push(g),this.updateBundleMids(),m}toString(){return Ul(this.sessionDesc)}send(e,t,n,i){const{ssrcs:a,ssrcGroups:l}=L_(t,this.cname,j("SYNC_GROUP")?n:void 0),u=this.findPreloadMediaDesc(a);if(u){if(An()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),i&&(i.twcc||i.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,i),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(e,a);let m;return h===-1||h===1&&(ss()||function(){const g=qt();return!(g.name!==Qt.CHROME||!g.osVersion)&&Number(g.version)<=90}()||j("ENABLE_ENCODED_TRANSFORM")&&jl())||h===0&&!function(g){const _=qt();return!(_.name!==Qt.FIREFOX||!_.osVersion)&&Number(_.version)===g}(138)&&j("USE_SUB_RTX")||$V()?(m=this.createOrRecycleSendMedia(e,a,l,"sendonly",i),this.updateBundleMids()):(m=On(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="sendonly",m.attributes.ssrcs=a,m.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(m,i)),An()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(a=>{let{kind:l,ssrcMsg:u,mslabel:h}=a;return this.send(l,u,h)}),n=[];let i=!1;return t.forEach(a=>{let{mid:l,needExchangeSDP:u}=a;u&&(i=!0),n.push(l)}),{mids:n,needExchangeSDP:i}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||An()||$V()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ee(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ee(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,i){e.forEach((a,l)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",t,n,i[l])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||li((n=this._isUseExtmapAllowMixed,this._isUseDataChannel?H_e(n):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;let i=!1;const a=this.rtpCapabilities.send,l=this.localCapabilities.send,u=this.localCapabilities.recv,h=u.videoCodecs,m=u.audioCodecs,g=u.videoExtensions,_=u.audioExtensions;for(const P of t.mediaDescriptions){var v;if(P.attributes.direction!=="sendonly"||typeof P.attributes.mid!="string"||!Ee(v=this.useLocalCodecsMids).call(v,P.attributes.mid)){if(i=!0,P.attributes.iceUfrag=this._iceParameters.iceUfrag,P.attributes.icePwd=this._iceParameters.icePwd,P.attributes.fingerprints=this._dtlsParameters.fingerprints,P.attributes.candidates=this._candidates,P.attributes.setup=this.setup,P.media.mediaType==="application"&&(P.attributes.sctpPort="5000"),P.media.mediaType==="video")if(this._isUseLocalCodecs&&P.attributes.direction==="sendonly"){var S;P.media.fmts=h.map(N=>N.payloadType.toString(10)),P.attributes.payloads=h,P.attributes.extmaps=g;const x=P.attributes.mid;typeof x!="string"||Ee(S=this.useLocalCodecsMids).call(S,x)||this.useLocalCodecsMids.push(x)}else if(a.videoCodecs.length===0){const x=l.videoCodecs.filter(N=>{var M,F;return(M=N.rtpMap)===null||M===void 0?void 0:Ee(F=M.encodingName.toLowerCase()).call(F,"vp8")});x.length===0&&x.push(l.videoCodecs[0]),P.media.fmts=x.map(N=>N.payloadType.toString(10)),P.attributes.payloads=x,P.attributes.extmaps=[]}else P.media.fmts=a.videoCodecs.map(x=>x.payloadType.toString(10)),P.attributes.payloads=a.videoCodecs,P.attributes.extmaps=a.videoExtensions;if(P.media.mediaType==="audio")if(this._isUseLocalCodecs&&P.attributes.direction==="sendonly"){var T;P.media.fmts=m.map(N=>N.payloadType.toString(10)),P.attributes.payloads=m,P.attributes.extmaps=_;const x=P.attributes.mid;typeof x!="string"||Ee(T=this.useLocalCodecsMids).call(T,x)||this.useLocalCodecsMids.push(x)}else if(a.audioCodecs.length===0){const x=l.audioCodecs.filter(N=>{var M,F;return(M=N.rtpMap)===null||M===void 0?void 0:Ee(F=M.encodingName.toLowerCase()).call(F,"opus")})||[l.audioCodecs[0]];P.media.fmts=x.map(N=>N.payloadType.toString(10)),P.attributes.payloads=x,P.attributes.extmaps=[]}else P.media.fmts=a.audioCodecs.map(x=>x.payloadType.toString(10)),P.attributes.payloads=a.audioCodecs,P.attributes.extmaps=a.audioExtensions,Wm(P)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,i]}updateCandidates(e){const t=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(t.forEach(i=>{n.push(vI(vI({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),t.length!==0){switch(e){case as.TCP_RELAY:this._candidates=n;break;case as.UDP_TCP_RELAY:case as.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(e){e=On(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(An()){if(i){const a=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(a||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!a||a!==n.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:v0,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,i,a,l){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=M_(u,h,this.localCapabilities.send,u===Ve.VIDEO?i:a),g=u===Ve.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let v={media:{mediaType:u,port:v0,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungRecvMediaDsec(v,e,l);const S=this.findFirstClosedMedia(u);if(S){const T=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[T]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map(a=>a.fingerprint)),n=new Set(e.map(a=>a.fingerprint));let i=!1;t.size!==n.size&&(i=!0);for(const a of t)n.has(a)||(i=!0);return i}updateRemoteCodec(e,t,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(v=>v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"").filter(v=>{var S;return Ee(S=Object.keys(fh)).call(S,v)}))],a=new Set(t);if(i.every(v=>a.has(v)))return w.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const l=this._rtpCapabilities.recv.videoCodecs.filter(v=>t.some(S=>{var T;return Ee(T=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"").call(T,S)}));if(l.length===0)return w.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(t)),!1;const u=[...new Set(l.map(v=>v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||""))];let h;if(w.debug("updateRemoteCodec, from ".concat(i," to ").concat(u)),e.length===0)h=this.sessionDesc.mediaDescriptions.filter(v=>v.media.mediaType==="video"&&v.attributes.direction==="recvonly");else if(h=this.sessionDesc.mediaDescriptions.filter(v=>v.attributes.mid&&v.media.mediaType==="video"&&Ee(e).call(e,v.attributes.mid)&&v.attributes.direction==="recvonly"),h.length!==e.length)return w.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(j("USE_PUB_RTX")||j("USE_SUB_RTX")){const v=Vd(l,this.rtpCapabilities.recv.videoCodecs);l.push(...v)}this._rtpCapabilities.recv.videoCodecs=l;const m=this.localCapabilities.send,g=this.rtpCapabilities.recv,_=M_(Ve.VIDEO,g,m,n);return h.forEach(v=>{const S=_.map(T=>T.payloadType.toString(10));w.debug("updateRemoteCodec mid: ".concat(v.attributes.mid,", from"),v.attributes.payloads,"to",_),v.attributes.payloads=_,v.media.fmts=S}),w.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,n,i,a){const l=this.rtpCapabilities.send.videoCodecs,u=this._isUseLocalCodecs||l.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,h=e===Ve.VIDEO?u.videoCodecs:u.audioCodecs,m=e===Ve.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let _={media:{mediaType:e,port:v0,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};_=this.mungSendMediaDesc(_,a);const v=this.findFirstClosedMedia(e);if(v){const S=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const i=On(e);return sI(i),Rh(i,t),iI(i,t),O3(i),h0(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=On(e);return n.attributes&&n.attributes.payloads&&Array.isArray(n.attributes.payloads)&&n.attributes.payloads.length>0&&n.attributes.payloads.forEach(i=>{i.rtpMap&&i.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j("ENABLE_DOWN_SPS_PPS")&&(i.fmtp&&i.fmtp.parameters||(i.fmtp={parameters:{}}),i.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),h0(n,t,this.localCapabilities.recv),Wm(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>An()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function s5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Gl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s5(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var zm=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(zm||{});const S0=new Map;function i5(e,t,n,i){let{scale:a}=e;if(a===0&&i===zm.UP||a>=t.length-1&&i===zm.DOWN)return e;let l=Gl(Gl({},e),{},{scale:i===zm.DOWN?++a:--a});switch(n){case"maintain-framerate":l=Gl(Gl({},l),t[a].motion);break;case"maintain-resolution":l=Gl(Gl({},l),t[a].detail);break;case"balanced":l=Gl(Gl({},l),t[a].balanced)}return l}function a5(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:o5(t)};S0.set(e,n)}else S0.delete(e)}function o5(e){const t=Gl({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:a,bitrateMin:l}=t,{MIN_FRAME_RATE:u,MAX_THRESHOLD_FRAMERATE:h,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:g,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:v,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:T,PERF_SCALE_UP_THRESHOLD:P,BALANCE_BITRATE_FACTOR:x,BALANCE_FRAMERATE_FACTOR:N,BALANCE_RESOLUTION_FACTOR:M,MOTION_RESOLUTION_FACTOR:F,MOTION_BITRATE_FACTOR:q,DETAIL_FRAMERATE_FACTOR:J,DETAIL_BITRATE_FACTOR:te}=pN,Y=Math.min(t.frameRate,h),ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(T,1)*Y),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:l}}];for(let ue=1;ue<=m;ue++){const fe={bwe_up:Math.round(Math.pow(v,ue)*n),bwe_down:Math.round(Math.pow(S,ue+1)*n),fps_up:Math.round(Math.pow(P,ue)*Y),fps_down:Math.round(Math.pow(T,ue+1)*Y)},Me={scaleResolutionDownBy:a/Math.pow(M,ue),frameRate:Math.max(Math.round(Math.pow(N,ue)*i),u),bitrateMax:Math.max(Math.round(Math.pow(x,ue)*n),_),bitrateMin:Math.max(Math.round(Math.pow(x,ue)*l),g)},ut={scaleResolutionDownBy:a/Math.pow(F,ue),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(q,ue)*n),_),bitrateMin:Math.max(Math.round(Math.pow(q,ue)*l),g)},ot={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(J,ue)*i),u),bitrateMax:Math.max(Math.round(Math.pow(te,ue)*n),_),bitrateMin:Math.max(Math.round(Math.pow(te,ue)*l),g)};ne.push({scale:ue,threshold:fe,balanced:Me,motion:ut,detail:ot})}return ne}function K_e(e,t,n,i,a,l){const u=S0.get(e)||{overUse:0,underUse:0,adaptationList:o5(a)},{adaptationList:h}=u;S0.set(e,u);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:g}=pN,{scale:_}=i;let v,S;return typeof t=="number"&&t>0&&function(T,P,x,N){if(P>=x.length)return!1;let{threshold:{fps_down:M}}=x[P];return j("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(M=x[0].threshold.fps_down),T<M}(t,_,h,l)&&(u.overUse++,S=wm.CPU,u.overUse>m)||typeof n=="number"&&n>0&&function(T,P,x){if(P>=x.length)return!1;const{threshold:{bwe_down:N}}=x[P];return T<N}(n,_,h)&&(u.overUse++,S=wm.BANDWIDTH,u.overUse>m)?(u.overUse=0,u.underUse=0,v=i5(i,h,l,zm.DOWN),[v,S]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(T,P,x,N){if(P===0)return;let{threshold:{fps_up:M}}=x[P];return j("FORCE_AG_HIGH_FRAMERATE")&&N==="maintain-framerate"&&(M=x[1].threshold.fps_up),T>M}(t,_,h,l)&&function(T,P,x){if(P===0)return;const{threshold:{bwe_up:N}}=x[P];return T>N}(n,_,h)&&(u.underUse++,u.underUse>g&&(u.overUse=0,u.underUse=0,v=i5(i,h,l,zm.UP),v.scale===0&&(S=wm.NONE))),[v,S])}function c5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function SI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?c5(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function l5(e){var t;return!!j("ENABLE_AG_ADAPTATION")&&!!(e instanceof KS||Ee(t=e._hints).call(t,sn.CUSTOM_TRACK))&&(!!j("FORCE_SUPPORT_AG_ADAPTATION")||!!(QV(14,0)&&JV(17,4)||XV(14)&&qx(17,4)))}const T0=new Map;function d5(e,t,n,i,a,l){if(qm(e,n),a(t),i!=="balanced"&&i!=="maintain-framerate"&&i!=="maintain-resolution")return;let u=-1;a5(e,t);const h=window.setInterval(()=>{const g=T0.get(e);if(!j("ENABLE_AG_ADAPTATION")||!g)return qm(e,n),void a(t);const _=l();if(_.sendPackets>0&&_.OutgoingAvailableBandwidth>0){if(u===-1)return void(u=Date.now());if(Date.now()-u<1e3)return;const v=_.sendFrameRate,S=_.OutgoingAvailableBandwidth,[T,P]=K_e(e,v,S,g.adaptationConfig,t,i);P&&(n.qualityLimitationReason=P),T&&g.adaptationConfig.scale!==T.scale&&(w.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,`
           sendFps `).concat(v,", bwe ").concat(S,", switch from ").concat(g.adaptationConfig.scale," to ").concat(T.scale," ")),g.adaptationConfig=SI(SI({},g.adaptationConfig),T),a(T))}},j("CHECK_LOCAL_STATS_INTERVAL")),m=SI({},t);T0.set(e,{timer:h,adaptationConfig:m,originConfig:t,adaptationFunc:a}),w.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(i))}function qm(e,t){const n=T0.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),T0.delete(e)}t.qualityLimitationReason=wm.NONE,a5(e)}function z_e(e,t){var n;let i;switch(t){case ve.LocalAudioTrack:i=ln.Audio;break;case ve.LocalVideoTrack:i=Ee(n=e._hints).call(n,sn.SCREEN_TRACK)?ln.Screen:ln.High;break;case ve.LocalVideoLowTrack:i=ln.Low}return i}function TI(e){const t=jt();if(e.some(n=>n._bypassWebAudio))throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function bI(e,t){TI(e);const n=new Ur;return e.forEach(i=>n.addAudioTrack(i)),n}const q_e=!jt().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&Hc();function B_(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return n={spec:t,store:e},tc("DataChannelConnection").create(n);var n;return q_e?function(a){return tc("PlanBConnection").create(a)}({spec:t,store:e}):new Ta(t,e)}function wI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function CI(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(ch(e.turnServer.servers))return!1;if(j("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Ht;function u5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?u5(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Ta=(Ht=class Hh extends a0{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ee(n=Object.keys(fh)).call(n,t)}))]}constructor(t,n){super(t,n),O(this,"id",on(5,"connection-")),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"forceTurn",!1),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"transportEventReceiver",void 0),O(this,"statsFilter",void 0),O(this,"extension",{useXR:j("USE_XR")}),O(this,"localCapabilities",void 0),O(this,"remoteCodecs",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"isPreallocation",!1),O(this,"isPreRender",!1),O(this,"preMediaMap",new Map),O(this,"dataStreamChannelMap",new Map),O(this,"establishPromise",void 0),O(this,"recoveredDataChannelIds",[]),O(this,"currentDataChannelId",1),O(this,"supportAV1RtpSpec",!1),O(this,"mutex",void 0),O(this,"qualityLimitationReason",wm.NONE),O(this,"isFirstConnected",!1),this.store=n,this.forceTurn=CI(t),this.mutex=new is("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Hh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=kS(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,An()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void w.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else w.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Qc(n.sdp),a=await oI({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:j("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:j("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=j_(a),this.initialOffer=n,j("ENABLE_SVC")&&this.store.codec=="av1"){const u=await P3();var t;u&&(this.supportAV1RtpSpec=!0,(t=a.send)===null||t===void 0||t.videoExtensions.push(u))}let l;return n.sdp&&p0(n.sdp)&&(l=On(a),w3(l)),rc(rc({},i),{},{rtpCapabilities:l||a,offerSDP:n.sdp})}catch(n){throw new ae(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&p0(this.initialOffer.sdp)&&C3(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new r5(rc(rc({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!j("ENABLE_PRE_SUB_WITH_PRE_PC")||!j("PRE_USE_LOCAL_CODECS"))&&x_(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),i=cI(this.initialOffer.sdp,this.extension),a=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),x_(this.store))if(t.preallocation&&j("ENABLE_PRE_SUB_WITH_PRE_PC")){const u=j("PRE_SUB_NUM"),{mids:h,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(u);await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(h,m)}else{const{preSSRCs:u=[]}=t,h=u.map(g=>g.ssrcMsg[0].ssrcId);if(u.length===0)return;const{mids:m}=this.remoteSDP.batchSend(u.map(g=>Object.assign({},g)));await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(m,h)}}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((i,a)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&i===l.mid&&l.receiver.track){const u=l.receiver.track;let h;u.kind==="video"&&j("ENABLE_PRE_RENDER")&&(h=new HS({trackId:"track-".concat(u.kind,"-unknown-").concat(this.store.clientId,"_").concat(on(5,""))},!0),h.updateVideoTrack(u),h.onFirstVideoFrameRender=()=>{var m;const g=this.preMediaMap.get(n[a]);g&&(g.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,n[a])},h.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,n[a])},h.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(n[a],{mid:i,track:u,player:h,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const u=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||u}const{preSSRCs:a=[]}=t,l=a.map(u=>u.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const u=[],h=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[g,{mid:_,player:v,track:S}]=m;return u.push(_),h.push(g),this.preMediaMap.delete(g),v&&v.destroy(),!0}),u.length>0&&(this.remoteSDP.stopSending(u),await Li(this.peerConnection,this.remoteSDP,this.extension),w.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(h)),Be.reportApiInvoke(this.store.sessionId,{name:Vn.PRELOAD_MEDIA_FAILED,options:[a,h],tag:gn.TRACER}).onSuccess()),a.length>0){const{mids:m}=this.remoteSDP.batchSend(a.map(g=>Object.assign({},g)));await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(m,l)}}n?(await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):w.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var a=this;return vi(function*(){const l=yield Rt(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[],h=D_();t.forEach(N=>{const M=a.peerConnection.addTransceiver(N._mediaStreamTrack,rc({direction:"sendonly"},N.trackMediaType==="video"&&a.supportAV1RtpSpec&&h?{sendEncodings:[{scalabilityMode:h}]}:{}));u.push(M),N._updateRtpTransceiver(M)}),An()&&j("SIMULCAST")===!0&&(yield Rt(a.applySimulcastForFirefox(u,t)));const m=yield Rt(a.peerConnection.createOffer()),g=a.remoteSDP.predictReceivingMids(t.length),_=a.mungSendOfferSDP(m.sdp,t,g),v=li(_),S=g.map(N=>{const M=v.mediaDescriptions.find(F=>F.attributes.mid===N);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return rI(M,j("USE_PUB_RTX"))});let T;try{T=yield S}catch(N){T=[],a.remoteSDP.receive(t,n,i,T);const M=a.remoteSDP.toString();throw yield Rt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Rt(a.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Rt(a.stopSending(g,!0)),N}a.remoteSDP.receive(t,n,i,T);const P=a.remoteSDP.toString(),x=a.logSDPExchange(_,"offer","local","send");return yield Rt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Rt(a.applySimulcastEncodings(u,t)),yield Rt(a.applySendEncodings(u,t)),x==null||x(P),yield Rt(a.peerConnection.setRemoteDescription({type:"answer",sdp:P})),u.map((N,M)=>{const F=g[M];return{localSSRC:S[M],id:F,transceiver:N}})}catch(u){throw u instanceof ae?u:new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")w.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(l=>{l._updateOriginDataChannel(i)});const{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),w.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else w.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof ae?i:new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof ae?n:new ae(U.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(m=>{var g;qm(this.id+m.mid,this),m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();u==null||u(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{i&&i()}}async receive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,i,a);u&&(await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const h=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}}catch(l){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(a=>{const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(u=>{let[h,{mid:m,player:g}]=u;if(m===l)return this.preMediaMap.delete(h),g&&g.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(u=>{u.direction="inactive"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(u,h)=>{u.direction="sendonly"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return vi(function*(){const i=yield Rt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=jt().supportPCSetConfiguration,l=j("FORCE_TURN_TCP")||n.forceTurn;if(t===as.RELAY&&!a)return;if(a&&!l){const v=t===as.RELAY?"relay":"all",S=n.peerConnection.getConfiguration();S.iceTransportPolicy!==v&&(w.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(v,"]")),S.iceTransportPolicy=v,n.peerConnection.setConfiguration(S))}n.remoteSDP.updateCandidates(t);const u=yield Rt(n.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Qc(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;n.remoteSDP.restartICE(m);const g=n.remoteSDP.toString(),_=n.logSDPExchange(u.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Rt(n.peerConnection.setLocalDescription(u)),_==null||_(g),yield Rt(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(a){w.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(as.TCP_RELAY),await Li(this.peerConnection,this.remoteSDP,this.extension)}catch(n){w.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{qm(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return rc(rc({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new ae(U.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(a=>a.mid===t);i.length===1&&(this.isVP8Simulcast(n)?An()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(a=>a.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:a}=n.getSelectedCandidatePair();return{local:rc(rc({},_o),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:rc(rc({},_o),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),a=t.port?"local: ".concat(t.port):"",l=Xc(t.url||"");w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(l||"",", host_candidate:").concat(a)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(ch(t.turnServer.servers)?n.iceServers=t.turnServer.servers:j("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(j("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Hh.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Hh.newTurnServerConfigToIceServers(t.turnServer.servers)),j("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Hh.turnServerConfigToIceServers(t.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Hh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(n.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&jt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(To(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!j("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const a=j("NEW_TURN_MODE");a===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):a===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):a===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(To(i.turnServerURL),":443?transport=tcp")}):a===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(To(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var a;n!=null&&n.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,n.state))},n.onerror=a=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in a?a.error:a)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const a=n==null?void 0:n.iceTransport.state;var l;a&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,a))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:a,remote:l}=i.getSelectedCandidatePair()||{};if(a&&l){const u=a.address+":"+a.port,h=l.address+":"+l.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Xc(u)),", remote ").concat(JSON.stringify(Xc(h))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,a;if(n||(n=this.peerConnection.getSenders().find(N=>N.track===t._mediaStreamTrack)),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jt().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},u={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const h=T3(this.peerConnection,t._mediaStreamTrack),m=u4(t);if(l5(t)&&h&&n&&m&&this.getLocalVideoStats&&Ee(i=["vp8","vp9"]).call(i,this.store.codec)){var g;const x=l.degradationPreference||(Ee(g=t._hints).call(g,sn.CUSTOM_TRACK)?j("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");d5(this.id+h.mid,m,this,x,N=>{n&&this.updateAdaptation(n,N)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var _;const{bitrateMax:x,frameRate:N,scaleResolutionDownBy:M}=t._encoderConfig;x&&(u.maxBitrate=1e3*x),(Ee(_=t._hints).call(_,sn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(N&&(u.maxFramerate=wi(N)),M&&M>=1&&(u.scaleResolutionDownBy=M))}const{maxFramerate:v}=j("ENCODER_CONFIG_LIMIT");if(v&&typeof v=="number"&&(u.maxFramerate=u.maxFramerate?Math.min(u.maxFramerate,v):v),j("DSCP_TYPE")&&Hc()){var S;const x=j("DSCP_TYPE");Ee(S=["very-low","low","medium","high"]).call(S,x)&&(u.networkPriority=x)}const T=n.getParameters(),P=(a=T.encodings)===null||a===void 0?void 0:a[0];An()&&!P&&(l.encodings=[u]),P&&Object.assign(P,u),Object.assign(T,l),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(T.encodings))),await n.setParameters(T),await L3(this.store.codec,n,j("SVC_MODE"))}async updateAdaptation(t,n){var i,a;if(!t)return w.debug("[updateAdaptation] no rtpSender found");if(!jt().supportSetRtpSenderParameters)return w.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:u,frameRate:h,scaleResolutionDownBy:m}=n;u&&(l.maxBitrate=1e3*u),h&&(l.maxFramerate=wi(h)),m&&m>=1&&Ee(i=["vp8","vp9"]).call(i,this.store.codec)&&(l.scaleResolutionDownBy=m);const g=t.getParameters(),_=(a=g.encodings)===null||a===void 0?void 0:a[0];_&&Object.assign(_,l),Object.assign(g,{});try{await t.setParameters(g),w.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(v){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?w.debug("[updateAdaptation] peerConnection not connected}"):w.debug("[updateAdaptation] updateRtpSenderEncodings failed",v):w.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!jt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const a=t[i],l=n[i];l instanceof _n&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,a.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const a=li(t);return n.forEach((l,u)=>{const h=i[u],m=a.mediaDescriptions.find(g=>g.attributes.mid===h);m&&(Rh(m,l),aI(m,l,this.store.codec))}),Ul(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,a,l,u,h;const g=t[m],_=n[m];if(_ instanceof _n&&!Ee(i=_._hints).call(i,sn.LOW_STREAM)&&(a=_._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((l=_._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=_._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const T=g.sender.getParameters();await g.sender.setParameters(Object.assign(T,v))}}}async applySimulcastEncodings(t,n){if(!An()&&t.length===n.length)for(let i=0;i<t.length;i++){const a=n[i];if(a instanceof _n&&this.isVP8Simulcast(a)){const l=t[i],u={},h={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var n,i,a,l,u;return!!(t instanceof _n&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ee(n=t._hints).call(n,sn.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,i,a){if(j("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(a,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(jt().supportPCSetConfiguration){const n=Hh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ae(Ht.prototype,"updateRemoteRTPCapabilities",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"updateRemoteRTPCapabilities"),Ht.prototype),Ae(Ht.prototype,"connect",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"connect"),Ht.prototype),Ae(Ht.prototype,"updateRemoteConnect",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"updateRemoteConnect"),Ht.prototype),Ae(Ht.prototype,"createDataChannels",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"createDataChannels"),Ht.prototype),Ae(Ht.prototype,"receive",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"receive"),Ht.prototype),Ae(Ht.prototype,"batchReceive",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"batchReceive"),Ht.prototype),Ae(Ht.prototype,"stopReceiving",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"stopReceiving"),Ht.prototype),Ae(Ht.prototype,"muteRemote",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"muteRemote"),Ht.prototype),Ae(Ht.prototype,"unmuteRemote",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"unmuteRemote"),Ht.prototype),Ae(Ht.prototype,"muteLocal",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"muteLocal"),Ht.prototype),Ae(Ht.prototype,"unmuteLocal",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"unmuteLocal"),Ht.prototype),Ae(Ht.prototype,"close",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"close"),Ht.prototype),Ae(Ht.prototype,"updateEncoderConfig",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"updateEncoderConfig"),Ht.prototype),Ae(Ht.prototype,"updateSendParameters",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"updateSendParameters"),Ht.prototype),Ae(Ht.prototype,"replaceTrack",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"replaceTrack"),Ht.prototype),Ae(Ht.prototype,"updateAdaptation",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"updateAdaptation"),Ht.prototype),Ae(Ht.prototype,"getRemoteSSRC",[Ci],Object.getOwnPropertyDescriptor(Ht.prototype,"getRemoteSSRC"),Ht.prototype),Ht);function Ci(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("From P2PConnection.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{l()}},n}function RI(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=wi(t.width),i.height=wi(t.height);const a=wi(t.framerate||15);document.body.append(n),document.body.append(i);let l=e._mediaStreamTrack;n.srcObject=new MediaStream([l]),n.play().catch(b_);const u=i.getContext("2d");if(!u)throw new re(U.UNEXPECTED_ERROR,"can not get canvas context");const h=jt(),m=i.captureStream(h.supportRequestFrame?0:a).getVideoTracks()[0];m.canvas||(m.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const _=n.videoWidth,v=n.videoHeight/_,S=i.width*v;Math.abs(S-i.height)>=2&&(w.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(S)),i.height=S)}u.drawImage(n,0,0,i.width,i.height),m.requestFrame&&m.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,n.srcObject=new MediaStream([l]))},i.stopCapture=RN(()=>i.startCapture&&i.startCapture(),a);const g=m.stop;return m.stop=()=>{g.call(m),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),w.debug("clean low stream renderer")},m}var h5=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(h5||{}),sc=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(sc||{}),Et=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(Et||{}),Qr=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e}(Qr||{}),ys=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(ys||{}),Ym=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e}(Ym||{}),xI=function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e}(xI||{});const Nh=1e3,b0=6,G_=3,Y_e=Math.max(b0,G_,60);function it(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function p5(e){const t={[ys.CONN_TYPE]:0,[ys.RTT]:e.rtt,[ys.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[ys.CONN_TYPE]=1),n==="tcp"&&(t[ys.CONN_TYPE]=3),n==="tls"&&(t[ys.CONN_TYPE]=4);break}case"srflx":t[ys.CONN_TYPE]=2;break;case"unknown":t[ys.CONN_TYPE]=5;break;default:t[ys.CONN_TYPE]=0}return t}function m5(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class f5 extends Yn{constructor(t){super(),O(this,"store",void 0),O(this,"uploadWRTCStatsTimer",void 0),O(this,"uploadOutboundDenoiserStatsTimer",void 0),O(this,"uploadExtStatsTimer",void 0),O(this,"uploadExtUsageStatsTimer",void 0),O(this,"uploadInboundExtStatsTimer",void 0),O(this,"requestStats",void 0),O(this,"requestTransportStats",void 0),O(this,"requestLocalMedia",void 0),O(this,"requestRemoteMedia",void 0),O(this,"requestAllTracks",void 0),O(this,"requestVideoIsReady",void 0),O(this,"requestUploadStats",void 0),O(this,"requestUpload",void 0),O(this,"uploadOutboundStarted",!1),O(this,"uploadInboundStarted",!1),O(this,"uploadTransportStarted",!1),O(this,"uploadBaseStatsStarted",!1),O(this,"uploadExtensionUsageStarted",!1),O(this,"lastRecvStats",void 0),O(this,"lastSendStats",void 0),O(this,"lastRefRecvStats",void 0),O(this,"lastRefSendStats",void 0),O(this,"lastNormalRecvStats",void 0),O(this,"lastNormalSendStats",void 0),O(this,"lastExtendStats",{}),O(this,"needUploadStats",{}),O(this,"needUploadRenderFreezeTime",!0),O(this,"lastUploadCompensateTime",-1),O(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%G_==0,i=t%b0==0,a=t%60==0;let l,u;if(this.uploadTransportStarted&&(l=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!l&&this.uploadOutboundStarted&&(l=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),l||u){var h;const m={};if(this.uploadTransportStarted&&l){const _=this.getTransportStats(l,n?this.lastRefSendStats:void 0,u,n);_&&(m.misc=[_])}if(this.uploadOutboundStarted&&l){const _=this.getOutboundStats(l,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,a);_&&(m.outbound=[_])}if(this.uploadInboundStarted&&u){this.uploadCompensateStats(t);const _=this.getInboundStats(u,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);_&&(m.inbound=_)}const g=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;if(g&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[Ym.RTC_PEER_CONNECTION_STATE]=dN[g]):m.misc=[{addition:{[Ym.RTC_PEER_CONNECTION_STATE]:dN[g]}}]),$i.needUploadStats.length>0||i){const _=$i.needUploadStats.shift()||($i.visibility==="visible"?1:0);Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[Ym.PAGE_VISIBILITY]=_):m.misc=[{addition:{[Ym.PAGE_VISIBILITY]:_}}]}this.needUploadStats.sendType&&(Array.isArray(m.outbound)&&m.outbound[0]&&m.outbound[0].high&&(m.outbound[0].high[h5.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=l,i&&(this.lastNormalRecvStats=u,this.lastNormalSendStats=l),n&&(this.lastRefRecvStats=u,this.lastRefSendStats=l)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,$i.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const a=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(a&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Ym.RTC_PEER_CONNECTION_STATE]:dN[a.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Y_e+1&&(t=1)},Nh)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%G_==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const a=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*a;const l=this.requestStats(!0);new Array(a).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const u={};if(this.uploadInboundStarted&&l){const h=this.requestRemoteMedia()||[],m=[];h.forEach(g=>{let[_,v]=g;const S={peer:_.uid};if(_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)&&v.has(Ve.VIDEO)&&_.videoTrack){const T=function(P,x,N){if(!x.videoRecv.find(F=>F.ssrc===P))return;const M={};if(N&&N._player){const F=N._player,{renderFreezeAccTime2:q,videoElementStatus:J}=F;if($i.visibility==="visible"&&J===Ds.PLAYING&&jt().supportRequestVideoFrameCallback){const te=Math.min(6e3,q);F.renderFreezeAccTime2=Math.max(0,q-te),it(M,sc.Video_Render_Freeze_Time_Render2,te),j("USE_NEW_RENDER_FREEZE_TIME")&&it(M,sc.Video_Render_Freeze_Time_Render,te)}}return M}(_._videoSSRC,l,_.videoTrack);T&&(S.video=T)}S.video&&m.push(S)}),m.length>0&&(u.inbound=m,this.requestUploadStats(u))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,i,a){if(!this.requestStats)return;if(!a)return t.rtt==null?void 0:{addition:{[ys.RTT]:t.rtt,[ys.CONN_TYPE]:void 0,[ys.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const l=p5(t);if(this.store.useP2P){if(i){const u=p5(i);l[ys.CONN_TYPE]&&u[ys.CONN_TYPE]&&(l[ys.CONN_TYPE]+=u[ys.CONN_TYPE]<<3)}l[ys.CONN_TYPE]?l[ys.CONN_TYPE]+=110:l[ys.CONN_TYPE]=110}else{l[ys.CONN_TYPE]?l[ys.CONN_TYPE]+=100:l[ys.CONN_TYPE]=100;const u=function(h,m){return m?[Math.ceil(8*(h.transport.bytesSent-m.transport.bytesSent)/(h.timestamp-m.timestamp)),Math.ceil(8*(h.transport.bytesReceived-m.transport.bytesReceived)/(h.timestamp-m.timestamp))]:[0,0]}(t,n);l[xI.Transport_Send_Bitrate]=u[0],l[xI.Transport_Recv_Bitrate]=u[1]}return{addition:l}}getOutboundStats(t,n,i,a,l){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,g;return u.forEach(_=>{let[v,{track:S,ssrcs:T}]=_;switch(v){case ve.LocalVideoLowTrack:case ve.LocalVideoTrack:if(v===ve.LocalVideoTrack){var P;const x=function(q,J,te,Y,ne,ue){const fe=J.videoSend.find(Ct=>Ct.ssrc===q);if(!fe)return;const Me={},{sentFrame:ut,inputFrame:ot}=fe;if(Y&&(it(Me,sc.Video_Send_Qp_Sum,fe.qpSumPerFrame),ot&&ut)){const Ct=ot.frameRate,vt=ut.frameRate;Me[sc.Video_Send_Freeze]=function(Zt,Bn){let pe=!0;return pe=!(Zt<=5)&&(Zt<=10?Bn<3:Zt<=20?Bn<4:Bn<5),pe}(Ct,vt)?1:0}if(ne){switch(ut&&(it(Me,Et.Video_Send_Height,ut.height),it(Me,Et.Video_Send_Width,ut.width),it(Me,Et.Video_Send_Frame_Rate,ut.frameRate)),Me[Et.Video_Send_Disabled]=te._originMediaStreamTrack&&!te._originMediaStreamTrack.enabled||te._mediaStreamTrack&&!te._mediaStreamTrack.enabled?1:0,fe.adaptionChangeReason){case"none":Me[Et.Video_Send_Adaptation]=0;break;case"cpu":Me[Et.Video_Send_Adaptation]=1;break;case"bandwidth":Me[Et.Video_Send_Adaptation]=2;break;case"other":Me[Et.Video_Send_Adaptation]=3}let Ct=0;fe.adaptionChangeReason&&(Ct+=m5(fe.adaptionChangeReason)),J.qualityLimitationReason&&(Ct+=m5(J.qualityLimitationReason)<<3),Me[Et.Video_Send_Adaptation]=Ct,Me[Et.Video_Send_Player_Status]=bN[te._player?te._player.videoElementStatus:"uninit"],it(Me,Et.Video_Send_Nacks,fe.nacksCount),it(Me,Et.Video_Send_Plis,fe.plisCount),it(Me,Et.Video_Send_Firs,fe.firsCount),it(Me,Et.Video_Send_Avg_Encode,fe.avgEncodeMs),it(Me,Et.Video_Send_Huge_Frame_Sent,fe.hugeFramesSent),it(Me,Et.Video_Send_Bytes_Retransmit,fe.retransmittedBytesSent),it(Me,Et.Video_Send_Packages_Retransmit,fe.retransmittedPacketsSent),it(Me,Et.Video_Send_Key_Frames_Encoded,fe.keyFramesEncoded);const vt=ne.videoSend.find(Zt=>Zt.ssrc===q);if(vt){let Zt=Nh*G_;vt.timestamp&&fe.timestamp&&(Zt=fe.timestamp-vt.timestamp),vt.packets!=null&&fe.packets!=null&&it(Me,Et.Video_Send_Package_Rate,1e3*(fe.packets-vt.packets)/Zt),fe.packetsLost!=null&&vt.packetsLost!=null&&it(Me,Et.Video_Send_Package_Lost,fe.packetsLost-vt.packetsLost),vt.bytes!=null&&fe.bytes!=null&&it(Me,Et.Video_Send_Bitrate,8*(fe.bytes-vt.bytes)/Zt)}}return Me}(T[0].ssrcId,t,S,n,i),N=S.__className__==="CameraVideoTrack"?3:Ee(P=S._hints).call(P,sn.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==N||l)&&(this.needUploadStats={sendType:N},this.lastExtendStats.sendType=N);const M=S&&function(q,J,te,Y){const ne=J.videoSend.find(fe=>fe.ssrc===q);if(!ne)return null;const ue={};if(Y){const fe=ne.inputFrame,Me=fe&&fe.height||te.videoHeight||0,ut=fe&&fe.width||te.videoWidth||0,ot=fe&&fe.frameRate||0;it(ue,Et.Video_Capture_Height,Me),it(ue,Et.Video_Capture_Width,ut),it(ue,Et.Video_Capture_Frame_Rate,ot)}return ue}(T[0].ssrcId,t,S,!!i),F=function(q,J){const te={};return J&&(it(te,Et.Video_Send_Retransmit,q.bitrate.retransmit),it(te,Et.Video_Send_Target_Encoded,q.bitrate.targetEncoded),it(te,Et.Video_Send_Actual_Encoded,q.bitrate.actualEncoded),it(te,Et.Video_Send_Transmit,q.bitrate.transmit),it(te,Et.Video_Send_Bandwidth,q.sendBandwidth)),te}(t,!!i);m=Object.assign({},x,M,F)}else g=function(x,N,M,F,q){const J=N.videoSend.find(Y=>Y.ssrc===x);if(!J)return;const te={};if(F){const Y=J.sentFrame;Y&&(it(te,Et.Video_Send_Low_Height,Y.height),it(te,Et.Video_Send_Low_Width,Y.width),it(te,Et.Video_Send_Low_Frame_Rate,Y.frameRate));const ne=F.videoSend.find(ue=>ue.ssrc===x);if(ne){let ue=Nh*b0;ne.timestamp&&J.timestamp&&(ue=J.timestamp-ne.timestamp),ne.packets!=null&&J.packets!=null&&it(te,Et.Video_Send_Low_Package_Rate,1e3*(J.packets-ne.packets)/ue),J.packetsLost!=null&&ne.packetsLost!=null&&it(te,Et.Video_Send_Low_Package_Lost,J.packetsLost-ne.packetsLost),ne.bytes!=null&&J.bytes!=null&&it(te,Et.Video_Send_Low_Bitrate,8*(J.bytes-ne.bytes)/ue)}}return te}(T[0].ssrcId,t,0,i);break;case ve.LocalAudioTrack:h=S&&function(x,N,M,F,q,J){const te=N.audioSend.find(ne=>ne.ssrc===x);if(!te)return;const Y={};if(q){Y[Et.Audio_Send_Disabled]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0;const ne=100*M._source.getAccurateVolumeLevel(),ue=te.inputLevel;if(ue!=null){const Me=Math.ceil(50*Math.log10(100*ue+1));it(Y,Et.Audio_Send_Level,Me)}it(Y,Et.Audio_Capture_PCM_Level,ne),it(Y,Et.Audio_Send_AEC_Return_Loss,te.aecReturnLoss),it(Y,Et.Audio_Send_AEC_Return_Loss_Enhancement,te.aecReturnLossEnhancement),it(Y,Et.Audio_Send_Bytes_Retransmit,te.retransmittedBytesSent),it(Y,Et.Audio_Send_Packages_Retransmit,te.retransmittedPacketsSent),Y[Et.Audio_Send_Freeze]=0;const fe=q.audioSend.find(Me=>Me.ssrc===x);if(fe){let Me=Nh*b0;fe.timestamp&&te.timestamp&&(Me=te.timestamp-fe.timestamp),fe.bytes!=null&&te.bytes!=null&&it(Y,Et.Audio_Send_Bitrate,8*(te.bytes-fe.bytes)/Me),fe.packets!=null&&te.packets!=null&&it(Y,Et.Audio_Send_Package_Rate,1e3*(te.packets-fe.packets)/Me)}}return Y}(T[0].ssrcId,t,S,0,i)}}),{high:m,low:g,audio:h}}getInboundStats(t,n,i,a){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],u=[];return l.forEach(h=>{let[m,g]=h;const _={peer:m.uid};let v;if(g.has(Ve.VIDEO)&&m.videoTrack){const S=m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)||!1,T=m.videoTrack?function(P,x,N,M,F,q,J,te){const Y=x.videoRecv.find(vt=>vt.ssrc===P);if(!Y)return;const ne={},{receivedFrame:ue,outputFrame:fe,decodeFrameRate:Me}=Y;it(ne,Qr.Video_Render_Frame_Rate_Decode,Me),Y.framesRateFirefox&&it(ne,Qr.Video_Recv_Frame_Rate,Y.framesRateFirefox),ue&&it(ne,Qr.Video_Recv_Frame_Rate,ue.frameRate),it(ne,Qr.Video_Recv_Frame_Dropped,Y.framesDroppedCount),it(ne,Qr.Video_Recv_Bytes_Retransmit,Y.retransmittedBytesReceived),it(ne,Qr.Video_Recv_Packages_Retransmit,Y.retransmittedPacketsReceived),it(ne,Qr.Video_Recv_Packages_Discarded,Y.packetsDiscarded),it(ne,Qr.Video_Recv_Avg_Decode,Y.avgDecodeMs),it(ne,Qr.Video_Recv_Avg_Processing_Delay,Y.avgProcessingDelayMs),it(ne,Qr.Video_Recv_Avg_Assembly_Time,Y.avgFramesAssembledFromMultiplePacketsMs),it(ne,Qr.Video_Recv_Avg_Inter_Frame_Delay,Y.avgInterFrameDelayMs),it(ne,Qr.Video_Recv_Key_Frames_Decoded,Y.keyFramesDecoded);const ut=te&&te.videoRecv.find(vt=>vt.ssrc===P);if(ut){const vt=x.timestamp-te.timestamp||Nh;Y.packetsLost!=null&&ut.packetsLost!=null&&it(ne,Qr.Video_Recv_Package_Lost,Y.packetsLost-ut.packetsLost),ut.bytes!=null&&Y.bytes!=null&&it(ne,Qr.Video_Recv_Bitrate,8*(Y.bytes-ut.bytes)/vt),ut.packets!=null&&Y.packets!=null&&it(ne,Qr.Video_Recv_Package_Rate,1e3*(Y.packets-ut.packets)/vt)}const ot=q&&q.videoRecv.find(vt=>vt.ssrc===P);if(ot&&(it(ne,sc.Video_Recv_Qp_Sum,Y.qpSumPerFrame),ne[sc.Video_Recv_Freeze]=M&&F_.isRemoteVideoFreeze(N,Y,ot)?1:0),J){var Ct;const vt=J.videoRecv.find(Bn=>Bn.ssrc===P);ue?(it(ne,Et.Video_Recv_Height,ue.height),it(ne,Et.Video_Recv_Width,ue.width)):N&&(it(ne,Et.Video_Recv_Height,N._videoHeight||0),it(ne,Et.Video_Recv_Width,N._videoWidth||0)),fe&&it(ne,Et.Video_Recv_Frame_Rate_Output,fe.frameRate);const Zt=(Ct=N._player)===null||Ct===void 0?void 0:Ct.rendFrameRate.toFixed(0);if(Zt&&it(ne,Et.Video_Render_Frame_Rate_Render,+Zt),it(ne,Et.Video_Recv_Jitter_Buffer,Y.jitterBufferMs),it(ne,Et.Video_Recv_Current_Delay,Y.currentDelayMs),it(ne,Et.Video_Recv_Firs,Y.firsCount),it(ne,Et.Video_Recv_Nacks,Y.nacksCount),it(ne,Et.Video_Recv_Plis,Y.plisCount),N){ne[Et.Video_Recv_Disabled]=N._originMediaStreamTrack.enabled&&N._mediaStreamTrack.enabled?0:1;const Bn=N._player;if(Bn){const{freezeTimeCounterList:pe,renderFreezeAccTime:be,renderFreezeAccTime2:Fe,videoElementStatus:me}=Bn;if(pe&&pe.length>0&&it(ne,sc.Video_Render_Freeze_Time,pe.splice(0,1)[0]),F&&$i.visibility==="visible"&&me===Ds.PLAYING&&jt().supportRequestVideoFrameCallback){const R=Math.min(6e3,Fe);Bn.renderFreezeAccTime2=Math.max(0,Fe-R),it(ne,sc.Video_Render_Freeze_Time_Render2,R);const z=Math.min(6e3,be);Bn.renderFreezeAccTime=Math.max(0,be-z),it(ne,sc.Video_Render_Freeze_Time_Render,j("USE_NEW_RENDER_FREEZE_TIME")?R:z)}if(typeof Y.totalFreezesDuration=="number"){const R=vt&&vt.totalFreezesDuration?Y.totalFreezesDuration-vt.totalFreezesDuration:Y.totalFreezesDuration;it(ne,Et.Video_Render_Freeze_Duration,1e3*R)}}}if(ne[Et.Video_Recv_Player_Status]=bN[N._player?N._player.videoElementStatus:"uninit"],vt&&Y.totalInterFrameDelay!==void 0&&Y.totalSquaredInterFrameDelay!==void 0&&vt.totalInterFrameDelay!==void 0&&vt.totalSquaredInterFrameDelay!==void 0){const Bn=Y.totalInterFrameDelay-vt.totalInterFrameDelay,pe=Y.totalSquaredInterFrameDelay-vt.totalSquaredInterFrameDelay,be=Y.framesDecodeCount-vt.framesDecodeCount,Fe=Bn/be*1e3,me=Math.round(1e3*Math.sqrt((pe-Math.pow(Bn,2)/be)/be));!isNaN(me)&&Fe+me>Math.max(3*Fe,Fe+150)&&(ne[Et.Video_Recv_I_Frame_Delay]=me)}}return ne}(m._videoSSRC,t,m.videoTrack,S===!0,this.needUploadRenderFreezeTime,n,i,a):void 0;if(T&&(_.video=T),m.videoTrack){const P=t.videoRecv.find(x=>x.ssrc===m._videoSSRC);P&&P.estimatedPlayoutTimestamp&&(v=P.estimatedPlayoutTimestamp)}}if(g.has(Ve.AUDIO)&&m.audioTrack){const S=m.audioTrack?function(T,P,x,N,M,F){const q=P.audioRecv.find(ne=>ne.ssrc===T);if(!q)return;const J={};it(J,Qr.Audio_Recv_Jitter,q.jitterMs),it(J,Qr.Audio_Recv_Bytes_Retransmit,q.retransmittedBytesReceived),it(J,Qr.Audio_Recv_Packages_Retransmit,q.retransmittedPacketsReceived),it(J,Qr.Audio_Recv_Packages_Discarded,q.packetsDiscarded),it(J,Qr.Audio_Recv_Avg_Processing_Delay,q.avgProcessingDelayMs);const te=F&&F.audioRecv.find(ne=>ne.ssrc===T);if(te){const ne=Nh;q.packets!=null&&te.packets!=null&&it(J,Qr.Audio_Recv_Package_Rate,1e3*(q.packets-te.packets)/ne),q.packetsLost!=null&&te.packetsLost!=null&&it(J,Qr.Audio_Recv_Package_Lost,q.packetsLost-te.packetsLost)}if(N){const{receivedFrames:ne,droppedFrames:ue}=q;ne!=null&&ue!=null&&(J[sc.Audio_Recv_Freeze]=(Y=ne)===0||100*ue/Y>20?1:0)}var Y;if(M){const ne=100*x._source.getAccurateVolumeLevel(),ue=q.outputLevel;if(ue!=null){const Me=Math.ceil(50*Math.log10(100*ue+1));it(J,Et.Audio_Render_Level,Me)}it(J,Et.Audio_Recv_PCM_Level,ne),x&&(J[Et.Audio_Recv_Disabled]=x._originMediaStreamTrack.enabled&&x._mediaStreamTrack.enabled?0:1),it(J,Et.Audio_Recv_Jitter_Buffer,q.jitterBufferMs),it(J,Et.Audio_Recv_Current_Delay,q.jitterBufferMs),J[Et.Audio_Recv_Player_Status]=bN[Qs.getPlayerState(x.getTrackId())];const fe=M.audioRecv.find(Me=>Me.ssrc===T);if(fe){fe.bytes!=null&&q.bytes!=null&&it(J,Et.Audio_Recv_Bitrate,8*(q.bytes-fe.bytes)/(Nh*G_));const Me=q.concealedSamples-fe.concealedSamples;Me>0&&it(J,Et.Audio_Recv_Concealed_Samples,Me);const ut=q.totalSamplesReceived-fe.totalSamplesReceived;ut>0&&it(J,Et.Audio_Recv_Total_Samples_Received,ut);const ot=q.freezeSamples80-fe.freezeSamples80;ot>0&&it(J,Et.Audio_Render_Freeze_Samples_80ms,ot);const Ct=q.freezeSamples200-fe.freezeSamples200;Ct>0&&it(J,Et.Audio_Render_Freeze_Samples_200ms,Ct);const vt=q.freezeMs80-fe.freezeMs80;it(J,Et.Audio_Render_Freeze_Time_80ms,vt<0?0:vt);const Zt=q.freezeMs200-fe.freezeMs200;it(J,Et.Audio_Render_Freeze_Time_200ms,Zt<0?0:Zt)}}return J}(m._audioSSRC,t,m.audioTrack,n,i,a):void 0;if(S&&(_.audio=S),m.audioTrack&&v){const T=t.audioRecv.find(P=>P.ssrc===m._audioSSRC);if(T&&T.estimatedPlayoutTimestamp){const P=T.estimatedPlayoutTimestamp-v;_.audio?_.audio[Qr.Audio_Recv_AV_Sync_TIME]=P:_.audio={[Qr.Audio_Recv_AV_Sync_TIME]:P}}}}(_.video||_.audio)&&u.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,u}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof I_);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(wh.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(Ve.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)}),i.has(Ve.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let a=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const g of l)!g.muted&&g.enabled&&(a=a.concat(await g.getProcessorUsage()));const u=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[g,_]of u)_.has(Ve.VIDEO)&&g.videoTrack&&(a=a.concat(await g.videoTrack.getProcessorUsage())),_.has(Ve.AUDIO)&&g.audioTrack&&(a=a.concat(await g.audioTrack.getProcessorUsage()));if(a.length===0)return;i.details=function(g,_){const v={};for(const{id:x,value:N,level:M,direction:F}of g){var S;const q=(S=_.get(x))!==null&&S!==void 0?S:0,J=N===2?q+j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:q;var T,P;_.set(x,J),v[x]?(N===2&&(v[x].value=N),M>v[x].level&&(v[x].level=M),F==="remote"&&(v[x].remoteUidCount+=1),v[x].totalTs=(T=_.get(x))!==null&&T!==void 0?T:0):v[x]={value:N,level:M,remoteUidCount:F==="local"?0:1,totalTs:(P=_.get(x))!==null&&P!==void 0?P:0}}return Object.keys(v).map(x=>{const{level:N,value:M,totalTs:F}=v[x];return{id:x,level:N,value:M,totalTs:F}})}(a,t);const h=Date.now(),m=h>n?h:n+1;this.requestUpload&&this.requestUpload(wh.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:m})},j("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,$i.stopCollectStats()}}const X_e=j("ICE_RESTART_INTERVAL");let w0=new Map,Xm=new Map,Bd=[as.UDP_TCP_RELAY,as.TCP_RELAY,as.RELAY],NI=j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jt().supportPCSetConfiguration;function g5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=w0.get(e.id);n&&(window.clearTimeout(n),w0.delete(e.id));const i=Xm.get(e.id);t&&i&&i.index===Bd.length-1&&(w.debug("[".concat(e.id,"] reset ICE restart policy")),Xm.delete(e.id))}function _5(e,t,n){if(w0.size===0&&Xm.size===0&&(Array.isArray(j("RESTART_SEQUENCE"))&&j("RESTART_SEQUENCE").length>0&&!function(h,m){if(h.length!==m.length)return!1;for(let g=0;g<h.length;g+=1){const _=h[g];if(h.filter(v=>v===_).length!==m.filter(v=>v===_).length)return!1}return!0}(Bd,j("RESTART_SEQUENCE"))&&(Bd=j("RESTART_SEQUENCE").filter(h=>{var m;if(Ee(m=Object.values(as)).call(m,h))return!0}),w.debug("use reconnection policy from config distribution, queues: ".concat(Bd.join(" => ")))),NI=j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jt().supportPCSetConfiguration),Bd.length===0)return void n();let i,{index:a=0,type:l}=Xm.get(e.id)||{};if(NI&&l===as.RELAY)return void n();let u=l&&a>=Bd.length-1;if(NI)l=as.RELAY;else{if(u)return void n();l?(a++,l=Bd[a]):(l=Bd[0],a=0)}w.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(a)),t(l),Xm.set(e.id,{index:a,type:l}),i=window.setTimeout(()=>_5(e,t,n),X_e),w0.set(e.id,i)}var Ut;function E5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Zc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?E5(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function v5(e){var t,n,i,a=2;for(typeof Symbol<"u"&&(n=_S,i=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new C0(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function C0(e){function t(n){if(Object(n)!==n)return Ne.reject(new TypeError(n+" is not an object."));var i=n.done;return Ne.resolve(n.value).then(function(a){return{value:a,done:i}})}return C0=function(n){this.s=n,this.n=n.next},C0.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Ne.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Ne.reject(n):t(i.apply(this.s,arguments))}},new C0(e)}let Ih=(Ut=class extends Yn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Xe.StateChange,t,this._state)}constructor(e,t){super(),O(this,"isPlanB",void 0),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"connection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"remoteDataChannelMap",new Map),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"pendingLocalDataChannels",[]),O(this,"pendingRemoteDataChannels",[]),O(this,"statsCollector",void 0),O(this,"shouldForwardP2PCreation",void 0),O(this,"iceFailedCount",0),O(this,"dtlsFailedCount",0),O(this,"mutex",void 0),O(this,"_state",nn.Disconnected),O(this,"_pcStatsUploadType",j("NEW_ICE_RESTART")?Bl.FIRST_CONNECTION:Bl.OLD_FIRST_CONNECTION),O(this,"_isStartRestartIce",!1),O(this,"_restartTimer",void 0),O(this,"_isTryConnecting",!1),O(this,"_iceError",null),O(this,"_forceTurn",!1),O(this,"_isWaitPcToRePub",!1),O(this,"handleMuteLocalTrack",async(n,i,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==nn.Connected)return void a(new ae(U.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void i();const h=u.find(g=>g[0]==="videoLowTrack");if(h){const g=h[1];this.store.enableInstantMuteRestore?(g.track._originMediaStreamTrack.enabled=!1,w.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):g.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?w.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(u.map(g=>{let[,{id:_}]=g;return _}));const m=this.createMuteMessage(u);await Sn(this,Xe.RequestMuteLocal,m),i()}catch(u){a(u)}finally{l()}}),O(this,"handleUnmuteLocalTrack",async(n,i,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==nn.Connected)return void a(new ae(U.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const u=this.filterTobeUnmutedTracks(n);if(u.length===0)return void i();const h=u.find(g=>g[0]==="videoLowTrack");if(h){const g=h[1];if(this.store.enableInstantMuteRestore)g.track._originMediaStreamTrack.enabled=!0,w.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(g.track._originMediaStreamTrack.stop(),!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding){const _=n._mediaStreamTrack.clone();g.track._mediaStreamTrack=_,g.track._originMediaStreamTrack=_}else{const _=RI(n,dh(this,Xe.RequestLowStreamParameter));g.track._mediaStreamTrack=_,g.track._originMediaStreamTrack=_}await new Ne((_,v)=>{this.handleReplaceTrack(g.track,_,v,!0)})}}this.store.enableInstantMuteRestore?w.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(u.map(g=>{let[,{id:_}]=g;return _}));const m=this.createUnmuteMessage(u);await Sn(this,Xe.RequestUnmuteLocal,m),i()}catch(u){a(u)}finally{l()}}),O(this,"handleUpdateVideoEncoder",async(n,i,a,l)=>{let u;l||(u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.connection||!m||m.track!==n||this.state!==nn.Connected)return void i();const{id:g,track:_}=m;await this.connection.updateSendParameters(g,_),await this.connection.updateEncoderConfig(g,_),this.emit(Xe.UpdateVideoEncoder,_),i()}catch(m){a(m)}finally{var h;(h=u)===null||h===void 0||h()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,a)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const u=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.connection||!u||u.track!==n||this.state!==nn.Connected)return void i();const{id:h,track:m}=u;await this.connection.updateSendParameters(h,m),i()}catch(u){a(u)}finally{l()}}),O(this,"handleReplaceMixingTrack",async(n,i,a,l)=>{if(!this.connection||this.state!==nn.Connected)return void i();const u=bI([n]);let h;w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(u.getTrackId(),"]")),typeof l=="boolean"&&l||(h=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,u),i()}catch(g){a(g)}finally{var m;(m=h)===null||m===void 0||m()}}),O(this,"handleReplaceTrack",async(n,i,a,l)=>{let u;w.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const g=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:v}]=_;return n===v});if(!this.connection||!g||this.state!==nn.Connected)return void i();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(n,g[1].id)),this.isPlanB){const _=g[1];_.id=n._mediaStreamTrack.id,this.localTrackMap.set(g[0],_)}if(g[0]===ve.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding){const _=this.localTrackMap.get(ve.LocalVideoLowTrack);if(_){const v=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v,await new Ne((S,T)=>{this.handleReplaceTrack(_.track,S,T,!0)})}}i()}catch(g){a(g)}finally{var m;(m=u)===null||m===void 0||m()}}),O(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new f5(this.store),this.bindStatsUploaderEvents(),this.mutex=new is("P2PChannel-mutex",this.store.clientId),this.isPlanB=!jt().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&Hc(),this.shouldForwardP2PCreation=j("FORWARD_P2P_CREATION")&&jt().supportPCSetConfiguration&&nF(),this.shouldForwardP2PCreation&&(this.connection=B_(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=nn.New,this._forceTurn=CI(e),w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=B_(this.store,e),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new ae(U.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=j("NEW_ICE_RESTART")?Bl.FIRST_CONNECTION:Bl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new ae(U.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==nn.Connected){this.store.peerConnectionStart();const t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=nn.Connected,t}if(this.connection instanceof Ta&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Be.reportApiInvoke(this.store.sessionId,{name:Vn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:gn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Xe.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(a=>{var l;let[u]=a;return Ee(l=[ve.LocalVideoLowTrack,ve.LocalVideoTrack]).call(l,u)}),n=t.map(a=>{let[,{id:l}]=a;return l}),i=t.map(a=>{let[l]=a;return l});if(this.connection instanceof Ta||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(Be.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Ee(e).call(e,this.store.codec)){const a=["vp9","vp8","h264"].find(l=>Ee(e).call(e,l));a&&(this.store.codec=a,w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ta&&this.connection.peerConnectionState!=="closed"&&Ee(e=[nn.New,nn.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==nn.Connected){if(this.state===nn.Disconnected)throw new ae(U.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var i;Ee(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var i=this;return vi(function*(){const a=yield Rt(i.mutex.lock("From P2PChannel.publish"));try{var l;const u=i.connection&&Ee(l=["disconnected","failed"]).call(l,i.connection.peerConnectionState);if(!i.connection||i.state!==nn.Connected||u){if(i.state===nn.Disconnected)throw new ae(U.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const m=e.filter(g=>i.pendingLocalTracks.indexOf(g)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(m),void(u&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Ls.markPublishStart(i.store.clientId,i.store.pubId);const h=i.filterTobePublishedTracks(e,t,n);if(h.length===0)return void(yield Rt(i.tryToUnmuteAudio(e)));yield*Em(v5(i.doPublish(i.connection,h)))}finally{a()}})()}doPublish(e,t){var n=this;return vi(function*(){t.forEach(S=>{let{track:T,type:P}=S;const x=Date.now();n.store.publish(T.getTrackId(),P===ve.LocalAudioTrack?"audio":"video",x)}),n.bindLocalTrackEvents(t);const i=t.map(S=>{let{track:T}=S;return T}),a=yield Rt(e.send(i,n.store.codec,n.store.audioCodec)),l=(yield Rt(a.next())).value,u=n.createGatewayPublishMessage(t,l);let h;try{h=yield u}catch(S){throw a.throw(S),(S==null?void 0:S.code)===U.WS_ABORT&&t.forEach(T=>{let{track:P}=T;n.pendingLocalTracks.indexOf(P)===-1&&n.pendingLocalTracks.push(P)}),n.unbindLocalTrackEvents(t),S}const m=n.mapPubResToRemoteConfig(u,h,i),g=(yield Rt(a.next(m))).value;if(n.state===nn.Disconnected)throw new ae(U.UNEXPECTED_ERROR,"PeerConnection already disconnected.");j("ENABLE_VIDEO_SEI");const _=j("ENABLE_ENCODED_TRANSFORM"),v=j("ENABLE_AUDIO_METADATA");i.forEach(async S=>{const T=S.getRTCRtpTransceiver();if(!T||!_)return;const{interceptLocalVideoFrame:P,interceptLocalAudioFrame:x}=m0();S.trackMediaType===Ve.VIDEO?await P(T.sender,S):S.trackMediaType===Ve.AUDIO&&await x(T.sender,{metadata:v?()=>{const N=S.metadata.shift();return N&&N.value}:void 0})}),t.forEach(S=>{let{type:T}=S;n.statsCollector.addLocalStats(T)}),n.assignLocalTracks(t,g),n.statsUploader.startUploadOutboundStats(),t.forEach(S=>{let{track:T,type:P}=S;const x=Date.now();n.store.publish(T.getTrackId(),P===ve.LocalAudioTrack?"audio":"video",void 0,x)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof _n))return w.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,a=function(l,u){const h={};return l.height&&l.width&&(h.scaleResolutionDownBy=nI(l,u)),h.maxFramerate=l.framerate?wi(l.framerate):void 0,h.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,h}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==ve.LocalVideoLowTrack||!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{const l=i._originMediaStreamTrack;if(!l.canvas)return w.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(u,h){const m=u.canvas;h.width&&(m.width=wi(h.width)),h.height&&(m.height=wi(h.height)),h.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=RN(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},wi(h.framerate)))})(l,e)}a.maxBitrate!=null&&(i._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=a.maxFramerate:i._encoderConfig.frameRate={max:a.maxFramerate}),w.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return vi(function*(){if(!t.connection||t.state!==nn.Connected)return;const n=yield Rt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const a=t.localTrackMap.get(ve.LocalVideoTrack);if(!a)throw new ae(U.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ve.LocalVideoLowTrack))throw new ae(U.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(a.track,e),type:ve.LocalVideoLowTrack}];if(yield*Em(v5(t.doPublish(t.connection,l))),a.track.muted||!a.track.enabled){var i;const u=(i=t.localTrackMap.get(ve.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;u!==void 0&&(yield Rt(t.connection.muteLocal([u])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(w.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Pr(this,Xe.RequestRePublish,this.pendingLocalTracks),this.emit(Xe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(w.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Pr(this,Xe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==Ve.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==Ve.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Pr(this,Xe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Ve.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Xe.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==nn.Connected)return void e.forEach(i=>{const a=this.pendingLocalTracks.indexOf(i);a!==-1&&this.pendingLocalTracks.splice(a,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==nn.Connected)return void e.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==nn.Connected)return;const e=this.localTrackMap.get(ve.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ve.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:a}]=i;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[a,{track:l}]=i;return{type:a,track:l}})),t.forEach(i=>{let[a]=i;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==nn.Connected)throw new ae(U.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(i=>{var a;return!((a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(i=>{var a;this.remoteDataChannelMap.has(e)?(a=this.remoteDataChannelMap.get(e))===null||a===void 0||a.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const l=this.pendingRemoteDataChannels.findIndex(u=>{let{user:h,id:m}=u;return h.uid===e.uid&&m===i.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),n.map(i=>i.id)}async subscribe(e,t,n,i,a){var l;if(!this.connection||this.state!==nn.Connected)throw new ae(U.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let u,h,m,g;const _=this.connection.getPreMedia(n);if(_)w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),m=_.transceiver,u=_.track,h=_.mid,g=_.player,_.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:_.firstVideoRender});else if(a){const T=a.find(x=>{let{stream_type:N}=x;return N===t});if(!T)throw new ae(U.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const P=await this.connection.receive(t,T.ssrcs,String(e._uintid),T.attributes);(this.connection instanceof Ta||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=P.transceiver),u=P.track,h=P.id}else{const T=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);(this.connection instanceof Ta||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(m=T.transceiver),u=T.track,h=T.id}if(t===Ve.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Lm(u,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new km(u,e.uid,e._uintid,this.store,g),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Ua.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Ua.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),g?e._videoTrack.once(Ua.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Ua.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),m&&j("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:T,interceptRemoteAudioFrame:P}=m0();t==Ve.VIDEO?await T(m.receiver,{onSei:j("ENABLE_VIDEO_SEI")&&(x=>{var N;return(N=e._videoTrack)===null||N===void 0?void 0:N._onSei(x)}),onFirstFrame:x=>{var N;const M=Array.from(Hs(N=this.remoteUserMap).call(N)).find(F=>F._videoSSRC===x.ssrc);M&&this.store.firstVideoFrameDecoded(M.uid,{firstReceivedEncodedFrame:Date.now(),frameType:x.type,rtpTimestamp:x.rtpTimestamp,framePayloadType:x.payloadType,frameDataLength:x.length,mimeType:x.mimeType})}}):t==Ve.AUDIO&&await P(m.receiver,{enableTopn:!!j("ENABLE_AUDIO_TOPN"),enableMetadata:!!j("ENABLE_AUDIO_METADATA"),enablePts:!!j("ENABLE_AUDIO_PTS"),onMetadata:x=>{this.safeEmit(Xe.AudioMetadata,x)},onPts:x=>{this.safeEmit(Xe.AudioPts,x)}})}const v=this.remoteUserMap.get(e);v?v.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(T=>{let{user:P,kind:x}=T;return P.uid===e.uid&&t===x});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(Xe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==nn.Connected)throw new ae(U.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(a=>{var l;let{user:u,mediaType:h}=a;return!((l=this.remoteUserMap.get(u))!==null&&l!==void 0&&l.has(h))});const t=[],n=new Map;e.forEach(a=>{if(!this.connection)return;const l=this.connection.getPreMedia(a.ssrcId);if(l){const{track:u,mid:h,transceiver:m,player:g}=l;n.set(a.ssrcId,{track:u,id:h,transceiver:m,player:g})}else t.push(a)});const i=await this.connection.batchReceive(t.map(a=>{let{user:l,mediaType:u,ssrcId:h,rtxSsrcId:m}=a;return{kind:u,ssrcMsg:[{ssrcId:h,rtx:m}],mslabel:String(l._uintid)}}));t.forEach((a,l)=>{n.set(a.ssrcId,i[l])});for(const{user:a,mediaType:l,ssrcId:u}of e){const h=n.get(u);if(!h)return void w.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(a.uid," subscribe data,").concat(l,", ").concat(u));const{track:m,id:g,transceiver:_,player:v}=h;if(_&&j("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:x}=m0();l==Ve.VIDEO?await P(_.receiver,{onSei:j("ENABLE_VIDEO_SEI")&&(N=>{var M;return(M=a._videoTrack)===null||M===void 0?void 0:M._onSei(N)}),onFirstFrame:N=>{var M;const F=Array.from(Hs(M=this.remoteUserMap).call(M)).find(q=>q._videoSSRC===N.ssrc);F&&this.store.firstVideoFrameDecoded(F.uid,{firstReceivedEncodedFrame:Date.now(),frameType:N.type,rtpTimestamp:N.rtpTimestamp,framePayloadType:N.payloadType,frameDataLength:N.length,mimeType:N.mimeType})}}):l==Ve.AUDIO&&await x(_.receiver,{enableTopn:!!j("ENABLE_AUDIO_TOPN"),enableMetadata:!!j("ENABLE_AUDIO_METADATA"),enablePts:!!j("ENABLE_AUDIO_PTS"),onMetadata:N=>{this.safeEmit(Xe.AudioMetadata,N)},onPts:N=>{this.safeEmit(Xe.AudioPts,N)}})}if(l===Ve.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(m):(a._audioTrack=new Lm(m,a.uid,a._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),_&&a._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(m):(a._videoTrack=new km(m,a.uid,a._uintid,this.store,v),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),_&&a._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(a,a._videoTrack)),j("ENABLE_VIDEO_SEI")&&_){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:x}=m0();l==Ve.VIDEO?await P(_.receiver,{onSei:N=>{var M;(M=a._videoTrack)===null||M===void 0||M._onSei(N)},onFirstFrame:N=>{var M;const F=Array.from(Hs(M=this.remoteUserMap).call(M)).find(q=>q._videoSSRC===N.ssrc);F&&this.store.firstVideoFrameDecoded(F.uid,{firstReceivedEncodedFrame:Date.now(),frameType:N.type,rtpTimestamp:N.rtpTimestamp,framePayloadType:N.payloadType,frameDataLength:N.length,mimeType:N.mimeType})}}):l==Ve.AUDIO&&await x(_.receiver)}const S=this.remoteUserMap.get(a);S?S.set(l,g):this.remoteUserMap.set(a,new Map([[l,g]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadInboundStats();const T=this.pendingRemoteTracks.findIndex(P=>{let{user:x,kind:N}=P;return x.uid===a.uid&&l===N});T!==-1&&(this.pendingRemoteTracks.splice(T,1),this.emit(Xe.MediaReconnectEnd,a.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return t!==void 0?h.uid===e.uid&&t===m:h.uid===e.uid});if(i.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===nn.Connected||n||i.forEach(u=>{let{kind:h}=u;var m;if(h===Ve.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===Ve.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==nn.Connected)return;const a=this.filterTobeUnSubscribedTracks(e,t);if(a.length===0)return;await this.connection.stopReceiving(a.map(u=>{let[,{id:h}]=u;return h}));const l=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach(u=>{let[h,{kind:m}]=u;var g,_;if(m===Ve.VIDEO&&h._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Ve.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),n||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(m===Ve.AUDIO){var v;this.unbindRemoteTrackEvents(h._audioTrack),!n&&((v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(a=>{const l=this.pendingRemoteDataChannels.findIndex(u=>u.id===a.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(a=>{a._close()});const i=this.remoteDataChannelMap.get(e);return n.forEach(a=>{i&&i.delete(a.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(a=>a.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:a,mediaType:l}of e){const u=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return l!==void 0?m.uid===a.uid&&l===g:m.uid===a.uid});u.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(u)}if(!this.connection||this.state!==nn.Connected)return void t.forEach(a=>{let{user:l,kind:u}=a;var h;if(u===Ve.AUDIO)(h=l._audioTrack)===null||h===void 0||h._destroy(),l._audioTrack=void 0;else if(u===Ve.VIDEO){var m;(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0}});const n=ka(e).call(e,(a,l)=>{let{user:u,mediaType:h}=l;const m=this.filterTobeUnSubscribedTracks(u,h);return a.concat(m)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(a=>{let[,{id:l}]=a;return l}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(a=>{let[l,{kind:u}]=a;var h,m;if(u===Ve.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===Ve.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0;else if(u===Ve.AUDIO){var g;this.unbindRemoteTrackEvents(l._audioTrack),(g=l._audioTrack)===null||g===void 0||g._destroy(),l._audioTrack=void 0}}),i}isPreSubScribe(e){return!this.connection||this.state!==nn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void w.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Ve.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||w.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(ve.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(ve.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ur){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[a]=i;return a!==ve.LocalAudioTrack}).filter(i=>{let[a]=i;return!(e&&a===ve.LocalVideoLowTrack)}).map(i=>{let[,{track:a}]=i;return a}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ve.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,a){if(e){const u=this.localTrackMap.get(ve.LocalAudioTrack),h=i?this.localTrackMap.get(ve.LocalVideoLowTrack):this.localTrackMap.get(ve.LocalVideoTrack);Be.publish(this.store.sessionId,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(sn.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var l;n||(n=[]);const u=n.find(m=>m instanceof gr),h=i?(l=this.localTrackMap.get(ve.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(m=>m instanceof _n);Be.publish(this.store.sessionId,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(sn.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,n,i){const a=i===Ve.VIDEO?n._videoSSRC:n._audioSSRC;a&&Be.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Ve.VIDEO,audio:i===Ve.AUDIO,peerid:n.uid,subscribeRequestid:a,p2pid:this.store.p2pId,eventElapse:Ls.measureFromSubscribeStart(this.store.clientId,a),preSsrc:this.isPreSubScribe(a)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new is("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=B_(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ve.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ur){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=nn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof _n||t&&t.track instanceof gr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Hs(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ve.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ju(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(w.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=nn.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=B_(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ve.LocalVideoTrack:Ee(t=i._hints).call(t,sn.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ve.LocalAudioTrack:i instanceof Ur?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ve.LocalVideoLowTrack:}}),this.emit(Xe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hs(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Xe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hs(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(t,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),w.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:a}=n;if((e instanceof Fd?e.uid:e)===i.uid&&a===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:a}=n;if((e instanceof Fd?e.uid:e)===i.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return vi(function*(){if(!t.connection||t.state!==nn.Connected)return;const n=yield Rt(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Rt(t.connection.restartICE(e));const l=yield Rt(i.next());if(l.done)return;const u=l.value,h=yield u;switch(wI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case as.UDP_TCP_RELAY:t._pcStatsUploadType=Bl.UDP_TCP_RESTART;break;case as.TCP_RELAY:t._pcStatsUploadType=Bl.TCP_RESTART;break;case as.RELAY:t._pcStatsUploadType=Bl.RELAY_RESTART;break;default:t._pcStatsUploadType=Bl.OLD_RESTART}t._isTryConnecting=!0,i.next(h)}catch(l){var a;(a=i)===null||a===void 0||a.throw(l)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ve.LocalVideoTrack),n=this.localTrackMap.get(ve.LocalAudioTrack),i=e.videoSend.find(T=>T.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),a=e.audioSend.find(T=>T.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!a)return 1;const l=Ji(this,Xe.NeedSignalRTT),u=i?i.rttMs:void 0,h=a?a.rttMs:void 0,m=u&&h?(u+h)/2:u||h,g=(m&&l?(m+l)/2:m||l)||0,_=100*e.sendPacketLossRate*.7/50+.3*g/1500,v=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(sn.SCREEN_TRACK)===-1){const T=S._encoderConfig.bitrateMax,P=e.bitrate.actualEncoded;if(T&&P){const x=(1e3*T-P)/(1e3*T);return i3[x<.15?0:x<.3?1:x<.45?2:x<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const a=i._audioSSRC,l=i._videoSSRC,u=e.audioRecv.find(P=>P.ssrc===a),h=e.videoRecv.find(P=>P.ssrc===l);if(!u&&!h)return void(t+=1);const m=Ji(this,Xe.NeedSignalRTT),g=e.rtt,_=(g&&m?(g+m)/2:g||m)||0,v=u?u.jitterMs:void 0,S=e.recvPacketLossRate;let T=.7*S*100/50+.3*_/1500;v&&(T=.6*S*100/50+.2*_/1500+.2*v/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ne((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(w.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==nn.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return e===u});if(!i)return;const a=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:a}]),this.bindLocalTrackEvents([{track:t,type:a}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const l=i[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(a,l)}if(a===ve.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding){const l=this.localTrackMap.get(ve.LocalVideoLowTrack);if(l){const u=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new Ne((h,m)=>{this.handleReplaceTrack(l.track,h,m,!0)})}}}filterTobePublishedTracks(e,t,n){const i=[],a=this.getAllTracks();e=Sm(e=e.filter(m=>a.indexOf(m)===-1));let l,u=!1;const h=this.localTrackMap.get(ve.LocalAudioTrack);for(const m of e){if(m instanceof _n&&(this.localTrackMap.has(ve.LocalVideoTrack)||u?new ae(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:m,type:ve.LocalVideoTrack}),u=!0),t)){const g=this.getLowVideoTrack(m,n);i.push({track:g,type:ve.LocalVideoLowTrack})}if(m instanceof gr)if(h){const g=h.track;if(g instanceof Ur)TI([m]),g.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const _=bI([g,m]);w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(g,_)}}else l instanceof Ur?(TI([m]),l.addAudioTrack(m)):l||!m._useAudioElement&&jt().webAudioMediaStreamDest&&!m._bypassWebAudio?l=bI(l?[m,l]:[m]):l=m}return l&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),i.push({track:l,type:ve.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Sm(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof gr){const a=this.localTrackMap.get(ve.LocalAudioTrack);if(!a)continue;a.track instanceof Ur?(a.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),a.track.trackList.length===0&&(t.push([ve.LocalAudioTrack,a]),a.track.close())):t.push([ve.LocalAudioTrack,a])}if(i instanceof _n){const a=this.localTrackMap.get(ve.LocalVideoTrack);if(!a)continue;t.push([ve.LocalVideoTrack,a]);const l=this.localTrackMap.get(ve.LocalVideoLowTrack);l&&t.push([ve.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=Sm(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Sm(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ve.LocalVideoTrack:n.addListener(Ge.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ge.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ur?e.trackList.forEach(n=>{n.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ve.LocalVideoTrack:n.off(Ge.GET_STATS,this.handleGetLocalVideoStats),n.off(Ge.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ur?e.trackList.forEach(t=>{t.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ge.GET_STATS,this.handleGetLocalAudioStats),t.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ge.GET_STATS,this.handleGetLocalAudioStats),e.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof km&&t.addListener(Ge.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Lm&&t.addListener(Ge.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Ve.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Ve.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var a;let l,u,{track:h,type:m}=n;switch(m){case ve.LocalAudioTrack:l=ln.Audio,u={dtx:h instanceof I_&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ve.LocalVideoTrack:l=Ee(a=h._hints).call(a,sn.SCREEN_TRACK)?ln.Screen:ln.High,u=Zc(Zc({},y3(h)),{},{codec:this.store.codec,svc_mode:D_()});break;case ve.LocalVideoLowTrack:l=ln.Low,u=Zc(Zc({},y3(h)),{},{codec:this.store.codec,svc_mode:D_()})}return{stream_type:l,attributes:u,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ve.LocalVideoTrack:i=Ee(n=l._hints).call(n,sn.SCREEN_TRACK)?ln.Screen:ln.High;break;case ve.LocalAudioTrack:i=ln.Audio;break;case ve.LocalVideoLowTrack:i=ln.Low}return{stream_type:i,ssrcs:u,mid:h}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:a,type:l}=n;this.localTrackMap.set(l,{track:a,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Xe.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ta&&!An()&&j("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},j("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ta&&g5(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Bl.DISCONNECTED_OR_FAILED,Ji(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(a=>a.getTrackId()),i=this.pendingLocalDataChannels.map(a=>"dc_".concat(a.id));Be.reportApiInvoke(this.store.sessionId,{name:Vn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:gn.TRACER}).onSuccess(),this.republish()}if(j("NEW_ICE_RESTART")&&e instanceof Ta&&!An()&&!this._forceTurn&&!this.store.useDcSignal){if(Ee(m3).call(m3,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=a=>{wI(e)&&(w.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(a)),Ji(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Xe.RequestRestartICE,a))},i=()=>{wI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),w.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Xe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{_5(e,n,i)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&j("ICE_RESTART")&&Ji(this,Xe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Xe.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Xe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Xe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:gn.TRACER}).onSuccess(),this.emit(Xe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var a;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(a=i.audioTrack)===null||a===void 0||a.emit(Ua.FIRST_FRAME_DECODED),Be.firstRemoteFrame(this.store.sessionId,Mr.FIRST_AUDIO_DECODE,Fn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);i&&Be.firstRemoteFrame(this.store.sessionId,Mr.FIRST_AUDIO_RECEIVED,Fn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{var a;const l=Array.from(Hs(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===t);l&&this.store.firstVideoFrameDecoded(l.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoRender=t=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i),this.emit(Xe.FirstVideoPreRender,i.uid,t))},e.onFirstVideoReceived=t=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),Be.firstRemoteFrame(this.store.sessionId,Mr.FIRST_VIDEO_RECEIVED,Fn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);i&&this.emit(Xe.FirstVideoBufferReady,i.uid,t)},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",a=n.candidateType==="relay";n.candidateType!=="unknown"&&i===a||this.emit(Xe.ConnectionTypeChange,i),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ud(n))," -> ").concat(JSON.stringify(Ud(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ud(n))," -> ").concat(JSON.stringify(Ud(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Zc(Zc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){w.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===nn.Connected?(w.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=B_(this.store),this.emit(Xe.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof Ta&&function(t){Xm.delete(t.id),g5(t)}(e),e.close(),this.emit(Xe.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ve.LocalAudioTrack);if(e instanceof gr&&(n==null?void 0:n.track)instanceof Ur)return n.track.isActive||t.push([ve.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(i&&(t.push(i),i[0]===ve.LocalVideoTrack)){const a=this.localTrackMap.get(ve.LocalVideoLowTrack);a&&t.push([ve.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ve.LocalAudioTrack);if(e instanceof gr&&(n==null?void 0:n.track)instanceof Ur)return n.track.isActive&&t.push([ve.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(i)if(i[0]===ve.LocalVideoTrack){t.push(i);const a=this.localTrackMap.get(ve.LocalVideoLowTrack);a&&t.push([ve.LocalVideoLowTrack,a])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ve.LocalAudioTrack:i=ln.Audio;break;case ve.LocalVideoTrack:i=Ee(n=l._hints).call(n,sn.SCREEN_TRACK)?ln.Screen:ln.High;break;case ve.LocalVideoLowTrack:i=ln.Low}return{stream_type:i,ssrcs:u,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ve.LocalAudioTrack:i=ln.Audio;break;case ve.LocalVideoTrack:i=Ee(n=l._hints).call(n,sn.SCREEN_TRACK)?ln.Screen:ln.High;break;case ve.LocalVideoLowTrack:i=ln.Low}return{stream_type:i,ssrcs:u,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const a=i.get(t);if(!a)return n;n.push([e,{kind:t,id:a}])}else Array.from(i.entries()).forEach(a=>{let[l,u]=a;n.push([e,{kind:l,id:u}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var a;(a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:a,id:l}]=n;switch(a){case Ve.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Ve.VIDEO,ssrcId:i._videoSSRC}));case Ve.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Ve.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:a}]=n;if(t.has(i)){let l=t.get(i);a===Ve.VIDEO?l|=Xr.Video:l|=Xr.Audio,t.set(i,l)}else a===Ve.VIDEO?t.set(i,Xr.Video):t.set(i,Xr.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,a]=n;return{stream_id:i.uid,stream_type:a}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const a=this.remoteUserMap.get(n);a&&(a.delete(i),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ve.LocalVideoTrack),n=this.localTrackMap.get(ve.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ne((i,a)=>{this.handleUpdateVideoEncoder(t.track,i,a,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ne((i,a)=>{this.handleUpdateVideoEncoder(n.track,i,a,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof Ta&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ta)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof Ta&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,n){return e.map((i,a)=>{var l;let{stream_type:u}=i;const h=(l=t.find(m=>{let{stream_type:g}=m;return u===g}))===null||l===void 0?void 0:l.attributes;if(h&&j("DISABLE_SCREEN_SHARE_REMB")){const m=n[a]._hints;(Ee(m).call(m,sn.SCREEN_TRACK)||Ee(m).call(m,sn.SCREEN_LOW_TRACK))&&(h.remb=!1,w.debug("disable remb for screen share, hints:",m))}return h})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof gr){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(l=>{let[,{id:u}]=l;return u})));const a=this.createUnmuteMessage(i);return void await Sn(this,Xe.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Xe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Xe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await qr(AS(this.dtlsFailedCount,Cr)),this.emit(Xe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Pr(this,Xe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Xe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ve.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof _n)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof _n).length>1)throw new ae(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof gr).length>1&&(e.some(t=>t instanceof gr&&t._bypassWebAudio)||!jt().webAudioMediaStreamDest))throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof _n&&this.pendingLocalTracks.some(n=>n instanceof _n))throw new ae(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof gr&&this.pendingLocalTracks.some(n=>n instanceof gr)&&(!jt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof gr&&n._bypassWebAudio)))throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding,a=Zc(Zc({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=i?e._mediaStreamTrack.clone():RI(e,a);const u=on(8,"track-low-"),h=new _n(l,Zc(Zc({},i&&{scaleResolutionDownBy:nI(a,e)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,u);return h.on(_h.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Nm.LOW_STREAM)}),h._hints.push(sn.LOW_STREAM),Ee(n=e._hints).call(n,sn.SCREEN_TRACK)&&h._hints.push(sn.SCREEN_LOW_TRACK),e.on("sei-to-send",m=>{h.emit("sei-to-send",m)}),e.addListener(Ge.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ta){var a,l,u,h;const m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:g,dtlsTransportState:_,peerConnectionState:v}=this.connection,{local:S,remote:T}=await this.connection.getSelectedCandidatePair();Be.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:g,dtlsstate:_,connectionstate:v,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(a=S==null?void 0:S.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(l=S.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(u=T.protocol)!==null&&u!==void 0?u:"",selectedRemoteCandidateType:(h=T.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(T.address,":").concat(T.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(_=>_.userId===e.uid);if(!n)return;const{isInternalUpload:i,isExternalUpload:a}=n;if(i&&a)return;const{subscribeEnd:l,firstPreRender:u,peerPublishDuration:h,peerPubStatusMs:m}=n;let{firstRender:g=0}=n;if(l&&(g||u)&&h&&m){n.isInternalUpload=!0;const{playEnd:_}=n;_&&(n.isExternalUpload=!0);const{firstPreRender:v=0}=n;g=v||g;const S=e.videoTrack,T={peer:e._uintid,width:(S==null?void 0:S._videoWidth)||0,height:(S==null?void 0:S._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:h,peerPubStatusMs:m,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:v||0,firstRender:_?Math.max(g,_):Math.max(g,l),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:FF(this.store),firstReceivedEncodedFrame:n.firstReceivedEncodedFrame||0,frameType:n.frameType||"",rtpTimestamp:n.rtpTimestamp||0,framePayloadType:n.framePayloadType||0,frameDataLength:n.frameDataLength||0,mimeType:n.mimeType||""};Be.firstXLAPeerFirstVideoFrame(this.store.sessionId,T)}}reportVideoFirstFrameDecoded(e,t,n,i){var a;const l=Array.from(Hs(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===e);if(l){i||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,h=u.subscribe.find(m=>m.userId===l.uid&&m.type==="video");Be.firstRemoteVideoDecode(this.store.sessionId,Mr.FIRST_VIDEO_DECODE,Fn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:i?1:0,firstFrame:(h==null?void 0:h.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const a=i.get(t);if(!a)return!1;const l=await this.connection.getRemoteSSRC(a);return l!==void 0&&l!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ve.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Nm.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ae(Ut.prototype,"startP2PConnection",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"startP2PConnection"),Ut.prototype),Ae(Ut.prototype,"connect",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"connect"),Ut.prototype),Ae(Ut.prototype,"updateRemoteRTPCapabilities",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"updateRemoteRTPCapabilities"),Ut.prototype),Ae(Ut.prototype,"publishDataChannel",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"publishDataChannel"),Ut.prototype),Ae(Ut.prototype,"unpublish",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"unpublish"),Ut.prototype),Ae(Ut.prototype,"unpublishDataChannel",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"unpublishDataChannel"),Ut.prototype),Ae(Ut.prototype,"unpublishLowStream",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"unpublishLowStream"),Ut.prototype),Ae(Ut.prototype,"subscribeDataChannel",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"subscribeDataChannel"),Ut.prototype),Ae(Ut.prototype,"subscribe",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"subscribe"),Ut.prototype),Ae(Ut.prototype,"massSubscribe",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"massSubscribe"),Ut.prototype),Ae(Ut.prototype,"unsubscribe",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"unsubscribe"),Ut.prototype),Ae(Ut.prototype,"unsubscribeDataChannel",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"unsubscribeDataChannel"),Ut.prototype),Ae(Ut.prototype,"massUnsubscribe",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"massUnsubscribe"),Ut.prototype),Ae(Ut.prototype,"muteRemote",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"muteRemote"),Ut.prototype),Ae(Ut.prototype,"unmuteRemote",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"unmuteRemote"),Ut.prototype),Ae(Ut.prototype,"hasRemoteMediaWithLock",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"hasRemoteMediaWithLock"),Ut.prototype),Ae(Ut.prototype,"disconnectForReconnect",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"disconnectForReconnect"),Ut.prototype),Ae(Ut.prototype,"updateBitrateLimit",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"updateBitrateLimit"),Ut.prototype),Ae(Ut.prototype,"remoteMediaSsrcChanged",[Js],Object.getOwnPropertyDescriptor(Ut.prototype,"remoteMediaSsrcChanged"),Ut.prototype),Ut);function Js(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("From P2PChannel.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{l()}},n}function y5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function S5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y5(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Q_e=Date.now(),J_e=20,II=new Map,R0=new Map;async function T5(e){const t=II.get(e),n=Array.isArray(t)&&t[t.length-1],i=R0.get(e);if(!n)return void(i.isSyncing=!1);const a={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const l=n.sendTs-i.firstSendTs,u=l-(Date.now()-i.firstRecvTs);u>0&&(i.firstRecvTs=Date.now()-l);let h=n.mediaDelay+u;h<=0?(t.pop(),b5(n.context,a),h=0):h=Math.min(h,J_e),setTimeout(()=>t.length&&T5(e),h)}function b5(e,t){e.safeEmit(At.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function $_e(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return b5(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),a=II.get(i)||[],l=a.findIndex(g=>e.sendTs>=g.sendTs),u=S5(S5({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});l===-1?a.push(u):a.splice(l,0,u),II.set(i,a);let h=!1;var m;R0.has(i)?h=!((m=R0.get(i))===null||m===void 0||!m.isSyncing):R0.set(i,{isSyncing:h,firstRecvTs:0,firstSendTs:0}),h||T5(i)}const Z_e=qt().name;function w5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function C5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?w5(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w5(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Qm="websdk_ng_cache_parameter",eEe=j("MAX_PRELOAD_ASYNC_LENGTH"),tEe=1e4,Ah=new Map,Oh=[];let AI=null,OI=0,PI=0;const x0=new Map,R5=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),nEe=function(e,t){const n=[];let i=0;const a=async()=>{const l=n.shift();l&&await l(),n.length>0&&i<t?a():i--};return async function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return new Ne(async(m,g)=>{n.push(async()=>{try{const _=await e(...u);m(_)}catch(_){g(_)}}),i<t&&(i++,a())})}}(kI,eEe),DI=yi.CancelToken.source();class rEe{constructor(){O(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;const t=this._audioContext.sampleRate,n=10*t,i=this._audioContext.createBuffer(2,n,t),a=this._audioContext.createBufferSource();a.buffer=i;const l=this._audioContext.createMediaStreamDestination();return a.connect(l),a.start(),l.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function kI(e,t,n,i,a,l,u){try{if(!j("ENABLE_PRELOAD"))return;if(!jt().supportWebCrypto)return void Pd(()=>{w.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ae(U.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Es(n,"token",1,2047),Es(e,"appid",1,2047),n0(t),i&&r0(i);const h=ph();w.debug("preload channel ".concat(t,", uid is ").concat(i));const m={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:h,proxyServer:a,role:u};let g,_;typeof i=="string"?(m.stringUid=i,[_,g]=await Ne.all([U_e(i,{sid:h,appId:e},DI.token),Q3(C5(C5({},m),{},{token:n||e,uid:0}),DI.token)]),m.uid=_.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(l&&(m.stringUid=l),g=await Q3(m,DI.token));const v={sid:h,appId:e,cname:t,token:n||e,uid:m.stringUid||i,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:_,ap:g};await jI(v),OI++}catch(h){throw PI++,function(m){AI||(AI=window.setTimeout(()=>{let _="";x0.forEach((v,S)=>{_+="".concat(S,": ").concat(v," ;")}),Be.reportApiInvoke(null,{name:Vn.PRELOAD,options:{success:OI,failed:PI,err:_}}).onError(m),OI=0,PI=0,x0.clear(),AI=null},tEe));const g=x0.get(m.code)||0;x0.set(m.code,g+1)}(h),h}}async function LI(e){try{if(j("AP_REQUEST_DETAIL")||j("ENABLE_ROLE_SELECT_EDGE"))return;const t=x5(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(i,a){try{const l=await window.crypto.subtle.importKey("raw",mF(a),"AES-GCM",!1,["decrypt"]),u=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:R5},l,hh(i));return JSON.parse(window.atob(Dd(new Uint8Array(u))))}catch{return}}(t,e.token||e.appId);if(!n||!function(i,a){return i.cname===a.cname&&i.appId===a.appId&&i.token===a.token?a.stringUid?i.stringUid===a.stringUid:typeof a.uid=="number"?i.uid===a.uid:i.uid==a.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<j("AP_CACHE_LIFETIME"))return n}catch(t){w.warn("Error get preloadInfo",t.message)}}function x5(e){let t;try{if(t=A5(Qm),!t)return;const n=JSON.parse(t),i=O5(e),a=function(u,h){for(let m=u.length-1;m>=0;m--)if(h(u[m]))return m;return-1}(n,u=>i in u);if(a===-1)return;const l=n.splice(a,1)[0];return N0(Qm,JSON.stringify(n)),l[i]}catch(n){w.warn("Error delete preload info: ".concat(t),n.message),N0(Qm,"")}}async function jI(e){let t;try{e.uid&&x5({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=O5(e),i=await async function(l,u){try{const h=await window.crypto.subtle.importKey("raw",mF(u),"AES-GCM",!1,["encrypt"]),m=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:R5},h,hh(window.btoa(JSON.stringify(l))));return Dd(new Uint8Array(m))}catch{return}}(e,e.token||e.appId);if(!i)return;t=A5(Qm);const a=t?JSON.parse(t):[];a.push({[n]:i}),a.length>j("AP_CACHE_NUM")&&a.shift(),N0(Qm,JSON.stringify(a))}catch(n){w.warn("Error caching server parameters:",n.message),N0(Qm,"")}}function MI(e){if(e){let t=Ah.get(e);t&&(window.clearTimeout(t),t=null,Ah.delete(e)),Ee(Oh).call(Oh,e)||e.cloudProxyServer!=="disabled"||Oh.push(e)}if(Ah.size<j("AP_CACHE_NUM")&&Oh.length>0){const t=Oh.shift();Ah.set(t,window.setTimeout(async()=>{const{appId:n,cname:i,token:a,stringUid:l,uid:u,proxyServer:h,role:m}=t;try{await nEe(n,i,a,u,h,l,m),Ah.has(t)&&MI(t)}catch(g){w.warn("update preload failed",g.message),N5(t)}},j("AP_UPDATE_INTERVAL")))}}function N5(e){const t=Oh.indexOf(e);t!==-1&&Oh.splice(t,1);let n=Ah.get(e);n&&(window.clearTimeout(n),n=null,Ah.delete(e),MI())}function I5(e,t){const n=e.sua,i=e.ap;t&&n&&Be.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),Be.reportResourceTiming(e.ap.url,e.sid),Be.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(a=>a.ip).join(","),eventType:"disabled",unilbsServerIds:[Rr.CHOOSE_SERVER,Rr.CLOUD_PROXY_FALLBACK].toString()}),Be.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(a=>a.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Rr.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function A5(e){return window.atob(window.localStorage.getItem(e)||"")}function N0(e,t){window.localStorage.setItem(e,window.btoa(t))}function O5(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),SF(t)}function sEe(e){let t=function(){const n=oEe.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let a=n.appId;a!==void 0&&(xr(i,10),Gd(i,a));let l=n.cid;l!==void 0&&(xr(i,16),xr(i,l));let u=n.cname;u!==void 0&&(xr(i,26),Gd(i,u));let h=n.deviceId;h!==void 0&&(xr(i,34),Gd(i,h));let m=n.elapse;m!==void 0&&(xr(i,40),Wd(i,m));let g=n.fileSize;g!==void 0&&(xr(i,48),Wd(i,Jm(g)));let _=n.height;_!==void 0&&(xr(i,56),Wd(i,Jm(_)));let v=n.jpg;v!==void 0&&(xr(i,66),xr(i,v.length),D5(i,v));let S=n.networkType;S!==void 0&&(xr(i,72),Wd(i,Jm(S)));let T=n.osType;T!==void 0&&(xr(i,80),Wd(i,Jm(T)));let P=n.requestId;P!==void 0&&(xr(i,90),Gd(i,P));let x=n.sdkVersion;x!==void 0&&(xr(i,98),Gd(i,x));let N=n.sequence;N!==void 0&&(xr(i,104),Wd(i,Jm(N)));let M=n.sid;M!==void 0&&(xr(i,114),Gd(i,M));let F=n.timestamp;F!==void 0&&(xr(i,120),Wd(i,F));let q=n.uid;q!==void 0&&(xr(i,128),xr(i,q));let J=n.vid;J!==void 0&&(xr(i,136),xr(i,J));let te=n.width;te!==void 0&&(xr(i,144),Wd(i,Jm(te)));let Y=n.service;Y!==void 0&&(xr(i,152),xr(i,Y));let ne=n.callbackData;ne!==void 0&&(xr(i,162),xr(i,ne.length),D5(i,ne));let ue=n.ticket;ue!==void 0&&(xr(i,170),Gd(i,ue));let fe=n.vendorConfigs;fe!==void 0&&(xr(i,178),Gd(i,fe))}(e,t),function(n){let i=n.bytes,a=n.limit;return i.length===a?i:i.subarray(0,a)}(t)}function iEe(e){return function(n){let i={};e:for(;!cEe(n);){let a=W_(n);switch(a>>>3){case 0:break e;case 1:i.code=W_(n);break;case 2:i.msg=k5(n,W_(n));break;case 3:i.requestId=k5(n,W_(n));break;case 4:i.timestamp=lEe(n,!1);break;default:aEe(n,7&a)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function aEe(e,t){switch(t){case 0:for(;128&wo(e););break;case 2:UI(e,W_(e));break;case 5:UI(e,4);break;case 1:UI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Jm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let oEe=[];function UI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function cEe(e){return e.offset>=e.limit}function I0(e,t){let n=e.bytes,i=e.offset,a=e.limit,l=i+t;if(l>n.length){let u=new Uint8Array(2*l);u.set(n),e.bytes=u}return e.offset=l,l>a&&(e.limit=l),i}function P5(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function D5(e,t){let n=I0(e,t.length);e.bytes.set(t,n)}function k5(e,t){let n=P5(e,t),i=String.fromCharCode,a=e.bytes,l="",u="";for(let h=0;h<t;h++){let m,g,_,v,S=a[h+n];128&S?(224&S)==192?h+1>=t?u+=l:(m=a[h+n+1],(192&m)!=128?u+=l:(v=(31&S)<<6|63&m,v<128?u+=l:(u+=i(v),h++))):(240&S)==224?h+2>=t?u+=l:(m=a[h+n+1],g=a[h+n+2],(49344&(m|g<<8))!=32896?u+=l:(v=(15&S)<<12|(63&m)<<6|63&g,v<2048||v>=55296&&v<=57343?u+=l:(u+=i(v),h+=2))):(248&S)==240?h+3>=t?u+=l:(m=a[h+n+1],g=a[h+n+2],_=a[h+n+3],(12632256&(m|g<<8|_<<16))!=8421504?u+=l:(v=(7&S)<<18|(63&m)<<12|(63&g)<<6|63&_,v<65536||v>1114111?u+=l:(v-=65536,u+=i(55296+(v>>10),56320+(1023&v)),h+=3))):u+=l:u+=i(S)}return u}function Gd(e,t){let n=t.length,i=0;for(let u=0;u<n;u++){let h=t.charCodeAt(u);h>=55296&&h<=56319&&u+1<n&&(h=(h<<10)+t.charCodeAt(++u)-56613888),i+=h<128?1:h<2048?2:h<65536?3:4}xr(e,i);let a=I0(e,i),l=e.bytes;for(let u=0;u<n;u++){let h=t.charCodeAt(u);h>=55296&&h<=56319&&u+1<n&&(h=(h<<10)+t.charCodeAt(++u)-56613888),h<128?l[a++]=h:(h<2048?l[a++]=h>>6&31|192:(h<65536?l[a++]=h>>12&15|224:(l[a++]=h>>18&7|240,l[a++]=h>>12&63|128),l[a++]=h>>6&63|128),l[a++]=63&h|128)}}function wo(e){return e.bytes[P5(e,1)]}function L5(e,t){let n=I0(e,1);e.bytes[n]=t}function W_(e){let t,n=0,i=0;do t=wo(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function xr(e,t){for(t>>>=0;t>=128;)L5(e,127&t|128),t>>>=7;L5(e,t)}function lEe(e,t){let n,i=0,a=0,l=0;return n=wo(e),i=127&n,128&n&&(n=wo(e),i|=(127&n)<<7,128&n&&(n=wo(e),i|=(127&n)<<14,128&n&&(n=wo(e),i|=(127&n)<<21,128&n&&(n=wo(e),a=127&n,128&n&&(n=wo(e),a|=(127&n)<<7,128&n&&(n=wo(e),a|=(127&n)<<14,128&n&&(n=wo(e),a|=(127&n)<<21,128&n&&(n=wo(e),l=127&n,128&n&&(n=wo(e),l|=(127&n)<<7))))))))),{low:i|a<<28,high:a>>>4|l<<24,unsigned:t}}function Wd(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,l=a===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:a<128?9:10,u=I0(e,l),h=e.bytes;switch(l){case 10:h[u+9]=a>>>7&1;case 9:h[u+8]=l!==9?128|a:127&a;case 8:h[u+7]=l!==8?i>>>21|128:i>>>21&127;case 7:h[u+6]=l!==7?i>>>14|128:i>>>14&127;case 6:h[u+5]=l!==6?i>>>7|128:i>>>7&127;case 5:h[u+4]=l!==5?128|i:127&i;case 4:h[u+3]=l!==4?n>>>21|128:n>>>21&127;case 3:h[u+2]=l!==3?n>>>14|128:n>>>14&127;case 2:h[u+1]=l!==2?n>>>7|128:n>>>7&127;case 1:h[u]=l!==1?128|n:127&n}}const j5={},M5={},A0=4294967296,dEe=A0*A0,U5=dEe/2;F5(0,!0);const V5=F5(0),uEe=H_(0,-2147483648,!1),hEe=H_(-1,2147483647,!1);function F5(e,t){let n,i,a;return t?(a=0<=(e>>>=0)&&e<256)&&(i=M5[e],i)?i:(n=H_(e,0,!0),a&&(M5[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(i=j5[e],i)?i:(n=H_(e,e<0?-1:0,!1),a&&(j5[e]=n),n)}function H_(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function B5(e,t){if(isNaN(e))return V5;{if(e<=-U5)return uEe;if(e+1>=U5)return hEe}return e<0?V5:H_(e%A0|0,e/A0|0,t)}function G5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}class VI extends Yn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(ec.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),O(this,"name","AgoraRTCImageModeration"),O(this,"_connectionState",Ba.CONNECTING),O(this,"_sequence",0),O(this,"_moderationStartTime",void 0),O(this,"_workerConnection",void 0),O(this,"_workerMessageLengthLimit",void 0),O(this,"_qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",yi.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"_moderationInterval",void 0),O(this,"_moderationTimer",null),O(this,"_moderationMode",1),O(this,"_quality",1),O(this,"_qualityTimer",null),O(this,"_ticket",void 0),O(this,"_moderationIntervalMinimum",void 0),O(this,"_uploadFailedNum",0),O(this,"_uploadNum",0),O(this,"_uploadTimer",null),O(this,"_extraInfo",void 0),O(this,"_vendor",""),O(this,"_encoder",new TextEncoder),O(this,"_moderationId",void 0),O(this,"inspectImage",()=>{if(this.connectionState!==Ba.CONNECTED)throw new re(U.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ba.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=on(5,"image-moderation-"),this._workerMessageLengthLimit=j("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=j("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=j("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new O_("worker-"+this._moderationId,Cr),this.on(ec.STATE_CHANGE,(i,a)=>{w.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Vm[i]," ").concat(a||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(ec.STATE_CHANGE,Vm.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Ne((a,l)=>{this.on(ec.CONNECTION_STATE_CHANGE,(u,h)=>{u===Ba.CONNECTED&&a()}),this.requestAP(t,i,n).then(u=>{this.connectWorker(u)}).catch(u=>{l(u)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),w.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Ba.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const a=j("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),l=await function(m,g,_,v){let{appId:S,areaCode:T,cname:P,sid:x,token:N,uid:M}=g;Hm++;const F="moderation_plugin",q={service_name:F,json_body:JSON.stringify({appId:S,areaCode:T,cname:P,command:"allocateEdge",requestId:Hm,seq:Hm,sid:x,appToken:N,ts:Date.now(),uid:M+""})};let J,te,Y=m[0];return Qo(async()=>{J=Date.now();const ne=await nc(Y,{data:q,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(te=Date.now()-J,ne.code!==0){const ot=new re(U.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ne.code,{retry:!0,responseTime:te});throw w.error(ot.toString()),ot}const ue=JSON.parse(ne.json_body);if(ue.code!==200){const ot=new re(U.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ue.code,", reason: ").concat(ue.reason),{code:ue.code,responseTime:te});throw w.error(ot.toString()),ot}if(!ue.servers||!Array.isArray(ue.servers)||ue.servers.length===0){const ot=new re(U.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ue.code,responseTime:te});throw w.error(ot.toString()),ot}if(!ue.servers.some(ot=>!!ot.wss)){const ot=new re(U.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ue.code,responseTime:te});throw w.error(ot.toString()),ot}const fe=j("IMAGE_MODERATION_WORKER_WSS");if(fe)return{addressList:[fe],workerToken:ue.workerToken,vid:ue.vid,responseTime:te};const Me=j("IMAGE_MODERATION_WORKER_HOST");return{addressList:ue.servers.map(ot=>{let{address:Ct,wss:vt}=ot;if(Ct&&vt)return"wss://".concat(Ct.replace(/\./g,"-"),".").concat(Me,":").concat(vt,"/moderation")}).filter(ot=>!!ot),workerToken:ue.workerToken,vid:ue.vid,ticket:ue.appTicket,responseTime:te}},(ne,ue)=>(Be.apworkerEvent(x,{success:!0,sc:200,serviceName:F,responseDetail:JSON.stringify(ne.addressList),firstSuccess:ue===0,responseTime:te,serverIp:m[ue%m.length]}),!1),(ne,ue)=>(Be.apworkerEvent(x,{success:!1,sc:ne.data&&ne.data.code||200,serviceName:F,responseTime:te,serverIp:m[ue%m.length]}),!!(ne.code!==U.OPERATION_ABORTED&&ne.code!==U.UNEXPECTED_RESPONSE||ne.data&&ne.data.retry)&&(Y=m[(ue+1)%m.length],!0)),v)}(a,t,n,i);this.emit(ec.STATE_CHANGE,Vm.AP_CONNECTED);const{addressList:u,ticket:h}=l;return this._ticket=h,u}async connectWorker(t){this.emit(ec.STATE_CHANGE,Vm.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(yt.CONNECTED,async()=>{this.emit(ec.STATE_CHANGE,Vm.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ba.CONNECTED}),this._workerConnection.on(yt.CLOSED,()=>{this.connectionState=Ba.CLOSED}),this._workerConnection.on(yt.FAILED,()=>{this.connectionState=Ba.CLOSED}),this._workerConnection.on(yt.RECONNECTING,()=>{this.connectionState=this.connectionState===Ba.CONNECTED?Ba.RECONNECTING:Ba.CONNECTING}),this._workerConnection.on(yt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=iEe(new Uint8Array(t.data));j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,w.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Be.reportApiInvoke(this._connectInfo.sid||null,{name:Vn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:gn.TRACER}).onError(new re(U.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},j("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else w.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(yt.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(yt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Ji(this,ec.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:a,cid:l,vid:u,sid:h,uid:m}=n;const g=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),v=await h4(_,i,a),S=this._sequence+"-"+l+"-"+m+"-"+g+"-"+on(12,""),T={appId:i,cid:l,cname:a,deviceId:"",elapse:VI.intToLong(Number(g-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:v,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.1",sequence:this._sequence,sid:h,timestamp:B5(g),uid:m,vid:u,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;const P=sEe(T);if(P.byteLength<this._workerMessageLengthLimit){if(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const x=function(N){for(var M=1;M<arguments.length;M++){var F=arguments[M]!=null?arguments[M]:{};M%2?G5(Object(F),!0).forEach(function(q){O(N,q,F[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(F)):G5(Object(F)).forEach(function(q){Object.defineProperty(N,q,Object.getOwnPropertyDescriptor(F,q))})}return N}({},T);delete x.jpg,w.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(x))}return P}{const x=this.quality*this._qualityRatio;return this.quality=x,await this.generateRequestData(t,{appId:i,cname:a,cid:l,vid:u,sid:h,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=yi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ba.CLOSED,this.emit(ec.STATE_CHANGE,Vm.CLOSED)}}function W5(e){if(fn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new re(U.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new re(U.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const pEe={name:"ImageModeration",create:function(e){let{config:t}=e;return W5(t),new VI(t)}};var H5,K5,z5,q5,Y5,X5,Q5,J5,$5,Z5,e6,t6,n6,r6,s6,i6,a6,o6,c6,l6,d6,u6,h6,p6,m6,f6,g6,_6,E6,v6,y6,S6,T6,b6,w6,C6,R6,x6,N6,I6,A6,O6,Ue;function P6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Co(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?P6(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}is.setLogger(w);let mEe=(H5=st(),K5=st({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Om))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),z5=st({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Am.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),q5=st({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),Y5=st({argsMap:(e,t,n)=>[t,n]}),X5=st({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:a}=n;return[i==null?void 0:i.uid,a]})}),Q5=st({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),J5=st({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:a}=n;return{uid:i==null?void 0:i.uid,mediaType:a}})}),$5=st(),Z5=st(),e6=st(),t6=st(),n6=st(),r6=st(),s6=st(),i6=st(),a6=st(),o6=st(),c6=st(),l6=st(),d6=st(),u6=st(),h6=st(),p6=st(),m6=st({argsMap:(e,t)=>[t]}),f6=st(),g6=st(),_6=st(),E6=st(),v6=st(),y6=st(),S6=st(),T6=st(),b6=st({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),w6=st(),C6=st(),R6=st(),x6=st(),N6=st(),I6=st(),A6=st({reportResult:!0}),O6=st(),Ue=class extends Yn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),O(this,"store",void 0),O(this,"_uid",void 0),O(this,"_channelName",void 0),O(this,"_uintUid",void 0),O(this,"_users",[]),O(this,"_config",void 0),O(this,"_clientId",void 0),O(this,"_appId",void 0),O(this,"_sessionId",null),O(this,"_key",void 0),O(this,"_rtmConfig",{}),O(this,"_joinInfo",void 0),O(this,"_gateway",void 0),O(this,"_statsCollector",void 0),O(this,"_configDistribute",void 0),O(this,"_leaveMutex",void 0),O(this,"_publishMutex",void 0),O(this,"_renewTokenMutex",void 0),O(this,"_subscribeMutex",void 0),O(this,"_encryptionMode","none"),O(this,"_encryptionSecret",null),O(this,"_encryptionSalt",null),O(this,"_encryptDataStream",!1),O(this,"_encryptDataStreamKey",null),O(this,"_encryptDataStreamIv",null),O(this,"_proxyServer",void 0),O(this,"_turnServer",{servers:[],mode:"auto"}),O(this,"_cloudProxyServerMode","disabled"),O(this,"_isDualStreamEnabled",!1),O(this,"_defaultStreamFallbackType",void 0),O(this,"_lowStreamParameter",void 0),O(this,"_streamFallbackTypeCacheMap",new Map),O(this,"_remoteStreamTypeCacheMap",new Map),O(this,"_axiosCancelSource",yi.CancelToken.source()),O(this,"_audioVolumeIndicationInterval",void 0),O(this,"_networkQualityInterval",void 0),O(this,"_userOfflineTimeout",void 0),O(this,"_streamRemovedTimeout",void 0),O(this,"_rteDetailInterval",void 0),O(this,"_liveTranscodeStreamingClient",void 0),O(this,"_liveRawStreamingClient",void 0),O(this,"_channelMediaRelayClient",void 0),O(this,"_networkQualitySensitivity","normal"),O(this,"_p2pChannel",void 0),O(this,"_useLocalAccessPoint",!1),O(this,"_setLocalAPVersion",void 0),O(this,"_joinAndNotLeaveYet",!1),O(this,"_numberOfJoinCount",0),O(this,"_joinResponse",null),O(this,"_remoteDefaultVideoStreamType",void 0),O(this,"_inspect",void 0),O(this,"_moderation",void 0),O(this,"_license",void 0),O(this,"_pendingPublishedUsers",[]),O(this,"ntpAlignErrorCount",0),O(this,"remoteInboundOffset",0),O(this,"_peerConnectionState",void 0),O(this,"_pendingRtpCapabilityChange",void 0),O(this,"_fallbackServerInfo",void 0),O(this,"_dualStreamMode",void 0),O(this,"_handleLocalTrackEnable",(a,l,u)=>{this.publish(a,!1).then(l).catch(u)}),O(this,"_handleLocalTrackDisable",(a,l,u)=>{this.unpublish(a).then(l).catch(u)}),O(this,"_handleUserOnline",a=>{if(j("BLOCK_LOCAL_CLIENT")&&bh(a.uid,this.channelName))return void w.debug("[".concat(a.uid,"] will be ignored in local"));this.isStringUID&&typeof a.uid!="string"&&w.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(u=>u.uid===a.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(At.USER_JOINED,l));else{const u=new Fd(a.uid,a.uint_id||a.uid);this._users.push(u),w.debug("[".concat(this._clientId,"] user online"),a.uid),this.store.firstVideoFrameDecoded(u.uid,{userJoinNotify:Date.now()}),this.safeEmit(At.USER_JOINED,u)}}),O(this,"_handleUserOffline",a=>{if(j("BLOCK_LOCAL_CLIENT")&&bh(a.uid,this.channelName))return;const l=this._users.find(u=>u.uid===a.uid);l&&(this._handleRemoveStream(a),this._handleRemoveDataChannels(a),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:NS(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),w.debug("[".concat(this._clientId,"] user offline"),a.uid,"reason:",a.reason),this.safeEmit(At.USER_LEAVED,l,a.reason))}),O(this,"_handleAddAudioOrVideoStream",(a,l,u,h,m,g,_,v)=>{if(j("BLOCK_LOCAL_CLIENT")&&bh(l,this.channelName))return;const S=this._users.find(x=>x.uid===l);if(!S)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(a)),this.store.subscribe(S.uid,a,void 0,void 0,void 0,Date.now()),a==="video"&&this.store.firstVideoFrameDecoded(S.uid,{videoAddNotify:Date.now()});const T=a==="audio"?S.hasAudio:S.hasVideo;S._uintid||(S._uintid=g||l),a==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,a==="audio"?(S._audio_added_=!0,u!==void 0&&(S._audioSSRC=u),h!==void 0&&(S._cname=h),_&&(S._audioOrtc=_)):(S._video_added_=!0,u!==void 0&&(S._videoSSRC=u),h!==void 0&&(S._cname=h),v!==void 0&&(S._rtxSsrcId=v),_&&(S._videoOrtc=_)),(a==="audio"?S.hasAudio:S.hasVideo)&&!T&&(w.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(a)),this.safeEmit(At.USER_PUBLISHED,S,a)),a==="video"?Be.onGatewayStream(this._sessionId,Mr.ON_ADD_VIDEO_STREAM,Fn.ON_ADD_VIDEO_STREAM,{peer:g||l,ssrc:S._videoSSRC}):Be.onGatewayStream(this._sessionId,Mr.ON_ADD_AUDIO_STREAM,Fn.ON_ADD_AUDIO_STREAM,{peer:g||l,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,a,u).then(x=>{if(x&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ih))return this._p2pChannel.unsubscribe(S,a,!0).then(()=>this._subscribe(S,a,!0).catch(N=>{w.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,a)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,a,!0).catch(x=>{w.error("[".concat(this._clientId,"] resubscribe error"),x.toString())}));const P=this._getEncodingName(m);a==="video"&&(P==="unknown"?this.safeEmit(At.AV1_DECODABLE_RESULT,!1):ss()||Ws()||(P==null?void 0:P.toLocaleLowerCase())!==fh.av1||M_e().then(x=>{j("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(At.AV1_DECODABLE_RESULT,x),x||this._gateway.downgradeCodec(P)}))}),O(this,"_handleRemoveStream",a=>{if(j("BLOCK_LOCAL_CLIENT")&&bh(a.uid,this.channelName))return;const l=this._users.find(h=>h.uid===a.uid);if(!l)return void w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));w.debug("[".concat(this._clientId,"] stream removed with uid ").concat(a.uid));let u=()=>{};l.hasAudio&&l.hasVideo?u=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(At.USER_UNPUBLISHED,l,"audio"),w.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(At.USER_UNPUBLISHED,l,"video")}:l.hasVideo?u=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(At.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(u=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(At.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof Ih&&this._p2pChannel.unsubscribe(l).then(h=>{if(h)return this._gateway.unsubscribe(h,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),Be.onGatewayStream(this._sessionId,Mr.ON_REMOVE_STREAM,Fn.ON_REMOVE_STREAM,{peer:a.uint_id||a.uid}),u()}),O(this,"_handleSetStreamLocalEnable",(a,l,u)=>{if(j("BLOCK_LOCAL_CLIENT")&&bh(l,this.channelName))return;const h=this._users.find(_=>_.uid===l);if(!h)return void w.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));w.debug("[".concat(this._clientId,"] local ").concat(a," ").concat(u?"enabled":"disabled"," with uid ").concat(l));const m=a==="audio"?h.hasAudio:h.hasVideo;if(a==="audio"){h._trust_audio_enabled_state_=!0;const _=h._audio_enabled_;if(h._audio_enabled_=u,h._audio_enabled_===_)return;{const v=h._audio_enabled_?"enable-local-audio":"disable-local-audio";w.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(v)),this.safeEmit(At.USER_INFO_UPDATED,l,v)}}else{h._trust_video_enabled_state_=!0;const _=h._video_enabled_;if(h._video_enabled_=u,h._video_enabled_===_)return;{const v=h._video_enabled_?"enable-local-video":"disable-local-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(v)),this.safeEmit(At.USER_INFO_UPDATED,l,v)}}const g=a==="audio"?h.hasAudio:h.hasVideo;return m!==g?!m&&g?(w.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(a)),void this.safeEmit(At.USER_PUBLISHED,h,a)):(a==="video"&&h._videoTrack&&h._videoTrack._destroy(),a==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,a),w.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(a)),void this.safeEmit(At.USER_UNPUBLISHED,h,a)):void 0}),O(this,"_handleMuteStream",(a,l,u)=>{if(j("BLOCK_LOCAL_CLIENT")&&bh(a,this.channelName))return;w.debug("[".concat(this._clientId,"] receive mute message"),a,l,u);const h=this._users.find(_=>_.uid===a);if(!h)return void w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a));const m=l==="audio"?h.hasAudio:h.hasVideo;if(l==="audio"){h._trust_audio_mute_state_=!0;const _=h._audio_muted_;if(h._audio_muted_=u,h._audio_muted_===_)return;{const v=h._audio_muted_?"mute-audio":"unmute-audio";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(v)),this.safeEmit(At.USER_INFO_UPDATED,a,v)}}else{h._trust_video_mute_state_=!0;const _=h._video_muted_;if(h._video_muted_=u,h._video_muted_===_)return;{const v=h._video_muted_?"mute-video":"unmute-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(v)),this.safeEmit(At.USER_INFO_UPDATED,a,v)}}const g=l==="audio"?h.hasAudio:h.hasVideo;if(m!==g){if(!m&&g)return(l==="audio"?h._audioSSRC:h._videoSSRC)?(w.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(l)),void this.safeEmit(At.USER_PUBLISHED,h,l)):void w.warning("[".concat(this._clientId,"] remote user ").concat(a," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&h._videoTrack&&!h._video_pre_subscribed&&h._videoTrack._destroy(),l==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,l),w.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(l)),this.safeEmit(At.USER_UNPUBLISHED,h,l)}}),O(this,"_handleP2PLost",async a=>{w.debug("[".concat(this._clientId,"] receive p2p lost"),a),parseInt(a.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():w.warning("[".concat(this._clientId,"] P2PLost stream not found"),a)}),O(this,"_handleTokenWillExpire",()=>{w.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(At.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),O(this,"_handleBeforeUnload",a=>{a.type==="beforeunload"&&a.returnValue!==void 0&&a.returnValue!==""||(this.leave(),w.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),O(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(At.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const a={downlinkNetworkQuality:0,uplinkNetworkQuality:0};a.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),a.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(At.NETWORK_QUALITY,a)}),O(this,"_handleP2PAddAudioOrVideoStream",(a,l,u,h)=>{const m=this._users.find(_=>_.uid===l);if(!m)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(a)),this.store.subscribe(m.uid,a,void 0,void 0,void 0,Date.now());const g=a==="audio"?m.hasAudio:m.hasVideo;a==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,a==="audio"?(m._audio_added_=!0,u!==void 0&&(m._audioSSRC=u),h!==void 0&&(m._audioMid=h)):(m._video_added_=!0,u!==void 0&&(m._videoSSRC=u),h!==void 0&&(m._videoMid=h)),(a==="audio"?m.hasAudio:m.hasVideo)&&!g&&(w.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(a)),this.safeEmit(At.USER_PUBLISHED,m,a)),this._p2pChannel.hasPendingRemoteMedia(m,a)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,a,!0).catch(_=>{w.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=e,this._clientId=t||on(5,"client-"),this.store=new class{constructor(a,l,u,h,m){gt(this,"state",void 0),this.state={codec:a,audioCodec:l,mode:u,clientId:h,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:mh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!m}}dispatch(a){this.state=function(l,u){switch(u.type){case ht.SET_SESSION_ID:return Se(Se({},l),{},{sessionId:u.sessionId});case ht.SET_P2P_ID:return Se(Se({},l),{},{p2pId:u.p2pId});case ht.SET_UID:return Se(Se({},l),{},{uid:u.uid});case ht.SET_INT_UID:return Se(Se({},l),{},{intUid:u.intUid});case ht.SET_PUB_ID:return Se(Se({},l),{},{pubId:u.pubId});case ht.KEY_METRIC_CLIENT_CREATED:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{clientCreated:u.metric})});case ht.KEY_METRIC_JOIN_START:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{joinStart:u.metric})});case ht.KEY_METRIC_PRELOAD_START:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{preloadStart:u.metric})});case ht.KEY_METRIC_PRELOAD_END:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{preloadEnd:u.metric})});case ht.KEY_METRIC_JOIN_END:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{joinEnd:u.metric})});case ht.KEY_METRIC_REQUEST_AP_START:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{requestAPStart:u.metric})});case ht.KEY_METRIC_REQUEST_AP_END:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{requestAPEnd:u.metric})});case ht.KEY_METRIC_REQUEST_SUA_END:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{requestSUAEnd:u.metric})});case ht.KEY_METRIC_BEFORE_CONNECT:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{beforeConnect:u.metric})});case ht.KEY_METRIC_PEER_RECEIVER:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{peerReceiver:u.metric})});case ht.KEY_METRIC_SIGNAL_CONNECTED:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{signalConnected:u.metric})});case ht.KEY_METRIC_JOIN_REQ:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{joinReq:u.metric})});case ht.KEY_METRIC_JOIN_REP:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{joinRep:u.metric})});case ht.KEY_METRIC_JOIN_GATEWAY_START:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{joinGatewayStart:u.metric})});case ht.KEY_METRIC_JOIN_GATEWAY_END:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{joinGatewayEnd:u.metric})});case ht.KEY_METRIC_PEER_CONNECTION_START:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{peerConnectionStart:u.metric})});case ht.KEY_METRIC_PEER_CONNECTION_END:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{peerConnectionEnd:u.metric})});case ht.KEY_METRIC_DESCRIPTION_START:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{descriptionStart:u.metric})});case ht.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{signalChannelOpen:u.metric})});case ht.KEY_METRIC_ICE_CONNECTION_END:return Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{iceConnectionEnd:u.metric})});case ht.KEY_METRIC_PUBLISH:{const h=l.keyMetrics.publish,m=h.findIndex(g=>g.trackId===u.metric.trackId);return m!==-1?(h[m]=Se(Se({},h[m]),u.metric),Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{publish:[...h]})})):Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,u.metric]})})}case ht.KEY_METRIC_SUBSCRIBE:{const h=l.keyMetrics.subscribe,m=h.findIndex(g=>g.userId===u.metric.userId&&g.type===u.metric.type);return m!==-1?(h[m]=Se(Se({},h[m]),u.metric),Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{subscribe:[...h]})})):Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,u.metric]})})}case ht.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const h=l.keyMetrics.firstVideoFrameDecoded,m=h.findIndex(g=>g.userId===u.metric.userId);return m!==-1?(h[m]=Se(Se({},h[m]),u.metric),Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{firstVideoFrameDecoded:[...h]})})):Se(Se({},l),{},{keyMetrics:Se(Se({},l.keyMetrics),{},{firstVideoFrameDecoded:[...l.keyMetrics.firstVideoFrameDecoded,u.metric]})})}case ht.RESET_FIRST_VIDEO_FRAME_DECODED:return l.keyMetrics.firstVideoFrameDecoded=[],l;case ht.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=u.mode,l;case ht.RECORD_JOIN_CHANNEL_SERVICE:return typeof u.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,u.record]:(l.joinChannelServiceRecords[u.index]=Se(Se({},l.joinChannelServiceRecords[u.index]),u.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case ht.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case ht.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},l;case ht.SET_USE_P2P:return Se(Se({},l),{},{useP2P:u.val});case ht.SET_TRANSPORT_TYPE:return Se(Se({},l),{},{p2pTransport:u.val});case ht.SET_RTE_URL:return Se(Se({},l),{},{rteUrl:u.rteUrl});case ht.SET_RTE_SID:return Se(Se({},l),{},{rteSid:u.rteSid});default:return l}}(this.state,a)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(a){this.state.useDcSignal=a}set autoSubscribe(a){this.state.autoSubscribe=a}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(a){this.state.enableInstantMuteRestore=a}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(a){this.state.networkQualityProbe=a}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(a){this.dispatch({type:ht.SET_SESSION_ID,sessionId:a})}get sessionId(){return this.state.sessionId}set rteUrl(a){this.dispatch({type:ht.SET_RTE_URL,rteUrl:a})}get rteUrl(){return this.state.rteUrl}set rteSid(a){this.dispatch({type:ht.SET_RTE_SID,rteSid:a})}get rteSid(){return this.state.rteSid}set cid(a){this.state.cid=a}get cid(){return this.state.cid}set codec(a){this.state.codec=a}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(a){this.dispatch({type:ht.SET_P2P_ID,p2pId:a})}get p2pId(){return this.state.p2pId}set dcId(a){this.dispatch({type:ht.SET_DC_ID,dcId:a})}get dcId(){return this.state.dcId}set uid(a){this.dispatch({type:ht.SET_UID,uid:a})}get uid(){return this.state.uid}set intUid(a){this.dispatch({type:ht.SET_INT_UID,intUid:a})}get intUid(){return this.state.intUid}set pubId(a){this.dispatch({type:ht.SET_PUB_ID,pubId:a})}get pubId(){return this.state.pubId}set cloudProxyServerMode(a){this.dispatch({type:ht.SET_CLOUD_PROXY_SERVER_MODE,mode:a})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(a){this.dispatch({type:ht.SET_USE_P2P,val:a})}get useP2P(){return this.state.useP2P}set p2pTransport(a){this.dispatch({type:ht.SET_TRANSPORT_TYPE,val:a})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(a){this.state.hasStartJoinChannel=a}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(a){this.state.isABTestSuccess=a}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ht.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ht.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:ht.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:ht.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:ht.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ht.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ht.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:ht.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:ht.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:ht.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:ht.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:ht.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:ht.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ht.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ht.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ht.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ht.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(a,l){this.dispatch({type:ht.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Se({userId:a},l)})}descriptionStart(){this.dispatch({type:ht.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ht.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ht.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(a,l,u,h){this.dispatch({type:ht.KEY_METRIC_PUBLISH,metric:Se(Se({trackId:a,type:l},u&&{publishStart:u}),h&&{publishEnd:h})})}subscribe(a,l,u,h,m,g,_){this.dispatch({type:ht.KEY_METRIC_SUBSCRIBE,metric:Se(Se(Se(Se(Se({userId:a,type:l},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m}),g&&{streamAdded:g}),_&&{firstDecoded:_})})}massSubscribe(a,l,u,h){a.forEach(m=>{this.dispatch({type:ht.KEY_METRIC_SUBSCRIBE,metric:Se(Se(Se({userId:m.userId,type:m.type},l&&{subscribeStart:l}),u&&{subscribeEnd:u}),h&&{firstFrame:h})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(a,l){a.service==="gateway"&&Array.isArray(a.urls)&&(a.urls=a.urls.map(u=>u.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:ht.RECORD_JOIN_CHANNEL_SERVICE,record:Se(Se({},a),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ht.RECORD_JOIN_CHANNEL_SERVICE,record:a,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ht.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ht.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:ht.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,j("SIGNAL_CHANNEL")===1),this._leaveMutex=new is("client-leave",this._clientId),this._publishMutex=new is("client-publish",this._clientId),this._renewTokenMutex=new is("client-renewtoken",this._clientId),this._subscribeMutex=new is("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),w.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ja," build: ").concat(mN,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{Zx(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(a){w.warning("[".concat(this._clientId,"] ").concat(a.toString()))}var i;this._statsCollector=new F_(this.store),this._statsCollector.onStatsException=(a,l,u)=>{w.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(a,", msg: ").concat(l,", uid: ").concat(u)),a===EI.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(h=>{h instanceof KS&&j("ENABLE_ENCODE_EXCEPTION")&&h.findClosestProfile()}),this.safeEmit(At.EXCEPTION,{code:a,msg:l,uid:u})},this._statsCollector.onUploadPublishDuration=(a,l,u,h)=>{const m=this._users.find(g=>g.uid===a);m&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(m.uid,{peerPublishDuration:u,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(m)),Be.peerPublishStatus(this._sessionId,{subscribeElapse:h,audioPublishDuration:l,videoPublishDuration:u,peer:m._uintid}))},this._statsCollector.onVideoCodecChanged=a=>{if(j("VIDEO_STANDARD_BITRATE_VERSION")&&(a==="av1"||a==="h265"||a==="h264")){const l=this.localTracks.find(u=>u instanceof _n);l&&l._saveEncodeBitrateRatio!==1&&l.setSaveEncodeBitrateRatio(a==="h264"?j("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new O_e(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Cr,httpRetryConfig:e.httpRetryConfig||Cr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new G_e(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},tc("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Ih(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,a){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],u=arguments.length>6&&arguments[6]!==void 0&&arguments[6];hn("JOIN_GATEWAY_USE_443PORT_ONLY",l),hn("JOIN_GATEWAY_USE_DUAL_DOMAIN",u);const h=this._gateway.signal.websocket;return h instanceof ZN&&(h.use443PortOnly=l,h.tryDoubleDomain=u),async function(m,g,_){wS.get(m)||wS.set(m,[]),CS.get(m)||CS.set(m,g),Gc.get(m)||Gc.set(m,0);const v=wS.get(m),S=CS.get(m);if(!v||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Gc.get(m)===S){const M=E_();v.push(M),await M.promise}Gc.set(m,Gc.get(m)+1);for(var T=arguments.length,P=new Array(T>3?T-3:0),x=3;x<T;x++)P[x-3]=arguments[x];const N=await _(...P);return Gc.set(m,Gc.get(m)-1),Gc.get(m)===S-1&&v.length>0&&(v[0].resolve(),v.shift()),Gc.get(m)===0&&(wS.set(m,[]),CS.set(m,0),Gc.set(m,0)),N}("client.join",j("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,a)}async join(e,t,n,i,a){const l=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const u=(OS||OS||(OS=(window.location.protocol.split(":")[0]||"").toUpperCase(),OS))==="HTTPS",h=bF()?window.isSecureContext:"Browser Not Support";(!bF()&&!u||!window.isSecureContext)&&w.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let m;Be.setAppId(e);try{if(!n&&n!==null)throw new re(U.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Es(n,"token",1,2047),Es(e,"appid",1,2047),n0(t),i&&r0(i),a)if(typeof a=="string")Es(a,"optionalInfo",1,256),m=a;else{if(typeof a!="object")throw new re(U.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:N,enableInstantMuteRestore:M,networkQualityProbe:F}=a;N&&(fo(N,"autoSubscribe"),w.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(N)),this.store.autoSubscribe=N),M&&(fo(M,"enableInstantMuteRestore"),w.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(M)),this.store.enableInstantMuteRestore=M),F&&(fo(F,"networkQualityProbe"),w.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(F)),this.store.networkQualityProbe=F)}}}catch(N){throw Be.reportApiInvoke(ph(),{name:Vn.JOIN,options:[e,t,n,i],states:{isHttps:u,isSecureContext:h},tag:gn.TRACER}).onError(N),N}if(this._leaveMutex.isLocked&&(w.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),w.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const N=new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Be.reportApiInvoke(ph(),{name:Vn.JOIN,options:[e,t,n,i],states:{isHttps:u,isSecureContext:h},tag:gn.TRACER}).onError(N),N}this._gateway.state="CONNECTING",this.store.preloadStart();const g=await LI({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const _=(g==null?void 0:g.sid)||ph();w.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId);const v=Be.reportApiInvoke(this._sessionId,{id:this._clientId,name:Vn.JOIN,options:[e,t,n,i],states:{isHttps:u,isSecureContext:h},tag:gn.TRACER}),S=Co(Co(Co({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:m,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!g},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:j("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(S.stringUid=i,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async N=>{const M=function(te){const Y=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ne=new Uint8Array(new ArrayBuffer(Y.length));for(let ue=0;ue<Y.length;ue+=1)ne[ue]=Y.charCodeAt(ue);return ne}(),F=await window.crypto.subtle.importKey("spki",M,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),q=Jx(N),J=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},F,q);return function(te){let Y="";for(let ne=0;ne<te.length;ne+=1)Y+=String.fromCharCode(te[ne]);return window.btoa(Y)}(new Uint8Array(J))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const N=new TextEncoder,M=j("USE_PURE_ENCRYPTION_MASTER_KEY")?N.encode(S.appId+this._encryptionSecret+this._encryptionSecret):N.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(F,q,J){const te=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),Y=F==="aes-128-gcm2"?128:256,ne=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:DF,hash:"SHA-256",salt:J},te,Y+lge);return new Uint8Array(ne).subarray(Y/8)}(this._encryptionMode,M,hh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(F,q,J){const te=await window.crypto.subtle.importKey("raw",q,"PBKDF2",!1,["deriveBits","deriveKey"]),Y=F==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:DF,hash:"SHA-256",salt:J},te,{name:"AES-GCM",length:Y},!0,["encrypt","decrypt"])}(this._encryptionMode,M,hh(this._encryptionSalt))}else h?w.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):w.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,w.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:S.stringUid});const T=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&T===this._sessionId&&Be.joinChannelTimeout(this._sessionId,5)},5e3);try{var P;let N;const M=S.cloudProxyServer;if(Ee(P=["proxy3","proxy4","proxy5"]).call(P,M)){const Y=j("PROXY_SERVER_TYPE3");Array.isArray(Y)?S.proxyServer=Y[0]:S.proxyServer=Y}if(Be.setProxyServer(S.proxyServer),w.setProxyServer(S.proxyServer),this.store.requestAPStart(),g){if(w.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(g.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=g.intUid),N={gatewayInfo:g.ap.gatewayInfo},j("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(g.ap.proxyInfo.addresses.length===0)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Y=(await S3(g.ap.proxyInfo,g.ap.gatewayInfo.uid)).map(ne=>({turnServerURL:ne.address,tcpport:ne.tcpport||xs.tcpport,udpport:ne.udpport||xs.udpport,username:ne.username||xs.username,password:ne.password||xs.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:Y}}I5(g,S.stringUid)}else{if(S.stringUid&&!S.uid){let Y;[Y,N]=await Ne.all([X3(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr,this.store).finally(()=>{this.store.requestSUAEnd()}),Y3(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),w.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(Y)),S.uid=Y,N.gatewayInfo.uid=Y,N.gatewayInfo.res.uid=Y}else N=await Y3(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(Zo.UPDATE_BITRATE_LIMIT,Y=>{this._p2pChannel.updateBitrateLimit(Y)}),this._configDistribute.on(Zo.UPDATE_CLIENT_ROLE_OPTIONS,Y=>{this._setClientRoleOptions(Y)}),this._configDistribute.on(Zo.UPDATE_REMOTE_VIDEO_STREAM_TYPE,Y=>{var ne;Ee(ne=[0,1,4,5,6,7,8,9]).call(ne,Y)&&(this.remoteUsers.forEach(ue=>{this._remoteStreamTypeCacheMap.get(ue.uid)!==Y&&this.setRemoteVideoStreamType(ue.uid,Y)}),this.setRemoteDefaultVideoStreamType(Y))}),this._configDistribute.on(Zo.FALLBACK_TO_HLS,Y=>{Y&&this.safeEmit(At.FALLBACK_TO_HLS,eN.CONFIG)}),this._configDistribute.on(Zo.UPDATE_VOS_CONFIGURE,Y=>{this._gateway.setConfigure(Y).catch(ne=>{w.debug("[".concat(this._clientId,"] auto set vos config failed"),ne)})})},0),this._key=n||e;const F=N.gatewayInfo,q=S.uid?S.uid:F.uid;this._joinInfo=Co(Co({},S),{},{cid:F.cid,uid:q,vid:F.vid,apResponse:F.res,apGatewayAddress:F.apGatewayAddress,uni_lbs_ip:F.uni_lbs_ip,gatewayAddrs:F.gatewayAddrs}),this.store.intUid=q,this.store.cid=F.cid;const J=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));v.onSuccess(J),this._appId=e,this._channelName=S.cname,this._uid=J,this.store.uid=J,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!ss()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(ss()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const te=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return w.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(te)),setTimeout(()=>{w.startUpload()},5e3),this.store.joinEnd(),x=this,Ee(Th).call(Th,x)||Th.push(x),this._cloudProxyServerMode==="disabled"&&jt().supportWebCrypto&&j("ENABLE_PRELOAD")&&MI(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&Be.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&Be.reportRteDetail(this._sessionId)},j("RTE_DETAIL_REPORT_INTERVAL")||6e4),J}catch(N){const M=Array.isArray(N)?N[0]:N;throw M&&M.code===U.OPERATION_ABORTED?w.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),M):w.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),M),M.code!==U.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),v.onError(M),M}var x}async _joinGateway(){if(!this._joinInfo||!this._key)throw new re(U.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!j("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===U.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,Ft.FALLBACK),w.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new re(U.INVALID_OPERATION);return Be.reportApiInvoke(this._sessionId,{name:Vn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:gn.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){w.info("[".concat(this._clientId,"] Leaving channel"));const e=()=>{!ss()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(ss()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=Th.indexOf(n);i!==-1&&Th.splice(i,1)}(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return w.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Ft.LEAVE),w.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Om))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new re(U.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new re(U.INVALID_OPERATION,"audience can not publish stream");for(const a of n){if(!(a instanceof Om))throw new re(U.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new re(U.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}w.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(a=>"".concat(a.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(a=>{const l=this._configDistribute.getBitrateLimit();a instanceof _n&&l&&a.setBitrateLimit(l.uplink)});try{await this._publishHighStream(n),w.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw w.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{i()}}async _publishDataChannel(e){if(e==null)throw new re(U.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));fn(e.id,"id",0,65535,!0),fo(e.ordered,"ordered"),Es(e.metadata,"metadata",0,512),w.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(a=>a.id===e.id)!==-1)throw new re(U.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new re(U.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new re(U.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(a){return V3(a,!1)}(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw w.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new re(U.CREATE_DATACHANNEL_ERROR);try{await Ne.all(i.map(a=>this._uid&&this._gateway.publishDataChannel(this._uid,a,!0))),await n._waitTillOpen()}catch(a){if(a.code!==U.DISCONNECT_P2P)throw a}}return w.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw w.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new re(U.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Om))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);w.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(yr.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),w.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(a=>"".concat(a.getTrackId()))))}}catch(i){throw w.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),w.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),w.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(i=>"".concat(i.id))))}catch(n){throw w.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Fd)){const i=this.remoteUsers.find(a=>a.uid===e);if(!i)throw new re(U.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(wr(t,"mediaType",["audio","video"]),this.store.useP2P)throw new re(U.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new re(U.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Ve.AUDIO,i=t===Ve.VIDEO,a=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:u,rtxSsrcId:h,cname:m,uint_id:g}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new re(U.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(S=>S.uid===e);_||(_=new Fd(e,g||e),_._is_pre_created=!0,this._users.push(_)),m&&(_._cname=m),_._uintid||(_._uintid=g||e),n&&(_._audioSSRC=l,_._audio_pre_subscribed=!0,u&&(_._audioOrtc=u)),i&&(_._videoSSRC=l,_._video_pre_subscribed=!0,u&&(_._videoOrtc=u),h!=null&&(_._rtxSsrcId=h)),w.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(_,t,l,h,u);const v=n?_._audioTrack:_._videoTrack;if(!v)throw new re(U.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),i&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),v}catch(l){throw w.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{a()}}async _subscribeDataChannel(e,t){var n;if(fn(t,"channelId",0,65535,!0),!this._joinInfo)throw new re(U.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new re(U.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new re(U.INVALID_REMOTE_USER,"user is not published");const a=(n=e._dataChannels)===null||n===void 0?void 0:n.find(h=>h.id===t);if(!a)throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new re(U.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const h=await this._p2pChannel.subscribeDataChannel(e,[a]);if(h&&Ee(h).call(h,a.id))try{var u;if(typeof a._originDataChannelId!="number")throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new re(U.CREATE_DATACHANNEL_ERROR);const m={id:a.id,datachannelId:a._originDataChannelId,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:(u=a.metadata)!==null&&u!==void 0?u:""};await this._gateway.subscribeDataChannel(e.uid,m,!0),await a._waitTillOpen()}catch(m){if((m==null?void 0:m.code)!==U.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[a]),m;await this._p2pChannel.unsubscribeDataChannel(e,[a]),this._p2pChannel.setPendingRemoteDataChannel(e,a.id)}return w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),a}finally{l()}}async _p2pSubscribe(e,t,n){if(wr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new re(U.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new re(U.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new re(U.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new re(U.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const a=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const u=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,u,h)}catch(u){throw u}w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(u=>{w.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new re(U.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw w.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{a()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(wr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new re(U.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e)){const g=new re(U.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),g}if(!e.hasAudio&&!e.hasVideo){const g=new re(U.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),g}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const g=new re(U.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),g}let a=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?Ve.AUDIO:Ve.VIDEO,ssrcId:a};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const m=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const _=t==="audio"?e._audioSSRC:e._videoSSRC;_!==void 0&&_!==a&&(a=_,l=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?Ve.AUDIO:Ve.VIDEO,ssrcId:a}),Ls.markSubscribeStart(this.store.clientId,a),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,a,u,l);try{this._p2pChannel.isPreSubScribe(a)||await this._gateway.subscribe(e.uid,h,!0)}catch(v){if((v==null?void 0:v.code)!==U.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),v;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,e,t),_}w.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(_=>{w.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const g=t==="audio"?e._audioTrack:e._videoTrack;if(!g)throw new re(U.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),g}catch(g){throw w.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),g),g}finally{m()}}async massSubscribe(e){if(Ml(e,"subscribeList"),!this._joinInfo)throw new re(U.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();w.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:m,mediaType:g}=h;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(g)}).join("; ")));const a=(e=[...e]).map(h=>{let{user:m,mediaType:g}=h;return{user:m,mediaType:g}}),l=await this._p2pChannel.globalLock();try{var u;for(let m=e.length-1;m>=0;m--){const g=e[m],{user:_,mediaType:v}=g;if(wr(v,"mediaType",["audio","video"]),!_){const x=new re(U.INVALID_PARAMS,"user property does not exist in subscribeList item");throw w.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),x}if(!this._users.find(x=>x===_)){const x=new re(U.INVALID_REMOTE_USER,"user is not in the channel");w.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),a[m].error=x,e.splice(m,1);continue}if(v==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||v==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const x=new re(U.REMOTE_USER_IS_NOT_PUBLISHED);w.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(v,", remote user is not published")),a[m].error=x,e.splice(m,1);continue}const T=Xr.Video|Xr.LwoVideo,P=n.get(_);if(P){if(v==="video"?P&T:P&Xr.Audio){e.splice(m,1),w.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(v," twice"));continue}n.set(_,P|(v==="video"?T:Xr.Audio))}else n.set(_,v==="video"?T:Xr.Audio)}for(let m=e.length-1;m>=0;m--){const g=e[m],{user:_,mediaType:v}=g,S=Xr.Video|Xr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,v)){await this._p2pChannel.unmuteRemoteNoLock(_,v);const T=n.get(_);n.set(_,v==="video"?T^S:T^Xr.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let h=ka(u=Array.from(n.entries())).call(u,(m,g)=>{let[_,v]=g;if(v===0)return m;const S={stream_id:_.uid,stream_type:v};return v&Xr.Audio&&(S.audio_ssrc=_._audioSSRC),v&Xr.Video&&(S.video_ssrc=_._videoSSRC),m.push(S),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(g=>{let{user:_,mediaType:v}=g;return{user:_,mediaType:v,ssrcId:v===Ve.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:v===Ve.VIDEO?_._rtxSsrcId:void 0}}));const m=new Map;if(h=h.filter(g=>g.video_ssrc&&!this._p2pChannel.isPreSubScribe(g.video_ssrc)||g.audio_ssrc&&!this._p2pChannel.isPreSubScribe(g.audio_ssrc)||!g.video_ssrc&&!g.audio_ssrc),h.length>0){const g=await this._gateway.subscribeAll(h,!0);((g==null?void 0:g.users)||[]).forEach(_=>{let{stream_id:v,video_error_code:S,audio_error_code:T,error_code:P}=_;(S||T||P)&&m.set(v,{video_error_code:S,audio_error_code:T,error_code:P})})}if(Array.from(m.entries()).length>0){const g=[];Array.from(m.entries()).forEach(_=>{let[v,S]=_;const T=this.remoteUsers.find(P=>P.uid===v);if(T){let P;S.error_code||S.video_error_code&&S.audio_error_code?P=void 0:S.video_error_code?P=Ve.VIDEO:S.audio_error_code&&(P=Ve.AUDIO),g.push({user:T,mediaType:P})}}),g.length>0&&await this._p2pChannel.massUnsubscribeNoLock(g)}for(const g of a){const _=m.get(g.user.uid);if(_){const v=_.error_code||g.mediaType==="audio"&&_.audio_error_code||g.mediaType==="video"&&_.video_error_code;if(v){const S=Ch(v);w.error("user:".concat(g.user.uid," mediaType:").concat(g.mediaType," has massSubscribe error ").concat(S.desc)),g.error=new re(U.SUBSCRIBE_FAILED,"code ".concat(v,": ").concat(S.desc))}}g.error||(g.mediaType==="video"?g.track=g.user.videoTrack:g.track=g.user.audioTrack)}return this.store.massSubscribe(a.filter(g=>!g.error).map(g=>({userId:g.user.uid,type:g.mediaType})),void 0,Date.now()),a.forEach(g=>{var _;Be.subscribe(this.store.sessionId,{succ:!!g.error,ec:((_=g.error)===null||_===void 0?void 0:_.code)||null,video:g.mediaType===Ve.VIDEO,audio:g.mediaType===Ve.AUDIO,peerid:g.user.uid,subscribeRequestid:g.mediaType===Ve.VIDEO?g.user._videoSSRC:g.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(g.user._videoSSRC)},!0)}),w.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(g=>{let{user:_,mediaType:v}=g;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(v)}).join("; "))),a}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{l(),i()}}async unsubscribe(e,t,n){if(!(e instanceof Fd)){const l=this.remoteUsers.find(u=>u.uid===e);if(!l)throw new re(U.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&wr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new re(U.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new re(U.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}w.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const a=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&NS(this._users,e),w.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===U.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{a()}}async _unsubscribeDataChannel(e,t){if(t&&fn(t,"id",0,65535,!0),!this._joinInfo)throw new re(U.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(a=>a===e)){const a=new re(U.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}let i;if(typeof t=="number"){const a=e._dataChannels.find(l=>l.id===t);a&&(i=[a])}else i=e._dataChannels;if(i===void 0){const a=new re(U.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),a}w.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(a=>a.id)));try{const a=await this._p2pChannel.unsubscribeDataChannel(e,i);a&&await this._gateway.unsubscribeDataChannel(a,e.uid),w.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(a))}catch(a){if(a.code===U.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}}async massUnsubscribe(e){if(Ml(e,"unsubscribeList"),!this._joinInfo)throw new re(U.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");w.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:a}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(a,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:a}=e[n];if(!i){const h=new re(U.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw w.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(wr(a,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===i)){w.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const u=Xr.Video|Xr.LwoVideo;if(t.has(i)){const h=t.get(i);let m;switch(a){case"video":m=h&u;break;case"audio":m=h&Xr.Audio;break;default:m=h&(Xr.Audio|u)}if(m){w.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(a," twice.")),e.splice(n,1);continue}a?a==="audio"?t.set(i,h|Xr.Audio):a==="video"&&t.set(i,h|u):t.set(i,h|Xr.Audio|u)}else a?a==="audio"?t.set(i,Xr.Audio):a==="video"&&t.set(i,u):t.set(i,Xr.Audio|u)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),w.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:a,mediaType:l}=i;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(l,";")}).join()))}catch(n){if(n.code===U.DISCONNECT_P2P)return void w.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw w.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new ae(U.INVALID_PARAMS);ir(n.width)||Xx(n.width,"streamParameter.width"),ir(n.height)||Xx(n.height,"streamParameter.height"),ir(n.framerate)||Xx(n.framerate,"streamParameter.framerate"),ir(n.bitrate)||fn(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&w.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),w.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,ve.LocalVideoLowTrack)}async setDualStreamMode(e,t){wr(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(n=>{w.warning("[".concat(this._clientId,"] set dual stream mode failed"),n.toString())}):w.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case ym.AUTO_SIMULCAST_STREAM:w.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case ym.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case ym.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(n){throw w.error("[".concat(this._clientId,"] set dual stream mode error"),n.toString()),n}}async enableDualStream(){if(!jt().supportDualStream)throw Be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new re(U.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new re(U.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=ym.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{w.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),w.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void w.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(ve.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=ym.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{w.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),Be.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),w.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){wr(i,"role",["audience","host"])}(e),t&&Zx(t),this.mode==="rtc"||this.mode==="p2p")throw w.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new re(U.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new re(U.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new re(U.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==n&&j("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Rs.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),w.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),n==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Ih){const{video_codec:i}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(i.map(a=>a.toLowerCase()).filter(a=>{var l;return Ee(l=Object.keys(fh)).call(l,a)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&Zx(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{w.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Es(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new re(U.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new re(U.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Be.setProxyServer(this._proxyServer),w.setProxyServer(this._proxyServer),w.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new re(U.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new re(U.INVALID_OPERATION,"You have already set the proxy")}if(ch(e))return this._turnServer={servers:e,mode:"original-manual"},void w.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>uF(n)),this._turnServer={servers:e,mode:"manual"},w.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new re(U.INVALID_OPERATION,"you should set license before join channel");if(Es(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new re(U.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,w.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new re(U.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new re(U.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new re(U.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new re(U.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new re(U.INVALID_OPERATION,"Stop proxy server after leave channel");Be.setProxyServer(),w.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new re(U.INVALID_PARAMS,"accessPoints is required.");Ml(e.accessPoints.serverList,"accessPoints.serverList"),Es(e.accessPoints.domain,"accessPoints.domain");const t=(S,T)=>{fn(S,T,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new re(U.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");j("CLOSE_AFB_FOR_LOCAL_AP")&&(hn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),hn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=e.accessPoints.domain,l=e.accessPoints.serverList.map(S=>i.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(a):S),u=l.map(S=>"".concat(S,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,hn("WEBCS_DOMAIN",u),hn("WEBCS_DOMAIN_BACKUP_LIST",u),hn("GATEWAY_DOMAINS",[a]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Ml(e.report.hostname,"report.hostname"),hn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),hn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(hn("EVENT_REPORT_DOMAIN",l[0]),hn("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let h=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),h=e.report.port),hn("STATS_COLLECTOR_PORT",h),e.report?hn("ENABLE_EVENT_REPORT",!0):hn("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Ml(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=l[0];let g=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),g=e.log.port),hn("LOG_UPLOAD_SERVER","".concat(m,":").concat(g));let _=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Ml(e.cds.hostname,"cds.hostname"),_=e.cds.hostname):_=l;let v=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),v=e.cds.port),hn("CDS_AP",_.map(S=>"".concat(S,":").concat(v))),e.cds?hn("ENABLE_CONFIG_DISTRIBUTE",!0):hn("ENABLE_CONFIG_DISTRIBUTE",!1),w.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Ml(e,"serverList"),Es(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new re(U.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,hn("WEBCS_DOMAIN",e),hn("WEBCS_DOMAIN_BACKUP_LIST",e),hn("GATEWAY_DOMAINS",[t]),hn("EVENT_REPORT_DOMAIN",e[0]),hn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),hn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),w.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(wr(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw w.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else w.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){wr(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw w.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}w.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){wr(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw w.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}w.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(l){wr(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Es(t,"secret");const a=["aes-128-gcm2","aes-256-gcm2"];if(Ee(a).call(a,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new re(U.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new re(U.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(fo(i,"encryptDataStream"),!Ee(a).call(a,e))throw new re(U.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||w.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Dd(n))}async renewToken(e){if(Es(e,"token",1,2047),!this._key||!this._joinInfo)throw new re(U.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(j("USE_NEW_TOKEN")){w.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await B_e(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr);w.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else w.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});w.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,w.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?w.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(At.VOLUME_INDICATOR,e)},j("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new re(U.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new re(U.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new re(U.LIVE_STREAMING_TASK_CONFLICT);const n=t?Vl.TRANSCODE:Vl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Vl.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new re(U.INVALID_PARAMS,"can not find live streaming url to stop");await Ne.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){t5(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){t5(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Ih&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new re(U.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const a=new TextEncoder;e.payload=a.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ee(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(a,l,u){var h;const m=ka(h=Array.from(u)).call(h,(x,N)=>x+N,0),g={serverTs:0,seq:dge++,length:u.length,checkSum:m},_=new Uint8Array(yF(m,2)),v=new ArrayBuffer(Rm),S=new DataView(v);S.setUint32(0,g.serverTs),S.setUint16(4,g.seq),S.setUint16(6,g.length),S.setUint16(8,g.checkSum);const T=16-u.length%16;u=fF(u,new Uint8Array(T));const P=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:PF,additionalData:_},l,u);return fF(new Uint8Array(v),new Uint8Array(P))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new re(U.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ye.DATA_STREAM,{payload:Dd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Q_e},!n)}sendMetadata(e){if(!this._joinInfo)throw new re(U.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new re(U.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ye.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Dd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(vge),!this._joinInfo)throw new re(U.INVALID_OPERATION,"can not send custom report, not joined");await Be.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(j("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{Ee(t).call(t,n)||delete e[n]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){wr(t.spatialLayer,"spatialLayer",[0,1,2,3]),wr(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw w.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(fo(t,"apRTM"),fn(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,w.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(w.debug("[".concat(this._clientId,"] reset client")),function(e){const t=Mm.indexOf(e);t!==-1&&Mm.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=yi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&N5(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&Be.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Be.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new is("client-publish",this._clientId),this._subscribeMutex=new is("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||ph();e?w.debug("[".concat(this._clientId,"] new Session ").concat(i)):w.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const a=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Be.addSid(i);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};Be.sessionInit(this._sessionId,Co({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new re(U.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new re(U.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");w.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(yr.PUBLISH,i,!0)}catch(a){throw n.throw(a),a}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let a;try{a=await this._gateway.publish(this._uid,i,!0)}catch(l){if(l.code!==U.DISCONNECT_P2P)throw n.throw(l),l}await n.next(((t=a)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const a of e)a instanceof _n&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig).catch(l=>{w.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===U.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new re(U.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new re(U.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));w.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let a;try{a=await this._gateway.publish(this._uid,i,!0)}catch(l){if(l.code!==U.DISCONNECT_P2P)throw n.throw(l),l}n.next(((t=a)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===U.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new re(U.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},tc("LiveStreaming").create(i));var i;return n.onLiveStreamError=(a,l)=>{Be.reportApiInvoke(this._sessionId,{name:Vn.ON_LIVE_STREAM_ERROR,options:[a,l],tag:gn.TRACER}).onSuccess(),this.safeEmit(At.LIVE_STREAMING_ERROR,a,l)},n.onLiveStreamWarning=(a,l)=>{Be.reportApiInvoke(this._sessionId,{name:Vn.ON_LIVE_STREAM_WARNING,options:[a,l],tag:gn.TRACER}).onSuccess(),this.safeEmit(At.LIVE_STREAMING_WARNING,a,l)},n.on(QN.REQUEST_WORKER_MANAGER_LIST,(a,l,u)=>{if(!this._joinInfo)return u(new re(U.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(h,m,g,_){const v=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(S=>m.proxyServer?"https://".concat(m.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await k_e(v,h,m,g,_)})(a,this._joinInfo,this._axiosCancelSource.token,Cr).then(l).catch(u)}),n};return e===Vl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new re(U.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},tc("ChannelMediaRelay").create(e));i.on("state",a=>{a===ki.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(At.CHANNEL_MEDIA_RELAY_STATE,a)}),i.on("event",a=>{this.safeEmit(At.CHANNEL_MEDIA_RELAY_EVENT,a)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(a,l)=>{var u;a==="resolution"&&((u=this._channelMediaRelayClient)===null||u===void 0||u.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,a=[];if(t){const l=[];this._users.forEach(u=>{u._dataChannels.forEach(h=>{n.every(m=>m.uid!==u._uintid||m.stream_id!==h.id)&&l.push({uid:u._uintid,stream_id:h.id,ordered:h.ordered,max_retrans_times:h.maxRetransmits,metadata:h.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(n)&&n.length>0&&n.forEach(l=>{const{uid:u,stream_id:h,ordered:m,max_retrans_times:g,metadata:_}=l,v=this._users.find(S=>S._uintid===u);if(!v)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(w.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(u)),Ee(a).call(a,v)||a.push(v),v._uintid||(v._uintid=u),v._dataChannels.findIndex(S=>S.id===l.stream_id)===-1){const S={id:h,ordered:!!m,maxRetransmits:g,metadata:_},T=function(P){return V3(P,!0)}(S);v._dataChannels.push(T),w.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published datachannel")),t||this.safeEmit(At.USER_PUBLISHED,v,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(v,l.stream_id)&&(w.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(v.uid," after reconnect.")),this._subscribeDataChannel(v,l.stream_id).catch(S=>{w.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),t&&(this.safeEmit(At.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(l=>{const{uid:u,stream_id:h}=l,m=this._users.find(_=>_._uintid===u);if(!m)return void w.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=m._dataChannels.find(_=>_.id===l.stream_id);g&&(w.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(u)),this._p2pChannel.unsubscribeDataChannel(m,[g]).then(_=>{if(m._dataChannels=m._dataChannels.filter(v=>v!==g),_)return this._gateway.unsubscribeDataChannel(_,m.uid)}),w.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(At.USER_UNPUBLISHED,m,"datachannel",g._config))})}_getEncodingName(e){var t,n;if(!this._joinResponse)return;const i=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!i)return;for(const h of i){var a;if(h.payloadType===e)return h==null||(a=h.rtpMap)===null||a===void 0?void 0:a.encodingName}const l=(n=this._joinResponse.ortc.rtpCapabilities.recv)===null||n===void 0?void 0:n.videoCodecs;if(l)for(const h of l){var u;if(h.payloadType===e)return h==null||(u=h.rtpMap)===null||u===void 0?void 0:u.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){w.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(At.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(vr.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void w.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(i=>{const{value:a,type:l,expires:u}=t[i];u&&u<=n||l||WN()||!Object.prototype.hasOwnProperty.call(LS,i)||(fa[i]=a,cn[i]=a,w.debug("Update gateway parameters from config distribute",i,a))})}catch(t){w.error("Error update config from local cache",t.message)}})()}),this._gateway.on(vr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(vr.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===Ft.FALLBACK)return;const a=()=>{this.safeEmit(At.CONNECTION_STATE_CHANGE,e,t,n)};if(Be.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Vn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:gn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),w.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void a();if(e==="RECONNECTING")this._users.forEach(u=>{u._trust_in_room_=!1,u._trust_audio_enabled_state_=!1,u._trust_video_enabled_state_=!1,u._trust_audio_mute_state_=!1,u._trust_video_mute_state_=!1,u._trust_audio_stream_added_state_=!1,u._trust_video_stream_added_state_=!1,u._is_pre_created||(u._audio_pre_subscribed||(u._audioSSRC=void 0,u._audioOrtc=void 0),u._video_pre_subscribed||(u._videoSSRC=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),u._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((u,h)=>{this._gateway.setStreamFallbackOption(h,u).catch(m=>{w.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((u,h)=>{this._gateway.setRemoteVideoStreamType(h,u).catch(m=>{w.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),j("VOS_CONFIGURE")&&Array.isArray(j("VOS_CONFIGURE"))&&j("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(j("VOS_CONFIGURE")).catch(u=>{w.debug("[".concat(this._clientId,"] auto set vos config failed"),u)}),w.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{w.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(u=>{w.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(u))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(u=>{w.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),u)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(u=>!u._trust_in_room_).forEach(u=>{w.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(u.uid)),this._handleUserOffline({uid:u.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(u=>{u._trust_audio_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,Ve.AUDIO,!1)),u._trust_video_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,Ve.VIDEO,!1)),u._trust_audio_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(u.uid)),this._handleSetStreamLocalEnable("audio",u.uid,!0)),u._trust_video_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(u.uid)),this._handleSetStreamLocalEnable("video",u.uid,!0)),u._trust_video_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(u.uid)),this._handleResetAddStream(u,"video")),u._trust_audio_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(u.uid)),this._handleResetAddStream(u,"audio")),u._video_added_||u._audio_added_||(w.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(u.uid)),this._handleRemoveStream({uid:u.uid,uint_id:u._uintid}))}))},1e3))}a()}),this._gateway.on(vr.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new re(U.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;if(this._fallbackServerInfo)n=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,Be.reportApiInvoke(this._sessionId,{name:Vn.VOS_FALLBACK_CN,options:{cur:n.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:gn.TRACER}).onSuccess(),w.info("[".concat(this._clientId,"] use fallback cn server info"));else{const a=await LI(Co(Co({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(n=a.ap,I5(a),this._joinInfo.preload=!0):(n=await E0(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:l}=a;const[u,h]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:u,port:h}):i.push({host:u,port:h})}),e(i)}catch(n){t(n)}}),this._gateway.on(vr.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(At.NETWORK_QUALITY,e)}),this._gateway.on(vr.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(At.STREAM_TYPE_CHANGED,e,t),Be.reportApiInvoke(this._sessionId,{name:Vn.STREAM_TYPE_CHANGE,options:[e,t],tag:gn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(vr.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(vr.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}}),this._gateway.on(vr.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:w.debug("no attributes in joinResponse");const i=I3(e.ortc,t,n);this._p2pChannel.connect(i)}),this._gateway.on(vr.PRE_CONNECT_PC,async(e,t,n)=>{const{candidates:i,fingerprint:a,turnServer:l}=e;if(this._joinInfo&&i.length>0&&!this._p2pChannel.isPlanB){const{cert:h,cid:m}=this._joinInfo.apResponse,g="".concat(m,"_").concat(h);if(g.length<4||g.length>256)return void w.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(g.length));await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var u;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(m,"_").concat(h),icePwd:"".concat(m,"_").concat(h)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(u=j("FINGERPRINT"))!==null&&u!==void 0?u:a}]},candidates:i,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(_){_.code&&_.code===U.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:l,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),n(_)}}}),this._gateway.on(vr.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(At.FALLBACK_TO_HLS,eN.VOSERROR)}),this._gateway.on(vr.RESET_SIGNAL,()=>{this._p2pChannel instanceof Ih&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(vr.DATACHANNEL_FAILBACK,()=>{Be.reportApiInvoke(this._sessionId,{name:Vn.DATACHANNEL_FAILBACK,options:{},tag:gn.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(pt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(pt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(pt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(pt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(pt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(pt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(pt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(pt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(pt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Ve.AUDIO,!0)),this._gateway.signal.on(pt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Ve.AUDIO,!1)),this._gateway.signal.on(pt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Ve.VIDEO,!0)),this._gateway.signal.on(pt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Ve.VIDEO,!1)),this._gateway.signal.on(pt.RECEIVE_METADATA,e=>{const t=hh(e.metadata);this.safeEmit(At.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(pt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=hh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Ee(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<Rm)throw new re(U.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Rm));n=await async function(l,u,h){const m=h.subarray(0,Rm),g=m.slice(8,Rm),_=(g[0]<<8)+g[1],v=(m[6]<<8)+m[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:PF,additionalData:new Uint8Array(yF(_,2))},u,h.subarray(Rm));return new Uint8Array(S).subarray(0,v)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const a=this._p2pChannel.getStats(),l=this.remoteUsers.find(h=>h.uid===e.uid),u=a==null?void 0:a.audioRecv.find(h=>h.ssrc===(l==null?void 0:l._audioSSRC));i=u==null?void 0:u.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),$_e(Co(Co({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(pt.ON_CRYPT_ERROR,()=>{Pd(()=>{w.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(At.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(pt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{w.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ft.TOKEN_EXPIRE),this.safeEmit(At.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(pt.ON_STREAM_FALLBACK_UPDATE,e=>{w.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(At.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(pt.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===ym.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{w.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(pt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),w.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(pt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(pt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(He.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ye.PUBLISH:{if(!t)return;const a=t.ortc;if(a){var n,i;const l=a.some(m=>{let{stream_type:g}=m;return g===ln.Audio}),u=a.some(m=>{let{stream_type:g}=m;return g!==ln.Audio}),h=a.some(m=>{let{stream_type:g}=m;return g===ln.Screen||g===ln.ScreenLow});t.state==="offer"&&Be.publish(this._joinInfo.sid,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:U.TIMEOUT,audio:l,video:u,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:l?(n=a.find(m=>{let{stream_type:g}=m;return g===ln.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:u?(i=a.find(m=>{let{stream_type:g}=m;return g!==ln.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Ye.SUBSCRIBE:t&&Be.subscribe(this._joinInfo.sid,{succ:!1,ec:U.TIMEOUT,audio:t.stream_type===Ve.AUDIO,video:t.stream_type===Ve.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Ls.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(pt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(pt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;j("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!bh(i.string_id||i.stream_id,this.channelName)));const t=[],n=[];for(const i of e.users){let a=this._users.find(_=>_._uintid===i.stream_id);a?a._trust_in_room_=!0:(a=new Fd(i.string_id||i.stream_id,i.stream_id),this._users.push(a),this.store.firstVideoFrameDecoded(a.uid,{userJoinNotify:Date.now()}),this.getListeners(At.PUBLISHED_USER_LIST).length===0&&(w.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(At.USER_JOINED,a)));const l=Xr.Audio&i.stream_type,u=(Xr.Video|Xr.LwoVideo)&i.stream_type,h=(65280&i.stream_type)!=0,m=l&&a.hasAudio,g=u&&a.hasVideo;u&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=i.video_ssrc,a._rtxSsrcId=i.video_rtx),l&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=i.audio_ssrc),l&&!m&&this.getListeners(At.PUBLISHED_USER_LIST).length===0&&(w.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(At.USER_PUBLISHED,a,"audio")),u&&!g&&this.getListeners(At.PUBLISHED_USER_LIST).length===0&&(w.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(At.USER_PUBLISHED,a,"video")),(l&&!m||u&&!g||h)&&t.push(a),u&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&n.push({user:a,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&n.push({user:a,mediaType:"audio"})}n.length>0&&(w.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{w.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(At.PUBLISHED_USER_LIST).length>0?j("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(w.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.safeEmit(At.PUBLISHED_USER_LIST,t)):w.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(pt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;if(this._p2pChannel instanceof Ih){if(this.role==="audience"&&j("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void w.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var i;return Ee(i=Object.keys(fh)).call(i,n)}))}}),this._gateway.signal.on(He.VOS_FALLBACK_PROMISE,async(e,t,n)=>{if(e==="FALLBACKCN"&&j("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return n(new re(U.UNEXPECTED_ERROR,"can not recover, no join info"));w.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));const a=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;const l=await E0(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Cr,this.store);if(j("QUALITY_FALLBACK_REHEARSAL"))return Be.reportApiInvoke(this._sessionId,{name:Vn.VOS_FALLBACK_CN,options:{cur:l.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:gn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=a,void n();this._fallbackServerInfo=l,t()}catch(l){var i;const u=l==null||(i=l.data)===null||i===void 0?void 0:i.desc;j("QUALITY_FALLBACK_REHEARSAL")?(Be.reportApiInvoke(this._sessionId,{name:Vn.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+u||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:gn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=a):Array.isArray(u)&&Ee(u).call(u,"request downgrade fallback")&&this.safeEmit(At.FALLBACK_TO_HLS,eN.AP_ERROR),n(l)}}else n()})}_handleP2PEvents(){this._gateway.signal.on(pt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(yr.PUBLISH,(e,t,n)=>{const{uid:i}=e;e.forEach(a=>{const{kind:l,ssrcs:u,mid:h,isMuted:m}=a;this._handleP2PAddAudioOrVideoStream(l,i,u[0].ssrcId,h);const g=this._users.find(_=>_.uid===i);return g&&this.store.useP2P?this._p2pChannel.mockSubscribe(g,l,u[0].ssrcId,h).then(()=>{t()}).catch(n):t(),this._handleMuteStream(i,l,!!m)})}),this._gateway.signal.on(yr.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(a){n(a)}}),this._gateway.signal.on(He.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(yr.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:a}=e,l=this._users.find(u=>u.uid===a);if(!l)return w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void t();try{i.forEach(async u=>{let{stream_type:h}=u;const m=h===ln.Audio?Ve.AUDIO:Ve.VIDEO;await this._p2pChannel.unsubscribe(l,m),this._handleMuteStream(a,m,!0)}),t()}catch(u){n(u)}}}),this._gateway.signal.on(yr.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case Md.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Ve.VIDEO,!0);break;case Md.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Ve.AUDIO,!0);break;case Md.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Ve.VIDEO,!1);break;case Md.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Ve.AUDIO,!1)}}),this._gateway.signal.on(yr.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:a}=e;i!==hi.SEND_ONLY||a?t(await this._p2pChannel.restartICE(i,a)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}}),this._gateway.signal.on(yr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(Xe.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(yr.RESTART_ICE,e,i===hi.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Xe.LocalCandidate,e=>{this._gateway.sendExtensionMessage(yr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Xe.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(yr.CONTROL,e,!0),t()}catch(i){n(i)}}),this._p2pChannel.on(Xe.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===U.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Xe.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===U.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Xe.StateChange,(e,t)=>{t===nn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Xe.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(At.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Xe.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===U.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Xe.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===U.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Xe.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Xe.RequestRePublishDataChannel,(e,t,n)=>{Ne.all(e.map(async i=>{const a=await this._p2pChannel.publishDataChannel([i]);try{a.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==U.DISCONNECT_P2P)throw l}})).then(t).catch(n)}),this._p2pChannel.on(Xe.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:a}of e)a===Ve.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Xe.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Xe.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Xe.MediaReconnectStart,e=>{this.safeEmit(At.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Xe.MediaReconnectEnd,e=>{this.safeEmit(At.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Xe.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Xe.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let a;try{a=await this._gateway.restartICE({iceParameters:i})}catch(u){return void t.throw(u)}const{iceParameters:l}=function(u){const h=u.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(a);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(Xe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Xe.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:a,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),u=I3(a,l);await this._p2pChannel.connect(u),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Xe.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Xe.P2PLost,()=>{this.safeEmit(At.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Xe.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Xe.ConnectionTypeChange,e=>{this.safeEmit(At.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(Xe.FirstVideoBufferReady,(e,t)=>{this.safeEmit(At.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(Xe.FirstVideoPreRender,(e,t)=>{this.safeEmit(At.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(Xe.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Xe.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Xe.AudioMetadata,e=>{this.safeEmit(At.AUDIO_METADATA,e)}),this._p2pChannel.on(Xe.AudioPts,e=>{this.safeEmit(At.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},tc("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:a,sid:l,token:u,uid:h,cid:m,vid:g}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:a,sid:l,token:u,uid:h,cid:m,vid:g?Number(g):0},Cr)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(os.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(At.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===yo.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(At.CONTENT_INSPECT_ERROR,new re(U.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(os.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===U.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return w.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(At.CONTENT_INSPECT_RESULT,t,n)}),e.on(os.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(fo(e,"enabled"),e){if(!t)throw new re(U.INVALID_PARAMS,"config is required");if(W5(t),!this._joinInfo)throw new re(U.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},tc("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:a,cname:l,sid:u,token:h,uid:m,cid:g,vid:_}=this._joinInfo;await i.init({appId:a,areaCode:"",cname:l,sid:u,token:h,uid:m,cid:g,vid:_?Number(_):0},Cr)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new re(U.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(ec.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(At.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===Ba.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new re(U.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(ec.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){wr(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new re(U.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,w.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return w.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){fo(e,"enabled"),hn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ae(Ue.prototype,"leave",[H5],Object.getOwnPropertyDescriptor(Ue.prototype,"leave"),Ue.prototype),Ae(Ue.prototype,"publish",[K5],Object.getOwnPropertyDescriptor(Ue.prototype,"publish"),Ue.prototype),Ae(Ue.prototype,"unpublish",[z5],Object.getOwnPropertyDescriptor(Ue.prototype,"unpublish"),Ue.prototype),Ae(Ue.prototype,"subscribe",[q5],Object.getOwnPropertyDescriptor(Ue.prototype,"subscribe"),Ue.prototype),Ae(Ue.prototype,"presubscribe",[Y5],Object.getOwnPropertyDescriptor(Ue.prototype,"presubscribe"),Ue.prototype),Ae(Ue.prototype,"massSubscribe",[X5],Object.getOwnPropertyDescriptor(Ue.prototype,"massSubscribe"),Ue.prototype),Ae(Ue.prototype,"unsubscribe",[Q5],Object.getOwnPropertyDescriptor(Ue.prototype,"unsubscribe"),Ue.prototype),Ae(Ue.prototype,"massUnsubscribe",[J5],Object.getOwnPropertyDescriptor(Ue.prototype,"massUnsubscribe"),Ue.prototype),Ae(Ue.prototype,"setLowStreamParameter",[$5],Object.getOwnPropertyDescriptor(Ue.prototype,"setLowStreamParameter"),Ue.prototype),Ae(Ue.prototype,"setDualStreamMode",[Z5],Object.getOwnPropertyDescriptor(Ue.prototype,"setDualStreamMode"),Ue.prototype),Ae(Ue.prototype,"enableDualStream",[e6],Object.getOwnPropertyDescriptor(Ue.prototype,"enableDualStream"),Ue.prototype),Ae(Ue.prototype,"disableDualStream",[t6],Object.getOwnPropertyDescriptor(Ue.prototype,"disableDualStream"),Ue.prototype),Ae(Ue.prototype,"setClientRole",[n6],Object.getOwnPropertyDescriptor(Ue.prototype,"setClientRole"),Ue.prototype),Ae(Ue.prototype,"_setClientRoleOptions",[r6],Object.getOwnPropertyDescriptor(Ue.prototype,"_setClientRoleOptions"),Ue.prototype),Ae(Ue.prototype,"setProxyServer",[s6],Object.getOwnPropertyDescriptor(Ue.prototype,"setProxyServer"),Ue.prototype),Ae(Ue.prototype,"setTurnServer",[i6],Object.getOwnPropertyDescriptor(Ue.prototype,"setTurnServer"),Ue.prototype),Ae(Ue.prototype,"setLicense",[a6],Object.getOwnPropertyDescriptor(Ue.prototype,"setLicense"),Ue.prototype),Ae(Ue.prototype,"startProxyServer",[o6],Object.getOwnPropertyDescriptor(Ue.prototype,"startProxyServer"),Ue.prototype),Ae(Ue.prototype,"stopProxyServer",[c6],Object.getOwnPropertyDescriptor(Ue.prototype,"stopProxyServer"),Ue.prototype),Ae(Ue.prototype,"setLocalAccessPointsV2",[l6],Object.getOwnPropertyDescriptor(Ue.prototype,"setLocalAccessPointsV2"),Ue.prototype),Ae(Ue.prototype,"setLocalAccessPoints",[d6],Object.getOwnPropertyDescriptor(Ue.prototype,"setLocalAccessPoints"),Ue.prototype),Ae(Ue.prototype,"setRemoteDefaultVideoStreamType",[u6],Object.getOwnPropertyDescriptor(Ue.prototype,"setRemoteDefaultVideoStreamType"),Ue.prototype),Ae(Ue.prototype,"setRemoteVideoStreamType",[h6],Object.getOwnPropertyDescriptor(Ue.prototype,"setRemoteVideoStreamType"),Ue.prototype),Ae(Ue.prototype,"setStreamFallbackOption",[p6],Object.getOwnPropertyDescriptor(Ue.prototype,"setStreamFallbackOption"),Ue.prototype),Ae(Ue.prototype,"setEncryptionConfig",[m6],Object.getOwnPropertyDescriptor(Ue.prototype,"setEncryptionConfig"),Ue.prototype),Ae(Ue.prototype,"renewToken",[f6],Object.getOwnPropertyDescriptor(Ue.prototype,"renewToken"),Ue.prototype),Ae(Ue.prototype,"enableAudioVolumeIndicator",[g6],Object.getOwnPropertyDescriptor(Ue.prototype,"enableAudioVolumeIndicator"),Ue.prototype),Ae(Ue.prototype,"startLiveStreaming",[_6],Object.getOwnPropertyDescriptor(Ue.prototype,"startLiveStreaming"),Ue.prototype),Ae(Ue.prototype,"setLiveTranscoding",[E6],Object.getOwnPropertyDescriptor(Ue.prototype,"setLiveTranscoding"),Ue.prototype),Ae(Ue.prototype,"stopLiveStreaming",[v6],Object.getOwnPropertyDescriptor(Ue.prototype,"stopLiveStreaming"),Ue.prototype),Ae(Ue.prototype,"startChannelMediaRelay",[y6],Object.getOwnPropertyDescriptor(Ue.prototype,"startChannelMediaRelay"),Ue.prototype),Ae(Ue.prototype,"updateChannelMediaRelay",[S6],Object.getOwnPropertyDescriptor(Ue.prototype,"updateChannelMediaRelay"),Ue.prototype),Ae(Ue.prototype,"stopChannelMediaRelay",[T6],Object.getOwnPropertyDescriptor(Ue.prototype,"stopChannelMediaRelay"),Ue.prototype),Ae(Ue.prototype,"sendCustomReportMessage",[b6],Object.getOwnPropertyDescriptor(Ue.prototype,"sendCustomReportMessage"),Ue.prototype),Ae(Ue.prototype,"pickSVCLayer",[w6],Object.getOwnPropertyDescriptor(Ue.prototype,"pickSVCLayer"),Ue.prototype),Ae(Ue.prototype,"setRTMConfig",[C6],Object.getOwnPropertyDescriptor(Ue.prototype,"setRTMConfig"),Ue.prototype),Ae(Ue.prototype,"enableContentInspect",[R6],Object.getOwnPropertyDescriptor(Ue.prototype,"enableContentInspect"),Ue.prototype),Ae(Ue.prototype,"disableContentInspect",[x6],Object.getOwnPropertyDescriptor(Ue.prototype,"disableContentInspect"),Ue.prototype),Ae(Ue.prototype,"setImageModeration",[N6],Object.getOwnPropertyDescriptor(Ue.prototype,"setImageModeration"),Ue.prototype),Ae(Ue.prototype,"setP2PTransport",[I6],Object.getOwnPropertyDescriptor(Ue.prototype,"setP2PTransport"),Ue.prototype),Ae(Ue.prototype,"getJoinChannelServiceRecords",[A6],Object.getOwnPropertyDescriptor(Ue.prototype,"getJoinChannelServiceRecords"),Ue.prototype),Ae(Ue.prototype,"setPublishAudioFilterEnabled",[O6],Object.getOwnPropertyDescriptor(Ue.prototype,"setPublishAudioFilterEnabled"),Ue.prototype),Ue);function D6(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=on(5,"client-"),i=Be.reportApiInvoke(null,{id:n,name:Vn.CREATE_CLIENT,options:[t],tag:gn.TRACER});try{(function(a){wr(a.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),wr(a.mode,"config.mode",["rtc","live","p2p"]),a.audioCodec!==void 0&&wr(a.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),a.proxyServer!==void 0&&Es(a.proxyServer,"config.proxyServer",1,1e4),a.turnServer!==void 0&&uF(a.turnServer),a.httpRetryConfig!==void 0&&dF(a.httpRetryConfig),a.websocketRetryConfig!==void 0&&dF(a.websocketRetryConfig)})(t)}catch(a){throw i.onError(a),a}return(JV(16,0)||qx(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",w.debug("browser not support vp9, force use vp8")),hn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new mEe(Co(Co({forceWaitGatewayResponse:!0},t),{},{role:Ee(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)}function fEe(){let e=!1;const t=qt();return(t.name===Qt.CHROME&&Number(t.version)>=58&&(Xo.engine.name!=="WebKit"||function(){const n=qt();if(xS()){if(n.os===zr.MAC_OS)return!0;if(n.os===zr.IOS){const i=Xo.os.version&&Xo.os.version.split(".");if(i&&Number(i[0])===14&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}())||t.name===Qt.FIREFOX&&Number(t.version)>=56||t.name===Qt.OPERA&&Number(t.version)>=45||t.name===Qt.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(Ws()||mo())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||eF()||qt().name===Qt.QQ)&&(e=!0),e}class K_{constructor(t,n){O(this,"id",0),O(this,"element",void 0),O(this,"peerPair",void 0),O(this,"context",void 0),O(this,"audioPlayerElement",void 0),O(this,"audioTrack",void 0),K_.count+=1,this.id=K_.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,a)=>{const l=a==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(l),i.iceGatheringState==="complete"?i.localDescription:new Ne(u=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&u(i.localDescription)}})},n=async(i,a)=>await i.setRemoteDescription(a);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const a=await t(this.peerPair[1],"answer");await n(this.peerPair[0],a)}catch(i){throw new re(U.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(a){throw new re(U.LOCAL_AEC_ERROR,a.toString()).print()}if(!n)throw new re(U.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){w.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var k6,O0;O(K_,"count",0);const gEe=window.AudioContext||window.webkitAudioContext,_Ee=new(k6=st({report:Be}),Ae((O0=class{constructor(){O(this,"units",[]),O(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return w.debug("the system does not need to process local aec"),-1;this.context||(this.context=new gEe);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new K_(e,this.context),this.units.push(t)),t.startEchoCancellation(),w.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qt().name!==Qt.SAFARI}}).prototype,"processExternalMediaAEC",[k6],Object.getOwnPropertyDescriptor(O0.prototype,"processExternalMediaAEC"),O0.prototype),O0);function L6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function j6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?L6(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L6(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const FI=window||document;function M6(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!FI)return;const n=Dr._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=a=>{if(!(a&&a.blockedURI&&(Dr.onSecurityPolicyViolation||Dr.getListeners(Yc.SECURITY_POLICY_VIOLATION).length>0)))return;const l=a.blockedURI;j("CSP_DETECTED_HOSTNAME_LIST").some(u=>Ee(l).call(l,u))&&(Dr.onSecurityPolicyViolation&&typeof Dr.onSecurityPolicyViolation=="function"&&Dr.onSecurityPolicyViolation(a),Dr.getListeners(Yc.SECURITY_POLICY_VIOLATION).length>0&&Dr.safeEmit(Yc.SECURITY_POLICY_VIOLATION,a))};n&&FI.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Dr.getListeners(Yc.SECURITY_POLICY_VIOLATION).length>0)&&FI.addEventListener("securitypolicyviolation",i),Dr._cspEventHandlerPointer=i}var EEe=k,vEe=ZR,U6=RegExp.prototype,yEe=function(e){return e===U6||EEe(U6,e)?vEe(e):e.flags},$s=p(yEe);function $m(e){let t=e.length;for(;--t>=0;)e[t]=0}const BI=256,V6=286,z_=30,q_=15,GI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),P0=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),SEe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),F6=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wl=new Array(576);$m(Wl);const Y_=new Array(60);$m(Y_);const X_=new Array(512);$m(X_);const Q_=new Array(256);$m(Q_);const WI=new Array(29);$m(WI);const D0=new Array(z_);function HI(e,t,n,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}let B6,G6,W6;function KI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}$m(D0);const H6=e=>e<256?X_[e]:X_[256+(e>>>7)],J_=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ba=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,J_(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},el=(e,t,n)=>{ba(e,n[2*t],n[2*t+1])},K6=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},z6=(e,t,n)=>{const i=new Array(16);let a,l,u=0;for(a=1;a<=q_;a++)u=u+n[a-1]<<1,i[a]=u;for(l=0;l<=t;l++){let h=e[2*l+1];h!==0&&(e[2*l]=K6(i[h]++,h))}},q6=e=>{let t;for(t=0;t<V6;t++)e.dyn_ltree[2*t]=0;for(t=0;t<z_;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Y6=e=>{e.bi_valid>8?J_(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},X6=(e,t,n,i)=>{const a=2*t,l=2*n;return e[a]<e[l]||e[a]===e[l]&&i[t]<=i[n]},zI=(e,t,n)=>{const i=e.heap[n];let a=n<<1;for(;a<=e.heap_len&&(a<e.heap_len&&X6(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!X6(t,i,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=i},Q6=(e,t,n)=>{let i,a,l,u,h=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+h++],i+=(255&e.pending_buf[e.sym_buf+h++])<<8,a=e.pending_buf[e.sym_buf+h++],i===0?el(e,a,t):(l=Q_[a],el(e,l+BI+1,t),u=GI[l],u!==0&&(a-=WI[l],ba(e,a,u)),i--,l=H6(i),el(e,l,n),u=P0[l],u!==0&&(i-=D0[l],ba(e,i,u)));while(h<e.sym_next);el(e,256,t)},qI=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems;let u,h,m,g=-1;for(e.heap_len=0,e.heap_max=573,u=0;u<l;u++)n[2*u]!==0?(e.heap[++e.heap_len]=g=u,e.depth[u]=0):n[2*u+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=g<2?++g:0,n[2*m]=1,e.depth[m]=0,e.opt_len--,a&&(e.static_len-=i[2*m+1]);for(t.max_code=g,u=e.heap_len>>1;u>=1;u--)zI(e,n,u);m=l;do u=e.heap[1],e.heap[1]=e.heap[e.heap_len--],zI(e,n,1),h=e.heap[1],e.heap[--e.heap_max]=u,e.heap[--e.heap_max]=h,n[2*m]=n[2*u]+n[2*h],e.depth[m]=(e.depth[u]>=e.depth[h]?e.depth[u]:e.depth[h])+1,n[2*u+1]=n[2*h+1]=m,e.heap[1]=m++,zI(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((_,v)=>{const S=v.dyn_tree,T=v.max_code,P=v.stat_desc.static_tree,x=v.stat_desc.has_stree,N=v.stat_desc.extra_bits,M=v.stat_desc.extra_base,F=v.stat_desc.max_length;let q,J,te,Y,ne,ue,fe=0;for(Y=0;Y<=q_;Y++)_.bl_count[Y]=0;for(S[2*_.heap[_.heap_max]+1]=0,q=_.heap_max+1;q<573;q++)J=_.heap[q],Y=S[2*S[2*J+1]+1]+1,Y>F&&(Y=F,fe++),S[2*J+1]=Y,J>T||(_.bl_count[Y]++,ne=0,J>=M&&(ne=N[J-M]),ue=S[2*J],_.opt_len+=ue*(Y+ne),x&&(_.static_len+=ue*(P[2*J+1]+ne)));if(fe!==0){do{for(Y=F-1;_.bl_count[Y]===0;)Y--;_.bl_count[Y]--,_.bl_count[Y+1]+=2,_.bl_count[F]--,fe-=2}while(fe>0);for(Y=F;Y!==0;Y--)for(J=_.bl_count[Y];J!==0;)te=_.heap[--q],te>T||(S[2*te+1]!==Y&&(_.opt_len+=(Y-S[2*te+1])*S[2*te],S[2*te+1]=Y),J--)}})(e,t),z6(n,g,e.bl_count)},J6=(e,t,n)=>{let i,a,l=-1,u=t[1],h=0,m=7,g=4;for(u===0&&(m=138,g=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)a=u,u=t[2*(i+1)+1],++h<m&&a===u||(h<g?e.bl_tree[2*a]+=h:a!==0?(a!==l&&e.bl_tree[2*a]++,e.bl_tree[32]++):h<=10?e.bl_tree[34]++:e.bl_tree[36]++,h=0,l=a,u===0?(m=138,g=3):a===u?(m=6,g=3):(m=7,g=4))},$6=(e,t,n)=>{let i,a,l=-1,u=t[1],h=0,m=7,g=4;for(u===0&&(m=138,g=3),i=0;i<=n;i++)if(a=u,u=t[2*(i+1)+1],!(++h<m&&a===u)){if(h<g)do el(e,a,e.bl_tree);while(--h!=0);else a!==0?(a!==l&&(el(e,a,e.bl_tree),h--),el(e,16,e.bl_tree),ba(e,h-3,2)):h<=10?(el(e,17,e.bl_tree),ba(e,h-3,3)):(el(e,18,e.bl_tree),ba(e,h-11,7));h=0,l=a,u===0?(m=138,g=3):a===u?(m=6,g=3):(m=7,g=4)}};let Z6=!1;const eG=(e,t,n,i)=>{ba(e,0+(i?1:0),3),Y6(e),J_(e,n),J_(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var TEe=e=>{Z6||((()=>{let t,n,i,a,l;const u=new Array(16);for(i=0,a=0;a<28;a++)for(WI[a]=i,t=0;t<1<<GI[a];t++)Q_[i++]=a;for(Q_[i-1]=a,l=0,a=0;a<16;a++)for(D0[a]=l,t=0;t<1<<P0[a];t++)X_[l++]=a;for(l>>=7;a<z_;a++)for(D0[a]=l<<7,t=0;t<1<<P0[a]-7;t++)X_[256+l++]=a;for(n=0;n<=q_;n++)u[n]=0;for(t=0;t<=143;)Wl[2*t+1]=8,t++,u[8]++;for(;t<=255;)Wl[2*t+1]=9,t++,u[9]++;for(;t<=279;)Wl[2*t+1]=7,t++,u[7]++;for(;t<=287;)Wl[2*t+1]=8,t++,u[8]++;for(z6(Wl,287,u),t=0;t<z_;t++)Y_[2*t+1]=5,Y_[2*t]=K6(t,5);B6=new HI(Wl,GI,257,V6,q_),G6=new HI(Y_,P0,0,z_,q_),W6=new HI(new Array(0),SEe,0,19,7)})(),Z6=!0),e.l_desc=new KI(e.dyn_ltree,B6),e.d_desc=new KI(e.dyn_dtree,G6),e.bl_desc=new KI(e.bl_tree,W6),e.bi_buf=0,e.bi_valid=0,q6(e)},bEe=(e,t,n,i)=>{let a,l,u=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(h=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&h.dyn_ltree[2*m]!==0)return 0;if(h.dyn_ltree[18]!==0||h.dyn_ltree[20]!==0||h.dyn_ltree[26]!==0)return 1;for(m=32;m<BI;m++)if(h.dyn_ltree[2*m]!==0)return 1;return 0})(e)),qI(e,e.l_desc),qI(e,e.d_desc),u=(h=>{let m;for(J6(h,h.dyn_ltree,h.l_desc.max_code),J6(h,h.dyn_dtree,h.d_desc.max_code),qI(h,h.bl_desc),m=18;m>=3&&h.bl_tree[2*F6[m]+1]===0;m--);return h.opt_len+=3*(m+1)+5+5+4,m})(e),a=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=a&&(a=l)):a=l=n+5,n+4<=a&&t!==-1?eG(e,t,n,i):e.strategy===4||l===a?(ba(e,2+(i?1:0),3),Q6(e,Wl,Y_)):(ba(e,4+(i?1:0),3),((h,m,g,_)=>{let v;for(ba(h,m-257,5),ba(h,g-1,5),ba(h,_-4,4),v=0;v<_;v++)ba(h,h.bl_tree[2*F6[v]+1],3);$6(h,h.dyn_ltree,m-1),$6(h,h.dyn_dtree,g-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),Q6(e,e.dyn_ltree,e.dyn_dtree)),q6(e),i&&Y6(e)},wEe=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Q_[n]+BI+1)]++,e.dyn_dtree[2*H6(t)]++),e.sym_next===e.sym_end),CEe=e=>{ba(e,2,3),el(e,256,Wl),(t=>{t.bi_valid===16?(J_(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},REe={_tr_init:TEe,_tr_stored_block:eG,_tr_flush_block:bEe,_tr_tally:wEe,_tr_align:CEe},$_=(e,t,n,i)=>{let a=65535&e|0,l=e>>>16&65535|0,u=0;for(;n!==0;){u=n>2e3?2e3:n,n-=u;do a=a+t[i++]|0,l=l+a|0;while(--u);a%=65521,l%=65521}return a|l<<16|0};const xEe=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var pi=(e,t,n,i)=>{const a=xEe,l=i+n;e^=-1;for(let u=i;u<l;u++)e=e>>>8^a[255&(e^t[u])];return-1^e},Ph={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Zm={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:NEe,_tr_stored_block:YI,_tr_flush_block:IEe,_tr_tally:Hd,_tr_align:AEe}=REe,{Z_NO_FLUSH:Kd,Z_PARTIAL_FLUSH:OEe,Z_FULL_FLUSH:PEe,Z_FINISH:Ro,Z_BLOCK:tG,Z_OK:Ri,Z_STREAM_END:nG,Z_STREAM_ERROR:tl,Z_DATA_ERROR:DEe,Z_BUF_ERROR:XI,Z_DEFAULT_COMPRESSION:kEe,Z_FILTERED:LEe,Z_HUFFMAN_ONLY:k0,Z_RLE:jEe,Z_FIXED:MEe,Z_DEFAULT_STRATEGY:UEe,Z_UNKNOWN:VEe,Z_DEFLATED:L0}=Zm,QI=286,FEe=30,BEe=19,GEe=2*QI+1,WEe=15,Dh=258,nl=262,ef=42,kh=113,Z_=666,Lh=(e,t)=>(e.msg=Ph[t],t),rG=e=>2*e-(e>4?9:0),zd=e=>{let t=e.length;for(;--t>=0;)e[t]=0},HEe=e=>{let t,n,i,a=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=a?n-a:0;while(--t);t=a,i=t;do n=e.prev[--i],e.prev[i]=n>=a?n-a:0;while(--t)};let qd=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Ga=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Wa=(e,t)=>{IEe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ga(e.strm)},Er=(e,t)=>{e.pending_buf[e.pending++]=t},eE=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},JI=(e,t,n,i)=>{let a=e.avail_in;return a>i&&(a=i),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),n),e.state.wrap===1?e.adler=$_(e.adler,t,a,n):e.state.wrap===2&&(e.adler=pi(e.adler,t,a,n)),e.next_in+=a,e.total_in+=a,a)},sG=(e,t)=>{let n,i,a=e.max_chain_length,l=e.strstart,u=e.prev_length,h=e.nice_match;const m=e.strstart>e.w_size-nl?e.strstart-(e.w_size-nl):0,g=e.window,_=e.w_mask,v=e.prev,S=e.strstart+Dh;let T=g[l+u-1],P=g[l+u];e.prev_length>=e.good_match&&(a>>=2),h>e.lookahead&&(h=e.lookahead);do if(n=t,g[n+u]===P&&g[n+u-1]===T&&g[n]===g[l]&&g[++n]===g[l+1]){l+=2,n++;do;while(g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&l<S);if(i=Dh-(S-l),l=S-Dh,i>u){if(e.match_start=t,u=i,i>=h)break;T=g[l+u-1],P=g[l+u]}}while((t=v[t&_])>m&&--a!=0);return u<=e.lookahead?u:e.lookahead},tf=e=>{const t=e.w_size;let n,i,a;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-nl)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),HEe(e),i+=t),e.strm.avail_in===0)break;if(n=JI(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=qd(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=qd(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<nl&&e.strm.avail_in!==0)},iG=(e,t)=>{let n,i,a,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,u=0,h=e.strm.avail_in;do{if(n=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a||(a=e.strm.avail_out-a,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>a&&(n=a),n<l&&(n===0&&t!==Ro||t===Kd||n!==i+e.strm.avail_in)))break;u=t===Ro&&n===i+e.strm.avail_in?1:0,YI(e,0,0,u),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Ga(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(JI(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(u===0);return h-=e.strm.avail_in,h&&(h>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=h&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-h,e.strm.next_in),e.strstart),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),u?4:t!==Kd&&t!==Ro&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(JI(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,l=a>e.w_size?e.w_size:a,i=e.strstart-e.block_start,(i>=l||(i||t===Ro)&&t!==Kd&&e.strm.avail_in===0&&i<=a)&&(n=i>a?a:i,u=t===Ro&&e.strm.avail_in===0&&n===i?1:0,YI(e,e.block_start,n,u),e.block_start+=n,Ga(e.strm)),u?3:1)},$I=(e,t)=>{let n,i;for(;;){if(e.lookahead<nl){if(tf(e),e.lookahead<nl&&t===Kd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=qd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-nl&&(e.match_length=sG(e,n)),e.match_length>=3)if(i=Hd(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=qd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=qd(e,e.ins_h,e.window[e.strstart+1]);else i=Hd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Wa(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ro?(Wa(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Wa(e,!1),e.strm.avail_out===0)?1:2},nf=(e,t)=>{let n,i,a;for(;;){if(e.lookahead<nl){if(tf(e),e.lookahead<nl&&t===Kd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=qd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-nl&&(e.match_length=sG(e,n),e.match_length<=5&&(e.strategy===LEe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,i=Hd(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=qd(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Wa(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=Hd(e,0,e.window[e.strstart-1]),i&&Wa(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Hd(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ro?(Wa(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Wa(e,!1),e.strm.avail_out===0)?1:2};function rl(e,t,n,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=a}const tE=[new rl(0,0,0,0,iG),new rl(4,4,8,4,$I),new rl(4,5,16,8,$I),new rl(4,6,32,32,$I),new rl(4,4,16,16,nf),new rl(8,16,32,32,nf),new rl(8,16,128,128,nf),new rl(8,32,128,256,nf),new rl(32,128,258,1024,nf),new rl(32,258,258,4096,nf)];function KEe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=L0,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*GEe),this.dyn_dtree=new Uint16Array(2*(2*FEe+1)),this.bl_tree=new Uint16Array(2*(2*BEe+1)),zd(this.dyn_ltree),zd(this.dyn_dtree),zd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(WEe+1),this.heap=new Uint16Array(2*QI+1),zd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*QI+1),zd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const nE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==ef&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==kh&&t.status!==Z_?1:0},aG=e=>{if(nE(e))return Lh(e,tl);e.total_in=e.total_out=0,e.data_type=VEe;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?ef:kh,e.adler=t.wrap===2?0:1,t.last_flush=-2,NEe(t),Ri},oG=e=>{const t=aG(e);return t===Ri&&(n=>{n.window_size=2*n.w_size,zd(n.head),n.max_lazy_match=tE[n.level].max_lazy,n.good_match=tE[n.level].good_length,n.nice_match=tE[n.level].nice_length,n.max_chain_length=tE[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},cG=(e,t,n,i,a,l)=>{if(!e)return tl;let u=1;if(t===kEe&&(t=6),i<0?(u=0,i=-i):i>15&&(u=2,i-=16),a<1||a>9||n!==L0||i<8||i>15||t<0||t>9||l<0||l>MEe||i===8&&u!==1)return Lh(e,tl);i===8&&(i=9);const h=new KEe;return e.state=h,h.strm=e,h.status=ef,h.wrap=u,h.gzhead=null,h.w_bits=i,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=a+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<a+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=3*(h.lit_bufsize-1),h.level=t,h.strategy=l,h.method=n,oG(e)};var zEe=(e,t)=>{if(nE(e)||t>tG||t<0)return e?Lh(e,tl):tl;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Z_&&t!==Ro)return Lh(e,e.avail_out===0?XI:tl);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(Ga(e),e.avail_out===0)return n.last_flush=-1,Ri}else if(e.avail_in===0&&rG(t)<=rG(i)&&t!==Ro)return Lh(e,XI);if(n.status===Z_&&e.avail_in!==0)return Lh(e,XI);if(n.status===ef&&n.wrap===0&&(n.status=kh),n.status===ef){let a=L0+(n.w_bits-8<<4)<<8,l=-1;if(l=n.strategy>=k0||n.level<2?0:n.level<6?1:n.level===6?2:3,a|=l<<6,n.strstart!==0&&(a|=32),a+=31-a%31,eE(n,a),n.strstart!==0&&(eE(n,e.adler>>>16),eE(n,65535&e.adler)),e.adler=1,n.status=kh,Ga(e),n.pending!==0)return n.last_flush=-1,Ri}if(n.status===57){if(e.adler=0,Er(n,31),Er(n,139),Er(n,8),n.gzhead)Er(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Er(n,255&n.gzhead.time),Er(n,n.gzhead.time>>8&255),Er(n,n.gzhead.time>>16&255),Er(n,n.gzhead.time>>24&255),Er(n,n.level===9?2:n.strategy>=k0||n.level<2?4:0),Er(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Er(n,255&n.gzhead.extra.length),Er(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=pi(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Er(n,0),Er(n,0),Er(n,0),Er(n,0),Er(n,0),Er(n,n.level===9?2:n.strategy>=k0||n.level<2?4:0),Er(n,3),n.status=kh,Ga(e),n.pending!==0)return n.last_flush=-1,Ri}if(n.status===69){if(n.gzhead.extra){let a=n.pending,l=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+l>n.pending_buf_size;){let h=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+h),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>a&&(e.adler=pi(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex+=h,Ga(e),n.pending!==0)return n.last_flush=-1,Ri;a=0,l-=h}let u=new Uint8Array(n.gzhead.extra);n.pending_buf.set(u.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending+=l,n.gzhead.hcrc&&n.pending>a&&(e.adler=pi(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let a,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=pi(e.adler,n.pending_buf,n.pending-l,l)),Ga(e),n.pending!==0)return n.last_flush=-1,Ri;l=0}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Er(n,a)}while(a!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=pi(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let a,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=pi(e.adler,n.pending_buf,n.pending-l,l)),Ga(e),n.pending!==0)return n.last_flush=-1,Ri;l=0}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Er(n,a)}while(a!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=pi(e.adler,n.pending_buf,n.pending-l,l))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Ga(e),n.pending!==0))return n.last_flush=-1,Ri;Er(n,255&e.adler),Er(n,e.adler>>8&255),e.adler=0}if(n.status=kh,Ga(e),n.pending!==0)return n.last_flush=-1,Ri}if(e.avail_in!==0||n.lookahead!==0||t!==Kd&&n.status!==Z_){let a=n.level===0?iG(n,t):n.strategy===k0?((l,u)=>{let h;for(;;){if(l.lookahead===0&&(tf(l),l.lookahead===0)){if(u===Kd)return 1;break}if(l.match_length=0,h=Hd(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,h&&(Wa(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,u===Ro?(Wa(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(Wa(l,!1),l.strm.avail_out===0)?1:2})(n,t):n.strategy===jEe?((l,u)=>{let h,m,g,_;const v=l.window;for(;;){if(l.lookahead<=Dh){if(tf(l),l.lookahead<=Dh&&u===Kd)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(g=l.strstart-1,m=v[g],m===v[++g]&&m===v[++g]&&m===v[++g])){_=l.strstart+Dh;do;while(m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&m===v[++g]&&g<_);l.match_length=Dh-(_-g),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(h=Hd(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(h=Hd(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),h&&(Wa(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,u===Ro?(Wa(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(Wa(l,!1),l.strm.avail_out===0)?1:2})(n,t):tE[n.level].func(n,t);if(a!==3&&a!==4||(n.status=Z_),a===1||a===3)return e.avail_out===0&&(n.last_flush=-1),Ri;if(a===2&&(t===OEe?AEe(n):t!==tG&&(YI(n,0,0,!1),t===PEe&&(zd(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Ga(e),e.avail_out===0))return n.last_flush=-1,Ri}return t!==Ro?Ri:n.wrap<=0?nG:(n.wrap===2?(Er(n,255&e.adler),Er(n,e.adler>>8&255),Er(n,e.adler>>16&255),Er(n,e.adler>>24&255),Er(n,255&e.total_in),Er(n,e.total_in>>8&255),Er(n,e.total_in>>16&255),Er(n,e.total_in>>24&255)):(eE(n,e.adler>>>16),eE(n,65535&e.adler)),Ga(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Ri:nG)},qEe=(e,t)=>{let n=t.length;if(nE(e))return tl;const i=e.state,a=i.wrap;if(a===2||a===1&&i.status!==ef||i.lookahead)return tl;if(a===1&&(e.adler=$_(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){a===0&&(zd(i.head),i.strstart=0,i.block_start=0,i.insert=0);let m=new Uint8Array(i.w_size);m.set(t.subarray(n-i.w_size,n),0),t=m,n=i.w_size}const l=e.avail_in,u=e.next_in,h=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,tf(i);i.lookahead>=3;){let m=i.strstart,g=i.lookahead-2;do i.ins_h=qd(i,i.ins_h,i.window[m+3-1]),i.prev[m&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=m,m++;while(--g);i.strstart=m,i.lookahead=2,tf(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=u,e.input=h,e.avail_in=l,i.wrap=a,Ri},rE={deflateInit:(e,t)=>cG(e,t,L0,15,8,UEe),deflateInit2:cG,deflateReset:oG,deflateResetKeep:aG,deflateSetHeader:(e,t)=>nE(e)||e.state.wrap!==2?tl:(e.state.gzhead=t,Ri),deflate:zEe,deflateEnd:e=>{if(nE(e))return tl;const t=e.state.status;return e.state=null,t===kh?Lh(e,DEe):Ri},deflateSetDictionary:qEe,deflateInfo:"pako deflate (from Nodeca project)"};const YEe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var j0={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)YEe(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,a=e.length;i<a;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,a=0,l=e.length;i<l;i++){let u=e[i];n.set(u,a),a+=u.length}return n}};let lG=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{lG=!1}const sE=new Uint8Array(256);for(let e=0;e<256;e++)sE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;sE[254]=sE[254]=1;var iE={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,a,l,u=e.length,h=0;for(a=0;a<u;a++)n=e.charCodeAt(a),(64512&n)==55296&&a+1<u&&(i=e.charCodeAt(a+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),a++)),h+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(h),l=0,a=0;l<h;a++)n=e.charCodeAt(a),(64512&n)==55296&&a+1<u&&(i=e.charCodeAt(a+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),a++)),n<128?t[l++]=n:n<2048?(t[l++]=192|n>>>6,t[l++]=128|63&n):n<65536?(t[l++]=224|n>>>12,t[l++]=128|n>>>6&63,t[l++]=128|63&n):(t[l++]=240|n>>>18,t[l++]=128|n>>>12&63,t[l++]=128|n>>>6&63,t[l++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,a;const l=new Array(2*n);for(a=0,i=0;i<n;){let u=e[i++];if(u<128){l[a++]=u;continue}let h=sE[u];if(h>4)l[a++]=65533,i+=h-1;else{for(u&=h===2?31:h===3?15:7;h>1&&i<n;)u=u<<6|63&e[i++],h--;h>1?l[a++]=65533:u<65536?l[a++]=u:(u-=65536,l[a++]=55296|u>>10&1023,l[a++]=56320|1023&u)}}return((u,h)=>{if(h<65534&&u.subarray&&lG)return String.fromCharCode.apply(null,u.length===h?u:u.subarray(0,h));let m="";for(let g=0;g<h;g++)m+=String.fromCharCode(u[g]);return m})(l,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+sE[e[n]]>t?n:t}},dG=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const uG=Object.prototype.toString,{Z_NO_FLUSH:XEe,Z_SYNC_FLUSH:QEe,Z_FULL_FLUSH:JEe,Z_FINISH:$Ee,Z_OK:M0,Z_STREAM_END:ZEe,Z_DEFAULT_COMPRESSION:eve,Z_DEFAULT_STRATEGY:tve,Z_DEFLATED:nve}=Zm;function aE(e){this.options=j0.assign({level:eve,method:nve,chunkSize:16384,windowBits:15,memLevel:8,strategy:tve},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dG,this.strm.avail_out=0;let n=rE.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==M0)throw new Error(Ph[n]);if(t.header&&rE.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?iE.string2buf(t.dictionary):uG.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=rE.deflateSetDictionary(this.strm,i),n!==M0)throw new Error(Ph[n]);this._dict_set=!0}}function ZI(e,t){const n=new aE(t);if(n.push(e,!0),n.err)throw n.msg||Ph[n.err];return n.result}aE.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let a,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?$Ee:XEe,typeof e=="string"?n.input=iE.string2buf(e):uG.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(l===QEe||l===JEe)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(a=rE.deflate(n,l),a===ZEe)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),a=rE.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===M0;if(n.avail_out!==0){if(l>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},aE.prototype.onData=function(e){this.chunks.push(e)},aE.prototype.onEnd=function(e){e===M0&&(this.result=j0.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rve={Deflate:aE,deflate:ZI,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ZI(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ZI(e,t)},constants:Zm};const U0=16209;var sve=function(e,t){let n,i,a,l,u,h,m,g,_,v,S,T,P,x,N,M,F,q,J,te,Y,ne,ue,fe;const Me=e.state;n=e.next_in,ue=e.input,i=n+(e.avail_in-5),a=e.next_out,fe=e.output,l=a-(t-e.avail_out),u=a+(e.avail_out-257),h=Me.dmax,m=Me.wsize,g=Me.whave,_=Me.wnext,v=Me.window,S=Me.hold,T=Me.bits,P=Me.lencode,x=Me.distcode,N=(1<<Me.lenbits)-1,M=(1<<Me.distbits)-1;e:do{T<15&&(S+=ue[n++]<<T,T+=8,S+=ue[n++]<<T,T+=8),F=P[S&N];t:for(;;){if(q=F>>>24,S>>>=q,T-=q,q=F>>>16&255,q===0)fe[a++]=65535&F;else{if(!(16&q)){if(!(64&q)){F=P[(65535&F)+(S&(1<<q)-1)];continue t}if(32&q){Me.mode=16191;break e}e.msg="invalid literal/length code",Me.mode=U0;break e}J=65535&F,q&=15,q&&(T<q&&(S+=ue[n++]<<T,T+=8),J+=S&(1<<q)-1,S>>>=q,T-=q),T<15&&(S+=ue[n++]<<T,T+=8,S+=ue[n++]<<T,T+=8),F=x[S&M];n:for(;;){if(q=F>>>24,S>>>=q,T-=q,q=F>>>16&255,!(16&q)){if(!(64&q)){F=x[(65535&F)+(S&(1<<q)-1)];continue n}e.msg="invalid distance code",Me.mode=U0;break e}if(te=65535&F,q&=15,T<q&&(S+=ue[n++]<<T,T+=8,T<q&&(S+=ue[n++]<<T,T+=8)),te+=S&(1<<q)-1,te>h){e.msg="invalid distance too far back",Me.mode=U0;break e}if(S>>>=q,T-=q,q=a-l,te>q){if(q=te-q,q>g&&Me.sane){e.msg="invalid distance too far back",Me.mode=U0;break e}if(Y=0,ne=v,_===0){if(Y+=m-q,q<J){J-=q;do fe[a++]=v[Y++];while(--q);Y=a-te,ne=fe}}else if(_<q){if(Y+=m+_-q,q-=_,q<J){J-=q;do fe[a++]=v[Y++];while(--q);if(Y=0,_<J){q=_,J-=q;do fe[a++]=v[Y++];while(--q);Y=a-te,ne=fe}}}else if(Y+=_-q,q<J){J-=q;do fe[a++]=v[Y++];while(--q);Y=a-te,ne=fe}for(;J>2;)fe[a++]=ne[Y++],fe[a++]=ne[Y++],fe[a++]=ne[Y++],J-=3;J&&(fe[a++]=ne[Y++],J>1&&(fe[a++]=ne[Y++]))}else{Y=a-te;do fe[a++]=fe[Y++],fe[a++]=fe[Y++],fe[a++]=fe[Y++],J-=3;while(J>2);J&&(fe[a++]=fe[Y++],J>1&&(fe[a++]=fe[Y++]))}break}}break}}while(n<i&&a<u);J=T>>3,n-=J,T-=J<<3,S&=(1<<T)-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<u?u-a+257:257-(a-u),Me.hold=S,Me.bits=T};const V0=15,ive=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ave=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ove=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),cve=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var oE=(e,t,n,i,a,l,u,h)=>{const m=h.bits;let g,_,v,S,T,P,x=0,N=0,M=0,F=0,q=0,J=0,te=0,Y=0,ne=0,ue=0,fe=null;const Me=new Uint16Array(16),ut=new Uint16Array(16);let ot,Ct,vt,Zt=null;for(x=0;x<=V0;x++)Me[x]=0;for(N=0;N<i;N++)Me[t[n+N]]++;for(q=m,F=V0;F>=1&&Me[F]===0;F--);if(q>F&&(q=F),F===0)return a[l++]=20971520,a[l++]=20971520,h.bits=1,0;for(M=1;M<F&&Me[M]===0;M++);for(q<M&&(q=M),Y=1,x=1;x<=V0;x++)if(Y<<=1,Y-=Me[x],Y<0)return-1;if(Y>0&&(e===0||F!==1))return-1;for(ut[1]=0,x=1;x<V0;x++)ut[x+1]=ut[x]+Me[x];for(N=0;N<i;N++)t[n+N]!==0&&(u[ut[t[n+N]]++]=N);if(e===0?(fe=Zt=u,P=20):e===1?(fe=ive,Zt=ave,P=257):(fe=ove,Zt=cve,P=0),ue=0,N=0,x=M,T=l,J=q,te=0,v=-1,ne=1<<q,S=ne-1,e===1&&ne>852||e===2&&ne>592)return 1;for(;;){ot=x-te,u[N]+1<P?(Ct=0,vt=u[N]):u[N]>=P?(Ct=Zt[u[N]-P],vt=fe[u[N]-P]):(Ct=96,vt=0),g=1<<x-te,_=1<<J,M=_;do _-=g,a[T+(ue>>te)+_]=ot<<24|Ct<<16|vt|0;while(_!==0);for(g=1<<x-1;ue&g;)g>>=1;if(g!==0?(ue&=g-1,ue+=g):ue=0,N++,--Me[x]==0){if(x===F)break;x=t[n+u[N]]}if(x>q&&(ue&S)!==v){for(te===0&&(te=q),T+=M,J=x-te,Y=1<<J;J+te<F&&(Y-=Me[J+te],!(Y<=0));)J++,Y<<=1;if(ne+=1<<J,e===1&&ne>852||e===2&&ne>592)return 1;v=ue&S,a[v]=q<<24|J<<16|T-l|0}}return ue!==0&&(a[T+ue]=x-te<<24|64<<16|0),h.bits=q,0};const{Z_FINISH:hG,Z_BLOCK:lve,Z_TREES:F0,Z_OK:jh,Z_STREAM_END:dve,Z_NEED_DICT:uve,Z_STREAM_ERROR:xo,Z_DATA_ERROR:pG,Z_MEM_ERROR:mG,Z_BUF_ERROR:hve,Z_DEFLATED:fG}=Zm,B0=16180,G0=16190,Hl=16191,eA=16192,tA=16194,W0=16199,H0=16200,nA=16206,ls=16209,gG=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function pve(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Mh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<B0||t.mode>16211?1:0},_G=e=>{if(Mh(e))return xo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=B0,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,jh},EG=e=>{if(Mh(e))return xo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,_G(e)},vG=(e,t)=>{let n;if(Mh(e))return xo;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?xo:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,EG(e))},yG=(e,t)=>{if(!e)return xo;const n=new pve;e.state=n,n.strm=e,n.window=null,n.mode=B0;const i=vG(e,t);return i!==jh&&(e.state=null),i};let rA,sA,SG=!0;const mve=e=>{if(SG){rA=new Int32Array(512),sA=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(oE(1,e.lens,0,288,rA,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;oE(2,e.lens,0,32,sA,0,e.work,{bits:5}),SG=!1}e.lencode=rA,e.lenbits=9,e.distcode=sA,e.distbits=5},TG=(e,t,n,i)=>{let a;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),i>=l.wsize?(l.window.set(t.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(a=l.wsize-l.wnext,a>i&&(a=i),l.window.set(t.subarray(n-i,n-i+a),l.wnext),(i-=a)?(l.window.set(t.subarray(n-i,n),0),l.wnext=i,l.whave=l.wsize):(l.wnext+=a,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=a))),0};var fve=(e,t)=>{let n,i,a,l,u,h,m,g,_,v,S,T,P,x,N,M,F,q,J,te,Y,ne,ue=0;const fe=new Uint8Array(4);let Me,ut;const ot=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Mh(e)||!e.output||!e.input&&e.avail_in!==0)return xo;n=e.state,n.mode===Hl&&(n.mode=eA),u=e.next_out,a=e.output,m=e.avail_out,l=e.next_in,i=e.input,h=e.avail_in,g=n.hold,_=n.bits,v=h,S=m,ne=jh;e:for(;;)switch(n.mode){case B0:if(n.wrap===0){n.mode=eA;break}for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(2&n.wrap&&g===35615){n.wbits===0&&(n.wbits=15),n.check=0,fe[0]=255&g,fe[1]=g>>>8&255,n.check=pi(n.check,fe,2,0),g=0,_=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=ls;break}if((15&g)!==fG){e.msg="unknown compression method",n.mode=ls;break}if(g>>>=4,_-=4,Y=8+(15&g),n.wbits===0&&(n.wbits=Y),Y>15||Y>n.wbits){e.msg="invalid window size",n.mode=ls;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&g?16189:Hl,g=0,_=0;break;case 16181:for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(n.flags=g,(255&$s(n))!==fG){e.msg="unknown compression method",n.mode=ls;break}if(57344&$s(n)){e.msg="unknown header flags set",n.mode=ls;break}n.head&&(n.head.text=g>>8&1),512&$s(n)&&4&n.wrap&&(fe[0]=255&g,fe[1]=g>>>8&255,n.check=pi(n.check,fe,2,0)),g=0,_=0,n.mode=16182;case 16182:for(;_<32;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.head&&(n.head.time=g),512&$s(n)&&4&n.wrap&&(fe[0]=255&g,fe[1]=g>>>8&255,fe[2]=g>>>16&255,fe[3]=g>>>24&255,n.check=pi(n.check,fe,4,0)),g=0,_=0,n.mode=16183;case 16183:for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&$s(n)&&4&n.wrap&&(fe[0]=255&g,fe[1]=g>>>8&255,n.check=pi(n.check,fe,2,0)),g=0,_=0,n.mode=16184;case 16184:if(1024&$s(n)){for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.length=g,n.head&&(n.head.extra_len=g),512&$s(n)&&4&n.wrap&&(fe[0]=255&g,fe[1]=g>>>8&255,n.check=pi(n.check,fe,2,0)),g=0,_=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&$s(n)&&(T=n.length,T>h&&(T=h),T&&(n.head&&(Y=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(l,l+T),Y)),512&$s(n)&&4&n.wrap&&(n.check=pi(n.check,i,T,l)),h-=T,l+=T,n.length-=T),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&$s(n)){if(h===0)break e;T=0;do Y=i[l+T++],n.head&&Y&&n.length<65536&&(n.head.name+=String.fromCharCode(Y));while(Y&&T<h);if(512&$s(n)&&4&n.wrap&&(n.check=pi(n.check,i,T,l)),h-=T,l+=T,Y)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&$s(n)){if(h===0)break e;T=0;do Y=i[l+T++],n.head&&Y&&n.length<65536&&(n.head.comment+=String.fromCharCode(Y));while(Y&&T<h);if(512&$s(n)&&4&n.wrap&&(n.check=pi(n.check,i,T,l)),h-=T,l+=T,Y)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&$s(n)){for(;_<16;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(4&n.wrap&&g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ls;break}g=0,_=0}n.head&&(n.head.hcrc=$s(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Hl;break;case 16189:for(;_<32;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}e.adler=n.check=gG(g),g=0,_=0,n.mode=G0;case G0:if(n.havedict===0)return e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=_,uve;e.adler=n.check=1,n.mode=Hl;case Hl:if(t===lve||t===F0)break e;case eA:if(n.last){g>>>=7&_,_-=7&_,n.mode=nA;break}for(;_<3;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}switch(n.last=1&g,g>>>=1,_-=1,3&g){case 0:n.mode=16193;break;case 1:if(mve(n),n.mode=W0,t===F0){g>>>=2,_-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=ls}g>>>=2,_-=2;break;case 16193:for(g>>>=7&_,_-=7&_;_<32;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ls;break}if(n.length=65535&g,g=0,_=0,n.mode=tA,t===F0)break e;case tA:n.mode=16195;case 16195:if(T=n.length,T){if(T>h&&(T=h),T>m&&(T=m),T===0)break e;a.set(i.subarray(l,l+T),u),h-=T,l+=T,m-=T,u+=T,n.length-=T;break}n.mode=Hl;break;case 16196:for(;_<14;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(n.nlen=257+(31&g),g>>>=5,_-=5,n.ndist=1+(31&g),g>>>=5,_-=5,n.ncode=4+(15&g),g>>>=4,_-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ls;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;_<3;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.lens[ot[n.have++]]=7&g,g>>>=3,_-=3}for(;n.have<19;)n.lens[ot[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Me={bits:n.lenbits},ne=oE(0,n.lens,0,19,n.lencode,0,n.work,Me),n.lenbits=Me.bits,ne){e.msg="invalid code lengths set",n.mode=ls;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;ue=n.lencode[g&(1<<n.lenbits)-1],N=ue>>>24,M=ue>>>16&255,F=65535&ue,!(N<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(F<16)g>>>=N,_-=N,n.lens[n.have++]=F;else{if(F===16){for(ut=N+2;_<ut;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(g>>>=N,_-=N,n.have===0){e.msg="invalid bit length repeat",n.mode=ls;break}Y=n.lens[n.have-1],T=3+(3&g),g>>>=2,_-=2}else if(F===17){for(ut=N+3;_<ut;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}g>>>=N,_-=N,Y=0,T=3+(7&g),g>>>=3,_-=3}else{for(ut=N+7;_<ut;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}g>>>=N,_-=N,Y=0,T=11+(127&g),g>>>=7,_-=7}if(n.have+T>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ls;break}for(;T--;)n.lens[n.have++]=Y}}if(n.mode===ls)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=ls;break}if(n.lenbits=9,Me={bits:n.lenbits},ne=oE(1,n.lens,0,n.nlen,n.lencode,0,n.work,Me),n.lenbits=Me.bits,ne){e.msg="invalid literal/lengths set",n.mode=ls;break}if(n.distbits=6,n.distcode=n.distdyn,Me={bits:n.distbits},ne=oE(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Me),n.distbits=Me.bits,ne){e.msg="invalid distances set",n.mode=ls;break}if(n.mode=W0,t===F0)break e;case W0:n.mode=H0;case H0:if(h>=6&&m>=258){e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=_,sve(e,S),u=e.next_out,a=e.output,m=e.avail_out,l=e.next_in,i=e.input,h=e.avail_in,g=n.hold,_=n.bits,n.mode===Hl&&(n.back=-1);break}for(n.back=0;ue=n.lencode[g&(1<<n.lenbits)-1],N=ue>>>24,M=ue>>>16&255,F=65535&ue,!(N<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(M&&!(240&M)){for(q=N,J=M,te=F;ue=n.lencode[te+((g&(1<<q+J)-1)>>q)],N=ue>>>24,M=ue>>>16&255,F=65535&ue,!(q+N<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}g>>>=q,_-=q,n.back+=q}if(g>>>=N,_-=N,n.back+=N,n.length=F,M===0){n.mode=16205;break}if(32&M){n.back=-1,n.mode=Hl;break}if(64&M){e.msg="invalid literal/length code",n.mode=ls;break}n.extra=15&M,n.mode=16201;case 16201:if(n.extra){for(ut=n.extra;_<ut;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,_-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;ue=n.distcode[g&(1<<n.distbits)-1],N=ue>>>24,M=ue>>>16&255,F=65535&ue,!(N<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(!(240&M)){for(q=N,J=M,te=F;ue=n.distcode[te+((g&(1<<q+J)-1)>>q)],N=ue>>>24,M=ue>>>16&255,F=65535&ue,!(q+N<=_);){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}g>>>=q,_-=q,n.back+=q}if(g>>>=N,_-=N,n.back+=N,64&M){e.msg="invalid distance code",n.mode=ls;break}n.offset=F,n.extra=15&M,n.mode=16203;case 16203:if(n.extra){for(ut=n.extra;_<ut;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,_-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ls;break}n.mode=16204;case 16204:if(m===0)break e;if(T=S-m,n.offset>T){if(T=n.offset-T,T>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ls;break}T>n.wnext?(T-=n.wnext,P=n.wsize-T):P=n.wnext-T,T>n.length&&(T=n.length),x=n.window}else x=a,P=u-n.offset,T=n.length;T>m&&(T=m),m-=T,n.length-=T;do a[u++]=x[P++];while(--T);n.length===0&&(n.mode=H0);break;case 16205:if(m===0)break e;a[u++]=n.length,m--,n.mode=H0;break;case nA:if(n.wrap){for(;_<32;){if(h===0)break e;h--,g|=i[l++]<<_,_+=8}if(S-=m,e.total_out+=S,n.total+=S,4&n.wrap&&S&&(e.adler=n.check=$s(n)?pi(n.check,a,S,u-S):$_(n.check,a,S,u-S)),S=m,4&n.wrap&&($s(n)?g:gG(g))!==n.check){e.msg="incorrect data check",n.mode=ls;break}g=0,_=0}n.mode=16207;case 16207:if(n.wrap&&$s(n)){for(;_<32;){if(h===0)break e;h--,g+=i[l++]<<_,_+=8}if(4&n.wrap&&g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ls;break}g=0,_=0}n.mode=16208;case 16208:ne=dve;break e;case ls:ne=pG;break e;case 16210:return mG;default:return xo}return e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=_,(n.wsize||S!==e.avail_out&&n.mode<ls&&(n.mode<nA||t!==hG))&&TG(e,e.output,e.next_out,S-e.avail_out),v-=e.avail_in,S-=e.avail_out,e.total_in+=v,e.total_out+=S,n.total+=S,4&n.wrap&&S&&(e.adler=n.check=$s(n)?pi(n.check,a,S,e.next_out-S):$_(n.check,a,S,e.next_out-S)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Hl?128:0)+(n.mode===W0||n.mode===tA?256:0),(v===0&&S===0||t===hG)&&ne===jh&&(ne=hve),ne},Kl={inflateReset:EG,inflateReset2:vG,inflateResetKeep:_G,inflateInit:e=>yG(e,15),inflateInit2:yG,inflate:fve,inflateEnd:e=>{if(Mh(e))return xo;let t=e.state;return t.window&&(t.window=null),e.state=null,jh},inflateGetHeader:(e,t)=>{if(Mh(e))return xo;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,jh):xo},inflateSetDictionary:(e,t)=>{const n=t.length;let i,a,l;return Mh(e)?xo:(i=e.state,i.wrap!==0&&i.mode!==G0?xo:i.mode===G0&&(a=1,a=$_(a,t,n,0),a!==i.check)?pG:(l=TG(e,t,n,n),l?(i.mode=16210,mG):(i.havedict=1,jh)))},inflateInfo:"pako inflate (from Nodeca project)"},gve=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const bG=Object.prototype.toString,{Z_NO_FLUSH:_ve,Z_FINISH:Eve,Z_OK:cE,Z_STREAM_END:iA,Z_NEED_DICT:aA,Z_STREAM_ERROR:vve,Z_DATA_ERROR:wG,Z_MEM_ERROR:yve}=Zm;function lE(e){this.options=j0.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dG,this.strm.avail_out=0;let n=Kl.inflateInit2(this.strm,t.windowBits);if(n!==cE)throw new Error(Ph[n]);if(this.header=new gve,Kl.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=iE.string2buf(t.dictionary):bG.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Kl.inflateSetDictionary(this.strm,t.dictionary),n!==cE)))throw new Error(Ph[n])}function oA(e,t){const n=new lE(t);if(n.push(e),n.err)throw n.msg||Ph[n.err];return n.result}lE.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,a=this.options.dictionary;let l,u,h;if(this.ended)return!1;for(u=t===~~t?t:t===!0?Eve:_ve,bG.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),l=Kl.inflate(n,u),l===aA&&a&&(l=Kl.inflateSetDictionary(n,a),l===cE?l=Kl.inflate(n,u):l===wG&&(l=aA));n.avail_in>0&&l===iA&&n.state.wrap>0&&e[n.next_in]!==0;)Kl.inflateReset(n),l=Kl.inflate(n,u);switch(l){case vve:case wG:case aA:case yve:return this.onEnd(l),this.ended=!0,!1}if(h=n.avail_out,n.next_out&&(n.avail_out===0||l===iA))if(this.options.to==="string"){let m=iE.utf8border(n.output,n.next_out),g=n.next_out-m,_=iE.buf2string(n.output,m);n.next_out=g,n.avail_out=i-g,g&&n.output.set(n.output.subarray(m,m+g),0),this.onData(_)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(l!==cE||h!==0){if(l===iA)return l=Kl.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},lE.prototype.onData=function(e){this.chunks.push(e)},lE.prototype.onEnd=function(e){e===cE&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=j0.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Sve={Inflate:lE,inflate:oA,inflateRaw:function(e,t){return(t=t||{}).raw=!0,oA(e,t)},ungzip:oA,constants:Zm};const{Deflate:C1e,deflate:Tve,deflateRaw:bve,gzip:R1e}=rve,{Inflate:x1e,inflate:wve,inflateRaw:Cve,ungzip:N1e}=Sve;var Rve=Tve,xve=bve,Nve=wve,Ive=Cve,CG=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(CG||{});class Ave{constructor(){O(this,"_sequence",0),O(this,"_startTime",Date.now()),O(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const h=new Uint8Array(4);h.set([1,0,0,0]);const m={id:0,length:4,data:h.buffer},g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};n.commonPacketHeader.extension=1,n.extension=g,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;j("SHOW_DATASTREAM2_LOG")&&w.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),a=new Uint8Array(i),l=new DataView(i);let u=0;if(l.setUint16(u,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),u+=2,l.setUint32(u,n.commonPacketHeader.sequence,!0),u+=4,l.setUint16(u,n.commonStreamHeader,!0),u+=2,n.extension){const h=this.serializeExtension(n.extension);a.set(new Uint8Array(h),u),u+=h.byteLength}if(a.set(new Uint8Array(n.payload),u),u+=n.payload.byteLength,u!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const a=n.getUint16(i,!0);i+=2;const l={length:16383&a,reserved:(16384&a)>>14,extension:(32768&a)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let u,h;if(i+=4,j("SHOW_DATASTREAM2_LOG")&&w.debug("receive data header: ".concat(JSON.stringify(l))),n.getUint16(i,!0),i+=2,l.extension){h=this.deserializeExtension(t.slice(i)),i+=2+h.length,u=t.slice(i);let m=!1;if(h.datas.length>0){const g=h.datas.find(_=>_.id===0);g&&(m=(1&new DataView(g.data).getUint32(0,!0))==1)}u=m?this.decompress(u):u}else u=t.slice(8);return u}serializeExtension(t){const{profile:n,length:i,datas:a}=t,l=new ArrayBuffer(i+2),u=new Uint8Array(l),h=new DataView(l);let m=0;if(h.setUint8(m++,n),h.setUint8(m++,i),a.forEach(g=>{n?(h.setUint8(m++,g.id),h.setUint8(m++,g.length),u.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(h.setUint8(m++,g.id|g.length<<4),u.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==i+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(i+2));return l}deserializeExtension(t){const n=new DataView(t);let i=0;const a=n.getUint8(i);i++;const l=n.getUint8(i);i++;const u=a===CG.TWO_BYTE,h=[],m=new DataView(t,2);let g=0;for(;g<l;){let _=0,v=0,S=new ArrayBuffer(0);u?(_=m.getUint8(g),g++,v=m.getUint8(g),g++):(_=15&m.getUint8(g),v=m.getUint8(g)>>4,g++),v>0&&(S=m.buffer.slice(g+2,g+2+v),g+=S.byteLength),h.push({id:_,length:v,data:S})}if(g!==l)throw Error("parse error");return{profile:a,length:l,datas:h}}decompress(t){return Nve(new Uint8Array(t))}compress(t){return Rve(new Uint8Array(t))}}const Ove={name:"DataStream",create:(e,t)=>{const n=t?new Lge(e):new jge(e);return n.useDataStream(new Ave),n}};class Pve extends Yn{constructor(t,n,i){super(),O(this,"ws",void 0),O(this,"requestId",1),O(this,"heartBeatTimer",void 0),O(this,"joinInfo",void 0),O(this,"clientId",void 0),O(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),O(this,"onClose",a=>{this.emit("close"),this.dispose()}),O(this,"onMessage",a=>{const l=JSON.parse(a.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=n,this.ws=new O_("cross-channel-".concat(this.clientId),i),this.ws.on(yt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(yt.CONNECTED,this.onOpen),this.ws.on(yt.ON_MESSAGE,this.onMessage),this.ws.on(yt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new Ne((n,i)=>{const a=window.setTimeout(()=>{i(new re(U.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(a),l.state&&l.state!==0?i(new re(U.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(a),i(new re(U.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new re(U.WS_DISCONNECT);const n=()=>new Ne((u,h)=>{this.ws.once(yt.CLOSED,()=>h(new re(U.WS_ABORT))),this.ws.once(yt.CONNECTED,u)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),a=new Ne((u,h)=>{const m=()=>{h(new re(U.WS_ABORT))};this.ws.once(yt.RECONNECTING,m),this.ws.once(yt.CLOSED,m),this.once("req_".concat(i),u),qr(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(yt.RECONNECTING,m),this.ws.off(yt.CLOSED,m),h(new re(U.TIMEOUT,"cross channel ws request timeout"))})}),l=await a;if(!l||l.code!==200)throw new re(U.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(yt.REQUEST_NEW_URLS),this.ws.on(yt.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Dve extends Yn{set state(t){t!==this._state&&(t!==ki.RELAY_STATE_FAILURE&&(this.errorCode=Um.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,a,l){super(),O(this,"joinInfo",void 0),O(this,"sid",void 0),O(this,"clientId",void 0),O(this,"cancelToken",yi.CancelToken.source()),O(this,"workerToken",void 0),O(this,"requestId",0),O(this,"signal",void 0),O(this,"prevChannelMediaConfig",void 0),O(this,"httpRetryConfig",void 0),O(this,"_resolution",void 0),O(this,"_state",ki.RELAY_STATE_IDLE),O(this,"errorCode",Um.RELAY_OK),O(this,"onStatus",u=>{w.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(u))),u&&u.command&&(u.command==="onAudioPacketReceived"&&this.emit("event",Fl.PACKET_RECEIVED_AUDIO_FROM_SRC),u.command==="onVideoPacketReceived"&&this.emit("event",Fl.PACKET_RECEIVED_VIDEO_FROM_SRC),u.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Um.SRC_TOKEN_EXPIRED,this.state=ki.RELAY_STATE_FAILURE),u.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Um.DEST_TOKEN_EXPIRED,this.state=ki.RELAY_STATE_FAILURE))}),O(this,"onReconnect",async()=>{w.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Fl.NETWORK_DISCONNECTED),this.state=ki.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(u=>{this.state!==ki.RELAY_STATE_IDLE&&(w.error("auto restart channel media relay failed",u.toString()),this.errorCode=Um.SERVER_CONNECTION_LOST,this.state=ki.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=ph(),this.signal=new Pve(this.joinInfo,this.clientId,i),this.httpRetryConfig=a,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==ki.RELAY_STATE_IDLE)throw new re(U.INVALID_OPERATION);this.state=ki.RELAY_STATE_CONNECTING,await this.connect(),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new re(U.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new re(U.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new re(U.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==ki.RELAY_STATE_RUNNING)throw new re(U.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==ki.RELAY_STATE_RUNNING)throw new re(U.INVALID_OPERATION);const n=this.genMessage(bi.SetVideoProfile);await this.signal.request(n),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),w.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ki.RELAY_STATE_IDLE,this.dispose()}dispose(){w.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=yi.CancelToken.source(),this.state=ki.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await F_e(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Fl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(bi.SetSdkProfile,t);await this.signal.request(n),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(bi.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Fl.PACKET_JOINED_SRC_CHANNEL),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(bi.SetSourceUserId,t);await this.signal.request(a),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const l=this.genMessage(bi.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Fl.PACKET_JOINED_DEST_CHANNEL),w.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(bi.StartPacketTransfer,t);await this.signal.request(u),this.emit("event",Fl.PACKET_SENT_TO_DEST_CHANNEL),this.state=ki.RELAY_STATE_RUNNING,w.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(bi.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Fl.PACKET_UPDATE_DEST_CHANNEL),w.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(bi.StopPacketTransfer);await this.signal.request(t),w.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],a=[],l=[];this.requestId+=1;const u={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ja,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};u.sdkVersion==="4.24.1"&&(u.sdkVersion="0.0.1");let h=null,m=null;switch(t){case bi.SetSdkProfile:return u.clientRequest={command:"SetSdkProfile",type:"multi_channel"},u;case bi.SetSourceChannel:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new re(U.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},u;case bi.SetSourceUserId:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new re(U.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceUserId",uid:m.uid+""},u;case bi.SetDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new re(U.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(g=>{i.push(g.channelName),a.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),u.clientRequest={command:"SetDestChannel",channelName:i,uid:a,token:l},u;case bi.StartPacketTransfer:return u.clientRequest={command:"StartPacketTransfer"},u;case bi.Reconnect:return u.clientRequest={command:"Reconnect"},u;case bi.StopPacketTransfer:return u.clientRequest={command:"StopPacketTransfer"},u;case bi.UpdateDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new re(U.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(g=>{i.push(g.channelName),a.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),u.clientRequest={command:"UpdateDestChannel",channelName:i,uid:a,token:l},u;case bi.SetVideoProfile:u.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return u}}const kve={name:"ChannelMediaRelay",create:function(e){return new Dve(e.joinInfo,e.clientId,e.websocketRetryConfig||Cr,e.httpRetryConfig||Cr,e.resolution)}};function RG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function dE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RG(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RG(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Lve extends Yn{constructor(t,n,i,a){super(),O(this,"spec",void 0),O(this,"token",void 0),O(this,"websocket",void 0),O(this,"pingpongTimer",void 0),O(this,"reconnectMode","retry"),O(this,"serviceMode",void 0),O(this,"reqId",0),O(this,"commandReqId",0),O(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),O(this,"handleWebSocketMessage",l=>{if(!l.data)return;const u=JSON.parse(l.data);u.requestId?this.emit("@".concat(u.requestId,"-").concat(u.sid),u):(Be.workerEvent(this.spec.sid,{actionType:"status",serverCode:u.code,workerType:this.serviceMode===Vl.TRANSCODE?1:2}),this.emit(Ld.PUBLISH_STREAM_STATUS,u))}),this.spec=n,this.token=t,this.serviceMode=a,this.websocket=new O_("live-streaming",i),this.websocket.on(yt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(yt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(yt.REQUEST_NEW_URLS,(l,u)=>{Pr(this,Ld.REQUEST_NEW_ADDRESS).then(l).catch(u)}),this.websocket.on(yt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,a){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,u=this.reqId;if(!u||!this.websocket)throw new re(U.UNEXPECTED_ERROR);const h=dE({command:t,sdkVersion:ja==="4.24.1"?"0.0.1":ja,seq:u,requestId:u,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new re(U.WS_DISCONNECT);const m=()=>new Ne((S,T)=>{this.websocket.once(yt.CLOSED,()=>T(new re(U.WS_ABORT))),this.websocket.once(yt.CONNECTED,S)});this.websocket.state!=="connected"&&await m(),h.clientRequest&&(h.clientRequest.workerToken=this.token);const g=new Ne((S,T)=>{const P=()=>{T(new re(U.WS_ABORT))};this.websocket.once(yt.RECONNECTING,P),this.websocket.once(yt.CLOSED,P),this.once("@".concat(u,"-").concat(this.spec.sid),x=>{S(x)})});a&&Be.workerEvent(this.spec.sid,dE(dE({},a),{},{requestId:l,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(h);let v=null;try{v=await g}catch(S){if(this.websocket.state==="closed")throw S;return await m(),await this.request(t,n,i)}return a&&Be.workerEvent(this.spec.sid,dE(dE({},a),{},{requestId:l,actionType:"response",payload:JSON.stringify(v.serverResponse),serverCode:v.code,success:v.code===200,responseTime:Date.now()-_})),v.code!==200&&this.handleResponseError(v),v}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=ja==="4.24.1"?"0.0.1":ja;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Vr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void w.warning("live stream response already exists stream");case Vr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Vr.LIVE_STREAM_RESPONSE_BAD_STREAM:case Vr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new re(U.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Vr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new re(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new re(U.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Vr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new re(U.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ld.WARNING,n,t.serverResponse.url)}case Vr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new re(U.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ld.WARNING,n,t.serverResponse.url)}case Vr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new re(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Vr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new re(U.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Vr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new re(U.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ld.WARNING,n,t.serverResponse.url)}case Vr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new re(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Vr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new re(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Vr.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new re(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vr.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new re(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new re(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Vr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new re(U.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(b_)},6e3)}}function xG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function ji(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xG(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xG(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class jve extends Yn{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Cr,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Cr;super(),O(this,"onLiveStreamWarning",void 0),O(this,"onLiveStreamError",void 0),O(this,"spec",void 0),O(this,"retryTimeout",1e4),O(this,"connection",void 0),O(this,"httpRetryConfig",void 0),O(this,"wsRetryConfig",void 0),O(this,"streamingTasks",new Map),O(this,"isStartingStreamingTask",!1),O(this,"taskMutex",new is("live-streaming")),O(this,"cancelToken",yi.CancelToken.source()),O(this,"transcodingConfig",void 0),O(this,"uapResponse",void 0),O(this,"lastTaskId",1),O(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=ji(ji({},v_e),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(w.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(u=>ji(ji(ji({},E_e),u),{},{zOrder:u.zOrder?u.zOrder+1:1}))),function(u){ir(u.width)||fn(u.width,"config.width",0,1e4),ir(u.height)||fn(u.height,"config.height",0,1e4),ir(u.videoBitrate)||fn(u.videoBitrate,"config.videoBitrate",1,1e6),ir(u.videoFrameRate)||fn(u.videoFrameRate,"config.videoFrameRate"),ir(u.lowLatency)||fo(u.lowLatency,"config.lowLatency"),ir(u.audioSampleRate)||wr(u.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ir(u.audioBitrate)||fn(u.audioBitrate,"config.audioBitrate",1,128),ir(u.audioChannels)||wr(u.audioChannels,"config.audioChannels",[1,2,3,4,5]),ir(u.videoGop)||fn(u.videoGop,"config.videoGop"),ir(u.videoCodecProfile)||wr(u.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ir(u.userCount)||fn(u.userCount,"config.userCount",0,17),ir(u.backgroundColor)||fn(u.backgroundColor,"config.backgroundColor",0,16777215),ir(u.userConfigExtraInfo)||Es(u.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),u.transcodingUsers&&!ir(u.transcodingUsers)&&(Ml(u.transcodingUsers,"config.transcodingUsers"),u.transcodingUsers.forEach((h,m)=>{r0(h.uid),ir(h.x)||fn(h.x,"transcodingUser[".concat(m,"].x"),0,1e4),ir(h.y)||fn(h.y,"transcodingUser[".concat(m,"].y"),0,1e4),ir(h.width)||fn(h.width,"transcodingUser[".concat(m,"].width"),0,1e4),ir(h.height)||fn(h.height,"transcodingUser[".concat(m,"].height"),0,1e4),ir(h.zOrder)||fn(h.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),ir(h.alpha)||fn(h.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),ir(u.watermark)||XN(u.watermark,"watermark"),ir(u.backgroundImage)||XN(u.backgroundImage,"backgroundImage"),u.images&&!ir(u.images)&&(Ml(u.images,"config.images"),u.images.forEach((h,m)=>{XN(h,"images[".concat(m,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(u=>ji(ji(ji({},YN),u),{},{zOrder:255}))),n.backgroundImage&&(i.push(ji(ji(ji({},YN),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(ji(ji(ji({},YN),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(u=>ji({},u)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const a=(n.userConfigs||[]).map(u=>typeof u.uid=="number"?Ne.resolve(u.uid):X3(u.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ne.all(a)).forEach((u,h)=>{n.userConfigs&&n.userConfigs[h]&&(n.userConfigs[h].uid=u)}),this.transcodingConfig=n,this.connection)try{var l;const u=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Yi(l=this.streamingTasks).call(l)).map(h=>h.taskId).join("#")});w.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(u.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(u){if(!u.data||!u.data.retry)throw u;u.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(h=>{w.warning("[".concat(this.spec.clientId,"] live streaming receive error"),u.toString(),"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,u).then(()=>{w.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(h.url," success"))}).catch(m=>{w.error("[".concat(this.spec.clientId,"] live streaming republish failed"),h.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,m)})})}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===Vl.TRANSCODE)throw new re(U.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};w.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const l=await this.taskMutex.lock();if(!this.connection&&i)return void l();if(this.streamingTasks.get(t)&&!i)return l(),new re(U.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(h){throw l(),h}switch(n){case Vl.TRANSCODE:a.transcodingConfig=ji({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const h=new Ne((g,_)=>{qr(this.retryTimeout).then(()=>{if(i)return _(i);const v=this.statusError.get(t);return v?(this.statusError.delete(t),_(v)):void 0})}),m=await Ne.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:n===Vl.TRANSCODE?1:2,requestByUser:!i,tid:u.toString()}),h]);this.isStartingStreamingTask=!1,w.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:a,mode:n,url:t,taskId:u}),l()}catch(h){if(l(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||i)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,h)):await this.startLiveStreamingTask(t,n,h)}}stopLiveStreamingTask(t){return new Ne((n,i)=>{const a=this.streamingTasks.get(t);if(!a||!this.connection)return new re(U.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=a.mode;a.abortTask=()=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:a.url}},!1,{url:t,command:"UnPublishStream",workerType:l===Vl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(u=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(u.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(Yi(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(a=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,a)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=yi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new re(U.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Pr(this,QN.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new Lve(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ld.WARNING,(i,a)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(a,i)),this.connection.on(Ld.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Ld.REQUEST_NEW_ADDRESS,(i,a)=>{if(!this.connection)return a(new re(U.UNEXPECTED_ERROR,"can not get new live streaming address list"));Pr(this,QN.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,i(l.addressList)}).catch(a)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),a=t.reason;switch(t.code){case Vr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const u=new re(U.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return w.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,u);if(!this.isStartingStreamingTask)return;this.statusError.set(n,u)}case Vr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const u=new re(U.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,a);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,u)}case Vr.LIVE_STREAM_RESPONSE_WORKER_LOST:case Vr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const u=Array.from(Yi(l=this.streamingTasks).call(l));for(const h of u)h.abortTask?h.abortTask():(w.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,new re(U.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{w.debug("[".concat(this.spec.clientId,"] republish live stream success"),h.url)}).catch(m=>{w.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,m)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Mve={name:"LiveStreaming",create:function(e){return new jve(e.joinInfo,e.websocketRetryConfig||Cr,e.httpRetryConfig||Cr)}};function Uve(e){let t=AG();return function(n,i){let a=n.appId;a!==void 0&&(dn(i,10),sl(i,a));let l=n.cid;l!==void 0&&(dn(i,16),dn(i,l));let u=n.cname;u!==void 0&&(dn(i,26),sl(i,u));let h=n.deviceId;h!==void 0&&(dn(i,34),sl(i,h));let m=n.elapse;m!==void 0&&(dn(i,40),Yd(i,m));let g=n.fileSize;g!==void 0&&(dn(i,48),Yd(i,rf(g)));let _=n.height;_!==void 0&&(dn(i,56),Yd(i,rf(_)));let v=n.jpg;v!==void 0&&(dn(i,66),dn(i,v.length),function(Bn,pe){let be=sf(Bn,pe.length);Bn.bytes.set(pe,be)}(i,v));let S=n.networkType;S!==void 0&&(dn(i,72),Yd(i,rf(S)));let T=n.osType;T!==void 0&&(dn(i,80),Yd(i,rf(T)));let P=n.requestId;P!==void 0&&(dn(i,90),sl(i,P));let x=n.sdkVersion;x!==void 0&&(dn(i,98),sl(i,x));let N=n.sequence;N!==void 0&&(dn(i,104),Yd(i,rf(N)));let M=n.sid;M!==void 0&&(dn(i,114),sl(i,M));let F=n.timestamp;F!==void 0&&(dn(i,120),Yd(i,F));let q=n.uid;q!==void 0&&(dn(i,128),dn(i,q));let J=n.vid;J!==void 0&&(dn(i,136),dn(i,J));let te=n.width;te!==void 0&&(dn(i,144),Yd(i,rf(te)));let Y=n.service;Y!==void 0&&(dn(i,152),dn(i,Y));let ne=n.callbackData;ne!==void 0&&(dn(i,162),sl(i,ne));let ue=n.jpgEncryption;ue!==void 0&&(dn(i,168),dn(i,ue));let fe=n.requestType;fe!==void 0&&(dn(i,176),dn(i,fe));let Me=n.scorePorn;Me!==void 0&&(dn(i,185),hA(i,Me));let ut=n.scoreSexy;ut!==void 0&&(dn(i,193),hA(i,ut));let ot=n.scoreNeutral;ot!==void 0&&(dn(i,201),hA(i,ot));let Ct=n.scene;Ct!==void 0&&(dn(i,208),dn(i,Ct));let vt=n.ossFilePrefix;vt!==void 0&&(dn(i,218),sl(i,vt));let Zt=n.serviceVendor;if(Zt!==void 0)for(let Bn of Zt){dn(i,226);let pe=AG();Bve(Bn,pe),dn(i,pe.limit),Kve(i,pe),Hve(pe)}}(e,t),function(n){let i=n.bytes,a=n.limit;return i.length===a?i:i.subarray(0,a)}(t)}function Vve(e){return function(n){let i={};e:for(;!OG(n);){let a=il(n);switch(a>>>3){case 0:break e;case 1:i.code=il(n);break;case 2:i.msg=PG(n,il(n));break;case 3:{let l=Gve(n);i.data=Fve(n),n.limit=l;break}default:NG(n,7&a)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Fve(e){let t={};e:for(;!OG(e);){let n=il(e);switch(n>>>3){case 0:break e;case 1:t.requestId=PG(e,il(e));break;case 2:t.requestType=il(e)>>>0;break;case 3:t.scorePorn=uA(e);break;case 4:t.scoreSexy=uA(e);break;case 5:t.scoreNeutral=uA(e);break;case 6:t.requestScene=il(e)>>>0;break;case 7:t.scene=il(e)>>>0;break;default:NG(e,7&n)}}return t}function Bve(e,t){let n=e.service;n!==void 0&&(dn(t,8),dn(t,n));let i=e.vendor;i!==void 0&&(dn(t,16),dn(t,i));let a=e.token;a!==void 0&&(dn(t,26),sl(t,a));let l=e.callbackUrl;l!==void 0&&(dn(t,34),sl(t,l))}function Gve(e){let t=il(e),n=e.limit;return e.limit=e.offset+t,n}function NG(e,t){switch(t){case 0:for(;128&DG(e););break;case 2:lA(e,il(e));break;case 5:lA(e,4);break;case 1:lA(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Wve=new Float32Array(1);new Uint8Array(Wve.buffer);let cA=new Float64Array(1),Mi=new Uint8Array(cA.buffer);function rf(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let IG=[];function AG(){const e=IG.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Hve(e){IG.push(e)}function lA(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function OG(e){return e.offset>=e.limit}function sf(e,t){let n=e.bytes,i=e.offset,a=e.limit,l=i+t;if(l>n.length){let u=new Uint8Array(2*l);u.set(n),e.bytes=u}return e.offset=l,l>a&&(e.limit=l),i}function dA(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function PG(e,t){let n=dA(e,t),i=String.fromCharCode,a=e.bytes,l="",u="";for(let h=0;h<t;h++){let m,g,_,v,S=a[h+n];128&S?(224&S)==192?h+1>=t?u+=l:(m=a[h+n+1],(192&m)!=128?u+=l:(v=(31&S)<<6|63&m,v<128?u+=l:(u+=i(v),h++))):(240&S)==224?h+2>=t?u+=l:(m=a[h+n+1],g=a[h+n+2],(49344&(m|g<<8))!=32896?u+=l:(v=(15&S)<<12|(63&m)<<6|63&g,v<2048||v>=55296&&v<=57343?u+=l:(u+=i(v),h+=2))):(248&S)==240?h+3>=t?u+=l:(m=a[h+n+1],g=a[h+n+2],_=a[h+n+3],(12632256&(m|g<<8|_<<16))!=8421504?u+=l:(v=(7&S)<<18|(63&m)<<12|(63&g)<<6|63&_,v<65536||v>1114111?u+=l:(v-=65536,u+=i(55296+(v>>10),56320+(1023&v)),h+=3))):u+=l:u+=i(S)}return u}function sl(e,t){let n=t.length,i=0;for(let u=0;u<n;u++){let h=t.charCodeAt(u);h>=55296&&h<=56319&&u+1<n&&(h=(h<<10)+t.charCodeAt(++u)-56613888),i+=h<128?1:h<2048?2:h<65536?3:4}dn(e,i);let a=sf(e,i),l=e.bytes;for(let u=0;u<n;u++){let h=t.charCodeAt(u);h>=55296&&h<=56319&&u+1<n&&(h=(h<<10)+t.charCodeAt(++u)-56613888),h<128?l[a++]=h:(h<2048?l[a++]=h>>6&31|192:(h<65536?l[a++]=h>>12&15|224:(l[a++]=h>>18&7|240,l[a++]=h>>12&63|128),l[a++]=h>>6&63|128),l[a++]=63&h|128)}}function Kve(e,t){let n=sf(e,t.limit),i=e.bytes,a=t.bytes;for(let l=0,u=t.limit;l<u;l++)i[l+n]=a[l]}function DG(e){return e.bytes[dA(e,1)]}function kG(e,t){let n=sf(e,1);e.bytes[n]=t}function uA(e){let t=dA(e,8),n=e.bytes;return Mi[0]=n[t++],Mi[1]=n[t++],Mi[2]=n[t++],Mi[3]=n[t++],Mi[4]=n[t++],Mi[5]=n[t++],Mi[6]=n[t++],Mi[7]=n[t++],cA[0]}function hA(e,t){let n=sf(e,8),i=e.bytes;cA[0]=t,i[n++]=Mi[0],i[n++]=Mi[1],i[n++]=Mi[2],i[n++]=Mi[3],i[n++]=Mi[4],i[n++]=Mi[5],i[n++]=Mi[6],i[n++]=Mi[7]}function il(e){let t,n=0,i=0;do t=DG(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function dn(e,t){for(t>>>=0;t>=128;)kG(e,127&t|128),t>>>=7;kG(e,t)}function Yd(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,l=a===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:a<128?9:10,u=sf(e,l),h=e.bytes;switch(l){case 10:h[u+9]=a>>>7&1;case 9:h[u+8]=l!==9?128|a:127&a;case 8:h[u+7]=l!==8?i>>>21|128:i>>>21&127;case 7:h[u+6]=l!==7?i>>>14|128:i>>>14&127;case 6:h[u+5]=l!==6?i>>>7|128:i>>>7&127;case 5:h[u+4]=l!==5?128|i:127&i;case 4:h[u+3]=l!==4?n>>>21|128:n>>>21&127;case 3:h[u+2]=l!==3?n>>>14|128:n>>>14&127;case 2:h[u+1]=l!==2?n>>>7|128:n>>>7&127;case 1:h[u]=l!==1?128|n:127&n}}function LG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}const zve=new Map([["moderation",1],["supervise",2]]);class qve extends Yn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(os.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=ka(n=t.map(i=>zve.get(i)||0)).call(n,(i,a)=>i+a),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),O(this,"name","AgoraRTCVideoContentInspect"),O(this,"_connectionState",yo.CONNECTING),O(this,"_innerConnectionState",void 0),O(this,"sequence",0),O(this,"inspectStartTime",void 0),O(this,"workerManagerConnection",void 0),O(this,"workerConnection",void 0),O(this,"workerMessageLengthLimit",void 0),O(this,"inspectIntervalMinimum",void 0),O(this,"qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",yi.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"wmSequence",0),O(this,"inspectInterval",void 0),O(this,"inspectTimer",null),O(this,"ossFilePrefix",void 0),O(this,"extraInfo",void 0),O(this,"_inspectType",void 0),O(this,"_inspectMode",void 0),O(this,"_quality",1),O(this,"qualityTimer",null),O(this,"_inspectId",void 0),O(this,"_needWorkUrlOnly",!1),O(this,"inspectImage",()=>{if(this.connectionState!==yo.CONNECTED)throw new re(U.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===yo.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=on(5,"inspect-"),this.workerMessageLengthLimit=j("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=j("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=j("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new O_("worker-manager-"+this._inspectId,Cr),this.on(os.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,w.debug("[".concat(this._inspectId,"] Inspect operation :").concat(So[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new O_("worker-"+this._inspectId,Cr),this.handleWorkerEvents()}async init(t,n){this.emit(os.STATE_CHANGE,So.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Ne((a,l)=>{this.on(os.CONNECTION_STATE_CHANGE,(u,h)=>{h===yo.CONNECTED&&a()}),this.requestAP(t,i,n).then(u=>{this.connectWorkerManager(u)}).catch(u=>{l(u)})})}async requestAP(t,n,i){const a=j("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),l=await function(h,m,g,_){let{appId:v,areaCode:S,cname:T,sid:P,token:x,uid:N}=m;Hm++;const M="image_moderation_api",F={service_name:M,json_body:JSON.stringify({appId:v,areaCode:S,cname:T,command:"allocateEdge",requestId:Hm,seq:Hm,sid:P,token:x,ts:Date.now(),uid:N+""})};let q,J,te=h[0];return Qo(async()=>{q=Date.now();const Y=await nc(te,{data:F,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(J=Date.now()-q,Y.code!==0){const ot=new re(U.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Y.code,{retry:!0,responseTime:J});throw w.error(ot.toString()),ot}const ne=JSON.parse(Y.json_body);if(ne.code!==200){const ot=new re(U.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ne.code,", reason: ").concat(ne.reason),{code:ne.code,responseTime:J});throw w.error(ot.toString()),ot}if(!ne.servers||!Array.isArray(ne.servers)||ne.servers.length===0){const ot=new re(U.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ne.code,responseTime:J});throw w.error(ot.toString()),ot}const ue=j("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(ue)return{addressList:[ue],workerToken:ne.workerToken,vid:ne.vid,responseTime:J};const fe=j("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Me=j("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ne.servers.map(ot=>{let{address:Ct,wss:vt}=ot;if(Ct&&vt)return"wss://".concat(Ct.replace(/\./g,"-"),".").concat(fe,":").concat(Me||vt)}).filter(ot=>!!ot),workerToken:ne.workerToken,vid:ne.vid,responseTime:J}},(Y,ne)=>(Be.apworkerEvent(P,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(Y.addressList),firstSuccess:ne===0,responseTime:J,serverIp:h[ne%h.length]}),!1),(Y,ne)=>(Be.apworkerEvent(P,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:M,responseTime:J,serverIp:h[ne%h.length]}),!!(Y.code!==U.OPERATION_ABORTED&&Y.code!==U.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(te=h[(ne+1)%h.length],!0)),_)}(a,t,n,i);this.emit(os.STATE_CHANGE,So.AP_CONNECTED);const{addressList:u}=l;return this.wmSequence++,u}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(os.STATE_CHANGE,So.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(yt.CONNECTED,async()=>{this.emit(os.STATE_CHANGE,So.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(yt.CLOSED,()=>{this._innerConnectionState<So.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(yt.FAILED,()=>{this._innerConnectionState<So.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(yt.RECONNECTING,()=>{this._innerConnectionState<So.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(yt.ON_MESSAGE,async t=>{this.emit(os.STATE_CHANGE,So.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw w.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new re(U.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw w.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new re(U.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const a=j("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,l=n.replace(/:\d+\/?$/,":".concat(a));this.emit(os.STATE_CHANGE,So.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(os.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(yt.WILL_RECONNECT,(t,n,i)=>{i(t)}),this.workerManagerConnection.on(yt.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(yt.CONNECTED,async()=>{this.emit(os.STATE_CHANGE,So.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=yo.CONNECTED}),this.workerConnection.on(yt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=Vve(new Uint8Array(t.data));if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&w.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(os.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const a={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},l=ka(n=Object.keys(a)).call(n,(h,m)=>a[h]>a[m]?h:m,"porn"),u=Object.keys(a).find(h=>h===l);this.emit(os.INSPECT_RESULT,u)}else this.emit(os.INSPECT_RESULT,void 0,new re(U.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(os.INSPECT_RESULT,void 0,new re(U.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else w.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(os.INSPECT_RESULT,void 0,new re(U.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(yt.CLOSED,()=>{this.connectionState=yo.CLOSED}),this.workerConnection.on(yt.FAILED,()=>{this.connectionState=yo.CLOSED}),this.workerConnection.on(yt.RECONNECTING,()=>{this.connectionState=this.connectionState===yo.CONNECTED?yo.RECONNECTING:yo.CONNECTING}),this.workerConnection.on(yt.WILL_RECONNECT,(t,n,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(yt.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(os.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const t=Ji(this,os.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(os.INSPECT_RESULT,void 0,new re(U.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(os.INSPECT_RESULT,void 0,new re(U.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:a,cid:l,vid:u,sid:h,uid:m}=n;const g=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),v=await h4(_,i,a),S=this.sequence+"-"+l+"-"+m+"-"+g+"-"+on(12,""),T={appId:i,cid:l,cname:a,deviceId:"",elapse:(P=Number(g-this.inspectStartTime),{low:P|=0,high:P>>31,unsigned:P>=0}),fileSize:v.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:v,networkType:6,osType:7,requestId:S,sdkVersion:"4.24.1",sequence:this.sequence,sid:h,timestamp:B5(g),uid:m,vid:u,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var P;this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;const x=Uve(T);if(x.byteLength<this.workerMessageLengthLimit){if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const N=function(M){for(var F=1;F<arguments.length;F++){var q=arguments[F]!=null?arguments[F]:{};F%2?LG(Object(q),!0).forEach(function(J){O(M,J,q[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(q)):LG(Object(q)).forEach(function(J){Object.defineProperty(M,J,Object.getOwnPropertyDescriptor(q,J))})}return M}({},T);delete N.jpg,w.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(N))}return x}{const N=this.quality*this.qualityRatio;return this.quality=N,await this.generateRequestData(t,{appId:i,cname:a,cid:l,vid:u,sid:h,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=yi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=yo.CLOSED,this.emit(os.STATE_CHANGE,So.CLOSED)}}const Yve={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new re(U.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new re(U.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(a=>{var l;if(!Ee(l=["supervise","moderation"]).call(l,a))throw new re(U.INVALID_PARAMS,"".concat(a," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new re(U.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new qve(t)}};var jG=p(fs.Object.getOwnPropertySymbols),Xve=an,Qve=nC.indexOf,Jve=ry,pA=oe([].indexOf),MG=!!pA&&1/pA([1],1,-0)<0;Xve({target:"Array",proto:!0,forced:MG||!Jve("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return MG?pA(this,e,t)||0:Qve(this,e,t)}});var $ve=Da("Array","indexOf"),Zve=k,eye=$ve,mA=Array.prototype,tye=function(e){var t=e.indexOf;return e===mA||Zve(mA,e)&&t===mA.indexOf?eye:t},UG=p(tye);function nye(e,t){if(e==null)return{};var n,i,a=function(u,h){if(u==null)return{};var m={};for(var g in u)if({}.hasOwnProperty.call(u,g)){if(UG(h).call(h,g)!==-1)continue;m[g]=u[g]}return m}(e,t);if(jG){var l=jG(e);for(i=0;i<l.length;i++)n=l[i],UG(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}let VG=class{get localCapabilities(){return On(this._localCapabilities)}get rtpCapabilities(){return On(this._rtpCapabilities)}get candidates(){return On(this._candidates)}get iceParameters(){return On(this._iceParameters)}get dtlsParameters(){return On(this._dtlsParameters)}constructor(e){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname","o/i14u9pJrxRKAsu"),O(this,"firefoxSsrcMidMap",new Map),e=On(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:a,localCapabilities:l,direction:u,setup:h,videoCodec:m,audioCodec:g}=e;let _;this.setup=h,_=u===hi.RECEIVE_ONLY?li(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):li(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=a,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=l;const v=u===hi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=u===hi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=u===hi.RECEIVE_ONLY?a.send.videoCodecs:M_(Ve.VIDEO,v,S,m),P=u===hi.RECEIVE_ONLY?a.send.audioCodecs:M_(Ve.AUDIO,v,S,g);for(const x of _.mediaDescriptions)x.attributes.iceUfrag=t.iceUfrag,x.attributes.icePwd=t.icePwd,x.attributes.fingerprints=n.fingerprints,x.attributes.candidates=i,x.attributes.setup=this.setup,x.media.mediaType==="application"&&(x.attributes.sctpPort="5000"),x.media.mediaType==="video"&&(x.media.fmts=T.map(N=>N.payloadType.toString(10)),x.attributes.payloads=T,x.attributes.extmaps=v.videoExtensions),x.media.mediaType==="audio"&&(x.media.fmts=P.map(N=>N.payloadType.toString(10)),x.attributes.payloads=P,x.attributes.extmaps=v.audioExtensions,Wm(x));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return Ul(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,a){n=n.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:u}=L_(t,this.cname,j("SYNC_GROUP")?n:void 0),h=this.findPreloadMediaDesc(l);if(h){if(An()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,h.attributes.mid),a&&(a.twcc||a.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(h,a),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(e,l,i);let g;return m===-1?(g=this.createOrRecycleSendMedia(e,l,u,"sendonly",i,a),this.updateBundleMids()):(g=On(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=l,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,a)),An()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(a=>{const l=a._mediaStreamTrack.kind,u=this.findAvailableRecvMediaIndex(l);let h,m=!1;u===-1?(m=!0,h=this.createOrRecycleRecvMedia(a,[],"recvonly",t,n),this.updateBundleMids()):(h=On(this.sessionDesc.mediaDescriptions[u]),h.attributes.direction="recvonly"),i.push({mid:h.attributes.mid,needCreateTransceiver:m})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:a,type:l,relatedAddress:u,relatedPort:h,priority:m}=new RTCIceCandidate(e),g={foundation:t??"",componentId:"1",transport:n??"",priority:m?m+"":"",connectionAddress:i??"",port:a?a+"":"",type:l?l+"":"",relAddr:u??"",relPort:h?h+"":"",extension:{}};this.candidates.some(_=>_.priority===g.priority&&_.connectionAddress===g.connectionAddress&&_.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,a){const l=e._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,h=M_(l,u,this.localCapabilities.send,l===Ve.AUDIO?a:i),m=l===Ve.VIDEO?u.videoExtensions:u.audioExtensions,g="".concat(++this.currentMidIndex);let _={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};_=this.mungRecvMediaDsec(_,e);const v=this.findFirstClosedMedia(l);if(v){const S=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ee(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Ee(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const a=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(An()){if(a){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!l||l!==i.attributes.mid)}return!1}return a&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=On(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,a,l){const u=this.rtpCapabilities.send,h=e===Ve.VIDEO?u.videoCodecs:u.audioCodecs,m=e===Ve.VIDEO?u.videoExtensions:u.audioExtensions;An()&&(a="".concat(++this.currentMidIndex));let g={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:a}};g=this.mungSendMediaDesc(g,l);const _=this.findFirstClosedMedia(e);if(_){const v=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[v]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(e,t,n){const i=On(e);return sI(i),Rh(i,t),iI(i,t),O3(i),h0(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=On(e);return h0(n,t,this.localCapabilities.recv),Wm(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>An()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const rye=["sdp"];var Pn;function FG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function Xd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FG(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FG(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let BG=(Pn=class ff extends p3{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),O(this,"direction",void 0),O(this,"name",void 0),O(this,"store",void 0),O(this,"spec",void 0),O(this,"peerConnection",void 0),O(this,"initialOffer",void 0),O(this,"transport",void 0),O(this,"statsFilter",void 0),O(this,"localCandidateCount",0),O(this,"_isInRestartIce",!1),O(this,"mutex",void 0),O(this,"onLocalCandidate",void 0),O(this,"remoteSDP",void 0),O(this,"pendingCandidates",[]),O(this,"localCapabilities",void 0),O(this,"isReady",!1),O(this,"restartCnt",0),O(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new is("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(ff.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??hi.SEND_ONLY,this.name=this.direction===hi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=kS(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,An()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await oI();if(this.localCapabilities=j_(n),t){const{sdp:i}=t,a=nye(t,rye),l=function(){const _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},v=k_(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bo(v,_,"videoExtensions",S,T,P),bo(v,_,"videoCodecs",S,T,P),bo(v,_,"audioExtensions",S,T,P),bo(v,_,"audioCodecs",S,T,P),j("RAISE_H264_BASELINE_PRIORITY")){const x=P.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]==="42001f");if(x!==-1){const N=P.videoCodecs.findIndex(M=>M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(N<x){w.debug("raising H264 baseline profile priority");const M=P.videoCodecs[x];P.videoCodecs.splice(x,1),P.videoCodecs.splice(N,0,M)}N!==-1&&j("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(M=>!(M.rtpMap&&M.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&M.fmtp&&M.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:T,sendrecv:P}}({},{},i);this.remoteSDP=new VG({remoteIceParameters:a.iceParameters,remoteDtlsParameters:a.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const u=await this.peerConnection.createAnswer();if(!u.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const h=Qc(u.sdp);await this.peerConnection.setLocalDescription(u);const m=await D3({},{},u.sdp);this.localCapabilities=j_(m);const g=this.peerConnection.getTransceivers()[0];return g!=null&&g.receiver&&g.receiver.transport&&this.tryBindTransportEvents(g.receiver.transport),Xd(Xd({},h),{},{sdp:u.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Qc(i.sdp);return this.initialOffer=i,Xd(Xd({},a),{},{sdp:i.sdp})}}catch(n){throw new ae(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:a}=t,l=await D3({},{},n);this.remoteSDP=new VG({remoteIceParameters:i,remoteDtlsParameters:a,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const u=this.peerConnection.getTransceivers()[0];u!=null&&u.sender&&u.sender.transport&&this.tryBindTransportEvents(u.sender.transport)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ae(U.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var a=this;return vi(function*(){const l=yield Rt(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[],h=a.remoteSDP.receive(t,n,i);t.forEach((N,M)=>{if(h[M].needCreateTransceiver){const F=a.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});u.push(F),N._updateRtpTransceiver(F)}else{const F=a.peerConnection.getTransceivers().find(q=>q.mid===h[M].mid);if(!F)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(h[M].mid));u.push(F),N._updateRtpTransceiver(F)}}),An()&&j("SIMULCAST")===!0&&(yield Rt(a.applySimulcastForFirefox(u,t)));const m=h.map(N=>N.mid),g=yield Rt(a.peerConnection.createOffer()),_=a.mungSendOfferSDP(g.sdp,t,m),v=li(_),S=m.map(N=>{const M=v.mediaDescriptions.find(F=>F.attributes.mid===N);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return rI(M,j("USE_PUB_RTX"))}),T=u.map((N,M)=>{const F=m[M];return{localSSRC:S[M],id:F}});yield Rt(a.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield T}catch(N){const M=a.remoteSDP.toString();throw yield Rt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Rt(a.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Rt(a.stopSending(m,!0)),N}yield Rt(a.applySimulcastEncodings(u,t)),yield Rt(a.applySendEncodings(u,t));const P=a.remoteSDP.toString(),x=a.logSDPExchange(_,"offer","local","send");return x==null||x(P),yield Rt(a.setRemoteDescription({type:"answer",sdp:P})),u.map((N,M)=>{const F=m[M];return{localSSRC:S[M],id:F}})}catch(u){throw u instanceof ae?u:new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length (".concat(a.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));a.map(m=>{var g;m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();u==null||u(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{i&&i()}}async receive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,i,a);if(u){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const _=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(_.sdp,l,t);g==null||g(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const h=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!h||h.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,mid:h.mid,transceiver:h}}catch(l){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,i,a);if(u){const h=this.remoteSDP.toString(),m=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const g=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(g.sdp,l,t);m==null||m(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else w.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===mh.Auto&&(this.store.p2pTransport=mh.SdRtn,jt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ff.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,jt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ff.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=Qc(n.sdp);return this.store.descriptionStart(),this.direction===hi.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===hi.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=Qc(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new ae(U.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(a=>a.mid===t);i.length===1&&(this.isVP8Simulcast(n)?An()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(a=>a.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:a}=n.getSelectedCandidatePair();return{local:Xd(Xd({},_o),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Xd(Xd({},_o),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Ee(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a={iceServers:[]};var l;return t.iceServers?a.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(ch(t.turnServer.servers)?a.iceServers=t.turnServer.servers:(a.iceServers&&a.iceServers.push(...ff.turnServerConfigToIceServers(t.turnServer.servers,n,i)),j("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&t.turnServer.serversFromGateway&&a.iceServers.push(...ff.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),Ee(l=[mh.Relay,mh.SdRtn]).call(l,n)&&(a.iceTransportPolicy="relay"),j("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(a.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&jt().supportWebRTCEncodedTransform&&(a.encodedInsertableStreams=!0),w.debug("P2PConnection p2pTransport is ".concat(n)),a}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const a=[],l=t.filter(h=>h.tcpport);w.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(i));const u=l.length>i?l[i]:l[0];switch(n){case mh.SdRtn:const h=t.filter(g=>{var _;return Ee(_=g.username).call(_,"glb:")&&g.turnServerURL==g.turnServerURL}),m=h.length>i?h[i]:h[0];m&&(a.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(To(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),a.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(To(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case mh.Relay:u&&(a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(To(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;default:u&&(a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(To(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}),a.push({username:u.username,credential:u.password,credentialType:"password",urls:"stun:".concat(u.turnServerURL,":").concat(u.tcpport)}))}return a}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t==null?void 0:t.iceTransport.state;var a;i&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:a}=n.getSelectedCandidatePair()||{};if(i&&a){const l=i.address+":"+i.port,u=a.address+":"+a.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Xc(l)),", remote ").concat(JSON.stringify(Xc(u))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(_=>_.track===t._mediaStreamTrack)),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jt().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},l={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(t._encoderConfig){var u;const{bitrateMax:_,frameRate:v,scaleResolutionDownBy:S}=t._encoderConfig;_&&(l.maxBitrate=1e3*_),Ee(u=t._hints).call(u,sn.LOW_STREAM)&&(v&&(l.maxFramerate=wi(v)),S&&S>=1&&(l.scaleResolutionDownBy=S))}if(j("DSCP_TYPE")&&Hc()){var h;const _=j("DSCP_TYPE");Ee(h=["very-low","low","medium","high"]).call(h,_)&&(l.networkPriority=_)}const m=n.getParameters(),g=(i=m.encodings)===null||i===void 0?void 0:i[0];An()&&!g&&(a.encodings=[l]),g&&Object.assign(g,l),Object.assign(m,a),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await n.setParameters(m)}async applySendEncodings(t,n){try{if(!jt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const a=t[i],l=n[i];l instanceof _n&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,a.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const a=li(t);return n.forEach((l,u)=>{const h=i[u],m=a.mediaDescriptions.find(g=>g.attributes.mid===h);m&&(Rh(m,l),aI(m,l,this.store.codec))}),Ul(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,a,l,u,h;const g=t[m],_=n[m];if(_ instanceof _n&&!Ee(i=_._hints).call(i,sn.LOW_STREAM)&&(a=_._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((l=_._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=_._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const T=g.sender.getParameters();await g.sender.setParameters(Object.assign(T,v))}}}async applySimulcastEncodings(t,n){if(!An()&&t.length===n.length)for(let i=0;i<t.length;i++){const a=n[i];if(a instanceof _n&&this.isVP8Simulcast(a)){const l=t[i],u={},h={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var n,i,a,l,u;return!!(t instanceof _n&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ee(n=t._hints).call(n,sn.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,i,a){if(j("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(a,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",a)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(u=>{u.direction="inactive"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();a==null||a(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async u=>{u.direction="sendonly"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();a==null||a(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var a;const l=(a=li(n).mediaDescriptions.find(u=>u.attributes.mid===t))===null||a===void 0?void 0:a.attributes.ssrcs;return l==null?void 0:l[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Ee(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const a=li(t),l=a.mediaDescriptions.find(u=>u.attributes.mid===n);return l&&i===Ve.AUDIO&&l.media.mediaType==="audio"&&Wm(l),Ul(a)}},Ae(Pn.prototype,"establish",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"establish"),Pn.prototype),Ae(Pn.prototype,"connect",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"connect"),Pn.prototype),Ae(Pn.prototype,"receive",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"receive"),Pn.prototype),Ae(Pn.prototype,"mockReceive",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"mockReceive"),Pn.prototype),Ae(Pn.prototype,"stopReceiving",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"stopReceiving"),Pn.prototype),Ae(Pn.prototype,"restartICE",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"restartICE"),Pn.prototype),Ae(Pn.prototype,"close",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"close"),Pn.prototype),Ae(Pn.prototype,"updateEncoderConfig",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"updateEncoderConfig"),Pn.prototype),Ae(Pn.prototype,"updateSendParameters",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"updateSendParameters"),Pn.prototype),Ae(Pn.prototype,"replaceTrack",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"replaceTrack"),Pn.prototype),Ae(Pn.prototype,"muteLocal",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"muteLocal"),Pn.prototype),Ae(Pn.prototype,"unmuteLocal",[No],Object.getOwnPropertyDescriptor(Pn.prototype,"unmuteLocal"),Pn.prototype),Pn);function No(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("From P2PConnection.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{l()}},n}let ic=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var GG,WG,HG,KG,zG,qG,YG,XG,QG,JG,$G,Qn;function ZG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function K0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZG(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZG(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let sye=(GG=ac(ic.SEND_ONLY),WG=ac(ic.SEND_ONLY),HG=ac(),KG=ac(ic.RECEIVE_ONLY),zG=ac(ic.RECEIVE_ONLY),qG=ac(ic.RECEIVE_ONLY),YG=ac(ic.RECEIVE_ONLY),XG=ac(ic.RECEIVE_ONLY),QG=ac(ic.RECEIVE_ONLY),JG=ac(),$G=ac(ic.RECEIVE_ONLY),Qn=class extends Yn{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Xe.StateChange,t,this._state)}constructor(e,t){super(),O(this,"isPlanB",!1),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"sendConnection",void 0),O(this,"recvConnection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"statsCollector",void 0),O(this,"dtlsFailedCount",0),O(this,"sendMutex",void 0),O(this,"recvMutex",void 0),O(this,"_state",nn.Disconnected),O(this,"_restartStates",["disconnected","failed"]),O(this,"reconnectInterval",void 0),O(this,"uploadUnplinkStarted",!1),O(this,"uploadDownlinkStarted",!1),O(this,"uplinkStateUploadInterval",void 0),O(this,"downlinkStatsUploadInterval",void 0),O(this,"handleMuteLocalTrack",async(n,i,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==nn.Connected)return void a(new ae(U.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const m=this.filterTobeMutedTracks(n);if(m.length===0)return void i();const g=m.find(T=>T[0]==="videoLowTrack");g&&g[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(T=>{let[,{id:P}]=T;return P}));let _=!1;var u,h;n.trackMediaType==="video"?_=!((u=this.localTrackMap.get(ve.LocalAudioTrack))===null||u===void 0||!u.track._muted):_=((h=this.localTrackMap.get(ve.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;const v=this.createMuteMessage(m);await Sn(this,Xe.RequestMuteLocal,v);const S=n.trackMediaType==="video"?Md.MUTE_LOCAL_VIDEO:Md.MUTE_LOCAL_AUDIO;await Sn(this,Xe.RequestP2PMuteLocal,{action:S,message:v,isMuteAll:_}),i()}catch(m){a(m)}finally{l()}}),O(this,"handleUnmuteLocalTrack",async(n,i,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==nn.Connected)return void a(new ae(U.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const u=this.filterTobeUnmutedTracks(n);if(u.length===0)return void i();await this.sendConnection.unmuteLocal(u.map(g=>{let[,{id:_}]=g;return _}));const h=this.createUnmuteMessage(u),m=n.trackMediaType==="video"?Md.UNMUTE_LOCAL_VIDEO:Md.UNMUTE_LOCAL_AUDIO;await Sn(this,Xe.RequestP2PMuteLocal,{action:m,message:h}),i()}catch(u){a(u)}finally{l()}}),O(this,"handleUpdateVideoEncoder",async(n,i,a,l)=>{let u;typeof l=="boolean"&&l||(u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.sendConnection||!m||m.track!==n||this.state!==nn.Connected)return void i();const{id:g,track:_}=m;g&&(await this.sendConnection.updateSendParameters(g,_),await this.sendConnection.updateEncoderConfig(g,_),this.emit(Xe.UpdateVideoEncoder,_)),i()}catch(m){a(m)}finally{var h;(h=u)===null||h===void 0||h()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,a)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const u=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==n||this.state!==nn.Connected)return void i();const{id:h,track:m}=u;h&&await this.sendConnection.updateSendParameters(h,m),i()}catch(u){a(u)}finally{l()}}),O(this,"handleReplaceTrack",async(n,i,a,l)=>{let u;w.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;const g=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:v}]=_;return n===v});if(!this.sendConnection||!g||g[1].id===void 0||this.state!==nn.Connected)return void i();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(n,g[1].id)),g[0]===ve.LocalVideoTrack&&jt().supportDualStreamEncoding){const _=this.localTrackMap.get(ve.LocalVideoLowTrack);if(_){const v=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v,await new Ne((S,T)=>{this.handleReplaceTrack(_.track,S,T,!0)})}}i()}catch(g){a(g)}finally{var m;(m=u)===null||m===void 0||m()}}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new f5(e),this.bindStatsUploaderEvents(),this.sendMutex=new is("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new is("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},j("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new ae(U.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new ae(U.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new BG(e,this.store,hi.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=nn.New,this.sendConnection&&(w.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new BG(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new ae(U.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=nn.Connected}async addRemoteCandidate(e,t){if(t===hi.RECEIVE_ONLY){if(!this.sendConnection)throw new ae(U.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new ae(U.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return vi(function*(){const a=yield Rt(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==nn.Connected){i.throwIfTrackTypeNotMatch(e);const g=e.filter(_=>i.pendingLocalTracks.indexOf(_)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(g))}i.store.pubId=i.store.pubId+1,Ls.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(e,t,n);if(l.length===0)return void(yield Rt(i.tryToUnmuteAudio(e)));l.forEach(g=>{let{track:_,type:v}=g;const S=Date.now();i.store.publish(_.getTrackId(),v===ve.LocalAudioTrack?"audio":"video",S)}),i.bindLocalTrackEvents(l);const u=yield Rt(i.sendConnection.send(l.map(g=>{let{track:_}=g;return _}),i.store.codec,i.store.audioCodec)),h=(yield Rt(u.next())).value,m=i.createGatewayPublishMessage(l,h);try{yield m}catch(g){throw u.throw(g),(g==null?void 0:g.code)===U.WS_ABORT&&l.forEach(_=>{let{track:v}=_;i.pendingLocalTracks.indexOf(v)===-1&&i.pendingLocalTracks.push(v)}),i.unbindLocalTrackEvents(l),g}yield Rt(u.next()),l.forEach(g=>{let{type:_}=g;i.statsCollector.addLocalStats(_)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(l,h),l.forEach(g=>{let{track:_,type:v}=g;const S=Date.now();i.store.publish(_.getTrackId(),v===ve.LocalAudioTrack?"audio":"video",void 0,S)}),i.startUploadUplinkState()}finally{a()}})()}async unpublish(e){if(!this.sendConnection||this.state!==nn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(a=>!Ee(e).call(e,a)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(a=>a[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(a=>{let[,{id:l}]=a;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[l,{track:u}]=a;return{type:l,track:u}})),t.forEach(a=>{let[l]=a;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===nn.Connected)return n&&n[1].track.close(),i;e.forEach(a=>{const l=this.pendingLocalTracks.indexOf(a);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[a,{track:l,ssrcs:u}]=i;const h={stream_type:z_e(l,a),ssrcs:u};l._muted||!l._enabled?t.push(h):n.push(h)}),t.length>0&&t.forEach(i=>{Sn(this,Xe.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{Sn(this,Xe.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return vi(function*(){throw new ae(U.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(w.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Pr(this,Xe.RequestRePublish,this.pendingLocalTracks),this.emit(Xe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ae(U.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var a;if(!this.recvConnection)throw new ae(U.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;const{track:l,mid:u,transceiver:h}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===Ve.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new Lm(l,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new km(l,e.uid,e._uintid,this.store),w.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const g=this.pendingRemoteTracks.findIndex(_=>{let{user:v,kind:S}=_;return v.uid===e.uid&&t===S});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Xe.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new ae(U.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(i.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.recvConnection||n||i.forEach(l=>{let{kind:u}=l;var h;if(u===Ve.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===Ve.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const a=this.filterTobeUnSubscribedTracks(e,t);a.length!==0&&(await this.recvConnection.stopReceiving(a.map(l=>{let[,{id:u}]=l;return u})),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach(l=>{let[u,{kind:h}]=l;var m,g;if(h===Ve.VIDEO&&u._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Ve.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),n||((g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0);else if(h===Ve.AUDIO){var _;this.unbindRemoteTrackEvents(u._audioTrack),!n&&((_=u._audioTrack)===null||_===void 0||_._destroy(),u._audioTrack=void 0)}}),a.forEach(l=>{let[,{kind:u}]=l;Sn(this,Xe.RequestP2PMuteRemote,u)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Ve.VIDEO,Ve.AUDIO].forEach(i=>{n.has(i)?Sn(this,Xe.RequestP2PUnmuteRemote,i):Sn(this,Xe.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new ae(U.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new ae(U.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new ae(U.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new ae(U.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===Ve.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void w.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||w.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ve.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ur){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[a]=i;return a!==ve.LocalAudioTrack}).filter(i=>{let[a]=i;return!(e&&a===ve.LocalVideoLowTrack)}).map(i=>{let[,{track:a}]=i;return a}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===ve.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,a){if(e){const u=this.localTrackMap.get(ve.LocalAudioTrack),h=i?this.localTrackMap.get(ve.LocalVideoLowTrack):this.localTrackMap.get(ve.LocalVideoTrack);Be.publish(this.store.sessionId,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(sn.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var l;n||(n=[]);const u=n.find(m=>m instanceof gr),h=i?(l=this.localTrackMap.get(ve.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(m=>m instanceof _n);Be.publish(this.store.sessionId,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(sn.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,n,i){const a=i===Ve.VIDEO?n._videoSSRC:n._audioSSRC;a&&Be.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Ve.VIDEO,audio:i===Ve.AUDIO,peerid:n.uid,subscribeRequestid:i===Ve.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ls.measureFromSubscribeStart(this.store.clientId,a)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new is("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new is("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ve.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ur){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=nn.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ve.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ve.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof _n||t&&t.track instanceof gr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Hs(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ve.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ju(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(w.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=nn.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:i}]=e;switch(n){case ve.LocalVideoTrack:Ee(t=i._hints).call(t,sn.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ve.LocalAudioTrack:i instanceof Ur?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ve.LocalVideoLowTrack:}}),this.emit(Xe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Hs(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Xe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),w.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:a}=n;if((e instanceof Fd?e.uid:e)===i.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===hi.SEND_ONLY){if(!this.sendConnection)throw new ae(U.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new ae(U.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const a=await i.restartICE(t);return i.isInRestartIce=!1,a}{const a=await i.restartICE();if(a){const l=await Pr(this,Xe.RequestP2PRestartICE,{direction:hi.RECEIVE_ONLY,iceParameter:a});await i.restartICE(l),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(ve.LocalVideoTrack),n=this.localTrackMap.get(ve.LocalAudioTrack),i=e.videoSend.find(T=>{var P;return T.ssrc===(t==null||(P=t.ssrcs)===null||P===void 0?void 0:P[0].ssrcId)}),a=e.audioSend.find(T=>{var P;return T.ssrc===(n==null||(P=n.ssrcs)===null||P===void 0?void 0:P[0].ssrcId)});if(!i||!a)return 1;const l=Ji(this,Xe.NeedSignalRTT),u=i?i.rttMs:void 0,h=a?a.rttMs:void 0,m=u&&h?(u+h)/2:u||h,g=(m&&l?(m+l)/2:m||l)||0,_=100*e.sendPacketLossRate*.7/50+.3*g/1500,v=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,S=t==null?void 0:t.track;if(S&&S._encoderConfig&&S._hints.indexOf(sn.SCREEN_TRACK)===-1){const T=S._encoderConfig.bitrateMax,P=e.bitrate.actualEncoded;if(T&&P){const x=(1e3*T-P)/(1e3*T);return i3[x<.15?0:x<.3?1:x<.45?2:x<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const a=i._audioSSRC,l=i._videoSSRC,u=e.audioRecv.find(P=>P.ssrc===a),h=e.videoRecv.find(P=>P.ssrc===l);if(!u&&!h)return void(t+=1);const m=Ji(this,Xe.NeedSignalRTT),g=e.rtt,_=(g&&m?(g+m)/2:g||m)||0,v=u?u.jitterMs:void 0,S=e.recvPacketLossRate;let T=.7*S*100/50+.3*_/1500;v&&(T=.6*S*100/50+.2*_/1500+.2*v/400),t+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ne((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],a=jt(),l=this.getAllTracks();e=Sm(e=e.filter(m=>l.indexOf(m)===-1));let u=!1,h=!1;for(const m of e){if(m instanceof _n&&(this.localTrackMap.has(ve.LocalVideoTrack)||u?new ae(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:m,type:ve.LocalVideoTrack}),u=!0),t)){const g=this.getLowVideoTrack(m,n);i.push({track:g,type:ve.LocalVideoLowTrack})}if(m instanceof gr){const g=this.localTrackMap.get(ve.LocalAudioTrack);if(g){if(!(g.track instanceof Ur))throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(h){const _=i.find(v=>{let{type:S}=v;return S===ve.LocalAudioTrack});if(!(_.track instanceof Ur))throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(m)}else{if(!a.webAudioMediaStreamDest||m instanceof Ur||m._bypassWebAudio)i.push({track:m,type:ve.LocalAudioTrack});else{const _=new Ur;_.addAudioTrack(m),i.push({track:_,type:ve.LocalAudioTrack})}h=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Sm(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof gr){const a=this.localTrackMap.get(ve.LocalAudioTrack);if(!a)continue;a.track instanceof Ur?(a.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),a.track.trackList.length===0&&(t.push([ve.LocalAudioTrack,a]),a.track.close())):t.push([ve.LocalAudioTrack,a])}if(i instanceof _n){const a=this.localTrackMap.get(ve.LocalVideoTrack);if(!a)continue;t.push([ve.LocalVideoTrack,a]);const l=this.localTrackMap.get(ve.LocalVideoLowTrack);l&&t.push([ve.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ve.LocalVideoTrack:n.addListener(Ge.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ur?e.trackList.forEach(n=>{n.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ge.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case ve.LocalVideoTrack:n.off(Ge.GET_STATS,this.handleGetLocalVideoStats),n.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ur?e.trackList.forEach(t=>{t.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ge.GET_STATS,this.handleGetLocalAudioStats),t.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ge.GET_STATS,this.handleGetLocalAudioStats),e.off(Ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof km&&t.addListener(Ge.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Lm&&t.addListener(Ge.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Ve.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Ve.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var a;let l,{track:u,type:h}=n;switch(h){case ve.LocalAudioTrack:l=ln.Audio;break;case ve.LocalVideoTrack:l=Ee(a=u._hints).call(a,sn.SCREEN_TRACK)?ln.Screen:ln.High;break;case ve.LocalVideoLowTrack:l=ln.Low}return{kind:h===ve.LocalAudioTrack?Ve.AUDIO:Ve.VIDEO,stream_type:l,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:u.muted||!u.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ve.LocalVideoTrack:i=Ee(n=l._hints).call(n,sn.SCREEN_TRACK)?ln.Screen:ln.High;break;case ve.LocalAudioTrack:i=ln.Audio;break;case ve.LocalVideoLowTrack:i=ln.Low}return{stream_type:i,ssrcs:u,mid:h}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:a,type:l}=n;this.localTrackMap.set(l,{track:a,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Xe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Ee(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await qr(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:gn.TRACER}).onSuccess(),this.emit(Xe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var a;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(a=i.audioTrack)===null||a===void 0||a.emit(Ua.FIRST_FRAME_DECODED),Be.firstRemoteFrame(this.store.sessionId,Mr.FIRST_AUDIO_DECODE,Fn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);i&&Be.firstRemoteFrame(this.store.sessionId,Mr.FIRST_AUDIO_RECEIVED,Fn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(Hs(n=this.remoteUserMap).call(n)).find(a=>a._videoSSRC===t);i&&Be.firstRemoteFrame(this.store.sessionId,Mr.FIRST_VIDEO_RECEIVED,Fn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",a=n.candidateType==="relay";n.candidateType!=="unknown"&&i===a||this.emit(Xe.ConnectionTypeChange,i),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ud(n))," -> ").concat(JSON.stringify(Ud(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ud(n))," -> ").concat(JSON.stringify(Ud(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Xe.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===hi.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,w.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===hi.SEND_ONLY?this.restartICE(e):Pr(this,Xe.RequestP2PRestartICE,{direction:hi.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ve.LocalAudioTrack);if(e instanceof gr&&(n==null?void 0:n.track)instanceof Ur)return n.track.isActive||t.push([ve.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(i&&(t.push(i),i[0]===ve.LocalVideoTrack)){const a=this.localTrackMap.get(ve.LocalVideoLowTrack);a&&t.push([ve.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ve.LocalAudioTrack);if(e instanceof gr&&(n==null?void 0:n.track)instanceof Ur)return n.track.isActive&&t.push([ve.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(i)if(i[0]===ve.LocalVideoTrack){t.push(i);const a=this.localTrackMap.get(ve.LocalVideoLowTrack);a&&t.push([ve.LocalVideoLowTrack,a])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ve.LocalAudioTrack:i=ln.Audio;break;case ve.LocalVideoTrack:i=Ee(n=l._hints).call(n,sn.SCREEN_TRACK)?ln.Screen:ln.High;break;case ve.LocalVideoLowTrack:i=ln.Low}return{stream_type:i,ssrcs:u,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[a,{track:l,ssrcs:u,id:h}]=t;switch(a){case ve.LocalAudioTrack:i=ln.Audio;break;case ve.LocalVideoTrack:i=Ee(n=l._hints).call(n,sn.SCREEN_TRACK)?ln.Screen:ln.High;break;case ve.LocalVideoLowTrack:i=ln.Low}return{stream_type:i,ssrcs:u,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const a=i.get(t);if(!a)return n;n.push([e,{kind:t,id:a}])}else Array.from(i.entries()).forEach(a=>{let[l,u]=a;n.push([e,{kind:l,id:u}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:a,id:l}]=n;switch(a){case Ve.VIDEO:return void(i._videoSSRC&&t.push({stream_type:Ve.VIDEO,ssrcId:i._videoSSRC}));case Ve.AUDIO:return void(i._audioSSRC&&t.push({stream_type:Ve.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const a=this.remoteUserMap.get(n);a&&(a.delete(i),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ve.LocalVideoTrack),n=this.localTrackMap.get(ve.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Ne((i,a)=>{this.handleUpdateVideoEncoder(t.track,i,a,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Ne((i,a)=>{this.handleUpdateVideoEncoder(n.track,i,a,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof gr){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await Sn(this,Xe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Xe.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Xe.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await qr(AS(this.dtlsFailedCount,Cr)),this.emit(Xe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ve.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof _n)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof _n).length>1)throw new ae(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof gr).length>1&&(e.some(t=>t instanceof gr&&t._bypassWebAudio)||!jt().webAudioMediaStreamDest))throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof _n&&this.pendingLocalTracks.some(n=>n instanceof _n))throw new ae(U.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof gr&&this.pendingLocalTracks.some(n=>n instanceof gr)&&(!jt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof gr&&n._bypassWebAudio)))throw new ae(U.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&jt().supportDualStreamEncoding,i=K0(K0({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=n?e._mediaStreamTrack.clone():RI(e,i);const l=on(8,"track-low-"),u=new _n(a,K0(K0({},n&&{scaleResolutionDownBy:nI(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,l);return u.on(_h.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,Nm.LOW_STREAM)}),u._hints.push(sn.LOW_STREAM),e.addListener(Ge.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var a;const l=Array.from(Hs(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===e);if(l){i||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,h=u.subscribe.find(m=>m.userId===l.uid&&m.type==="video");Be.firstRemoteVideoDecode(this.store.sessionId,Mr.FIRST_VIDEO_DECODE,Fn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const a=i.get(t);if(!a)return!1;const l=await this.recvConnection.getRemoteSSRC(a);return l!==void 0&&l!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new ae(U.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new ae(U.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new ae(U.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new ae(U.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new ae(U.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new ae(U.NOT_SUPPORTED)}async preConnect(e){throw new ae(U.NOT_SUPPORTED)}getEstablishParams(){throw new ae(U.NOT_SUPPORTED)}async reSubscribe(e){throw new ae(U.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new ae(U.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ve.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Nm.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Ae(Qn.prototype,"p2pConnect",[GG],Object.getOwnPropertyDescriptor(Qn.prototype,"p2pConnect"),Qn.prototype),Ae(Qn.prototype,"unpublish",[WG],Object.getOwnPropertyDescriptor(Qn.prototype,"unpublish"),Qn.prototype),Ae(Qn.prototype,"unpublishLowStream",[HG],Object.getOwnPropertyDescriptor(Qn.prototype,"unpublishLowStream"),Qn.prototype),Ae(Qn.prototype,"subscribe",[KG],Object.getOwnPropertyDescriptor(Qn.prototype,"subscribe"),Qn.prototype),Ae(Qn.prototype,"mockSubscribe",[zG],Object.getOwnPropertyDescriptor(Qn.prototype,"mockSubscribe"),Qn.prototype),Ae(Qn.prototype,"unsubscribe",[qG],Object.getOwnPropertyDescriptor(Qn.prototype,"unsubscribe"),Qn.prototype),Ae(Qn.prototype,"muteRemote",[YG],Object.getOwnPropertyDescriptor(Qn.prototype,"muteRemote"),Qn.prototype),Ae(Qn.prototype,"unmuteRemote",[XG],Object.getOwnPropertyDescriptor(Qn.prototype,"unmuteRemote"),Qn.prototype),Ae(Qn.prototype,"hasRemoteMediaWithLock",[QG],Object.getOwnPropertyDescriptor(Qn.prototype,"hasRemoteMediaWithLock"),Qn.prototype),Ae(Qn.prototype,"disconnectForReconnect",[JG],Object.getOwnPropertyDescriptor(Qn.prototype,"disconnectForReconnect"),Qn.prototype),Ae(Qn.prototype,"remoteMediaSsrcChanged",[$G],Object.getOwnPropertyDescriptor(Qn.prototype,"remoteMediaSsrcChanged"),Qn.prototype),Qn);function ac(e){return function(t,n,i){const a=t[n];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];switch(e){case ic.SEND_ONLY:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,u)}finally{m()}}case ic.RECEIVE_ONLY:{const m=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,u)}finally{m()}}default:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n)),g=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await a.apply(this,u)}finally{m(),g()}}}},i}}class Uh extends Yn{constructor(t,n){super(),O(this,"signal",void 0),O(this,"token",void 0),O(this,"tokenTimeout",void 0),O(this,"tokenInterval",void 0),O(this,"_sequence",0),O(this,"userMap",new Map),O(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===Bt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*j("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,a,l){var u;if(this.userMap.size===0)return;const h=Array.from(Yi(u=this.userMap).call(u))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),a=a??on(6,""),l=l??this._sequence++;const m={_id:a,_type:t,_seq:l,_message:n,token:"".concat(this.token,"_").concat(h)};j("SHOW_P2P_LOG")&&w.debug("send message",m,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(m)).forEach(_=>{this.signal.request(Ye.DATA_STREAM,{payload:Dd(this.encoder.encode(_))})});const g=new Ne((_,v)=>{const S=window.setTimeout(()=>{this.off("res-@".concat(a,"_ack"),T),this.off("res-@".concat(a),x),this.off(Fm.ABORT,P),w.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(a)),this.userMap.size===0?v(new ae(U.INVALID_REMOTE_USER)):v(new ae(U.TIMEOUT))},j("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{S&&window.clearTimeout(S),this.off(Fm.ABORT,P),i&&_()},P=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(a,"_ack"),T),this.off("res-@".concat(a),x),v(new ae(U.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(a)))};this.once(Fm.ABORT,P),this.once("res-@".concat(a,"_ack"),T);const x=(M,F)=>{N=!0,S&&window.clearTimeout(S),this.off("res-@".concat(a,"_ack"),T),this.off(Fm.ABORT,P),M==="success"?_(F):v(new ae(U.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(a)))};let N=!1;i||(this.once("res-@".concat(a),x),qr(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{N||w.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(a,", ").concat(m))}))});try{return await g}catch(_){if(_.code===U.TIMEOUT)return await this.send(t,n,i,a,l);throw _}}onMessage(t){var n;const{_uid:i}=t;let a,l=this.userMap.get(i);if(l)a=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==yr.CHECK)return;const{token:g}=t;a=new Map,l={uid:i,isStart:!0,token:g,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,l),this.signal.emit(pt.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var u;const{id:g,total:_}=t,v=(u=a.get(g))!==null&&u!==void 0?u:[];if(v.push(t),a.has(g)||a.set(g,v),v.length!==_)return;{const S=Ju(v).call(v,(T,P)=>T.index-P.index).map(T=>T.payload).join("");a.delete(g),(t=JSON.parse(S))._uid=i}}const{_type:h,token:m}=t;if(Ee(n=[yr.ACK,yr.CHECK]).call(n,h))return h===yr.CHECK&&this.handleCheckToken(l,m),void this.receiveMessage(t);m==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):w.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:on(6,""),token:this.token,_type:yr.CHECK};j("SHOW_P2P_LOG")&&w.debug("send message",t),this.signal.request(Ye.DATA_STREAM,{payload:Dd(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:yr.ACK,token:this.token};j("SHOW_P2P_LOG")&&w.debug("send message",n),this.signal.request(Ye.DATA_STREAM,{payload:Dd(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(yr.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:v}=g;for(;_.has(v);){const S=_.get(v);_.delete(v),this.receiveMessage(S),g.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:a}=t,l=this.userMap.get(i),{receivedMessagesMap:u,isStart:h,nextExpectedSequenceNumber:m}=l;if(a<m)return this.ack(t._id),void w.debug("[external-signal] receive old message, seq: ".concat(a,", ").concat(t._message));u.set(a,t),h&&a===m&&(this.receiveMessage(t),u.delete(m),l.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:a,_uid:l}=t;if(j("SHOW_P2P_LOG")&&w.debug("receive message",t),n){let u;switch(t._type!==yr.ACK&&(a&&(u=JSON.parse(a)),this.ack(t._id)),t._type){case yr.CANDIDATE:case yr.CONTROL:this.signal.emit(i,u,l);break;case yr.PUBLISH:case yr.UNPUBLISH:case yr.RESTART_ICE:case yr.CALL:u.uid=l,Pr(this.signal,i,u).then(h=>{this.response(t._id,h)}).catch(()=>{this.response(t._id,void 0,!0)});break;case yr.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case yr.RESPONSE:{const{success:h,message:m}=u;this.emit("res-@".concat(n),h?"success":"failed",m);break}}}}splitMessage(t){if(t.length<Uh.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),a=on(6,"");let l=0,u=800;const h=Math.ceil(t.length/u);for(;t.length>0;){l++;const m={id:a,index:l,total:h,payload:t.slice(0,u),token:"".concat(this.token,"_").concat(i)};JSON.stringify(m).length>Uh.MAX_MESSAGE_SIZE?u-=50:(n.push(m),t=t.slice(u))}return n.map(m=>JSON.stringify(m))}handleCheckToken(t,n){return t.token!==n?(w.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{w.debug("token timeout, ".concat(n)),this.reset(t.uid)},j("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Pr(this.signal,yr.CALL,void 0),n=await this.send(yr.CALL,t);this.signal.emit(He.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(Fm.ABORT),this.signal.emit(pt.ON_USER_OFFLINE,{uid:i.uid,reason:y_e.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(w.debug("change local token from ".concat(n," to ").concat(n)),this.token=on(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Fm.ABORT)}}O(Uh,"MAX_SIZE",1),O(Uh,"MAX_MESSAGE_SIZE",1024);class iye extends Yn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Bt.CONNECTED?this.emit(He.WS_CONNECTED):t===Bt.RECONNECTING?this.emit(He.WS_RECONNECTING,this._websocketReconnectReason):t===Bt.CLOSED&&this.emit(He.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),O(this,"__name__","P2PSignal"),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Bt.CLOSED),O(this,"reconnectToken",void 0),O(this,"p2pToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new iN(5)),O(this,"pingpongTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"_external_signal",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(He.ON_BINARY_DATA,i.data);const a=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const l="res-@".concat(a._id);this.emit(l,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){switch(a._type){case pt.ON_DATA_STREAM:return void this.handleDataStream(a._message);case pt.MUTE_AUDIO:case pt.MUTE_VIDEO:case pt.ON_P2P_LOST:case pt.ON_USER_ONLINE:return;case pt.ON_USER_OFFLINE:const{uid:l}=a._message;return w.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(a._type,a._message),a._type===pt.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===pt.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(Ft.UID_BANNED);break;case 15:this.close(Ft.IP_BANNED);break;case 16:this.close(Ft.CHANNEL_BANNED)}if(a._type===pt.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case $e.ERR_LICENSE_MISSING:this.close(Ft.LICENSE_MISSING);break;case $e.ERR_LICENSE_EXPIRED:this.close(Ft.LICENSE_EXPIRED);break;case $e.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ft.LICENSE_MINUTES_EXCEEDED);break;case $e.ERR_LICENSE_PERIOD_INVALID:this.close(Ft.LICENSE_PERIOD_INVALID);break;case $e.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ft.LICENSE_MULTIPLE_SDK_SERVICE);break;case $e.ERR_LICENSE_ILLEGAL:this.close(Ft.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new ZN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Bt.CONNECTED&&this.reconnect("retry",Rs.OFFLINE)}),this.p2pToken=on(6,""),this._external_signal=new Uh(this,this.p2pToken)}async request(t,n,i,a){const l=on(6,""),u={_id:l,_type:t,_message:n},h=this.websocket.connectionID,m=()=>new Ne((P,x)=>{if(this.connectionState===Bt.CONNECTED)return P();const N=()=>{this.off(He.WS_CLOSED,M),P()},M=()=>{this.off(He.WS_CONNECTED,N),x(new ae(U.WS_ABORT))};this.once(He.WS_CONNECTED,N),this.once(He.WS_CLOSED,M)});if(this.connectionState!==Bt.CONNECTING&&this.connectionState!==Bt.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await m(),this.websocket.sendMessage(u,!0),a)return;const g=new Ne((P,x)=>{let N=!1;const M=(q,J)=>{N=!0,P({isSuccess:q==="success",message:J||{}}),this.off(He.WS_CLOSED,F),this.off(He.WS_RECONNECTING,F),this.emit(He.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),M);const F=()=>{x(new ae(U.WS_ABORT,"type: ".concat(t))),this.off(He.WS_CLOSED,F),this.off(He.WS_RECONNECTING,F),this.off("res-@".concat(l),M)};this.once(He.WS_CLOSED,F),this.once(He.WS_RECONNECTING,F),qr(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||N||(w.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(He.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(P){if(this.connectionState===Bt.CLOSED||t===Ye.LEAVE)throw new ae(U.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?P.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await m(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),S=Ch(v),T=new ae(U.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:v,data:_.message,desc:S.desc});return S.action==="success"?_.message:(w.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(S.desc,", action: ").concat(S.action)),v===$e.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=T,this.close()),T.throw()):S.action==="failed"?T.throw():S.action==="quit"?(this.initError=T,this.close(),T.throw()):(v===$e.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Rs.MULTI_IP)):this.reconnect(S.action,Rs.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ne(i=>{const a=l=>{(!n||n(l))&&(this.off(t,a),i(l))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(wh.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Bt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ne((n,i)=>{this.once(He.WS_CONNECTED,()=>n(this.joinResponse)),this.once(He.WS_CLOSED,()=>i(this.initError||new ae(U.WS_ABORT))),this.connectionState=Bt.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Ft.LEAVE,this.connectionState=Bt.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=on(6,""),this._external_signal.clear(),this._external_signal=new Uh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(He.ABORT_P2P_EXECUTION);const t=await Pr(this,He.REQUEST_JOIN_INFO),n=await this.request(Ye.JOIN,t);if(!n)return this.emit(He.REPORT_JOIN_GATEWAY,U.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(He.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const i=hh(t.payload),a=new TextDecoder().decode(i),l=JSON.parse(a);"total"in l&&"id"in l||Ee(n=Object.values(yr)).call(n,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(pt.ON_DATA_STREAM,t)}catch{this.emit(pt.ON_DATA_STREAM,t)}}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ch(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===$e.ERR_REPEAT_JOIN_CHANNEL&&j("IGNORE_UID_CHECK")?void this.close(Ft.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ft.UID_BANNED),void this.close()):void this.reconnect(n.action,Rs.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Rs.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),j("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(yt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(He.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(yt.CLOSED,()=>{this.connectionState=Bt.CLOSED}),this.websocket.on(yt.FAILED,()=>{this._disconnectedReason=Ft.NETWORK_ERROR,this.connectionState=Bt.CLOSED}),this.websocket.on(yt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Bt.CONNECTED?this.connectionState=Bt.RECONNECTING:this.connectionState=Bt.CONNECTING}),this.websocket.on(yt.WILL_RECONNECT,(t,n,i)=>{t!=="retry"?(w.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):w.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(yt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(He.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ae&&t.code===U.UNEXPECTED_RESPONSE&&t.data.code===$e.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Rs.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Rs.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(yt.REQUEST_NEW_URLS,(t,n)=>{Pr(this,He.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const aye={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new sye(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new iye(n,t)}};function eW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function tW(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eW(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eW(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class oye{constructor(t){O(this,"sessionDesc",void 0),O(this,"localCapabilities",void 0),O(this,"rtpCapabilities",void 0),O(this,"candidates",void 0),O(this,"_originCandidates",void 0),O(this,"iceParameters",void 0),O(this,"dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),t=On(t);const{iceParameters:n,dtlsParameters:i,candidates:a,rtpCapabilities:l,setup:u,localCapabilities:h,sdkCodec:m,cname:g}=t,_=li(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=a,this._originCandidates=On(a),this.iceParameters=n,this.dtlsParameters=i,this.setup=u,this.localCapabilities=h,this.cname=g;for(let v=0;v<_.mediaDescriptions.length;v++){const S=_.mediaDescriptions[v];if(S.attributes.iceUfrag=n.iceUfrag,S.attributes.icePwd=n.icePwd,S.attributes.fingerprints=i.fingerprints,S.attributes.candidates=a,S.attributes.setup=u,S.media.mediaType==="video"){S.media.fmts=l.videoCodecs.map(x=>x.payloadType.toString(10));const T=l.videoCodecs.filter(x=>{var N,M;return(N=x.rtpMap)===null||N===void 0?void 0:Ee(M=N.encodingName.toLowerCase()).call(M,m)}),P=l.videoCodecs.filter(x=>!Ee(T).call(T,x));S.attributes.payloads=[...T,...P],S.attributes.extmaps=l.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=l.audioCodecs.map(T=>T.payloadType.toString(10)),S.attributes.payloads=l.audioCodecs,S.attributes.extmaps=l.audioExtensions),_.mediaDescriptions[v]=this.mungMediaDesc(S)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return Ul(this.sessionDesc)}send(t,n,i){const{ssrcs:a,ssrcGroups:l}=L_(n,this.cname),u=this.sessionDesc.mediaDescriptions.find(g=>t===Ve.VIDEO?g.media.mediaType==="video":g.media.mediaType==="audio"),h=a[0].attributes.label,m=a[0].attributes.mslabel;return u.attributes.ssrcs=u.attributes.ssrcs.concat(a),u.attributes.ssrcGroups=u.attributes.ssrcGroups.concat(l),{id:h,mslabel:m}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:a}=n;return this.send(i,a,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],a=[],l=[];n.attributes.ssrcs.forEach(u=>{Ee(t).call(t,u.attributes.label||"")?l.push(u):i.push(u)}),n.attributes.ssrcGroups.forEach(u=>{var h;Ee(h=l.map(m=>m.ssrcId)).call(h,u.ssrcIds[0])||a.push(u)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=a})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((a,l)=>{const u=a._mediaStreamTrack,h=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===u.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],a);this.sessionDesc.mediaDescriptions[h]=m})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(a=>a.transport==="udp"),i=[];if(n.forEach(a=>{i.push(tW(tW({},a),{},{foundation:"tcpcandidate",priority:Number(a.priority)-1+"",transport:"tcp",port:Number(a.port)+90+""}))}),n.length!==0){switch(t){case as.TCP_RELAY:this.candidates=i;break;case as.UDP_TCP_RELAY:case as.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const a of this.sessionDesc.mediaDescriptions)a.attributes.candidates=this.candidates}}restartICE(t){t=On(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=On(t);return Rh(i,n),iI(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(i!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=a}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const a=this.sessionDesc.mediaDescriptions.find(u=>t===Ve.VIDEO?u.attributes.mid==="video":u.attributes.mid==="audio");if(a){const u=a.attributes.ssrcs.find(h=>h.attributes.label===n);var l;u&&(u.attributes.label=i,(l=u.attributes.msid)===null||l===void 0||l.replace(n,i))}}mungMediaDesc(t){const n=On(t);return sI(n),function(i){const a=i.attributes.extmaps.find(l=>u0(l.extensionName));a&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(a),1),i.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var Tn;function nW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function z0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nW(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nW(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let cye=(Tn=class kE extends a0{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ee(n=Object.keys(fh)).call(n,t)}))]}constructor(t,n){super(t,n),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"statsFilter",void 0),O(this,"useRTX",!1),O(this,"localCapabilities",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"establishPromise",void 0),O(this,"mutex",void 0),this.store=n,this.mutex=new is("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(kE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=kS(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,An()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Qc(t.sdp),i=k_(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,z0(z0({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new ae(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new oye(z0(z0({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new ae(U.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return vi(function*(){const a=yield Rt(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(S=>i.peerConnection.addTrack(S._mediaStreamTrack)),u=yield Rt(i.peerConnection.createOffer()),h=li(u.sdp),m=t.map(S=>{const T=S._mediaStreamTrack,P=h.mediaDescriptions.find(x=>x.attributes.mid===T.kind);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return function(x,N,M){const F=x.attributes.ssrcs.filter(J=>J.attributes.label===N),q=x.attributes.ssrcGroups;if(F.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(q&&F.length>1){const J=q.find(te=>te.ssrcIds.indexOf(F[0].ssrcId)!==-1);return J?[{ssrcId:J.ssrcIds[0],rtx:M?J.ssrcIds[1]:void 0}]:[{ssrcId:F[0].ssrcId}]}return[{ssrcId:F[0].ssrcId}]}(P,T.id,i.useRTX)});let g;try{g=yield m}catch(S){throw l.forEach(T=>{ss()&&T.replaceTrack(null),i.peerConnection.removeTrack(T)}),S}const _=i.mungSendOfferSDP(u.sdp,t);i.remoteSDP.receive(t,n,g);const v=i.remoteSDP.toString();return yield Rt(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Rt(i.applySendEncodings(l,t)),yield Rt(i.peerConnection.setRemoteDescription({type:"answer",sdp:v})),t.map((S,T)=>{const P=S._mediaStreamTrack.id;return{localSSRC:m[T],id:P}})}catch(l){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{a()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(l=>{var u;return t.indexOf(((u=l.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(l=>{ss()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:u}=this.remoteSDP.send(t,n,a),h=new Ne((_,v)=>{const S=setTimeout(()=>{v(new Error("Cannot receive track, id: ".concat(l)))},1e4),T=P=>{const x=qt();if((x.name==="Safari"&&Number(x.version)===11||Ws())&&P.track.id!==l&&P.streams[0].id===u){var N;const M=P.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(t,l,P.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(S),void _(M)}if(P.track.id===l)return this.peerConnection.removeEventListener("track",T),clearTimeout(S),void _(P.track)};this.peerConnection.addEventListener("track",T)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(g),{track:await h,id:l}}catch(l){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var a;return t.indexOf(((a=i.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(ss()&&i.track)i.track.enabled=!1;else{const a=i.getParameters();a.encodings.forEach(l=>l.active=!1),i.setParameters(a)}})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(l=>{var u;return t.indexOf(((u=l.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async l=>{if(ss()&&l.track)l.track.enabled=!0;else{const u=l.getParameters();u.encodings.forEach(h=>h.active=!0),await l.setParameters(u)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return vi(function*(){const i=yield Rt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=jt().supportPCSetConfiguration;if(t===as.RELAY&&!a)return;if(a){const g=n.peerConnection.getConfiguration(),_=t===as.RELAY?"relay":"all";g.iceTransportPolicy!==_&&(w.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(_,"]")),g.iceTransportPolicy=_,n.peerConnection.setConfiguration(g))}t!==as.RELAY&&n.remoteSDP.updateCandidates(t);const l=yield Rt(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=Qc(l.sdp),{remoteIceParameters:h}=yield u.iceParameters;n.remoteSDP.restartICE(h);const m=n.remoteSDP.toString();yield Rt(n.peerConnection.setLocalDescription(l)),yield Rt(n.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(a){w.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new ae(U.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(a=>{var l;return((l=a.track)===null||l===void 0?void 0:l.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(a=>{var l;return((l=a.track)===null||l===void 0?void 0:l.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new ae(U.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new ae(U.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(ch(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...kE.turnServerConfigToIceServers(t.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...kE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find(g=>{var _;return((_=g.track)===null||_===void 0?void 0:_.id)===t._mediaStreamTrack.id})),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!jt().supportSetRtpSenderParameters)return w.warn("Browser not support set rtp-sender parameters");const a={},l={};if(t instanceof _n)switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(j("DSCP_TYPE")&&Hc()){var u;const g=j("DSCP_TYPE");Ee(u=["very-low","low","medium","high"]).call(u,g)&&(l.networkPriority=g)}const h=n.getParameters(),m=(i=h.encodings)===null||i===void 0?void 0:i[0];m&&Object.assign(m,l),Object.assign(h,a),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await n.setParameters(h)}async applySendEncodings(t,n){try{if(!jt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const a=t[i],l=n[i];a&&l&&await this.updateRtpSenderEncodings(l,a)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=li(t);return n.forEach((a,l)=>{const u=a._mediaStreamTrack,h=i.mediaDescriptions.find(m=>m.attributes.mid===u.kind);h&&Rh(h,a)}),Ul(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((l,u)=>{let{id:h,mslabel:m}=l;const{kind:g}=t[u];return new Ne((_,v)=>{const S=setTimeout(()=>{v(new Error("Cannot receive track, id: ".concat(h)))},1e4),T=P=>{const x=qt();if(x.name==="Safari"&&Number(x.version)===11&&P.track.id!==h&&P.streams[0].id===m){var N;const M=P.streams[0].getTracks()[0];return(N=this.remoteSDP)===null||N===void 0||N.updateTrackLabel(g,h,P.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(S),void _({track:M,id:h})}if(P.track.id===h)return this.peerConnection.removeEventListener("track",T),clearTimeout(S),void _({track:P.track,id:h})};this.peerConnection.addEventListener("track",T)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),await Ne.all(n)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(jt().supportPCSetConfiguration){const n=kE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Ae(Tn.prototype,"connect",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"connect"),Tn.prototype),Ae(Tn.prototype,"stopSending",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"stopSending"),Tn.prototype),Ae(Tn.prototype,"receive",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"receive"),Tn.prototype),Ae(Tn.prototype,"stopReceiving",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"stopReceiving"),Tn.prototype),Ae(Tn.prototype,"muteRemote",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"muteRemote"),Tn.prototype),Ae(Tn.prototype,"unmuteRemote",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteRemote"),Tn.prototype),Ae(Tn.prototype,"muteLocal",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"muteLocal"),Tn.prototype),Ae(Tn.prototype,"unmuteLocal",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteLocal"),Tn.prototype),Ae(Tn.prototype,"close",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),Ae(Tn.prototype,"updateEncoderConfig",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"updateEncoderConfig"),Tn.prototype),Ae(Tn.prototype,"updateSendParameters",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"updateSendParameters"),Tn.prototype),Ae(Tn.prototype,"replaceTrack",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),Ae(Tn.prototype,"getRemoteSSRC",[Ha],Object.getOwnPropertyDescriptor(Tn.prototype,"getRemoteSSRC"),Tn.prototype),Tn);function Ha(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("Locking from P2PConnection.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{l()}},n}const lye={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new cye(n,t)}},dye={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jt().supportWebRTCEncodedTransform)return void w.warning("browser not support audio encoded transform");if(qS.has(e)||!e.track)return;const n={track:e.track};if(jl()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(u){return void w.error("create audio-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const m=t.metadata&&t.metadata();m?function(g,_){const{chunk:v,controller:S}=_,T=kd.METADATA;v.data=function(P,x,N){const M=N.byteLength,F=M+jN+JB,q=kN+LN+F,J=new ArrayBuffer(P.byteLength+q),te=new DataView(J);te.setUint8(0,QB),te.setUint16(1,F),te.setUint8(3,x),te.setUint16(4,M);for(let ne=0;ne<M;ne++)te.setUint8(6+ne,N[ne]);const Y=new Uint8Array(te.buffer);return Y.set(new Uint8Array(P),q),Y.buffer}(v.data,T,g),S.enqueue(v)}(m,{sender:e,chunk:u,controller:h}):h.enqueue(u)}});a.readable.pipeThrough(l).pipeTo(a.writable)}else if(ss()){if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const a=zS(),l=new MessageChannel;await new Ne(h=>a.onmessage=m=>{m.data==="registered"&&h(void 0)});const u=new RTCRtpScriptTransform(a,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=u,await new Ne(h=>a.onmessage=m=>{m.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var m;if(h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id)w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(h.data.getMetadata){const g=t.metadata&&t.metadata();g&&l.port1.postMessage({metadata:g})}},n.worker=a}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const a=qS.get(e);if(a){qS.delete(e);try{var l,u;(l=a.controller)===null||l===void 0||l.terminate(),(u=a.worker)===null||u===void 0||u.terminate()}catch(h){w.warning(h&&h.message)}}}qS.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jt().supportWebRTCEncodedTransform)return void w.warning("browser not support audio encoded transform");if(ZS.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(jl()&&!Ws()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");Kx(Qt.CHROME,87,116)||(t.enableTopn=!1);let a=null;try{a=e.createEncodedStreams()}catch(u){return void w.error("create audio-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?function(m,g,_){var v;const S=MN(new DataView(g.data));if(!S)return _.enqueue(g);const T=m.track.id;Bge.set(T,m.track);const P=(v=S.tlv.find(J=>J.tag===kd.AUDIO_LEVEL))===null||v===void 0?void 0:v.value;let x=0;typeof P=="number"&&(x=127-P);const N=Math.round(Math.pow(10,x/60)-1),{selected:M,speaker:F}=function(J,te){let Y=jm.get(J);if(Y||(Y=function(ne){const ue=new ZB;return jm.set(ne,ue),Jo||(Jo=new Vge(j("TOPN_SILENCE_THRESHOLD")||500),Jo.on("ActiveSpeakerChanged",fe=>{fe!=null&&(QS=fe)})),Jo.addSpeakers([ue]),ue}(J)),jm.size<=e3)return{selected:!0,speaker:Y};if(!Jo)throw new Error("no active speaker detector");return Jo.levelChanged(Y.id,te),Sh=Jo.loudest.map(ne=>ne.id),QS&&!Ee(Sh).call(Sh,QS)&&Sh.length>=e3&&Sh.pop(),{selected:Ee(Sh).call(Sh,Y.id)||Y.id===QS,speaker:Y}}(m,N),q=function(J,te,Y){const ne=$o.get(J)||new Fge(J,te);return ne.score=Y,$o.set(J,ne),function(ue){if(JS.set(ue,!0),!$S)return void($S=Date.now());const fe=Date.now();fe-$S>1e3&&(JS.get(ue)?JS.set(ue,!1):(t3(ue),JS.delete(ue)),$S=fe)}(J),ne}(T,m.track,F.energyScore);q.addSample(M),q.active&&(g.data=S.frame.buffer,_.enqueue(g))}(e,u,h):t.enableMetadata||t.enablePts?function(m,g,_,v){const S=new DataView(m.data),T=S.getUint8(0);let P;if(128&T&&T!==71){const M=function(F){if(F.byteLength<=0)return[];const q=[];let J=0;for(;J<F.byteLength;){const Y=(128&F.getUint8(J))>>7,ne=127&F.getUint8(J);if(!(Y&&J+4<=F.byteLength)){J++;break}{const ue=F.getUint32(J,!1),fe=(16776192&ue)>>10,Me=1023&ue;q.push({pt:ne,ts_offset:fe,length:Me,data:new Uint8Array}),J+=4}}let te=F.byteLength-J;for(const Y of q){if(Y.length>te)return console.warn("Broken red payload"),[];Y.length>0&&(Y.data=new Uint8Array(F.buffer,F.byteOffset+J,Y.length),J+=Y.length,te-=Y.length)}if(te>0){const Y={pt:q.length>0?q[q.length-1].pt:0,ts_offset:0,length:te,data:new Uint8Array(F.buffer,F.byteOffset+J,te)};q.push(Y)}return q}(S);if(M.length>0){const F=function(q){let J=0;for(let ne=0;ne<q.length;ne++)J+=ne<q.length-1?4:1,J+=q[ne].length;const te=new Uint8Array(J);let Y=0;for(let ne=0;ne<q.length;ne++)if(ne<q.length-1){const ue=(2147483648|(127&q[ne].pt)<<24|(262143&q[ne].ts_offset)<<10|1023&q[ne].length)>>>0;te[Y++]=ue>>24&255,te[Y++]=ue>>16&255,te[Y++]=ue>>8&255,te[Y++]=255&ue}else te[Y++]=127&q[ne].pt;for(const ne of q)te.set(ne.data,Y),Y+=ne.length;return te}(M.map(q=>{const J=new Uint8Array(q.length);J.set(q.data);const te=MN(new DataView(J.buffer));return te!=null&&te.frame&&(q.data=te==null?void 0:te.frame),P=te,q}));m.data=F.buffer}}else P=MN(S),P&&(m.data=P.frame.buffer);if(g.enqueue(m),!P)return;const x=P.tlv.find(M=>M.tag===kd.METADATA);x&&_&&x.value instanceof Uint8Array&&_(x.value);const N=P.tlv.find(M=>M.tag===kd.AUDIO_64_BIT_PTS);N&&v&&N.value instanceof Uint8Array&&N.value.length==8&&v(new DataView(N.value.buffer).getBigUint64(0,!0))}(u,h,t.onMetadata,t.onPts):h.enqueue(u)}});a.readable.pipeThrough(l).pipeTo(a.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const a=zS(),l=new MessageChannel;await new Ne(h=>a.onmessage=m=>{m.data==="registered"&&h(void 0)});const u=new RTCRtpScriptTransform(a,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=u,await new Ne(h=>a.onmessage=m=>{m.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var m;h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id?(w.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):h.data.metadata&&n.onMetadata?n.onMetadata(h.data.metadata):h.data.pts&&n.onPts&&n.onPts(h.data.pts)},n.worker=a}function i(){e.track.removeEventListener("ended",i),function(a){const l=ZS.get(a);if(l){(function(m){const g=jm.get(m);g&&(jm.delete(m),Jo&&(Jo.removeSpeakers([g]),jm.size===0&&(Jo.destroy(),Jo=null)))})(a),t3(a.track.id),ZS.delete(a);try{var u,h;(u=l.controller)===null||u===void 0||u.terminate(),(h=l.worker)===null||h===void 0||h.terminate()}catch(m){w.warning(m&&m.message)}}}(e)}ZS.set(e,n),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!jt().supportWebRTCEncodedTransform)return void w.warning("browser not support video encoded transform");if(e0.has(e)||!e.track)return;const n={track:e.track};if(jl()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(h){return void w.error("create video-encoded-streams error",h&&h.message)}const l=[];t.on("sei-to-send",h=>{l.push(h)});const u=new TransformStream({transform(h,m){n.controller||(n.controller=m),e.track&&e.track.id!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const g=s3(new Uint8Array(h.data)),_=l.shift();if(_){const v=function(S,T,P){switch(P){case BN:return function(x,N){const M=r3(N),F=M.length,q=Math.floor(F/255),J=F%255,te=new Uint8Array(6+q+1+F+x.byteLength);te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=6,te[5]=101;let Y=0;for(;Y<q;)te[6+Y]=255,Y++;return te[6+Y]=J,Y++,te.set(M,6+Y),te.set(new Uint8Array(x),6+Y+F),te.buffer}(S,T);case GN:return function(x,N){const M=r3(N),F=M.length,q=Math.floor(F/255),J=F%255,te=new Uint8Array(7+q+1+F+1+x.byteLength);te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=78,te[5]=1,te[6]=101;let Y=0;for(;Y<q;)te[7+Y]=255,Y++;return te[7+Y]=J,Y++,te.set(M,7+Y),Y+=F,te[7+Y]=128,Y++,te.set(new Uint8Array(x),7+Y),te.buffer}(S,T);default:return null}}(h.data,_,g);v&&(h.data=v)}m.enqueue(h)}});a.readable.pipeThrough(u).pipeTo(a.writable)}else{if(!ss())return;{if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const a=zS(),l=new MessageChannel;await new Ne(h=>a.onmessage=m=>{m.data==="registered"&&h(void 0)});const u=new RTCRtpScriptTransform(a,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=u,await new Ne(h=>a.onmessage=m=>{m.data==="started"&&h(void 0)}),t.on("sei-to-send",h=>{l.port1.postMessage({sei:h})}),l.port1.onmessage=h=>{var m;h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=a}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const a=e0.get(e);if(a){e0.delete(e);try{var l,u;(l=a.controller)===null||l===void 0||l.terminate(),(u=a.worker)===null||u===void 0||u.terminate()}catch(h){w.warning(h&&h.message)}}}e0.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jt().supportWebRTCEncodedTransform)return void w.warning("browser not support video encoded transform");if(!e.track)return;if(A_.has(e)){const a=A_.get(e);return void(a&&(a.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(jl()){if(!e.createEncodedStreams)return void w.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(u){return void w.error("create video-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,h){if(n.controller||(n.controller=h),!n.firstFrameInfo){var m;const _=u.getMetadata()||{};n.firstFrameInfo=Rn({type:u.type,rtpTimestamp:u.timestamp,payloadType:_.payloadType||0,ssrc:_.synchronizationSource||0,length:u.data.byteLength},"mimeType"in _?{mimeType:_.mimeType}:{}),(m=t.onFirstFrame)===null||m===void 0||m.call(t,n.firstFrameInfo)}e.track&&e.track.id!==n.track.id&&(w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const g=function(_,v){switch(v){case BN:return function(S){const T=new DataView(S.data);let P=0;for(;P+4<S.data.byteLength;){if(T.getUint8(P+0)===0&&T.getUint8(P+1)===0&&T.getUint8(P+2)===0&&T.getUint8(P+3)===1&&T.getUint8(P+4)===6){let x=P+6,N=0,M=0;for(;(M=T.getUint8(x++))===255;)N+=255;N+=M;const F=n3(S.data,x,N);return new Uint8Array(F)}P++}return null}(_);case GN:return function(S){const T=new DataView(S.data);let P=0;for(;P+5<S.data.byteLength;){if(T.getUint8(P+0)===0&&T.getUint8(P+1)===0&&T.getUint8(P+2)===0&&T.getUint8(P+3)===1&&T.getUint8(P+4)===78&&T.getUint8(P+5)===1&&T.getUint8(P+6)===101){let x=P+7,N=0,M=0;for(;(M=T.getUint8(x++))===255;)N+=255;N+=M;const F=n3(S.data,x,N);return new Uint8Array(F)}P++}return null}(_);default:return null}}(u,s3(new Uint8Array(u.data)));g&&n.onSei&&n.onSei(g),h.enqueue(u)}});a.readable.pipeThrough(l).pipeTo(a.writable)}else if(ss()){if(typeof RTCRtpScriptTransform>"u")return void w.warning("browser not support RTCRtpScriptTransform");const a=zS(),l=new MessageChannel;await new Ne(h=>a.onmessage=m=>{m.data==="registered"&&h(void 0)});const u=new RTCRtpScriptTransform(a,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=u,await new Ne(h=>a.onmessage=m=>{m.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var m;if(h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id)w.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(h.data.sei&&n.onSei)n.onSei(h.data.sei);else if(h.data.firstFrameInfo&&t.onFirstFrame){var g;(g=t.onFirstFrame)===null||g===void 0||g.call(t,h.data.firstFrameInfo)}},n.worker=a}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(a){const l=A_.get(a);if(l){A_.delete(a);try{var u,h;(u=l.controller)===null||u===void 0||u.terminate(),(h=l.worker)===null||h===void 0||h.terminate()}catch(m){w.warning(m&&m.message)}}})(e)}A_.set(e,n),e.track.addEventListener("ended",i)}},uye={name:"InterceptFrame",create:()=>dye};var Kt;function rW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function oc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rW(Object(n),!0).forEach(function(i){O(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rW(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let hye=(Kt=class gf extends a0{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Ee(n=Object.keys(fh)).call(n,t)}))]}constructor(t,n,i){super(t,n),O(this,"id",on(5,"connection-")),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"forceTurn",!1),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"transportEventReceiver",void 0),O(this,"statsFilter",void 0),O(this,"extension",{useXR:j("USE_XR")}),O(this,"localCapabilities",void 0),O(this,"remoteCodecs",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"isPreallocation",!1),O(this,"preMediaMap",new Map),O(this,"dataStreamChannelMap",new Map),O(this,"establishPromise",void 0),O(this,"recoveredDataChannelIds",[]),O(this,"currentDataChannelId",1),O(this,"supportAV1RtpSpec",!1),O(this,"mutex",void 0),O(this,"qualityLimitationReason",wm.NONE),O(this,"isFirstConnected",!1),this.store=n,this.forceTurn=CI(t),this.mutex=new is("NVConnectionExtension-mutex",n.clientId),this.peerConnection=i,this.isFirstConnected=!1,this.statsFilter=kS(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,An()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void w.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else w.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Qc(n.sdp),a=await oI({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:j("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:j("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=j_(a),this.initialOffer=n,j("ENABLE_SVC")&&this.store.codec=="av1"){const u=await P3();var t;u&&(this.supportAV1RtpSpec=!0,(t=a.send)===null||t===void 0||t.videoExtensions.push(u))}let l;return n.sdp&&p0(n.sdp)&&(l=On(a),w3(l)),oc(oc({},i),{},{rtpCapabilities:l||a,offerSDP:n.sdp})}catch(n){throw new ae(U.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&p0(this.initialOffer.sdp)&&C3(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new r5(oc(oc({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!j("ENABLE_PRE_SUB_WITH_PRE_PC")||!j("PRE_USE_LOCAL_CODECS"))&&x_(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),i=cI(this.initialOffer.sdp,this.extension),a=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),a==null||a(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),x_(this.store))if(t.preallocation&&j("ENABLE_PRE_SUB_WITH_PRE_PC")){const u=j("PRE_SUB_NUM"),{mids:h,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(u);await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(h,m)}else{const{preSSRCs:u=[]}=t,h=u.map(g=>g.ssrcMsg[0].ssrcId);if(u.length===0)return;const{mids:m}=this.remoteSDP.batchSend(u.map(g=>Object.assign({},g)));await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(h)),this.presetMedia(m,h)}}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((i,a)=>{this.peerConnection.getTransceivers().forEach(l=>{if(l.mid!=null&&i===l.mid&&l.receiver.track){const u=l.receiver.track;let h;u.kind==="video"&&j("ENABLE_PRE_RENDER")&&(h=new HS({trackId:"track-".concat(u.kind,"-unknown-").concat(this.store.clientId,"_").concat(on(5,""))},!0),h.updateVideoTrack(u),h.onFirstVideoFrameRender=()=>{var m;const g=this.preMediaMap.get(n[a]);g&&(g.firstVideoRender=Date.now()),(m=this.onFirstVideoRender)===null||m===void 0||m.call(this,n[a])},h.onVideoBufferReady=()=>{var m;(m=this.onFirstVideoBufferReady)===null||m===void 0||m.call(this,n[a])},h.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[a],{mid:i,track:u,player:h,transceiver:l})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const u=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||u}const{preSSRCs:a=[]}=t,l=a.map(u=>u.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(l)){const u=[],h=[];if(Array.from(this.preMediaMap.entries()).every(m=>{let[g,{mid:_,player:v,track:S}]=m;return u.push(_),h.push(g),this.preMediaMap.delete(g),v&&v.destroy(),!0}),u.length>0&&(this.remoteSDP.stopSending(u),await Li(this.peerConnection,this.remoteSDP,this.extension),w.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(h)),Be.reportApiInvoke(this.store.sessionId,{name:Vn.PRELOAD_MEDIA_FAILED,options:[a,h],tag:gn.TRACER}).onSuccess()),a.length>0){const{mids:m}=this.remoteSDP.batchSend(a.map(g=>Object.assign({},g)));await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(l)),this.presetMedia(m,l)}}n?(await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):w.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var a=this;return vi(function*(){const l=yield Rt(a.mutex.lock("From NVConnectionExtension.send"));try{if(!a.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");const u=[],h=D_();t.forEach(N=>{const M=a.peerConnection.addTransceiver(N._mediaStreamTrack,oc({direction:"sendonly"},N.trackMediaType==="video"&&a.supportAV1RtpSpec&&h?{sendEncodings:[{scalabilityMode:h}]}:{}));u.push(M),N._updateRtpTransceiver(M)}),An()&&j("SIMULCAST")===!0&&(yield Rt(a.applySimulcastForFirefox(u,t)));const m=yield Rt(a.peerConnection.createOffer()),g=a.remoteSDP.predictReceivingMids(t.length),_=a.mungSendOfferSDP(m.sdp,t,g),v=li(_),S=g.map(N=>{const M=v.mediaDescriptions.find(F=>F.attributes.mid===N);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return rI(M,j("USE_PUB_RTX"))});let T;try{T=yield S}catch(N){T=[],a.remoteSDP.receive(t,n,i,T);const M=a.remoteSDP.toString();throw yield Rt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Rt(a.peerConnection.setRemoteDescription({type:"answer",sdp:M})),yield Rt(a.stopSending(g,!0)),N}a.remoteSDP.receive(t,n,i,T);const P=a.remoteSDP.toString(),x=a.logSDPExchange(_,"offer","local","send");return yield Rt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Rt(a.applySimulcastEncodings(u,t)),yield Rt(a.applySendEncodings(u,t)),x==null||x(P),yield Rt(a.peerConnection.setRemoteDescription({type:"answer",sdp:P})),u.map((N,M)=>{const F=g[M];return{localSSRC:S[M],id:F,transceiver:N}})}catch(u){throw u instanceof ae?u:new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(u.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")w.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach(l=>{l._updateOriginDataChannel(i)});const{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),w.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else w.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof ae?i:new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof ae?n:new ae(U.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");const a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");a.map(m=>{var g;qm(this.id+m.mid,this),m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();u==null||u(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(a.toString()))}finally{i&&i()}}async receive(t,n,i,a){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,i,a);u&&(await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));const h=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}}catch(l){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await Li(this.peerConnection,this.remoteSDP,this.extension),w.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),n.map(a=>{const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preMediaMap.entries()).some(u=>{let[h,{mid:m,player:g}]=u;if(m===l)return this.preMediaMap.delete(h),g&&g.destroy(),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();i==null||i(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(u=>{u.direction="inactive"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(u,h)=>{u.direction="sendonly"});const i=await this.peerConnection.createOffer(),a=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new ae(U.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return vi(function*(){const i=yield Rt(n.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const a=jt().supportPCSetConfiguration,l=j("FORCE_TURN_TCP")||n.forceTurn;if(t===as.RELAY&&!a)return;if(a&&!l){const v=t===as.RELAY?"relay":"all",S=n.peerConnection.getConfiguration();S.iceTransportPolicy!==v&&(w.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(v,"]")),S.iceTransportPolicy=v,n.peerConnection.setConfiguration(S))}n.remoteSDP.updateCandidates(t);const u=yield Rt(n.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Qc(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;n.remoteSDP.restartICE(m);const g=n.remoteSDP.toString(),_=n.logSDPExchange(u.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Rt(n.peerConnection.setLocalDescription(u)),_==null||_(g),yield Rt(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(a){w.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),a)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(as.TCP_RELAY),await Li(this.peerConnection,this.remoteSDP,this.extension)}catch(n){w.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{qm(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:i}=n;i&&i.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return oc(oc({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new ae(U.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(a=>a.mid===t);i.length===1&&(this.isVP8Simulcast(n)?An()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(a=>a.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:a}=n.getSelectedCandidatePair();return{local:oc(oc({},_o),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:oc(oc({},_o),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),a=t.port?"local: ".concat(t.port):"",l=Xc(t.url||"");w.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(i,"), url: ").concat(l||"",", host_candidate:").concat(a)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(ch(t.turnServer.servers)?n.iceServers=t.turnServer.servers:j("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(j("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...gf.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...gf.newTurnServerConfigToIceServers(t.turnServer.servers)),j("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...gf.turnServerConfigToIceServers(t.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...gf.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(n.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&jt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(To(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!j("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{const a=j("NEW_TURN_MODE");a===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):a===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):a===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(To(i.turnServerURL),":443?transport=tcp")}):a===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(To(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var a;n!=null&&n.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,n.state))},n.onerror=a=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in a?a.error:a)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const a=n==null?void 0:n.iceTransport.state;var l;a&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,a))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:a,remote:l}=i.getSelectedCandidatePair()||{};if(a&&l){const u=a.address+":"+a.port,h=l.address+":"+l.port;w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Xc(u)),", remote ").concat(JSON.stringify(Xc(h))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,a;if(n||(n=this.peerConnection.getSenders().find(N=>N.track===t._mediaStreamTrack)),!n)return w.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jt().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},u={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const h=T3(this.peerConnection,t._mediaStreamTrack),m=u4(t);if(l5(t)&&h&&n&&m&&this.getLocalVideoStats&&Ee(i=["vp8","vp9"]).call(i,this.store.codec)){var g;const x=l.degradationPreference||(Ee(g=t._hints).call(g,sn.CUSTOM_TRACK)?j("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");d5(this.id+h.mid,m,this,x,N=>{n&&this.updateAdaptation(n,N)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var _;const{bitrateMax:x,frameRate:N,scaleResolutionDownBy:M}=t._encoderConfig;x&&(u.maxBitrate=1e3*x),(Ee(_=t._hints).call(_,sn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(N&&(u.maxFramerate=wi(N)),M&&M>=1&&(u.scaleResolutionDownBy=M))}const{maxFramerate:v}=j("ENCODER_CONFIG_LIMIT");if(v&&typeof v=="number"&&(u.maxFramerate=u.maxFramerate?Math.min(u.maxFramerate,v):v),j("DSCP_TYPE")&&Hc()){var S;const x=j("DSCP_TYPE");Ee(S=["very-low","low","medium","high"]).call(S,x)&&(u.networkPriority=x)}const T=n.getParameters(),P=(a=T.encodings)===null||a===void 0?void 0:a[0];An()&&!P&&(l.encodings=[u]),P&&Object.assign(P,u),Object.assign(T,l),w.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(T.encodings))),await n.setParameters(T),await L3(this.store.codec,n,j("SVC_MODE"))}async updateAdaptation(t,n){var i,a;if(!t)return w.debug("[updateAdaptation] no rtpSender found");if(!jt().supportSetRtpSenderParameters)return w.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:u,frameRate:h,scaleResolutionDownBy:m}=n;u&&(l.maxBitrate=1e3*u),h&&(l.maxFramerate=wi(h)),m&&m>=1&&Ee(i=["vp8","vp9"]).call(i,this.store.codec)&&(l.scaleResolutionDownBy=m);const g=t.getParameters(),_=(a=g.encodings)===null||a===void 0?void 0:a[0];_&&Object.assign(_,l),Object.assign(g,{});try{await t.setParameters(g),w.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(v){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?w.debug("[updateAdaptation] peerConnection not connected}"):w.debug("[updateAdaptation] updateRtpSenderEncodings failed",v):w.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!jt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const a=t[i],l=n[i];l instanceof _n&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,a.sender)}}catch{w.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const a=li(t);return n.forEach((l,u)=>{const h=i[u],m=a.mediaDescriptions.find(g=>g.attributes.mid===h);m&&(Rh(m,l),aI(m,l,this.store.codec))}),Ul(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var i,a,l,u,h;const g=t[m],_=n[m];if(_ instanceof _n&&!Ee(i=_._hints).call(i,sn.LOW_STREAM)&&(a=_._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((l=_._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=_._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const v={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};v.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const T=g.sender.getParameters();await g.sender.setParameters(Object.assign(T,v))}}}async applySimulcastEncodings(t,n){if(!An()&&t.length===n.length)for(let i=0;i<t.length;i++){const a=n[i];if(a instanceof _n&&this.isVP8Simulcast(a)){const l=t[i],u={},h={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var n,i,a,l,u;return!!(t instanceof _n&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Ee(n=t._hints).call(n,sn.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,i,a){if(j("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during NVConnectionExtension.").concat(a,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(jt().supportPCSetConfiguration){const n=gf.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},Ae(Kt.prototype,"updateRemoteRTPCapabilities",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"updateRemoteRTPCapabilities"),Kt.prototype),Ae(Kt.prototype,"connect",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"connect"),Kt.prototype),Ae(Kt.prototype,"updateRemoteConnect",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"updateRemoteConnect"),Kt.prototype),Ae(Kt.prototype,"createDataChannels",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"createDataChannels"),Kt.prototype),Ae(Kt.prototype,"receive",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"receive"),Kt.prototype),Ae(Kt.prototype,"batchReceive",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"batchReceive"),Kt.prototype),Ae(Kt.prototype,"stopReceiving",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"stopReceiving"),Kt.prototype),Ae(Kt.prototype,"muteRemote",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"muteRemote"),Kt.prototype),Ae(Kt.prototype,"unmuteRemote",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteRemote"),Kt.prototype),Ae(Kt.prototype,"muteLocal",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"muteLocal"),Kt.prototype),Ae(Kt.prototype,"unmuteLocal",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteLocal"),Kt.prototype),Ae(Kt.prototype,"close",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"close"),Kt.prototype),Ae(Kt.prototype,"updateEncoderConfig",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"updateEncoderConfig"),Kt.prototype),Ae(Kt.prototype,"updateSendParameters",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"updateSendParameters"),Kt.prototype),Ae(Kt.prototype,"replaceTrack",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"replaceTrack"),Kt.prototype),Ae(Kt.prototype,"updateAdaptation",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"updateAdaptation"),Kt.prototype),Ae(Kt.prototype,"getRemoteSSRC",[xi],Object.getOwnPropertyDescriptor(Kt.prototype,"getRemoteSSRC"),Kt.prototype),Kt);function xi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("From NVConnectionExtension.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{l()}},n}var un;function sW(e){var t,n,i,a=2;for(typeof Symbol<"u"&&(n=_S,i=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new q0(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function q0(e){function t(n){if(Object(n)!==n)return Ne.reject(new TypeError(n+" is not an object."));var i=n.done;return Ne.resolve(n.value).then(function(a){return{value:a,done:i}})}return q0=function(n){this.s=n,this.n=n.next},q0.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Ne.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Ne.reject(n):t(i.apply(this.s,arguments))}},new q0(e)}let pye=(un=class qT extends a0{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),O(this,"name","DataChannelConnection"),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"cname",void 0),O(this,"mutex",new is("DataChannelConnection-mutex")),O(this,"dataChannel",void 0),O(this,"_p2pConnection",void 0),O(this,"establishPromise",void 0),O(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(qT.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new hye(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var n;return(n=this._p2pConnection)===null||n===void 0?void 0:n.getPreMedia(t)}isPreSub(){var t,n;return(t=(n=this._p2pConnection)===null||n===void 0?void 0:n.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new Ne((n,i)=>{const a=setTimeout(()=>{this.closeSignal(),i(new re(U.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},j("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(a),void n()},this.dataChannel.onerror=l=>{this.closeSignal(),i(l)},this.dataChannel.addEventListener("close",()=>{i(new re(U.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,n){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)}send(t,n,i){var a=this;return vi(function*(){const l=yield Rt(a.mutex.lock("From DataChannelConnection.send"));try{return yield*Em(sW(a._p2pConnection.send(t,n,i)))}finally{l()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async createDataChannels(t,n){return this._p2pConnection.createDataChannels(t,n)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,n,i,a){return this._nvMedia?(w.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(w.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,i,a))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return vi(function*(){return yield*Em(sW(n._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;return(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,i,a){if(j("SDP_LOGGING"))return w.upload("exchanging ".concat(i," ").concat(n," SDP during DataChannelConnection.").concat(a,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",i==="local"?"remote":"local",a)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(ch(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...qT.turnServerConfigToIceServers(t.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...qT.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&jt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(To(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!j("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var n;return(n=this.onFirstVideoRender)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var n;return(n=this.onFirstVideoBufferReady)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,i)=>{var a;return(a=this.onFirstVideoDecoded)===null||a===void 0?void 0:a.call(this,t,n,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},Ae(un.prototype,"connect",[wa],Object.getOwnPropertyDescriptor(un.prototype,"connect"),un.prototype),Ae(un.prototype,"updateRemoteRTPCapabilities",[wa],Object.getOwnPropertyDescriptor(un.prototype,"updateRemoteRTPCapabilities"),un.prototype),Ae(un.prototype,"createDataChannels",[wa],Object.getOwnPropertyDescriptor(un.prototype,"createDataChannels"),un.prototype),Ae(un.prototype,"receive",[wa],Object.getOwnPropertyDescriptor(un.prototype,"receive"),un.prototype),Ae(un.prototype,"stopReceiving",[wa],Object.getOwnPropertyDescriptor(un.prototype,"stopReceiving"),un.prototype),Ae(un.prototype,"muteRemote",[wa],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),Ae(un.prototype,"unmuteRemote",[wa],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),Ae(un.prototype,"muteLocal",[wa],Object.getOwnPropertyDescriptor(un.prototype,"muteLocal"),un.prototype),Ae(un.prototype,"unmuteLocal",[wa],Object.getOwnPropertyDescriptor(un.prototype,"unmuteLocal"),un.prototype),Ae(un.prototype,"close",[wa],Object.getOwnPropertyDescriptor(un.prototype,"close"),un.prototype),Ae(un.prototype,"updateEncoderConfig",[wa],Object.getOwnPropertyDescriptor(un.prototype,"updateEncoderConfig"),un.prototype),Ae(un.prototype,"updateSendParameters",[wa],Object.getOwnPropertyDescriptor(un.prototype,"updateSendParameters"),un.prototype),Ae(un.prototype,"replaceTrack",[wa],Object.getOwnPropertyDescriptor(un.prototype,"replaceTrack"),un.prototype),Ae(un.prototype,"getRemoteSSRC",[wa],Object.getOwnPropertyDescriptor(un.prototype,"getRemoteSSRC"),un.prototype),un);function wa(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const a=this.mutex,l=await a.lock("From DataChannelConnection.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await i.apply(this,h)}finally{l()}},n}function iW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}class mye extends Yn{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Ee(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Fr.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Fr.CONNECTED):this._state==="closed"?this.emit(Fr.CLOSED):this._state==="failed"&&this.emit(Fr.FAILED))}constructor(t,n,i,a){super(),O(this,"connectionID",0),O(this,"currentURLIndex",0),O(this,"reconnectReason",void 0),O(this,"_reconnectMode","tryNext"),O(this,"_initMutex",void 0),O(this,"_name",void 0),O(this,"_state","closed"),O(this,"_reconnectInterrupter",void 0),O(this,"_url",void 0),O(this,"_retryConfig",void 0),O(this,"_reconnectCount",0),O(this,"_forceCloseTimeout",5e3),O(this,"_onlineReconnectListener",void 0),O(this,"_closeEstablishingTransmitter",()=>{}),O(this,"_store",void 0),O(this,"_joinChannelServiceRecordIndex",void 0),O(this,"_transmitter",void 0),O(this,"_useCompress",void 0),O(this,"_inflateLength",0),O(this,"_deflateLength",0),this._store=a,this._name=t,this._retryConfig=function(l){for(var u=1;u<arguments.length;u++){var h=arguments[u]!=null?arguments[u]:{};u%2?iW(Object(h),!0).forEach(function(m){O(l,m,h[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(h)):iW(Object(h)).forEach(function(m){Object.defineProperty(l,m,Object.getOwnPropertyDescriptor(h,m))})}return l}({},n),this._useCompress=i}resetReconnectCount(t){w.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;n?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void w.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),w.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const a=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),a&&a.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let cc=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class fye{constructor(t,n,i){O(this,"version",1),O(this,"initialRTO",void 0),O(this,"maxBatchAckCount",void 0),O(this,"maxRTO",void 0),O(this,"initialRTT",void 0),O(this,"ID",void 0),O(this,"rtt",void 0),O(this,"packetNumber",1),O(this,"rtoRatioMap",new Map),O(this,"timeoutMap",new Map),O(this,"unorderedPacketQueue",[]),O(this,"batchAckPacketQueue",[]),O(this,"lastOrderedPacketNumber",0),O(this,"batchAckTimer",void 0),O(this,"sendImpl",void 0),O(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=on(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:j("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:j("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:j("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:j("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:j("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:cc.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case cc.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const i=new ArrayBuffer(n.length+15),a=new DataView(i);return a.setUint16(0,t.version),a.setUint8(2,t.type),a.setUint32(3,t.packetNumber),aF(a,7,BigInt(t.sendTs)),new Uint8Array(a.buffer).set(n,15),i}case cc.Ack:{const n=new ArrayBuffer(16),i=new DataView(n);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),aF(i,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),i=n.getUint16(0),a=n.getUint8(2);switch(a){case cc.Default:{const l=n.getUint32(3),u=iF(n,7),h=t.slice(15),m=new Uint8Array(h);return{version:i,type:a,packetNumber:l,sendTs:Number(u),payload:m}}case cc.Ack:{const l=n.getUint32(3),u=n.getUint8(7),h=iF(n,8);return{version:i,type:a,maxAckPacketNumber:l,shift:u,ackSendTs:Number(h)}}default:throw w.error("[".concat(this.ID,"] Unrecognized packet type ").concat(a)),new Error("Unrecognized packet type ".concat(a))}}sendMessage(t){j("DC_DEBUG_LOG")&&typeof t=="string"&&w.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(n),a=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,a),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===cc.Default?this.ack(n):n.type===cc.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),i=window.setTimeout(()=>{j("DC_DEBUG_LOG")&&typeof t.payload=="string"&&w.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(n)),this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,n){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:cc.Ack,version:this.version};j("DC_DEBUG_LOG")&&w.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:cc.Ack,version:this.version};j("DC_DEBUG_LOG")&&w.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:cc.Ack,version:this.version};j("DC_DEBUG_LOG")&&w.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===cc.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const i=this.timeoutMap.get(n);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class aW extends mye{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),O(this,"_initMutex",void 0),O(this,"_reconnectInterrupter",void 0),O(this,"_url",void 0),O(this,"_transmitter",void 0),O(this,"_addresses",void 0),O(this,"_reliableTransmission",void 0),O(this,"_textEncoder",void 0),O(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new is("datachannel");const{timeout:i,timeoutFactor:a}=n,l=Math.max(300,Math.floor(3*i/5)),u=Math.max(1.2,Math.floor(8*a)/10);ci.ONLINE&&(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=u),ar.on(lh.NETWORK_STATE_CHANGE,(h,m)=>{h!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(h)),h===ci.ONLINE?(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=u):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=a))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const i=(a,l)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(h=>h.fingerprint||j("FINGERPRINT"));const u=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(u).then(a).catch(l),this.once(Fr.CLOSED,()=>l(new re(U.WS_DISCONNECT))),this.once(Fr.CONNECTED,()=>a())};return this._initMutex.lock().then(a=>new Ne((l,u)=>{i(l,u)}).then(()=>{a()}).catch(()=>{a()}))}async sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new re(U.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t));const i=this._textEncoder.encode(t),a=xve(i,{raw:!0});this._reliableTransmission.sendMessage(a)}catch(i){throw new re(U.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new Ne((n,i)=>{var a;const l=()=>{w.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),n()},u=async _=>{var v;if((v=this._closeEstablishingTransmitter)===null||v===void 0||v.call(this),w.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=Ji(this,Fr.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,T=await this.reconnectWithAction(S);if(this.state==="closed")return void w.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!T)return i(new re(U.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);n()}else i(new re(U.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},h=async _=>{try{var v;(v=this._reliableTransmission)===null||v===void 0||v.onData(_.data)}catch(S){console.log(S)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),w.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const m=(a=this._store)===null||a===void 0?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),g=Date.now();Pr(this,Fr.TO_CONNECT_DATACHANNEL).then(_=>{var v,S;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:T,close:P}=_;this._transmitter=T,(v=this._store)===null||v===void 0||v.signalChannelOpen();const x=Date.now()-g;w.debug("[choose dc] dc open cost ".concat(x,"ms")),this._reliableTransmission=new fye(N=>{var M;this._transmitter&&this._transmitter.readyState==="open"&&((M=this._transmitter)===null||M===void 0||M.send(N))},N=>{if(typeof N=="string")this.emit(Fr.ON_MESSAGE,N);else{const M=Ive(N,{raw:!0}).buffer,F=this._textDecoder.decode(M);this.emit(Fr.ON_MESSAGE,F)}}),this._closeEstablishingTransmitter=()=>{var N;(N=this._reliableTransmission)===null||N===void 0||N.close(),this._reliableTransmission=void 0,P()},l&&l(),T.onclose=u,T.onmessage=h,(S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this._joinChannelServiceRecordIndex=m}).catch(_=>{var v;if((v=this._store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:_ instanceof re&&_.code===U.WS_ABORT?"aborted":"error",errors:[_]},m),this.state!=="closed"){if(_ instanceof re&&_.code===U.WS_ERR){const S=new re(U.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return w.error("[".concat(this._name,"]").concat(S)),void i(S)}u&&u(_)}else i(new re(U.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||ar.networkState!==ci.OFFLINE||(this._onlineReconnectListener=ar.onlineWaiter&&ar.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},n){const h=AS(this._reconnectCount,this._retryConfig);w.debug("[".concat(this._name,"] wait ").concat(h,"ms to reconnect datachannel, mode: ").concat(t)),await Ne.race([qr(h),this._onlineReconnectListener||new Ne(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const a=async(h,m)=>{this.emit(Fr.RECONNECT_CREATE_CONNECTION,m),await this.createTransmitterConnection(h)};try{if(t==="retry"){const h=this._addresses[this.currentURLIndex];await a(h,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let m=this.currentURLIndex;m<this._addresses.length;m++){if(this._addresses[m].fingerprint||j("FINGERPRINT")){this.currentURLIndex=m;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return w.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);w.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const h=this._addresses[this.currentURLIndex];await a(h,t)}else t==="recover"&&(w.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(Fr.FAILBACK));return!0}catch(h){var l,u;return w.error("[".concat(this._name,"] reconnect failed"),h.toString()),h!=null&&(l=h.data)!==null&&l!==void 0&&l.desc&&Array.isArray(h.data.desc)&&h.data.desc.length&&Ee(u=h.data.desc).call(u,"dynamic key expired")?(this.emit(Fr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class gye extends Yn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Bt.CONNECTED?this.emit(He.WS_CONNECTED):t===Bt.RECONNECTING?this.emit(He.WS_RECONNECTING,this._websocketReconnectReason):t===Bt.CLOSED&&this.emit(He.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(w.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:n,message:i}=t;this.emit(n,i),n===pt.ON_NOTIFICATION&&this.handleNotification(i),n===pt.ON_USER_BANNED&&this.handleUserBanned(i)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(Ft.UID_BANNED);break;case 15:this.close(Ft.IP_BANNED);break;case 16:this.close(Ft.CHANNEL_BANNED)}}constructor(t,n){super(),O(this,"__name__","DataChannelSignal"),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Bt.CLOSED),O(this,"reconnectToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new iN(5)),O(this,"pingpongTimer",void 0),O(this,"inflateDataTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"ortc",void 0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"isJoining",!1),O(this,"pendingNotifications",[]),O(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(He.ON_BINARY_DATA,i);const a=JSON.parse(i);if(j("DC_DEBUG_LOG")&&w.debug("[datachannel-signal] received packet",a),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){const l="res-@".concat(a._id);this.emit(l,a._result,a._message)}else Object.prototype.hasOwnProperty.call(a,"_type")&&(this.isJoining?a._type===pt.ON_NOTIFICATION||a._type===pt.ON_USER_BANNED?(this.emit(a._type,a._message),a._type===pt.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===pt.ON_USER_BANNED&&this.handleUserBanned(a._message)):(this.pendingNotifications.push({type:a._type,message:a._message}),w.debug("[".concat(this.clientId,"] cached notification during join: ").concat(a._type))):(this.emit(a._type,a._message),a._type===pt.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===pt.ON_USER_BANNED&&this.handleUserBanned(a._message)))}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new aW("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Bt.CONNECTED&&this.reconnect("retry",jd.OFFLINE)})}async request(t,n,i,a){const l=on(6,""),u={_id:l,_type:t,_message:n},h=this.websocket.connectionID,m=()=>new Ne((P,x)=>{if(this.connectionState===Bt.CONNECTED)return P();const N=()=>{this.off(He.WS_CLOSED,M),P()},M=()=>{this.off(He.WS_CONNECTED,N),x(new re(U.WS_ABORT))};this.once(He.WS_CONNECTED,N),this.once(He.WS_CLOSED,M),t!==Ye.PUBLISH&&t!==Ye.SUBSCRIBE&&t!==Ye.UNSUBSCRIBE&&t!==Ye.UNPUBLISH&&t!==Ye.CONTROL&&t!==Ye.RESTART_ICE||this.once(He.DISCONNECT_P2P,()=>{x(new re(U.DISCONNECT_P2P))}),t!==Ye.PUBLISH&&t!==Ye.RESTART_ICE||this.once(He.ABORT_P2P_EXECUTION,()=>{x(new re(U.DISCONNECT_P2P))})});if(this.connectionState!==Bt.CONNECTING&&this.connectionState!==Bt.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await m(),t===Ye.LEAVE&&(this.websocket.unbindDcCloseEventListener(),a=!0),j("DC_DEBUG_LOG")&&w.debug("[datachannel-signal] sendMessage",u),await this.websocket.sendMessage(u,!0,!1),a)return;const g=new Ne((P,x)=>{let N=!1;const M=(q,J)=>{N=!0,P({isSuccess:q==="success",message:J||{}}),this.off(He.WS_CLOSED,F),this.off(He.WS_RECONNECTING,F),this.emit(He.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),M);const F=()=>{x(new re(U.WS_ABORT,"type: ".concat(t))),this.off(He.WS_CLOSED,F),this.off(He.WS_RECONNECTING,F),this.off("res-@".concat(l),M)};this.once(He.WS_CLOSED,F),this.once(He.WS_RECONNECTING,F),qr(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||N||(w.warning("dc request timeout, type: ".concat(t)),this.emit(He.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await g}catch(P){if(this.connectionState===Bt.CLOSED||t===Ye.LEAVE)throw new re(U.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?P.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await m(),await this.request(t,n))}if(_.isSuccess)return _.message;const v=Number(_.message.error_code||_.message.code),S=Ch(v),T=new re(U.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:v,data:_.message});return S.action==="success"?_.message:(w.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(v,", message: ").concat(S.desc,", action: ").concat(S.action)),v===$e.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=T,this.close()),T.throw()):S.action==="failed"?T.throw():S.action==="quit"?(this.initError=T,this.close(),T.throw()):(v===$e.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,w.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",jd.MULTI_IP)):this.reconnect(S.action,jd.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ne(i=>{const a=l=>{(!n||n(l))&&(this.off(t,a),i(l))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void w.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(wh.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const l=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Bt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,n){const i={_type:t,_message:n};await this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ne((n,i)=>{this.once(He.WS_CONNECTED,()=>n(this.joinResponse)),this.once(He.WS_CLOSED,()=>i(this.initError||new re(U.WS_ABORT))),this.connectionState=Bt.CONNECTING,this.websocket.init(t).catch(i),this.websocket.once(Fr.FAILBACK,()=>{i(new re(U.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(w.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),i(new re(U.INIT_DATACHANNEL_TIMEOUT)))},j("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||Ft.LEAVE,this.connectionState=Bt.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Ft.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new aW("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),j("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(He.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Pr(this,He.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];const n=await this.request(Ye.JOIN,t);if(this.store.joinRep(),this.ortc=t==null?void 0:t.ortc,!n)return this.emit(He.REPORT_JOIN_GATEWAY,U.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(He.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Bt.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new re(U.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=dh(this,He.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ye.REJOIN,t);return!!n&&(this.connectionState=Bt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),j("DC_PINGPONG_INTERVAL")),n.peers&&n.peers.forEach(i=>{this.emit(pt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(pt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(pt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(pt.MUTE_AUDIO,{uid:i.uid}):this.emit(pt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(pt.MUTE_VIDEO,{uid:i.uid}):this.emit(pt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(pt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(pt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(pt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(pt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(pt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Ye.DOWNGRADE_CODEC,n)}handleNotification(t){w.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ch(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ft.UID_BANNED),void this.close()):void this.reconnect(n.action,jd.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,j("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));const t=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(w.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",jd.FALLBACK):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),j("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(wh.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Fr.RECONNECT_CREATE_CONNECTION,t=>{this.emit(He.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Fr.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Fr.CLOSED,()=>{this.connectionState=Bt.CLOSED}),this.websocket.on(Fr.FAILED,()=>{this._disconnectedReason=Ft.NETWORK_ERROR,this.connectionState=Bt.CLOSED}),this.websocket.on(Fr.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Bt.CONNECTED?this.connectionState=Bt.RECONNECTING:this.connectionState=Bt.CONNECTING}),this.websocket.on(Fr.WILL_RECONNECT,(t,n)=>{if(dh(this,He.IS_P2P_DISCONNECTED)&&t==="retry")return w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(He.NEED_RENEW_SESSION),this.emit(He.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(w.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(He.NEED_RENEW_SESSION),this.emit(He.DISCONNECT_P2P)),n(t)}),this.websocket.on(Fr.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",jd.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(He.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof re&&t.code===U.UNEXPECTED_RESPONSE&&t.data.code===$e.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",jd.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",jd.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Fr.REQUEST_NEW_URLS,(t,n)=>{Pr(this,He.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Fr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Fr.TO_CONNECT_DATACHANNEL,(t,n)=>{Pr(this,He.PRE_CONNECT_PC).then(t).catch(n)}),this.websocket.on(Fr.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(He.DATACHANNEL_FAILBACK)})}}const _ye={name:"DataChannelConnection",create:function(e){let{store:t,spec:n}=e;return new pye(n,t)}},Eye={name:"DataChannelSignal",create:function(e){let{store:t,spec:n}=e;return new gye(n,t)}};uN(),hn("PROCESS_ID","process-".concat(on(8,""),"-").concat(on(4,""),"-").concat(on(4,""),"-").concat(on(4,""),"-").concat(on(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void w.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();w.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(cn,i)){const{value:a,expires:l}=t[i];if(l&&l<=n)return;fa[i]=a,cn[i]=a}})}catch(t){w.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(fa.AREAS)&&fa.AREAS.length>0&&hI(fa.AREAS,!0);const oW=(e,t,n)=>{w.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),hn(e,t,n)};Jc(kve,!1),Jc(Mve,!1),Jc(pEe,!1),Jc(Yve,!1),Jc(Ove,!1),Jc(aye,!1),Jc(lye,!1),Jc(uye,!1),Jc(_ye,!1),Jc(Eye,!1);const Dr=function(e){const t=new Yn,n=e,i={getListeners:t.getListeners.bind(t),on:(a,l)=>(function(u,h){u===Yc.SECURITY_POLICY_VIOLATION&&M6(h,!0)}(a,l),t.on.bind(t)(a,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return j6(j6({},n),i)}({__TRACK_LIST__:gh,VERSION:ja,BUILD:mN,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:oW,getParameter:j,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(i){let a;return jt().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),a=(await i.createOffer()).sdp):a=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,a}(t);if(!n)return e;t.close(),t=null,e=function(i){const a={video:[],audio:[]};return i.match(/ VP8/i)&&a.video.push("VP8"),i.match(/ VP9/i)&&a.video.push("VP9"),i.match(/ AV1/i)&&a.video.push("AV1"),i.match(/ H264/i)&&a.video.push("H264"),i.match(/ H265/i)&&a.video.push("H265"),i.match(/ opus/i)&&a.audio.push("OPUS"),i.match(/ PCMU/i)&&a.audio.push("PCMU"),i.match(/ PCMA/i)&&a.audio.push("PCMA"),i.match(/ G722/i)&&a.audio.push("G722"),a}(n)}catch(t){throw new re(U.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];const t=Be.reportApiInvoke(null,{name:Vn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:gn.TRACER}),n=function(){let l=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],u=!1;try{const h=window.RTCPeerConnection,m=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,g=window.WebSocket;u=!(!h||!g),l&&!m&&(u=!1),u&&v_()&&YV(75)&&new h().close()}catch(h){w.error("check system requirement failed: ",h),u=!1}return u}(e),i=fEe();w.debug("checkSystemRequirements, api:",n,"browser",i);const a=n&&i;return t.onSuccess(a),j("IGNORE_RTC_DEVICE_CHECK")?n:a},getDevices:function(e){return ya.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return ya.getRecordingDevices(e)},getCameras:function(e){return ya.getCamerasDevices(e)},getElectronScreenSources:ZF,getPlaybackDevices:function(e){return ya.getSpeakers(e)},createClient:D6,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=j("CAMERA_CAPTURE_CONFIG"),n=on(8,"track-cam-"),i=Be.reportApiInvoke(null,{id:n,tag:gn.TRACER,name:Vn.CREATE_CAM_VIDEO_TRACK,options:[Rn({},e),t]});t&&(e.encoderConfig=t);const a=WS(e);let l=null;w.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{l=(await va({video:a},n)).getVideoTracks()[0]||null}catch(h){throw i.onError(h),h}if(!l){const h=new ae(U.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(w)}if(e.optimizationMode&&DN(n,l,e,vo(e.encoderConfig)),j("USE_STANDARD_BITRATE_DEFAULT")){const h=vo(e.encoderConfig);e.encoderConfig=h,delete h.bitrateMax,delete h.bitrateMin}const u=new KS(l,e,a,e.scalabiltyMode?VS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(u.getTrackId()),w.info("create camera video success, trackId:",n),u},createCustomVideoTrack:function(e){const t=on(8,"track-cus-"),n=Be.reportApiInvoke(null,{id:t,tag:gn.TRACER,name:Vn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});j("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const i=new _n(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?VS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[sn.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),w.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(S){const T=l4(S);return GF()&&S.suppressLocalAudioPlayback&&(T.suppressLocalAudioPlayback=S.suppressLocalAudioPlayback),WF()&&S.restrictOwnAudio&&(T.restrictOwnAudio=!0),T}(t):void 0;n&&(t="auto");const i=on(8,"track-scr-v-"),a=Be.reportApiInvoke(null,{id:i,tag:gn.TRACER,name:Vn.CREATE_SCREEN_VIDEO_TRACK,options:[Rn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(S){const T={};S.screenSourceType&&(T.mediaSource=S.screenSourceType),S.extensionId&&jl()&&(T.extensionId=S.extensionId);const{displaySurface:P,selfBrowserSurface:x,surfaceSwitching:N,systemAudio:M,preferCurrentTab:F,windowAudio:q,monitorTypeSurfaces:J}=S;(Wc(107)||ah(107)||oh(93))&&(P&&(wr(P,"displaySurface",["browser","window","monitor"]),T.displaySurface=P),x?(wr(x,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=x):T.selfBrowserSurface="include",N&&(wr(N,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=N)),(Wc(105)||ah(105)||oh(91))&&M&&(wr(M,"systemAudio",["exclude","include"]),T.systemAudio=M),(Wc(94)||ah(94)||oh(80))&&F&&(T.preferCurrentTab=!0),(Wc(141)||ah(141)||oh(125))&&q&&(wr(q,"windowAudio",["exclude","system"]),T.windowAudio=q),(Wc(119)||ah(119)||oh(105))&&J&&(wr(J,"monitorTypeSurfaces",["exclude","include"]),T.monitorTypeSurfaces=J),S.electronScreenSourceId&&(T.sourceId=S.electronScreenSourceId);const te=S.encoderConfig?yN(S.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:te?te.width:void 0,maxHeight:te?te.height:void 0},te&&(te.frameRate&&(typeof te.frameRate=="number"?(T.mandatory.maxFrameRate=te.frameRate,T.mandatory.minFrameRate=te.frameRate):(T.mandatory.maxFrameRate=te.frameRate.max||te.frameRate.ideal||te.frameRate.exact||void 0,T.mandatory.minFrameRate=te.frameRate.min||te.frameRate.ideal||te.frameRate.exact||void 0),T.frameRate=te.frameRate),te.width&&(T.width=te.width),te.height&&(T.height=te.height)),T}(e);let u=null,h=null;const m=jt();if(!m.supportShareAudio&&t==="enable"){const S=new ae(U.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(S),S.throw(w)}w.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const g=m.supportShareAudio&&t!=="disable";try{const S=await va({screen:l,screenAudio:g?n||!0:void 0},i);u=S.getVideoTracks()[0]||null,h=S.getAudioTracks()[0]||null}catch(S){throw a.onError(S),S}if(!u){const S=new ae(U.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(S),S.throw(w)}if(!h&&t==="enable"){u&&u.stop();const S=new ae(U.SHARE_AUDIO_NOT_ALLOWED);return a.onError(S),S.throw(w)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(DN(i,u,e,e.encoderConfig&&yN(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const _=new _n(u,e.encoderConfig?yN(e.encoderConfig):{},e.scalabiltyMode?VS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[sn.SCREEN_TRACK]);if(!h)return a.onSuccess(_.getTrackId()),w.info("create screen video track success","video:",_.getTrackId()),_;const v=new gr(h,void 0,on(8,"track-scr-a-"),!1);return a.onSuccess([_.getTrackId(),v.getTrackId()]),w.info("create screen video track success","video:",_.getTrackId(),"audio:",v.getTrackId()),[_,v]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=j("CAMERA_CAPTURE_CONFIG"),i=on(8,"track-mic-"),a=on(8,"track-cam-"),l=Be.reportApiInvoke(null,{id:"".concat(i,"-").concat(a),tag:gn.TRACER,name:Vn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const u=WS(t),h=d4(e);let m=null,g=null;w.info("start create camera video track(".concat(a,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const S=await va({audio:h,video:u},"".concat(i,"-").concat(a));m=S.getAudioTracks()[0],g=S.getVideoTracks()[0]}catch(S){throw l.onError(S),S}if(!m||!g){const S=new ae(U.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(S),S.throw(w)}if(t.optimizationMode&&DN(a,g,t,vo(t.encoderConfig)),j("USE_STANDARD_BITRATE_DEFAULT")){const S=vo(t.encoderConfig);t.encoderConfig=S,delete S.bitrateMax,delete S.bitrateMin}const _=new I_(m,e,h,i),v=new KS(g,t,u,t.scalabiltyMode?VS(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a);return l.onSuccess([_.getTrackId(),v.getTrackId()]),w.info("create camera video track(".concat(a,") and microphone audio track(").concat(i,") success")),[_,v]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=on(8,"track-mic-"),n=Be.reportApiInvoke(null,{id:t,tag:gn.TRACER,name:Vn.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=d4(e);let a=null;w.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{a=(await va({audio:i},t)).getAudioTracks()[0]||null}catch(u){throw n.onError(u),u}if(!a){const u=new ae(U.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(u),u.throw(w)}const l=new I_(a,e,i,t);return n.onSuccess(l.getTrackId()),w.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:jB,createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:a}=e;const l={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":a,cacheOnlineFile:n,encoderConfig:i},u=on(8,"track-buf-"),h=Be.reportApiInvoke(null,{id:u,tag:gn.TRACER,name:Vn.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if(j("DISABLE_WEBAUDIO"))throw new ae(U.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");w.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",u);const m=a;if(!(a instanceof AudioBuffer))try{a=await async function(v,S){let T=null;if(typeof v=="string"){const x=J4.get(v);if(x)return w.debug("use cached audio resource: ",v),x;try{T=(await Qo(()=>yi.get(v,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(N){throw new ae(U.FETCH_AUDIO_FILE_FAILED,N.toString())}}else T=await new Ne((N,M)=>{const F=new FileReader;F.onload=q=>{q.target?N(q.target.result):M(new ae(U.READ_LOCAL_AUDIO_FILE_ERROR))},F.onerror=()=>{M(new ae(U.READ_LOCAL_AUDIO_FILE_ERROR))},F.readAsArrayBuffer(v)});const P=await function(x){const N=Pm();return new Ne((M,F)=>{N.decodeAudioData(x,q=>{M(q)},q=>{F(new ae(U.DECODE_AUDIO_FILE_FAILED,q.toString()))})})}(T);return typeof v=="string"&&S&&J4.set(v,P),P}(a,n)}catch(v){return h.onError(v),v.throw(w)}const g=new kge(a),_=new Dge(m,g,i?FS(i):{},u);return w.info("create buffer source audio track success, trackId:",u),h.onSuccess(_.getTrackId()),_},setAppType:function(e){if(w.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw w.debug("Invalid appType"),new re(U.INVALID_PARAMS,"invalid app type",e);hn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){w.setLogLevel(e)},enableLogUpload:function(){j("USE_NEW_LOG")?hn("UPLOAD_LOG",!0):w.enableLogUpload()},disableLogUpload:function(){j("USE_NEW_LOG")?hn("UPLOAD_LOG",!1):w.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new e5},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Be.reportApiInvoke(null,{tag:gn.TRACER,name:Vn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof gr||e instanceof Lm)){const m=new re(U.INVALID_TRACK,"the parameter is not a audio track");return n.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof gr?e.getTrackLabel():"remote_track",a=e.getVolumeLevel();let l=a,u=a;const h=Date.now();return new Ne(m=>{const g=setInterval(()=>{const _=e.getVolumeLevel();l=_>l?_:l,u=_<u?_:u;const v=l-u>1e-4,S=Date.now()-h;if(v||S>t){clearInterval(g);const T=v,P={duration:S,deviceLabel:i,maxVolumeLevel:l,result:T};w.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),n.onSuccess(P),m(T)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Be.reportApiInvoke(null,{tag:gn.TRACER,name:Vn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof _n||e instanceof km)){const v=new re(U.INVALID_TRACK,"the parameter is not a video track");return n.onError(v),v.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof _n?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(ss()||xS())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([a]),l.play();const u=document.createElement("canvas");u.width=160,u.height=120;let h=0,m=0;try{const v=Date.now();h=await function(S,T,P,x){let N,M=0,F=null;return new Ne((q,J)=>{function te(){M>x&&N&&(N(),q(M));const Y=P.getContext("2d");if(!Y){const fe=new re(U.UNEXPECTED_ERROR,"can not get canvas 2d context.");return w.error(fe.toString()),void J(fe)}Y.drawImage(S,0,0,160,120);const ne=Y.getImageData(0,0,P.width,P.height),ue=Math.floor(ne.data.length/3);if(F){for(let fe=0;fe<ue;fe+=3)if(ne.data[fe]!==F[fe])return M+=1,void(F=ne.data);F=ne.data}else F=ne.data}setTimeout(()=>{N&&(N(),q(M))},T),N=RN(()=>{te()},30)})}(l,t,u,4),m=Date.now()-v}catch(v){throw n.onError(v),v}Z_e===Qt.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const g=h>4,_={duration:m,changedPicNum:h,deviceLabel:i,result:g};return w.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),n.onSuccess(_),g},setArea:hI,audioElementPlayCenter:Qs,resumeAudioContext:function(){return Qs.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){_Ee.processExternalMediaAEC(e)},registerExtensions:function(e){const t=j("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Ee(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=w.extLog,i.reporter.hookApiInvoke=Be.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(a=>{i.parameters[a]=j(a)})}),oW("PLUGIN_INFO",t)},ChannelMediaRelayError:Um,ChannelMediaRelayEvent:Fl,ChannelMediaRelayState:ki,RemoteStreamFallbackType:xge,RemoteStreamType:Rge,ConnectionDisconnectedReason:Ft,AudienceLatencyLevelType:tge,AREAS:tn,preload:async function(e,t,n,i){return kI(e,t,n,i)},startLastmileProbeTest:async function(e,t,n,i){let a={state:"unavailable"};await kI(e,t,n,i);const l=await LI({appId:e,cname:t,token:n||e,uid:i,cloudProxyServer:"disabled"});if(!l)return a;await jI(l);let u,h=D6({mode:"rtc",codec:"vp8"});try{u=await h.join(e,t,n,i,{networkQualityProbe:!0})}catch{return a}const m=new rEe,g=m.createMuteAudioTrack();let _=await jB({mediaStreamTrack:g});await h.publish([_]);let[v,S,T]=await new Ne((q,J)=>{const te=setTimeout(()=>{clearTimeout(te),q([!0,null,"audio"])},5e3);h.on("user-published",async(Y,ne)=>{Y.uid===u&&(clearTimeout(te),q([!1,Y,ne]))})});if(v||!S)return await h.unpublish([_]),await h.leave(),_.close(),m.close(),a;await h.subscribe(S,T),await new Ne((q,J)=>{const te=setTimeout(()=>{clearTimeout(te),q(null)},5e3)});let P=h.getRTCStats(),x=h.getLocalAudioStats();const N=P.RTT,M=x.sendJitterMs,F=x.currentPacketLossRate;return a={state:"complete",rtt:N,packetLossRate:F,jitter:M,networkQuality:((q,J,te)=>{let Y=1;if(te>0){let ut=Math.log(100*te)/Math.log(2)+1;ut=Math.min(5,Math.max(0,ut)),Y=1-ut/5}let ne=1;if(q>0){let ut=Math.log(q/40)/Math.log(2)+1;ut=Math.min(5,Math.max(0,ut)),ne=1-ut/5}let ue=1;if(J>0){let ut=Math.log(J/10)/Math.log(2.5)+1;ut=Math.min(5,Math.max(0,ut)),ue=1-ut/5}const fe=.5*Y+.3*ne+.2*ue;let Me=0;return Me=fe>=.8?1:fe>=.6?2:fe>=.4?3:fe>=.2?4:5,Me})(N,M,F)},await h.unsubscribe(S),await h.unpublish([_]),await h.leave(),_.close(),m.close(),await jI(l),a}});return Object.defineProperties(Dr,{onAudioAutoplayFailed:{get:()=>Ti.onAudioAutoplayFailed,set:e=>{Ti.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ti.onAutoplayFailed,set:e=>{Ti.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Dr._onSecurityPolicyViolation,set(e){Dr._onSecurityPolicyViolation=e,M6(e)}},__CLIENT_LIST__:{get:()=>j("SHOW_GLOBAL_CLIENT_LIST")?Th:[]}}),ya.on(Eh.CAMERA_DEVICE_CHANGED,e=>{w.info("camera device changed",JSON.stringify(e)),Dr.onCameraChanged&&Dr.onCameraChanged(e),Dr.safeEmit(Yc.CAMERA_CHANGED,e)}),ya.on(Eh.RECORDING_DEVICE_CHANGED,e=>{w.info("microphone device changed",JSON.stringify(e)),Dr.onMicrophoneChanged&&Dr.onMicrophoneChanged(e),Dr.safeEmit(Yc.MICROPHONE_CHANGED,e)}),ya.on(Eh.PLAYOUT_DEVICE_CHANGED,e=>{w.debug("playout device changed",JSON.stringify(e)),Dr.onPlaybackDeviceChanged&&Dr.onPlaybackDeviceChanged(e),Dr.safeEmit(Yc.PLAYBACK_DEVICE_CHANGED,e)}),Qs.onAutoplayFailed=()=>{w.info("detect audio element autoplay failed"),Ti.onAudioAutoplayFailed&&Ti.onAudioAutoplayFailed()},pn.on("autoplay-failed",()=>{w.info("detect webaudio autoplay failed"),Ti.onAudioAutoplayFailed&&Ti.onAudioAutoplayFailed(),Dr.safeEmit(Yc.AUTOPLAY_FAILED)}),pn.on(vs.STATE_CHANGE,(e,t)=>{w.info("audio context state changed: ".concat(t," => ").concat(e)),Dr.onAudioContextStateChanged&&Dr.onAudioContextStateChanged(e,t),Dr.safeEmit(Yc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),ar.on(lh.NETWORK_STATE_CHANGE,(e,t)=>{w.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Dr),Dr})})(ene);var ZPe=ene.exports;const FH=zP(ZPe);function eDe(){const{sessionId:r}=dw();useNavigate();const{toast:s}=jr(),[o,d]=I.useState(null),[p,f]=I.useState(null),[E,y]=I.useState(""),[b,C]=I.useState(!0),[A,D]=I.useState(!0),[k,W]=I.useState(!1),G=I.useRef(null),L=I.useRef(null),B=I.useRef(null),H=I.useRef(null),V=I.useRef(null);I.useEffect(()=>(r&&K(),()=>{se()}),[r]);const K=async()=>{try{const oe=await(await fetch(`/api/telemedicine/sessions/${r}`)).json();d(oe),y(oe.notes||"")}catch(X){console.error("Failed to fetch session:",X),s({title:"Error",description:"Failed to load consultation session",variant:"destructive"})}},Z=async()=>{try{const oe=await(await fetch(`/api/telemedicine/sessions/${r}/start?user_id=current_user_id`,{method:"POST"})).json();f(oe);const je=FH.createClient({mode:"rtc",codec:"vp8"});G.current=je,await je.join(oe.app_id,oe.channel_name,oe.token,oe.uid);const[Ce,We]=await FH.createMicrophoneAndCameraTracks();B.current=Ce,L.current=We,H.current&&We.play(H.current),await je.publish([Ce,We]),je.on("user-published",async(he,rt)=>{var De,Oe;await je.subscribe(he,rt),rt==="video"&&V.current&&((De=he.videoTrack)==null||De.play(V.current)),rt==="audio"&&((Oe=he.audioTrack)==null||Oe.play())}),je.on("user-unpublished",he=>{V.current&&(V.current.innerHTML="")}),W(!0),s({title:"Call Started",description:"Video consultation is now active"})}catch(X){console.error("Failed to start call:",X),s({title:"Error",description:"Failed to start video call. Check Agora credentials in .env",variant:"destructive"})}},ee=async()=>{L.current&&(await L.current.setEnabled(!b),C(!b))},$=async()=>{B.current&&(await B.current.setEnabled(!A),D(!A))},se=async()=>{var X,oe,je,Ce,We;try{(X=L.current)==null||X.stop(),(oe=L.current)==null||oe.close(),(je=B.current)==null||je.stop(),(Ce=B.current)==null||Ce.close(),await((We=G.current)==null?void 0:We.leave()),r&&await fetch(`/api/telemedicine/sessions/${r}/end`,{method:"POST"}),W(!1),s({title:"Call Ended",description:"Video consultation has ended"})}catch(he){console.error("Failed to leave call:",he)}},le=async()=>{try{await fetch(`/api/telemedicine/sessions/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:E})}),s({title:"Notes Saved",description:"Consultation notes have been saved"})}catch(X){console.error("Failed to save notes:",X),s({title:"Error",description:"Failed to save notes",variant:"destructive"})}};return o?c.jsxs("div",{className:"h-screen flex flex-col bg-gray-900",children:[c.jsxs("div",{className:"bg-gray-800 p-4 flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-white text-xl font-bold",children:"Telemedicine Consultation"}),p&&c.jsxs("p",{className:"text-gray-400 text-sm",children:[p.patient_name," with ",p.doctor_name]})]}),c.jsx(xt,{variant:o.status==="in_progress"?"default":"secondary",children:o.status.replace("_"," ").toUpperCase()})]}),c.jsxs("div",{className:"flex-1 flex gap-4 p-4",children:[c.jsxs("div",{className:"flex-1 bg-black rounded-lg relative overflow-hidden",children:[c.jsx("div",{ref:V,className:"w-full h-full"}),!k&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsxs("div",{className:"text-center text-white",children:[c.jsx(Au,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),c.jsx("p",{className:"text-lg",children:"Waiting for remote participant..."}),c.jsx(we,{onClick:Z,className:"mt-4",children:"Start Call"})]})})]}),c.jsxs("div",{className:"w-96 space-y-4",children:[c.jsx(_e,{className:"bg-gray-800 border-gray-700",children:c.jsxs(Te,{className:"p-0",children:[c.jsxs("div",{className:"relative h-48 bg-black rounded-t-lg overflow-hidden",children:[c.jsx("div",{ref:H,className:"w-full h-full"}),!k&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx(Au,{className:"h-12 w-12 text-white opacity-50"})})]}),k&&c.jsxs("div",{className:"flex justify-center gap-2 p-4 bg-gray-800",children:[c.jsx(we,{variant:b?"default":"destructive",size:"icon",onClick:ee,children:b?c.jsx(Au,{className:"h-4 w-4"}):c.jsx(Nwe,{className:"h-4 w-4"})}),c.jsx(we,{variant:A?"default":"destructive",size:"icon",onClick:$,children:A?c.jsx(Vf,{className:"h-4 w-4"}):c.jsx(gwe,{className:"h-4 w-4"})}),c.jsx(we,{variant:"destructive",size:"icon",onClick:se,children:c.jsx(Swe,{className:"h-4 w-4"})})]})]})}),c.jsxs(_e,{className:"bg-gray-800 border-gray-700 text-white",children:[c.jsx(Ke,{children:c.jsx(ze,{className:"text-white",children:"Consultation Details"})}),c.jsxs(Te,{className:"space-y-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Reason:"}),c.jsx("p",{children:o.reason||"General consultation"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-400",children:"Scheduled:"}),c.jsx("p",{children:new Date(o.scheduled_time).toLocaleString()})]})]})]}),c.jsxs(_e,{className:"bg-gray-800 border-gray-700",children:[c.jsxs(Ke,{children:[c.jsxs(ze,{className:"text-white flex items-center gap-2",children:[c.jsx(oa,{className:"h-5 w-5"}),"Consultation Notes"]}),c.jsx(Cn,{className:"text-gray-400",children:"Document your findings and recommendations"})]}),c.jsxs(Te,{children:[c.jsx(ii,{value:E,onChange:X=>y(X.target.value),placeholder:"Enter consultation notes...",className:"min-h-[200px] bg-gray-900 text-white border-gray-700"}),c.jsx(we,{onClick:le,className:"mt-2 w-full",children:"Save Notes"})]})]})]})]})]}):c.jsx("div",{className:"flex items-center justify-center h-screen",children:c.jsx("div",{className:"text-center",children:c.jsx("h2",{className:"text-2xl font-bold",children:"Loading consultation..."})})})}function tDe(){var Z;const{user:r}=ts(),{toast:s}=jr(),o=Dp(),[d,p]=I.useState(""),[f,E]=I.useState("all"),[y,b]=I.useState("all"),[C,A]=I.useState(!1),{data:D}=In({queryKey:["tickets",r==null?void 0:r.id,r==null?void 0:r.role,f,y],queryFn:async()=>{const ee=new URLSearchParams({user_id:(r==null?void 0:r.id)||"",user_role:(r==null?void 0:r.role)||""});return f!=="all"&&ee.append("status",f),y!=="all"&&ee.append("type",y),(await Ot("GET",`/api/tickets?${ee}`)).json()}}),{data:k}=In({queryKey:["ticket-stats",r==null?void 0:r.id,r==null?void 0:r.role],queryFn:async()=>{const ee=new URLSearchParams({user_id:(r==null?void 0:r.id)||"",user_role:(r==null?void 0:r.role)||""});return(await Ot("GET",`/api/tickets/stats/summary?${ee}`)).json()}}),{data:W}=In({queryKey:["users"],queryFn:async()=>(await Ot("GET","/api/system-admin/users")).json(),enabled:(r==null?void 0:r.role)==="hospital_admin"||(r==null?void 0:r.role)==="system_admin"}),G=Lr({mutationFn:async ee=>(await Ot("POST",`/api/tickets?user_id=${r==null?void 0:r.id}`,ee)).json(),onSuccess:()=>{o.invalidateQueries({queryKey:["tickets"]}),o.invalidateQueries({queryKey:["ticket-stats"]}),s({title:"Ticket created successfully"}),A(!1)}}),L=ee=>{ee.preventDefault();const $=new FormData(ee.currentTarget);G.mutate({title:$.get("title"),description:$.get("description"),type:$.get("type"),priority:$.get("priority"),category:$.get("category"),assigned_to:$.get("assigned_to")||null,due_date:$.get("due_date")||null})},H=((D==null?void 0:D.tickets)||[]).filter(ee=>ee.title.toLowerCase().includes(d.toLowerCase())||ee.ticketNumber.toLowerCase().includes(d.toLowerCase())),V=ee=>{switch(ee){case"urgent":return"bg-red-100 text-red-800 border-red-300";case"high":return"bg-orange-100 text-orange-800 border-orange-300";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},K=ee=>{switch(ee){case"open":return c.jsx(md,{className:"h-4 w-4"});case"in_progress":return c.jsx(bl,{className:"h-4 w-4"});case"resolved":return c.jsx(Ng,{className:"h-4 w-4"});case"closed":return c.jsx(gw,{className:"h-4 w-4"});default:return c.jsx(md,{className:"h-4 w-4"})}};return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Ticket Management"}),c.jsxs(us,{open:C,onOpenChange:A,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{children:[c.jsx(wl,{className:"h-4 w-4 mr-2"}),"Create Ticket"]})}),c.jsxs(hs,{className:"max-w-2xl",children:[c.jsx(ps,{children:c.jsx(ms,{children:"Create New Ticket"})}),c.jsxs("form",{onSubmit:L,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Title"}),c.jsx(at,{name:"title",required:!0})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Description"}),c.jsx(ii,{name:"description",rows:3})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Type"}),c.jsxs(Wn,{name:"type",required:!0,children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"task",children:"Task"}),c.jsx(ke,{value:"query",children:"Query"}),c.jsx(ke,{value:"issue",children:"Issue"}),c.jsx(ke,{value:"request",children:"Request"})]})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Priority"}),c.jsxs(Wn,{name:"priority",required:!0,children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"low",children:"Low"}),c.jsx(ke,{value:"medium",children:"Medium"}),c.jsx(ke,{value:"high",children:"High"}),c.jsx(ke,{value:"urgent",children:"Urgent"})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Category"}),c.jsxs(Wn,{name:"category",children:[c.jsx(jn,{children:c.jsx(Hn,{placeholder:"Select category"})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"clinical",children:"Clinical"}),c.jsx(ke,{value:"administrative",children:"Administrative"}),c.jsx(ke,{value:"technical",children:"Technical"}),c.jsx(ke,{value:"maintenance",children:"Maintenance"})]})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Due Date"}),c.jsx(at,{name:"due_date",type:"date"})]})]}),((r==null?void 0:r.role)==="hospital_admin"||(r==null?void 0:r.role)==="system_admin")&&c.jsxs("div",{children:[c.jsx(tt,{children:"Assign To"}),c.jsxs(Wn,{name:"assigned_to",children:[c.jsx(jn,{children:c.jsx(Hn,{placeholder:"Select user"})}),c.jsx(Mn,{children:(Z=W==null?void 0:W.users)==null?void 0:Z.map(ee=>c.jsxs(ke,{value:ee.id,children:[ee.full_name," (",ee.role,")"]},ee.id))})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(we,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancel"}),c.jsx(we,{type:"submit",disabled:G.isPending,children:G.isPending?"Creating...":"Create Ticket"})]})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Total Tickets"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(k==null?void 0:k.total)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Open"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(k==null?void 0:k.open)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"In Progress"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(k==null?void 0:k.in_progress)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Resolved"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold text-green-600",children:(k==null?void 0:k.resolved)||0})})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(Uo,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),c.jsx(at,{placeholder:"Search tickets...",value:d,onChange:ee=>p(ee.target.value),className:"pl-10"})]}),c.jsxs(Wn,{value:f,onValueChange:E,children:[c.jsx(jn,{className:"w-40",children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"all",children:"All Status"}),c.jsx(ke,{value:"open",children:"Open"}),c.jsx(ke,{value:"in_progress",children:"In Progress"}),c.jsx(ke,{value:"resolved",children:"Resolved"}),c.jsx(ke,{value:"closed",children:"Closed"})]})]}),c.jsxs(Wn,{value:y,onValueChange:b,children:[c.jsx(jn,{className:"w-40",children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"all",children:"All Types"}),c.jsx(ke,{value:"task",children:"Task"}),c.jsx(ke,{value:"query",children:"Query"}),c.jsx(ke,{value:"issue",children:"Issue"}),c.jsx(ke,{value:"request",children:"Request"})]})]})]})}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-3",children:[H.map(ee=>{var $;return c.jsx(_e,{className:"hover:shadow-md transition-shadow cursor-pointer",children:c.jsx(Te,{className:"p-4",children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx("span",{className:"font-mono text-sm text-muted-foreground",children:ee.ticketNumber}),c.jsx(xt,{variant:"outline",className:V(ee.priority),children:ee.priority}),c.jsxs(xt,{variant:"outline",className:"capitalize",children:[K(ee.status),c.jsx("span",{className:"ml-1",children:ee.status.replace("_"," ")})]}),c.jsx(xt,{variant:"secondary",className:"capitalize",children:ee.type})]}),c.jsx("h3",{className:"font-semibold mb-1",children:ee.title}),ee.description&&c.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:ee.description}),c.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm text-muted-foreground",children:[c.jsxs("span",{children:["Created by: ",($=ee.createdBy)==null?void 0:$.name]}),ee.assignedTo&&c.jsxs("span",{children:["Assigned to: ",ee.assignedTo.name]}),ee.dueDate&&c.jsxs("span",{children:["Due: ",new Date(ee.dueDate).toLocaleDateString()]})]})]})})})},ee.id)}),H.length===0&&c.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No tickets found"})]})})]})]})}function nDe(){const{user:r}=ts(),{toast:s}=jr(),o=Dp(),[d,p]=I.useState([]),{data:f}=In({queryKey:["assignment-stats"],queryFn:async()=>(await Ot("GET","/api/patient-assignments/stats")).json()}),{data:E}=In({queryKey:["unassigned-patients"],queryFn:async()=>(await Ot("GET","/api/patient-assignments/unassigned")).json()}),{data:y}=In({queryKey:["doctors"],queryFn:async()=>(await Ot("GET","/api/admin/users?role=doctor")).json()}),b=Lr({mutationFn:async({patientId:L,doctorId:B})=>(await Ot("POST",`/api/patient-assignments/assign?admin_id=${r==null?void 0:r.id}`,{patient_id:L,doctor_id:B})).json(),onSuccess:()=>{o.invalidateQueries({queryKey:["assignment-stats"]}),o.invalidateQueries({queryKey:["unassigned-patients"]}),s({title:"Patient assigned successfully"})}}),C=Lr({mutationFn:async({patientIds:L,doctorId:B})=>(await Ot("POST",`/api/patient-assignments/bulk-assign?admin_id=${r==null?void 0:r.id}`,{patient_ids:L,doctor_id:B})).json(),onSuccess:()=>{o.invalidateQueries({queryKey:["assignment-stats"]}),o.invalidateQueries({queryKey:["unassigned-patients"]}),p([]),s({title:"Patients assigned successfully"})}}),A=(L,B)=>{b.mutate({patientId:L,doctorId:B})},D=L=>{if(d.length===0){s({title:"No patients selected",variant:"destructive"});return}C.mutate({patientIds:d,doctorId:L})},k=L=>{p(B=>B.includes(L)?B.filter(H=>H!==L):[...B,L])},W=(E==null?void 0:E.patients)||[],G=(y==null?void 0:y.users)||[];return c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex justify-between items-center",children:c.jsx("h1",{className:"text-3xl font-bold",children:"Patient Assignments"})}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsxs(ze,{className:"text-sm font-medium flex items-center gap-2",children:[c.jsx(Lp,{className:"h-4 w-4"}),"Total Patients"]})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(f==null?void 0:f.total_patients)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsxs(ze,{className:"text-sm font-medium flex items-center gap-2",children:[c.jsx(wP,{className:"h-4 w-4"}),"Assigned"]})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold text-green-600",children:(f==null?void 0:f.assigned_patients)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsxs(ze,{className:"text-sm font-medium flex items-center gap-2",children:[c.jsx(bl,{className:"h-4 w-4"}),"Unassigned"]})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(f==null?void 0:f.unassigned_patients)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsxs(ze,{className:"text-sm font-medium flex items-center gap-2",children:[c.jsx(Gv,{className:"h-4 w-4"}),"Assignment Rate"]})}),c.jsx(Te,{children:c.jsxs("div",{className:"text-2xl font-bold",children:[(f==null?void 0:f.assignment_rate)||0,"%"]})})]})]}),(f==null?void 0:f.doctor_workload)&&f.doctor_workload.length>0&&c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Doctor Workload"})}),c.jsx(Te,{children:c.jsx("div",{className:"space-y-2",children:f.doctor_workload.map(L=>c.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[c.jsx("span",{className:"font-medium",children:L.doctor_name}),c.jsxs(xt,{variant:"secondary",children:[L.patient_count," patients"]})]},L.doctor_id))})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs(ze,{children:["Unassigned Patients (",W.length,")"]}),d.length>0&&c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-sm text-muted-foreground",children:[d.length," selected"]}),c.jsxs(Wn,{onValueChange:D,children:[c.jsx(jn,{className:"w-48",children:c.jsx(Hn,{placeholder:"Assign to doctor"})}),c.jsx(Mn,{children:G.length>0?G.map(L=>c.jsx(ke,{value:L.id,children:L.full_name},L.id)):c.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"No doctors available"})})]})]})]})}),c.jsx(Te,{children:W.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(wP,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"All patients have been assigned to doctors"})]}):c.jsxs(Cp,{children:[c.jsx(Rp,{children:c.jsxs(ia,{children:[c.jsx($n,{className:"w-12",children:c.jsx("input",{type:"checkbox",checked:d.length===W.length,onChange:L=>{L.target.checked?p(W.map(B=>B.id)):p([])},className:"rounded"})}),c.jsx($n,{children:"MRN"}),c.jsx($n,{children:"Patient Name"}),c.jsx($n,{children:"Age"}),c.jsx($n,{children:"Gender"}),c.jsx($n,{children:"Phone"}),c.jsx($n,{children:"Assign To"})]})}),c.jsx(xp,{children:W.map(L=>c.jsxs(ia,{children:[c.jsx(Gn,{children:c.jsx("input",{type:"checkbox",checked:d.includes(L.id),onChange:()=>k(L.id),className:"rounded"})}),c.jsx(Gn,{className:"font-mono text-sm",children:L.mrn}),c.jsx(Gn,{className:"font-medium",children:L.fullName}),c.jsx(Gn,{children:L.age}),c.jsx(Gn,{className:"capitalize",children:L.gender}),c.jsx(Gn,{children:L.phoneNumber}),c.jsx(Gn,{children:c.jsxs(Wn,{onValueChange:B=>A(L.id,B),children:[c.jsx(jn,{className:"w-48",children:c.jsx(Hn,{placeholder:"Select doctor"})}),c.jsx(Mn,{children:G.length>0?G.map(B=>c.jsx(ke,{value:B.id,children:B.full_name},B.id)):c.jsx("div",{className:"p-2 text-sm text-muted-foreground",children:"No doctors available"})})]})})]},L.id))})]})})]})]})}function rDe(){const{user:r}=ts(),{toast:s}=jr(),o=Dp(),[d,p]=I.useState(!1),[f,E]=I.useState(!1);I.useState(null),I.useState(null);const{data:y}=In({queryKey:["departments"],queryFn:async()=>(await Ot("GET","/api/department-management")).json()}),{data:b}=In({queryKey:["department-stats"],queryFn:async()=>(await Ot("GET","/api/department-management/stats/overview")).json()}),{data:C}=In({queryKey:["teams"],queryFn:async()=>(await Ot("GET","/api/team-management")).json()}),{data:A}=In({queryKey:["team-stats"],queryFn:async()=>(await Ot("GET","/api/team-management/stats/overview")).json()}),D="5f98058e-9bd6-4c92-9f8f-13b58b4c36f9",{data:k}=In({queryKey:["users",D],queryFn:async()=>(await Ot("GET",`/api/staff/hospital/${D}`)).json()}),W=Lr({mutationFn:async X=>(await Ot("POST",`/api/department-management?admin_id=${r==null?void 0:r.id}`,X)).json(),onSuccess:()=>{o.invalidateQueries({queryKey:["departments"]}),o.invalidateQueries({queryKey:["department-stats"]}),s({title:"Department created successfully"}),p(!1)}}),G=Lr({mutationFn:async X=>(await Ot("POST",`/api/team-management?admin_id=${r==null?void 0:r.id}`,X)).json(),onSuccess:()=>{o.invalidateQueries({queryKey:["teams"]}),o.invalidateQueries({queryKey:["team-stats"]}),s({title:"Team created successfully"}),E(!1)}}),[L,B]=I.useState(!1),[H,V]=I.useState(null),K=Lr({mutationFn:async X=>(await Ot("POST",`/api/department-management/assign-staff?admin_id=${r==null?void 0:r.id}`,X)).json(),onSuccess:()=>{o.invalidateQueries({queryKey:["departments"]}),o.invalidateQueries({queryKey:["department-stats"]}),o.invalidateQueries({queryKey:["users",D]}),s({title:"Staff assigned successfully"}),B(!1),V(null)}}),Z=X=>{X.preventDefault();const oe=new FormData(X.currentTarget);W.mutate({name:oe.get("name"),description:oe.get("description"),head_staff_id:oe.get("head_staff_id")||null,hospital_id:D})},ee=X=>{X.preventDefault();const oe=new FormData(X.currentTarget);G.mutate({name:oe.get("name"),description:oe.get("description"),team_type:oe.get("team_type"),department_id:oe.get("department_id")||null,team_lead_id:oe.get("team_lead_id")||null})},$=(y==null?void 0:y.departments)||[],se=(C==null?void 0:C.teams)||[],le=k||[];return c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex justify-between items-center",children:c.jsx("h1",{className:"text-3xl font-bold",children:"Department & Team Management"})}),c.jsxs(Al,{defaultValue:"departments",className:"space-y-4",children:[c.jsxs(Lc,{children:[c.jsx(kn,{value:"departments",children:"Departments"}),c.jsx(kn,{value:"teams",children:"Teams"})]}),c.jsxs(Ln,{value:"departments",className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Total Departments"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.total_departments)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Active"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold text-green-600",children:(b==null?void 0:b.active_departments)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Actions"})}),c.jsx(Te,{children:c.jsxs(us,{open:d,onOpenChange:p,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{className:"w-full",children:[c.jsx(wl,{className:"h-4 w-4 mr-2"}),"Create Department"]})}),c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsx(ms,{children:"Create New Department"})}),c.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Department Name"}),c.jsx(at,{name:"name",required:!0,placeholder:"e.g., Pediatrics"})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Description"}),c.jsx(ii,{name:"description",rows:3,placeholder:"Department description..."})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Department Head"}),c.jsxs(Wn,{name:"head_staff_id",children:[c.jsx(jn,{children:c.jsx(Hn,{placeholder:"Select head of department"})}),c.jsx(Mn,{children:le.filter(X=>X.role==="doctor").map(X=>c.jsx(ke,{value:X.id,children:X.full_name},X.id))})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(we,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),c.jsx(we,{type:"submit",disabled:W.isPending,children:W.isPending?"Creating...":"Create"})]})]})]})]})})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Departments"})}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-3",children:[$.map(X=>c.jsx(_e,{className:"hover:shadow-md transition-shadow",children:c.jsx(Te,{className:"p-4",children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(twe,{className:"h-5 w-5 text-muted-foreground"}),c.jsx("h3",{className:"font-semibold text-lg",children:X.name}),c.jsx(xt,{variant:X.status==="active"?"default":"secondary",children:X.status})]}),X.description&&c.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:X.description}),c.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[X.headStaff&&c.jsxs("span",{children:["Head: ",X.headStaff.name]}),c.jsxs("span",{children:[X.staffCount," staff members"]})]})]}),c.jsxs(we,{variant:"outline",size:"sm",onClick:()=>{V(X.id),B(!0)},children:[c.jsx(Tb,{className:"h-4 w-4 mr-2"}),"Assign Staff"]})]})})},X.id)),$.length===0&&c.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No departments created yet"})]})})]})]}),c.jsxs(Ln,{value:"teams",className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Total Teams"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(A==null?void 0:A.total_teams)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Active Teams"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold text-green-600",children:(A==null?void 0:A.active_teams)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Actions"})}),c.jsx(Te,{children:c.jsxs(us,{open:f,onOpenChange:E,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{className:"w-full",children:[c.jsx(wl,{className:"h-4 w-4 mr-2"}),"Create Team"]})}),c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsx(ms,{children:"Create New Team"})}),c.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Team Name"}),c.jsx(at,{name:"name",required:!0,placeholder:"e.g., Pediatrics Emergency Team"})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Description"}),c.jsx(ii,{name:"description",rows:3,placeholder:"Team description..."})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Team Type"}),c.jsxs(Wn,{name:"team_type",required:!0,children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"clinical",children:"Clinical"}),c.jsx(ke,{value:"emergency",children:"Emergency"}),c.jsx(ke,{value:"surgical",children:"Surgical"}),c.jsx(ke,{value:"pediatric",children:"Pediatric"}),c.jsx(ke,{value:"icu",children:"ICU"}),c.jsx(ke,{value:"maternity",children:"Maternity"}),c.jsx(ke,{value:"oncology",children:"Oncology"})]})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Department"}),c.jsxs(Wn,{name:"department_id",children:[c.jsx(jn,{children:c.jsx(Hn,{placeholder:"Select department"})}),c.jsx(Mn,{children:$.map(X=>c.jsx(ke,{value:X.id,children:X.name},X.id))})]})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Team Lead"}),c.jsxs(Wn,{name:"team_lead_id",children:[c.jsx(jn,{children:c.jsx(Hn,{placeholder:"Select team lead"})}),c.jsx(Mn,{children:le.filter(X=>["doctor","nurse"].includes(X.role)).map(X=>c.jsxs(ke,{value:X.id,children:[X.full_name," (",X.role,")"]},X.id))})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(we,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Cancel"}),c.jsx(we,{type:"submit",disabled:G.isPending,children:G.isPending?"Creating...":"Create"})]})]})]})]})})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Teams"})}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-3",children:[se.map(X=>c.jsx(_e,{className:"hover:shadow-md transition-shadow",children:c.jsx(Te,{className:"p-4",children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(Lp,{className:"h-5 w-5 text-muted-foreground"}),c.jsx("h3",{className:"font-semibold text-lg",children:X.name}),c.jsx(xt,{variant:"outline",className:"capitalize",children:X.teamType}),c.jsx(xt,{variant:X.status==="active"?"default":"secondary",children:X.status})]}),X.description&&c.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:X.description}),c.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[X.teamLead&&c.jsxs("span",{children:["Lead: ",X.teamLead.name]}),c.jsxs("span",{children:[X.memberCount," members"]})]})]})})})},X.id)),se.length===0&&c.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No teams created yet"})]})})]})]})]}),c.jsx(us,{open:L,onOpenChange:B,children:c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsx(ms,{children:"Assign Staff to Department"})}),c.jsxs("form",{onSubmit:X=>{X.preventDefault();const je=new FormData(X.currentTarget).get("user_id");je&&H&&K.mutate({user_id:je,department_id:H})},className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Select Staff Member"}),c.jsxs(Wn,{name:"user_id",required:!0,children:[c.jsx(jn,{children:c.jsx(Hn,{placeholder:"Choose a staff member"})}),c.jsx(Mn,{children:le.map(X=>c.jsxs(ke,{value:X.id,children:[X.fullName," - ",X.role]},X.id))})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(we,{type:"button",variant:"outline",onClick:()=>B(!1),children:"Cancel"}),c.jsx(we,{type:"submit",disabled:K.isPending,children:K.isPending?"Assigning...":"Assign"})]})]})]})})]})}function sDe(){var rt,De;const{patientId:r}=dw(),{user:s}=ts(),{toast:o}=jr(),d=Dp(),[p,f]=I.useState(!1),[E,y]=I.useState(""),[b,C]=I.useState(""),{data:A}=In({queryKey:["patient",r],queryFn:async()=>(await Ot("GET",`/api/patients/${r}`)).json(),enabled:!!r}),{data:D,isLoading:k,refetch:W}=In({queryKey:["ai-summary",r],queryFn:async()=>(await Ot("GET",`/api/ai-clinical-insights/patient-summary/${r}?doctor_id=${s==null?void 0:s.id}`)).json(),enabled:!!r&&!!(s!=null&&s.id)}),{data:G,refetch:L}=In({queryKey:["lab-analysis",r],queryFn:async()=>(await Ot("GET",`/api/ai-clinical-insights/lab-analysis/${r}?doctor_id=${s==null?void 0:s.id}`)).json(),enabled:!1}),{data:B,refetch:H}=In({queryKey:["risk-assessment",r],queryFn:async()=>(await Ot("GET",`/api/ai-clinical-insights/risk-assessment/${r}?doctor_id=${s==null?void 0:s.id}`)).json(),enabled:!1}),{data:V}=In({queryKey:["doctor-notes",r],queryFn:async()=>(await Ot("GET",`/api/doctor-notes/patient/${r}?doctor_id=${s==null?void 0:s.id}`)).json(),enabled:!!r}),K=Lr({mutationFn:async Oe=>(await Ot("POST",`/api/ai-clinical-insights/treatment-recommendations?doctor_id=${s==null?void 0:s.id}`,{patient_id:r,diagnosis:Oe})).json()}),Z=Lr({mutationFn:async Oe=>(await Ot("POST",`/api/ai-clinical-insights/ask-question?doctor_id=${s==null?void 0:s.id}`,{question:Oe,patient_id:r})).json()}),{data:ee}=In({queryKey:["patient-files",r],queryFn:async()=>(await Ot("GET",`/api/patient-files/patient/${r}`)).json(),enabled:!!r}),{data:$,refetch:se,isLoading:le}=In({queryKey:["ai-files-summary",r],queryFn:async()=>(await Ot("GET",`/api/ai-clinical-insights/summarize-files/${r}?doctor_id=${s==null?void 0:s.id}`)).json(),enabled:!1}),X=Lr({mutationFn:async Oe=>(await Ot("POST",`/api/doctor-notes?doctor_id=${s==null?void 0:s.id}`,Oe)).json(),onSuccess:()=>{d.invalidateQueries({queryKey:["doctor-notes"]}),o({title:"Note created successfully"}),f(!1)}}),oe=Oe=>{Oe.preventDefault();const Re=new FormData(Oe.currentTarget);X.mutate({patient_id:r,note_type:Re.get("note_type"),title:Re.get("title"),content:Re.get("content"),is_private:Re.get("is_private")==="on"?"1":"0"})},je=()=>{if(!E.trim()){o({title:"Please enter a diagnosis",variant:"destructive"});return}K.mutate(E)},Ce=()=>{if(!b.trim()){o({title:"Please enter a question",variant:"destructive"});return}Z.mutate(b)},We=A==null?void 0:A.patient,he=(V==null?void 0:V.notes)||[];return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[c.jsx(yu,{className:"h-8 w-8 text-blue-600"}),"AI Clinical Assistant"]}),We&&c.jsxs("p",{className:"text-muted-foreground mt-1",children:["Patient: ",We.firstName," ",We.lastName,"  ",We.age,"y  ",We.gender]})]}),c.jsxs(us,{open:p,onOpenChange:f,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{children:[c.jsx(wl,{className:"h-4 w-4 mr-2"}),"Add Note"]})}),c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsx(ms,{children:"Add Clinical Note"})}),c.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Note Type"}),c.jsxs(Wn,{name:"note_type",required:!0,children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"consultation",children:"Consultation"}),c.jsx(ke,{value:"diagnosis",children:"Diagnosis"}),c.jsx(ke,{value:"treatment",children:"Treatment"}),c.jsx(ke,{value:"follow_up",children:"Follow-up"}),c.jsx(ke,{value:"observation",children:"Observation"})]})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Title"}),c.jsx(at,{name:"title",placeholder:"Brief title"})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Content"}),c.jsx(ii,{name:"content",rows:5,required:!0,placeholder:"Clinical notes..."})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"checkbox",name:"is_private",id:"is_private",className:"rounded"}),c.jsx(tt,{htmlFor:"is_private",className:"cursor-pointer",children:"Private note (only visible to me)"})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(we,{type:"button",variant:"outline",onClick:()=>f(!1),children:"Cancel"}),c.jsx(we,{type:"submit",disabled:X.isPending,children:X.isPending?"Saving...":"Save Note"})]})]})]})]})]}),c.jsxs(Al,{defaultValue:"summary",className:"space-y-4",children:[c.jsxs(Lc,{children:[c.jsx(kn,{value:"summary",children:"AI Summary"}),c.jsx(kn,{value:"files",children:"Patient Files"}),c.jsx(kn,{value:"lab-analysis",children:"Lab Analysis"}),c.jsx(kn,{value:"treatment",children:"Treatment"}),c.jsx(kn,{value:"risk",children:"Risk Assessment"}),c.jsx(kn,{value:"notes",children:"Clinical Notes"}),c.jsx(kn,{value:"ask",children:"Ask AI"})]}),c.jsx(Ln,{value:"summary",children:c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(KE,{className:"h-5 w-5 text-blue-600"}),"Patient History Summary"]}),c.jsx(Cn,{children:"AI-generated comprehensive summary of patient's medical history"})]}),c.jsx(Te,{children:k?c.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[c.jsx(yu,{className:"h-12 w-12 mx-auto mb-4 animate-pulse"}),c.jsx("p",{children:"AI is analyzing patient data..."})]}):D!=null&&D.summary?c.jsxs("div",{className:"prose max-w-none",children:[c.jsx("div",{className:"whitespace-pre-wrap bg-muted p-4 rounded-lg",children:D.summary}),c.jsxs("div",{className:"flex gap-4 mt-4 text-sm text-muted-foreground",children:[c.jsxs("span",{children:[" ",D.notes_count," notes analyzed"]}),c.jsxs("span",{children:[" ",D.lab_results_count," lab results reviewed"]})]})]}):c.jsx("div",{className:"text-center py-8",children:c.jsxs(we,{onClick:()=>W(),children:[c.jsx(KE,{className:"h-4 w-4 mr-2"}),"Generate AI Summary"]})})})]})}),c.jsx(Ln,{value:"files",children:c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(oa,{className:"h-5 w-5 text-orange-600"}),"Patient Medical Files"]}),c.jsx(Cn,{children:"View all uploaded medical documents and get AI insights"})]}),(ee==null?void 0:ee.files)&&ee.files.length>0&&c.jsxs(we,{onClick:()=>se(),disabled:le,variant:"outline",children:[c.jsx(KE,{className:"h-4 w-4 mr-2"}),le?"Analyzing...":"AI Summary"]})]})}),c.jsxs(Te,{className:"space-y-4",children:[($==null?void 0:$.summary)&&c.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4",children:c.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[c.jsx(yu,{className:"h-5 w-5 text-purple-600 mt-0.5"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"AI Folder Summary"}),c.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:$.summary}),c.jsxs("div",{className:"mt-3 text-xs text-purple-700",children:[" ",$.files_analyzed," files analyzed"]})]})]})}),ee!=null&&ee.files&&ee.files.length>0?c.jsxs("div",{className:"space-y-3",children:[c.jsxs("h3",{className:"font-semibold text-sm text-muted-foreground",children:["All Files (",ee.files.length,")"]}),ee.files.map(Oe=>c.jsx("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:c.jsxs("div",{className:"flex items-start justify-between",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx(oa,{className:"h-4 w-4 text-blue-600"}),c.jsx("span",{className:"font-medium",children:Oe.fileName}),c.jsx(xt,{variant:"outline",className:"text-xs",children:Oe.fileType||"Document"})]}),Oe.description&&c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:Oe.description}),c.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[c.jsxs("span",{children:["Uploaded: ",new Date(Oe.uploadedAt).toLocaleDateString()]}),c.jsxs("span",{children:["By: ",Oe.uploadedBy]}),Oe.fileSize&&c.jsxs("span",{children:["Size: ",(Oe.fileSize/1024).toFixed(1)," KB"]})]})]}),c.jsx(we,{variant:"ghost",size:"sm",asChild:!0,children:c.jsx("a",{href:`/api/patient-files/download/${Oe.id}`,target:"_blank",rel:"noopener noreferrer",children:"View"})})]})},Oe.id))]}):c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(oa,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"No medical files uploaded yet"}),c.jsx("p",{className:"text-sm mt-2",children:"Files can be uploaded from the Medical History page"})]})]})]})}),c.jsx(Ln,{value:"lab-analysis",children:c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(Tl,{className:"h-5 w-5 text-green-600"}),"Laboratory Results Analysis"]}),c.jsx(Cn,{children:"AI-powered analysis of lab results with clinical insights"})]}),c.jsx(Te,{children:G!=null&&G.analysis?c.jsx("div",{className:"whitespace-pre-wrap bg-muted p-4 rounded-lg",children:G.analysis}):c.jsx("div",{className:"text-center py-8",children:c.jsxs(we,{onClick:()=>L(),children:[c.jsx(Tl,{className:"h-4 w-4 mr-2"}),"Analyze Lab Results"]})})})]})}),c.jsx(Ln,{value:"treatment",children:c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Treatment Recommendations"}),c.jsx(Cn,{children:"Get AI-powered treatment suggestions based on diagnosis"})]}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Diagnosis/Condition"}),c.jsx(at,{value:E,onChange:Oe=>y(Oe.target.value),placeholder:"Enter diagnosis or condition..."})]}),c.jsx(we,{onClick:je,disabled:K.isPending,children:K.isPending?"Generating...":"Get Treatment Recommendations"}),((rt=K.data)==null?void 0:rt.recommendations)&&c.jsx("div",{className:"whitespace-pre-wrap bg-muted p-4 rounded-lg mt-4",children:K.data.recommendations})]})]})}),c.jsx(Ln,{value:"risk",children:c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(bl,{className:"h-5 w-5 text-orange-600"}),"Risk Factor Assessment"]}),c.jsx(Cn,{children:"Identify potential health risks and preventive measures"})]}),c.jsx(Te,{children:B!=null&&B.risk_assessment?c.jsx("div",{className:"whitespace-pre-wrap bg-muted p-4 rounded-lg",children:B.risk_assessment}):c.jsx("div",{className:"text-center py-8",children:c.jsxs(we,{onClick:()=>H(),children:[c.jsx(Gv,{className:"h-4 w-4 mr-2"}),"Assess Risk Factors"]})})})]})}),c.jsx(Ln,{value:"notes",children:c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs(ze,{children:["Clinical Notes (",he.length,")"]})}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-3",children:[he.map(Oe=>{var Re;return c.jsx(_e,{children:c.jsxs(Te,{className:"p-4",children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(xt,{variant:"outline",className:"capitalize",children:Oe.noteType.replace("_"," ")}),Oe.isPrivate&&c.jsx(xt,{variant:"secondary",children:"Private"})]}),c.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(Oe.createdAt).toLocaleDateString()})]}),Oe.title&&c.jsx("h4",{className:"font-semibold mb-2",children:Oe.title}),c.jsx("p",{className:"text-sm whitespace-pre-wrap",children:Oe.content}),c.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["By: ",(Re=Oe.doctor)==null?void 0:Re.name]})]})},Oe.id)}),he.length===0&&c.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No clinical notes yet"})]})})]})}),c.jsx(Ln,{value:"ask",children:c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(yu,{className:"h-5 w-5 text-purple-600"}),"Ask Clinical Question"]}),c.jsx(Cn,{children:"Get AI-powered answers to clinical questions with patient context"})]}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Your Question"}),c.jsx(ii,{value:b,onChange:Oe=>C(Oe.target.value),rows:3,placeholder:"Ask a clinical question about this patient..."})]}),c.jsx(we,{onClick:Ce,disabled:Z.isPending,children:Z.isPending?"Thinking...":"Ask AI"}),((De=Z.data)==null?void 0:De.answer)&&c.jsxs("div",{className:"space-y-2",children:[c.jsx(td,{}),c.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[c.jsx("p",{className:"font-semibold text-sm mb-2",children:"Question:"}),c.jsx("p",{className:"text-sm mb-4",children:Z.data.question}),c.jsx("p",{className:"font-semibold text-sm mb-2",children:"AI Answer:"}),c.jsx("div",{className:"whitespace-pre-wrap text-sm",children:Z.data.answer})]})]})]})]})})]})]})}function iDe(){var G;ts();const[r,s]=I.useState([{role:"assistant",content:"Hello! I'm Dr. Tega, your AI health assistant. I'm here to answer your health questions, provide wellness tips, and help you understand medical information. How can I help you today?",timestamp:new Date}]),[o,d]=I.useState(""),[p,f]=I.useState(!1),E=I.useRef(null),{data:y}=In({queryKey:["quick-questions"],queryFn:async()=>(await Ot("GET","/api/health-chatbot/quick-questions")).json()}),b=Lr({mutationFn:async L=>{const B=r.map(V=>({role:V.role,content:V.content}));return(await Ot("POST","/api/health-chatbot/chat",{message:L,conversation_history:B})).json()},onSuccess:L=>{s(B=>[...B,{role:"assistant",content:L.response,timestamp:new Date}]),f(!1)},onError:()=>{s(L=>[...L,{role:"assistant",content:"I apologize, but I'm having trouble responding right now. Please try again.",timestamp:new Date}]),f(!1)}}),C=Lr({mutationFn:async L=>(await Ot("POST","/api/health-chatbot/health-tips",{category:L})).json(),onSuccess:L=>{s(B=>[...B,{role:"assistant",content:L.tips,timestamp:new Date}]),f(!1)}});I.useEffect(()=>{E.current&&(E.current.scrollTop=E.current.scrollHeight)},[r]);const A=()=>{if(!o.trim())return;const L={role:"user",content:o,timestamp:new Date};s(B=>[...B,L]),d(""),f(!0),b.mutate(o)},D=L=>{const B={role:"user",content:L,timestamp:new Date};s(H=>[...H,B]),f(!0),b.mutate(L)},k=L=>{const B={role:"user",content:`Give me ${L} health tips`,timestamp:new Date};s(H=>[...H,B]),f(!0),C.mutate(L)},W=[{name:"General",icon:e1,value:"general"},{name:"Nutrition",icon:$be,value:"nutrition"},{name:"Exercise",icon:Tl,value:"exercise"},{name:"Mental Health",icon:yu,value:"mental_health"},{name:"Sleep",icon:_we,value:"sleep"},{name:"Preventive",icon:n1,value:"preventive"}];return c.jsxs("div",{className:"container mx-auto p-6 space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[c.jsx(GT,{className:"h-8 w-8 text-blue-600"}),"Health Chatbot"]}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Ask Dr. Tega anything about health and wellness"})]}),c.jsxs(xt,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[c.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full mr-2 animate-pulse"}),"Online"]})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[c.jsxs("div",{className:"lg:col-span-3",children:[c.jsx(_e,{children:c.jsx(Te,{className:"p-0",children:c.jsx(Su,{className:"h-[500px] p-4",ref:E,children:c.jsxs("div",{className:"space-y-4",children:[r.map((L,B)=>c.jsxs("div",{className:`flex gap-3 ${L.role==="user"?"justify-end":"justify-start"}`,children:[L.role==="assistant"&&c.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:c.jsx(GT,{className:"h-5 w-5 text-blue-600"})}),c.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 ${L.role==="user"?"bg-blue-600 text-white":"bg-muted"}`,children:[c.jsx("p",{className:"text-sm whitespace-pre-wrap",children:L.content}),c.jsx("span",{className:"text-xs opacity-70 mt-1 block",children:L.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),L.role==="user"&&c.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center flex-shrink-0",children:c.jsx(gp,{className:"h-5 w-5 text-white"})})]},B)),p&&c.jsxs("div",{className:"flex gap-3",children:[c.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center",children:c.jsx(GT,{className:"h-5 w-5 text-blue-600"})}),c.jsx("div",{className:"bg-muted rounded-lg p-3",children:c.jsxs("div",{className:"flex gap-1",children:[c.jsx("div",{className:"h-2 w-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),c.jsx("div",{className:"h-2 w-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),c.jsx("div",{className:"h-2 w-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]})]})})})}),c.jsx(_e,{className:"mt-4",children:c.jsxs(Te,{className:"p-4",children:[c.jsxs("div",{className:"flex gap-2",children:[c.jsx(at,{value:o,onChange:L=>d(L.target.value),onKeyPress:L=>L.key==="Enter"&&A(),placeholder:"Type your health question here...",disabled:p,className:"flex-1"}),c.jsxs(we,{onClick:A,disabled:!o.trim()||p,size:"lg",children:[c.jsx(t1,{className:"h-4 w-4 mr-2"}),"Send"]})]}),c.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send  Dr. Tega is powered by AI"})]})})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs(ze,{className:"text-sm flex items-center gap-2",children:[c.jsx(KE,{className:"h-4 w-4"}),"Health Tips"]})}),c.jsx(Te,{className:"space-y-2",children:W.map(L=>{const B=L.icon;return c.jsxs(we,{variant:"outline",size:"sm",className:"w-full justify-start",onClick:()=>k(L.value),disabled:p,children:[c.jsx(B,{className:"h-4 w-4 mr-2"}),L.name]},L.value)})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{className:"text-sm",children:"Quick Questions"})}),c.jsx(Te,{className:"space-y-2",children:(G=y==null?void 0:y.quick_questions)==null?void 0:G.slice(0,5).map((L,B)=>c.jsx(we,{variant:"ghost",size:"sm",className:"w-full justify-start text-left h-auto py-2 px-3",onClick:()=>D(L),disabled:p,children:c.jsx("span",{className:"text-xs line-clamp-2",children:L})},B))})]}),c.jsx(_e,{className:"bg-blue-50 border-blue-200",children:c.jsx(Te,{className:"p-4",children:c.jsxs("p",{className:"text-xs text-blue-900",children:[c.jsx("strong",{children:"Note:"})," Dr. Tega provides general health information. For medical emergencies or specific diagnoses, please consult a healthcare professional."]})})})]})]})]})}function aDe(){const{user:r}=ts(),{toast:s}=jr(),o=Dp(),[d,p]=I.useState(!1),[f,E]=I.useState("text"),[y,b]=I.useState(!1),[C,A]=I.useState(null),[D,k]=I.useState(null),W=I.useRef(null),{data:G}=In({queryKey:["diary-entries",r==null?void 0:r.id],queryFn:async()=>(await Ot("GET",`/api/diary?user_id=${r==null?void 0:r.id}`)).json()}),{data:L}=In({queryKey:["diary-stats",r==null?void 0:r.id],queryFn:async()=>(await Ot("GET",`/api/diary/stats/summary?user_id=${r==null?void 0:r.id}`)).json()}),B=Lr({mutationFn:async $=>(await Ot("POST",`/api/diary?user_id=${r==null?void 0:r.id}`,$)).json(),onSuccess:()=>{o.invalidateQueries({queryKey:["diary-entries"]}),o.invalidateQueries({queryKey:["diary-stats"]}),s({title:"Diary entry created successfully"}),p(!1),k(null)}}),H=async()=>{try{const $=await navigator.mediaDevices.getUserMedia({audio:!0,video:f==="video"});f==="video"&&W.current&&(W.current.srcObject=$,W.current.play());const se=new MediaRecorder($),le=[];se.ondataavailable=X=>le.push(X.data),se.onstop=()=>{const X=new Blob(le,{type:f==="audio"?"audio/webm":"video/mp4"});k(X),$.getTracks().forEach(oe=>oe.stop())},se.start(),A(se),b(!0)}catch{s({title:"Failed to start recording",variant:"destructive"})}},V=()=>{C&&(C.stop(),b(!1))},K=async $=>{$.preventDefault();const se=new FormData($.currentTarget);let le=null;if(D&&(f==="audio"||f==="video")){const X=new FileReader;le=await new Promise(oe=>{X.onloadend=()=>oe(X.result),X.readAsDataURL(D)})}B.mutate({title:se.get("title"),content:se.get("content"),entry_type:f,mood:se.get("mood"),tags:se.get("tags"),media_data:le})},Z=$=>{switch($){case"happy":return c.jsx(wwe,{className:"h-4 w-4 text-green-600"});case"sad":return c.jsx(lwe,{className:"h-4 w-4 text-blue-600"});case"stressed":return c.jsx(aQ,{className:"h-4 w-4 text-orange-600"});case"excited":return c.jsx(e1,{className:"h-4 w-4 text-pink-600"});default:return c.jsx(fwe,{className:"h-4 w-4 text-gray-600"})}},ee=(G==null?void 0:G.entries)||[];return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Personal Diary"}),c.jsxs(us,{open:d,onOpenChange:p,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{children:[c.jsx(wl,{className:"h-4 w-4 mr-2"}),"New Entry"]})}),c.jsxs(hs,{className:"max-w-2xl",children:[c.jsx(ps,{children:c.jsx(ms,{children:"Create Diary Entry"})}),c.jsxs("form",{onSubmit:K,className:"space-y-4",children:[c.jsxs(Al,{value:f,onValueChange:$=>E($),children:[c.jsxs(Lc,{className:"grid w-full grid-cols-3",children:[c.jsxs(kn,{value:"text",children:[c.jsx(oa,{className:"h-4 w-4 mr-2"}),"Text"]}),c.jsxs(kn,{value:"audio",children:[c.jsx(Vf,{className:"h-4 w-4 mr-2"}),"Audio"]}),c.jsxs(kn,{value:"video",children:[c.jsx(Au,{className:"h-4 w-4 mr-2"}),"Video"]})]}),c.jsxs(Ln,{value:"text",className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Title"}),c.jsx(at,{name:"title",placeholder:"Entry title..."})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Content"}),c.jsx(ii,{name:"content",rows:6,placeholder:"Write your thoughts...",required:!0})]})]}),c.jsxs(Ln,{value:"audio",className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Title"}),c.jsx(at,{name:"title",placeholder:"Entry title..."})]}),c.jsxs("div",{className:"flex flex-col items-center gap-4 p-6 border rounded-lg",children:[!y&&!D&&c.jsxs(we,{type:"button",onClick:H,children:[c.jsx(Vf,{className:"h-4 w-4 mr-2"}),"Start Recording"]}),y&&c.jsx(we,{type:"button",onClick:V,variant:"destructive",children:"Stop Recording"}),D&&c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-sm text-green-600 mb-2",children:" Audio recorded"}),c.jsx(we,{type:"button",onClick:()=>k(null),variant:"outline",size:"sm",children:"Re-record"})]})]})]}),c.jsxs(Ln,{value:"video",className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Title"}),c.jsx(at,{name:"title",placeholder:"Entry title..."})]}),c.jsxs("div",{className:"flex flex-col items-center gap-4 p-6 border rounded-lg",children:[y&&c.jsx("video",{ref:W,className:"w-full max-w-md rounded-lg",muted:!0}),!y&&!D&&c.jsxs(we,{type:"button",onClick:H,children:[c.jsx(Au,{className:"h-4 w-4 mr-2"}),"Start Recording"]}),y&&c.jsx(we,{type:"button",onClick:V,variant:"destructive",children:"Stop Recording"}),D&&c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-sm text-green-600 mb-2",children:" Video recorded"}),c.jsx(we,{type:"button",onClick:()=>k(null),variant:"outline",size:"sm",children:"Re-record"})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Mood"}),c.jsxs(Wn,{name:"mood",children:[c.jsx(jn,{children:c.jsx(Hn,{placeholder:"How are you feeling?"})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"happy",children:" Happy"}),c.jsx(ke,{value:"sad",children:" Sad"}),c.jsx(ke,{value:"neutral",children:" Neutral"}),c.jsx(ke,{value:"stressed",children:" Stressed"}),c.jsx(ke,{value:"excited",children:" Excited"})]})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Tags"}),c.jsx(at,{name:"tags",placeholder:"work, personal, health..."})]})]}),c.jsxs("div",{className:"flex justify-end gap-2",children:[c.jsx(we,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancel"}),c.jsx(we,{type:"submit",disabled:B.isPending,children:B.isPending?"Saving...":"Save Entry"})]})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm",children:"Total Entries"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(L==null?void 0:L.total_entries)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm",children:"Text"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(L==null?void 0:L.text_entries)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm",children:"Audio"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(L==null?void 0:L.audio_entries)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm",children:"Video"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(L==null?void 0:L.video_entries)||0})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm",children:"This Week"})}),c.jsx(Te,{children:c.jsx("div",{className:"text-2xl font-bold",children:(L==null?void 0:L.entries_this_week)||0})})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"My Entries"})}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-3",children:[ee.map($=>c.jsx(_e,{className:"hover:shadow-md transition-shadow",children:c.jsx(Te,{className:"p-4",children:c.jsx("div",{className:"flex items-start justify-between",children:c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[$.entryType==="text"&&c.jsx(oa,{className:"h-4 w-4"}),$.entryType==="audio"&&c.jsx(Vf,{className:"h-4 w-4"}),$.entryType==="video"&&c.jsx(Au,{className:"h-4 w-4"}),$.title&&c.jsx("h3",{className:"font-semibold",children:$.title}),$.mood&&Z($.mood),c.jsx(xt,{variant:"outline",className:"capitalize",children:$.entryType})]}),$.content&&c.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:$.content}),c.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[c.jsx(pd,{className:"h-3 w-3"}),new Date($.createdAt).toLocaleDateString()," at ",new Date($.createdAt).toLocaleTimeString()]})]})})})},$.id)),ee.length===0&&c.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No diary entries yet. Start recording your thoughts!"})]})})]})]})}function oDe(){const{user:r}=ts(),{toast:s}=jr(),[o,d]=I.useState([]),[p,f]=I.useState(""),[E,y]=I.useState([]),[b,C]=I.useState(!1),[A,D]=I.useState(!1),[k,W]=I.useState("all"),[G,L]=I.useState(""),[B,H]=I.useState(null),[V,K]=I.useState("lab_result"),[Z,ee]=I.useState(""),[$,se]=I.useState("");I.useEffect(()=>{le()},[]),I.useEffect(()=>{p&&X()},[p,k]);const le=async()=>{try{const Oe=await(await fetch("http://localhost:5000/api/patients",{headers:{"user-id":(r==null?void 0:r.id)||""}})).json();d(Oe.patients||[])}catch(De){console.error("Failed to fetch patients:",De)}},X=async()=>{if(p){C(!0);try{const De=new URLSearchParams;k!=="all"&&De.append("file_type",k);const Re=await(await fetch(`http://localhost:5000/api/patient-files/patient/${p}?${De}`,{headers:{"user-id":(r==null?void 0:r.id)||""}})).json();y(Re.files||[])}catch{s({title:"Error",description:"Failed to fetch patient files",variant:"destructive"})}finally{C(!1)}}},oe=async De=>{if(De.preventDefault(),!B||!p)return;const Oe=new FileReader;Oe.onloadend=async()=>{try{if((await fetch("http://localhost:5000/api/patient-files/upload",{method:"POST",headers:{"Content-Type":"application/json","user-id":(r==null?void 0:r.id)||""},body:JSON.stringify({patient_id:p,file_type:V,file_name:B.name,file_data:Oe.result,description:$,category:Z})})).ok)s({title:"Success",description:"File uploaded successfully"}),D(!1),je(),X();else throw new Error("Upload failed")}catch{s({title:"Error",description:"Failed to upload file",variant:"destructive"})}},Oe.readAsDataURL(B)},je=()=>{H(null),K("lab_result"),ee(""),se("")},Ce=async De=>{if(confirm("Are you sure you want to delete this file?"))try{(await fetch(`http://localhost:5000/api/patient-files/${De}`,{method:"DELETE",headers:{"user-id":(r==null?void 0:r.id)||""}})).ok&&(s({title:"Success",description:"File deleted successfully"}),X())}catch{s({title:"Error",description:"Failed to delete file",variant:"destructive"})}},We=E.filter(De=>{var Oe;return De.fileName.toLowerCase().includes(G.toLowerCase())||((Oe=De.description)==null?void 0:Oe.toLowerCase().includes(G.toLowerCase()))}),he=["doctor","nurse","lab_tech","pharmacist","admin","system_admin"].includes((r==null?void 0:r.role)||""),rt=["doctor","admin","system_admin"].includes((r==null?void 0:r.role)||"");return c.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[c.jsx("div",{className:"flex justify-between items-center",children:c.jsx("h1",{className:"text-3xl font-bold",children:"Patient Medical History"})}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Select Patient"})}),c.jsx(Te,{children:c.jsxs(Wn,{value:p,onValueChange:f,children:[c.jsx(jn,{children:c.jsx(Hn,{placeholder:"Choose a patient"})}),c.jsx(Mn,{children:o.map(De=>c.jsxs(ke,{value:De.id,children:[De.firstName," ",De.lastName," - MRN: ",De.mrn]},De.id))})]})})]}),p&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex gap-4 items-center",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(Uo,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),c.jsx(at,{placeholder:"Search files...",value:G,onChange:De=>L(De.target.value),className:"pl-10"})]}),c.jsxs(Wn,{value:k,onValueChange:W,children:[c.jsx(jn,{className:"w-48",children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"all",children:"All Files"}),c.jsx(ke,{value:"lab_result",children:"Lab Results"}),c.jsx(ke,{value:"prescription",children:"Prescriptions"}),c.jsx(ke,{value:"scan",children:"Scans"}),c.jsx(ke,{value:"report",children:"Reports"}),c.jsx(ke,{value:"other",children:"Other"})]})]}),he&&c.jsxs(us,{open:A,onOpenChange:D,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{children:[c.jsx(mv,{className:"mr-2 h-4 w-4"}),"Upload File"]})}),c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsx(ms,{children:"Upload Patient File"})}),c.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"File Type"}),c.jsxs(Wn,{value:V,onValueChange:K,children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"lab_result",children:"Lab Result"}),c.jsx(ke,{value:"prescription",children:"Prescription"}),c.jsx(ke,{value:"scan",children:"Scan"}),c.jsx(ke,{value:"report",children:"Report"}),c.jsx(ke,{value:"other",children:"Other"})]})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Category (Optional)"}),c.jsx(at,{placeholder:"e.g., Blood Test, X-Ray, MRI",value:Z,onChange:De=>ee(De.target.value)})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Description (Optional)"}),c.jsx(ii,{placeholder:"Add notes about this file",value:$,onChange:De=>se(De.target.value)})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"File"}),c.jsx(at,{type:"file",onChange:De=>{var Oe;return H(((Oe=De.target.files)==null?void 0:Oe[0])||null)},required:!0})]}),c.jsx(we,{type:"submit",className:"w-full",children:"Upload"})]})]})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs(ze,{children:["Medical Files (",We.length,")"]})}),c.jsx(Te,{children:b?c.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):We.length===0?c.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No files found"}):c.jsx("div",{className:"space-y-3",children:We.map(De=>c.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent",children:[c.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[c.jsx(oa,{className:"h-8 w-8 text-blue-500"}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("p",{className:"font-medium",children:De.fileName}),c.jsx(xt,{variant:"outline",children:De.fileType.replace("_"," ")}),De.category&&c.jsx(xt,{variant:"secondary",children:De.category})]}),De.description&&c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:De.description}),c.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[c.jsxs("span",{children:["Uploaded by: ",De.uploadedBy.name," (",De.uploadedBy.role,")"]}),c.jsxs("span",{children:["Size: ",De.fileSize]}),c.jsx("span",{children:new Date(De.createdAt).toLocaleDateString()})]})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(we,{variant:"outline",size:"sm",children:c.jsx(awe,{className:"h-4 w-4"})}),rt&&c.jsx(we,{variant:"destructive",size:"sm",onClick:()=>Ce(De.id),children:c.jsx(r1,{className:"h-4 w-4"})})]})]},De.id))})})]})]})]})}function jc(r){const s=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&s==="[object Date]"?new r.constructor(+r):typeof r=="number"||s==="[object Number]"||typeof r=="string"||s==="[object String]"?new Date(r):new Date(NaN)}function Np(r,s){return r instanceof Date?new r.constructor(s):new Date(s)}const rne=6048e5,cDe=864e5;let lDe={};function Gw(){return lDe}function Av(r,s){var y,b,C,A;const o=Gw(),d=(s==null?void 0:s.weekStartsOn)??((b=(y=s==null?void 0:s.locale)==null?void 0:y.options)==null?void 0:b.weekStartsOn)??o.weekStartsOn??((A=(C=o.locale)==null?void 0:C.options)==null?void 0:A.weekStartsOn)??0,p=jc(r),f=p.getDay(),E=(f<d?7:0)+f-d;return p.setDate(p.getDate()-E),p.setHours(0,0,0,0),p}function zb(r){return Av(r,{weekStartsOn:1})}function sne(r){const s=jc(r),o=s.getFullYear(),d=Np(r,0);d.setFullYear(o+1,0,4),d.setHours(0,0,0,0);const p=zb(d),f=Np(r,0);f.setFullYear(o,0,4),f.setHours(0,0,0,0);const E=zb(f);return s.getTime()>=p.getTime()?o+1:s.getTime()>=E.getTime()?o:o-1}function BH(r){const s=jc(r);return s.setHours(0,0,0,0),s}function GH(r){const s=jc(r),o=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return o.setUTCFullYear(s.getFullYear()),+r-+o}function dDe(r,s){const o=BH(r),d=BH(s),p=+o-GH(o),f=+d-GH(d);return Math.round((p-f)/cDe)}function uDe(r){const s=sne(r),o=Np(r,0);return o.setFullYear(s,0,4),o.setHours(0,0,0,0),zb(o)}function hDe(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function pDe(r){if(!hDe(r)&&typeof r!="number")return!1;const s=jc(r);return!isNaN(Number(s))}function mDe(r){const s=jc(r),o=Np(r,0);return o.setFullYear(s.getFullYear(),0,1),o.setHours(0,0,0,0),o}const fDe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},gDe=(r,s,o)=>{let d;const p=fDe[r];return typeof p=="string"?d=p:s===1?d=p.one:d=p.other.replace("{{count}}",s.toString()),o!=null&&o.addSuffix?o.comparison&&o.comparison>0?"in "+d:d+" ago":d};function uO(r){return(s={})=>{const o=s.width?String(s.width):r.defaultWidth;return r.formats[o]||r.formats[r.defaultWidth]}}const _De={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},EDe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},vDe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},yDe={date:uO({formats:_De,defaultWidth:"full"}),time:uO({formats:EDe,defaultWidth:"full"}),dateTime:uO({formats:vDe,defaultWidth:"full"})},SDe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},TDe=(r,s,o,d)=>SDe[r];function wE(r){return(s,o)=>{const d=o!=null&&o.context?String(o.context):"standalone";let p;if(d==="formatting"&&r.formattingValues){const E=r.defaultFormattingWidth||r.defaultWidth,y=o!=null&&o.width?String(o.width):E;p=r.formattingValues[y]||r.formattingValues[E]}else{const E=r.defaultWidth,y=o!=null&&o.width?String(o.width):r.defaultWidth;p=r.values[y]||r.values[E]}const f=r.argumentCallback?r.argumentCallback(s):s;return p[f]}}const bDe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},wDe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},CDe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},RDe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},xDe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},NDe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},IDe=(r,s)=>{const o=Number(r),d=o%100;if(d>20||d<10)switch(d%10){case 1:return o+"st";case 2:return o+"nd";case 3:return o+"rd"}return o+"th"},ADe={ordinalNumber:IDe,era:wE({values:bDe,defaultWidth:"wide"}),quarter:wE({values:wDe,defaultWidth:"wide",argumentCallback:r=>r-1}),month:wE({values:CDe,defaultWidth:"wide"}),day:wE({values:RDe,defaultWidth:"wide"}),dayPeriod:wE({values:xDe,defaultWidth:"wide",formattingValues:NDe,defaultFormattingWidth:"wide"})};function CE(r){return(s,o={})=>{const d=o.width,p=d&&r.matchPatterns[d]||r.matchPatterns[r.defaultMatchWidth],f=s.match(p);if(!f)return null;const E=f[0],y=d&&r.parsePatterns[d]||r.parsePatterns[r.defaultParseWidth],b=Array.isArray(y)?PDe(y,D=>D.test(E)):ODe(y,D=>D.test(E));let C;C=r.valueCallback?r.valueCallback(b):b,C=o.valueCallback?o.valueCallback(C):C;const A=s.slice(E.length);return{value:C,rest:A}}}function ODe(r,s){for(const o in r)if(Object.prototype.hasOwnProperty.call(r,o)&&s(r[o]))return o}function PDe(r,s){for(let o=0;o<r.length;o++)if(s(r[o]))return o}function DDe(r){return(s,o={})=>{const d=s.match(r.matchPattern);if(!d)return null;const p=d[0],f=s.match(r.parsePattern);if(!f)return null;let E=r.valueCallback?r.valueCallback(f[0]):f[0];E=o.valueCallback?o.valueCallback(E):E;const y=s.slice(p.length);return{value:E,rest:y}}}const kDe=/^(\d+)(th|st|nd|rd)?/i,LDe=/\d+/i,jDe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},MDe={any:[/^b/i,/^(a|c)/i]},UDe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},VDe={any:[/1/i,/2/i,/3/i,/4/i]},FDe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},BDe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},GDe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},WDe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},HDe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},KDe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},zDe={ordinalNumber:DDe({matchPattern:kDe,parsePattern:LDe,valueCallback:r=>parseInt(r,10)}),era:CE({matchPatterns:jDe,defaultMatchWidth:"wide",parsePatterns:MDe,defaultParseWidth:"any"}),quarter:CE({matchPatterns:UDe,defaultMatchWidth:"wide",parsePatterns:VDe,defaultParseWidth:"any",valueCallback:r=>r+1}),month:CE({matchPatterns:FDe,defaultMatchWidth:"wide",parsePatterns:BDe,defaultParseWidth:"any"}),day:CE({matchPatterns:GDe,defaultMatchWidth:"wide",parsePatterns:WDe,defaultParseWidth:"any"}),dayPeriod:CE({matchPatterns:HDe,defaultMatchWidth:"any",parsePatterns:KDe,defaultParseWidth:"any"})},qDe={code:"en-US",formatDistance:gDe,formatLong:yDe,formatRelative:TDe,localize:ADe,match:zDe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function YDe(r){const s=jc(r);return dDe(s,mDe(s))+1}function XDe(r){const s=jc(r),o=+zb(s)-+uDe(s);return Math.round(o/rne)+1}function ine(r,s){var A,D,k,W;const o=jc(r),d=o.getFullYear(),p=Gw(),f=(s==null?void 0:s.firstWeekContainsDate)??((D=(A=s==null?void 0:s.locale)==null?void 0:A.options)==null?void 0:D.firstWeekContainsDate)??p.firstWeekContainsDate??((W=(k=p.locale)==null?void 0:k.options)==null?void 0:W.firstWeekContainsDate)??1,E=Np(r,0);E.setFullYear(d+1,0,f),E.setHours(0,0,0,0);const y=Av(E,s),b=Np(r,0);b.setFullYear(d,0,f),b.setHours(0,0,0,0);const C=Av(b,s);return o.getTime()>=y.getTime()?d+1:o.getTime()>=C.getTime()?d:d-1}function QDe(r,s){var y,b,C,A;const o=Gw(),d=(s==null?void 0:s.firstWeekContainsDate)??((b=(y=s==null?void 0:s.locale)==null?void 0:y.options)==null?void 0:b.firstWeekContainsDate)??o.firstWeekContainsDate??((A=(C=o.locale)==null?void 0:C.options)==null?void 0:A.firstWeekContainsDate)??1,p=ine(r,s),f=Np(r,0);return f.setFullYear(p,0,d),f.setHours(0,0,0,0),Av(f,s)}function JDe(r,s){const o=jc(r),d=+Av(o,s)-+QDe(o,s);return Math.round(d/rne)+1}function Nr(r,s){const o=r<0?"-":"",d=Math.abs(r).toString().padStart(s,"0");return o+d}const tu={y(r,s){const o=r.getFullYear(),d=o>0?o:1-o;return Nr(s==="yy"?d%100:d,s.length)},M(r,s){const o=r.getMonth();return s==="M"?String(o+1):Nr(o+1,2)},d(r,s){return Nr(r.getDate(),s.length)},a(r,s){const o=r.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return o.toUpperCase();case"aaa":return o;case"aaaaa":return o[0];case"aaaa":default:return o==="am"?"a.m.":"p.m."}},h(r,s){return Nr(r.getHours()%12||12,s.length)},H(r,s){return Nr(r.getHours(),s.length)},m(r,s){return Nr(r.getMinutes(),s.length)},s(r,s){return Nr(r.getSeconds(),s.length)},S(r,s){const o=s.length,d=r.getMilliseconds(),p=Math.trunc(d*Math.pow(10,o-3));return Nr(p,s.length)}},pf={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},WH={G:function(r,s,o){const d=r.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return o.era(d,{width:"abbreviated"});case"GGGGG":return o.era(d,{width:"narrow"});case"GGGG":default:return o.era(d,{width:"wide"})}},y:function(r,s,o){if(s==="yo"){const d=r.getFullYear(),p=d>0?d:1-d;return o.ordinalNumber(p,{unit:"year"})}return tu.y(r,s)},Y:function(r,s,o,d){const p=ine(r,d),f=p>0?p:1-p;if(s==="YY"){const E=f%100;return Nr(E,2)}return s==="Yo"?o.ordinalNumber(f,{unit:"year"}):Nr(f,s.length)},R:function(r,s){const o=sne(r);return Nr(o,s.length)},u:function(r,s){const o=r.getFullYear();return Nr(o,s.length)},Q:function(r,s,o){const d=Math.ceil((r.getMonth()+1)/3);switch(s){case"Q":return String(d);case"QQ":return Nr(d,2);case"Qo":return o.ordinalNumber(d,{unit:"quarter"});case"QQQ":return o.quarter(d,{width:"abbreviated",context:"formatting"});case"QQQQQ":return o.quarter(d,{width:"narrow",context:"formatting"});case"QQQQ":default:return o.quarter(d,{width:"wide",context:"formatting"})}},q:function(r,s,o){const d=Math.ceil((r.getMonth()+1)/3);switch(s){case"q":return String(d);case"qq":return Nr(d,2);case"qo":return o.ordinalNumber(d,{unit:"quarter"});case"qqq":return o.quarter(d,{width:"abbreviated",context:"standalone"});case"qqqqq":return o.quarter(d,{width:"narrow",context:"standalone"});case"qqqq":default:return o.quarter(d,{width:"wide",context:"standalone"})}},M:function(r,s,o){const d=r.getMonth();switch(s){case"M":case"MM":return tu.M(r,s);case"Mo":return o.ordinalNumber(d+1,{unit:"month"});case"MMM":return o.month(d,{width:"abbreviated",context:"formatting"});case"MMMMM":return o.month(d,{width:"narrow",context:"formatting"});case"MMMM":default:return o.month(d,{width:"wide",context:"formatting"})}},L:function(r,s,o){const d=r.getMonth();switch(s){case"L":return String(d+1);case"LL":return Nr(d+1,2);case"Lo":return o.ordinalNumber(d+1,{unit:"month"});case"LLL":return o.month(d,{width:"abbreviated",context:"standalone"});case"LLLLL":return o.month(d,{width:"narrow",context:"standalone"});case"LLLL":default:return o.month(d,{width:"wide",context:"standalone"})}},w:function(r,s,o,d){const p=JDe(r,d);return s==="wo"?o.ordinalNumber(p,{unit:"week"}):Nr(p,s.length)},I:function(r,s,o){const d=XDe(r);return s==="Io"?o.ordinalNumber(d,{unit:"week"}):Nr(d,s.length)},d:function(r,s,o){return s==="do"?o.ordinalNumber(r.getDate(),{unit:"date"}):tu.d(r,s)},D:function(r,s,o){const d=YDe(r);return s==="Do"?o.ordinalNumber(d,{unit:"dayOfYear"}):Nr(d,s.length)},E:function(r,s,o){const d=r.getDay();switch(s){case"E":case"EE":case"EEE":return o.day(d,{width:"abbreviated",context:"formatting"});case"EEEEE":return o.day(d,{width:"narrow",context:"formatting"});case"EEEEEE":return o.day(d,{width:"short",context:"formatting"});case"EEEE":default:return o.day(d,{width:"wide",context:"formatting"})}},e:function(r,s,o,d){const p=r.getDay(),f=(p-d.weekStartsOn+8)%7||7;switch(s){case"e":return String(f);case"ee":return Nr(f,2);case"eo":return o.ordinalNumber(f,{unit:"day"});case"eee":return o.day(p,{width:"abbreviated",context:"formatting"});case"eeeee":return o.day(p,{width:"narrow",context:"formatting"});case"eeeeee":return o.day(p,{width:"short",context:"formatting"});case"eeee":default:return o.day(p,{width:"wide",context:"formatting"})}},c:function(r,s,o,d){const p=r.getDay(),f=(p-d.weekStartsOn+8)%7||7;switch(s){case"c":return String(f);case"cc":return Nr(f,s.length);case"co":return o.ordinalNumber(f,{unit:"day"});case"ccc":return o.day(p,{width:"abbreviated",context:"standalone"});case"ccccc":return o.day(p,{width:"narrow",context:"standalone"});case"cccccc":return o.day(p,{width:"short",context:"standalone"});case"cccc":default:return o.day(p,{width:"wide",context:"standalone"})}},i:function(r,s,o){const d=r.getDay(),p=d===0?7:d;switch(s){case"i":return String(p);case"ii":return Nr(p,s.length);case"io":return o.ordinalNumber(p,{unit:"day"});case"iii":return o.day(d,{width:"abbreviated",context:"formatting"});case"iiiii":return o.day(d,{width:"narrow",context:"formatting"});case"iiiiii":return o.day(d,{width:"short",context:"formatting"});case"iiii":default:return o.day(d,{width:"wide",context:"formatting"})}},a:function(r,s,o){const p=r.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return o.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"aaa":return o.dayPeriod(p,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return o.dayPeriod(p,{width:"narrow",context:"formatting"});case"aaaa":default:return o.dayPeriod(p,{width:"wide",context:"formatting"})}},b:function(r,s,o){const d=r.getHours();let p;switch(d===12?p=pf.noon:d===0?p=pf.midnight:p=d/12>=1?"pm":"am",s){case"b":case"bb":return o.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"bbb":return o.dayPeriod(p,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return o.dayPeriod(p,{width:"narrow",context:"formatting"});case"bbbb":default:return o.dayPeriod(p,{width:"wide",context:"formatting"})}},B:function(r,s,o){const d=r.getHours();let p;switch(d>=17?p=pf.evening:d>=12?p=pf.afternoon:d>=4?p=pf.morning:p=pf.night,s){case"B":case"BB":case"BBB":return o.dayPeriod(p,{width:"abbreviated",context:"formatting"});case"BBBBB":return o.dayPeriod(p,{width:"narrow",context:"formatting"});case"BBBB":default:return o.dayPeriod(p,{width:"wide",context:"formatting"})}},h:function(r,s,o){if(s==="ho"){let d=r.getHours()%12;return d===0&&(d=12),o.ordinalNumber(d,{unit:"hour"})}return tu.h(r,s)},H:function(r,s,o){return s==="Ho"?o.ordinalNumber(r.getHours(),{unit:"hour"}):tu.H(r,s)},K:function(r,s,o){const d=r.getHours()%12;return s==="Ko"?o.ordinalNumber(d,{unit:"hour"}):Nr(d,s.length)},k:function(r,s,o){let d=r.getHours();return d===0&&(d=24),s==="ko"?o.ordinalNumber(d,{unit:"hour"}):Nr(d,s.length)},m:function(r,s,o){return s==="mo"?o.ordinalNumber(r.getMinutes(),{unit:"minute"}):tu.m(r,s)},s:function(r,s,o){return s==="so"?o.ordinalNumber(r.getSeconds(),{unit:"second"}):tu.s(r,s)},S:function(r,s){return tu.S(r,s)},X:function(r,s,o){const d=r.getTimezoneOffset();if(d===0)return"Z";switch(s){case"X":return KH(d);case"XXXX":case"XX":return Kh(d);case"XXXXX":case"XXX":default:return Kh(d,":")}},x:function(r,s,o){const d=r.getTimezoneOffset();switch(s){case"x":return KH(d);case"xxxx":case"xx":return Kh(d);case"xxxxx":case"xxx":default:return Kh(d,":")}},O:function(r,s,o){const d=r.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+HH(d,":");case"OOOO":default:return"GMT"+Kh(d,":")}},z:function(r,s,o){const d=r.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+HH(d,":");case"zzzz":default:return"GMT"+Kh(d,":")}},t:function(r,s,o){const d=Math.trunc(r.getTime()/1e3);return Nr(d,s.length)},T:function(r,s,o){const d=r.getTime();return Nr(d,s.length)}};function HH(r,s=""){const o=r>0?"-":"+",d=Math.abs(r),p=Math.trunc(d/60),f=d%60;return f===0?o+String(p):o+String(p)+s+Nr(f,2)}function KH(r,s){return r%60===0?(r>0?"-":"+")+Nr(Math.abs(r)/60,2):Kh(r,s)}function Kh(r,s=""){const o=r>0?"-":"+",d=Math.abs(r),p=Nr(Math.trunc(d/60),2),f=Nr(d%60,2);return o+p+s+f}const zH=(r,s)=>{switch(r){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},ane=(r,s)=>{switch(r){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},$De=(r,s)=>{const o=r.match(/(P+)(p+)?/)||[],d=o[1],p=o[2];if(!p)return zH(r,s);let f;switch(d){case"P":f=s.dateTime({width:"short"});break;case"PP":f=s.dateTime({width:"medium"});break;case"PPP":f=s.dateTime({width:"long"});break;case"PPPP":default:f=s.dateTime({width:"full"});break}return f.replace("{{date}}",zH(d,s)).replace("{{time}}",ane(p,s))},ZDe={p:ane,P:$De},e1e=/^D+$/,t1e=/^Y+$/,n1e=["D","DD","YY","YYYY"];function r1e(r){return e1e.test(r)}function s1e(r){return t1e.test(r)}function i1e(r,s,o){const d=a1e(r,s,o);if(console.warn(d),n1e.includes(r))throw new RangeError(d)}function a1e(r,s,o){const d=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${s}\`) for formatting ${d} to the input \`${o}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const o1e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,c1e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,l1e=/^'([^]*?)'?$/,d1e=/''/g,u1e=/[a-zA-Z]/;function h1e(r,s,o){var A,D,k,W;const d=Gw(),p=d.locale??qDe,f=d.firstWeekContainsDate??((D=(A=d.locale)==null?void 0:A.options)==null?void 0:D.firstWeekContainsDate)??1,E=d.weekStartsOn??((W=(k=d.locale)==null?void 0:k.options)==null?void 0:W.weekStartsOn)??0,y=jc(r);if(!pDe(y))throw new RangeError("Invalid time value");let b=s.match(c1e).map(G=>{const L=G[0];if(L==="p"||L==="P"){const B=ZDe[L];return B(G,p.formatLong)}return G}).join("").match(o1e).map(G=>{if(G==="''")return{isToken:!1,value:"'"};const L=G[0];if(L==="'")return{isToken:!1,value:p1e(G)};if(WH[L])return{isToken:!0,value:G};if(L.match(u1e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+L+"`");return{isToken:!1,value:G}});p.localize.preprocessor&&(b=p.localize.preprocessor(y,b));const C={firstWeekContainsDate:f,weekStartsOn:E,locale:p};return b.map(G=>{if(!G.isToken)return G.value;const L=G.value;(s1e(L)||r1e(L))&&i1e(L,s,String(r));const B=WH[L[0]];return B(y,L,p.localize,C)}).join("")}function p1e(r){const s=r.match(l1e);return s?s[1].replace(d1e,"'"):r}function m1e(){const{patientId:r}=dw(),[,s]=so(),[o,d]=I.useState("all"),p=B=>s(B),{data:f,isLoading:E}=In({queryKey:["patient-timeline",r,o],queryFn:async()=>{const B=o!=="all"?`&event_type=${o}`:"";return(await Ot("GET",`/api/patient-timeline/${r}?limit=100${B}`)).json()},enabled:!!r}),{data:y}=In({queryKey:["patient-visit-summary",r],queryFn:async()=>(await Ot("GET",`/api/patient-timeline/${r}/summary`)).json(),enabled:!!r}),{data:b}=In({queryKey:["ai-patient-summary",r],queryFn:async()=>(await Ot("GET",`/api/ai-clinical-insights/patient-summary/${r}?doctor_id=dummy`)).json(),enabled:!!r,retry:!1}),C=B=>{switch(B){case"appointment":return c.jsx(pd,{className:"h-5 w-5"});case"lab_result":return c.jsx(K8,{className:"h-5 w-5"});case"doctor_note":return c.jsx(H8,{className:"h-5 w-5"});case"file_upload":return c.jsx(mv,{className:"h-5 w-5"});case"prescription":return c.jsx(pv,{className:"h-5 w-5"});case"billing":return c.jsx(oa,{className:"h-5 w-5"});case"payment":return c.jsx(Uf,{className:"h-5 w-5"});default:return c.jsx(Tl,{className:"h-5 w-5"})}},A=B=>{switch(B){case"appointment":return"bg-blue-100 text-blue-800 border-blue-200";case"lab_result":return"bg-purple-100 text-purple-800 border-purple-200";case"doctor_note":return"bg-green-100 text-green-800 border-green-200";case"file_upload":return"bg-orange-100 text-orange-800 border-orange-200";case"prescription":return"bg-pink-100 text-pink-800 border-pink-200";case"billing":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"payment":return"bg-emerald-100 text-emerald-800 border-emerald-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},D=B=>{const H={completed:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",cancelled:"bg-red-100 text-red-800",scheduled:"bg-blue-100 text-blue-800",dispensed:"bg-green-100 text-green-800",paid:"bg-green-100 text-green-800",partial:"bg-yellow-100 text-yellow-800",unpaid:"bg-red-100 text-red-800"};return c.jsx(xt,{className:H[B==null?void 0:B.toLowerCase()]||"bg-gray-100 text-gray-800",children:B})};if(E)return c.jsx("div",{className:"flex items-center justify-center h-96",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),c.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading patient timeline..."})]})});const k=f==null?void 0:f.patient,W=(f==null?void 0:f.timeline)||[],G=(f==null?void 0:f.event_counts)||{},L=y;return c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx(we,{variant:"outline",size:"icon",onClick:()=>p(-1),children:c.jsx(xg,{className:"h-4 w-4"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Patient Timeline"}),k&&c.jsxs("p",{className:"text-muted-foreground",children:[k.name," (MRN: ",k.mrn,") - ",k.age," years, ",k.gender]})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(cwe,{className:"h-4 w-4 text-muted-foreground"}),c.jsxs(Wn,{value:o,onValueChange:d,children:[c.jsx(jn,{className:"w-[180px]",children:c.jsx(Hn,{placeholder:"Filter events"})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"all",children:"All Events"}),c.jsx(ke,{value:"appointment",children:"Appointments"}),c.jsx(ke,{value:"lab_result",children:"Lab Results"}),c.jsx(ke,{value:"doctor_note",children:"Doctor Notes"}),c.jsx(ke,{value:"prescription",children:"Prescriptions"}),c.jsx(ke,{value:"file_upload",children:"File Uploads"}),c.jsx(ke,{value:"billing",children:"Billing"}),c.jsx(ke,{value:"payment",children:"Payments"})]})]})]})]}),L&&c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Total Visits"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-2xl font-bold",children:L.visit_statistics.completed_appointments}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:["of ",L.visit_statistics.total_appointments," appointments"]})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Lab Tests"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-2xl font-bold",children:L.visit_statistics.total_lab_tests}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total tests conducted"})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Prescriptions"})}),c.jsxs(Te,{children:[c.jsx("div",{className:"text-2xl font-bold",children:L.visit_statistics.total_prescriptions}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Medications prescribed"})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{className:"pb-3",children:c.jsx(ze,{className:"text-sm font-medium",children:"Outstanding Balance"})}),c.jsxs(Te,{children:[c.jsxs("div",{className:"text-2xl font-bold",children:["",L.billing_summary.outstanding_balance.toLocaleString()]}),c.jsxs("p",{className:"text-xs text-muted-foreground",children:["of ",L.billing_summary.total_billed.toLocaleString()," billed"]})]})]})]}),(b==null?void 0:b.summary)&&c.jsxs(_e,{className:"border-purple-200 bg-purple-50/50",children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(yu,{className:"h-5 w-5 text-purple-600"}),c.jsx(ze,{className:"text-purple-900",children:"AI-Powered Patient Summary"}),c.jsx(KE,{className:"h-4 w-4 text-purple-600"})]})}),c.jsxs(Te,{children:[c.jsx("div",{className:"prose prose-sm max-w-none",children:c.jsx("div",{className:"whitespace-pre-wrap text-sm text-gray-700",children:b.summary})}),c.jsxs("div",{className:"mt-4 flex gap-4 text-xs text-muted-foreground",children:[c.jsxs("span",{children:[" ",b.notes_count," clinical notes analyzed"]}),c.jsxs("span",{children:[" ",b.lab_results_count," lab results reviewed"]})]})]})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Event Summary"})}),c.jsx(Te,{children:c.jsxs("div",{className:"flex flex-wrap gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(pd,{className:"h-4 w-4 text-blue-600"}),c.jsxs("span",{className:"text-sm",children:["Appointments: ",c.jsx("strong",{children:G.appointments})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(K8,{className:"h-4 w-4 text-purple-600"}),c.jsxs("span",{className:"text-sm",children:["Lab Results: ",c.jsx("strong",{children:G.lab_results})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(H8,{className:"h-4 w-4 text-green-600"}),c.jsxs("span",{className:"text-sm",children:["Doctor Notes: ",c.jsx("strong",{children:G.doctor_notes})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(pv,{className:"h-4 w-4 text-pink-600"}),c.jsxs("span",{className:"text-sm",children:["Prescriptions: ",c.jsx("strong",{children:G.prescriptions})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(mv,{className:"h-4 w-4 text-orange-600"}),c.jsxs("span",{className:"text-sm",children:["Files: ",c.jsx("strong",{children:G.file_uploads})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(tQ,{className:"h-4 w-4 text-emerald-600"}),c.jsxs("span",{className:"text-sm",children:["Payments: ",c.jsx("strong",{children:G.payments})]})]})]})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs(ze,{children:["Timeline (",W.length," events)"]})}),c.jsx(Te,{children:W.length===0?c.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[c.jsx(Tl,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),c.jsx("p",{children:"No events found for this patient"})]}):c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-border"}),c.jsx("div",{className:"space-y-6",children:W.map((B,H)=>c.jsxs("div",{className:"relative flex gap-4",children:[c.jsx("div",{className:`relative z-10 flex items-center justify-center w-16 h-16 rounded-full border-4 border-background ${A(B.type)}`,children:C(B.type)}),c.jsx("div",{className:"flex-1 pb-6",children:c.jsxs("div",{className:"bg-card border rounded-lg p-4 shadow-sm",children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold",children:B.title}),c.jsx("p",{className:"text-sm text-muted-foreground",children:h1e(new Date(B.date),"PPP 'at' p")})]}),B.status&&D(B.status)]}),c.jsx("p",{className:"text-sm mt-2",children:B.description}),B.metadata&&c.jsxs("div",{className:"mt-3 pt-3 border-t text-xs text-muted-foreground space-y-1",children:[B.type==="prescription"&&B.metadata.instructions&&c.jsxs("p",{children:[c.jsx("strong",{children:"Instructions:"})," ",B.metadata.instructions]}),B.type==="lab_result"&&B.metadata.reference_range&&c.jsxs("p",{children:[c.jsx("strong",{children:"Reference Range:"})," ",B.metadata.reference_range]}),B.type==="payment"&&c.jsxs("p",{children:[c.jsx("strong",{children:"Reference:"})," ",B.metadata.reference_number]})]})]})})]},`${B.type}-${B.id}-${H}`))})]})})]})]})}function f1e(){const{user:r}=ts(),{toast:s}=jr(),[o,d]=I.useState([]),[p,f]=I.useState(!1),[E,y]=I.useState(""),[b,C]=I.useState("pending"),[A,D]=I.useState(!1),[k,W]=I.useState(null),[G,L]=I.useState("");I.useEffect(()=>{B()},[b]);const B=async()=>{f(!0);try{const le=await(await fetch("http://localhost:5000/api/prescriptions/pending",{headers:{"user-id":(r==null?void 0:r.id)||""}})).json();d(le.prescriptions||[])}catch{s({title:"Error",description:"Failed to fetch prescriptions",variant:"destructive"})}finally{f(!1)}},H=async()=>{if(k)try{if((await fetch(`http://localhost:5000/api/prescriptions/${k.id}/dispense`,{method:"POST",headers:{"Content-Type":"application/json","user-id":(r==null?void 0:r.id)||""},body:JSON.stringify({notes:G})})).ok)s({title:"Success",description:"Prescription dispensed successfully"}),D(!1),L(""),W(null),B();else throw new Error("Failed to dispense")}catch{s({title:"Error",description:"Failed to dispense prescription",variant:"destructive"})}},V=$=>{W($),D(!0)},K=o.filter($=>$.patient.name.toLowerCase().includes(E.toLowerCase())||$.patient.mrn.toLowerCase().includes(E.toLowerCase())||$.medicationName.toLowerCase().includes(E.toLowerCase())),Z=K.filter($=>$.status==="pending"),ee=K.filter($=>$.status==="dispensed");return c.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Prescription Management"}),c.jsxs("div",{className:"flex gap-4",children:[c.jsxs(xt,{variant:"outline",className:"text-lg px-4 py-2",children:[c.jsx(md,{className:"mr-2 h-4 w-4"}),"Pending: ",Z.length]}),c.jsxs(xt,{variant:"outline",className:"text-lg px-4 py-2",children:[c.jsx(Na,{className:"mr-2 h-4 w-4"}),"Dispensed: ",ee.length]})]})]}),c.jsxs("div",{className:"relative",children:[c.jsx(Uo,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),c.jsx(at,{placeholder:"Search by patient name, MRN, or medication...",value:E,onChange:$=>y($.target.value),className:"pl-10"})]}),c.jsxs(Al,{value:b,onValueChange:C,children:[c.jsxs(Lc,{className:"grid w-full grid-cols-2",children:[c.jsxs(kn,{value:"pending",children:["Pending (",Z.length,")"]}),c.jsxs(kn,{value:"dispensed",children:["Dispensed (",ee.length,")"]})]}),c.jsx(Ln,{value:"pending",className:"space-y-4",children:p?c.jsx(_e,{children:c.jsx(Te,{className:"py-8",children:c.jsx("p",{className:"text-center text-muted-foreground",children:"Loading..."})})}):Z.length===0?c.jsx(_e,{children:c.jsx(Te,{className:"py-8",children:c.jsx("p",{className:"text-center text-muted-foreground",children:"No pending prescriptions"})})}):Z.map($=>c.jsxs(_e,{className:"hover:shadow-md transition-shadow",children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex justify-between items-start",children:[c.jsxs("div",{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(pv,{className:"h-5 w-5"}),$.medicationName]}),c.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Patient: ",$.patient.name," (MRN: ",$.patient.mrn,")"]})]}),c.jsx(xt,{variant:"secondary",children:$.status})]})}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Dosage"}),c.jsx("p",{className:"font-medium",children:$.dosage})]}),c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Frequency"}),c.jsx("p",{className:"font-medium",children:$.frequency})]}),c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Duration"}),c.jsx("p",{className:"font-medium",children:$.duration})]}),c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Prescribed By"}),c.jsx("p",{className:"font-medium",children:$.doctor.name})]})]}),$.instructions&&c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Instructions"}),c.jsx("p",{className:"text-sm mt-1",children:$.instructions})]}),c.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[c.jsxs("p",{className:"text-xs text-muted-foreground",children:["Created: ",new Date($.createdAt).toLocaleString()]}),c.jsxs(we,{onClick:()=>V($),children:[c.jsx(Na,{className:"mr-2 h-4 w-4"}),"Dispense"]})]})]})]},$.id))}),c.jsx(Ln,{value:"dispensed",className:"space-y-4",children:p?c.jsx(_e,{children:c.jsx(Te,{className:"py-8",children:c.jsx("p",{className:"text-center text-muted-foreground",children:"Loading..."})})}):ee.length===0?c.jsx(_e,{children:c.jsx(Te,{className:"py-8",children:c.jsx("p",{className:"text-center text-muted-foreground",children:"No dispensed prescriptions"})})}):ee.map($=>c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex justify-between items-start",children:[c.jsxs("div",{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(pv,{className:"h-5 w-5"}),$.medicationName]}),c.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Patient: ",$.patient.name," (MRN: ",$.patient.mrn,")"]})]}),c.jsxs(xt,{variant:"default",className:"bg-green-500",children:[c.jsx(Na,{className:"mr-1 h-3 w-3"}),$.status]})]})}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Dosage"}),c.jsx("p",{className:"font-medium",children:$.dosage})]}),c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Frequency"}),c.jsx("p",{className:"font-medium",children:$.frequency})]}),c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Duration"}),c.jsx("p",{className:"font-medium",children:$.duration})]}),c.jsxs("div",{children:[c.jsx(tt,{className:"text-muted-foreground",children:"Prescribed By"}),c.jsx("p",{className:"font-medium",children:$.doctor.name})]})]}),$.dispensedBy&&c.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[c.jsx(tt,{className:"text-muted-foreground",children:"Dispensed By"}),c.jsx("p",{className:"font-medium",children:$.dispensedBy.name}),$.dispensedAt&&c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date($.dispensedAt).toLocaleString()}),$.notes&&c.jsx("p",{className:"text-sm mt-2",children:$.notes})]})]})]},$.id))})]}),c.jsx(us,{open:A,onOpenChange:D,children:c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsx(ms,{children:"Dispense Prescription"})}),k&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-accent p-4 rounded-lg space-y-2",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Patient:"})," ",k.patient.name]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Medication:"})," ",k.medicationName]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Dosage:"})," ",k.dosage]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Frequency:"})," ",k.frequency]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Duration:"})," ",k.duration]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Notes (Optional)"}),c.jsx(ii,{placeholder:"Add any notes about dispensing this prescription...",value:G,onChange:$=>L($.target.value),rows:3})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(we,{onClick:H,className:"flex-1",children:[c.jsx(Na,{className:"mr-2 h-4 w-4"}),"Confirm Dispense"]}),c.jsx(we,{variant:"outline",onClick:()=>D(!1),className:"flex-1",children:"Cancel"})]})]})]})})]})}const g1e=kp("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),YT=I.forwardRef(({className:r,variant:s,...o},d)=>c.jsx("div",{ref:d,role:"alert",className:ct(g1e({variant:s}),r),...o}));YT.displayName="Alert";const _1e=I.forwardRef(({className:r,...s},o)=>c.jsx("h5",{ref:o,className:ct("mb-1 font-medium leading-none tracking-tight",r),...s}));_1e.displayName="AlertTitle";const XT=I.forwardRef(({className:r,...s},o)=>c.jsx("div",{ref:o,className:ct("text-sm [&_p]:leading-relaxed",r),...s}));XT.displayName="AlertDescription";function E1e(){const{user:r}=ts(),{toast:s}=jr(),[o,d]=I.useState(null),[p,f]=I.useState([]),[E,y]=I.useState([]),[b,C]=I.useState(!0),[A,D]=I.useState(!1),[k,W]=I.useState(""),[G,L]=I.useState(""),[B,H]=I.useState("bank_transfer"),V="5f98058e-9bd6-4c92-9f8f-13b58b4c36f9";I.useEffect(()=>{K()},[]);const K=async()=>{C(!0);try{await Promise.all([Z(),ee(),$()])}finally{C(!1)}},Z=async()=>{try{const oe=await(await fetch(`http://localhost:5000/api/subscriptions/hospital/${V}`,{headers:{"user-id":(r==null?void 0:r.id)||""}})).json();d(oe.subscription)}catch(X){console.error("Failed to fetch subscription:",X)}},ee=async()=>{try{const oe=await(await fetch("http://localhost:5000/api/subscriptions/pricing")).json();f(oe.pricing||[])}catch(X){console.error("Failed to fetch pricing:",X)}},$=async()=>{try{const oe=await(await fetch(`http://localhost:5000/api/subscriptions/payment-history/${V}?user_id=${r==null?void 0:r.id}`,{headers:{"user-id":(r==null?void 0:r.id)||""}})).json();y(oe.payments||[])}catch(X){console.error("Failed to fetch payment history:",X)}},se=async()=>{if(!k||!G){s({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}try{if((await fetch("http://localhost:5000/api/subscriptions/subscribe",{method:"POST",headers:{"Content-Type":"application/json","user-id":(r==null?void 0:r.id)||""},body:JSON.stringify({hospital_id:V,plan_type:k,payment_reference:G,payment_method:B})})).ok)s({title:"Success",description:"Subscription activated successfully!"}),D(!1),L(""),K();else throw new Error("Subscription failed")}catch{s({title:"Error",description:"Failed to activate subscription",variant:"destructive"})}},le=X=>{const oe={trial:{variant:"secondary",icon:md,text:"Trial Period"},active:{variant:"default",icon:Na,text:"Active",className:"bg-green-500"},expired:{variant:"destructive",icon:id,text:"Expired"}},je=oe[X]||oe.trial,Ce=je.icon;return c.jsxs(xt,{variant:je.variant,className:je.className,children:[c.jsx(Ce,{className:"mr-1 h-3 w-3"}),je.text]})};return b?c.jsx("div",{className:"container mx-auto p-6",children:c.jsx("p",{className:"text-center py-8",children:"Loading subscription details..."})}):c.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[c.jsx("div",{className:"flex justify-between items-center",children:c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Subscription Management"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your hospital's subscription plan"})]})}),o&&c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs("div",{className:"flex justify-between items-start",children:[c.jsxs("div",{children:[c.jsx(ze,{children:"Current Subscription"}),c.jsx(Cn,{children:"Your subscription status and details"})]}),le(o.status)]})}),c.jsxs(Te,{className:"space-y-4",children:[o.needsRenewal&&c.jsxs(YT,{variant:"destructive",children:[c.jsx(id,{className:"h-4 w-4"}),c.jsxs(XT,{children:["Your subscription expires in ",o.daysRemaining," days. Please renew to avoid service interruption."]})]}),o.isExpired&&c.jsxs(YT,{variant:"destructive",children:[c.jsx(id,{className:"h-4 w-4"}),c.jsx(XT,{children:"Your subscription has expired. Please subscribe to continue using the service."})]}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{className:"p-4 border rounded-lg",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Plan Type"}),c.jsx("p",{className:"text-lg font-semibold capitalize",children:o.planType})]}),c.jsxs("div",{className:"p-4 border rounded-lg",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Days Remaining"}),c.jsx("p",{className:"text-lg font-semibold",children:o.daysRemaining})]}),o.subscriptionEndDate&&c.jsxs("div",{className:"p-4 border rounded-lg",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Expires On"}),c.jsx("p",{className:"text-lg font-semibold",children:new Date(o.subscriptionEndDate).toLocaleDateString()})]}),o.trialEndDate&&o.status==="trial"&&c.jsxs("div",{className:"p-4 border rounded-lg",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Trial Ends"}),c.jsx("p",{className:"text-lg font-semibold",children:new Date(o.trialEndDate).toLocaleDateString()})]}),o.amountPaid&&c.jsxs("div",{className:"p-4 border rounded-lg",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Payment"}),c.jsxs("p",{className:"text-lg font-semibold",children:["",o.amountPaid.toLocaleString()]})]})]})]})]}),c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Available Plans"}),c.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:p.map(X=>c.jsxs(_e,{className:"relative",children:[c.jsxs(Ke,{children:[c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(Gv,{className:"h-5 w-5"}),X.planType==="monthly"?"Monthly Plan":"Yearly Plan"]}),c.jsx(Cn,{children:X.description})]}),c.jsxs(Te,{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-4xl font-bold",children:X.formattedPrice}),c.jsxs("p",{className:"text-muted-foreground",children:["per ",X.planType==="monthly"?"month":"year"]})]}),X.planType==="yearly"&&c.jsx(xt,{variant:"secondary",className:"bg-green-100 text-green-800",children:"Save 400,000 annually"}),c.jsxs("ul",{className:"space-y-2 text-sm",children:[c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx(Na,{className:"h-4 w-4 text-green-500"}),"Unlimited users"]}),c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx(Na,{className:"h-4 w-4 text-green-500"}),"AI Clinical Assistant"]}),c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx(Na,{className:"h-4 w-4 text-green-500"}),"Health Chatbot"]}),c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx(Na,{className:"h-4 w-4 text-green-500"}),"Complete medical records"]}),c.jsxs("li",{className:"flex items-center gap-2",children:[c.jsx(Na,{className:"h-4 w-4 text-green-500"}),"24/7 Support"]})]}),c.jsxs(us,{open:A&&k===X.planType,onOpenChange:oe=>{D(oe),oe&&W(X.planType)},children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{className:"w-full",onClick:()=>W(X.planType),children:[c.jsx(Uf,{className:"mr-2 h-4 w-4"}),"Subscribe Now"]})}),c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsxs(ms,{children:["Subscribe to ",X.planType==="monthly"?"Monthly":"Yearly"," Plan"]})}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"p-4 bg-accent rounded-lg",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount to Pay"}),c.jsx("p",{className:"text-2xl font-bold",children:X.formattedPrice})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Payment Method"}),c.jsxs("select",{className:"w-full p-2 border rounded-md",value:B,onChange:oe=>H(oe.target.value),children:[c.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),c.jsx("option",{value:"card",children:"Card Payment"}),c.jsx("option",{value:"ussd",children:"USSD"})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Payment Reference / Transaction ID"}),c.jsx(at,{placeholder:"Enter payment reference",value:G,onChange:oe=>L(oe.target.value),required:!0}),c.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter the transaction reference from your payment"})]}),c.jsx(YT,{children:c.jsx(XT,{children:"Please make payment to our bank account and enter the transaction reference above."})}),c.jsx(we,{onClick:se,className:"w-full",children:"Confirm Subscription"})]})]})]})]})]},X.planType))})]}),E.length>0&&c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(pd,{className:"h-5 w-5"}),"Payment History"]})}),c.jsx(Te,{children:c.jsx("div",{className:"space-y-3",children:E.map(X=>c.jsxs("div",{className:"flex justify-between items-center p-4 border rounded-lg",children:[c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:X.formattedAmount}),c.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(X.paymentDate).toLocaleDateString(),"  ",X.paymentMethod]}),X.paymentReference&&c.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ref: ",X.paymentReference]})]}),c.jsx(xt,{variant:X.status==="completed"?"default":"secondary",className:X.status==="completed"?"bg-green-500":"",children:X.status})]},X.id))})})]})]})}function v1e(){const{user:r}=ts(),{toast:s}=jr(),[o,d]=I.useState([]),[p,f]=I.useState([]),[E,y]=I.useState(!0),[b,C]=I.useState(""),[A,D]=I.useState(!1),[k,W]=I.useState(""),[G,L]=I.useState(""),[B,H]=I.useState("");I.useEffect(()=>{V()},[]);const V=async()=>{y(!0);try{await Promise.all([K(),Z()])}finally{y(!1)}},K=async()=>{try{const rt=await(await fetch(`http://localhost:5000/api/subscriptions/all?admin_id=${r==null?void 0:r.id}`,{headers:{"user-id":(r==null?void 0:r.id)||""}})).json();d(rt.subscriptions||[])}catch{s({title:"Error",description:"Failed to fetch subscriptions",variant:"destructive"})}},Z=async()=>{try{const rt=await(await fetch("http://localhost:5000/api/subscriptions/pricing")).json();f(rt.pricing||[])}catch(he){console.error("Failed to fetch pricing:",he)}},ee=async()=>{if(!k||!G){s({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}try{if((await fetch(`http://localhost:5000/api/subscriptions/pricing/${k}?admin_id=${r==null?void 0:r.id}`,{method:"PUT",headers:{"Content-Type":"application/json","user-id":(r==null?void 0:r.id)||""},body:JSON.stringify({plan_type:k,price:parseFloat(G),description:B})})).ok)s({title:"Success",description:"Pricing updated successfully"}),D(!1),W(""),L(""),H(""),Z();else throw new Error("Update failed")}catch{s({title:"Error",description:"Failed to update pricing",variant:"destructive"})}},$=he=>{W(he.planType),L(he.price.toString()),H(he.description),D(!0)},se=he=>{const rt={trial:{variant:"secondary",icon:md,text:"Trial",className:""},active:{variant:"default",icon:Na,text:"Active",className:"bg-green-500"},expired:{variant:"destructive",icon:id,text:"Expired",className:""}},De=rt[he]||rt.trial,Oe=De.icon;return c.jsxs(xt,{variant:De.variant,className:De.className,children:[c.jsx(Oe,{className:"mr-1 h-3 w-3"}),De.text]})},le=o.filter(he=>{var rt,De;return((De=(rt=he.hospital)==null?void 0:rt.name)==null?void 0:De.toLowerCase().includes(b.toLowerCase()))||!1}),X=le.filter(he=>he.subscription.status==="active"),oe=le.filter(he=>he.subscription.status==="trial"),je=le.filter(he=>he.subscription.status==="expired"),Ce=le.filter(he=>he.needsRenewal),We=o.reduce((he,rt)=>he+(rt.subscription.amountPaid||0),0);return c.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Subscription Management"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor and manage all hospital subscriptions"})]}),c.jsxs(us,{open:A,onOpenChange:D,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{children:[c.jsx(rQ,{className:"mr-2 h-4 w-4"}),"Manage Pricing"]})}),c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsx(ms,{children:"Update Subscription Pricing"})}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Plan Type"}),c.jsxs("select",{className:"w-full p-2 border rounded-md",value:k,onChange:he=>{const rt=p.find(De=>De.planType===he.target.value);rt&&$(rt)},children:[c.jsx("option",{value:"",children:"Select a plan"}),p.map(he=>c.jsx("option",{value:he.planType,children:he.planType==="monthly"?"Monthly Plan":"Yearly Plan"},he.planType))]})]}),k&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Price ()"}),c.jsx(at,{type:"number",placeholder:"Enter price",value:G,onChange:he=>L(he.target.value)})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Description"}),c.jsx(at,{placeholder:"Enter description",value:B,onChange:he=>H(he.target.value)})]}),c.jsx(we,{onClick:ee,className:"w-full",children:"Update Pricing"})]})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-2xl font-bold",children:o.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Hospitals"})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-2xl font-bold text-green-600",children:X.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Active"})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-2xl font-bold text-blue-600",children:oe.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"On Trial"})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-2xl font-bold text-red-600",children:je.length}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Expired"})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"text-center",children:[c.jsxs("p",{className:"text-2xl font-bold",children:["",We.toLocaleString()]}),c.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Revenue"})]})})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsxs(ze,{className:"flex items-center gap-2",children:[c.jsx(ZD,{className:"h-5 w-5"}),"Current Pricing"]})}),c.jsx(Te,{children:c.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:p.map(he=>c.jsxs("div",{className:"p-4 border rounded-lg flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsxs("p",{className:"font-semibold capitalize",children:[he.planType," Plan"]}),c.jsx("p",{className:"text-2xl font-bold text-green-600",children:he.formattedPrice}),c.jsx("p",{className:"text-sm text-muted-foreground",children:he.description})]}),c.jsx(we,{variant:"outline",size:"sm",onClick:()=>$(he),children:"Edit"})]},he.planType))})})]}),c.jsxs("div",{className:"relative",children:[c.jsx(Uo,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),c.jsx(at,{placeholder:"Search hospitals...",value:b,onChange:he=>C(he.target.value),className:"pl-10"})]}),c.jsxs(Al,{defaultValue:"all",children:[c.jsxs(Lc,{className:"grid w-full grid-cols-5",children:[c.jsxs(kn,{value:"all",children:["All (",le.length,")"]}),c.jsxs(kn,{value:"active",children:["Active (",X.length,")"]}),c.jsxs(kn,{value:"trial",children:["Trial (",oe.length,")"]}),c.jsxs(kn,{value:"expired",children:["Expired (",je.length,")"]}),c.jsxs(kn,{value:"renewal",children:["Needs Renewal (",Ce.length,")"]})]}),c.jsx(Ln,{value:"all",className:"space-y-4",children:E?c.jsx("p",{className:"text-center py-8",children:"Loading..."}):le.length===0?c.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"}):le.map(he=>c.jsx(RE,{item:he,getStatusBadge:se},he.subscription.id))}),c.jsx(Ln,{value:"active",className:"space-y-4",children:X.map(he=>c.jsx(RE,{item:he,getStatusBadge:se},he.subscription.id))}),c.jsx(Ln,{value:"trial",className:"space-y-4",children:oe.map(he=>c.jsx(RE,{item:he,getStatusBadge:se},he.subscription.id))}),c.jsx(Ln,{value:"expired",className:"space-y-4",children:je.map(he=>c.jsx(RE,{item:he,getStatusBadge:se},he.subscription.id))}),c.jsx(Ln,{value:"renewal",className:"space-y-4",children:Ce.map(he=>c.jsx(RE,{item:he,getStatusBadge:se},he.subscription.id))})]})]})}function RE({item:r,getStatusBadge:s}){var o,d;return c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsx("div",{className:"flex justify-between items-start",children:c.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[c.jsx(ml,{className:"h-10 w-10 text-blue-500"}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx("h3",{className:"font-semibold text-lg",children:((o=r.hospital)==null?void 0:o.name)||"Unknown Hospital"}),s(r.subscription.status)]}),((d=r.hospital)==null?void 0:d.address)&&c.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:r.hospital.address}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Plan"}),c.jsx("p",{className:"font-medium capitalize",children:r.subscription.planType})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Days Remaining"}),c.jsx("p",{className:"font-medium",children:r.daysRemaining})]}),r.subscription.subscriptionEndDate&&c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Expires"}),c.jsx("p",{className:"font-medium",children:new Date(r.subscription.subscriptionEndDate).toLocaleDateString()})]}),r.subscription.amountPaid&&c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-muted-foreground",children:"Last Payment"}),c.jsxs("p",{className:"font-medium text-green-600",children:["",r.subscription.amountPaid.toLocaleString()]})]})]}),r.needsRenewal&&c.jsx("div",{className:"mt-3",children:c.jsxs(xt,{variant:"destructive",children:[c.jsx(id,{className:"mr-1 h-3 w-3"}),"Renewal Required"]})})]})]})})})})}function y1e(){const{user:r}=ts(),{toast:s}=jr(),[o,d]=I.useState([]),[p,f]=I.useState(null),[E,y]=I.useState(!1),[b,C]=I.useState(""),[A,D]=I.useState("all"),[k,W]=I.useState(!1);I.useState(!1);const[G,L]=I.useState(!1),[B,H]=I.useState(null),V="5f98058e-9bd6-4c92-9f8f-13b58b4c36f9",[K,Z]=I.useState({medicationName:"",genericName:"",category:"antibiotic",dosageForm:"tablet",strength:"",quantityInStock:0,reorderLevel:10,unitPrice:0,supplier:"",batchNumber:"",expiryDate:"",location:"",notes:""}),[ee,$]=I.useState({quantity:0,transactionType:"restock",notes:""});I.useEffect(()=>{se()},[A]);const se=async()=>{y(!0);try{await Promise.all([le(),X()])}finally{y(!1)}},le=async()=>{try{const xe=new URLSearchParams({hospital_id:V});A!=="all"&&xe.append("category",A);const rn=await(await fetch(`http://localhost:5000/api/pharmacy-inventory?${xe}`)).json();d(rn.inventory||[])}catch(xe){console.error("Failed to fetch inventory:",xe)}},X=async()=>{try{const Pt=await(await fetch(`http://localhost:5000/api/pharmacy-inventory/stats/summary?hospital_id=${V}`)).json();f(Pt)}catch(xe){console.error("Failed to fetch stats:",xe)}},oe=async xe=>{xe.preventDefault();try{(await fetch(`http://localhost:5000/api/pharmacy-inventory?hospital_id=${V}&user_id=${r==null?void 0:r.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)})).ok&&(s({title:"Success",description:"Item added to inventory"}),W(!1),Ce(),se())}catch{s({title:"Error",description:"Failed to add item",variant:"destructive"})}},je=async()=>{if(B)try{(await fetch(`http://localhost:5000/api/pharmacy-inventory/${B.id}/adjust-stock?user_id=${r==null?void 0:r.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee)})).ok&&(s({title:"Success",description:"Stock adjusted successfully"}),L(!1),$({quantity:0,transactionType:"restock",notes:""}),se())}catch{s({title:"Error",description:"Failed to adjust stock",variant:"destructive"})}},Ce=()=>{Z({medicationName:"",genericName:"",category:"antibiotic",dosageForm:"tablet",strength:"",quantityInStock:0,reorderLevel:10,unitPrice:0,supplier:"",batchNumber:"",expiryDate:"",location:"",notes:""})},We=xe=>{H(xe),L(!0)},he=o.filter(xe=>{var Pt;return xe.medicationName.toLowerCase().includes(b.toLowerCase())||((Pt=xe.genericName)==null?void 0:Pt.toLowerCase().includes(b.toLowerCase()))}),rt=he.filter(xe=>xe.isLowStock),De=he.filter(xe=>xe.isExpired),Oe=he.filter(xe=>xe.isExpiringSoon),Re=["antibiotic","painkiller","antiviral","antifungal","antihistamine","antacid","vitamin","supplement","injection","other"],et=["tablet","capsule","syrup","injection","cream","drops","inhaler"];return c.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Pharmacy Inventory"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage medication stock and supplies"})]}),c.jsxs(us,{open:k,onOpenChange:W,children:[c.jsx(Wi,{asChild:!0,children:c.jsxs(we,{children:[c.jsx(wl,{className:"mr-2 h-4 w-4"}),"Add Medication"]})}),c.jsxs(hs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[c.jsx(ps,{children:c.jsx(ms,{children:"Add New Medication"})}),c.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx(tt,{children:"Medication Name *"}),c.jsx(at,{value:K.medicationName,onChange:xe=>Z({...K,medicationName:xe.target.value}),required:!0})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Generic Name"}),c.jsx(at,{value:K.genericName,onChange:xe=>Z({...K,genericName:xe.target.value})})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Category *"}),c.jsxs(Wn,{value:K.category,onValueChange:xe=>Z({...K,category:xe}),children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsx(Mn,{children:Re.map(xe=>c.jsx(ke,{value:xe,children:xe},xe))})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Dosage Form *"}),c.jsxs(Wn,{value:K.dosageForm,onValueChange:xe=>Z({...K,dosageForm:xe}),children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsx(Mn,{children:et.map(xe=>c.jsx(ke,{value:xe,children:xe},xe))})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Strength *"}),c.jsx(at,{placeholder:"e.g., 500mg, 10ml",value:K.strength,onChange:xe=>Z({...K,strength:xe.target.value}),required:!0})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Initial Quantity *"}),c.jsx(at,{type:"number",value:K.quantityInStock,onChange:xe=>Z({...K,quantityInStock:parseInt(xe.target.value)}),required:!0})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Reorder Level *"}),c.jsx(at,{type:"number",value:K.reorderLevel,onChange:xe=>Z({...K,reorderLevel:parseInt(xe.target.value)}),required:!0})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Unit Price () *"}),c.jsx(at,{type:"number",step:"0.01",value:K.unitPrice,onChange:xe=>Z({...K,unitPrice:parseFloat(xe.target.value)}),required:!0})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Supplier"}),c.jsx(at,{value:K.supplier,onChange:xe=>Z({...K,supplier:xe.target.value})})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Batch Number"}),c.jsx(at,{value:K.batchNumber,onChange:xe=>Z({...K,batchNumber:xe.target.value})})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Expiry Date"}),c.jsx(at,{type:"date",value:K.expiryDate,onChange:xe=>Z({...K,expiryDate:xe.target.value})})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Location"}),c.jsx(at,{placeholder:"Shelf/Cabinet",value:K.location,onChange:xe=>Z({...K,location:xe.target.value})})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Notes"}),c.jsx(ii,{value:K.notes,onChange:xe=>Z({...K,notes:xe.target.value}),rows:2})]}),c.jsx(we,{type:"submit",className:"w-full",children:"Add to Inventory"})]})]})]})]}),p&&c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(eQ,{className:"h-8 w-8 text-blue-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.totalItems}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Items"})]})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ZD,{className:"h-8 w-8 text-green-500"}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["",p.totalValue.toLocaleString()]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Value"})]})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(xwe,{className:"h-8 w-8 text-orange-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.lowStockItems}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Low Stock"})]})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(id,{className:"h-8 w-8 text-red-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.expiredItems}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Expired"})]})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(id,{className:"h-8 w-8 text-yellow-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:p.expiringSoon}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Expiring Soon"})]})]})})})]}),c.jsxs("div",{className:"flex gap-4",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(Uo,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),c.jsx(at,{placeholder:"Search medications...",value:b,onChange:xe=>C(xe.target.value),className:"pl-10"})]}),c.jsxs(Wn,{value:A,onValueChange:D,children:[c.jsx(jn,{className:"w-48",children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"all",children:"All Categories"}),Re.map(xe=>c.jsx(ke,{value:xe,children:xe},xe))]})]})]}),c.jsxs(Al,{defaultValue:"all",children:[c.jsxs(Lc,{className:"grid w-full grid-cols-4",children:[c.jsxs(kn,{value:"all",children:["All (",he.length,")"]}),c.jsxs(kn,{value:"low-stock",children:["Low Stock (",rt.length,")"]}),c.jsxs(kn,{value:"expired",children:["Expired (",De.length,")"]}),c.jsxs(kn,{value:"expiring",children:["Expiring Soon (",Oe.length,")"]})]}),c.jsx(Ln,{value:"all",className:"space-y-3",children:he.map(xe=>c.jsx(wT,{item:xe,onAdjustStock:We},xe.id))}),c.jsx(Ln,{value:"low-stock",className:"space-y-3",children:rt.map(xe=>c.jsx(wT,{item:xe,onAdjustStock:We},xe.id))}),c.jsx(Ln,{value:"expired",className:"space-y-3",children:De.map(xe=>c.jsx(wT,{item:xe,onAdjustStock:We},xe.id))}),c.jsx(Ln,{value:"expiring",className:"space-y-3",children:Oe.map(xe=>c.jsx(wT,{item:xe,onAdjustStock:We},xe.id))})]}),c.jsx(us,{open:G,onOpenChange:L,children:c.jsxs(hs,{children:[c.jsx(ps,{children:c.jsxs(ms,{children:["Adjust Stock - ",B==null?void 0:B.medicationName]})}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"p-4 bg-accent rounded-lg",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Stock"}),c.jsx("p",{className:"text-2xl font-bold",children:B==null?void 0:B.quantityInStock})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Transaction Type"}),c.jsxs(Wn,{value:ee.transactionType,onValueChange:xe=>$({...ee,transactionType:xe}),children:[c.jsx(jn,{children:c.jsx(Hn,{})}),c.jsxs(Mn,{children:[c.jsx(ke,{value:"restock",children:"Restock (Add)"}),c.jsx(ke,{value:"dispense",children:"Dispense (Remove)"}),c.jsx(ke,{value:"expired",children:"Mark as Expired (Remove)"}),c.jsx(ke,{value:"adjustment",children:"Adjustment"})]})]})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Quantity"}),c.jsx(at,{type:"number",value:ee.quantity,onChange:xe=>$({...ee,quantity:parseInt(xe.target.value)})})]}),c.jsxs("div",{children:[c.jsx(tt,{children:"Notes"}),c.jsx(ii,{value:ee.notes,onChange:xe=>$({...ee,notes:xe.target.value}),rows:2})]}),c.jsx(we,{onClick:je,className:"w-full",children:"Confirm Adjustment"})]})]})})]})}function wT({item:r,onAdjustStock:s}){return c.jsx(_e,{className:r.isExpired?"border-red-500":r.isLowStock?"border-orange-500":"",children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex justify-between items-start",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx("h3",{className:"font-semibold text-lg",children:r.medicationName}),r.genericName&&c.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",r.genericName,")"]}),c.jsx(xt,{variant:"outline",children:r.category}),r.isExpired&&c.jsx(xt,{variant:"destructive",children:"Expired"}),r.isExpiringSoon&&!r.isExpired&&c.jsx(xt,{variant:"secondary",className:"bg-yellow-100",children:"Expiring Soon"}),r.isLowStock&&c.jsx(xt,{variant:"secondary",className:"bg-orange-100",children:"Low Stock"})]}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"Form & Strength"}),c.jsxs("p",{className:"font-medium",children:[r.dosageForm," - ",r.strength]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"In Stock"}),c.jsx("p",{className:"font-medium text-lg",children:r.quantityInStock})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"Unit Price"}),c.jsxs("p",{className:"font-medium",children:["",r.unitPrice.toLocaleString()]})]}),c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"Total Value"}),c.jsxs("p",{className:"font-medium text-green-600",children:["",r.totalValue.toLocaleString()]})]}),r.location&&c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"Location"}),c.jsx("p",{className:"font-medium",children:r.location})]}),r.expiryDate&&c.jsxs("div",{children:[c.jsx("p",{className:"text-muted-foreground",children:"Expiry Date"}),c.jsx("p",{className:"font-medium",children:new Date(r.expiryDate).toLocaleDateString()})]})]})]}),c.jsx("div",{className:"flex gap-2",children:c.jsx(we,{variant:"outline",size:"sm",onClick:()=>s(r),children:c.jsx(Ewe,{className:"h-4 w-4"})})})]})})})}function S1e(){ts();const{toast:r}=jr();so();const[s,o]=I.useState(null),[d,p]=I.useState([]),[f,E]=I.useState(""),[y,b]=I.useState(!1),C="5f98058e-9bd6-4c92-9f8f-13b58b4c36f9";I.useEffect(()=>{A()},[]);const A=async()=>{b(!0);try{await Promise.all([D(),k()])}finally{b(!1)}},D=async()=>{try{const L=await(await fetch(`http://localhost:5000/api/billing/reports/daily?hospital_id=${C}`)).json();o(L)}catch(G){console.error("Failed to fetch daily report:",G)}},k=async()=>{try{p([])}catch(G){console.error("Failed to fetch recent bills:",G)}},W=async()=>{f&&r({title:"Search",description:"Patient search functionality coming soon"})};return c.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[c.jsx("div",{className:"flex justify-between items-center",children:c.jsxs("div",{children:[c.jsx("h1",{className:"text-3xl font-bold",children:"Billing & Payments"}),c.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage patient billing and process payments"})]})}),c.jsx(_e,{className:"bg-blue-50 border-blue-200",children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx(oa,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),c.jsxs("div",{children:[c.jsx("h3",{className:"font-semibold text-blue-900",children:"Billing System - Phase 1"}),c.jsx("p",{className:"text-blue-800 mt-1 text-sm",children:"Backend API is fully functional with 61 pre-configured services. Additional frontend pages (pricing management, bill details, payment processing) coming in Phase 2."}),c.jsxs("div",{className:"mt-3 space-y-1 text-sm text-blue-700",children:[c.jsx("p",{children:" Service pricing configured (1,000 - 300,000)"}),c.jsx("p",{children:" Auto-charge API ready for department integration"}),c.jsx("p",{children:" Payment processing API functional"}),c.jsx("p",{children:" Financial reports API available"})]})]})]})})}),s&&c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ZD,{className:"h-8 w-8 text-green-500"}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["",s.totalCollected.toLocaleString()]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Today's Collection"})]})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(tQ,{className:"h-8 w-8 text-blue-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:s.paymentsCount}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Payments Received"})]})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(oa,{className:"h-8 w-8 text-purple-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-2xl font-bold",children:s.newBills}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"New Bills"})]})]})})}),c.jsx(_e,{children:c.jsx(Te,{className:"pt-6",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Gv,{className:"h-8 w-8 text-orange-500"}),c.jsxs("div",{children:[c.jsxs("p",{className:"text-2xl font-bold",children:["",s.outstandingBalance.toLocaleString()]}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Outstanding"})]})]})})})]}),s&&Object.keys(s.paymentMethodsBreakdown).length>0&&c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Today's Payment Methods"})}),c.jsx(Te,{children:c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(s.paymentMethodsBreakdown).map(([G,L])=>c.jsxs("div",{className:"p-4 border rounded-lg",children:[c.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:G.replace("_"," ")}),c.jsxs("p",{className:"text-xl font-bold text-green-600",children:["",L.toLocaleString()]})]},G))})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{children:"Find Patient Bill"})}),c.jsx(Te,{children:c.jsxs("div",{className:"flex gap-4",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(Uo,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),c.jsx(at,{placeholder:"Search by patient name, MRN, or bill number...",value:f,onChange:G=>E(G.target.value),onKeyPress:G=>G.key==="Enter"&&W(),className:"pl-10"})]}),c.jsxs(we,{onClick:W,children:[c.jsx(Uo,{className:"mr-2 h-4 w-4"}),"Search"]})]})})]}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{className:"text-base",children:"Available Services"})}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-3 text-sm",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-muted-foreground",children:"Consultations"}),c.jsx("span",{className:"font-semibold",children:"4,000 - 35,000"})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-muted-foreground",children:"Lab Tests"}),c.jsx("span",{className:"font-semibold",children:"1,200 - 120,000"})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-muted-foreground",children:"Ward Charges (per day)"}),c.jsx("span",{className:"font-semibold",children:"3,000 - 90,000"})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-muted-foreground",children:"Procedures"}),c.jsx("span",{className:"font-semibold",children:"2,000 - 300,000"})]}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-muted-foreground",children:"Admin Fees"}),c.jsx("span",{className:"font-semibold",children:"500 - 7,500"})]}),c.jsx("div",{className:"pt-2 border-t",children:c.jsx("p",{className:"text-xs text-muted-foreground",children:"Total: 61 pre-configured services across 7 categories"})})]})})]}),c.jsxs(_e,{children:[c.jsx(Ke,{children:c.jsx(ze,{className:"text-base",children:"System Capabilities"})}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-3 text-sm",children:[c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx("div",{className:"h-5 w-5 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:c.jsx("div",{className:"h-2 w-2 rounded-full bg-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Auto-Charge System"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Charges automatically added from departments"})]})]}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx("div",{className:"h-5 w-5 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:c.jsx("div",{className:"h-2 w-2 rounded-full bg-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Payment Processing"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Cash, card, transfer, mobile money"})]})]}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx("div",{className:"h-5 w-5 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:c.jsx("div",{className:"h-2 w-2 rounded-full bg-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Discount Management"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Approval workflow based on amount"})]})]}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx("div",{className:"h-5 w-5 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:c.jsx("div",{className:"h-2 w-2 rounded-full bg-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Financial Reports"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"Daily and monthly analytics"})]})]}),c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx("div",{className:"h-5 w-5 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:c.jsx("div",{className:"h-2 w-2 rounded-full bg-green-600"})}),c.jsxs("div",{children:[c.jsx("p",{className:"font-medium",children:"Complete Audit Trail"}),c.jsx("p",{className:"text-xs text-muted-foreground",children:"All transactions logged"})]})]})]})})]})]}),c.jsxs(_e,{children:[c.jsxs(Ke,{children:[c.jsx(ze,{children:"Using the Billing API"}),c.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"The backend API is ready. Here's how departments can integrate:"})]}),c.jsx(Te,{children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[c.jsx("p",{className:"font-semibold text-sm mb-2",children:"1. View Service Pricing"}),c.jsx("code",{className:"text-xs bg-white p-2 rounded block overflow-x-auto",children:"GET /api/billing/pricing?hospital_id=HOSPITAL_ID"})]}),c.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[c.jsx("p",{className:"font-semibold text-sm mb-2",children:"2. Add Charge (Auto-Charge)"}),c.jsxs("code",{className:"text-xs bg-white p-2 rounded block overflow-x-auto",children:["POST /api/billing/charges/add",c.jsx("br",{}),'{ "patient_id": "P-001", "service_category": "consultation", "service_name": "General Consultation" }']}),c.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"This automatically adds 7,500 to the patient's bill"})]}),c.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[c.jsx("p",{className:"font-semibold text-sm mb-2",children:"3. Process Payment"}),c.jsxs("code",{className:"text-xs bg-white p-2 rounded block overflow-x-auto",children:["POST /api/billing/payments",c.jsx("br",{}),'{ "bill_id": "BIL-2024-00001", "amount": 10000, "payment_method": "cash" }']})]}),c.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[c.jsx("p",{className:"font-semibold text-sm mb-2",children:"4. View Daily Report"}),c.jsx("code",{className:"text-xs bg-white p-2 rounded block overflow-x-auto",children:"GET /api/billing/reports/daily?hospital_id=HOSPITAL_ID"})]}),c.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:c.jsxs("p",{className:"text-sm text-blue-800",children:[c.jsx("strong",{children:"Note:"})," Frontend pages for pricing management, bill details, and payment processing will be added in Phase 2. The API is fully functional and ready for integration."]})})]})})]})]})}function T1e(){return c.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:c.jsx(_e,{className:"w-full max-w-md mx-4",children:c.jsxs(Te,{className:"pt-6",children:[c.jsxs("div",{className:"flex mb-4 gap-2",children:[c.jsx(bl,{className:"h-8 w-8 text-red-500"}),c.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),c.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}function b1e(){const{isAuthenticated:r,user:s}=ts();if(!r)return c.jsxs("div",{className:"flex flex-col min-h-screen",children:[c.jsx("div",{className:"flex-1",children:c.jsxs(w8,{children:[c.jsx(cr,{path:"/",component:_Oe}),c.jsx(cr,{path:"/register",component:YOe}),c.jsx(cr,{path:"/forgot-password",component:QOe}),c.jsx(cr,{path:"/reset-password",component:$Oe}),c.jsx(cr,{children:c.jsx(WA,{to:"/"})})]})}),c.jsx(mH,{})]});const o={"--sidebar-width":"16rem","--sidebar-width-icon":"3rem"};return c.jsx(tNe,{style:o,children:c.jsxs("div",{className:"flex h-screen w-full flex-col",children:[c.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[c.jsx(TNe,{}),c.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[c.jsxs("header",{className:"flex items-center gap-4 border-b p-4",children:[c.jsx(rNe,{"data-testid":"button-sidebar-toggle"}),c.jsx("h2",{className:"text-lg font-semibold",children:"Digital Doctors Assistant"})]}),c.jsx("main",{className:"flex-1 overflow-auto p-6 bg-background",children:c.jsxs(w8,{children:[c.jsx(cr,{path:"/dashboard",children:c.jsx(Hr,{children:c.jsx(mPe,{})})}),c.jsx(cr,{path:"/health-chatbot",children:c.jsx(Hr,{children:c.jsx(iDe,{})})}),c.jsx(cr,{path:"/personal-diary",children:c.jsx(Hr,{children:c.jsx(aDe,{})})}),c.jsx(cr,{path:"/patients",children:c.jsx(Hr,{requiredRoles:["doctor","admin"],children:c.jsx(gPe,{})})}),c.jsx(cr,{path:"/patients/new",children:c.jsx(Hr,{requiredRoles:["doctor","admin"],children:c.jsx(EPe,{})})}),c.jsx(cr,{path:"/patients/:id",children:c.jsx(Hr,{children:c.jsx(SPe,{})})}),c.jsx(cr,{path:"/users",children:c.jsx(Hr,{requiredRoles:["admin"],children:c.jsx(WPe,{})})}),c.jsx(cr,{path:"/appointments",children:c.jsx(Hr,{requiredRoles:["patient","admin"],children:c.jsx(KPe,{})})}),c.jsx(cr,{path:"/doctor/appointments",children:c.jsx(Hr,{requiredRoles:["doctor","admin"],children:c.jsx(zPe,{})})}),c.jsx(cr,{path:"/old-subscription-billing",children:c.jsx(Hr,{children:c.jsx(qPe,{})})}),c.jsx(cr,{path:"/department/dashboard",children:c.jsx(Hr,{requiredRoles:["doctor","nurse"],children:c.jsx(YPe,{})})}),c.jsx(cr,{path:"/admin/departments",children:c.jsx(Hr,{requiredRoles:["admin"],children:c.jsx(XPe,{})})}),c.jsx(cr,{path:"/system-admin",children:c.jsx(Hr,{requiredRoles:["system_admin"],children:c.jsx(JPe,{})})}),c.jsx(cr,{path:"/hospital-admin",children:c.jsx(Hr,{requiredRoles:["hospital_admin","system_admin"],children:c.jsx($Pe,{hospitalId:"5f98058e-9bd6-4c92-9f8f-13b58b4c36f9",hospitalName:"Test Hospital"})})}),c.jsx(cr,{path:"/tickets",children:c.jsx(Hr,{children:c.jsx(tDe,{})})}),c.jsx(cr,{path:"/patient-assignments",children:c.jsx(Hr,{requiredRoles:["hospital_admin","system_admin"],children:c.jsx(nDe,{})})}),c.jsx(cr,{path:"/departments-teams",children:c.jsx(Hr,{requiredRoles:["hospital_admin","system_admin"],children:c.jsx(rDe,{})})}),c.jsx(cr,{path:"/ai-clinical/:patientId",children:c.jsx(Hr,{requiredRoles:["doctor"],children:c.jsx(sDe,{})})}),c.jsx(cr,{path:"/telemedicine/:sessionId",children:c.jsx(Hr,{requiredRoles:["doctor","patient","system_admin"],children:c.jsx(eDe,{})})}),c.jsx(cr,{path:"/medical-history",children:c.jsx(Hr,{requiredRoles:["doctor","nurse","lab_tech","pharmacist","admin","system_admin"],children:c.jsx(oDe,{})})}),c.jsx(cr,{path:"/patient-timeline/:patientId",children:c.jsx(Hr,{requiredRoles:["doctor","nurse","hospital_admin","system_admin"],children:c.jsx(m1e,{})})}),c.jsx(cr,{path:"/prescriptions",children:c.jsx(Hr,{requiredRoles:["pharmacist","doctor","admin","system_admin"],children:c.jsx(f1e,{})})}),c.jsx(cr,{path:"/subscription",children:c.jsx(Hr,{requiredRoles:["hospital_admin","system_admin"],children:c.jsx(E1e,{})})}),c.jsx(cr,{path:"/system-subscriptions",children:c.jsx(Hr,{requiredRoles:["system_admin"],children:c.jsx(v1e,{})})}),c.jsx(cr,{path:"/pharmacy-inventory",children:c.jsx(Hr,{requiredRoles:["pharmacist","hospital_admin","system_admin"],children:c.jsx(y1e,{})})}),c.jsx(cr,{path:"/billing",children:c.jsx(Hr,{requiredRoles:["accountant","accounts_manager","hospital_admin","system_admin"],children:c.jsx(S1e,{})})}),c.jsx(cr,{path:"/",children:()=>{if(s){const d=R1(s.role);return c.jsx(WA,{to:d})}return c.jsx(WA,{to:"/dashboard"})}}),c.jsx(cr,{component:T1e})]})})]})]}),c.jsx(i$,{}),c.jsx(mH,{})]})})}function w1e(){return c.jsx(HTe,{client:Nc,children:c.jsx(QQ,{children:c.jsxs(SNe,{children:[c.jsx(b1e,{}),c.jsx(uCe,{})]})})})}$7(document.getElementById("root")).render(c.jsx(w1e,{}));
